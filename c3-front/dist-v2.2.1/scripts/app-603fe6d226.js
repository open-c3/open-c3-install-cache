
/*
 * JQuery zTree core v3.5.23
 * http://zTree.me/
 *
 * Copyright (c) 2010 Hunter.z
 *
 * Licensed same as jquery - MIT License
 * http://www.opensource.org/licenses/mit-license.php
 *
 * email: hunter.z@263.net
 * Date: 2016-04-01
 */
(function($){
	var settings = {}, roots = {}, caches = {},
	//default consts of core
	_consts = {
		className: {
			BUTTON: "button",
			LEVEL: "level",
			ICO_LOADING: "ico_loading",
			SWITCH: "switch",
			NAME: 'node_name'
		},
		event: {
			NODECREATED: "ztree_nodeCreated",
			CLICK: "ztree_click",
			EXPAND: "ztree_expand",
			COLLAPSE: "ztree_collapse",
			ASYNC_SUCCESS: "ztree_async_success",
			ASYNC_ERROR: "ztree_async_error",
			REMOVE: "ztree_remove",
			SELECTED: "ztree_selected",
			UNSELECTED: "ztree_unselected"
		},
		id: {
			A: "_a",
			ICON: "_ico",
			SPAN: "_span",
			SWITCH: "_switch",
			UL: "_ul"
		},
		line: {
			ROOT: "root",
			ROOTS: "roots",
			CENTER: "center",
			BOTTOM: "bottom",
			NOLINE: "noline",
			LINE: "line"
		},
		folder: {
			OPEN: "open",
			CLOSE: "close",
			DOCU: "docu"
		},
		node: {
			CURSELECTED: "curSelectedNode"
		}
	},
	//default setting of core
	_setting = {
		treeId: "",
		treeObj: null,
		view: {
			addDiyDom: null,
			autoCancelSelected: true,
			dblClickExpand: true,
			expandSpeed: "fast",
			fontCss: {},
			nameIsHTML: false,
			selectedMulti: true,
			showIcon: true,
			showLine: true,
			showTitle: true,
			txtSelectedEnable: false
		},
		data: {
			key: {
				children: "children",
				name: "name",
				title: "",
				url: "url",
				icon: "icon"
			},
			simpleData: {
				enable: false,
				idKey: "id",
				pIdKey: "pId",
				rootPId: null
			},
			keep: {
				parent: false,
				leaf: false
			}
		},
		async: {
			enable: false,
			contentType: "application/x-www-form-urlencoded",
			type: "post",
			dataType: "text",
			url: "",
			autoParam: [],
			otherParam: [],
			dataFilter: null
		},
		callback: {
			beforeAsync:null,
			beforeClick:null,
			beforeDblClick:null,
			beforeRightClick:null,
			beforeMouseDown:null,
			beforeMouseUp:null,
			beforeExpand:null,
			beforeCollapse:null,
			beforeRemove:null,

			onAsyncError:null,
			onAsyncSuccess:null,
			onNodeCreated:null,
			onClick:null,
			onDblClick:null,
			onRightClick:null,
			onMouseDown:null,
			onMouseUp:null,
			onExpand:null,
			onCollapse:null,
			onRemove:null
		}
	},
	//default root of core
	//zTree use root to save full data
	_initRoot = function (setting) {
		var r = data.getRoot(setting);
		if (!r) {
			r = {};
			data.setRoot(setting, r);
		}
		r[setting.data.key.children] = [];
		r.expandTriggerFlag = false;
		r.curSelectedList = [];
		r.noSelection = true;
		r.createdNodes = [];
		r.zId = 0;
		r._ver = (new Date()).getTime();
	},
	//default cache of core
	_initCache = function(setting) {
		var c = data.getCache(setting);
		if (!c) {
			c = {};
			data.setCache(setting, c);
		}
		c.nodes = [];
		c.doms = [];
	},
	//default bindEvent of core
	_bindEvent = function(setting) {
		var o = setting.treeObj,
		c = consts.event;
		o.bind(c.NODECREATED, function (event, treeId, node) {
			tools.apply(setting.callback.onNodeCreated, [event, treeId, node]);
		});

		o.bind(c.CLICK, function (event, srcEvent, treeId, node, clickFlag) {
			tools.apply(setting.callback.onClick, [srcEvent, treeId, node, clickFlag]);
		});

		o.bind(c.EXPAND, function (event, treeId, node) {
			tools.apply(setting.callback.onExpand, [event, treeId, node]);
		});

		o.bind(c.COLLAPSE, function (event, treeId, node) {
			tools.apply(setting.callback.onCollapse, [event, treeId, node]);
		});

		o.bind(c.ASYNC_SUCCESS, function (event, treeId, node, msg) {
			tools.apply(setting.callback.onAsyncSuccess, [event, treeId, node, msg]);
		});

		o.bind(c.ASYNC_ERROR, function (event, treeId, node, XMLHttpRequest, textStatus, errorThrown) {
			tools.apply(setting.callback.onAsyncError, [event, treeId, node, XMLHttpRequest, textStatus, errorThrown]);
		});

		o.bind(c.REMOVE, function (event, treeId, treeNode) {
			tools.apply(setting.callback.onRemove, [event, treeId, treeNode]);
		});

		o.bind(c.SELECTED, function (event, treeId, node) {
			tools.apply(setting.callback.onSelected, [treeId, node]);
		});
		o.bind(c.UNSELECTED, function (event, treeId, node) {
			tools.apply(setting.callback.onUnSelected, [treeId, node]);
		});
	},
	_unbindEvent = function(setting) {
		var o = setting.treeObj,
		c = consts.event;
		o.unbind(c.NODECREATED)
		.unbind(c.CLICK)
		.unbind(c.EXPAND)
		.unbind(c.COLLAPSE)
		.unbind(c.ASYNC_SUCCESS)
		.unbind(c.ASYNC_ERROR)
		.unbind(c.REMOVE)
		.unbind(c.SELECTED)
		.unbind(c.UNSELECTED);
	},
	//default event proxy of core
	_eventProxy = function(event) {
		var target = event.target,
		setting = data.getSetting(event.data.treeId),
		tId = "", node = null,
		nodeEventType = "", treeEventType = "",
		nodeEventCallback = null, treeEventCallback = null,
		tmp = null;

		if (tools.eqs(event.type, "mousedown")) {
			treeEventType = "mousedown";
		} else if (tools.eqs(event.type, "mouseup")) {
			treeEventType = "mouseup";
		} else if (tools.eqs(event.type, "contextmenu")) {
			treeEventType = "contextmenu";
		} else if (tools.eqs(event.type, "click")) {
			if (tools.eqs(target.tagName, "span") && target.getAttribute("treeNode"+ consts.id.SWITCH) !== null) {
				tId = tools.getNodeMainDom(target).id;
				nodeEventType = "switchNode";
			} else {
				tmp = tools.getMDom(setting, target, [{tagName:"a", attrName:"treeNode"+consts.id.A}]);
				if (tmp) {
					tId = tools.getNodeMainDom(tmp).id;
					nodeEventType = "clickNode";
				}
			}
		} else if (tools.eqs(event.type, "dblclick")) {
			treeEventType = "dblclick";
			tmp = tools.getMDom(setting, target, [{tagName:"a", attrName:"treeNode"+consts.id.A}]);
			if (tmp) {
				tId = tools.getNodeMainDom(tmp).id;
				nodeEventType = "switchNode";
			}
		}
		if (treeEventType.length > 0 && tId.length == 0) {
			tmp = tools.getMDom(setting, target, [{tagName:"a", attrName:"treeNode"+consts.id.A}]);
			if (tmp) {tId = tools.getNodeMainDom(tmp).id;}
		}
		// event to node
		if (tId.length>0) {
			node = data.getNodeCache(setting, tId);
			switch (nodeEventType) {
				case "switchNode" :
					if (!node.isParent) {
						nodeEventType = "";
					} else if (tools.eqs(event.type, "click")
						|| (tools.eqs(event.type, "dblclick") && tools.apply(setting.view.dblClickExpand, [setting.treeId, node], setting.view.dblClickExpand))) {
						nodeEventCallback = handler.onSwitchNode;
					} else {
						nodeEventType = "";
					}
					break;
				case "clickNode" :
					nodeEventCallback = handler.onClickNode;
					break;
			}
		}
		// event to zTree
		switch (treeEventType) {
			case "mousedown" :
				treeEventCallback = handler.onZTreeMousedown;
				break;
			case "mouseup" :
				treeEventCallback = handler.onZTreeMouseup;
				break;
			case "dblclick" :
				treeEventCallback = handler.onZTreeDblclick;
				break;
			case "contextmenu" :
				treeEventCallback = handler.onZTreeContextmenu;
				break;
		}
		var proxyResult = {
			stop: false,
			node: node,
			nodeEventType: nodeEventType,
			nodeEventCallback: nodeEventCallback,
			treeEventType: treeEventType,
			treeEventCallback: treeEventCallback
		};
		return proxyResult
	},
	//default init node of core
	_initNode = function(setting, level, n, parentNode, isFirstNode, isLastNode, openFlag) {
		if (!n) return;
		var r = data.getRoot(setting),
		childKey = setting.data.key.children;
		n.level = level;
		n.tId = setting.treeId + "_" + (++r.zId);
		n.parentTId = parentNode ? parentNode.tId : null;
		n.open = (typeof n.open == "string") ? tools.eqs(n.open, "true") : !!n.open;
		if (n[childKey] && n[childKey].length > 0) {
			n.isParent = true;
			n.zAsync = true;
		} else {
			n.isParent = (typeof n.isParent == "string") ? tools.eqs(n.isParent, "true") : !!n.isParent;
			n.open = (n.isParent && !setting.async.enable) ? n.open : false;
			n.zAsync = !n.isParent;
		}
		n.isFirstNode = isFirstNode;
		n.isLastNode = isLastNode;
		n.getParentNode = function() {return data.getNodeCache(setting, n.parentTId);};
		n.getPreNode = function() {return data.getPreNode(setting, n);};
		n.getNextNode = function() {return data.getNextNode(setting, n);};
		n.getIndex = function() {return data.getNodeIndex(setting, n);};
		n.getPath = function() {return data.getNodePath(setting, n);};
		n.isAjaxing = false;
		data.fixPIdKeyValue(setting, n);
	},
	_init = {
		bind: [_bindEvent],
		unbind: [_unbindEvent],
		caches: [_initCache],
		nodes: [_initNode],
		proxys: [_eventProxy],
		roots: [_initRoot],
		beforeA: [],
		afterA: [],
		innerBeforeA: [],
		innerAfterA: [],
		zTreeTools: []
	},
	//method of operate data
	data = {
		addNodeCache: function(setting, node) {
			data.getCache(setting).nodes[data.getNodeCacheId(node.tId)] = node;
		},
		getNodeCacheId: function(tId) {
			return tId.substring(tId.lastIndexOf("_")+1);
		},
		addAfterA: function(afterA) {
			_init.afterA.push(afterA);
		},
		addBeforeA: function(beforeA) {
			_init.beforeA.push(beforeA);
		},
		addInnerAfterA: function(innerAfterA) {
			_init.innerAfterA.push(innerAfterA);
		},
		addInnerBeforeA: function(innerBeforeA) {
			_init.innerBeforeA.push(innerBeforeA);
		},
		addInitBind: function(bindEvent) {
			_init.bind.push(bindEvent);
		},
		addInitUnBind: function(unbindEvent) {
			_init.unbind.push(unbindEvent);
		},
		addInitCache: function(initCache) {
			_init.caches.push(initCache);
		},
		addInitNode: function(initNode) {
			_init.nodes.push(initNode);
		},
		addInitProxy: function(initProxy, isFirst) {
			if (!!isFirst) {
				_init.proxys.splice(0,0,initProxy);
			} else {
				_init.proxys.push(initProxy);
			}
		},
		addInitRoot: function(initRoot) {
			_init.roots.push(initRoot);
		},
		addNodesData: function(setting, parentNode, index, nodes) {
			var childKey = setting.data.key.children, params;
			if (!parentNode[childKey]) {
				parentNode[childKey] = [];
				index = -1;
			} else if (index >= parentNode[childKey].length) {
				index = -1;
			}

			if (parentNode[childKey].length > 0 && index === 0) {
				parentNode[childKey][0].isFirstNode = false;
				view.setNodeLineIcos(setting, parentNode[childKey][0]);
			} else if (parentNode[childKey].length > 0 && index < 0) {
				parentNode[childKey][parentNode[childKey].length - 1].isLastNode = false;
				view.setNodeLineIcos(setting, parentNode[childKey][parentNode[childKey].length - 1]);
			}
			parentNode.isParent = true;

			if (index<0) {
				parentNode[childKey] = parentNode[childKey].concat(nodes);
			} else {
				params = [index, 0].concat(nodes);
				parentNode[childKey].splice.apply(parentNode[childKey], params);
			}
		},
		addSelectedNode: function(setting, node) {
			var root = data.getRoot(setting);
			if (!data.isSelectedNode(setting, node)) {
				root.curSelectedList.push(node);
			}
		},
		addCreatedNode: function(setting, node) {
			if (!!setting.callback.onNodeCreated || !!setting.view.addDiyDom) {
				var root = data.getRoot(setting);
				root.createdNodes.push(node);
			}
		},
		addZTreeTools: function(zTreeTools) {
			_init.zTreeTools.push(zTreeTools);
		},
		exSetting: function(s) {
			$.extend(true, _setting, s);
		},
		fixPIdKeyValue: function(setting, node) {
			if (setting.data.simpleData.enable) {
				node[setting.data.simpleData.pIdKey] = node.parentTId ? node.getParentNode()[setting.data.simpleData.idKey] : setting.data.simpleData.rootPId;
			}
		},
		getAfterA: function(setting, node, array) {
			for (var i=0, j=_init.afterA.length; i<j; i++) {
				_init.afterA[i].apply(this, arguments);
			}
		},
		getBeforeA: function(setting, node, array) {
			for (var i=0, j=_init.beforeA.length; i<j; i++) {
				_init.beforeA[i].apply(this, arguments);
			}
		},
		getInnerAfterA: function(setting, node, array) {
			for (var i=0, j=_init.innerAfterA.length; i<j; i++) {
				_init.innerAfterA[i].apply(this, arguments);
			}
		},
		getInnerBeforeA: function(setting, node, array) {
			for (var i=0, j=_init.innerBeforeA.length; i<j; i++) {
				_init.innerBeforeA[i].apply(this, arguments);
			}
		},
		getCache: function(setting) {
			return caches[setting.treeId];
		},
		getNodeIndex: function(setting, node) {
			if (!node) return null;
			var childKey = setting.data.key.children,
			p = node.parentTId ? node.getParentNode() : data.getRoot(setting);
			for (var i=0, l=p[childKey].length-1; i<=l; i++) {
				if (p[childKey][i] === node) {
					return i;
				}
			}
			return -1;
		},
		getNextNode: function(setting, node) {
			if (!node) return null;
			var childKey = setting.data.key.children,
			p = node.parentTId ? node.getParentNode() : data.getRoot(setting);
			for (var i=0, l=p[childKey].length-1; i<=l; i++) {
				if (p[childKey][i] === node) {
					return (i==l ? null : p[childKey][i+1]);
				}
			}
			return null;
		},
		getNodeByParam: function(setting, nodes, key, value) {
			if (!nodes || !key) return null;
			var childKey = setting.data.key.children;
			for (var i = 0, l = nodes.length; i < l; i++) {
				if (nodes[i][key] == value) {
					return nodes[i];
				}
				var tmp = data.getNodeByParam(setting, nodes[i][childKey], key, value);
				if (tmp) return tmp;
			}
			return null;
		},
		getNodeCache: function(setting, tId) {
			if (!tId) return null;
			var n = caches[setting.treeId].nodes[data.getNodeCacheId(tId)];
			return n ? n : null;
		},
		getNodeName: function(setting, node) {
			var nameKey = setting.data.key.name;
			return "" + node[nameKey];
		},
		getNodePath: function(setting, node) {
			if (!node) return null;

			var path;
			if(node.parentTId) {
				path = node.getParentNode().getPath();
			} else {
				path = [];
			}

			if (path) {
				path.push(node);
			}

			return path;
		},
		getNodeTitle: function(setting, node) {
			var t = setting.data.key.title === "" ? setting.data.key.name : setting.data.key.title;
			return "" + node[t];
		},
		getNodes: function(setting) {
			return data.getRoot(setting)[setting.data.key.children];
		},
		getNodesByParam: function(setting, nodes, key, value) {
			if (!nodes || !key) return [];
			var childKey = setting.data.key.children,
			result = [];
			for (var i = 0, l = nodes.length; i < l; i++) {
				if (nodes[i][key] == value) {
					result.push(nodes[i]);
				}
				result = result.concat(data.getNodesByParam(setting, nodes[i][childKey], key, value));
			}
			return result;
		},
		getNodesByParamFuzzy: function(setting, nodes, key, value) {
			if (!nodes || !key) return [];
			var childKey = setting.data.key.children,
			result = [];
			value = value.toLowerCase();
			for (var i = 0, l = nodes.length; i < l; i++) {
				if (typeof nodes[i][key] == "string" && nodes[i][key].toLowerCase().indexOf(value)>-1) {
					result.push(nodes[i]);
				}
				result = result.concat(data.getNodesByParamFuzzy(setting, nodes[i][childKey], key, value));
			}
			return result;
		},
		getNodesByFilter: function(setting, nodes, filter, isSingle, invokeParam) {
			if (!nodes) return (isSingle ? null : []);
			var childKey = setting.data.key.children,
			result = isSingle ? null : [];
			for (var i = 0, l = nodes.length; i < l; i++) {
				if (tools.apply(filter, [nodes[i], invokeParam], false)) {
					if (isSingle) {return nodes[i];}
					result.push(nodes[i]);
				}
				var tmpResult = data.getNodesByFilter(setting, nodes[i][childKey], filter, isSingle, invokeParam);
				if (isSingle && !!tmpResult) {return tmpResult;}
				result = isSingle ? tmpResult : result.concat(tmpResult);
			}
			return result;
		},
		getPreNode: function(setting, node) {
			if (!node) return null;
			var childKey = setting.data.key.children,
			p = node.parentTId ? node.getParentNode() : data.getRoot(setting);
			for (var i=0, l=p[childKey].length; i<l; i++) {
				if (p[childKey][i] === node) {
					return (i==0 ? null : p[childKey][i-1]);
				}
			}
			return null;
		},
		getRoot: function(setting) {
			return setting ? roots[setting.treeId] : null;
		},
		getRoots: function() {
			return roots;
		},
		getSetting: function(treeId) {
			return settings[treeId];
		},
		getSettings: function() {
			return settings;
		},
		getZTreeTools: function(treeId) {
			var r = this.getRoot(this.getSetting(treeId));
			return r ? r.treeTools : null;
		},
		initCache: function(setting) {
			for (var i=0, j=_init.caches.length; i<j; i++) {
				_init.caches[i].apply(this, arguments);
			}
		},
		initNode: function(setting, level, node, parentNode, preNode, nextNode) {
			for (var i=0, j=_init.nodes.length; i<j; i++) {
				_init.nodes[i].apply(this, arguments);
			}
		},
		initRoot: function(setting) {
			for (var i=0, j=_init.roots.length; i<j; i++) {
				_init.roots[i].apply(this, arguments);
			}
		},
		isSelectedNode: function(setting, node) {
			var root = data.getRoot(setting);
			for (var i=0, j=root.curSelectedList.length; i<j; i++) {
				if(node === root.curSelectedList[i]) return true;
			}
			return false;
		},
		removeNodeCache: function(setting, node) {
			var childKey = setting.data.key.children;
			if (node[childKey]) {
				for (var i=0, l=node[childKey].length; i<l; i++) {
					arguments.callee(setting, node[childKey][i]);
				}
			}
			data.getCache(setting).nodes[data.getNodeCacheId(node.tId)] = null;
		},
		removeSelectedNode: function(setting, node) {
			var root = data.getRoot(setting);
			for (var i=0, j=root.curSelectedList.length; i<j; i++) {
				if(node === root.curSelectedList[i] || !data.getNodeCache(setting, root.curSelectedList[i].tId)) {
					root.curSelectedList.splice(i, 1);
					setting.treeObj.trigger(consts.event.UNSELECTED, [setting.treeId, node]);
					i--;j--;
				}
			}
		},
		setCache: function(setting, cache) {
			caches[setting.treeId] = cache;
		},
		setRoot: function(setting, root) {
			roots[setting.treeId] = root;
		},
		setZTreeTools: function(setting, zTreeTools) {
			for (var i=0, j=_init.zTreeTools.length; i<j; i++) {
				_init.zTreeTools[i].apply(this, arguments);
			}
		},
		transformToArrayFormat: function (setting, nodes) {
			if (!nodes) return [];
			var childKey = setting.data.key.children,
			r = [];
			if (tools.isArray(nodes)) {
				for (var i=0, l=nodes.length; i<l; i++) {
					r.push(nodes[i]);
					if (nodes[i][childKey])
						r = r.concat(data.transformToArrayFormat(setting, nodes[i][childKey]));
				}
			} else {
				r.push(nodes);
				if (nodes[childKey])
					r = r.concat(data.transformToArrayFormat(setting, nodes[childKey]));
			}
			return r;
		},
		transformTozTreeFormat: function(setting, sNodes) {
			var i,l,
			key = setting.data.simpleData.idKey,
			parentKey = setting.data.simpleData.pIdKey,
			childKey = setting.data.key.children;
			if (!key || key=="" || !sNodes) return [];

			if (tools.isArray(sNodes)) {
				var r = [];
				var tmpMap = [];
				for (i=0, l=sNodes.length; i<l; i++) {
					tmpMap[sNodes[i][key]] = sNodes[i];
				}
				for (i=0, l=sNodes.length; i<l; i++) {
					if (tmpMap[sNodes[i][parentKey]] && sNodes[i][key] != sNodes[i][parentKey]) {
						if (!tmpMap[sNodes[i][parentKey]][childKey])
							tmpMap[sNodes[i][parentKey]][childKey] = [];
						tmpMap[sNodes[i][parentKey]][childKey].push(sNodes[i]);
					} else {
						r.push(sNodes[i]);
					}
				}
				return r;
			}else {
				return [sNodes];
			}
		}
	},
	//method of event proxy
	event = {
		bindEvent: function(setting) {
			for (var i=0, j=_init.bind.length; i<j; i++) {
				_init.bind[i].apply(this, arguments);
			}
		},
		unbindEvent: function(setting) {
			for (var i=0, j=_init.unbind.length; i<j; i++) {
				_init.unbind[i].apply(this, arguments);
			}
		},
		bindTree: function(setting) {
			var eventParam = {
				treeId: setting.treeId
			},
			o = setting.treeObj;
			if (!setting.view.txtSelectedEnable) {
				// for can't select text
				o.bind('selectstart', handler.onSelectStart).css({
					"-moz-user-select":"-moz-none"
				});
			}
			o.bind('click', eventParam, event.proxy);
			o.bind('dblclick', eventParam, event.proxy);
			o.bind('mouseover', eventParam, event.proxy);
			o.bind('mouseout', eventParam, event.proxy);
			o.bind('mousedown', eventParam, event.proxy);
			o.bind('mouseup', eventParam, event.proxy);
			o.bind('contextmenu', eventParam, event.proxy);
		},
		unbindTree: function(setting) {
			var o = setting.treeObj;
			o.unbind('selectstart', handler.onSelectStart)
				.unbind('click', event.proxy)
				.unbind('dblclick', event.proxy)
				.unbind('mouseover', event.proxy)
				.unbind('mouseout', event.proxy)
				.unbind('mousedown', event.proxy)
				.unbind('mouseup', event.proxy)
				.unbind('contextmenu', event.proxy);
		},
		doProxy: function(e) {
			var results = [];
			for (var i=0, j=_init.proxys.length; i<j; i++) {
				var proxyResult = _init.proxys[i].apply(this, arguments);
				results.push(proxyResult);
				if (proxyResult.stop) {
					break;
				}
			}
			return results;
		},
		proxy: function(e) {
			var setting = data.getSetting(e.data.treeId);
			if (!tools.uCanDo(setting, e)) return true;
			var results = event.doProxy(e),
			r = true, x = false;
			for (var i=0, l=results.length; i<l; i++) {
				var proxyResult = results[i];
				if (proxyResult.nodeEventCallback) {
					x = true;
					r = proxyResult.nodeEventCallback.apply(proxyResult, [e, proxyResult.node]) && r;
				}
				if (proxyResult.treeEventCallback) {
					x = true;
					r = proxyResult.treeEventCallback.apply(proxyResult, [e, proxyResult.node]) && r;
				}
			}
			return r;
		}
	},
	//method of event handler
	handler = {
		onSwitchNode: function (event, node) {
			var setting = data.getSetting(event.data.treeId);
			if (node.open) {
				if (tools.apply(setting.callback.beforeCollapse, [setting.treeId, node], true) == false) return true;
				data.getRoot(setting).expandTriggerFlag = true;
				view.switchNode(setting, node);
			} else {
				if (tools.apply(setting.callback.beforeExpand, [setting.treeId, node], true) == false) return true;
				data.getRoot(setting).expandTriggerFlag = true;
				view.switchNode(setting, node);
			}
			return true;
		},
		onClickNode: function (event, node) {
			var setting = data.getSetting(event.data.treeId),
			clickFlag = ( (setting.view.autoCancelSelected && (event.ctrlKey || event.metaKey)) && data.isSelectedNode(setting, node)) ? 0 : (setting.view.autoCancelSelected && (event.ctrlKey || event.metaKey) && setting.view.selectedMulti) ? 2 : 1;
			if (tools.apply(setting.callback.beforeClick, [setting.treeId, node, clickFlag], true) == false) return true;
			if (clickFlag === 0) {
				view.cancelPreSelectedNode(setting, node);
			} else {
				view.selectNode(setting, node, clickFlag === 2);
			}
			setting.treeObj.trigger(consts.event.CLICK, [event, setting.treeId, node, clickFlag]);
			return true;
		},
		onZTreeMousedown: function(event, node) {
			var setting = data.getSetting(event.data.treeId);
			if (tools.apply(setting.callback.beforeMouseDown, [setting.treeId, node], true)) {
				tools.apply(setting.callback.onMouseDown, [event, setting.treeId, node]);
			}
			return true;
		},
		onZTreeMouseup: function(event, node) {
			var setting = data.getSetting(event.data.treeId);
			if (tools.apply(setting.callback.beforeMouseUp, [setting.treeId, node], true)) {
				tools.apply(setting.callback.onMouseUp, [event, setting.treeId, node]);
			}
			return true;
		},
		onZTreeDblclick: function(event, node) {
			var setting = data.getSetting(event.data.treeId);
			if (tools.apply(setting.callback.beforeDblClick, [setting.treeId, node], true)) {
				tools.apply(setting.callback.onDblClick, [event, setting.treeId, node]);
			}
			return true;
		},
		onZTreeContextmenu: function(event, node) {
			var setting = data.getSetting(event.data.treeId);
			if (tools.apply(setting.callback.beforeRightClick, [setting.treeId, node], true)) {
				tools.apply(setting.callback.onRightClick, [event, setting.treeId, node]);
			}
			return (typeof setting.callback.onRightClick) != "function";
		},
		onSelectStart: function(e){
			var n = e.originalEvent.srcElement.nodeName.toLowerCase();
			return (n === "input" || n === "textarea" );
		}
	},
	//method of tools for zTree
	tools = {
		apply: function(fun, param, defaultValue) {
			if ((typeof fun) == "function") {
				return fun.apply(zt, param?param:[]);
			}
			return defaultValue;
		},
		canAsync: function(setting, node) {
			var childKey = setting.data.key.children;
			return (setting.async.enable && node && node.isParent && !(node.zAsync || (node[childKey] && node[childKey].length > 0)));
		},
		clone: function (obj){
			if (obj === null) return null;
			var o = tools.isArray(obj) ? [] : {};
			for(var i in obj){
				o[i] = (obj[i] instanceof Date) ? new Date(obj[i].getTime()) : (typeof obj[i] === "object" ? arguments.callee(obj[i]) : obj[i]);
			}
			return o;
		},
		eqs: function(str1, str2) {
			return str1.toLowerCase() === str2.toLowerCase();
		},
		isArray: function(arr) {
			return Object.prototype.toString.apply(arr) === "[object Array]";
		},
		$: function(node, exp, setting) {
			if (!!exp && typeof exp != "string") {
				setting = exp;
				exp = "";
			}
			if (typeof node == "string") {
				return $(node, setting ? setting.treeObj.get(0).ownerDocument : null);
			} else {
				return $("#" + node.tId + exp, setting ? setting.treeObj : null);
			}
		},
		getMDom: function (setting, curDom, targetExpr) {
			if (!curDom) return null;
			while (curDom && curDom.id !== setting.treeId) {
				for (var i=0, l=targetExpr.length; curDom.tagName && i<l; i++) {
					if (tools.eqs(curDom.tagName, targetExpr[i].tagName) && curDom.getAttribute(targetExpr[i].attrName) !== null) {
						return curDom;
					}
				}
				curDom = curDom.parentNode;
			}
			return null;
		},
		getNodeMainDom:function(target) {
			return ($(target).parent("li").get(0) || $(target).parentsUntil("li").parent().get(0));
		},
		isChildOrSelf: function(dom, parentId) {
			return ( $(dom).closest("#" + parentId).length> 0 );
		},
		uCanDo: function(setting, e) {
			return true;
		}
	},
	//method of operate ztree dom
	view = {
		addNodes: function(setting, parentNode, index, newNodes, isSilent) {
			if (setting.data.keep.leaf && parentNode && !parentNode.isParent) {
				return;
			}
			if (!tools.isArray(newNodes)) {
				newNodes = [newNodes];
			}
			if (setting.data.simpleData.enable) {
				newNodes = data.transformTozTreeFormat(setting, newNodes);
			}
			if (parentNode) {
				var target_switchObj = $$(parentNode, consts.id.SWITCH, setting),
				target_icoObj = $$(parentNode, consts.id.ICON, setting),
				target_ulObj = $$(parentNode, consts.id.UL, setting);

				if (!parentNode.open) {
					view.replaceSwitchClass(parentNode, target_switchObj, consts.folder.CLOSE);
					view.replaceIcoClass(parentNode, target_icoObj, consts.folder.CLOSE);
					parentNode.open = false;
					target_ulObj.css({
						"display": "none"
					});
				}

				data.addNodesData(setting, parentNode, index, newNodes);
				view.createNodes(setting, parentNode.level + 1, newNodes, parentNode, index);
				if (!isSilent) {
					view.expandCollapseParentNode(setting, parentNode, true);
				}
			} else {
				data.addNodesData(setting, data.getRoot(setting), index, newNodes);
				view.createNodes(setting, 0, newNodes, null, index);
			}
		},
		appendNodes: function(setting, level, nodes, parentNode, index, initFlag, openFlag) {
			if (!nodes) return [];
			var html = [],
			childKey = setting.data.key.children;

			var tmpPNode = (parentNode) ? parentNode: data.getRoot(setting),
				tmpPChild = tmpPNode[childKey],
				isFirstNode, isLastNode;

			if (!tmpPChild || index >= tmpPChild.length) {
				index = -1;
			}

			for (var i = 0, l = nodes.length; i < l; i++) {
				var node = nodes[i];
				if (initFlag) {
					isFirstNode = ((index===0 || tmpPChild.length == nodes.length) && (i == 0));
					isLastNode = (index < 0 && i == (nodes.length - 1));
					data.initNode(setting, level, node, parentNode, isFirstNode, isLastNode, openFlag);
					data.addNodeCache(setting, node);
				}

				var childHtml = [];
				if (node[childKey] && node[childKey].length > 0) {
					//make child html first, because checkType
					childHtml = view.appendNodes(setting, level + 1, node[childKey], node, -1, initFlag, openFlag && node.open);
				}
				if (openFlag) {

					view.makeDOMNodeMainBefore(html, setting, node);
					view.makeDOMNodeLine(html, setting, node);
					data.getBeforeA(setting, node, html);
					view.makeDOMNodeNameBefore(html, setting, node);
					data.getInnerBeforeA(setting, node, html);
					view.makeDOMNodeIcon(html, setting, node);
					data.getInnerAfterA(setting, node, html);
					view.makeDOMNodeNameAfter(html, setting, node);
					data.getAfterA(setting, node, html);
					if (node.isParent && node.open) {
						view.makeUlHtml(setting, node, html, childHtml.join(''));
					}
					view.makeDOMNodeMainAfter(html, setting, node);
					data.addCreatedNode(setting, node);
				}
			}
			return html;
		},
		appendParentULDom: function(setting, node) {
			var html = [],
			nObj = $$(node, setting);
			if (!nObj.get(0) && !!node.parentTId) {
				view.appendParentULDom(setting, node.getParentNode());
				nObj = $$(node, setting);
			}
			var ulObj = $$(node, consts.id.UL, setting);
			if (ulObj.get(0)) {
				ulObj.remove();
			}
			var childKey = setting.data.key.children,
			childHtml = view.appendNodes(setting, node.level+1, node[childKey], node, -1, false, true);
			view.makeUlHtml(setting, node, html, childHtml.join(''));
			nObj.append(html.join(''));
		},
		asyncNode: function(setting, node, isSilent, callback) {
			var i, l;
			if (node && !node.isParent) {
				tools.apply(callback);
				return false;
			} else if (node && node.isAjaxing) {
				return false;
			} else if (tools.apply(setting.callback.beforeAsync, [setting.treeId, node], true) == false) {
				tools.apply(callback);
				return false;
			}
			if (node) {
				node.isAjaxing = true;
				var icoObj = $$(node, consts.id.ICON, setting);
				icoObj.attr({"style":"", "class":consts.className.BUTTON + " " + consts.className.ICO_LOADING});
			}

			var tmpParam = {};
			for (i = 0, l = setting.async.autoParam.length; node && i < l; i++) {
				var pKey = setting.async.autoParam[i].split("="), spKey = pKey;
				if (pKey.length>1) {
					spKey = pKey[1];
					pKey = pKey[0];
				}
				tmpParam[spKey] = node[pKey];
			}
			if (tools.isArray(setting.async.otherParam)) {
				for (i = 0, l = setting.async.otherParam.length; i < l; i += 2) {
					tmpParam[setting.async.otherParam[i]] = setting.async.otherParam[i + 1];
				}
			} else {
				for (var p in setting.async.otherParam) {
					tmpParam[p] = setting.async.otherParam[p];
				}
			}

			var _tmpV = data.getRoot(setting)._ver;
			$.ajax({
				contentType: setting.async.contentType,
                cache: false,
				type: setting.async.type,
				url: tools.apply(setting.async.url, [setting.treeId, node], setting.async.url),
				data: tmpParam,
				dataType: setting.async.dataType,
				success: function(msg) {
					if (_tmpV != data.getRoot(setting)._ver) {
						return;
					}
					var newNodes = [];
					try {
						if (!msg || msg.length == 0) {
							newNodes = [];
						} else if (typeof msg == "string") {
							newNodes = eval("(" + msg + ")");
						} else {
							newNodes = msg;
						}
					} catch(err) {
						newNodes = msg;
					}

					if (node) {
						node.isAjaxing = null;
						node.zAsync = true;
					}
					view.setNodeLineIcos(setting, node);
					if (newNodes && newNodes !== "") {
						newNodes = tools.apply(setting.async.dataFilter, [setting.treeId, node, newNodes], newNodes);
						view.addNodes(setting, node, -1, !!newNodes ? tools.clone(newNodes) : [], !!isSilent);
					} else {
						view.addNodes(setting, node, -1, [], !!isSilent);
					}
					setting.treeObj.trigger(consts.event.ASYNC_SUCCESS, [setting.treeId, node, msg]);
					tools.apply(callback);
				},
				error: function(XMLHttpRequest, textStatus, errorThrown) {
					if (_tmpV != data.getRoot(setting)._ver) {
						return;
					}
					if (node) node.isAjaxing = null;
					view.setNodeLineIcos(setting, node);
					setting.treeObj.trigger(consts.event.ASYNC_ERROR, [setting.treeId, node, XMLHttpRequest, textStatus, errorThrown]);
				}
			});
			return true;
		},
		cancelPreSelectedNode: function (setting, node, excludeNode) {
			var list = data.getRoot(setting).curSelectedList,
				i, n;
			for (i=list.length-1; i>=0; i--) {
				n = list[i];
				if (node === n || (!node && (!excludeNode || excludeNode !== n))) {
					$$(n, consts.id.A, setting).removeClass(consts.node.CURSELECTED);
					if (node) {
						data.removeSelectedNode(setting, node);
						break;
					} else {
						list.splice(i, 1);
						setting.treeObj.trigger(consts.event.UNSELECTED, [setting.treeId, n]);
					}
				}
			}
		},
		createNodeCallback: function(setting) {
			if (!!setting.callback.onNodeCreated || !!setting.view.addDiyDom) {
				var root = data.getRoot(setting);
				while (root.createdNodes.length>0) {
					var node = root.createdNodes.shift();
					tools.apply(setting.view.addDiyDom, [setting.treeId, node]);
					if (!!setting.callback.onNodeCreated) {
						setting.treeObj.trigger(consts.event.NODECREATED, [setting.treeId, node]);
					}
				}
			}
		},
		createNodes: function(setting, level, nodes, parentNode, index) {
			if (!nodes || nodes.length == 0) return;
			var root = data.getRoot(setting),
			childKey = setting.data.key.children,
			openFlag = !parentNode || parentNode.open || !!$$(parentNode[childKey][0], setting).get(0);
			root.createdNodes = [];
			var zTreeHtml = view.appendNodes(setting, level, nodes, parentNode, index, true, openFlag),
				parentObj, nextObj;

			if (!parentNode) {
				parentObj = setting.treeObj;
				//setting.treeObj.append(zTreeHtml.join(''));
			} else {
				var ulObj = $$(parentNode, consts.id.UL, setting);
				if (ulObj.get(0)) {
					parentObj = ulObj;
					//ulObj.append(zTreeHtml.join(''));
				}
			}
			if (parentObj) {
				if (index >= 0) {
					nextObj = parentObj.children()[index];
				}
				if (index >=0 && nextObj) {
					$(nextObj).before(zTreeHtml.join(''));
				} else {
					parentObj.append(zTreeHtml.join(''));
				}
			}

			view.createNodeCallback(setting);
		},
		destroy: function(setting) {
			if (!setting) return;
			data.initCache(setting);
			data.initRoot(setting);
			event.unbindTree(setting);
			event.unbindEvent(setting);
			setting.treeObj.empty();
			delete settings[setting.treeId];
		},
		expandCollapseNode: function(setting, node, expandFlag, animateFlag, callback) {
			var root = data.getRoot(setting),
			childKey = setting.data.key.children;
			if (!node) {
				tools.apply(callback, []);
				return;
			}
			if (root.expandTriggerFlag) {
				var _callback = callback;
				callback = function(){
					if (_callback) _callback();
					if (node.open) {
						setting.treeObj.trigger(consts.event.EXPAND, [setting.treeId, node]);
					} else {
						setting.treeObj.trigger(consts.event.COLLAPSE, [setting.treeId, node]);
					}
				};
				root.expandTriggerFlag = false;
			}
			if (!node.open && node.isParent && ((!$$(node, consts.id.UL, setting).get(0)) || (node[childKey] && node[childKey].length>0 && !$$(node[childKey][0], setting).get(0)))) {
				view.appendParentULDom(setting, node);
				view.createNodeCallback(setting);
			}
			if (node.open == expandFlag) {
				tools.apply(callback, []);
				return;
			}
			var ulObj = $$(node, consts.id.UL, setting),
			switchObj = $$(node, consts.id.SWITCH, setting),
			icoObj = $$(node, consts.id.ICON, setting);

			if (node.isParent) {
				node.open = !node.open;
				if (node.iconOpen && node.iconClose) {
					icoObj.attr("style", view.makeNodeIcoStyle(setting, node));
				}

				if (node.open) {
					view.replaceSwitchClass(node, switchObj, consts.folder.OPEN);
					view.replaceIcoClass(node, icoObj, consts.folder.OPEN);
					if (animateFlag == false || setting.view.expandSpeed == "") {
						ulObj.show();
						tools.apply(callback, []);
					} else {
						if (node[childKey] && node[childKey].length > 0) {
							ulObj.slideDown(setting.view.expandSpeed, callback);
						} else {
							ulObj.show();
							tools.apply(callback, []);
						}
					}
				} else {
					view.replaceSwitchClass(node, switchObj, consts.folder.CLOSE);
					view.replaceIcoClass(node, icoObj, consts.folder.CLOSE);
					if (animateFlag == false || setting.view.expandSpeed == "" || !(node[childKey] && node[childKey].length > 0)) {
						ulObj.hide();
						tools.apply(callback, []);
					} else {
						ulObj.slideUp(setting.view.expandSpeed, callback);
					}
				}
			} else {
				tools.apply(callback, []);
			}
		},
		expandCollapseParentNode: function(setting, node, expandFlag, animateFlag, callback) {
			if (!node) return;
			if (!node.parentTId) {
				view.expandCollapseNode(setting, node, expandFlag, animateFlag, callback);
				return;
			} else {
				view.expandCollapseNode(setting, node, expandFlag, animateFlag);
			}
			if (node.parentTId) {
				view.expandCollapseParentNode(setting, node.getParentNode(), expandFlag, animateFlag, callback);
			}
		},
		expandCollapseSonNode: function(setting, node, expandFlag, animateFlag, callback) {
			var root = data.getRoot(setting),
			childKey = setting.data.key.children,
			treeNodes = (node) ? node[childKey]: root[childKey],
			selfAnimateSign = (node) ? false : animateFlag,
			expandTriggerFlag = data.getRoot(setting).expandTriggerFlag;
			data.getRoot(setting).expandTriggerFlag = false;
			if (treeNodes) {
				for (var i = 0, l = treeNodes.length; i < l; i++) {
					if (treeNodes[i]) view.expandCollapseSonNode(setting, treeNodes[i], expandFlag, selfAnimateSign);
				}
			}
			data.getRoot(setting).expandTriggerFlag = expandTriggerFlag;
			view.expandCollapseNode(setting, node, expandFlag, animateFlag, callback );
		},
		isSelectedNode: function (setting, node) {
			if (!node) {
				return false;
			}
			var list = data.getRoot(setting).curSelectedList,
				i;
			for (i=list.length-1; i>=0; i--) {
				if (node === list[i]) {
					return true;
				}
			}
			return false;
		},
		makeDOMNodeIcon: function(html, setting, node) {
			var nameStr = data.getNodeName(setting, node),
			name = setting.view.nameIsHTML ? nameStr : nameStr.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
			html.push("<span id='", node.tId, consts.id.ICON,
				"' title='' treeNode", consts.id.ICON," class='", view.makeNodeIcoClass(setting, node),
				"' style='", view.makeNodeIcoStyle(setting, node), "'></span><span id='", node.tId, consts.id.SPAN,
				"' class='", consts.className.NAME,
				"'>",name,"</span>");
		},
		makeDOMNodeLine: function(html, setting, node) {
			html.push("<span id='", node.tId, consts.id.SWITCH,	"' title='' class='", view.makeNodeLineClass(setting, node), "' treeNode", consts.id.SWITCH,"></span>");
		},
		makeDOMNodeMainAfter: function(html, setting, node) {
			html.push("</li>");
		},
		makeDOMNodeMainBefore: function(html, setting, node) {
			html.push("<li id='", node.tId, "' class='", consts.className.LEVEL, node.level,"' tabindex='0' hidefocus='true' treenode>");
		},
		makeDOMNodeNameAfter: function(html, setting, node) {
			html.push("</a>");
		},
		makeDOMNodeNameBefore: function(html, setting, node) {
			var title = data.getNodeTitle(setting, node),
			url = view.makeNodeUrl(setting, node),
			fontcss = view.makeNodeFontCss(setting, node),
			fontStyle = [];
			for (var f in fontcss) {
				fontStyle.push(f, ":", fontcss[f], ";");
			}
			html.push("<a id='", node.tId, consts.id.A, "' class='", consts.className.LEVEL, node.level,"' treeNode", consts.id.A," onclick=\"", (node.click || ''),
				"\" ", ((url != null && url.length > 0) ? "href='" + url + "'" : ""), " target='",view.makeNodeTarget(node),"' style='", fontStyle.join(''),
				"'");
			if (tools.apply(setting.view.showTitle, [setting.treeId, node], setting.view.showTitle) && title) {html.push("title='", title.replace(/'/g,"&#39;").replace(/</g,'&lt;').replace(/>/g,'&gt;'),"'");}
			html.push(">");
		},
		makeNodeFontCss: function(setting, node) {
			var fontCss = tools.apply(setting.view.fontCss, [setting.treeId, node], setting.view.fontCss);
			return (fontCss && ((typeof fontCss) != "function")) ? fontCss : {};
		},
		makeNodeIcoClass: function(setting, node) {
			var icoCss = ["ico"];
			if (!node.isAjaxing) {
				icoCss[0] = (node.iconSkin ? node.iconSkin + "_" : "") + icoCss[0];
				if (node.isParent) {
					icoCss.push(node.open ? consts.folder.OPEN : consts.folder.CLOSE);
				} else {
					icoCss.push(consts.folder.DOCU);
				}
			}
			return consts.className.BUTTON + " " + icoCss.join('_');
		},
		makeNodeIcoStyle: function(setting, node) {
			var icoStyle = [];
			if (!node.isAjaxing) {
				var icon = (node.isParent && node.iconOpen && node.iconClose) ? (node.open ? node.iconOpen : node.iconClose) : node[setting.data.key.icon];
				if (icon) icoStyle.push("background:url(", icon, ") 0 0 no-repeat;");
				if (setting.view.showIcon == false || !tools.apply(setting.view.showIcon, [setting.treeId, node], true)) {
					icoStyle.push("width:0px;height:0px;");
				}
			}
			return icoStyle.join('');
		},
		makeNodeLineClass: function(setting, node) {
			var lineClass = [];
			if (setting.view.showLine) {
				if (node.level == 0 && node.isFirstNode && node.isLastNode) {
					lineClass.push(consts.line.ROOT);
				} else if (node.level == 0 && node.isFirstNode) {
					lineClass.push(consts.line.ROOTS);
				} else if (node.isLastNode) {
					lineClass.push(consts.line.BOTTOM);
				} else {
					lineClass.push(consts.line.CENTER);
				}
			} else {
				lineClass.push(consts.line.NOLINE);
			}
			if (node.isParent) {
				lineClass.push(node.open ? consts.folder.OPEN : consts.folder.CLOSE);
			} else {
				lineClass.push(consts.folder.DOCU);
			}
			return view.makeNodeLineClassEx(node) + lineClass.join('_');
		},
		makeNodeLineClassEx: function(node) {
			return consts.className.BUTTON + " " + consts.className.LEVEL + node.level + " " + consts.className.SWITCH + " ";
		},
		makeNodeTarget: function(node) {
			return (node.target || "_blank");
		},
		makeNodeUrl: function(setting, node) {
			var urlKey = setting.data.key.url;
			return node[urlKey] ? node[urlKey] : null;
		},
		makeUlHtml: function(setting, node, html, content) {
			html.push("<ul id='", node.tId, consts.id.UL, "' class='", consts.className.LEVEL, node.level, " ", view.makeUlLineClass(setting, node), "' style='display:", (node.open ? "block": "none"),"'>");
			html.push(content);
			html.push("</ul>");
		},
		makeUlLineClass: function(setting, node) {
			return ((setting.view.showLine && !node.isLastNode) ? consts.line.LINE : "");
		},
		removeChildNodes: function(setting, node) {
			if (!node) return;
			var childKey = setting.data.key.children,
			nodes = node[childKey];
			if (!nodes) return;

			for (var i = 0, l = nodes.length; i < l; i++) {
				data.removeNodeCache(setting, nodes[i]);
			}
			data.removeSelectedNode(setting);
			delete node[childKey];

			if (!setting.data.keep.parent) {
				node.isParent = false;
				node.open = false;
				var tmp_switchObj = $$(node, consts.id.SWITCH, setting),
				tmp_icoObj = $$(node, consts.id.ICON, setting);
				view.replaceSwitchClass(node, tmp_switchObj, consts.folder.DOCU);
				view.replaceIcoClass(node, tmp_icoObj, consts.folder.DOCU);
				$$(node, consts.id.UL, setting).remove();
			} else {
				$$(node, consts.id.UL, setting).empty();
			}
		},
		scrollIntoView: function(dom) {
			if (!dom) {
				return;
			}
			if (dom.scrollIntoViewIfNeeded) {
				dom.scrollIntoViewIfNeeded();
			} else if (dom.scrollIntoView) {
				dom.scrollIntoView(false);
			} else {
				try{dom.focus().blur();}catch(e){}
			}
		},
		setFirstNode: function(setting, parentNode) {
			var childKey = setting.data.key.children, childLength = parentNode[childKey].length;
			if ( childLength > 0) {
				parentNode[childKey][0].isFirstNode = true;
			}
		},
		setLastNode: function(setting, parentNode) {
			var childKey = setting.data.key.children, childLength = parentNode[childKey].length;
			if ( childLength > 0) {
				parentNode[childKey][childLength - 1].isLastNode = true;
			}
		},
		removeNode: function(setting, node) {
			var root = data.getRoot(setting),
			childKey = setting.data.key.children,
			parentNode = (node.parentTId) ? node.getParentNode() : root;

			node.isFirstNode = false;
			node.isLastNode = false;
			node.getPreNode = function() {return null;};
			node.getNextNode = function() {return null;};

			if (!data.getNodeCache(setting, node.tId)) {
				return;
			}

			$$(node, setting).remove();
			data.removeNodeCache(setting, node);
			data.removeSelectedNode(setting, node);

			for (var i = 0, l = parentNode[childKey].length; i < l; i++) {
				if (parentNode[childKey][i].tId == node.tId) {
					parentNode[childKey].splice(i, 1);
					break;
				}
			}
			view.setFirstNode(setting, parentNode);
			view.setLastNode(setting, parentNode);

			var tmp_ulObj,tmp_switchObj,tmp_icoObj,
			childLength = parentNode[childKey].length;

			//repair nodes old parent
			if (!setting.data.keep.parent && childLength == 0) {
				//old parentNode has no child nodes
				parentNode.isParent = false;
				parentNode.open = false;
				tmp_ulObj = $$(parentNode, consts.id.UL, setting);
				tmp_switchObj = $$(parentNode, consts.id.SWITCH, setting);
				tmp_icoObj = $$(parentNode, consts.id.ICON, setting);
				view.replaceSwitchClass(parentNode, tmp_switchObj, consts.folder.DOCU);
				view.replaceIcoClass(parentNode, tmp_icoObj, consts.folder.DOCU);
				tmp_ulObj.css("display", "none");

			} else if (setting.view.showLine && childLength > 0) {
				//old parentNode has child nodes
				var newLast = parentNode[childKey][childLength - 1];
				tmp_ulObj = $$(newLast, consts.id.UL, setting);
				tmp_switchObj = $$(newLast, consts.id.SWITCH, setting);
				tmp_icoObj = $$(newLast, consts.id.ICON, setting);
				if (parentNode == root) {
					if (parentNode[childKey].length == 1) {
						//node was root, and ztree has only one root after move node
						view.replaceSwitchClass(newLast, tmp_switchObj, consts.line.ROOT);
					} else {
						var tmp_first_switchObj = $$(parentNode[childKey][0], consts.id.SWITCH, setting);
						view.replaceSwitchClass(parentNode[childKey][0], tmp_first_switchObj, consts.line.ROOTS);
						view.replaceSwitchClass(newLast, tmp_switchObj, consts.line.BOTTOM);
					}
				} else {
					view.replaceSwitchClass(newLast, tmp_switchObj, consts.line.BOTTOM);
				}
				tmp_ulObj.removeClass(consts.line.LINE);
			}
		},
		replaceIcoClass: function(node, obj, newName) {
			if (!obj || node.isAjaxing) return;
			var tmpName = obj.attr("class");
			if (tmpName == undefined) return;
			var tmpList = tmpName.split("_");
			switch (newName) {
				case consts.folder.OPEN:
				case consts.folder.CLOSE:
				case consts.folder.DOCU:
					tmpList[tmpList.length-1] = newName;
					break;
			}
			obj.attr("class", tmpList.join("_"));
		},
		replaceSwitchClass: function(node, obj, newName) {
			if (!obj) return;
			var tmpName = obj.attr("class");
			if (tmpName == undefined) return;
			var tmpList = tmpName.split("_");
			switch (newName) {
				case consts.line.ROOT:
				case consts.line.ROOTS:
				case consts.line.CENTER:
				case consts.line.BOTTOM:
				case consts.line.NOLINE:
					tmpList[0] = view.makeNodeLineClassEx(node) + newName;
					break;
				case consts.folder.OPEN:
				case consts.folder.CLOSE:
				case consts.folder.DOCU:
					tmpList[1] = newName;
					break;
			}
			obj.attr("class", tmpList.join("_"));
			if (newName !== consts.folder.DOCU) {
				obj.removeAttr("disabled");
			} else {
				obj.attr("disabled", "disabled");
			}
		},
		selectNode: function(setting, node, addFlag) {
			if (!addFlag) {
				view.cancelPreSelectedNode(setting, null, node);
			}
			$$(node, consts.id.A, setting).addClass(consts.node.CURSELECTED);
			data.addSelectedNode(setting, node);
			setting.treeObj.trigger(consts.event.SELECTED, [setting.treeId, node]);
		},
		setNodeFontCss: function(setting, treeNode) {
			var aObj = $$(treeNode, consts.id.A, setting),
			fontCss = view.makeNodeFontCss(setting, treeNode);
			if (fontCss) {
				aObj.css(fontCss);
			}
		},
		setNodeLineIcos: function(setting, node) {
			if (!node) return;
			var switchObj = $$(node, consts.id.SWITCH, setting),
			ulObj = $$(node, consts.id.UL, setting),
			icoObj = $$(node, consts.id.ICON, setting),
			ulLine = view.makeUlLineClass(setting, node);
			if (ulLine.length==0) {
				ulObj.removeClass(consts.line.LINE);
			} else {
				ulObj.addClass(ulLine);
			}
			switchObj.attr("class", view.makeNodeLineClass(setting, node));
			if (node.isParent) {
				switchObj.removeAttr("disabled");
			} else {
				switchObj.attr("disabled", "disabled");
			}
			icoObj.removeAttr("style");
			icoObj.attr("style", view.makeNodeIcoStyle(setting, node));
			icoObj.attr("class", view.makeNodeIcoClass(setting, node));
		},
		setNodeName: function(setting, node) {
			var title = data.getNodeTitle(setting, node),
			nObj = $$(node, consts.id.SPAN, setting);
			nObj.empty();
			if (setting.view.nameIsHTML) {
				nObj.html(data.getNodeName(setting, node));
			} else {
				nObj.text(data.getNodeName(setting, node));
			}
			if (tools.apply(setting.view.showTitle, [setting.treeId, node], setting.view.showTitle)) {
				var aObj = $$(node, consts.id.A, setting);
				aObj.attr("title", !title ? "" : title);
			}
		},
		setNodeTarget: function(setting, node) {
			var aObj = $$(node, consts.id.A, setting);
			aObj.attr("target", view.makeNodeTarget(node));
		},
		setNodeUrl: function(setting, node) {
			var aObj = $$(node, consts.id.A, setting),
			url = view.makeNodeUrl(setting, node);
			if (url == null || url.length == 0) {
				aObj.removeAttr("href");
			} else {
				aObj.attr("href", url);
			}
		},
		switchNode: function(setting, node) {
			if (node.open || !tools.canAsync(setting, node)) {
				view.expandCollapseNode(setting, node, !node.open);
			} else if (setting.async.enable) {
				if (!view.asyncNode(setting, node)) {
					view.expandCollapseNode(setting, node, !node.open);
					return;
				}
			} else if (node) {
				view.expandCollapseNode(setting, node, !node.open);
			}
		}
	};
	// zTree defind
	$.fn.zTree = {
		consts : _consts,
		_z : {
			tools: tools,
			view: view,
			event: event,
			data: data
		},
		getZTreeObj: function(treeId) {
			var o = data.getZTreeTools(treeId);
			return o ? o : null;
		},
		destroy: function(treeId) {
			if (!!treeId && treeId.length > 0) {
				view.destroy(data.getSetting(treeId));
			} else {
				for(var s in settings) {
					view.destroy(settings[s]);
				}
			}
		},
		init: function(obj, zSetting, zNodes) {
			var setting = tools.clone(_setting);
			$.extend(true, setting, zSetting);
			setting.treeId = obj.attr("id");
			setting.treeObj = obj;
			setting.treeObj.empty();
			settings[setting.treeId] = setting;
			//For some older browser,(e.g., ie6)
			if(typeof document.body.style.maxHeight === "undefined") {
				setting.view.expandSpeed = "";
			}
			data.initRoot(setting);
			var root = data.getRoot(setting),
			childKey = setting.data.key.children;
			zNodes = zNodes ? tools.clone(tools.isArray(zNodes)? zNodes : [zNodes]) : [];
			if (setting.data.simpleData.enable) {
				root[childKey] = data.transformTozTreeFormat(setting, zNodes);
			} else {
				root[childKey] = zNodes;
			}

			data.initCache(setting);
			event.unbindTree(setting);
			event.bindTree(setting);
			event.unbindEvent(setting);
			event.bindEvent(setting);

			var zTreeTools = {
				setting : setting,
				addNodes : function(parentNode, index, newNodes, isSilent) {
					if (!parentNode) parentNode = null;
					if (parentNode && !parentNode.isParent && setting.data.keep.leaf) return null;

					var i = parseInt(index, 10);
					if (isNaN(i)) {
						isSilent = !!newNodes;
						newNodes = index;
						index = -1;
					} else {
						index = i;
					}
					if (!newNodes) return null;


					var xNewNodes = tools.clone(tools.isArray(newNodes)? newNodes: [newNodes]);
					function addCallback() {
						view.addNodes(setting, parentNode, index, xNewNodes, (isSilent==true));
					}

					if (tools.canAsync(setting, parentNode)) {
						view.asyncNode(setting, parentNode, isSilent, addCallback);
					} else {
						addCallback();
					}
					return xNewNodes;
				},
				cancelSelectedNode : function(node) {
					view.cancelPreSelectedNode(setting, node);
				},
				destroy : function() {
					view.destroy(setting);
				},
				expandAll : function(expandFlag) {
					expandFlag = !!expandFlag;
					view.expandCollapseSonNode(setting, null, expandFlag, true);
					return expandFlag;
				},
				expandNode : function(node, expandFlag, sonSign, focus, callbackFlag) {
					if (!node || !node.isParent) return null;
					if (expandFlag !== true && expandFlag !== false) {
						expandFlag = !node.open;
					}
					callbackFlag = !!callbackFlag;

					if (callbackFlag && expandFlag && (tools.apply(setting.callback.beforeExpand, [setting.treeId, node], true) == false)) {
						return null;
					} else if (callbackFlag && !expandFlag && (tools.apply(setting.callback.beforeCollapse, [setting.treeId, node], true) == false)) {
						return null;
					}
					if (expandFlag && node.parentTId) {
						view.expandCollapseParentNode(setting, node.getParentNode(), expandFlag, false);
					}
					if (expandFlag === node.open && !sonSign) {
						return null;
					}

					data.getRoot(setting).expandTriggerFlag = callbackFlag;
					if (!tools.canAsync(setting, node) && sonSign) {
						view.expandCollapseSonNode(setting, node, expandFlag, true, showNodeFocus);
					} else {
						node.open = !expandFlag;
						view.switchNode(this.setting, node);
						showNodeFocus();
					}
					return expandFlag;

					function showNodeFocus() {
						var a = $$(node, setting).get(0);
						if (a && focus !== false) {
							view.scrollIntoView(a);
						}
					}
				},
				getNodes : function() {
					return data.getNodes(setting);
				},
				getNodeByParam : function(key, value, parentNode) {
					if (!key) return null;
					return data.getNodeByParam(setting, parentNode?parentNode[setting.data.key.children]:data.getNodes(setting), key, value);
				},
				getNodeByTId : function(tId) {
					return data.getNodeCache(setting, tId);
				},
				getNodesByParam : function(key, value, parentNode) {
					if (!key) return null;
					return data.getNodesByParam(setting, parentNode?parentNode[setting.data.key.children]:data.getNodes(setting), key, value);
				},
				getNodesByParamFuzzy : function(key, value, parentNode) {
					if (!key) return null;
					return data.getNodesByParamFuzzy(setting, parentNode?parentNode[setting.data.key.children]:data.getNodes(setting), key, value);
				},
				getNodesByFilter: function(filter, isSingle, parentNode, invokeParam) {
					isSingle = !!isSingle;
					if (!filter || (typeof filter != "function")) return (isSingle ? null : []);
					return data.getNodesByFilter(setting, parentNode?parentNode[setting.data.key.children]:data.getNodes(setting), filter, isSingle, invokeParam);
				},
				getNodeIndex : function(node) {
					if (!node) return null;
					var childKey = setting.data.key.children,
					parentNode = (node.parentTId) ? node.getParentNode() : data.getRoot(setting);
					for (var i=0, l = parentNode[childKey].length; i < l; i++) {
						if (parentNode[childKey][i] == node) return i;
					}
					return -1;
				},
				getSelectedNodes : function() {
					var r = [], list = data.getRoot(setting).curSelectedList;
					for (var i=0, l=list.length; i<l; i++) {
						r.push(list[i]);
					}
					return r;
				},
				isSelectedNode : function(node) {
					return data.isSelectedNode(setting, node);
				},
				reAsyncChildNodes : function(parentNode, reloadType, isSilent) {
					if (!this.setting.async.enable) return;
					var isRoot = !parentNode;
					if (isRoot) {
						parentNode = data.getRoot(setting);
					}
					if (reloadType=="refresh") {
						var childKey = this.setting.data.key.children;
						for (var i = 0, l = parentNode[childKey] ? parentNode[childKey].length : 0; i < l; i++) {
							data.removeNodeCache(setting, parentNode[childKey][i]);
						}
						data.removeSelectedNode(setting);
						parentNode[childKey] = [];
						if (isRoot) {
							this.setting.treeObj.empty();
						} else {
							var ulObj = $$(parentNode, consts.id.UL, setting);
							ulObj.empty();
						}
					}
					view.asyncNode(this.setting, isRoot? null:parentNode, !!isSilent);
				},
				refresh : function() {
					this.setting.treeObj.empty();
					var root = data.getRoot(setting),
					nodes = root[setting.data.key.children]
					data.initRoot(setting);
					root[setting.data.key.children] = nodes
					data.initCache(setting);
					view.createNodes(setting, 0, root[setting.data.key.children], null, -1);
				},
				removeChildNodes : function(node) {
					if (!node) return null;
					var childKey = setting.data.key.children,
					nodes = node[childKey];
					view.removeChildNodes(setting, node);
					return nodes ? nodes : null;
				},
				removeNode : function(node, callbackFlag) {
					if (!node) return;
					callbackFlag = !!callbackFlag;
					if (callbackFlag && tools.apply(setting.callback.beforeRemove, [setting.treeId, node], true) == false) return;
					view.removeNode(setting, node);
					if (callbackFlag) {
						this.setting.treeObj.trigger(consts.event.REMOVE, [setting.treeId, node]);
					}
				},
				selectNode : function(node, addFlag, isSilent) {
					if (!node) return;
					if (tools.uCanDo(setting)) {
						addFlag = setting.view.selectedMulti && addFlag;
						if (node.parentTId) {
							view.expandCollapseParentNode(setting, node.getParentNode(), true, false, showNodeFocus);
						} else {
							try{$$(node, setting).focus().blur();}catch(e){}
						}
						view.selectNode(setting, node, addFlag);
					}

					function showNodeFocus() {
						if (isSilent) {
							return;
						}
						var a = $$(node, setting).get(0);
						view.scrollIntoView(a);
					}
				},
				transformTozTreeNodes : function(simpleNodes) {
					return data.transformTozTreeFormat(setting, simpleNodes);
				},
				transformToArray : function(nodes) {
					return data.transformToArrayFormat(setting, nodes);
				},
				updateNode : function(node, checkTypeFlag) {
					if (!node) return;
					var nObj = $$(node, setting);
					if (nObj.get(0) && tools.uCanDo(setting)) {
						view.setNodeName(setting, node);
						view.setNodeTarget(setting, node);
						view.setNodeUrl(setting, node);
						view.setNodeLineIcos(setting, node);
						view.setNodeFontCss(setting, node);
					}
				}
			}
			root.treeTools = zTreeTools;
			data.setZTreeTools(setting, zTreeTools);

			if (root[childKey] && root[childKey].length > 0) {
				view.createNodes(setting, 0, root[childKey], null, -1);
			} else if (setting.async.enable && setting.async.url && setting.async.url !== '') {
				view.asyncNode(setting);
			}
			return zTreeTools;
		}
	};

	var zt = $.fn.zTree,
	$$ = tools.$,
	consts = zt.consts;
})(jQuery);
/*
 * JQuery zTree excheck v3.5.23
 * http://zTree.me/
 *
 * Copyright (c) 2010 Hunter.z
 *
 * Licensed same as jquery - MIT License
 * http://www.opensource.org/licenses/mit-license.php
 *
 * email: hunter.z@263.net
 * Date: 2016-04-01
 */
(function($){
	//default consts of excheck
	var _consts = {
		event: {
			CHECK: "ztree_check"
		},
		id: {
			CHECK: "_check"
		},
		checkbox: {
			STYLE: "checkbox",
			DEFAULT: "chk",
			DISABLED: "disable",
			FALSE: "false",
			TRUE: "true",
			FULL: "full",
			PART: "part",
			FOCUS: "focus"
		},
		radio: {
			STYLE: "radio",
			TYPE_ALL: "all",
			TYPE_LEVEL: "level"
		}
	},
	//default setting of excheck
	_setting = {
		check: {
			enable: false,
			autoCheckTrigger: false,
			chkStyle: _consts.checkbox.STYLE,
			nocheckInherit: false,
			chkDisabledInherit: false,
			radioType: _consts.radio.TYPE_LEVEL,
			chkboxType: {
				"Y": "ps",
				"N": "ps"
			}
		},
		data: {
			key: {
				checked: "checked"
			}
		},
		callback: {
			beforeCheck:null,
			onCheck:null
		}
	},
	//default root of excheck
	_initRoot = function (setting) {
		var r = data.getRoot(setting);
		r.radioCheckedList = [];
	},
	//default cache of excheck
	_initCache = function(treeId) {},
	//default bind event of excheck
	_bindEvent = function(setting) {
		var o = setting.treeObj,
		c = consts.event;
		o.bind(c.CHECK, function (event, srcEvent, treeId, node) {
			event.srcEvent = srcEvent;
			tools.apply(setting.callback.onCheck, [event, treeId, node]);
		});
	},
	_unbindEvent = function(setting) {
		var o = setting.treeObj,
		c = consts.event;
		o.unbind(c.CHECK);
	},
	//default event proxy of excheck
	_eventProxy = function(e) {
		var target = e.target,
		setting = data.getSetting(e.data.treeId),
		tId = "", node = null,
		nodeEventType = "", treeEventType = "",
		nodeEventCallback = null, treeEventCallback = null;

		if (tools.eqs(e.type, "mouseover")) {
			if (setting.check.enable && tools.eqs(target.tagName, "span") && target.getAttribute("treeNode"+ consts.id.CHECK) !== null) {
				tId = tools.getNodeMainDom(target).id;
				nodeEventType = "mouseoverCheck";
			}
		} else if (tools.eqs(e.type, "mouseout")) {
			if (setting.check.enable && tools.eqs(target.tagName, "span") && target.getAttribute("treeNode"+ consts.id.CHECK) !== null) {
				tId = tools.getNodeMainDom(target).id;
				nodeEventType = "mouseoutCheck";
			}
		} else if (tools.eqs(e.type, "click")) {
			if (setting.check.enable && tools.eqs(target.tagName, "span") && target.getAttribute("treeNode"+ consts.id.CHECK) !== null) {
				tId = tools.getNodeMainDom(target).id;
				nodeEventType = "checkNode";
			}
		}
		if (tId.length>0) {
			node = data.getNodeCache(setting, tId);
			switch (nodeEventType) {
				case "checkNode" :
					nodeEventCallback = _handler.onCheckNode;
					break;
				case "mouseoverCheck" :
					nodeEventCallback = _handler.onMouseoverCheck;
					break;
				case "mouseoutCheck" :
					nodeEventCallback = _handler.onMouseoutCheck;
					break;
			}
		}
		var proxyResult = {
			stop: nodeEventType === "checkNode",
			node: node,
			nodeEventType: nodeEventType,
			nodeEventCallback: nodeEventCallback,
			treeEventType: treeEventType,
			treeEventCallback: treeEventCallback
		};
		return proxyResult
	},
	//default init node of excheck
	_initNode = function(setting, level, n, parentNode, isFirstNode, isLastNode, openFlag) {
		if (!n) return;
		var checkedKey = setting.data.key.checked;
		if (typeof n[checkedKey] == "string") n[checkedKey] = tools.eqs(n[checkedKey], "true");
		n[checkedKey] = !!n[checkedKey];
		n.checkedOld = n[checkedKey];
		if (typeof n.nocheck == "string") n.nocheck = tools.eqs(n.nocheck, "true");
		n.nocheck = !!n.nocheck || (setting.check.nocheckInherit && parentNode && !!parentNode.nocheck);
		if (typeof n.chkDisabled == "string") n.chkDisabled = tools.eqs(n.chkDisabled, "true");
		n.chkDisabled = !!n.chkDisabled || (setting.check.chkDisabledInherit && parentNode && !!parentNode.chkDisabled);
		if (typeof n.halfCheck == "string") n.halfCheck = tools.eqs(n.halfCheck, "true");
		n.halfCheck = !!n.halfCheck;
		n.check_Child_State = -1;
		n.check_Focus = false;
		n.getCheckStatus = function() {return data.getCheckStatus(setting, n);};

		if (setting.check.chkStyle == consts.radio.STYLE && setting.check.radioType == consts.radio.TYPE_ALL && n[checkedKey] ) {
			var r = data.getRoot(setting);
			r.radioCheckedList.push(n);
		}
	},
	//add dom for check
	_beforeA = function(setting, node, html) {
		var checkedKey = setting.data.key.checked;
		if (setting.check.enable) {
			data.makeChkFlag(setting, node);
			html.push("<span ID='", node.tId, consts.id.CHECK, "' class='", view.makeChkClass(setting, node), "' treeNode", consts.id.CHECK, (node.nocheck === true?" style='display:none;'":""),"></span>");
		}
	},
	//update zTreeObj, add method of check
	_zTreeTools = function(setting, zTreeTools) {
		zTreeTools.checkNode = function(node, checked, checkTypeFlag, callbackFlag) {
			var checkedKey = this.setting.data.key.checked;
			if (node.chkDisabled === true) return;
			if (checked !== true && checked !== false) {
				checked = !node[checkedKey];
			}
			callbackFlag = !!callbackFlag;

			if (node[checkedKey] === checked && !checkTypeFlag) {
				return;
			} else if (callbackFlag && tools.apply(this.setting.callback.beforeCheck, [this.setting.treeId, node], true) == false) {
				return;
			}
			if (tools.uCanDo(this.setting) && this.setting.check.enable && node.nocheck !== true) {
				node[checkedKey] = checked;
				var checkObj = $$(node, consts.id.CHECK, this.setting);
				if (checkTypeFlag || this.setting.check.chkStyle === consts.radio.STYLE) view.checkNodeRelation(this.setting, node);
				view.setChkClass(this.setting, checkObj, node);
				view.repairParentChkClassWithSelf(this.setting, node);
				if (callbackFlag) {
					this.setting.treeObj.trigger(consts.event.CHECK, [null, this.setting.treeId, node]);
				}
			}
		}

		zTreeTools.checkAllNodes = function(checked) {
			view.repairAllChk(this.setting, !!checked);
		}

		zTreeTools.getCheckedNodes = function(checked) {
			var childKey = this.setting.data.key.children;
			checked = (checked !== false);
			return data.getTreeCheckedNodes(this.setting, data.getRoot(this.setting)[childKey], checked);
		}

		zTreeTools.getChangeCheckedNodes = function() {
			var childKey = this.setting.data.key.children;
			return data.getTreeChangeCheckedNodes(this.setting, data.getRoot(this.setting)[childKey]);
		}

		zTreeTools.setChkDisabled = function(node, disabled, inheritParent, inheritChildren) {
			disabled = !!disabled;
			inheritParent = !!inheritParent;
			inheritChildren = !!inheritChildren;
			view.repairSonChkDisabled(this.setting, node, disabled, inheritChildren);
			view.repairParentChkDisabled(this.setting, node.getParentNode(), disabled, inheritParent);
		}

		var _updateNode = zTreeTools.updateNode;
		zTreeTools.updateNode = function(node, checkTypeFlag) {
			if (_updateNode) _updateNode.apply(zTreeTools, arguments);
			if (!node || !this.setting.check.enable) return;
			var nObj = $$(node, this.setting);
			if (nObj.get(0) && tools.uCanDo(this.setting)) {
				var checkObj = $$(node, consts.id.CHECK, this.setting);
				if (checkTypeFlag == true || this.setting.check.chkStyle === consts.radio.STYLE) view.checkNodeRelation(this.setting, node);
				view.setChkClass(this.setting, checkObj, node);
				view.repairParentChkClassWithSelf(this.setting, node);
			}
		}
	},
	//method of operate data
	_data = {
		getRadioCheckedList: function(setting) {
			var checkedList = data.getRoot(setting).radioCheckedList;
			for (var i=0, j=checkedList.length; i<j; i++) {
				if(!data.getNodeCache(setting, checkedList[i].tId)) {
					checkedList.splice(i, 1);
					i--; j--;
				}
			}
			return checkedList;
		},
		getCheckStatus: function(setting, node) {
			if (!setting.check.enable || node.nocheck || node.chkDisabled) return null;
			var checkedKey = setting.data.key.checked,
			r = {
				checked: node[checkedKey],
				half: node.halfCheck ? node.halfCheck : (setting.check.chkStyle == consts.radio.STYLE ? (node.check_Child_State === 2) : (node[checkedKey] ? (node.check_Child_State > -1 && node.check_Child_State < 2) : (node.check_Child_State > 0)))
			};
			return r;
		},
		getTreeCheckedNodes: function(setting, nodes, checked, results) {
			if (!nodes) return [];
			var childKey = setting.data.key.children,
			checkedKey = setting.data.key.checked,
			onlyOne = (checked && setting.check.chkStyle == consts.radio.STYLE && setting.check.radioType == consts.radio.TYPE_ALL);
			results = !results ? [] : results;
			for (var i = 0, l = nodes.length; i < l; i++) {
				if (nodes[i].nocheck !== true && nodes[i].chkDisabled !== true && nodes[i][checkedKey] == checked) {
					results.push(nodes[i]);
					if(onlyOne) {
						break;
					}
				}
				data.getTreeCheckedNodes(setting, nodes[i][childKey], checked, results);
				if(onlyOne && results.length > 0) {
					break;
				}
			}
			return results;
		},
		getTreeChangeCheckedNodes: function(setting, nodes, results) {
			if (!nodes) return [];
			var childKey = setting.data.key.children,
			checkedKey = setting.data.key.checked;
			results = !results ? [] : results;
			for (var i = 0, l = nodes.length; i < l; i++) {
				if (nodes[i].nocheck !== true && nodes[i].chkDisabled !== true && nodes[i][checkedKey] != nodes[i].checkedOld) {
					results.push(nodes[i]);
				}
				data.getTreeChangeCheckedNodes(setting, nodes[i][childKey], results);
			}
			return results;
		},
		makeChkFlag: function(setting, node) {
			if (!node) return;
			var childKey = setting.data.key.children,
			checkedKey = setting.data.key.checked,
			chkFlag = -1;
			if (node[childKey]) {
				for (var i = 0, l = node[childKey].length; i < l; i++) {
					var cNode = node[childKey][i];
					var tmp = -1;
					if (setting.check.chkStyle == consts.radio.STYLE) {
						if (cNode.nocheck === true || cNode.chkDisabled === true) {
							tmp = cNode.check_Child_State;
						} else if (cNode.halfCheck === true) {
							tmp = 2;
						} else if (cNode[checkedKey]) {
							tmp = 2;
						} else {
							tmp = cNode.check_Child_State > 0 ? 2:0;
						}
						if (tmp == 2) {
							chkFlag = 2; break;
						} else if (tmp == 0){
							chkFlag = 0;
						}
					} else if (setting.check.chkStyle == consts.checkbox.STYLE) {
						if (cNode.nocheck === true || cNode.chkDisabled === true) {
							tmp = cNode.check_Child_State;
						} else if (cNode.halfCheck === true) {
							tmp = 1;
						} else if (cNode[checkedKey] ) {
							tmp = (cNode.check_Child_State === -1 || cNode.check_Child_State === 2) ? 2 : 1;
						} else {
							tmp = (cNode.check_Child_State > 0) ? 1 : 0;
						}
						if (tmp === 1) {
							chkFlag = 1; break;
						} else if (tmp === 2 && chkFlag > -1 && i > 0 && tmp !== chkFlag) {
							chkFlag = 1; break;
						} else if (chkFlag === 2 && tmp > -1 && tmp < 2) {
							chkFlag = 1; break;
						} else if (tmp > -1) {
							chkFlag = tmp;
						}
					}
				}
			}
			node.check_Child_State = chkFlag;
		}
	},
	//method of event proxy
	_event = {

	},
	//method of event handler
	_handler = {
		onCheckNode: function (event, node) {
			if (node.chkDisabled === true) return false;
			var setting = data.getSetting(event.data.treeId),
			checkedKey = setting.data.key.checked;
			if (tools.apply(setting.callback.beforeCheck, [setting.treeId, node], true) == false) return true;
			node[checkedKey] = !node[checkedKey];
			view.checkNodeRelation(setting, node);
			var checkObj = $$(node, consts.id.CHECK, setting);
			view.setChkClass(setting, checkObj, node);
			view.repairParentChkClassWithSelf(setting, node);
			setting.treeObj.trigger(consts.event.CHECK, [event, setting.treeId, node]);
			return true;
		},
		onMouseoverCheck: function(event, node) {
			if (node.chkDisabled === true) return false;
			var setting = data.getSetting(event.data.treeId),
			checkObj = $$(node, consts.id.CHECK, setting);
			node.check_Focus = true;
			view.setChkClass(setting, checkObj, node);
			return true;
		},
		onMouseoutCheck: function(event, node) {
			if (node.chkDisabled === true) return false;
			var setting = data.getSetting(event.data.treeId),
			checkObj = $$(node, consts.id.CHECK, setting);
			node.check_Focus = false;
			view.setChkClass(setting, checkObj, node);
			return true;
		}
	},
	//method of tools for zTree
	_tools = {

	},
	//method of operate ztree dom
	_view = {
		checkNodeRelation: function(setting, node) {
			var pNode, i, l,
			childKey = setting.data.key.children,
			checkedKey = setting.data.key.checked,
			r = consts.radio;
			if (setting.check.chkStyle == r.STYLE) {
				var checkedList = data.getRadioCheckedList(setting);
				if (node[checkedKey]) {
					if (setting.check.radioType == r.TYPE_ALL) {
						for (i = checkedList.length-1; i >= 0; i--) {
							pNode = checkedList[i];
							if (pNode[checkedKey] && pNode != node) {
								pNode[checkedKey] = false;
								checkedList.splice(i, 1);

								view.setChkClass(setting, $$(pNode, consts.id.CHECK, setting), pNode);
								if (pNode.parentTId != node.parentTId) {
									view.repairParentChkClassWithSelf(setting, pNode);
								}
							}
						}
						checkedList.push(node);
					} else {
						var parentNode = (node.parentTId) ? node.getParentNode() : data.getRoot(setting);
						for (i = 0, l = parentNode[childKey].length; i < l; i++) {
							pNode = parentNode[childKey][i];
							if (pNode[checkedKey] && pNode != node) {
								pNode[checkedKey] = false;
								view.setChkClass(setting, $$(pNode, consts.id.CHECK, setting), pNode);
							}
						}
					}
				} else if (setting.check.radioType == r.TYPE_ALL) {
					for (i = 0, l = checkedList.length; i < l; i++) {
						if (node == checkedList[i]) {
							checkedList.splice(i, 1);
							break;
						}
					}
				}

			} else {
				if (node[checkedKey] && (!node[childKey] || node[childKey].length==0 || setting.check.chkboxType.Y.indexOf("s") > -1)) {
					view.setSonNodeCheckBox(setting, node, true);
				}
				if (!node[checkedKey] && (!node[childKey] || node[childKey].length==0 || setting.check.chkboxType.N.indexOf("s") > -1)) {
					view.setSonNodeCheckBox(setting, node, false);
				}
				if (node[checkedKey] && setting.check.chkboxType.Y.indexOf("p") > -1) {
					view.setParentNodeCheckBox(setting, node, true);
				}
				if (!node[checkedKey] && setting.check.chkboxType.N.indexOf("p") > -1) {
					view.setParentNodeCheckBox(setting, node, false);
				}
			}
		},
		makeChkClass: function(setting, node) {
			var checkedKey = setting.data.key.checked,
			c = consts.checkbox, r = consts.radio,
			fullStyle = "";
			if (node.chkDisabled === true) {
				fullStyle = c.DISABLED;
			} else if (node.halfCheck) {
				fullStyle = c.PART;
			} else if (setting.check.chkStyle == r.STYLE) {
				fullStyle = (node.check_Child_State < 1)? c.FULL:c.PART;
			} else {
				fullStyle = node[checkedKey] ? ((node.check_Child_State === 2 || node.check_Child_State === -1) ? c.FULL:c.PART) : ((node.check_Child_State < 1)? c.FULL:c.PART);
			}
			var chkName = setting.check.chkStyle + "_" + (node[checkedKey] ? c.TRUE : c.FALSE) + "_" + fullStyle;
			chkName = (node.check_Focus && node.chkDisabled !== true) ? chkName + "_" + c.FOCUS : chkName;
			return consts.className.BUTTON + " " + c.DEFAULT + " " + chkName;
		},
		repairAllChk: function(setting, checked) {
			if (setting.check.enable && setting.check.chkStyle === consts.checkbox.STYLE) {
				var checkedKey = setting.data.key.checked,
				childKey = setting.data.key.children,
				root = data.getRoot(setting);
				for (var i = 0, l = root[childKey].length; i<l ; i++) {
					var node = root[childKey][i];
					if (node.nocheck !== true && node.chkDisabled !== true) {
						node[checkedKey] = checked;
					}
					view.setSonNodeCheckBox(setting, node, checked);
				}
			}
		},
		repairChkClass: function(setting, node) {
			if (!node) return;
			data.makeChkFlag(setting, node);
			if (node.nocheck !== true) {
				var checkObj = $$(node, consts.id.CHECK, setting);
				view.setChkClass(setting, checkObj, node);
			}
		},
		repairParentChkClass: function(setting, node) {
			if (!node || !node.parentTId) return;
			var pNode = node.getParentNode();
			view.repairChkClass(setting, pNode);
			view.repairParentChkClass(setting, pNode);
		},
		repairParentChkClassWithSelf: function(setting, node) {
			if (!node) return;
			var childKey = setting.data.key.children;
			if (node[childKey] && node[childKey].length > 0) {
				view.repairParentChkClass(setting, node[childKey][0]);
			} else {
				view.repairParentChkClass(setting, node);
			}
		},
		repairSonChkDisabled: function(setting, node, chkDisabled, inherit) {
			if (!node) return;
			var childKey = setting.data.key.children;
			if (node.chkDisabled != chkDisabled) {
				node.chkDisabled = chkDisabled;
			}
			view.repairChkClass(setting, node);
			if (node[childKey] && inherit) {
				for (var i = 0, l = node[childKey].length; i < l; i++) {
					var sNode = node[childKey][i];
					view.repairSonChkDisabled(setting, sNode, chkDisabled, inherit);
				}
			}
		},
		repairParentChkDisabled: function(setting, node, chkDisabled, inherit) {
			if (!node) return;
			if (node.chkDisabled != chkDisabled && inherit) {
				node.chkDisabled = chkDisabled;
			}
			view.repairChkClass(setting, node);
			view.repairParentChkDisabled(setting, node.getParentNode(), chkDisabled, inherit);
		},
		setChkClass: function(setting, obj, node) {
			if (!obj) return;
			if (node.nocheck === true) {
				obj.hide();
			} else {
				obj.show();
			}
            obj.attr('class', view.makeChkClass(setting, node));
		},
		setParentNodeCheckBox: function(setting, node, value, srcNode) {
			var childKey = setting.data.key.children,
			checkedKey = setting.data.key.checked,
			checkObj = $$(node, consts.id.CHECK, setting);
			if (!srcNode) srcNode = node;
			data.makeChkFlag(setting, node);
			if (node.nocheck !== true && node.chkDisabled !== true) {
				node[checkedKey] = value;
				view.setChkClass(setting, checkObj, node);
				if (setting.check.autoCheckTrigger && node != srcNode) {
					setting.treeObj.trigger(consts.event.CHECK, [null, setting.treeId, node]);
				}
			}
			if (node.parentTId) {
				var pSign = true;
				if (!value) {
					var pNodes = node.getParentNode()[childKey];
					for (var i = 0, l = pNodes.length; i < l; i++) {
						if ((pNodes[i].nocheck !== true && pNodes[i].chkDisabled !== true && pNodes[i][checkedKey])
						|| ((pNodes[i].nocheck === true || pNodes[i].chkDisabled === true) && pNodes[i].check_Child_State > 0)) {
							pSign = false;
							break;
						}
					}
				}
				if (pSign) {
					view.setParentNodeCheckBox(setting, node.getParentNode(), value, srcNode);
				}
			}
		},
		setSonNodeCheckBox: function(setting, node, value, srcNode) {
			if (!node) return;
			var childKey = setting.data.key.children,
			checkedKey = setting.data.key.checked,
			checkObj = $$(node, consts.id.CHECK, setting);
			if (!srcNode) srcNode = node;

			var hasDisable = false;
			if (node[childKey]) {
				for (var i = 0, l = node[childKey].length; i < l; i++) {
					var sNode = node[childKey][i];
					view.setSonNodeCheckBox(setting, sNode, value, srcNode);
					if (sNode.chkDisabled === true) hasDisable = true;
				}
			}

			if (node != data.getRoot(setting) && node.chkDisabled !== true) {
				if (hasDisable && node.nocheck !== true) {
					data.makeChkFlag(setting, node);
				}
				if (node.nocheck !== true && node.chkDisabled !== true) {
					node[checkedKey] = value;
					if (!hasDisable) node.check_Child_State = (node[childKey] && node[childKey].length > 0) ? (value ? 2 : 0) : -1;
				} else {
					node.check_Child_State = -1;
				}
				view.setChkClass(setting, checkObj, node);
				if (setting.check.autoCheckTrigger && node != srcNode && node.nocheck !== true && node.chkDisabled !== true) {
					setting.treeObj.trigger(consts.event.CHECK, [null, setting.treeId, node]);
				}
			}

		}
	},

	_z = {
		tools: _tools,
		view: _view,
		event: _event,
		data: _data
	};
	$.extend(true, $.fn.zTree.consts, _consts);
	$.extend(true, $.fn.zTree._z, _z);

	var zt = $.fn.zTree,
	tools = zt._z.tools,
	consts = zt.consts,
	view = zt._z.view,
	data = zt._z.data,
	event = zt._z.event,
	$$ = tools.$;

	data.exSetting(_setting);
	data.addInitBind(_bindEvent);
	data.addInitUnBind(_unbindEvent);
	data.addInitCache(_initCache);
	data.addInitNode(_initNode);
	data.addInitProxy(_eventProxy, true);
	data.addInitRoot(_initRoot);
	data.addBeforeA(_beforeA);
	data.addZTreeTools(_zTreeTools);

	var _createNodes = view.createNodes;
	view.createNodes = function(setting, level, nodes, parentNode, index) {
		if (_createNodes) _createNodes.apply(view, arguments);
		if (!nodes) return;
		view.repairParentChkClassWithSelf(setting, parentNode);
	}
	var _removeNode = view.removeNode;
	view.removeNode = function(setting, node) {
		var parentNode = node.getParentNode();
		if (_removeNode) _removeNode.apply(view, arguments);
		if (!node || !parentNode) return;
		view.repairChkClass(setting, parentNode);
		view.repairParentChkClass(setting, parentNode);
	}

	var _appendNodes = view.appendNodes;
	view.appendNodes = function(setting, level, nodes, parentNode, index, initFlag, openFlag) {
		var html = "";
		if (_appendNodes) {
			html = _appendNodes.apply(view, arguments);
		}
		if (parentNode) {
			data.makeChkFlag(setting, parentNode);
		}
		return html;
	}
})(jQuery);
/*
 * JQuery zTree exedit v3.5.23
 * http://zTree.me/
 *
 * Copyright (c) 2010 Hunter.z
 *
 * Licensed same as jquery - MIT License
 * http://www.opensource.org/licenses/mit-license.php
 *
 * email: hunter.z@263.net
 * Date: 2016-04-01
 */
(function($){
	//default consts of exedit
	var _consts = {
		event: {
			DRAG: "ztree_drag",
			DROP: "ztree_drop",
			RENAME: "ztree_rename",
			DRAGMOVE:"ztree_dragmove"
		},
		id: {
			EDIT: "_edit",
			INPUT: "_input",
			REMOVE: "_remove"
		},
		move: {
			TYPE_INNER: "inner",
			TYPE_PREV: "prev",
			TYPE_NEXT: "next"
		},
		node: {
			CURSELECTED_EDIT: "curSelectedNode_Edit",
			TMPTARGET_TREE: "tmpTargetzTree",
			TMPTARGET_NODE: "tmpTargetNode"
		}
	},
	//default setting of exedit
	_setting = {
		edit: {
			enable: false,
			editNameSelectAll: false,
			showRemoveBtn: true,
			showRenameBtn: true,
			removeTitle: "remove",
			renameTitle: "rename",
			drag: {
				autoExpandTrigger: false,
				isCopy: true,
				isMove: true,
				prev: true,
				next: true,
				inner: true,
				minMoveSize: 5,
				borderMax: 10,
				borderMin: -5,
				maxShowNodeNum: 5,
				autoOpenTime: 500
			}
		},
		view: {
			addHoverDom: null,
			removeHoverDom: null
		},
		callback: {
			beforeDrag:null,
			beforeDragOpen:null,
			beforeDrop:null,
			beforeEditName:null,
			beforeRename:null,
			onDrag:null,
			onDragMove:null,
			onDrop:null,
			onRename:null
		}
	},
	//default root of exedit
	_initRoot = function (setting) {
		var r = data.getRoot(setting), rs = data.getRoots();
		r.curEditNode = null;
		r.curEditInput = null;
		r.curHoverNode = null;
		r.dragFlag = 0;
		r.dragNodeShowBefore = [];
		r.dragMaskList = new Array();
		rs.showHoverDom = true;
	},
	//default cache of exedit
	_initCache = function(treeId) {},
	//default bind event of exedit
	_bindEvent = function(setting) {
		var o = setting.treeObj;
		var c = consts.event;
		o.bind(c.RENAME, function (event, treeId, treeNode, isCancel) {
			tools.apply(setting.callback.onRename, [event, treeId, treeNode, isCancel]);
		});

		o.bind(c.DRAG, function (event, srcEvent, treeId, treeNodes) {
			tools.apply(setting.callback.onDrag, [srcEvent, treeId, treeNodes]);
		});

		o.bind(c.DRAGMOVE,function(event, srcEvent, treeId, treeNodes){
			tools.apply(setting.callback.onDragMove,[srcEvent, treeId, treeNodes]);
		});

		o.bind(c.DROP, function (event, srcEvent, treeId, treeNodes, targetNode, moveType, isCopy) {
			tools.apply(setting.callback.onDrop, [srcEvent, treeId, treeNodes, targetNode, moveType, isCopy]);
		});
	},
	_unbindEvent = function(setting) {
		var o = setting.treeObj;
		var c = consts.event;
		o.unbind(c.RENAME);
		o.unbind(c.DRAG);
		o.unbind(c.DRAGMOVE);
		o.unbind(c.DROP);
	},
	//default event proxy of exedit
	_eventProxy = function(e) {
		var target = e.target,
		setting = data.getSetting(e.data.treeId),
		relatedTarget = e.relatedTarget,
		tId = "", node = null,
		nodeEventType = "", treeEventType = "",
		nodeEventCallback = null, treeEventCallback = null,
		tmp = null;

		if (tools.eqs(e.type, "mouseover")) {
			tmp = tools.getMDom(setting, target, [{tagName:"a", attrName:"treeNode"+consts.id.A}]);
			if (tmp) {
				tId = tools.getNodeMainDom(tmp).id;
				nodeEventType = "hoverOverNode";
			}
		} else if (tools.eqs(e.type, "mouseout")) {
			tmp = tools.getMDom(setting, relatedTarget, [{tagName:"a", attrName:"treeNode"+consts.id.A}]);
			if (!tmp) {
				tId = "remove";
				nodeEventType = "hoverOutNode";
			}
		} else if (tools.eqs(e.type, "mousedown")) {
			tmp = tools.getMDom(setting, target, [{tagName:"a", attrName:"treeNode"+consts.id.A}]);
			if (tmp) {
				tId = tools.getNodeMainDom(tmp).id;
				nodeEventType = "mousedownNode";
			}
		}
		if (tId.length>0) {
			node = data.getNodeCache(setting, tId);
			switch (nodeEventType) {
				case "mousedownNode" :
					nodeEventCallback = _handler.onMousedownNode;
					break;
				case "hoverOverNode" :
					nodeEventCallback = _handler.onHoverOverNode;
					break;
				case "hoverOutNode" :
					nodeEventCallback = _handler.onHoverOutNode;
					break;
			}
		}
		var proxyResult = {
			stop: false,
			node: node,
			nodeEventType: nodeEventType,
			nodeEventCallback: nodeEventCallback,
			treeEventType: treeEventType,
			treeEventCallback: treeEventCallback
		};
		return proxyResult
	},
	//default init node of exedit
	_initNode = function(setting, level, n, parentNode, isFirstNode, isLastNode, openFlag) {
		if (!n) return;
		n.isHover = false;
		n.editNameFlag = false;
	},
	//update zTreeObj, add method of edit
	_zTreeTools = function(setting, zTreeTools) {
		zTreeTools.cancelEditName = function(newName) {
			var root = data.getRoot(this.setting);
			if (!root.curEditNode) return;
			view.cancelCurEditNode(this.setting, newName?newName:null, true);
		}
		zTreeTools.copyNode = function(targetNode, node, moveType, isSilent) {
			if (!node) return null;
			if (targetNode && !targetNode.isParent && this.setting.data.keep.leaf && moveType === consts.move.TYPE_INNER) return null;
			var _this = this,
				newNode = tools.clone(node);
			if (!targetNode) {
				targetNode = null;
				moveType = consts.move.TYPE_INNER;
			}
			if (moveType == consts.move.TYPE_INNER) {
				function copyCallback() {
					view.addNodes(_this.setting, targetNode, -1, [newNode], isSilent);
				}

				if (tools.canAsync(this.setting, targetNode)) {
					view.asyncNode(this.setting, targetNode, isSilent, copyCallback);
				} else {
					copyCallback();
				}
			} else {
				view.addNodes(this.setting, targetNode.parentNode, -1, [newNode], isSilent);
				view.moveNode(this.setting, targetNode, newNode, moveType, false, isSilent);
			}
			return newNode;
		}
		zTreeTools.editName = function(node) {
			if (!node || !node.tId || node !== data.getNodeCache(this.setting, node.tId)) return;
			if (node.parentTId) view.expandCollapseParentNode(this.setting, node.getParentNode(), true);
			view.editNode(this.setting, node)
		}
		zTreeTools.moveNode = function(targetNode, node, moveType, isSilent) {
			if (!node) return node;
			if (targetNode && !targetNode.isParent && this.setting.data.keep.leaf && moveType === consts.move.TYPE_INNER) {
				return null;
			} else if (targetNode && ((node.parentTId == targetNode.tId && moveType == consts.move.TYPE_INNER) || $$(node, this.setting).find("#" + targetNode.tId).length > 0)) {
				return null;
			} else if (!targetNode) {
				targetNode = null;
			}
			var _this = this;
			function moveCallback() {
				view.moveNode(_this.setting, targetNode, node, moveType, false, isSilent);
			}
			if (tools.canAsync(this.setting, targetNode) && moveType === consts.move.TYPE_INNER) {
				view.asyncNode(this.setting, targetNode, isSilent, moveCallback);
			} else {
				moveCallback();
			}
			return node;
		}
		zTreeTools.setEditable = function(editable) {
			this.setting.edit.enable = editable;
			return this.refresh();
		}
	},
	//method of operate data
	_data = {
		setSonNodeLevel: function(setting, parentNode, node) {
			if (!node) return;
			var childKey = setting.data.key.children;
			node.level = (parentNode)? parentNode.level + 1 : 0;
			if (!node[childKey]) return;
			for (var i = 0, l = node[childKey].length; i < l; i++) {
				if (node[childKey][i]) data.setSonNodeLevel(setting, node, node[childKey][i]);
			}
		}
	},
	//method of event proxy
	_event = {

	},
	//method of event handler
	_handler = {
		onHoverOverNode: function(event, node) {
			var setting = data.getSetting(event.data.treeId),
			root = data.getRoot(setting);
			if (root.curHoverNode != node) {
				_handler.onHoverOutNode(event);
			}
			root.curHoverNode = node;
			view.addHoverDom(setting, node);
		},
		onHoverOutNode: function(event, node) {
			var setting = data.getSetting(event.data.treeId),
			root = data.getRoot(setting);
			if (root.curHoverNode && !data.isSelectedNode(setting, root.curHoverNode)) {
				view.removeTreeDom(setting, root.curHoverNode);
				root.curHoverNode = null;
			}
		},
		onMousedownNode: function(eventMouseDown, _node) {
			var i,l,
			setting = data.getSetting(eventMouseDown.data.treeId),
			root = data.getRoot(setting), roots = data.getRoots();
			//right click can't drag & drop
			if (eventMouseDown.button == 2 || !setting.edit.enable || (!setting.edit.drag.isCopy && !setting.edit.drag.isMove)) return true;

			//input of edit node name can't drag & drop
			var target = eventMouseDown.target,
			_nodes = data.getRoot(setting).curSelectedList,
			nodes = [];
			if (!data.isSelectedNode(setting, _node)) {
				nodes = [_node];
			} else {
				for (i=0, l=_nodes.length; i<l; i++) {
					if (_nodes[i].editNameFlag && tools.eqs(target.tagName, "input") && target.getAttribute("treeNode"+consts.id.INPUT) !== null) {
						return true;
					}
					nodes.push(_nodes[i]);
					if (nodes[0].parentTId !== _nodes[i].parentTId) {
						nodes = [_node];
						break;
					}
				}
			}

			view.editNodeBlur = true;
			view.cancelCurEditNode(setting);

			var doc = $(setting.treeObj.get(0).ownerDocument),
			body = $(setting.treeObj.get(0).ownerDocument.body), curNode, tmpArrow, tmpTarget,
			isOtherTree = false,
			targetSetting = setting,
			sourceSetting = setting,
			preNode, nextNode,
			preTmpTargetNodeId = null,
			preTmpMoveType = null,
			tmpTargetNodeId = null,
			moveType = consts.move.TYPE_INNER,
			mouseDownX = eventMouseDown.clientX,
			mouseDownY = eventMouseDown.clientY,
			startTime = (new Date()).getTime();

			if (tools.uCanDo(setting)) {
				doc.bind("mousemove", _docMouseMove);
			}
			function _docMouseMove(event) {
				//avoid start drag after click node
				if (root.dragFlag == 0 && Math.abs(mouseDownX - event.clientX) < setting.edit.drag.minMoveSize
					&& Math.abs(mouseDownY - event.clientY) < setting.edit.drag.minMoveSize) {
					return true;
				}
				var i, l, tmpNode, tmpDom, tmpNodes,
				childKey = setting.data.key.children;
				body.css("cursor", "pointer");

				if (root.dragFlag == 0) {
					if (tools.apply(setting.callback.beforeDrag, [setting.treeId, nodes], true) == false) {
						_docMouseUp(event);
						return true;
					}

					for (i=0, l=nodes.length; i<l; i++) {
						if (i==0) {
							root.dragNodeShowBefore = [];
						}
						tmpNode = nodes[i];
						if (tmpNode.isParent && tmpNode.open) {
							view.expandCollapseNode(setting, tmpNode, !tmpNode.open);
							root.dragNodeShowBefore[tmpNode.tId] = true;
						} else {
							root.dragNodeShowBefore[tmpNode.tId] = false;
						}
					}

					root.dragFlag = 1;
					roots.showHoverDom = false;
					tools.showIfameMask(setting, true);

					//sort
					var isOrder = true, lastIndex = -1;
					if (nodes.length>1) {
						var pNodes = nodes[0].parentTId ? nodes[0].getParentNode()[childKey] : data.getNodes(setting);
						tmpNodes = [];
						for (i=0, l=pNodes.length; i<l; i++) {
							if (root.dragNodeShowBefore[pNodes[i].tId] !== undefined) {
								if (isOrder && lastIndex > -1 && (lastIndex+1) !== i) {
									isOrder = false;
								}
								tmpNodes.push(pNodes[i]);
								lastIndex = i;
							}
							if (nodes.length === tmpNodes.length) {
								nodes = tmpNodes;
								break;
							}
						}
					}
					if (isOrder) {
						preNode = nodes[0].getPreNode();
						nextNode = nodes[nodes.length-1].getNextNode();
					}

					//set node in selected
					curNode = $$("<ul class='zTreeDragUL'></ul>", setting);
					for (i=0, l=nodes.length; i<l; i++) {
						tmpNode = nodes[i];
						tmpNode.editNameFlag = false;
						view.selectNode(setting, tmpNode, i>0);
						view.removeTreeDom(setting, tmpNode);

						if (i > setting.edit.drag.maxShowNodeNum-1) {
							continue;
						}

						tmpDom = $$("<li id='"+ tmpNode.tId +"_tmp'></li>", setting);
						tmpDom.append($$(tmpNode, consts.id.A, setting).clone());
						tmpDom.css("padding", "0");
						tmpDom.children("#" + tmpNode.tId + consts.id.A).removeClass(consts.node.CURSELECTED);
						curNode.append(tmpDom);
						if (i == setting.edit.drag.maxShowNodeNum-1) {
							tmpDom = $$("<li id='"+ tmpNode.tId +"_moretmp'><a>  ...  </a></li>", setting);
							curNode.append(tmpDom);
						}
					}
					curNode.attr("id", nodes[0].tId + consts.id.UL + "_tmp");
					curNode.addClass(setting.treeObj.attr("class"));
					curNode.appendTo(body);

					tmpArrow = $$("<span class='tmpzTreeMove_arrow'></span>", setting);
					tmpArrow.attr("id", "zTreeMove_arrow_tmp");
					tmpArrow.appendTo(body);

					setting.treeObj.trigger(consts.event.DRAG, [event, setting.treeId, nodes]);
				}

				if (root.dragFlag == 1) {
					if (tmpTarget && tmpArrow.attr("id") == event.target.id && tmpTargetNodeId && (event.clientX + doc.scrollLeft()+2) > ($("#" + tmpTargetNodeId + consts.id.A, tmpTarget).offset().left)) {
						var xT = $("#" + tmpTargetNodeId + consts.id.A, tmpTarget);
						event.target = (xT.length > 0) ? xT.get(0) : event.target;
					} else if (tmpTarget) {
						tmpTarget.removeClass(consts.node.TMPTARGET_TREE);
						if (tmpTargetNodeId) $("#" + tmpTargetNodeId + consts.id.A, tmpTarget).removeClass(consts.node.TMPTARGET_NODE + "_" + consts.move.TYPE_PREV)
							.removeClass(consts.node.TMPTARGET_NODE + "_" + _consts.move.TYPE_NEXT).removeClass(consts.node.TMPTARGET_NODE + "_" + _consts.move.TYPE_INNER);
					}
					tmpTarget = null;
					tmpTargetNodeId = null;

					//judge drag & drop in multi ztree
					isOtherTree = false;
					targetSetting = setting;
					var settings = data.getSettings();
					for (var s in settings) {
						if (settings[s].treeId && settings[s].edit.enable && settings[s].treeId != setting.treeId
							&& (event.target.id == settings[s].treeId || $(event.target).parents("#" + settings[s].treeId).length>0)) {
							isOtherTree = true;
							targetSetting = settings[s];
						}
					}

					var docScrollTop = doc.scrollTop(),
					docScrollLeft = doc.scrollLeft(),
					treeOffset = targetSetting.treeObj.offset(),
					scrollHeight = targetSetting.treeObj.get(0).scrollHeight,
					scrollWidth = targetSetting.treeObj.get(0).scrollWidth,
					dTop = (event.clientY + docScrollTop - treeOffset.top),
					dBottom = (targetSetting.treeObj.height() + treeOffset.top - event.clientY - docScrollTop),
					dLeft = (event.clientX + docScrollLeft - treeOffset.left),
					dRight = (targetSetting.treeObj.width() + treeOffset.left - event.clientX - docScrollLeft),
					isTop = (dTop < setting.edit.drag.borderMax && dTop > setting.edit.drag.borderMin),
					isBottom = (dBottom < setting.edit.drag.borderMax && dBottom > setting.edit.drag.borderMin),
					isLeft = (dLeft < setting.edit.drag.borderMax && dLeft > setting.edit.drag.borderMin),
					isRight = (dRight < setting.edit.drag.borderMax && dRight > setting.edit.drag.borderMin),
					isTreeInner = dTop > setting.edit.drag.borderMin && dBottom > setting.edit.drag.borderMin && dLeft > setting.edit.drag.borderMin && dRight > setting.edit.drag.borderMin,
					isTreeTop = (isTop && targetSetting.treeObj.scrollTop() <= 0),
					isTreeBottom = (isBottom && (targetSetting.treeObj.scrollTop() + targetSetting.treeObj.height()+10) >= scrollHeight),
					isTreeLeft = (isLeft && targetSetting.treeObj.scrollLeft() <= 0),
					isTreeRight = (isRight && (targetSetting.treeObj.scrollLeft() + targetSetting.treeObj.width()+10) >= scrollWidth);

					if (event.target && tools.isChildOrSelf(event.target, targetSetting.treeId)) {
						//get node <li> dom
						var targetObj = event.target;
						while (targetObj && targetObj.tagName && !tools.eqs(targetObj.tagName, "li") && targetObj.id != targetSetting.treeId) {
							targetObj = targetObj.parentNode;
						}

						var canMove = true;
						//don't move to self or children of self
						for (i=0, l=nodes.length; i<l; i++) {
							tmpNode = nodes[i];
							if (targetObj.id === tmpNode.tId) {
								canMove = false;
								break;
							} else if ($$(tmpNode, setting).find("#" + targetObj.id).length > 0) {
								canMove = false;
								break;
							}
						}
						if (canMove && event.target && tools.isChildOrSelf(event.target, targetObj.id + consts.id.A)) {
							tmpTarget = $(targetObj);
							tmpTargetNodeId = targetObj.id;
						}
					}

					//the mouse must be in zTree
					tmpNode = nodes[0];
					if (isTreeInner && tools.isChildOrSelf(event.target, targetSetting.treeId)) {
						//judge mouse move in root of ztree
						if (!tmpTarget && (event.target.id == targetSetting.treeId || isTreeTop || isTreeBottom || isTreeLeft || isTreeRight) && (isOtherTree || (!isOtherTree && tmpNode.parentTId))) {
							tmpTarget = targetSetting.treeObj;
						}
						//auto scroll top
						if (isTop) {
							targetSetting.treeObj.scrollTop(targetSetting.treeObj.scrollTop()-10);
						} else if (isBottom)  {
							targetSetting.treeObj.scrollTop(targetSetting.treeObj.scrollTop()+10);
						}
						if (isLeft) {
							targetSetting.treeObj.scrollLeft(targetSetting.treeObj.scrollLeft()-10);
						} else if (isRight) {
							targetSetting.treeObj.scrollLeft(targetSetting.treeObj.scrollLeft()+10);
						}
						//auto scroll left
						if (tmpTarget && tmpTarget != targetSetting.treeObj && tmpTarget.offset().left < targetSetting.treeObj.offset().left) {
							targetSetting.treeObj.scrollLeft(targetSetting.treeObj.scrollLeft()+ tmpTarget.offset().left - targetSetting.treeObj.offset().left);
						}
					}

					curNode.css({
						"top": (event.clientY + docScrollTop + 3) + "px",
						"left": (event.clientX + docScrollLeft + 3) + "px"
					});

					var dX = 0;
					var dY = 0;
					if (tmpTarget && tmpTarget.attr("id")!=targetSetting.treeId) {
						var tmpTargetNode = tmpTargetNodeId == null ? null: data.getNodeCache(targetSetting, tmpTargetNodeId),
							isCopy = ((event.ctrlKey || event.metaKey) && setting.edit.drag.isMove && setting.edit.drag.isCopy) || (!setting.edit.drag.isMove && setting.edit.drag.isCopy),
							isPrev = !!(preNode && tmpTargetNodeId === preNode.tId),
							isNext = !!(nextNode && tmpTargetNodeId === nextNode.tId),
							isInner = (tmpNode.parentTId && tmpNode.parentTId == tmpTargetNodeId),
							canPrev = (isCopy || !isNext) && tools.apply(targetSetting.edit.drag.prev, [targetSetting.treeId, nodes, tmpTargetNode], !!targetSetting.edit.drag.prev),
							canNext = (isCopy || !isPrev) && tools.apply(targetSetting.edit.drag.next, [targetSetting.treeId, nodes, tmpTargetNode], !!targetSetting.edit.drag.next),
							canInner = (isCopy || !isInner) && !(targetSetting.data.keep.leaf && !tmpTargetNode.isParent) && tools.apply(targetSetting.edit.drag.inner, [targetSetting.treeId, nodes, tmpTargetNode], !!targetSetting.edit.drag.inner);

						function clearMove() {
							tmpTarget = null;
							tmpTargetNodeId = "";
							moveType = consts.move.TYPE_INNER;
							tmpArrow.css({
								"display":"none"
							});
							if (window.zTreeMoveTimer) {
								clearTimeout(window.zTreeMoveTimer);
								window.zTreeMoveTargetNodeTId = null
							}
						}
						if (!canPrev && !canNext && !canInner) {
							clearMove();
						} else {
							var tmpTargetA = $("#" + tmpTargetNodeId + consts.id.A, tmpTarget),
								tmpNextA = tmpTargetNode.isLastNode ? null : $("#" + tmpTargetNode.getNextNode().tId + consts.id.A, tmpTarget.next()),
								tmpTop = tmpTargetA.offset().top,
								tmpLeft = tmpTargetA.offset().left,
								prevPercent = canPrev ? (canInner ? 0.25 : (canNext ? 0.5 : 1) ) : -1,
								nextPercent = canNext ? (canInner ? 0.75 : (canPrev ? 0.5 : 0) ) : -1,
								dY_percent = (event.clientY + docScrollTop - tmpTop)/tmpTargetA.height();

							if ((prevPercent==1 || dY_percent<=prevPercent && dY_percent>=-.2) && canPrev) {
								dX = 1 - tmpArrow.width();
								dY = tmpTop - tmpArrow.height()/2;
								moveType = consts.move.TYPE_PREV;
							} else if ((nextPercent==0 || dY_percent>=nextPercent && dY_percent<=1.2) && canNext) {
								dX = 1 - tmpArrow.width();
								dY = (tmpNextA == null || (tmpTargetNode.isParent && tmpTargetNode.open)) ? (tmpTop + tmpTargetA.height() - tmpArrow.height()/2) : (tmpNextA.offset().top - tmpArrow.height()/2);
								moveType = consts.move.TYPE_NEXT;
							} else if (canInner) {
								dX = 5 - tmpArrow.width();
								dY = tmpTop;
								moveType = consts.move.TYPE_INNER;
							} else {
								clearMove();
							}

							if (tmpTarget) {
								tmpArrow.css({
									"display":"block",
									"top": dY + "px",
									"left": (tmpLeft + dX) + "px"
								});
								tmpTargetA.addClass(consts.node.TMPTARGET_NODE + "_" + moveType);

								if (preTmpTargetNodeId != tmpTargetNodeId || preTmpMoveType != moveType) {
									startTime = (new Date()).getTime();
								}
								if (tmpTargetNode && tmpTargetNode.isParent && moveType == consts.move.TYPE_INNER) {
									var startTimer = true;
									if (window.zTreeMoveTimer && window.zTreeMoveTargetNodeTId !== tmpTargetNode.tId) {
										clearTimeout(window.zTreeMoveTimer);
										window.zTreeMoveTargetNodeTId = null;
									} else if (window.zTreeMoveTimer && window.zTreeMoveTargetNodeTId === tmpTargetNode.tId) {
										startTimer = false;
									}
									if (startTimer) {
										window.zTreeMoveTimer = setTimeout(function() {
											if (moveType != consts.move.TYPE_INNER) return;
											if (tmpTargetNode && tmpTargetNode.isParent && !tmpTargetNode.open && (new Date()).getTime() - startTime > targetSetting.edit.drag.autoOpenTime
												&& tools.apply(targetSetting.callback.beforeDragOpen, [targetSetting.treeId, tmpTargetNode], true)) {
												view.switchNode(targetSetting, tmpTargetNode);
												if (targetSetting.edit.drag.autoExpandTrigger) {
													targetSetting.treeObj.trigger(consts.event.EXPAND, [targetSetting.treeId, tmpTargetNode]);
												}
											}
										}, targetSetting.edit.drag.autoOpenTime+50);
										window.zTreeMoveTargetNodeTId = tmpTargetNode.tId;
									}
								}
							}
						}
					} else {
						moveType = consts.move.TYPE_INNER;
						if (tmpTarget && tools.apply(targetSetting.edit.drag.inner, [targetSetting.treeId, nodes, null], !!targetSetting.edit.drag.inner)) {
							tmpTarget.addClass(consts.node.TMPTARGET_TREE);
						} else {
							tmpTarget = null;
						}
						tmpArrow.css({
							"display":"none"
						});
						if (window.zTreeMoveTimer) {
							clearTimeout(window.zTreeMoveTimer);
							window.zTreeMoveTargetNodeTId = null;
						}
					}
					preTmpTargetNodeId = tmpTargetNodeId;
					preTmpMoveType = moveType;

					setting.treeObj.trigger(consts.event.DRAGMOVE, [event, setting.treeId, nodes]);
				}
				return false;
			}

			doc.bind("mouseup", _docMouseUp);
			function _docMouseUp(event) {
				if (window.zTreeMoveTimer) {
					clearTimeout(window.zTreeMoveTimer);
					window.zTreeMoveTargetNodeTId = null;
				}
				preTmpTargetNodeId = null;
				preTmpMoveType = null;
				doc.unbind("mousemove", _docMouseMove);
				doc.unbind("mouseup", _docMouseUp);
				doc.unbind("selectstart", _docSelect);
				body.css("cursor", "auto");
				if (tmpTarget) {
					tmpTarget.removeClass(consts.node.TMPTARGET_TREE);
					if (tmpTargetNodeId) $("#" + tmpTargetNodeId + consts.id.A, tmpTarget).removeClass(consts.node.TMPTARGET_NODE + "_" + consts.move.TYPE_PREV)
							.removeClass(consts.node.TMPTARGET_NODE + "_" + _consts.move.TYPE_NEXT).removeClass(consts.node.TMPTARGET_NODE + "_" + _consts.move.TYPE_INNER);
				}
				tools.showIfameMask(setting, false);

				roots.showHoverDom = true;
				if (root.dragFlag == 0) return;
				root.dragFlag = 0;

				var i, l, tmpNode;
				for (i=0, l=nodes.length; i<l; i++) {
					tmpNode = nodes[i];
					if (tmpNode.isParent && root.dragNodeShowBefore[tmpNode.tId] && !tmpNode.open) {
						view.expandCollapseNode(setting, tmpNode, !tmpNode.open);
						delete root.dragNodeShowBefore[tmpNode.tId];
					}
				}

				if (curNode) curNode.remove();
				if (tmpArrow) tmpArrow.remove();

				var isCopy = ((event.ctrlKey || event.metaKey) && setting.edit.drag.isMove && setting.edit.drag.isCopy) || (!setting.edit.drag.isMove && setting.edit.drag.isCopy);
				if (!isCopy && tmpTarget && tmpTargetNodeId && nodes[0].parentTId && tmpTargetNodeId==nodes[0].parentTId && moveType == consts.move.TYPE_INNER) {
					tmpTarget = null;
				}
				if (tmpTarget) {
					var dragTargetNode = tmpTargetNodeId == null ? null: data.getNodeCache(targetSetting, tmpTargetNodeId);
					if (tools.apply(setting.callback.beforeDrop, [targetSetting.treeId, nodes, dragTargetNode, moveType, isCopy], true) == false) {
						view.selectNodes(sourceSetting, nodes);
						return;
					}
					var newNodes = isCopy ? tools.clone(nodes) : nodes;

					function dropCallback() {
						if (isOtherTree) {
							if (!isCopy) {
								for(var i=0, l=nodes.length; i<l; i++) {
									view.removeNode(setting, nodes[i]);
								}
							}
							if (moveType == consts.move.TYPE_INNER) {
								view.addNodes(targetSetting, dragTargetNode, -1, newNodes);
							} else {
								view.addNodes(targetSetting, dragTargetNode.getParentNode(), moveType == consts.move.TYPE_PREV ? dragTargetNode.getIndex() : dragTargetNode.getIndex()+1, newNodes);
							}
						} else {
							if (isCopy && moveType == consts.move.TYPE_INNER) {
								view.addNodes(targetSetting, dragTargetNode, -1, newNodes);
							} else if (isCopy) {
								view.addNodes(targetSetting, dragTargetNode.getParentNode(), moveType == consts.move.TYPE_PREV ? dragTargetNode.getIndex() : dragTargetNode.getIndex()+1, newNodes);
							} else {
								if (moveType != consts.move.TYPE_NEXT) {
									for (i=0, l=newNodes.length; i<l; i++) {
										view.moveNode(targetSetting, dragTargetNode, newNodes[i], moveType, false);
									}
								} else {
									for (i=-1, l=newNodes.length-1; i<l; l--) {
										view.moveNode(targetSetting, dragTargetNode, newNodes[l], moveType, false);
									}
								}
							}
						}
						view.selectNodes(targetSetting, newNodes);

						var a = $$(newNodes[0], setting).get(0);
						view.scrollIntoView(a);

						setting.treeObj.trigger(consts.event.DROP, [event, targetSetting.treeId, newNodes, dragTargetNode, moveType, isCopy]);
					}

					if (moveType == consts.move.TYPE_INNER && tools.canAsync(targetSetting, dragTargetNode)) {
						view.asyncNode(targetSetting, dragTargetNode, false, dropCallback);
					} else {
						dropCallback();
					}

				} else {
					view.selectNodes(sourceSetting, nodes);
					setting.treeObj.trigger(consts.event.DROP, [event, setting.treeId, nodes, null, null, null]);
				}
			}

			doc.bind("selectstart", _docSelect);
			function _docSelect() {
				return false;
			}

			//Avoid FireFox's Bug
			//If zTree Div CSS set 'overflow', so drag node outside of zTree, and event.target is error.
			if(eventMouseDown.preventDefault) {
				eventMouseDown.preventDefault();
			}
			return true;
		}
	},
	//method of tools for zTree
	_tools = {
		getAbs: function (obj) {
			var oRect = obj.getBoundingClientRect(),
			scrollTop = document.body.scrollTop+document.documentElement.scrollTop,
			scrollLeft = document.body.scrollLeft+document.documentElement.scrollLeft;
			return [oRect.left+scrollLeft,oRect.top+scrollTop];
		},
		inputFocus: function(inputObj) {
			if (inputObj.get(0)) {
				inputObj.focus();
				tools.setCursorPosition(inputObj.get(0), inputObj.val().length);
			}
		},
		inputSelect: function(inputObj) {
			if (inputObj.get(0)) {
				inputObj.focus();
				inputObj.select();
			}
		},
		setCursorPosition: function(obj, pos){
			if(obj.setSelectionRange) {
				obj.focus();
				obj.setSelectionRange(pos,pos);
			} else if (obj.createTextRange) {
				var range = obj.createTextRange();
				range.collapse(true);
				range.moveEnd('character', pos);
				range.moveStart('character', pos);
				range.select();
			}
		},
		showIfameMask: function(setting, showSign) {
			var root = data.getRoot(setting);
			//clear full mask
			while (root.dragMaskList.length > 0) {
				root.dragMaskList[0].remove();
				root.dragMaskList.shift();
			}
			if (showSign) {
				//show mask
				var iframeList = $$("iframe", setting);
				for (var i = 0, l = iframeList.length; i < l; i++) {
					var obj = iframeList.get(i),
					r = tools.getAbs(obj),
					dragMask = $$("<div id='zTreeMask_" + i + "' class='zTreeMask' style='top:" + r[1] + "px; left:" + r[0] + "px; width:" + obj.offsetWidth + "px; height:" + obj.offsetHeight + "px;'></div>", setting);
					dragMask.appendTo($$("body", setting));
					root.dragMaskList.push(dragMask);
				}
			}
		}
	},
	//method of operate ztree dom
	_view = {
		addEditBtn: function(setting, node) {
			if (node.editNameFlag || $$(node, consts.id.EDIT, setting).length > 0) {
				return;
			}
			if (!tools.apply(setting.edit.showRenameBtn, [setting.treeId, node], setting.edit.showRenameBtn)) {
				return;
			}
			var aObj = $$(node, consts.id.A, setting),
			editStr = "<span class='" + consts.className.BUTTON + " edit' id='" + node.tId + consts.id.EDIT + "' title='"+tools.apply(setting.edit.renameTitle, [setting.treeId, node], setting.edit.renameTitle)+"' treeNode"+consts.id.EDIT+" style='display:none;'></span>";
			aObj.append(editStr);

			$$(node, consts.id.EDIT, setting).bind('click',
				function() {
					if (!tools.uCanDo(setting) || tools.apply(setting.callback.beforeEditName, [setting.treeId, node], true) == false) return false;
					view.editNode(setting, node);
					return false;
				}
				).show();
		},
		addRemoveBtn: function(setting, node) {
			if (node.editNameFlag || $$(node, consts.id.REMOVE, setting).length > 0) {
				return;
			}
			if (!tools.apply(setting.edit.showRemoveBtn, [setting.treeId, node], setting.edit.showRemoveBtn)) {
				return;
			}
			var aObj = $$(node, consts.id.A, setting),
			removeStr = "<span class='" + consts.className.BUTTON + " remove' id='" + node.tId + consts.id.REMOVE + "' title='"+tools.apply(setting.edit.removeTitle, [setting.treeId, node], setting.edit.removeTitle)+"' treeNode"+consts.id.REMOVE+" style='display:none;'></span>";
			aObj.append(removeStr);

			$$(node, consts.id.REMOVE, setting).bind('click',
				function() {
					if (!tools.uCanDo(setting) || tools.apply(setting.callback.beforeRemove, [setting.treeId, node], true) == false) return false;
					view.removeNode(setting, node);
					setting.treeObj.trigger(consts.event.REMOVE, [setting.treeId, node]);
					return false;
				}
				).bind('mousedown',
				function(eventMouseDown) {
					return true;
				}
				).show();
		},
		addHoverDom: function(setting, node) {
			if (data.getRoots().showHoverDom) {
				node.isHover = true;
				if (setting.edit.enable) {
					view.addEditBtn(setting, node);
					view.addRemoveBtn(setting, node);
				}
				tools.apply(setting.view.addHoverDom, [setting.treeId, node]);
			}
		},
		cancelCurEditNode: function (setting, forceName, isCancel) {
			var root = data.getRoot(setting),
			nameKey = setting.data.key.name,
			node = root.curEditNode;

			if (node) {
				var inputObj = root.curEditInput,
				newName = forceName ? forceName:(isCancel ? node[nameKey]: inputObj.val());
				if (tools.apply(setting.callback.beforeRename, [setting.treeId, node, newName, isCancel], true) === false) {
					return false;
				}
                node[nameKey] = newName;
                var aObj = $$(node, consts.id.A, setting);
				aObj.removeClass(consts.node.CURSELECTED_EDIT);
				inputObj.unbind();
				view.setNodeName(setting, node);
				node.editNameFlag = false;
				root.curEditNode = null;
				root.curEditInput = null;
				view.selectNode(setting, node, false);
                setting.treeObj.trigger(consts.event.RENAME, [setting.treeId, node, isCancel]);
			}
			root.noSelection = true;
			return true;
		},
		editNode: function(setting, node) {
			var root = data.getRoot(setting);
			view.editNodeBlur = false;
			if (data.isSelectedNode(setting, node) && root.curEditNode == node && node.editNameFlag) {
				setTimeout(function() {tools.inputFocus(root.curEditInput);}, 0);
				return;
			}
			var nameKey = setting.data.key.name;
			node.editNameFlag = true;
			view.removeTreeDom(setting, node);
			view.cancelCurEditNode(setting);
			view.selectNode(setting, node, false);
			$$(node, consts.id.SPAN, setting).html("<input type=text class='rename' id='" + node.tId + consts.id.INPUT + "' treeNode" + consts.id.INPUT + " >");
			var inputObj = $$(node, consts.id.INPUT, setting);
			inputObj.attr("value", node[nameKey]);
			if (setting.edit.editNameSelectAll) {
				tools.inputSelect(inputObj);
			} else {
				tools.inputFocus(inputObj);
			}

			inputObj.bind('blur', function(event) {
				if (!view.editNodeBlur) {
					view.cancelCurEditNode(setting);
				}
			}).bind('keydown', function(event) {
				if (event.keyCode=="13") {
					view.editNodeBlur = true;
					view.cancelCurEditNode(setting);
				} else if (event.keyCode=="27") {
					view.cancelCurEditNode(setting, null, true);
				}
			}).bind('click', function(event) {
				return false;
			}).bind('dblclick', function(event) {
				return false;
			});

			$$(node, consts.id.A, setting).addClass(consts.node.CURSELECTED_EDIT);
			root.curEditInput = inputObj;
			root.noSelection = false;
			root.curEditNode = node;
		},
		moveNode: function(setting, targetNode, node, moveType, animateFlag, isSilent) {
			var root = data.getRoot(setting),
			childKey = setting.data.key.children;
			if (targetNode == node) return;
			if (setting.data.keep.leaf && targetNode && !targetNode.isParent && moveType == consts.move.TYPE_INNER) return;
			var oldParentNode = (node.parentTId ? node.getParentNode(): root),
			targetNodeIsRoot = (targetNode === null || targetNode == root);
			if (targetNodeIsRoot && targetNode === null) targetNode = root;
			if (targetNodeIsRoot) moveType = consts.move.TYPE_INNER;
			var targetParentNode = (targetNode.parentTId ? targetNode.getParentNode() : root);

			if (moveType != consts.move.TYPE_PREV && moveType != consts.move.TYPE_NEXT) {
				moveType = consts.move.TYPE_INNER;
			}

			if (moveType == consts.move.TYPE_INNER) {
				if (targetNodeIsRoot) {
					//parentTId of root node is null
					node.parentTId = null;
				} else {
					if (!targetNode.isParent) {
						targetNode.isParent = true;
						targetNode.open = !!targetNode.open;
						view.setNodeLineIcos(setting, targetNode);
					}
					node.parentTId = targetNode.tId;
				}
			}

			//move node Dom
			var targetObj, target_ulObj;
			if (targetNodeIsRoot) {
				targetObj = setting.treeObj;
				target_ulObj = targetObj;
			} else {
				if (!isSilent && moveType == consts.move.TYPE_INNER) {
					view.expandCollapseNode(setting, targetNode, true, false);
				} else if (!isSilent) {
					view.expandCollapseNode(setting, targetNode.getParentNode(), true, false);
				}
				targetObj = $$(targetNode, setting);
				target_ulObj = $$(targetNode, consts.id.UL, setting);
				if (!!targetObj.get(0) && !target_ulObj.get(0)) {
					var ulstr = [];
					view.makeUlHtml(setting, targetNode, ulstr, '');
					targetObj.append(ulstr.join(''));
				}
				target_ulObj = $$(targetNode, consts.id.UL, setting);
			}
			var nodeDom = $$(node, setting);
			if (!nodeDom.get(0)) {
				nodeDom = view.appendNodes(setting, node.level, [node], null, -1, false, true).join('');
			} else if (!targetObj.get(0)) {
				nodeDom.remove();
			}
			if (target_ulObj.get(0) && moveType == consts.move.TYPE_INNER) {
				target_ulObj.append(nodeDom);
			} else if (targetObj.get(0) && moveType == consts.move.TYPE_PREV) {
				targetObj.before(nodeDom);
			} else if (targetObj.get(0) && moveType == consts.move.TYPE_NEXT) {
				targetObj.after(nodeDom);
			}

			//repair the data after move
			var i,l,
			tmpSrcIndex = -1,
			tmpTargetIndex = 0,
			oldNeighbor = null,
			newNeighbor = null,
			oldLevel = node.level;
			if (node.isFirstNode) {
				tmpSrcIndex = 0;
				if (oldParentNode[childKey].length > 1 ) {
					oldNeighbor = oldParentNode[childKey][1];
					oldNeighbor.isFirstNode = true;
				}
			} else if (node.isLastNode) {
				tmpSrcIndex = oldParentNode[childKey].length -1;
				oldNeighbor = oldParentNode[childKey][tmpSrcIndex - 1];
				oldNeighbor.isLastNode = true;
			} else {
				for (i = 0, l = oldParentNode[childKey].length; i < l; i++) {
					if (oldParentNode[childKey][i].tId == node.tId) {
						tmpSrcIndex = i;
						break;
					}
				}
			}
			if (tmpSrcIndex >= 0) {
				oldParentNode[childKey].splice(tmpSrcIndex, 1);
			}
			if (moveType != consts.move.TYPE_INNER) {
				for (i = 0, l = targetParentNode[childKey].length; i < l; i++) {
					if (targetParentNode[childKey][i].tId == targetNode.tId) tmpTargetIndex = i;
				}
			}
			if (moveType == consts.move.TYPE_INNER) {
				if (!targetNode[childKey]) targetNode[childKey] = new Array();
				if (targetNode[childKey].length > 0) {
					newNeighbor = targetNode[childKey][targetNode[childKey].length - 1];
					newNeighbor.isLastNode = false;
				}
				targetNode[childKey].splice(targetNode[childKey].length, 0, node);
				node.isLastNode = true;
				node.isFirstNode = (targetNode[childKey].length == 1);
			} else if (targetNode.isFirstNode && moveType == consts.move.TYPE_PREV) {
				targetParentNode[childKey].splice(tmpTargetIndex, 0, node);
				newNeighbor = targetNode;
				newNeighbor.isFirstNode = false;
				node.parentTId = targetNode.parentTId;
				node.isFirstNode = true;
				node.isLastNode = false;

			} else if (targetNode.isLastNode && moveType == consts.move.TYPE_NEXT) {
				targetParentNode[childKey].splice(tmpTargetIndex + 1, 0, node);
				newNeighbor = targetNode;
				newNeighbor.isLastNode = false;
				node.parentTId = targetNode.parentTId;
				node.isFirstNode = false;
				node.isLastNode = true;

			} else {
				if (moveType == consts.move.TYPE_PREV) {
					targetParentNode[childKey].splice(tmpTargetIndex, 0, node);
				} else {
					targetParentNode[childKey].splice(tmpTargetIndex + 1, 0, node);
				}
				node.parentTId = targetNode.parentTId;
				node.isFirstNode = false;
				node.isLastNode = false;
			}
			data.fixPIdKeyValue(setting, node);
			data.setSonNodeLevel(setting, node.getParentNode(), node);

			//repair node what been moved
			view.setNodeLineIcos(setting, node);
			view.repairNodeLevelClass(setting, node, oldLevel)

			//repair node's old parentNode dom
			if (!setting.data.keep.parent && oldParentNode[childKey].length < 1) {
				//old parentNode has no child nodes
				oldParentNode.isParent = false;
				oldParentNode.open = false;
				var tmp_ulObj = $$(oldParentNode, consts.id.UL, setting),
				tmp_switchObj = $$(oldParentNode, consts.id.SWITCH, setting),
				tmp_icoObj = $$(oldParentNode, consts.id.ICON, setting);
				view.replaceSwitchClass(oldParentNode, tmp_switchObj, consts.folder.DOCU);
				view.replaceIcoClass(oldParentNode, tmp_icoObj, consts.folder.DOCU);
				tmp_ulObj.css("display", "none");

			} else if (oldNeighbor) {
				//old neigbor node
				view.setNodeLineIcos(setting, oldNeighbor);
			}

			//new neigbor node
			if (newNeighbor) {
				view.setNodeLineIcos(setting, newNeighbor);
			}

			//repair checkbox / radio
			if (!!setting.check && setting.check.enable && view.repairChkClass) {
				view.repairChkClass(setting, oldParentNode);
				view.repairParentChkClassWithSelf(setting, oldParentNode);
				if (oldParentNode != node.parent)
					view.repairParentChkClassWithSelf(setting, node);
			}

			//expand parents after move
			if (!isSilent) {
				view.expandCollapseParentNode(setting, node.getParentNode(), true, animateFlag);
			}
		},
		removeEditBtn: function(setting, node) {
			$$(node, consts.id.EDIT, setting).unbind().remove();
		},
		removeRemoveBtn: function(setting, node) {
			$$(node, consts.id.REMOVE, setting).unbind().remove();
		},
		removeTreeDom: function(setting, node) {
			node.isHover = false;
			view.removeEditBtn(setting, node);
			view.removeRemoveBtn(setting, node);
			tools.apply(setting.view.removeHoverDom, [setting.treeId, node]);
		},
		repairNodeLevelClass: function(setting, node, oldLevel) {
			if (oldLevel === node.level) return;
			var liObj = $$(node, setting),
			aObj = $$(node, consts.id.A, setting),
			ulObj = $$(node, consts.id.UL, setting),
			oldClass = consts.className.LEVEL + oldLevel,
			newClass = consts.className.LEVEL + node.level;
			liObj.removeClass(oldClass);
			liObj.addClass(newClass);
			aObj.removeClass(oldClass);
			aObj.addClass(newClass);
			ulObj.removeClass(oldClass);
			ulObj.addClass(newClass);
		},
		selectNodes : function(setting, nodes) {
			for (var i=0, l=nodes.length; i<l; i++) {
				view.selectNode(setting, nodes[i], i>0);
			}
		}
	},

	_z = {
		tools: _tools,
		view: _view,
		event: _event,
		data: _data
	};
	$.extend(true, $.fn.zTree.consts, _consts);
	$.extend(true, $.fn.zTree._z, _z);

	var zt = $.fn.zTree,
	tools = zt._z.tools,
	consts = zt.consts,
	view = zt._z.view,
	data = zt._z.data,
	event = zt._z.event,
	$$ = tools.$;

	data.exSetting(_setting);
	data.addInitBind(_bindEvent);
	data.addInitUnBind(_unbindEvent);
	data.addInitCache(_initCache);
	data.addInitNode(_initNode);
	data.addInitProxy(_eventProxy);
	data.addInitRoot(_initRoot);
	data.addZTreeTools(_zTreeTools);

	var _cancelPreSelectedNode = view.cancelPreSelectedNode;
	view.cancelPreSelectedNode = function (setting, node) {
		var list = data.getRoot(setting).curSelectedList;
		for (var i=0, j=list.length; i<j; i++) {
			if (!node || node === list[i]) {
				view.removeTreeDom(setting, list[i]);
				if (node) break;
			}
		}
		if (_cancelPreSelectedNode) _cancelPreSelectedNode.apply(view, arguments);
	}

	var _createNodes = view.createNodes;
	view.createNodes = function(setting, level, nodes, parentNode, index) {
		if (_createNodes) {
			_createNodes.apply(view, arguments);
		}
		if (!nodes) return;
		if (view.repairParentChkClassWithSelf) {
			view.repairParentChkClassWithSelf(setting, parentNode);
		}
	}

	var _makeNodeUrl = view.makeNodeUrl;
	view.makeNodeUrl = function(setting, node) {
		return setting.edit.enable ? null : (_makeNodeUrl.apply(view, arguments));
	}

	var _removeNode = view.removeNode;
	view.removeNode = function(setting, node) {
		var root = data.getRoot(setting);
		if (root.curEditNode === node) root.curEditNode = null;
		if (_removeNode) {
			_removeNode.apply(view, arguments);
		}
	}

	var _selectNode = view.selectNode;
	view.selectNode = function(setting, node, addFlag) {
		var root = data.getRoot(setting);
		if (data.isSelectedNode(setting, node) && root.curEditNode == node && node.editNameFlag) {
			return false;
		}
		if (_selectNode) _selectNode.apply(view, arguments);
		view.addHoverDom(setting, node);
		return true;
	}

	var _uCanDo = tools.uCanDo;
	tools.uCanDo = function(setting, e) {
		var root = data.getRoot(setting);
		if (e && (tools.eqs(e.type, "mouseover") || tools.eqs(e.type, "mouseout") || tools.eqs(e.type, "mousedown") || tools.eqs(e.type, "mouseup"))) {
			return true;
		}
		if (root.curEditNode) {
			view.editNodeBlur = false;
			root.curEditInput.focus();
		}
		return (!root.curEditNode) && (_uCanDo ? _uCanDo.apply(view, arguments) : true);
	}
})(jQuery);

/* ***** BEGIN LICENSE BLOCK *****
 * Distributed under the BSD license:
 *
 * Copyright (c) 2010, Ajax.org B.V.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of Ajax.org B.V. nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * ***** END LICENSE BLOCK ***** */

/**
 * Define a module along with a payload
 * @param module a name for the payload
 * @param payload a function to call with (require, exports, module) params
 */

(function() {

var ACE_NAMESPACE = "ace";

var global = (function() { return this; })();
if (!global && typeof window != "undefined") global = window; // strict mode


if (!ACE_NAMESPACE && typeof requirejs !== "undefined")
    return;


var define = function(module, deps, payload) {
    if (typeof module !== "string") {
        if (define.original)
            define.original.apply(this, arguments);
        else {
            console.error("dropping module because define wasn\'t a string.");
            console.trace();
        }
        return;
    }
    if (arguments.length == 2)
        payload = deps;
    if (!define.modules[module]) {
        define.payloads[module] = payload;
        define.modules[module] = null;
    }
};

define.modules = {};
define.payloads = {};

/**
 * Get at functionality define()ed using the function above
 */
var _require = function(parentId, module, callback) {
    if (typeof module === "string") {
        var payload = lookup(parentId, module);
        if (payload != undefined) {
            callback && callback();
            return payload;
        }
    } else if (Object.prototype.toString.call(module) === "[object Array]") {
        var params = [];
        for (var i = 0, l = module.length; i < l; ++i) {
            var dep = lookup(parentId, module[i]);
            if (dep == undefined && require.original)
                return;
            params.push(dep);
        }
        return callback && callback.apply(null, params) || true;
    }
};

var require = function(module, callback) {
    var packagedModule = _require("", module, callback);
    if (packagedModule == undefined && require.original)
        return require.original.apply(this, arguments);
    return packagedModule;
};

var normalizeModule = function(parentId, moduleName) {
    // normalize plugin requires
    if (moduleName.indexOf("!") !== -1) {
        var chunks = moduleName.split("!");
        return normalizeModule(parentId, chunks[0]) + "!" + normalizeModule(parentId, chunks[1]);
    }
    // normalize relative requires
    if (moduleName.charAt(0) == ".") {
        var base = parentId.split("/").slice(0, -1).join("/");
        moduleName = base + "/" + moduleName;

        while(moduleName.indexOf(".") !== -1 && previous != moduleName) {
            var previous = moduleName;
            moduleName = moduleName.replace(/\/\.\//, "/").replace(/[^\/]+\/\.\.\//, "");
        }
    }
    return moduleName;
};

/**
 * Internal function to lookup moduleNames and resolve them by calling the
 * definition function if needed.
 */
var lookup = function(parentId, moduleName) {
    moduleName = normalizeModule(parentId, moduleName);

    var module = define.modules[moduleName];
    if (!module) {
        module = define.payloads[moduleName];
        if (typeof module === 'function') {
            var exports = {};
            var mod = {
                id: moduleName,
                uri: '',
                exports: exports,
                packaged: true
            };

            var req = function(module, callback) {
                return _require(moduleName, module, callback);
            };

            var returnValue = module(req, exports, mod);
            exports = returnValue || mod.exports;
            define.modules[moduleName] = exports;
            delete define.payloads[moduleName];
        }
        module = define.modules[moduleName] = exports || module;
    }
    return module;
};

function exportAce(ns) {
    var root = global;
    if (ns) {
        if (!global[ns])
            global[ns] = {};
        root = global[ns];
    }

    if (!root.define || !root.define.packaged) {
        define.original = root.define;
        root.define = define;
        root.define.packaged = true;
    }

    if (!root.require || !root.require.packaged) {
        require.original = root.require;
        root.require = require;
        root.require.packaged = true;
    }
}

exportAce(ACE_NAMESPACE);

})();

ace.define("ace/lib/regexp",["require","exports","module"], function(require, exports, module) {
"use strict";

    var real = {
            exec: RegExp.prototype.exec,
            test: RegExp.prototype.test,
            match: String.prototype.match,
            replace: String.prototype.replace,
            split: String.prototype.split
        },
        compliantExecNpcg = real.exec.call(/()??/, "")[1] === undefined, // check `exec` handling of nonparticipating capturing groups
        compliantLastIndexIncrement = function () {
            var x = /^/g;
            real.test.call(x, "");
            return !x.lastIndex;
        }();

    if (compliantLastIndexIncrement && compliantExecNpcg)
        return;
    RegExp.prototype.exec = function (str) {
        var match = real.exec.apply(this, arguments),
            name, r2;
        if ( typeof(str) == 'string' && match) {
            if (!compliantExecNpcg && match.length > 1 && indexOf(match, "") > -1) {
                r2 = RegExp(this.source, real.replace.call(getNativeFlags(this), "g", ""));
                real.replace.call(str.slice(match.index), r2, function () {
                    for (var i = 1; i < arguments.length - 2; i++) {
                        if (arguments[i] === undefined)
                            match[i] = undefined;
                    }
                });
            }
            if (this._xregexp && this._xregexp.captureNames) {
                for (var i = 1; i < match.length; i++) {
                    name = this._xregexp.captureNames[i - 1];
                    if (name)
                       match[name] = match[i];
                }
            }
            if (!compliantLastIndexIncrement && this.global && !match[0].length && (this.lastIndex > match.index))
                this.lastIndex--;
        }
        return match;
    };
    if (!compliantLastIndexIncrement) {
        RegExp.prototype.test = function (str) {
            var match = real.exec.call(this, str);
            if (match && this.global && !match[0].length && (this.lastIndex > match.index))
                this.lastIndex--;
            return !!match;
        };
    }

    function getNativeFlags (regex) {
        return (regex.global     ? "g" : "") +
               (regex.ignoreCase ? "i" : "") +
               (regex.multiline  ? "m" : "") +
               (regex.extended   ? "x" : "") + // Proposed for ES4; included in AS3
               (regex.sticky     ? "y" : "");
    }

    function indexOf (array, item, from) {
        if (Array.prototype.indexOf) // Use the native array method if available
            return array.indexOf(item, from);
        for (var i = from || 0; i < array.length; i++) {
            if (array[i] === item)
                return i;
        }
        return -1;
    }

});

ace.define("ace/lib/es5-shim",["require","exports","module"], function(require, exports, module) {

function Empty() {}

if (!Function.prototype.bind) {
    Function.prototype.bind = function bind(that) { // .length is 1
        var target = this;
        if (typeof target != "function") {
            throw new TypeError("Function.prototype.bind called on incompatible " + target);
        }
        var args = slice.call(arguments, 1); // for normal call
        var bound = function () {

            if (this instanceof bound) {

                var result = target.apply(
                    this,
                    args.concat(slice.call(arguments))
                );
                if (Object(result) === result) {
                    return result;
                }
                return this;

            } else {
                return target.apply(
                    that,
                    args.concat(slice.call(arguments))
                );

            }

        };
        if(target.prototype) {
            Empty.prototype = target.prototype;
            bound.prototype = new Empty();
            Empty.prototype = null;
        }
        return bound;
    };
}
var call = Function.prototype.call;
var prototypeOfArray = Array.prototype;
var prototypeOfObject = Object.prototype;
var slice = prototypeOfArray.slice;
var _toString = call.bind(prototypeOfObject.toString);
var owns = call.bind(prototypeOfObject.hasOwnProperty);
var defineGetter;
var defineSetter;
var lookupGetter;
var lookupSetter;
var supportsAccessors;
if ((supportsAccessors = owns(prototypeOfObject, "__defineGetter__"))) {
    defineGetter = call.bind(prototypeOfObject.__defineGetter__);
    defineSetter = call.bind(prototypeOfObject.__defineSetter__);
    lookupGetter = call.bind(prototypeOfObject.__lookupGetter__);
    lookupSetter = call.bind(prototypeOfObject.__lookupSetter__);
}
if ([1,2].splice(0).length != 2) {
    if(function() { // test IE < 9 to splice bug - see issue #138
        function makeArray(l) {
            var a = new Array(l+2);
            a[0] = a[1] = 0;
            return a;
        }
        var array = [], lengthBefore;
        
        array.splice.apply(array, makeArray(20));
        array.splice.apply(array, makeArray(26));

        lengthBefore = array.length; //46
        array.splice(5, 0, "XXX"); // add one element

        lengthBefore + 1 == array.length

        if (lengthBefore + 1 == array.length) {
            return true;// has right splice implementation without bugs
        }
    }()) {//IE 6/7
        var array_splice = Array.prototype.splice;
        Array.prototype.splice = function(start, deleteCount) {
            if (!arguments.length) {
                return [];
            } else {
                return array_splice.apply(this, [
                    start === void 0 ? 0 : start,
                    deleteCount === void 0 ? (this.length - start) : deleteCount
                ].concat(slice.call(arguments, 2)))
            }
        };
    } else {//IE8
        Array.prototype.splice = function(pos, removeCount){
            var length = this.length;
            if (pos > 0) {
                if (pos > length)
                    pos = length;
            } else if (pos == void 0) {
                pos = 0;
            } else if (pos < 0) {
                pos = Math.max(length + pos, 0);
            }

            if (!(pos+removeCount < length))
                removeCount = length - pos;

            var removed = this.slice(pos, pos+removeCount);
            var insert = slice.call(arguments, 2);
            var add = insert.length;            
            if (pos === length) {
                if (add) {
                    this.push.apply(this, insert);
                }
            } else {
                var remove = Math.min(removeCount, length - pos);
                var tailOldPos = pos + remove;
                var tailNewPos = tailOldPos + add - remove;
                var tailCount = length - tailOldPos;
                var lengthAfterRemove = length - remove;

                if (tailNewPos < tailOldPos) { // case A
                    for (var i = 0; i < tailCount; ++i) {
                        this[tailNewPos+i] = this[tailOldPos+i];
                    }
                } else if (tailNewPos > tailOldPos) { // case B
                    for (i = tailCount; i--; ) {
                        this[tailNewPos+i] = this[tailOldPos+i];
                    }
                } // else, add == remove (nothing to do)

                if (add && pos === lengthAfterRemove) {
                    this.length = lengthAfterRemove; // truncate array
                    this.push.apply(this, insert);
                } else {
                    this.length = lengthAfterRemove + add; // reserves space
                    for (i = 0; i < add; ++i) {
                        this[pos+i] = insert[i];
                    }
                }
            }
            return removed;
        };
    }
}
if (!Array.isArray) {
    Array.isArray = function isArray(obj) {
        return _toString(obj) == "[object Array]";
    };
}
var boxedString = Object("a"),
    splitString = boxedString[0] != "a" || !(0 in boxedString);

if (!Array.prototype.forEach) {
    Array.prototype.forEach = function forEach(fun /*, thisp*/) {
        var object = toObject(this),
            self = splitString && _toString(this) == "[object String]" ?
                this.split("") :
                object,
            thisp = arguments[1],
            i = -1,
            length = self.length >>> 0;
        if (_toString(fun) != "[object Function]") {
            throw new TypeError(); // TODO message
        }

        while (++i < length) {
            if (i in self) {
                fun.call(thisp, self[i], i, object);
            }
        }
    };
}
if (!Array.prototype.map) {
    Array.prototype.map = function map(fun /*, thisp*/) {
        var object = toObject(this),
            self = splitString && _toString(this) == "[object String]" ?
                this.split("") :
                object,
            length = self.length >>> 0,
            result = Array(length),
            thisp = arguments[1];
        if (_toString(fun) != "[object Function]") {
            throw new TypeError(fun + " is not a function");
        }

        for (var i = 0; i < length; i++) {
            if (i in self)
                result[i] = fun.call(thisp, self[i], i, object);
        }
        return result;
    };
}
if (!Array.prototype.filter) {
    Array.prototype.filter = function filter(fun /*, thisp */) {
        var object = toObject(this),
            self = splitString && _toString(this) == "[object String]" ?
                this.split("") :
                    object,
            length = self.length >>> 0,
            result = [],
            value,
            thisp = arguments[1];
        if (_toString(fun) != "[object Function]") {
            throw new TypeError(fun + " is not a function");
        }

        for (var i = 0; i < length; i++) {
            if (i in self) {
                value = self[i];
                if (fun.call(thisp, value, i, object)) {
                    result.push(value);
                }
            }
        }
        return result;
    };
}
if (!Array.prototype.every) {
    Array.prototype.every = function every(fun /*, thisp */) {
        var object = toObject(this),
            self = splitString && _toString(this) == "[object String]" ?
                this.split("") :
                object,
            length = self.length >>> 0,
            thisp = arguments[1];
        if (_toString(fun) != "[object Function]") {
            throw new TypeError(fun + " is not a function");
        }

        for (var i = 0; i < length; i++) {
            if (i in self && !fun.call(thisp, self[i], i, object)) {
                return false;
            }
        }
        return true;
    };
}
if (!Array.prototype.some) {
    Array.prototype.some = function some(fun /*, thisp */) {
        var object = toObject(this),
            self = splitString && _toString(this) == "[object String]" ?
                this.split("") :
                object,
            length = self.length >>> 0,
            thisp = arguments[1];
        if (_toString(fun) != "[object Function]") {
            throw new TypeError(fun + " is not a function");
        }

        for (var i = 0; i < length; i++) {
            if (i in self && fun.call(thisp, self[i], i, object)) {
                return true;
            }
        }
        return false;
    };
}
if (!Array.prototype.reduce) {
    Array.prototype.reduce = function reduce(fun /*, initial*/) {
        var object = toObject(this),
            self = splitString && _toString(this) == "[object String]" ?
                this.split("") :
                object,
            length = self.length >>> 0;
        if (_toString(fun) != "[object Function]") {
            throw new TypeError(fun + " is not a function");
        }
        if (!length && arguments.length == 1) {
            throw new TypeError("reduce of empty array with no initial value");
        }

        var i = 0;
        var result;
        if (arguments.length >= 2) {
            result = arguments[1];
        } else {
            do {
                if (i in self) {
                    result = self[i++];
                    break;
                }
                if (++i >= length) {
                    throw new TypeError("reduce of empty array with no initial value");
                }
            } while (true);
        }

        for (; i < length; i++) {
            if (i in self) {
                result = fun.call(void 0, result, self[i], i, object);
            }
        }

        return result;
    };
}
if (!Array.prototype.reduceRight) {
    Array.prototype.reduceRight = function reduceRight(fun /*, initial*/) {
        var object = toObject(this),
            self = splitString && _toString(this) == "[object String]" ?
                this.split("") :
                object,
            length = self.length >>> 0;
        if (_toString(fun) != "[object Function]") {
            throw new TypeError(fun + " is not a function");
        }
        if (!length && arguments.length == 1) {
            throw new TypeError("reduceRight of empty array with no initial value");
        }

        var result, i = length - 1;
        if (arguments.length >= 2) {
            result = arguments[1];
        } else {
            do {
                if (i in self) {
                    result = self[i--];
                    break;
                }
                if (--i < 0) {
                    throw new TypeError("reduceRight of empty array with no initial value");
                }
            } while (true);
        }

        do {
            if (i in this) {
                result = fun.call(void 0, result, self[i], i, object);
            }
        } while (i--);

        return result;
    };
}
if (!Array.prototype.indexOf || ([0, 1].indexOf(1, 2) != -1)) {
    Array.prototype.indexOf = function indexOf(sought /*, fromIndex */ ) {
        var self = splitString && _toString(this) == "[object String]" ?
                this.split("") :
                toObject(this),
            length = self.length >>> 0;

        if (!length) {
            return -1;
        }

        var i = 0;
        if (arguments.length > 1) {
            i = toInteger(arguments[1]);
        }
        i = i >= 0 ? i : Math.max(0, length + i);
        for (; i < length; i++) {
            if (i in self && self[i] === sought) {
                return i;
            }
        }
        return -1;
    };
}
if (!Array.prototype.lastIndexOf || ([0, 1].lastIndexOf(0, -3) != -1)) {
    Array.prototype.lastIndexOf = function lastIndexOf(sought /*, fromIndex */) {
        var self = splitString && _toString(this) == "[object String]" ?
                this.split("") :
                toObject(this),
            length = self.length >>> 0;

        if (!length) {
            return -1;
        }
        var i = length - 1;
        if (arguments.length > 1) {
            i = Math.min(i, toInteger(arguments[1]));
        }
        i = i >= 0 ? i : length - Math.abs(i);
        for (; i >= 0; i--) {
            if (i in self && sought === self[i]) {
                return i;
            }
        }
        return -1;
    };
}
if (!Object.getPrototypeOf) {
    Object.getPrototypeOf = function getPrototypeOf(object) {
        return object.__proto__ || (
            object.constructor ?
            object.constructor.prototype :
            prototypeOfObject
        );
    };
}
if (!Object.getOwnPropertyDescriptor) {
    var ERR_NON_OBJECT = "Object.getOwnPropertyDescriptor called on a " +
                         "non-object: ";
    Object.getOwnPropertyDescriptor = function getOwnPropertyDescriptor(object, property) {
        if ((typeof object != "object" && typeof object != "function") || object === null)
            throw new TypeError(ERR_NON_OBJECT + object);
        if (!owns(object, property))
            return;

        var descriptor, getter, setter;
        descriptor =  { enumerable: true, configurable: true };
        if (supportsAccessors) {
            var prototype = object.__proto__;
            object.__proto__ = prototypeOfObject;

            var getter = lookupGetter(object, property);
            var setter = lookupSetter(object, property);
            object.__proto__ = prototype;

            if (getter || setter) {
                if (getter) descriptor.get = getter;
                if (setter) descriptor.set = setter;
                return descriptor;
            }
        }
        descriptor.value = object[property];
        return descriptor;
    };
}
if (!Object.getOwnPropertyNames) {
    Object.getOwnPropertyNames = function getOwnPropertyNames(object) {
        return Object.keys(object);
    };
}
if (!Object.create) {
    var createEmpty;
    if (Object.prototype.__proto__ === null) {
        createEmpty = function () {
            return { "__proto__": null };
        };
    } else {
        createEmpty = function () {
            var empty = {};
            for (var i in empty)
                empty[i] = null;
            empty.constructor =
            empty.hasOwnProperty =
            empty.propertyIsEnumerable =
            empty.isPrototypeOf =
            empty.toLocaleString =
            empty.toString =
            empty.valueOf =
            empty.__proto__ = null;
            return empty;
        }
    }

    Object.create = function create(prototype, properties) {
        var object;
        if (prototype === null) {
            object = createEmpty();
        } else {
            if (typeof prototype != "object")
                throw new TypeError("typeof prototype["+(typeof prototype)+"] != 'object'");
            var Type = function () {};
            Type.prototype = prototype;
            object = new Type();
            object.__proto__ = prototype;
        }
        if (properties !== void 0)
            Object.defineProperties(object, properties);
        return object;
    };
}

function doesDefinePropertyWork(object) {
    try {
        Object.defineProperty(object, "sentinel", {});
        return "sentinel" in object;
    } catch (exception) {
    }
}
if (Object.defineProperty) {
    var definePropertyWorksOnObject = doesDefinePropertyWork({});
    var definePropertyWorksOnDom = typeof document == "undefined" ||
        doesDefinePropertyWork(document.createElement("div"));
    if (!definePropertyWorksOnObject || !definePropertyWorksOnDom) {
        var definePropertyFallback = Object.defineProperty;
    }
}

if (!Object.defineProperty || definePropertyFallback) {
    var ERR_NON_OBJECT_DESCRIPTOR = "Property description must be an object: ";
    var ERR_NON_OBJECT_TARGET = "Object.defineProperty called on non-object: "
    var ERR_ACCESSORS_NOT_SUPPORTED = "getters & setters can not be defined " +
                                      "on this javascript engine";

    Object.defineProperty = function defineProperty(object, property, descriptor) {
        if ((typeof object != "object" && typeof object != "function") || object === null)
            throw new TypeError(ERR_NON_OBJECT_TARGET + object);
        if ((typeof descriptor != "object" && typeof descriptor != "function") || descriptor === null)
            throw new TypeError(ERR_NON_OBJECT_DESCRIPTOR + descriptor);
        if (definePropertyFallback) {
            try {
                return definePropertyFallback.call(Object, object, property, descriptor);
            } catch (exception) {
            }
        }
        if (owns(descriptor, "value")) {

            if (supportsAccessors && (lookupGetter(object, property) ||
                                      lookupSetter(object, property)))
            {
                var prototype = object.__proto__;
                object.__proto__ = prototypeOfObject;
                delete object[property];
                object[property] = descriptor.value;
                object.__proto__ = prototype;
            } else {
                object[property] = descriptor.value;
            }
        } else {
            if (!supportsAccessors)
                throw new TypeError(ERR_ACCESSORS_NOT_SUPPORTED);
            if (owns(descriptor, "get"))
                defineGetter(object, property, descriptor.get);
            if (owns(descriptor, "set"))
                defineSetter(object, property, descriptor.set);
        }

        return object;
    };
}
if (!Object.defineProperties) {
    Object.defineProperties = function defineProperties(object, properties) {
        for (var property in properties) {
            if (owns(properties, property))
                Object.defineProperty(object, property, properties[property]);
        }
        return object;
    };
}
if (!Object.seal) {
    Object.seal = function seal(object) {
        return object;
    };
}
if (!Object.freeze) {
    Object.freeze = function freeze(object) {
        return object;
    };
}
try {
    Object.freeze(function () {});
} catch (exception) {
    Object.freeze = (function freeze(freezeObject) {
        return function freeze(object) {
            if (typeof object == "function") {
                return object;
            } else {
                return freezeObject(object);
            }
        };
    })(Object.freeze);
}
if (!Object.preventExtensions) {
    Object.preventExtensions = function preventExtensions(object) {
        return object;
    };
}
if (!Object.isSealed) {
    Object.isSealed = function isSealed(object) {
        return false;
    };
}
if (!Object.isFrozen) {
    Object.isFrozen = function isFrozen(object) {
        return false;
    };
}
if (!Object.isExtensible) {
    Object.isExtensible = function isExtensible(object) {
        if (Object(object) === object) {
            throw new TypeError(); // TODO message
        }
        var name = '';
        while (owns(object, name)) {
            name += '?';
        }
        object[name] = true;
        var returnValue = owns(object, name);
        delete object[name];
        return returnValue;
    };
}
if (!Object.keys) {
    var hasDontEnumBug = true,
        dontEnums = [
            "toString",
            "toLocaleString",
            "valueOf",
            "hasOwnProperty",
            "isPrototypeOf",
            "propertyIsEnumerable",
            "constructor"
        ],
        dontEnumsLength = dontEnums.length;

    for (var key in {"toString": null}) {
        hasDontEnumBug = false;
    }

    Object.keys = function keys(object) {

        if (
            (typeof object != "object" && typeof object != "function") ||
            object === null
        ) {
            throw new TypeError("Object.keys called on a non-object");
        }

        var keys = [];
        for (var name in object) {
            if (owns(object, name)) {
                keys.push(name);
            }
        }

        if (hasDontEnumBug) {
            for (var i = 0, ii = dontEnumsLength; i < ii; i++) {
                var dontEnum = dontEnums[i];
                if (owns(object, dontEnum)) {
                    keys.push(dontEnum);
                }
            }
        }
        return keys;
    };

}
if (!Date.now) {
    Date.now = function now() {
        return new Date().getTime();
    };
}
var ws = "\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003" +
    "\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028" +
    "\u2029\uFEFF";
if (!String.prototype.trim || ws.trim()) {
    ws = "[" + ws + "]";
    var trimBeginRegexp = new RegExp("^" + ws + ws + "*"),
        trimEndRegexp = new RegExp(ws + ws + "*$");
    String.prototype.trim = function trim() {
        return String(this).replace(trimBeginRegexp, "").replace(trimEndRegexp, "");
    };
}

function toInteger(n) {
    n = +n;
    if (n !== n) { // isNaN
        n = 0;
    } else if (n !== 0 && n !== (1/0) && n !== -(1/0)) {
        n = (n > 0 || -1) * Math.floor(Math.abs(n));
    }
    return n;
}

function isPrimitive(input) {
    var type = typeof input;
    return (
        input === null ||
        type === "undefined" ||
        type === "boolean" ||
        type === "number" ||
        type === "string"
    );
}

function toPrimitive(input) {
    var val, valueOf, toString;
    if (isPrimitive(input)) {
        return input;
    }
    valueOf = input.valueOf;
    if (typeof valueOf === "function") {
        val = valueOf.call(input);
        if (isPrimitive(val)) {
            return val;
        }
    }
    toString = input.toString;
    if (typeof toString === "function") {
        val = toString.call(input);
        if (isPrimitive(val)) {
            return val;
        }
    }
    throw new TypeError();
}
var toObject = function (o) {
    if (o == null) { // this matches both null and undefined
        throw new TypeError("can't convert "+o+" to object");
    }
    return Object(o);
};

});

ace.define("ace/lib/fixoldbrowsers",["require","exports","module","ace/lib/regexp","ace/lib/es5-shim"], function(require, exports, module) {
"use strict";

require("./regexp");
require("./es5-shim");

});

ace.define("ace/lib/dom",["require","exports","module"], function(require, exports, module) {
"use strict";

var XHTML_NS = "http://www.w3.org/1999/xhtml";

exports.getDocumentHead = function(doc) {
    if (!doc)
        doc = document;
    return doc.head || doc.getElementsByTagName("head")[0] || doc.documentElement;
};

exports.createElement = function(tag, ns) {
    return document.createElementNS ?
           document.createElementNS(ns || XHTML_NS, tag) :
           document.createElement(tag);
};

exports.hasCssClass = function(el, name) {
    var classes = (el.className + "").split(/\s+/g);
    return classes.indexOf(name) !== -1;
};
exports.addCssClass = function(el, name) {
    if (!exports.hasCssClass(el, name)) {
        el.className += " " + name;
    }
};
exports.removeCssClass = function(el, name) {
    var classes = el.className.split(/\s+/g);
    while (true) {
        var index = classes.indexOf(name);
        if (index == -1) {
            break;
        }
        classes.splice(index, 1);
    }
    el.className = classes.join(" ");
};

exports.toggleCssClass = function(el, name) {
    var classes = el.className.split(/\s+/g), add = true;
    while (true) {
        var index = classes.indexOf(name);
        if (index == -1) {
            break;
        }
        add = false;
        classes.splice(index, 1);
    }
    if (add)
        classes.push(name);

    el.className = classes.join(" ");
    return add;
};
exports.setCssClass = function(node, className, include) {
    if (include) {
        exports.addCssClass(node, className);
    } else {
        exports.removeCssClass(node, className);
    }
};

exports.hasCssString = function(id, doc) {
    var index = 0, sheets;
    doc = doc || document;

    if (doc.createStyleSheet && (sheets = doc.styleSheets)) {
        while (index < sheets.length)
            if (sheets[index++].owningElement.id === id) return true;
    } else if ((sheets = doc.getElementsByTagName("style"))) {
        while (index < sheets.length)
            if (sheets[index++].id === id) return true;
    }

    return false;
};

exports.importCssString = function importCssString(cssText, id, doc) {
    doc = doc || document;
    if (id && exports.hasCssString(id, doc))
        return null;
    
    var style;
    
    if (id)
        cssText += "\n/*# sourceURL=ace/css/" + id + " */";
    
    if (doc.createStyleSheet) {
        style = doc.createStyleSheet();
        style.cssText = cssText;
        if (id)
            style.owningElement.id = id;
    } else {
        style = exports.createElement("style");
        style.appendChild(doc.createTextNode(cssText));
        if (id)
            style.id = id;

        exports.getDocumentHead(doc).appendChild(style);
    }
};

exports.importCssStylsheet = function(uri, doc) {
    if (doc.createStyleSheet) {
        doc.createStyleSheet(uri);
    } else {
        var link = exports.createElement('link');
        link.rel = 'stylesheet';
        link.href = uri;

        exports.getDocumentHead(doc).appendChild(link);
    }
};

exports.getInnerWidth = function(element) {
    return (
        parseInt(exports.computedStyle(element, "paddingLeft"), 10) +
        parseInt(exports.computedStyle(element, "paddingRight"), 10) + 
        element.clientWidth
    );
};

exports.getInnerHeight = function(element) {
    return (
        parseInt(exports.computedStyle(element, "paddingTop"), 10) +
        parseInt(exports.computedStyle(element, "paddingBottom"), 10) +
        element.clientHeight
    );
};

exports.scrollbarWidth = function(document) {
    var inner = exports.createElement("ace_inner");
    inner.style.width = "100%";
    inner.style.minWidth = "0px";
    inner.style.height = "200px";
    inner.style.display = "block";

    var outer = exports.createElement("ace_outer");
    var style = outer.style;

    style.position = "absolute";
    style.left = "-10000px";
    style.overflow = "hidden";
    style.width = "200px";
    style.minWidth = "0px";
    style.height = "150px";
    style.display = "block";

    outer.appendChild(inner);

    var body = document.documentElement;
    body.appendChild(outer);

    var noScrollbar = inner.offsetWidth;

    style.overflow = "scroll";
    var withScrollbar = inner.offsetWidth;

    if (noScrollbar == withScrollbar) {
        withScrollbar = outer.clientWidth;
    }

    body.removeChild(outer);

    return noScrollbar-withScrollbar;
};

if (typeof document == "undefined") {
    exports.importCssString = function() {};
    return;
}

if (window.pageYOffset !== undefined) {
    exports.getPageScrollTop = function() {
        return window.pageYOffset;
    };

    exports.getPageScrollLeft = function() {
        return window.pageXOffset;
    };
}
else {
    exports.getPageScrollTop = function() {
        return document.body.scrollTop;
    };

    exports.getPageScrollLeft = function() {
        return document.body.scrollLeft;
    };
}

if (window.getComputedStyle)
    exports.computedStyle = function(element, style) {
        if (style)
            return (window.getComputedStyle(element, "") || {})[style] || "";
        return window.getComputedStyle(element, "") || {};
    };
else
    exports.computedStyle = function(element, style) {
        if (style)
            return element.currentStyle[style];
        return element.currentStyle;
    };
exports.setInnerHtml = function(el, innerHtml) {
    var element = el.cloneNode(false);//document.createElement("div");
    element.innerHTML = innerHtml;
    el.parentNode.replaceChild(element, el);
    return element;
};

if ("textContent" in document.documentElement) {
    exports.setInnerText = function(el, innerText) {
        el.textContent = innerText;
    };

    exports.getInnerText = function(el) {
        return el.textContent;
    };
}
else {
    exports.setInnerText = function(el, innerText) {
        el.innerText = innerText;
    };

    exports.getInnerText = function(el) {
        return el.innerText;
    };
}

exports.getParentWindow = function(document) {
    return document.defaultView || document.parentWindow;
};

});

ace.define("ace/lib/oop",["require","exports","module"], function(require, exports, module) {
"use strict";

exports.inherits = function(ctor, superCtor) {
    ctor.super_ = superCtor;
    ctor.prototype = Object.create(superCtor.prototype, {
        constructor: {
            value: ctor,
            enumerable: false,
            writable: true,
            configurable: true
        }
    });
};

exports.mixin = function(obj, mixin) {
    for (var key in mixin) {
        obj[key] = mixin[key];
    }
    return obj;
};

exports.implement = function(proto, mixin) {
    exports.mixin(proto, mixin);
};

});

ace.define("ace/lib/keys",["require","exports","module","ace/lib/fixoldbrowsers","ace/lib/oop"], function(require, exports, module) {
"use strict";

require("./fixoldbrowsers");

var oop = require("./oop");
var Keys = (function() {
    var ret = {
        MODIFIER_KEYS: {
            16: 'Shift', 17: 'Ctrl', 18: 'Alt', 224: 'Meta'
        },

        KEY_MODS: {
            "ctrl": 1, "alt": 2, "option" : 2, "shift": 4,
            "super": 8, "meta": 8, "command": 8, "cmd": 8
        },

        FUNCTION_KEYS : {
            8  : "Backspace",
            9  : "Tab",
            13 : "Return",
            19 : "Pause",
            27 : "Esc",
            32 : "Space",
            33 : "PageUp",
            34 : "PageDown",
            35 : "End",
            36 : "Home",
            37 : "Left",
            38 : "Up",
            39 : "Right",
            40 : "Down",
            44 : "Print",
            45 : "Insert",
            46 : "Delete",
            96 : "Numpad0",
            97 : "Numpad1",
            98 : "Numpad2",
            99 : "Numpad3",
            100: "Numpad4",
            101: "Numpad5",
            102: "Numpad6",
            103: "Numpad7",
            104: "Numpad8",
            105: "Numpad9",
            '-13': "NumpadEnter",
            112: "F1",
            113: "F2",
            114: "F3",
            115: "F4",
            116: "F5",
            117: "F6",
            118: "F7",
            119: "F8",
            120: "F9",
            121: "F10",
            122: "F11",
            123: "F12",
            144: "Numlock",
            145: "Scrolllock"
        },

        PRINTABLE_KEYS: {
           32: ' ',  48: '0',  49: '1',  50: '2',  51: '3',  52: '4', 53:  '5',
           54: '6',  55: '7',  56: '8',  57: '9',  59: ';',  61: '=', 65:  'a',
           66: 'b',  67: 'c',  68: 'd',  69: 'e',  70: 'f',  71: 'g', 72:  'h',
           73: 'i',  74: 'j',  75: 'k',  76: 'l',  77: 'm',  78: 'n', 79:  'o',
           80: 'p',  81: 'q',  82: 'r',  83: 's',  84: 't',  85: 'u', 86:  'v',
           87: 'w',  88: 'x',  89: 'y',  90: 'z', 107: '+', 109: '-', 110: '.',
          186: ';', 187: '=', 188: ',', 189: '-', 190: '.', 191: '/', 192: '`',
          219: '[', 220: '\\',221: ']', 222: "'", 111: '/', 106: '*'
        }
    };
    var name, i;
    for (i in ret.FUNCTION_KEYS) {
        name = ret.FUNCTION_KEYS[i].toLowerCase();
        ret[name] = parseInt(i, 10);
    }
    for (i in ret.PRINTABLE_KEYS) {
        name = ret.PRINTABLE_KEYS[i].toLowerCase();
        ret[name] = parseInt(i, 10);
    }
    oop.mixin(ret, ret.MODIFIER_KEYS);
    oop.mixin(ret, ret.PRINTABLE_KEYS);
    oop.mixin(ret, ret.FUNCTION_KEYS);
    ret.enter = ret["return"];
    ret.escape = ret.esc;
    ret.del = ret["delete"];
    ret[173] = '-';
    
    (function() {
        var mods = ["cmd", "ctrl", "alt", "shift"];
        for (var i = Math.pow(2, mods.length); i--;) {            
            ret.KEY_MODS[i] = mods.filter(function(x) {
                return i & ret.KEY_MODS[x];
            }).join("-") + "-";
        }
    })();

    ret.KEY_MODS[0] = "";
    ret.KEY_MODS[-1] = "input-";

    return ret;
})();
oop.mixin(exports, Keys);

exports.keyCodeToString = function(keyCode) {
    var keyString = Keys[keyCode];
    if (typeof keyString != "string")
        keyString = String.fromCharCode(keyCode);
    return keyString.toLowerCase();
};

});

ace.define("ace/lib/useragent",["require","exports","module"], function(require, exports, module) {
"use strict";
exports.OS = {
    LINUX: "LINUX",
    MAC: "MAC",
    WINDOWS: "WINDOWS"
};
exports.getOS = function() {
    if (exports.isMac) {
        return exports.OS.MAC;
    } else if (exports.isLinux) {
        return exports.OS.LINUX;
    } else {
        return exports.OS.WINDOWS;
    }
};
if (typeof navigator != "object")
    return;

var os = (navigator.platform.match(/mac|win|linux/i) || ["other"])[0].toLowerCase();
var ua = navigator.userAgent;
exports.isWin = (os == "win");
exports.isMac = (os == "mac");
exports.isLinux = (os == "linux");
exports.isIE = 
    (navigator.appName == "Microsoft Internet Explorer" || navigator.appName.indexOf("MSAppHost") >= 0)
    ? parseFloat((ua.match(/(?:MSIE |Trident\/[0-9]+[\.0-9]+;.*rv:)([0-9]+[\.0-9]+)/)||[])[1])
    : parseFloat((ua.match(/(?:Trident\/[0-9]+[\.0-9]+;.*rv:)([0-9]+[\.0-9]+)/)||[])[1]); // for ie
    
exports.isOldIE = exports.isIE && exports.isIE < 9;
exports.isGecko = exports.isMozilla = (window.Controllers || window.controllers) && window.navigator.product === "Gecko";
exports.isOldGecko = exports.isGecko && parseInt((ua.match(/rv:(\d+)/)||[])[1], 10) < 4;
exports.isOpera = window.opera && Object.prototype.toString.call(window.opera) == "[object Opera]";
exports.isWebKit = parseFloat(ua.split("WebKit/")[1]) || undefined;

exports.isChrome = parseFloat(ua.split(" Chrome/")[1]) || undefined;

exports.isAIR = ua.indexOf("AdobeAIR") >= 0;

exports.isIPad = ua.indexOf("iPad") >= 0;

exports.isChromeOS = ua.indexOf(" CrOS ") >= 0;

exports.isIOS = /iPad|iPhone|iPod/.test(ua) && !window.MSStream;

if (exports.isIOS) exports.isMac = true;

});

ace.define("ace/lib/event",["require","exports","module","ace/lib/keys","ace/lib/useragent"], function(require, exports, module) {
"use strict";

var keys = require("./keys");
var useragent = require("./useragent");

var pressedKeys = null;
var ts = 0;

exports.addListener = function(elem, type, callback) {
    if (elem.addEventListener) {
        return elem.addEventListener(type, callback, false);
    }
    if (elem.attachEvent) {
        var wrapper = function() {
            callback.call(elem, window.event);
        };
        callback._wrapper = wrapper;
        elem.attachEvent("on" + type, wrapper);
    }
};

exports.removeListener = function(elem, type, callback) {
    if (elem.removeEventListener) {
        return elem.removeEventListener(type, callback, false);
    }
    if (elem.detachEvent) {
        elem.detachEvent("on" + type, callback._wrapper || callback);
    }
};
exports.stopEvent = function(e) {
    exports.stopPropagation(e);
    exports.preventDefault(e);
    return false;
};

exports.stopPropagation = function(e) {
    if (e.stopPropagation)
        e.stopPropagation();
    else
        e.cancelBubble = true;
};

exports.preventDefault = function(e) {
    if (e.preventDefault)
        e.preventDefault();
    else
        e.returnValue = false;
};
exports.getButton = function(e) {
    if (e.type == "dblclick")
        return 0;
    if (e.type == "contextmenu" || (useragent.isMac && (e.ctrlKey && !e.altKey && !e.shiftKey)))
        return 2;
    if (e.preventDefault) {
        return e.button;
    }
    else {
        return {1:0, 2:2, 4:1}[e.button];
    }
};

exports.capture = function(el, eventHandler, releaseCaptureHandler) {
    function onMouseUp(e) {
        eventHandler && eventHandler(e);
        releaseCaptureHandler && releaseCaptureHandler(e);

        exports.removeListener(document, "mousemove", eventHandler, true);
        exports.removeListener(document, "mouseup", onMouseUp, true);
        exports.removeListener(document, "dragstart", onMouseUp, true);
    }

    exports.addListener(document, "mousemove", eventHandler, true);
    exports.addListener(document, "mouseup", onMouseUp, true);
    exports.addListener(document, "dragstart", onMouseUp, true);
    
    return onMouseUp;
};

exports.addTouchMoveListener = function (el, callback) {
    var startx, starty;
    exports.addListener(el, "touchstart", function (e) {
        var touches = e.touches;
        var touchObj = touches[0];
        startx = touchObj.clientX;
        starty = touchObj.clientY;
    });
    exports.addListener(el, "touchmove", function (e) {
        var touches = e.touches;
        if (touches.length > 1) return;
        
        var touchObj = touches[0];

        e.wheelX = startx - touchObj.clientX;
        e.wheelY = starty - touchObj.clientY;

        startx = touchObj.clientX;
        starty = touchObj.clientY;

        callback(e);
    });
};

exports.addMouseWheelListener = function(el, callback) {
    if ("onmousewheel" in el) {
        exports.addListener(el, "mousewheel", function(e) {
            var factor = 8;
            if (e.wheelDeltaX !== undefined) {
                e.wheelX = -e.wheelDeltaX / factor;
                e.wheelY = -e.wheelDeltaY / factor;
            } else {
                e.wheelX = 0;
                e.wheelY = -e.wheelDelta / factor;
            }
            callback(e);
        });
    } else if ("onwheel" in el) {
        exports.addListener(el, "wheel",  function(e) {
            var factor = 0.35;
            switch (e.deltaMode) {
                case e.DOM_DELTA_PIXEL:
                    e.wheelX = e.deltaX * factor || 0;
                    e.wheelY = e.deltaY * factor || 0;
                    break;
                case e.DOM_DELTA_LINE:
                case e.DOM_DELTA_PAGE:
                    e.wheelX = (e.deltaX || 0) * 5;
                    e.wheelY = (e.deltaY || 0) * 5;
                    break;
            }
            
            callback(e);
        });
    } else {
        exports.addListener(el, "DOMMouseScroll", function(e) {
            if (e.axis && e.axis == e.HORIZONTAL_AXIS) {
                e.wheelX = (e.detail || 0) * 5;
                e.wheelY = 0;
            } else {
                e.wheelX = 0;
                e.wheelY = (e.detail || 0) * 5;
            }
            callback(e);
        });
    }
};

exports.addMultiMouseDownListener = function(elements, timeouts, eventHandler, callbackName) {
    var clicks = 0;
    var startX, startY, timer; 
    var eventNames = {
        2: "dblclick",
        3: "tripleclick",
        4: "quadclick"
    };

    function onMousedown(e) {
        if (exports.getButton(e) !== 0) {
            clicks = 0;
        } else if (e.detail > 1) {
            clicks++;
            if (clicks > 4)
                clicks = 1;
        } else {
            clicks = 1;
        }
        if (useragent.isIE) {
            var isNewClick = Math.abs(e.clientX - startX) > 5 || Math.abs(e.clientY - startY) > 5;
            if (!timer || isNewClick)
                clicks = 1;
            if (timer)
                clearTimeout(timer);
            timer = setTimeout(function() {timer = null;}, timeouts[clicks - 1] || 600);

            if (clicks == 1) {
                startX = e.clientX;
                startY = e.clientY;
            }
        }
        
        e._clicks = clicks;

        eventHandler[callbackName]("mousedown", e);

        if (clicks > 4)
            clicks = 0;
        else if (clicks > 1)
            return eventHandler[callbackName](eventNames[clicks], e);
    }
    function onDblclick(e) {
        clicks = 2;
        if (timer)
            clearTimeout(timer);
        timer = setTimeout(function() {timer = null;}, timeouts[clicks - 1] || 600);
        eventHandler[callbackName]("mousedown", e);
        eventHandler[callbackName](eventNames[clicks], e);
    }
    if (!Array.isArray(elements))
        elements = [elements];
    elements.forEach(function(el) {
        exports.addListener(el, "mousedown", onMousedown);
        if (useragent.isOldIE)
            exports.addListener(el, "dblclick", onDblclick);
    });
};

var getModifierHash = useragent.isMac && useragent.isOpera && !("KeyboardEvent" in window)
    ? function(e) {
        return 0 | (e.metaKey ? 1 : 0) | (e.altKey ? 2 : 0) | (e.shiftKey ? 4 : 0) | (e.ctrlKey ? 8 : 0);
    }
    : function(e) {
        return 0 | (e.ctrlKey ? 1 : 0) | (e.altKey ? 2 : 0) | (e.shiftKey ? 4 : 0) | (e.metaKey ? 8 : 0);
    };

exports.getModifierString = function(e) {
    return keys.KEY_MODS[getModifierHash(e)];
};

function normalizeCommandKeys(callback, e, keyCode) {
    var hashId = getModifierHash(e);

    if (!useragent.isMac && pressedKeys) {
        if (e.getModifierState && (e.getModifierState("OS") || e.getModifierState("Win")))
            hashId |= 8;
        if (pressedKeys.altGr) {
            if ((3 & hashId) != 3)
                pressedKeys.altGr = 0;
            else
                return;
        }
        if (keyCode === 18 || keyCode === 17) {
            var location = "location" in e ? e.location : e.keyLocation;
            if (keyCode === 17 && location === 1) {
                if (pressedKeys[keyCode] == 1)
                    ts = e.timeStamp;
            } else if (keyCode === 18 && hashId === 3 && location === 2) {
                var dt = e.timeStamp - ts;
                if (dt < 50)
                    pressedKeys.altGr = true;
            }
        }
    }
    
    if (keyCode in keys.MODIFIER_KEYS) {
        keyCode = -1;
    }
    if (hashId & 8 && (keyCode >= 91 && keyCode <= 93)) {
        keyCode = -1;
    }
    
    if (!hashId && keyCode === 13) {
        var location = "location" in e ? e.location : e.keyLocation;
        if (location === 3) {
            callback(e, hashId, -keyCode);
            if (e.defaultPrevented)
                return;
        }
    }
    
    if (useragent.isChromeOS && hashId & 8) {
        callback(e, hashId, keyCode);
        if (e.defaultPrevented)
            return;
        else
            hashId &= ~8;
    }
    if (!hashId && !(keyCode in keys.FUNCTION_KEYS) && !(keyCode in keys.PRINTABLE_KEYS)) {
        return false;
    }
    
    return callback(e, hashId, keyCode);
}


exports.addCommandKeyListener = function(el, callback) {
    var addListener = exports.addListener;
    if (useragent.isOldGecko || (useragent.isOpera && !("KeyboardEvent" in window))) {
        var lastKeyDownKeyCode = null;
        addListener(el, "keydown", function(e) {
            lastKeyDownKeyCode = e.keyCode;
        });
        addListener(el, "keypress", function(e) {
            return normalizeCommandKeys(callback, e, lastKeyDownKeyCode);
        });
    } else {
        var lastDefaultPrevented = null;

        addListener(el, "keydown", function(e) {
            pressedKeys[e.keyCode] = (pressedKeys[e.keyCode] || 0) + 1;
            var result = normalizeCommandKeys(callback, e, e.keyCode);
            lastDefaultPrevented = e.defaultPrevented;
            return result;
        });

        addListener(el, "keypress", function(e) {
            if (lastDefaultPrevented && (e.ctrlKey || e.altKey || e.shiftKey || e.metaKey)) {
                exports.stopEvent(e);
                lastDefaultPrevented = null;
            }
        });

        addListener(el, "keyup", function(e) {
            pressedKeys[e.keyCode] = null;
        });

        if (!pressedKeys) {
            resetPressedKeys();
            addListener(window, "focus", resetPressedKeys);
        }
    }
};
function resetPressedKeys() {
    pressedKeys = Object.create(null);
}

if (typeof window == "object" && window.postMessage && !useragent.isOldIE) {
    var postMessageId = 1;
    exports.nextTick = function(callback, win) {
        win = win || window;
        var messageName = "zero-timeout-message-" + postMessageId;
        exports.addListener(win, "message", function listener(e) {
            if (e.data == messageName) {
                exports.stopPropagation(e);
                exports.removeListener(win, "message", listener);
                callback();
            }
        });
        win.postMessage(messageName, "*");
    };
}


exports.nextFrame = typeof window == "object" && (window.requestAnimationFrame
    || window.mozRequestAnimationFrame
    || window.webkitRequestAnimationFrame
    || window.msRequestAnimationFrame
    || window.oRequestAnimationFrame);

if (exports.nextFrame)
    exports.nextFrame = exports.nextFrame.bind(window);
else
    exports.nextFrame = function(callback) {
        setTimeout(callback, 17);
    };
});

ace.define("ace/lib/lang",["require","exports","module"], function(require, exports, module) {
"use strict";

exports.last = function(a) {
    return a[a.length - 1];
};

exports.stringReverse = function(string) {
    return string.split("").reverse().join("");
};

exports.stringRepeat = function (string, count) {
    var result = '';
    while (count > 0) {
        if (count & 1)
            result += string;

        if (count >>= 1)
            string += string;
    }
    return result;
};

var trimBeginRegexp = /^\s\s*/;
var trimEndRegexp = /\s\s*$/;

exports.stringTrimLeft = function (string) {
    return string.replace(trimBeginRegexp, '');
};

exports.stringTrimRight = function (string) {
    return string.replace(trimEndRegexp, '');
};

exports.copyObject = function(obj) {
    var copy = {};
    for (var key in obj) {
        copy[key] = obj[key];
    }
    return copy;
};

exports.copyArray = function(array){
    var copy = [];
    for (var i=0, l=array.length; i<l; i++) {
        if (array[i] && typeof array[i] == "object")
            copy[i] = this.copyObject(array[i]);
        else 
            copy[i] = array[i];
    }
    return copy;
};

exports.deepCopy = function deepCopy(obj) {
    if (typeof obj !== "object" || !obj)
        return obj;
    var copy;
    if (Array.isArray(obj)) {
        copy = [];
        for (var key = 0; key < obj.length; key++) {
            copy[key] = deepCopy(obj[key]);
        }
        return copy;
    }
    if (Object.prototype.toString.call(obj) !== "[object Object]")
        return obj;
    
    copy = {};
    for (var key in obj)
        copy[key] = deepCopy(obj[key]);
    return copy;
};

exports.arrayToMap = function(arr) {
    var map = {};
    for (var i=0; i<arr.length; i++) {
        map[arr[i]] = 1;
    }
    return map;

};

exports.createMap = function(props) {
    var map = Object.create(null);
    for (var i in props) {
        map[i] = props[i];
    }
    return map;
};
exports.arrayRemove = function(array, value) {
  for (var i = 0; i <= array.length; i++) {
    if (value === array[i]) {
      array.splice(i, 1);
    }
  }
};

exports.escapeRegExp = function(str) {
    return str.replace(/([.*+?^${}()|[\]\/\\])/g, '\\$1');
};

exports.escapeHTML = function(str) {
    return str.replace(/&/g, "&#38;").replace(/"/g, "&#34;").replace(/'/g, "&#39;").replace(/</g, "&#60;");
};

exports.getMatchOffsets = function(string, regExp) {
    var matches = [];

    string.replace(regExp, function(str) {
        matches.push({
            offset: arguments[arguments.length-2],
            length: str.length
        });
    });

    return matches;
};
exports.deferredCall = function(fcn) {
    var timer = null;
    var callback = function() {
        timer = null;
        fcn();
    };

    var deferred = function(timeout) {
        deferred.cancel();
        timer = setTimeout(callback, timeout || 0);
        return deferred;
    };

    deferred.schedule = deferred;

    deferred.call = function() {
        this.cancel();
        fcn();
        return deferred;
    };

    deferred.cancel = function() {
        clearTimeout(timer);
        timer = null;
        return deferred;
    };
    
    deferred.isPending = function() {
        return timer;
    };

    return deferred;
};


exports.delayedCall = function(fcn, defaultTimeout) {
    var timer = null;
    var callback = function() {
        timer = null;
        fcn();
    };

    var _self = function(timeout) {
        if (timer == null)
            timer = setTimeout(callback, timeout || defaultTimeout);
    };

    _self.delay = function(timeout) {
        timer && clearTimeout(timer);
        timer = setTimeout(callback, timeout || defaultTimeout);
    };
    _self.schedule = _self;

    _self.call = function() {
        this.cancel();
        fcn();
    };

    _self.cancel = function() {
        timer && clearTimeout(timer);
        timer = null;
    };

    _self.isPending = function() {
        return timer;
    };

    return _self;
};
});

ace.define("ace/keyboard/textinput_ios",["require","exports","module","ace/lib/event","ace/lib/useragent","ace/lib/dom","ace/lib/lang","ace/lib/keys"], function(require, exports, module) {
"use strict";

var event = require("../lib/event");
var useragent = require("../lib/useragent");
var dom = require("../lib/dom");
var lang = require("../lib/lang");
var KEYS = require("../lib/keys");
var MODS = KEYS.KEY_MODS;
var BROKEN_SETDATA = useragent.isChrome < 18;
var USE_IE_MIME_TYPE =  useragent.isIE;

var TextInput = function(parentNode, host) {
    var self = this;
    var text = dom.createElement("textarea");
    text.className = useragent.isIOS ? "ace_text-input ace_text-input-ios" : "ace_text-input";

    if (useragent.isTouchPad)
        text.setAttribute("x-palm-disable-auto-cap", true);

    text.setAttribute("wrap", "off");
    text.setAttribute("autocorrect", "off");
    text.setAttribute("autocapitalize", "off");
    text.setAttribute("spellcheck", false);

    text.style.opacity = "0";
    parentNode.insertBefore(text, parentNode.firstChild);

    var PLACEHOLDER = "\n aaaa a\n";

    var copied = false;
    var cut = false;
    var pasted = false;
    var inComposition = false;
    var tempStyle = '';
    var isSelectionEmpty = true;
    try { var isFocused = document.activeElement === text; } catch(e) {}
    
    event.addListener(text, "blur", function(e) {
        host.onBlur(e);
        isFocused = false;
    });
    event.addListener(text, "focus", function(e) {
        isFocused = true;
        host.onFocus(e);
        resetSelection();
    });
    this.focus = function() {
        if (tempStyle) return text.focus();
        text.style.position = "fixed";
        text.focus();
    };
    this.blur = function() {
        text.blur();
    };
    this.isFocused = function() {
        return isFocused;
    };
    var syncSelection = lang.delayedCall(function() {
        isFocused && resetSelection(isSelectionEmpty);
    });
    var syncValue = lang.delayedCall(function() {
         if (!inComposition) {
            text.value = PLACEHOLDER;
            isFocused && resetSelection();
         }
    });

    function resetSelection(isEmpty) {
        if (inComposition)
            return;
        inComposition = true;
        
        if (inputHandler) {
            selectionStart = 0;
            selectionEnd = isEmpty ? 0 : text.value.length - 1;
        } else {
            var selectionStart = 4;
            var selectionEnd = 5;
        }
        try {
            text.setSelectionRange(selectionStart, selectionEnd);
        } catch(e) {}
        
        inComposition = false;
    }

    function resetValue() {
        if (inComposition)
            return;
        text.value = PLACEHOLDER;
        if (useragent.isWebKit)
            syncValue.schedule();
    }

    useragent.isWebKit || host.addEventListener('changeSelection', function() {
        if (host.selection.isEmpty() != isSelectionEmpty) {
            isSelectionEmpty = !isSelectionEmpty;
            syncSelection.schedule();
        }
    });

    resetValue();
    if (isFocused)
        host.onFocus();


    var isAllSelected = function(text) {
        return text.selectionStart === 0 && text.selectionEnd === text.value.length;
    };

    var onSelect = function(e) {
        if (isAllSelected(text)) {
            host.selectAll();
            resetSelection();
        } else if (inputHandler) {
            resetSelection(host.selection.isEmpty());
        }
    };

    var inputHandler = null;
    this.setInputHandler = function(cb) {inputHandler = cb;};
    this.getInputHandler = function() {return inputHandler;};
    var afterContextMenu = false;
    
    var sendText = function(data) {
        if (text.selectionStart === 4 && text.selectionEnd === 5) {
          return;
        }
        if (inputHandler) {
            data = inputHandler(data);
            inputHandler = null;
        }
        if (pasted) {
            resetSelection();
            if (data)
                host.onPaste(data);
            pasted = false;
        } else if (data == PLACEHOLDER.substr(0) && text.selectionStart === 4) {
            if (afterContextMenu)
                host.execCommand("del", {source: "ace"});
            else // some versions of android do not fire keydown when pressing backspace
                host.execCommand("backspace", {source: "ace"});
        } else if (!copied) {
            if (data.substring(0, 9) == PLACEHOLDER && data.length > PLACEHOLDER.length)
                data = data.substr(9);
            else if (data.substr(0, 4) == PLACEHOLDER.substr(0, 4))
                data = data.substr(4, data.length - PLACEHOLDER.length + 1);
            else if (data.charAt(data.length - 1) == PLACEHOLDER.charAt(0))
                data = data.slice(0, -1);
            if (data == PLACEHOLDER.charAt(0)) {
            } else if (data.charAt(data.length - 1) == PLACEHOLDER.charAt(0))
                data = data.slice(0, -1);
            
            if (data)
                host.onTextInput(data);
        }
        if (copied) {
          copied = false;
        }
        if (afterContextMenu)
            afterContextMenu = false;
    };
    var onInput = function(e) {
        if (inComposition)
            return;
        var data = text.value;
        sendText(data);
        resetValue();
    };
    
    var handleClipboardData = function(e, data, forceIEMime) {
        var clipboardData = e.clipboardData || window.clipboardData;
        if (!clipboardData || BROKEN_SETDATA)
            return;
        var mime = USE_IE_MIME_TYPE || forceIEMime ? "Text" : "text/plain";
        try {
            if (data) {
                return clipboardData.setData(mime, data) !== false;
            } else {
                return clipboardData.getData(mime);
            }
        } catch(e) {
            if (!forceIEMime)
                return handleClipboardData(e, data, true);
        }
    };

    var doCopy = function(e, isCut) {
        var data = host.getCopyText();
        if (!data)
            return event.preventDefault(e);

        if (handleClipboardData(e, data)) {
            if (useragent.isIOS) {
                cut = isCut;
                text.value = "\n aa" + data + "a a\n";
                text.setSelectionRange(4, 4 + data.length);
                copied = {
                    value: data
                };
            }
            isCut ? host.onCut() : host.onCopy();
            if (!useragent.isIOS) event.preventDefault(e);
        } else {
            copied = true;
            text.value = data;
            text.select();
            setTimeout(function(){
                copied = false;
                resetValue();
                resetSelection();
                isCut ? host.onCut() : host.onCopy();
            });
        }
    };
    
    var onCut = function(e) {
        doCopy(e, true);
    };
    
    var onCopy = function(e) {
        doCopy(e, false);
    };
    
    var onPaste = function(e) {
        var data = handleClipboardData(e);
        if (typeof data == "string") {
            if (data)
                host.onPaste(data, e);
            if (useragent.isIE)
                setTimeout(resetSelection);
            event.preventDefault(e);
        }
        else {
            text.value = "";
            pasted = true;
        }
    };

    event.addCommandKeyListener(text, host.onCommandKey.bind(host));

    event.addListener(text, "select", onSelect);

    event.addListener(text, "input", onInput);

    event.addListener(text, "cut", onCut);
    event.addListener(text, "copy", onCopy);
    event.addListener(text, "paste", onPaste);
    var onCompositionStart = function(e) {
        if (inComposition || !host.onCompositionStart || host.$readOnly) 
            return;
        inComposition = {};
        inComposition.canUndo = host.session.$undoManager;
        host.onCompositionStart();
        setTimeout(onCompositionUpdate, 0);
        host.on("mousedown", onCompositionEnd);
        if (inComposition.canUndo && !host.selection.isEmpty()) {
            host.insert("");
            host.session.markUndoGroup();
            host.selection.clearSelection();
        }
        host.session.markUndoGroup();
    };

    var onCompositionUpdate = function() {
        if (!inComposition || !host.onCompositionUpdate || host.$readOnly)
            return;
        var val = text.value.replace(/\x01/g, "");
        if (inComposition.lastValue === val) return;
        
        host.onCompositionUpdate(val);
        if (inComposition.lastValue)
            host.undo();
        if (inComposition.canUndo)
            inComposition.lastValue = val;
        if (inComposition.lastValue) {
            var r = host.selection.getRange();
            host.insert(inComposition.lastValue);
            host.session.markUndoGroup();
            inComposition.range = host.selection.getRange();
            host.selection.setRange(r);
            host.selection.clearSelection();
        }
    };

    var onCompositionEnd = function(e) {
        if (!host.onCompositionEnd || host.$readOnly) return;
        var c = inComposition;
        inComposition = false;
        var timer = setTimeout(function() {
            timer = null;
            var str = text.value.replace(/\x01/g, "");
            if (inComposition)
                return;
            else if (str == c.lastValue)
                resetValue();
            else if (!c.lastValue && str) {
                resetValue();
                sendText(str);
            }
        });
        inputHandler = function compositionInputHandler(str) {
            if (timer)
                clearTimeout(timer);
            str = str.replace(/\x01/g, "");
            if (str == c.lastValue)
                return "";
            if (c.lastValue && timer)
                host.undo();
            return str;
        };
        host.onCompositionEnd();
        host.removeListener("mousedown", onCompositionEnd);
        if (e.type == "compositionend" && c.range) {
            host.selection.setRange(c.range);
        }
        var needsOnInput =
            (!!useragent.isChrome && useragent.isChrome >= 53) ||
            (!!useragent.isWebKit && useragent.isWebKit >= 603);

        if (needsOnInput) {
          onInput();
        }
    };
    
    

    var syncComposition = lang.delayedCall(onCompositionUpdate, 50);

    event.addListener(text, "compositionstart", onCompositionStart);
    if (useragent.isGecko) {
        event.addListener(text, "text", function(){syncComposition.schedule();});
    } else {
        event.addListener(text, "keyup", function(){syncComposition.schedule();});
        event.addListener(text, "keydown", function(){syncComposition.schedule();});
    }
    event.addListener(text, "compositionend", onCompositionEnd);

    this.getElement = function() {
        return text;
    };

    this.setReadOnly = function(readOnly) {
       text.readOnly = readOnly;
    };

    this.onContextMenu = function(e) {
        afterContextMenu = true;
        resetSelection(host.selection.isEmpty());
        host._emit("nativecontextmenu", {target: host, domEvent: e});
        this.moveToMouse(e, true);
    };
    
    this.moveToMouse = function(e, bringToFront) {
        if (!tempStyle)
            tempStyle = text.style.cssText;
        text.style.cssText = (bringToFront ? "z-index:100000;" : "")
            + "height:" + text.style.height + ";"
            + (useragent.isIE ? "opacity:0.1;" : "");

        var rect = host.container.getBoundingClientRect();
        var style = dom.computedStyle(host.container);
        var top = rect.top + (parseInt(style.borderTopWidth) || 0);
        var left = rect.left + (parseInt(rect.borderLeftWidth) || 0);
        var maxTop = rect.bottom - top - text.clientHeight -2;
        var move = function(e) {
            text.style.left = e.clientX - left - 2 + "px";
            text.style.top = Math.min(e.clientY - top - 2, maxTop) + "px";
        }; 
        move(e);

        if (e.type != "mousedown")
            return;

        if (host.renderer.$keepTextAreaAtCursor)
            host.renderer.$keepTextAreaAtCursor = null;

        clearTimeout(closeTimeout);
        if (useragent.isWin)
            event.capture(host.container, move, onContextMenuClose);
    };

    this.onContextMenuClose = onContextMenuClose;
    var closeTimeout;
    function onContextMenuClose() {
        clearTimeout(closeTimeout);
        closeTimeout = setTimeout(function () {
            if (tempStyle) {
                text.style.cssText = tempStyle;
                tempStyle = '';
            }
            if (host.renderer.$keepTextAreaAtCursor == null) {
                host.renderer.$keepTextAreaAtCursor = true;
                host.renderer.$moveTextAreaToCursor();
            }
        }, 0);
    }

    var onContextMenu = function(e) {
        host.textInput.onContextMenu(e);
        onContextMenuClose();
    };
    event.addListener(text, "mouseup", onContextMenu);
    event.addListener(text, "mousedown", function(e) {
        e.preventDefault();
        onContextMenuClose();
    });
    event.addListener(host.renderer.scroller, "contextmenu", onContextMenu);
    event.addListener(text, "contextmenu", onContextMenu);
    
    if (useragent.isIOS) {
        var typingResetTimeout = null;
        var typing = false;

        parentNode.addEventListener("keydown", function (e) {
            if (typingResetTimeout) clearTimeout(typingResetTimeout);
            typing = true;
        });

        parentNode.addEventListener("keyup", function (e) {
            typingResetTimeout = setTimeout(function () {
                typing = false;
            }, 100);
        });
        var detectArrowKeys = function(e) {
            if (document.activeElement !== text) return;
            if (typing) return;
          
            if (cut) {
                return setTimeout(function () {
                    cut = false;
                }, 100);
            }
            var selectionStart = text.selectionStart;
            var selectionEnd = text.selectionEnd;
            text.setSelectionRange(4, 5);
            if (selectionStart == selectionEnd) {
                switch (selectionStart) {
                    case 0: host.onCommandKey(null, 0, KEYS.up); break;
                    case 1: host.onCommandKey(null, 0, KEYS.home); break;
                    case 2: host.onCommandKey(null, MODS.option, KEYS.left); break;
                    case 4: host.onCommandKey(null, 0, KEYS.left); break;
                    case 5: host.onCommandKey(null, 0, KEYS.right); break;
                    case 7: host.onCommandKey(null, MODS.option, KEYS.right); break;
                    case 8: host.onCommandKey(null, 0, KEYS.end); break;
                    case 9: host.onCommandKey(null, 0, KEYS.down); break;
                }
            } else {
                switch (selectionEnd) {
                    case 6: host.onCommandKey(null, MODS.shift, KEYS.right); break;
                    case 7: host.onCommandKey(null, MODS.shift | MODS.option, KEYS.right); break;
                    case 8: host.onCommandKey(null, MODS.shift, KEYS.end); break;
                    case 9: host.onCommandKey(null, MODS.shift, KEYS.down); break;
                }
                switch (selectionStart) {
                    case 0: host.onCommandKey(null, MODS.shift, KEYS.up); break;
                    case 1: host.onCommandKey(null, MODS.shift, KEYS.home); break;
                    case 2: host.onCommandKey(null, MODS.shift | MODS.option, KEYS.left); break;
                    case 3: host.onCommandKey(null, MODS.shift, KEYS.left); break;
                }
            }
        };
        document.addEventListener("selectionchange", detectArrowKeys);
        host.on("destroy", function() {
            document.removeEventListener("selectionchange", detectArrowKeys);
        });
    }
};

exports.TextInput = TextInput;
});

ace.define("ace/keyboard/textinput",["require","exports","module","ace/lib/event","ace/lib/useragent","ace/lib/dom","ace/lib/lang","ace/keyboard/textinput_ios"], function(require, exports, module) {
"use strict";

var event = require("../lib/event");
var useragent = require("../lib/useragent");
var dom = require("../lib/dom");
var lang = require("../lib/lang");
var BROKEN_SETDATA = useragent.isChrome < 18;
var USE_IE_MIME_TYPE =  useragent.isIE;

var TextInputIOS = require("./textinput_ios").TextInput;
var TextInput = function(parentNode, host) {
    if (useragent.isIOS)
        return TextInputIOS.call(this, parentNode, host);
    
    var text = dom.createElement("textarea");
    text.className = "ace_text-input";

    text.setAttribute("wrap", "off");
    text.setAttribute("autocorrect", "off");
    text.setAttribute("autocapitalize", "off");
    text.setAttribute("spellcheck", false);

    text.style.opacity = "0";
    parentNode.insertBefore(text, parentNode.firstChild);

    var PLACEHOLDER = "\u2028\u2028";

    var copied = false;
    var pasted = false;
    var inComposition = false;
    var tempStyle = '';
    var isSelectionEmpty = true;
    try { var isFocused = document.activeElement === text; } catch(e) {}
    
    event.addListener(text, "blur", function(e) {
        host.onBlur(e);
        isFocused = false;
    });
    event.addListener(text, "focus", function(e) {
        isFocused = true;
        host.onFocus(e);
        resetSelection();
    });
    this.focus = function() {
        if (tempStyle) return text.focus();
        var top = text.style.top;
        text.style.position = "fixed";
        text.style.top = "0px";
        text.focus();
        setTimeout(function() {
            text.style.position = "";
            if (text.style.top == "0px")
                text.style.top = top;
        }, 0);
    };
    this.blur = function() {
        text.blur();
    };
    this.isFocused = function() {
        return isFocused;
    };
    var syncSelection = lang.delayedCall(function() {
        isFocused && resetSelection(isSelectionEmpty);
    });
    var syncValue = lang.delayedCall(function() {
         if (!inComposition) {
            text.value = PLACEHOLDER;
            isFocused && resetSelection();
         }
    });

    function resetSelection(isEmpty) {
        if (inComposition)
            return;
        inComposition = true;
        
        if (inputHandler) {
            var selectionStart = 0;
            var selectionEnd = isEmpty ? 0 : text.value.length - 1;
        } else {
            var selectionStart = isEmpty ? 2 : 1;
            var selectionEnd = 2;
        }
        try {
            text.setSelectionRange(selectionStart, selectionEnd);
        } catch(e){}
        
        inComposition = false;
    }

    function resetValue() {
        if (inComposition)
            return;
        text.value = PLACEHOLDER;
        if (useragent.isWebKit)
            syncValue.schedule();
    }

    useragent.isWebKit || host.addEventListener('changeSelection', function() {
        if (host.selection.isEmpty() != isSelectionEmpty) {
            isSelectionEmpty = !isSelectionEmpty;
            syncSelection.schedule();
        }
    });

    resetValue();
    if (isFocused)
        host.onFocus();


    var isAllSelected = function(text) {
        return text.selectionStart === 0 && text.selectionEnd === text.value.length;
    };

    var onSelect = function(e) {
        if (copied) {
            copied = false;
        } else if (isAllSelected(text)) {
            host.selectAll();
            resetSelection();
        } else if (inputHandler) {
            resetSelection(host.selection.isEmpty());
        }
    };

    var inputHandler = null;
    this.setInputHandler = function(cb) {inputHandler = cb;};
    this.getInputHandler = function() {return inputHandler;};
    var afterContextMenu = false;
    
    var sendText = function(data) {
        if (inputHandler) {
            data = inputHandler(data);
            inputHandler = null;
        }
        if (pasted) {
            resetSelection();
            if (data)
                host.onPaste(data);
            pasted = false;
        } else if (data == PLACEHOLDER.charAt(0)) {
            if (afterContextMenu)
                host.execCommand("del", {source: "ace"});
            else // some versions of android do not fire keydown when pressing backspace
                host.execCommand("backspace", {source: "ace"});
        } else {
            if (data.substring(0, 2) == PLACEHOLDER)
                data = data.substr(2);
            else if (data.charAt(0) == PLACEHOLDER.charAt(0))
                data = data.substr(1);
            else if (data.charAt(data.length - 1) == PLACEHOLDER.charAt(0))
                data = data.slice(0, -1);
            if (data.charAt(data.length - 1) == PLACEHOLDER.charAt(0))
                data = data.slice(0, -1);
            
            if (data)
                host.onTextInput(data);
        }
        if (afterContextMenu)
            afterContextMenu = false;
    };
    var onInput = function(e) {
        if (inComposition)
            return;
        var data = text.value;
        sendText(data);
        resetValue();
    };
    
    var handleClipboardData = function(e, data, forceIEMime) {
        var clipboardData = e.clipboardData || window.clipboardData;
        if (!clipboardData || BROKEN_SETDATA)
            return;
        var mime = USE_IE_MIME_TYPE || forceIEMime ? "Text" : "text/plain";
        try {
            if (data) {
                return clipboardData.setData(mime, data) !== false;
            } else {
                return clipboardData.getData(mime);
            }
        } catch(e) {
            if (!forceIEMime)
                return handleClipboardData(e, data, true);
        }
    };

    var doCopy = function(e, isCut) {
        var data = host.getCopyText();
        if (!data)
            return event.preventDefault(e);

        if (handleClipboardData(e, data)) {
            isCut ? host.onCut() : host.onCopy();
            event.preventDefault(e);
        } else {
            copied = true;
            text.value = data;
            text.select();
            setTimeout(function(){
                copied = false;
                resetValue();
                resetSelection();
                isCut ? host.onCut() : host.onCopy();
            });
        }
    };
    
    var onCut = function(e) {
        doCopy(e, true);
    };
    
    var onCopy = function(e) {
        doCopy(e, false);
    };
    
    var onPaste = function(e) {
        var data = handleClipboardData(e);
        if (typeof data == "string") {
            if (data)
                host.onPaste(data, e);
            if (useragent.isIE)
                setTimeout(resetSelection);
            event.preventDefault(e);
        }
        else {
            text.value = "";
            pasted = true;
        }
    };

    event.addCommandKeyListener(text, host.onCommandKey.bind(host));

    event.addListener(text, "select", onSelect);

    event.addListener(text, "input", onInput);

    event.addListener(text, "cut", onCut);
    event.addListener(text, "copy", onCopy);
    event.addListener(text, "paste", onPaste);
    if (!('oncut' in text) || !('oncopy' in text) || !('onpaste' in text)) {
        event.addListener(parentNode, "keydown", function(e) {
            if ((useragent.isMac && !e.metaKey) || !e.ctrlKey)
                return;

            switch (e.keyCode) {
                case 67:
                    onCopy(e);
                    break;
                case 86:
                    onPaste(e);
                    break;
                case 88:
                    onCut(e);
                    break;
            }
        });
    }
    var onCompositionStart = function(e) {
        if (inComposition || !host.onCompositionStart || host.$readOnly) 
            return;
        inComposition = {};
        inComposition.canUndo = host.session.$undoManager;
        host.onCompositionStart();
        setTimeout(onCompositionUpdate, 0);
        host.on("mousedown", onCompositionEnd);
        if (inComposition.canUndo && !host.selection.isEmpty()) {
            host.insert("");
            host.session.markUndoGroup();
            host.selection.clearSelection();
        }
        host.session.markUndoGroup();
    };

    var onCompositionUpdate = function() {
        if (!inComposition || !host.onCompositionUpdate || host.$readOnly)
            return;
        var val = text.value.replace(/\u2028/g, "");
        if (inComposition.lastValue === val) return;
        
        host.onCompositionUpdate(val);
        if (inComposition.lastValue)
            host.undo();
        if (inComposition.canUndo)
            inComposition.lastValue = val;
        if (inComposition.lastValue) {
            var r = host.selection.getRange();
            host.insert(inComposition.lastValue);
            host.session.markUndoGroup();
            inComposition.range = host.selection.getRange();
            host.selection.setRange(r);
            host.selection.clearSelection();
        }
    };

    var onCompositionEnd = function(e) {
        if (!host.onCompositionEnd || host.$readOnly) return;
        var c = inComposition;
        inComposition = false;
        var timer = setTimeout(function() {
            timer = null;
            var str = text.value.replace(/\u2028/g, "");
            if (inComposition)
                return;
            else if (str == c.lastValue)
                resetValue();
            else if (!c.lastValue && str) {
                resetValue();
                sendText(str);
            }
        });
        inputHandler = function compositionInputHandler(str) {
            if (timer)
                clearTimeout(timer);
            str = str.replace(/\u2028/g, "");
            if (str == c.lastValue)
                return "";
            if (c.lastValue && timer)
                host.undo();
            return str;
        };
        host.onCompositionEnd();
        host.removeListener("mousedown", onCompositionEnd);
        if (e.type == "compositionend" && c.range) {
            host.selection.setRange(c.range);
        }
        var needsOnInput =
            (!!useragent.isChrome && useragent.isChrome >= 53) ||
            (!!useragent.isWebKit && useragent.isWebKit >= 603);

        if (needsOnInput) {
          onInput();
        }
    };
    
    

    var syncComposition = lang.delayedCall(onCompositionUpdate, 50);

    event.addListener(text, "compositionstart", onCompositionStart);
    if (useragent.isGecko) {
        event.addListener(text, "text", function(){syncComposition.schedule();});
    } else {
        event.addListener(text, "keyup", function(){syncComposition.schedule();});
        event.addListener(text, "keydown", function(){syncComposition.schedule();});
    }
    event.addListener(text, "compositionend", onCompositionEnd);

    this.getElement = function() {
        return text;
    };

    this.setReadOnly = function(readOnly) {
       text.readOnly = readOnly;
    };

    this.onContextMenu = function(e) {
        afterContextMenu = true;
        resetSelection(host.selection.isEmpty());
        host._emit("nativecontextmenu", {target: host, domEvent: e});
        this.moveToMouse(e, true);
    };
    
    this.moveToMouse = function(e, bringToFront) {
        if (!tempStyle)
            tempStyle = text.style.cssText;
        text.style.cssText = (bringToFront ? "z-index:100000;" : "")
            + "height:" + text.style.height + ";"
            + (useragent.isIE ? "opacity:0.1;" : "");

        var rect = host.container.getBoundingClientRect();
        var style = dom.computedStyle(host.container);
        var top = rect.top + (parseInt(style.borderTopWidth) || 0);
        var left = rect.left + (parseInt(rect.borderLeftWidth) || 0);
        var maxTop = rect.bottom - top - text.clientHeight -2;
        var move = function(e) {
            text.style.left = e.clientX - left - 2 + "px";
            text.style.top = Math.min(e.clientY - top - 2, maxTop) + "px";
        }; 
        move(e);

        if (e.type != "mousedown")
            return;

        if (host.renderer.$keepTextAreaAtCursor)
            host.renderer.$keepTextAreaAtCursor = null;

        clearTimeout(closeTimeout);
        if (useragent.isWin)
            event.capture(host.container, move, onContextMenuClose);
    };

    this.onContextMenuClose = onContextMenuClose;
    var closeTimeout;
    function onContextMenuClose() {
        clearTimeout(closeTimeout);
        closeTimeout = setTimeout(function () {
            if (tempStyle) {
                text.style.cssText = tempStyle;
                tempStyle = '';
            }
            if (host.renderer.$keepTextAreaAtCursor == null) {
                host.renderer.$keepTextAreaAtCursor = true;
                host.renderer.$moveTextAreaToCursor();
            }
        }, 0);
    }

    var onContextMenu = function(e) {
        host.textInput.onContextMenu(e);
        onContextMenuClose();
    };
    event.addListener(text, "mouseup", onContextMenu);
    event.addListener(text, "mousedown", function(e) {
        e.preventDefault();
        onContextMenuClose();
    });
    event.addListener(host.renderer.scroller, "contextmenu", onContextMenu);
    event.addListener(text, "contextmenu", onContextMenu);
};

exports.TextInput = TextInput;
});

ace.define("ace/mouse/default_handlers",["require","exports","module","ace/lib/dom","ace/lib/event","ace/lib/useragent"], function(require, exports, module) {
"use strict";

var dom = require("../lib/dom");
var event = require("../lib/event");
var useragent = require("../lib/useragent");

var DRAG_OFFSET = 0; // pixels
var SCROLL_COOLDOWN_T = 250; // milliseconds

function DefaultHandlers(mouseHandler) {
    mouseHandler.$clickSelection = null;

    var editor = mouseHandler.editor;
    editor.setDefaultHandler("mousedown", this.onMouseDown.bind(mouseHandler));
    editor.setDefaultHandler("dblclick", this.onDoubleClick.bind(mouseHandler));
    editor.setDefaultHandler("tripleclick", this.onTripleClick.bind(mouseHandler));
    editor.setDefaultHandler("quadclick", this.onQuadClick.bind(mouseHandler));
    editor.setDefaultHandler("mousewheel", this.onMouseWheel.bind(mouseHandler));
    editor.setDefaultHandler("touchmove", this.onTouchMove.bind(mouseHandler));

    var exports = ["select", "startSelect", "selectEnd", "selectAllEnd", "selectByWordsEnd",
        "selectByLinesEnd", "dragWait", "dragWaitEnd", "focusWait"];

    exports.forEach(function(x) {
        mouseHandler[x] = this[x];
    }, this);

    mouseHandler.selectByLines = this.extendSelectionBy.bind(mouseHandler, "getLineRange");
    mouseHandler.selectByWords = this.extendSelectionBy.bind(mouseHandler, "getWordRange");
}

(function() {

    this.onMouseDown = function(ev) {
        var inSelection = ev.inSelection();
        var pos = ev.getDocumentPosition();
        this.mousedownEvent = ev;
        var editor = this.editor;

        var button = ev.getButton();
        if (button !== 0) {
            var selectionRange = editor.getSelectionRange();
            var selectionEmpty = selectionRange.isEmpty();
            editor.$blockScrolling++;
            if (selectionEmpty || button == 1)
                editor.selection.moveToPosition(pos);
            editor.$blockScrolling--;
            if (button == 2) {
                editor.textInput.onContextMenu(ev.domEvent);
                if (!useragent.isMozilla)
                    ev.preventDefault();
            }
            return;
        }

        this.mousedownEvent.time = Date.now();
        if (inSelection && !editor.isFocused()) {
            editor.focus();
            if (this.$focusTimout && !this.$clickSelection && !editor.inMultiSelectMode) {
                this.setState("focusWait");
                this.captureMouse(ev);
                return;
            }
        }

        this.captureMouse(ev);
        this.startSelect(pos, ev.domEvent._clicks > 1);
        return ev.preventDefault();
    };

    this.startSelect = function(pos, waitForClickSelection) {
        pos = pos || this.editor.renderer.screenToTextCoordinates(this.x, this.y);
        var editor = this.editor;
        editor.$blockScrolling++;
        if (this.mousedownEvent.getShiftKey())
            editor.selection.selectToPosition(pos);
        else if (!waitForClickSelection)
            editor.selection.moveToPosition(pos);
        if (!waitForClickSelection)
            this.select();
        if (editor.renderer.scroller.setCapture) {
            editor.renderer.scroller.setCapture();
        }
        editor.setStyle("ace_selecting");
        this.setState("select");
        editor.$blockScrolling--;
    };

    this.select = function() {
        var anchor, editor = this.editor;
        var cursor = editor.renderer.screenToTextCoordinates(this.x, this.y);
        editor.$blockScrolling++;
        if (this.$clickSelection) {
            var cmp = this.$clickSelection.comparePoint(cursor);

            if (cmp == -1) {
                anchor = this.$clickSelection.end;
            } else if (cmp == 1) {
                anchor = this.$clickSelection.start;
            } else {
                var orientedRange = calcRangeOrientation(this.$clickSelection, cursor);
                cursor = orientedRange.cursor;
                anchor = orientedRange.anchor;
            }
            editor.selection.setSelectionAnchor(anchor.row, anchor.column);
        }
        editor.selection.selectToPosition(cursor);
        editor.$blockScrolling--;
        editor.renderer.scrollCursorIntoView();
    };

    this.extendSelectionBy = function(unitName) {
        var anchor, editor = this.editor;
        var cursor = editor.renderer.screenToTextCoordinates(this.x, this.y);
        var range = editor.selection[unitName](cursor.row, cursor.column);
        editor.$blockScrolling++;
        if (this.$clickSelection) {
            var cmpStart = this.$clickSelection.comparePoint(range.start);
            var cmpEnd = this.$clickSelection.comparePoint(range.end);

            if (cmpStart == -1 && cmpEnd <= 0) {
                anchor = this.$clickSelection.end;
                if (range.end.row != cursor.row || range.end.column != cursor.column)
                    cursor = range.start;
            } else if (cmpEnd == 1 && cmpStart >= 0) {
                anchor = this.$clickSelection.start;
                if (range.start.row != cursor.row || range.start.column != cursor.column)
                    cursor = range.end;
            } else if (cmpStart == -1 && cmpEnd == 1) {
                cursor = range.end;
                anchor = range.start;
            } else {
                var orientedRange = calcRangeOrientation(this.$clickSelection, cursor);
                cursor = orientedRange.cursor;
                anchor = orientedRange.anchor;
            }
            editor.selection.setSelectionAnchor(anchor.row, anchor.column);
        }
        editor.selection.selectToPosition(cursor);
        editor.$blockScrolling--;
        editor.renderer.scrollCursorIntoView();
    };

    this.selectEnd =
    this.selectAllEnd =
    this.selectByWordsEnd =
    this.selectByLinesEnd = function() {
        this.$clickSelection = null;
        this.editor.unsetStyle("ace_selecting");
        if (this.editor.renderer.scroller.releaseCapture) {
            this.editor.renderer.scroller.releaseCapture();
        }
    };

    this.focusWait = function() {
        var distance = calcDistance(this.mousedownEvent.x, this.mousedownEvent.y, this.x, this.y);
        var time = Date.now();

        if (distance > DRAG_OFFSET || time - this.mousedownEvent.time > this.$focusTimout)
            this.startSelect(this.mousedownEvent.getDocumentPosition());
    };

    this.onDoubleClick = function(ev) {
        var pos = ev.getDocumentPosition();
        var editor = this.editor;
        var session = editor.session;

        var range = session.getBracketRange(pos);
        if (range) {
            if (range.isEmpty()) {
                range.start.column--;
                range.end.column++;
            }
            this.setState("select");
        } else {
            range = editor.selection.getWordRange(pos.row, pos.column);
            this.setState("selectByWords");
        }
        this.$clickSelection = range;
        this.select();
    };

    this.onTripleClick = function(ev) {
        var pos = ev.getDocumentPosition();
        var editor = this.editor;

        this.setState("selectByLines");
        var range = editor.getSelectionRange();
        if (range.isMultiLine() && range.contains(pos.row, pos.column)) {
            this.$clickSelection = editor.selection.getLineRange(range.start.row);
            this.$clickSelection.end = editor.selection.getLineRange(range.end.row).end;
        } else {
            this.$clickSelection = editor.selection.getLineRange(pos.row);
        }
        this.select();
    };

    this.onQuadClick = function(ev) {
        var editor = this.editor;

        editor.selectAll();
        this.$clickSelection = editor.getSelectionRange();
        this.setState("selectAll");
    };

    this.onMouseWheel = function(ev) {
        if (ev.getAccelKey())
            return;
        if (ev.getShiftKey() && ev.wheelY && !ev.wheelX) {
            ev.wheelX = ev.wheelY;
            ev.wheelY = 0;
        }
        
        var editor = this.editor;
        
        if (!this.$lastScroll)
            this.$lastScroll = { t: 0, vx: 0, vy: 0, allowed: 0 };
        
        var prevScroll = this.$lastScroll;
        var t = ev.domEvent.timeStamp;
        var dt = t - prevScroll.t;
        var vx = ev.wheelX / dt;
        var vy = ev.wheelY / dt;
        if (dt < SCROLL_COOLDOWN_T) {
            vx = (vx + prevScroll.vx) / 2;
            vy = (vy + prevScroll.vy) / 2;
        }
        
        var direction = Math.abs(vx / vy);
        
        var canScroll = false;
        if (direction >= 1 && editor.renderer.isScrollableBy(ev.wheelX * ev.speed, 0))
            canScroll = true;
        if (direction <= 1 && editor.renderer.isScrollableBy(0, ev.wheelY * ev.speed))
            canScroll = true;
            
        if (canScroll) {
            prevScroll.allowed = t;
        } else if (t - prevScroll.allowed < SCROLL_COOLDOWN_T) {
            var isSlower = Math.abs(vx) <= 1.1 * Math.abs(prevScroll.vx)
                && Math.abs(vy) <= 1.1 * Math.abs(prevScroll.vy);
            if (isSlower) {
                canScroll = true;
                prevScroll.allowed = t;
            }
            else {
                prevScroll.allowed = 0;
            }
        }
        
        prevScroll.t = t;
        prevScroll.vx = vx;
        prevScroll.vy = vy;

        if (canScroll) {
            editor.renderer.scrollBy(ev.wheelX * ev.speed, ev.wheelY * ev.speed);
            return ev.stop();
        }
    };
    
    this.onTouchMove = function(ev) {
        this.editor._emit("mousewheel", ev);
    };

}).call(DefaultHandlers.prototype);

exports.DefaultHandlers = DefaultHandlers;

function calcDistance(ax, ay, bx, by) {
    return Math.sqrt(Math.pow(bx - ax, 2) + Math.pow(by - ay, 2));
}

function calcRangeOrientation(range, cursor) {
    if (range.start.row == range.end.row)
        var cmp = 2 * cursor.column - range.start.column - range.end.column;
    else if (range.start.row == range.end.row - 1 && !range.start.column && !range.end.column)
        var cmp = cursor.column - 4;
    else
        var cmp = 2 * cursor.row - range.start.row - range.end.row;

    if (cmp < 0)
        return {cursor: range.start, anchor: range.end};
    else
        return {cursor: range.end, anchor: range.start};
}

});

ace.define("ace/tooltip",["require","exports","module","ace/lib/oop","ace/lib/dom"], function(require, exports, module) {
"use strict";

var oop = require("./lib/oop");
var dom = require("./lib/dom");
function Tooltip (parentNode) {
    this.isOpen = false;
    this.$element = null;
    this.$parentNode = parentNode;
}

(function() {
    this.$init = function() {
        this.$element = dom.createElement("div");
        this.$element.className = "ace_tooltip";
        this.$element.style.display = "none";
        this.$parentNode.appendChild(this.$element);
        return this.$element;
    };
    this.getElement = function() {
        return this.$element || this.$init();
    };
    this.setText = function(text) {
        dom.setInnerText(this.getElement(), text);
    };
    this.setHtml = function(html) {
        this.getElement().innerHTML = html;
    };
    this.setPosition = function(x, y) {
        this.getElement().style.left = x + "px";
        this.getElement().style.top = y + "px";
    };
    this.setClassName = function(className) {
        dom.addCssClass(this.getElement(), className);
    };
    this.show = function(text, x, y) {
        if (text != null)
            this.setText(text);
        if (x != null && y != null)
            this.setPosition(x, y);
        if (!this.isOpen) {
            this.getElement().style.display = "block";
            this.isOpen = true;
        }
    };

    this.hide = function() {
        if (this.isOpen) {
            this.getElement().style.display = "none";
            this.isOpen = false;
        }
    };
    this.getHeight = function() {
        return this.getElement().offsetHeight;
    };
    this.getWidth = function() {
        return this.getElement().offsetWidth;
    };
    
    this.destroy = function() {
        this.isOpen = false;
        if (this.$element && this.$element.parentNode) {
            this.$element.parentNode.removeChild(this.$element);
        }
    };

}).call(Tooltip.prototype);

exports.Tooltip = Tooltip;
});

ace.define("ace/mouse/default_gutter_handler",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/event","ace/tooltip"], function(require, exports, module) {
"use strict";
var dom = require("../lib/dom");
var oop = require("../lib/oop");
var event = require("../lib/event");
var Tooltip = require("../tooltip").Tooltip;

function GutterHandler(mouseHandler) {
    var editor = mouseHandler.editor;
    var gutter = editor.renderer.$gutterLayer;
    var tooltip = new GutterTooltip(editor.container);

    mouseHandler.editor.setDefaultHandler("guttermousedown", function(e) {
        if (!editor.isFocused() || e.getButton() != 0)
            return;
        var gutterRegion = gutter.getRegion(e);

        if (gutterRegion == "foldWidgets")
            return;

        var row = e.getDocumentPosition().row;
        var selection = editor.session.selection;

        if (e.getShiftKey())
            selection.selectTo(row, 0);
        else {
            if (e.domEvent.detail == 2) {
                editor.selectAll();
                return e.preventDefault();
            }
            mouseHandler.$clickSelection = editor.selection.getLineRange(row);
        }
        mouseHandler.setState("selectByLines");
        mouseHandler.captureMouse(e);
        return e.preventDefault();
    });


    var tooltipTimeout, mouseEvent, tooltipAnnotation;

    function showTooltip() {
        var row = mouseEvent.getDocumentPosition().row;
        var annotation = gutter.$annotations[row];
        if (!annotation)
            return hideTooltip();

        var maxRow = editor.session.getLength();
        if (row == maxRow) {
            var screenRow = editor.renderer.pixelToScreenCoordinates(0, mouseEvent.y).row;
            var pos = mouseEvent.$pos;
            if (screenRow > editor.session.documentToScreenRow(pos.row, pos.column))
                return hideTooltip();
        }

        if (tooltipAnnotation == annotation)
            return;
        tooltipAnnotation = annotation.text.join("<br/>");

        tooltip.setHtml(tooltipAnnotation);
        tooltip.show();
        editor._signal("showGutterTooltip", tooltip);
        editor.on("mousewheel", hideTooltip);

        if (mouseHandler.$tooltipFollowsMouse) {
            moveTooltip(mouseEvent);
        } else {
            var gutterElement = mouseEvent.domEvent.target;
            var rect = gutterElement.getBoundingClientRect();
            var style = tooltip.getElement().style;
            style.left = rect.right + "px";
            style.top = rect.bottom + "px";
        }
    }

    function hideTooltip() {
        if (tooltipTimeout)
            tooltipTimeout = clearTimeout(tooltipTimeout);
        if (tooltipAnnotation) {
            tooltip.hide();
            tooltipAnnotation = null;
            editor._signal("hideGutterTooltip", tooltip);
            editor.removeEventListener("mousewheel", hideTooltip);
        }
    }

    function moveTooltip(e) {
        tooltip.setPosition(e.x, e.y);
    }

    mouseHandler.editor.setDefaultHandler("guttermousemove", function(e) {
        var target = e.domEvent.target || e.domEvent.srcElement;
        if (dom.hasCssClass(target, "ace_fold-widget"))
            return hideTooltip();

        if (tooltipAnnotation && mouseHandler.$tooltipFollowsMouse)
            moveTooltip(e);

        mouseEvent = e;
        if (tooltipTimeout)
            return;
        tooltipTimeout = setTimeout(function() {
            tooltipTimeout = null;
            if (mouseEvent && !mouseHandler.isMousePressed)
                showTooltip();
            else
                hideTooltip();
        }, 50);
    });

    event.addListener(editor.renderer.$gutter, "mouseout", function(e) {
        mouseEvent = null;
        if (!tooltipAnnotation || tooltipTimeout)
            return;

        tooltipTimeout = setTimeout(function() {
            tooltipTimeout = null;
            hideTooltip();
        }, 50);
    });
    
    editor.on("changeSession", hideTooltip);
}

function GutterTooltip(parentNode) {
    Tooltip.call(this, parentNode);
}

oop.inherits(GutterTooltip, Tooltip);

(function(){
    this.setPosition = function(x, y) {
        var windowWidth = window.innerWidth || document.documentElement.clientWidth;
        var windowHeight = window.innerHeight || document.documentElement.clientHeight;
        var width = this.getWidth();
        var height = this.getHeight();
        x += 15;
        y += 15;
        if (x + width > windowWidth) {
            x -= (x + width) - windowWidth;
        }
        if (y + height > windowHeight) {
            y -= 20 + height;
        }
        Tooltip.prototype.setPosition.call(this, x, y);
    };

}).call(GutterTooltip.prototype);



exports.GutterHandler = GutterHandler;

});

ace.define("ace/mouse/mouse_event",["require","exports","module","ace/lib/event","ace/lib/useragent"], function(require, exports, module) {
"use strict";

var event = require("../lib/event");
var useragent = require("../lib/useragent");
var MouseEvent = exports.MouseEvent = function(domEvent, editor) {
    this.domEvent = domEvent;
    this.editor = editor;
    
    this.x = this.clientX = domEvent.clientX;
    this.y = this.clientY = domEvent.clientY;

    this.$pos = null;
    this.$inSelection = null;
    
    this.propagationStopped = false;
    this.defaultPrevented = false;
};

(function() {  
    
    this.stopPropagation = function() {
        event.stopPropagation(this.domEvent);
        this.propagationStopped = true;
    };
    
    this.preventDefault = function() {
        event.preventDefault(this.domEvent);
        this.defaultPrevented = true;
    };
    
    this.stop = function() {
        this.stopPropagation();
        this.preventDefault();
    };
    this.getDocumentPosition = function() {
        if (this.$pos)
            return this.$pos;
        
        this.$pos = this.editor.renderer.screenToTextCoordinates(this.clientX, this.clientY);
        return this.$pos;
    };
    this.inSelection = function() {
        if (this.$inSelection !== null)
            return this.$inSelection;
            
        var editor = this.editor;
        

        var selectionRange = editor.getSelectionRange();
        if (selectionRange.isEmpty())
            this.$inSelection = false;
        else {
            var pos = this.getDocumentPosition();
            this.$inSelection = selectionRange.contains(pos.row, pos.column);
        }

        return this.$inSelection;
    };
    this.getButton = function() {
        return event.getButton(this.domEvent);
    };
    this.getShiftKey = function() {
        return this.domEvent.shiftKey;
    };
    
    this.getAccelKey = useragent.isMac
        ? function() { return this.domEvent.metaKey; }
        : function() { return this.domEvent.ctrlKey; };
    
}).call(MouseEvent.prototype);

});

ace.define("ace/mouse/dragdrop_handler",["require","exports","module","ace/lib/dom","ace/lib/event","ace/lib/useragent"], function(require, exports, module) {
"use strict";

var dom = require("../lib/dom");
var event = require("../lib/event");
var useragent = require("../lib/useragent");

var AUTOSCROLL_DELAY = 200;
var SCROLL_CURSOR_DELAY = 200;
var SCROLL_CURSOR_HYSTERESIS = 5;

function DragdropHandler(mouseHandler) {

    var editor = mouseHandler.editor;

    var blankImage = dom.createElement("img");
    blankImage.src = "data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";
    if (useragent.isOpera)
        blankImage.style.cssText = "width:1px;height:1px;position:fixed;top:0;left:0;z-index:2147483647;opacity:0;";

    var exports = ["dragWait", "dragWaitEnd", "startDrag", "dragReadyEnd", "onMouseDrag"];

     exports.forEach(function(x) {
         mouseHandler[x] = this[x];
    }, this);
    editor.addEventListener("mousedown", this.onMouseDown.bind(mouseHandler));


    var mouseTarget = editor.container;
    var dragSelectionMarker, x, y;
    var timerId, range;
    var dragCursor, counter = 0;
    var dragOperation;
    var isInternal;
    var autoScrollStartTime;
    var cursorMovedTime;
    var cursorPointOnCaretMoved;

    this.onDragStart = function(e) {
        if (this.cancelDrag || !mouseTarget.draggable) {
            var self = this;
            setTimeout(function(){
                self.startSelect();
                self.captureMouse(e);
            }, 0);
            return e.preventDefault();
        }
        range = editor.getSelectionRange();

        var dataTransfer = e.dataTransfer;
        dataTransfer.effectAllowed = editor.getReadOnly() ? "copy" : "copyMove";
        if (useragent.isOpera) {
            editor.container.appendChild(blankImage);
            blankImage.scrollTop = 0;
        }
        dataTransfer.setDragImage && dataTransfer.setDragImage(blankImage, 0, 0);
        if (useragent.isOpera) {
            editor.container.removeChild(blankImage);
        }
        dataTransfer.clearData();
        dataTransfer.setData("Text", editor.session.getTextRange());

        isInternal = true;
        this.setState("drag");
    };

    this.onDragEnd = function(e) {
        mouseTarget.draggable = false;
        isInternal = false;
        this.setState(null);
        if (!editor.getReadOnly()) {
            var dropEffect = e.dataTransfer.dropEffect;
            if (!dragOperation && dropEffect == "move")
                editor.session.remove(editor.getSelectionRange());
            editor.renderer.$cursorLayer.setBlinking(true);
        }
        this.editor.unsetStyle("ace_dragging");
        this.editor.renderer.setCursorStyle("");
    };

    this.onDragEnter = function(e) {
        if (editor.getReadOnly() || !canAccept(e.dataTransfer))
            return;
        x = e.clientX;
        y = e.clientY;
        if (!dragSelectionMarker)
            addDragMarker();
        counter++;
        e.dataTransfer.dropEffect = dragOperation = getDropEffect(e);
        return event.preventDefault(e);
    };

    this.onDragOver = function(e) {
        if (editor.getReadOnly() || !canAccept(e.dataTransfer))
            return;
        x = e.clientX;
        y = e.clientY;
        if (!dragSelectionMarker) {
            addDragMarker();
            counter++;
        }
        if (onMouseMoveTimer !== null)
            onMouseMoveTimer = null;

        e.dataTransfer.dropEffect = dragOperation = getDropEffect(e);
        return event.preventDefault(e);
    };

    this.onDragLeave = function(e) {
        counter--;
        if (counter <= 0 && dragSelectionMarker) {
            clearDragMarker();
            dragOperation = null;
            return event.preventDefault(e);
        }
    };

    this.onDrop = function(e) {
        if (!dragCursor)
            return;
        var dataTransfer = e.dataTransfer;
        if (isInternal) {
            switch (dragOperation) {
                case "move":
                    if (range.contains(dragCursor.row, dragCursor.column)) {
                        range = {
                            start: dragCursor,
                            end: dragCursor
                        };
                    } else {
                        range = editor.moveText(range, dragCursor);
                    }
                    break;
                case "copy":
                    range = editor.moveText(range, dragCursor, true);
                    break;
            }
        } else {
            var dropData = dataTransfer.getData('Text');
            range = {
                start: dragCursor,
                end: editor.session.insert(dragCursor, dropData)
            };
            editor.focus();
            dragOperation = null;
        }
        clearDragMarker();
        return event.preventDefault(e);
    };

    event.addListener(mouseTarget, "dragstart", this.onDragStart.bind(mouseHandler));
    event.addListener(mouseTarget, "dragend", this.onDragEnd.bind(mouseHandler));
    event.addListener(mouseTarget, "dragenter", this.onDragEnter.bind(mouseHandler));
    event.addListener(mouseTarget, "dragover", this.onDragOver.bind(mouseHandler));
    event.addListener(mouseTarget, "dragleave", this.onDragLeave.bind(mouseHandler));
    event.addListener(mouseTarget, "drop", this.onDrop.bind(mouseHandler));

    function scrollCursorIntoView(cursor, prevCursor) {
        var now = Date.now();
        var vMovement = !prevCursor || cursor.row != prevCursor.row;
        var hMovement = !prevCursor || cursor.column != prevCursor.column;
        if (!cursorMovedTime || vMovement || hMovement) {
            editor.$blockScrolling += 1;
            editor.moveCursorToPosition(cursor);
            editor.$blockScrolling -= 1;
            cursorMovedTime = now;
            cursorPointOnCaretMoved = {x: x, y: y};
        } else {
            var distance = calcDistance(cursorPointOnCaretMoved.x, cursorPointOnCaretMoved.y, x, y);
            if (distance > SCROLL_CURSOR_HYSTERESIS) {
                cursorMovedTime = null;
            } else if (now - cursorMovedTime >= SCROLL_CURSOR_DELAY) {
                editor.renderer.scrollCursorIntoView();
                cursorMovedTime = null;
            }
        }
    }

    function autoScroll(cursor, prevCursor) {
        var now = Date.now();
        var lineHeight = editor.renderer.layerConfig.lineHeight;
        var characterWidth = editor.renderer.layerConfig.characterWidth;
        var editorRect = editor.renderer.scroller.getBoundingClientRect();
        var offsets = {
           x: {
               left: x - editorRect.left,
               right: editorRect.right - x
           },
           y: {
               top: y - editorRect.top,
               bottom: editorRect.bottom - y
           }
        };
        var nearestXOffset = Math.min(offsets.x.left, offsets.x.right);
        var nearestYOffset = Math.min(offsets.y.top, offsets.y.bottom);
        var scrollCursor = {row: cursor.row, column: cursor.column};
        if (nearestXOffset / characterWidth <= 2) {
            scrollCursor.column += (offsets.x.left < offsets.x.right ? -3 : +2);
        }
        if (nearestYOffset / lineHeight <= 1) {
            scrollCursor.row += (offsets.y.top < offsets.y.bottom ? -1 : +1);
        }
        var vScroll = cursor.row != scrollCursor.row;
        var hScroll = cursor.column != scrollCursor.column;
        var vMovement = !prevCursor || cursor.row != prevCursor.row;
        if (vScroll || (hScroll && !vMovement)) {
            if (!autoScrollStartTime)
                autoScrollStartTime = now;
            else if (now - autoScrollStartTime >= AUTOSCROLL_DELAY)
                editor.renderer.scrollCursorIntoView(scrollCursor);
        } else {
            autoScrollStartTime = null;
        }
    }

    function onDragInterval() {
        var prevCursor = dragCursor;
        dragCursor = editor.renderer.screenToTextCoordinates(x, y);
        scrollCursorIntoView(dragCursor, prevCursor);
        autoScroll(dragCursor, prevCursor);
    }

    function addDragMarker() {
        range = editor.selection.toOrientedRange();
        dragSelectionMarker = editor.session.addMarker(range, "ace_selection", editor.getSelectionStyle());
        editor.clearSelection();
        if (editor.isFocused())
            editor.renderer.$cursorLayer.setBlinking(false);
        clearInterval(timerId);
        onDragInterval();
        timerId = setInterval(onDragInterval, 20);
        counter = 0;
        event.addListener(document, "mousemove", onMouseMove);
    }

    function clearDragMarker() {
        clearInterval(timerId);
        editor.session.removeMarker(dragSelectionMarker);
        dragSelectionMarker = null;
        editor.$blockScrolling += 1;
        editor.selection.fromOrientedRange(range);
        editor.$blockScrolling -= 1;
        if (editor.isFocused() && !isInternal)
            editor.renderer.$cursorLayer.setBlinking(!editor.getReadOnly());
        range = null;
        dragCursor = null;
        counter = 0;
        autoScrollStartTime = null;
        cursorMovedTime = null;
        event.removeListener(document, "mousemove", onMouseMove);
    }
    var onMouseMoveTimer = null;
    function onMouseMove() {
        if (onMouseMoveTimer == null) {
            onMouseMoveTimer = setTimeout(function() {
                if (onMouseMoveTimer != null && dragSelectionMarker)
                    clearDragMarker();
            }, 20);
        }
    }

    function canAccept(dataTransfer) {
        var types = dataTransfer.types;
        return !types || Array.prototype.some.call(types, function(type) {
            return type == 'text/plain' || type == 'Text';
        });
    }

    function getDropEffect(e) {
        var copyAllowed = ['copy', 'copymove', 'all', 'uninitialized'];
        var moveAllowed = ['move', 'copymove', 'linkmove', 'all', 'uninitialized'];

        var copyModifierState = useragent.isMac ? e.altKey : e.ctrlKey;
        var effectAllowed = "uninitialized";
        try {
            effectAllowed = e.dataTransfer.effectAllowed.toLowerCase();
        } catch (e) {}
        var dropEffect = "none";

        if (copyModifierState && copyAllowed.indexOf(effectAllowed) >= 0)
            dropEffect = "copy";
        else if (moveAllowed.indexOf(effectAllowed) >= 0)
            dropEffect = "move";
        else if (copyAllowed.indexOf(effectAllowed) >= 0)
            dropEffect = "copy";

        return dropEffect;
    }
}

(function() {

    this.dragWait = function() {
        var interval = Date.now() - this.mousedownEvent.time;
        if (interval > this.editor.getDragDelay())
            this.startDrag();
    };

    this.dragWaitEnd = function() {
        var target = this.editor.container;
        target.draggable = false;
        this.startSelect(this.mousedownEvent.getDocumentPosition());
        this.selectEnd();
    };

    this.dragReadyEnd = function(e) {
        this.editor.renderer.$cursorLayer.setBlinking(!this.editor.getReadOnly());
        this.editor.unsetStyle("ace_dragging");
        this.editor.renderer.setCursorStyle("");
        this.dragWaitEnd();
    };

    this.startDrag = function(){
        this.cancelDrag = false;
        var editor = this.editor;
        var target = editor.container;
        target.draggable = true;
        editor.renderer.$cursorLayer.setBlinking(false);
        editor.setStyle("ace_dragging");
        var cursorStyle = useragent.isWin ? "default" : "move";
        editor.renderer.setCursorStyle(cursorStyle);
        this.setState("dragReady");
    };

    this.onMouseDrag = function(e) {
        var target = this.editor.container;
        if (useragent.isIE && this.state == "dragReady") {
            var distance = calcDistance(this.mousedownEvent.x, this.mousedownEvent.y, this.x, this.y);
            if (distance > 3)
                target.dragDrop();
        }
        if (this.state === "dragWait") {
            var distance = calcDistance(this.mousedownEvent.x, this.mousedownEvent.y, this.x, this.y);
            if (distance > 0) {
                target.draggable = false;
                this.startSelect(this.mousedownEvent.getDocumentPosition());
            }
        }
    };

    this.onMouseDown = function(e) {
        if (!this.$dragEnabled)
            return;
        this.mousedownEvent = e;
        var editor = this.editor;

        var inSelection = e.inSelection();
        var button = e.getButton();
        var clickCount = e.domEvent.detail || 1;
        if (clickCount === 1 && button === 0 && inSelection) {
            if (e.editor.inMultiSelectMode && (e.getAccelKey() || e.getShiftKey()))
                return;
            this.mousedownEvent.time = Date.now();
            var eventTarget = e.domEvent.target || e.domEvent.srcElement;
            if ("unselectable" in eventTarget)
                eventTarget.unselectable = "on";
            if (editor.getDragDelay()) {
                if (useragent.isWebKit) {
                    this.cancelDrag = true;
                    var mouseTarget = editor.container;
                    mouseTarget.draggable = true;
                }
                this.setState("dragWait");
            } else {
                this.startDrag();
            }
            this.captureMouse(e, this.onMouseDrag.bind(this));
            e.defaultPrevented = true;
        }
    };

}).call(DragdropHandler.prototype);


function calcDistance(ax, ay, bx, by) {
    return Math.sqrt(Math.pow(bx - ax, 2) + Math.pow(by - ay, 2));
}

exports.DragdropHandler = DragdropHandler;

});

ace.define("ace/lib/net",["require","exports","module","ace/lib/dom"], function(require, exports, module) {
"use strict";
var dom = require("./dom");

exports.get = function (url, callback) {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
            callback(xhr.responseText);
        }
    };
    xhr.send(null);
};

exports.loadScript = function(path, callback) {
    var head = dom.getDocumentHead();
    var s = document.createElement('script');

    s.src = path;
    head.appendChild(s);

    s.onload = s.onreadystatechange = function(_, isAbort) {
        if (isAbort || !s.readyState || s.readyState == "loaded" || s.readyState == "complete") {
            s = s.onload = s.onreadystatechange = null;
            if (!isAbort)
                callback();
        }
    };
};
exports.qualifyURL = function(url) {
    var a = document.createElement('a');
    a.href = url;
    return a.href;
};

});

ace.define("ace/lib/event_emitter",["require","exports","module"], function(require, exports, module) {
"use strict";

var EventEmitter = {};
var stopPropagation = function() { this.propagationStopped = true; };
var preventDefault = function() { this.defaultPrevented = true; };

EventEmitter._emit =
EventEmitter._dispatchEvent = function(eventName, e) {
    this._eventRegistry || (this._eventRegistry = {});
    this._defaultHandlers || (this._defaultHandlers = {});

    var listeners = this._eventRegistry[eventName] || [];
    var defaultHandler = this._defaultHandlers[eventName];
    if (!listeners.length && !defaultHandler)
        return;

    if (typeof e != "object" || !e)
        e = {};

    if (!e.type)
        e.type = eventName;
    if (!e.stopPropagation)
        e.stopPropagation = stopPropagation;
    if (!e.preventDefault)
        e.preventDefault = preventDefault;

    listeners = listeners.slice();
    for (var i=0; i<listeners.length; i++) {
        listeners[i](e, this);
        if (e.propagationStopped)
            break;
    }
    
    if (defaultHandler && !e.defaultPrevented)
        return defaultHandler(e, this);
};


EventEmitter._signal = function(eventName, e) {
    var listeners = (this._eventRegistry || {})[eventName];
    if (!listeners)
        return;
    listeners = listeners.slice();
    for (var i=0; i<listeners.length; i++)
        listeners[i](e, this);
};

EventEmitter.once = function(eventName, callback) {
    var _self = this;
    callback && this.addEventListener(eventName, function newCallback() {
        _self.removeEventListener(eventName, newCallback);
        callback.apply(null, arguments);
    });
};


EventEmitter.setDefaultHandler = function(eventName, callback) {
    var handlers = this._defaultHandlers;
    if (!handlers)
        handlers = this._defaultHandlers = {_disabled_: {}};
    
    if (handlers[eventName]) {
        var old = handlers[eventName];
        var disabled = handlers._disabled_[eventName];
        if (!disabled)
            handlers._disabled_[eventName] = disabled = [];
        disabled.push(old);
        var i = disabled.indexOf(callback);
        if (i != -1) 
            disabled.splice(i, 1);
    }
    handlers[eventName] = callback;
};
EventEmitter.removeDefaultHandler = function(eventName, callback) {
    var handlers = this._defaultHandlers;
    if (!handlers)
        return;
    var disabled = handlers._disabled_[eventName];
    
    if (handlers[eventName] == callback) {
        var old = handlers[eventName];
        if (disabled)
            this.setDefaultHandler(eventName, disabled.pop());
    } else if (disabled) {
        var i = disabled.indexOf(callback);
        if (i != -1)
            disabled.splice(i, 1);
    }
};

EventEmitter.on =
EventEmitter.addEventListener = function(eventName, callback, capturing) {
    this._eventRegistry = this._eventRegistry || {};

    var listeners = this._eventRegistry[eventName];
    if (!listeners)
        listeners = this._eventRegistry[eventName] = [];

    if (listeners.indexOf(callback) == -1)
        listeners[capturing ? "unshift" : "push"](callback);
    return callback;
};

EventEmitter.off =
EventEmitter.removeListener =
EventEmitter.removeEventListener = function(eventName, callback) {
    this._eventRegistry = this._eventRegistry || {};

    var listeners = this._eventRegistry[eventName];
    if (!listeners)
        return;

    var index = listeners.indexOf(callback);
    if (index !== -1)
        listeners.splice(index, 1);
};

EventEmitter.removeAllListeners = function(eventName) {
    if (this._eventRegistry) this._eventRegistry[eventName] = [];
};

exports.EventEmitter = EventEmitter;

});

ace.define("ace/lib/app_config",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"], function(require, exports, module) {
"no use strict";

var oop = require("./oop");
var EventEmitter = require("./event_emitter").EventEmitter;

var optionsProvider = {
    setOptions: function(optList) {
        Object.keys(optList).forEach(function(key) {
            this.setOption(key, optList[key]);
        }, this);
    },
    getOptions: function(optionNames) {
        var result = {};
        if (!optionNames) {
            optionNames = Object.keys(this.$options);
        } else if (!Array.isArray(optionNames)) {
            result = optionNames;
            optionNames = Object.keys(result);
        }
        optionNames.forEach(function(key) {
            result[key] = this.getOption(key);
        }, this);
        return result;
    },
    setOption: function(name, value) {
        if (this["$" + name] === value)
            return;
        var opt = this.$options[name];
        if (!opt) {
            return warn('misspelled option "' + name + '"');
        }
        if (opt.forwardTo)
            return this[opt.forwardTo] && this[opt.forwardTo].setOption(name, value);

        if (!opt.handlesSet)
            this["$" + name] = value;
        if (opt && opt.set)
            opt.set.call(this, value);
    },
    getOption: function(name) {
        var opt = this.$options[name];
        if (!opt) {
            return warn('misspelled option "' + name + '"');
        }
        if (opt.forwardTo)
            return this[opt.forwardTo] && this[opt.forwardTo].getOption(name);
        return opt && opt.get ? opt.get.call(this) : this["$" + name];
    }
};

function warn(message) {
    if (typeof console != "undefined" && console.warn)
        console.warn.apply(console, arguments);
}

function reportError(msg, data) {
    var e = new Error(msg);
    e.data = data;
    if (typeof console == "object" && console.error)
        console.error(e);
    setTimeout(function() { throw e; });
}

var AppConfig = function() {
    this.$defaultOptions = {};
};

(function() {
    oop.implement(this, EventEmitter);
    this.defineOptions = function(obj, path, options) {
        if (!obj.$options)
            this.$defaultOptions[path] = obj.$options = {};

        Object.keys(options).forEach(function(key) {
            var opt = options[key];
            if (typeof opt == "string")
                opt = {forwardTo: opt};

            opt.name || (opt.name = key);
            obj.$options[opt.name] = opt;
            if ("initialValue" in opt)
                obj["$" + opt.name] = opt.initialValue;
        });
        oop.implement(obj, optionsProvider);

        return this;
    };

    this.resetOptions = function(obj) {
        Object.keys(obj.$options).forEach(function(key) {
            var opt = obj.$options[key];
            if ("value" in opt)
                obj.setOption(key, opt.value);
        });
    };

    this.setDefaultValue = function(path, name, value) {
        var opts = this.$defaultOptions[path] || (this.$defaultOptions[path] = {});
        if (opts[name]) {
            if (opts.forwardTo)
                this.setDefaultValue(opts.forwardTo, name, value);
            else
                opts[name].value = value;
        }
    };

    this.setDefaultValues = function(path, optionHash) {
        Object.keys(optionHash).forEach(function(key) {
            this.setDefaultValue(path, key, optionHash[key]);
        }, this);
    };
    
    this.warn = warn;
    this.reportError = reportError;
    
}).call(AppConfig.prototype);

exports.AppConfig = AppConfig;

});

ace.define("ace/config",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/lib/net","ace/lib/app_config"], function(require, exports, module) {
"no use strict";

var lang = require("./lib/lang");
var oop = require("./lib/oop");
var net = require("./lib/net");
var AppConfig = require("./lib/app_config").AppConfig;

module.exports = exports = new AppConfig();

var global = (function() {
    return this || typeof window != "undefined" && window;
})();

var options = {
    packaged: false,
    workerPath: null,
    modePath: null,
    themePath: null,
    basePath: "",
    suffix: ".js",
    $moduleUrls: {}
};

exports.get = function(key) {
    if (!options.hasOwnProperty(key))
        throw new Error("Unknown config key: " + key);

    return options[key];
};

exports.set = function(key, value) {
    if (!options.hasOwnProperty(key))
        throw new Error("Unknown config key: " + key);

    options[key] = value;
};

exports.all = function() {
    return lang.copyObject(options);
};
exports.moduleUrl = function(name, component) {
    if (options.$moduleUrls[name])
        return options.$moduleUrls[name];

    var parts = name.split("/");
    component = component || parts[parts.length - 2] || "";
    var sep = component == "snippets" ? "/" : "-";
    var base = parts[parts.length - 1];
    if (component == "worker" && sep == "-") {
        var re = new RegExp("^" + component + "[\\-_]|[\\-_]" + component + "$", "g");
        base = base.replace(re, "");
    }

    if ((!base || base == component) && parts.length > 1)
        base = parts[parts.length - 2];
    var path = options[component + "Path"];
    if (path == null) {
        path = options.basePath;
    } else if (sep == "/") {
        component = sep = "";
    }
    if (path && path.slice(-1) != "/")
        path += "/";
    return path + component + sep + base + this.get("suffix");
};

exports.setModuleUrl = function(name, subst) {
    return options.$moduleUrls[name] = subst;
};

exports.$loading = {};
exports.loadModule = function(moduleName, onLoad) {
    var module, moduleType;
    if (Array.isArray(moduleName)) {
        moduleType = moduleName[0];
        moduleName = moduleName[1];
    }

    try {
        module = require(moduleName);
    } catch (e) {}
    if (module && !exports.$loading[moduleName])
        return onLoad && onLoad(module);

    if (!exports.$loading[moduleName])
        exports.$loading[moduleName] = [];

    exports.$loading[moduleName].push(onLoad);

    if (exports.$loading[moduleName].length > 1)
        return;

    var afterLoad = function() {
        require([moduleName], function(module) {
            exports._emit("load.module", {name: moduleName, module: module});
            var listeners = exports.$loading[moduleName];
            exports.$loading[moduleName] = null;
            listeners.forEach(function(onLoad) {
                onLoad && onLoad(module);
            });
        });
    };

    if (!exports.get("packaged"))
        return afterLoad();
    net.loadScript(exports.moduleUrl(moduleName, moduleType), afterLoad);
};
init(true);function init(packaged) {

    if (!global || !global.document)
        return;
    
    options.packaged = packaged || require.packaged || module.packaged || (global.define && define.packaged);

    var scriptOptions = {};
    var scriptUrl = "";
    var currentScript = (document.currentScript || document._currentScript ); // native or polyfill
    var currentDocument = currentScript && currentScript.ownerDocument || document;
    
    var scripts = currentDocument.getElementsByTagName("script");
    for (var i=0; i<scripts.length; i++) {
        var script = scripts[i];

        var src = script.src || script.getAttribute("src");
        if (!src)
            continue;

        var attributes = script.attributes;
        for (var j=0, l=attributes.length; j < l; j++) {
            var attr = attributes[j];
            if (attr.name.indexOf("data-ace-") === 0) {
                scriptOptions[deHyphenate(attr.name.replace(/^data-ace-/, ""))] = attr.value;
            }
        }

        var m = src.match(/^(.*)\/ace(\-\w+)?\.js(\?|$)/);
        if (m)
            scriptUrl = m[1];
    }

    if (scriptUrl) {
        scriptOptions.base = scriptOptions.base || scriptUrl;
        scriptOptions.packaged = true;
    }

    scriptOptions.basePath = scriptOptions.base;
    scriptOptions.workerPath = scriptOptions.workerPath || scriptOptions.base;
    scriptOptions.modePath = scriptOptions.modePath || scriptOptions.base;
    scriptOptions.themePath = scriptOptions.themePath || scriptOptions.base;
    delete scriptOptions.base;

    for (var key in scriptOptions)
        if (typeof scriptOptions[key] !== "undefined")
            exports.set(key, scriptOptions[key]);
}

exports.init = init;

function deHyphenate(str) {
    return str.replace(/-(.)/g, function(m, m1) { return m1.toUpperCase(); });
}

});

ace.define("ace/mouse/mouse_handler",["require","exports","module","ace/lib/event","ace/lib/useragent","ace/mouse/default_handlers","ace/mouse/default_gutter_handler","ace/mouse/mouse_event","ace/mouse/dragdrop_handler","ace/config"], function(require, exports, module) {
"use strict";

var event = require("../lib/event");
var useragent = require("../lib/useragent");
var DefaultHandlers = require("./default_handlers").DefaultHandlers;
var DefaultGutterHandler = require("./default_gutter_handler").GutterHandler;
var MouseEvent = require("./mouse_event").MouseEvent;
var DragdropHandler = require("./dragdrop_handler").DragdropHandler;
var config = require("../config");

var MouseHandler = function(editor) {
    var _self = this;
    this.editor = editor;

    new DefaultHandlers(this);
    new DefaultGutterHandler(this);
    new DragdropHandler(this);

    var focusEditor = function(e) {
        var windowBlurred = !document.hasFocus || !document.hasFocus()
            || !editor.isFocused() && document.activeElement == (editor.textInput && editor.textInput.getElement());
        if (windowBlurred)
            window.focus();
        editor.focus();
    };

    var mouseTarget = editor.renderer.getMouseEventTarget();
    event.addListener(mouseTarget, "click", this.onMouseEvent.bind(this, "click"));
    event.addListener(mouseTarget, "mousemove", this.onMouseMove.bind(this, "mousemove"));
    event.addMultiMouseDownListener([
        mouseTarget,
        editor.renderer.scrollBarV && editor.renderer.scrollBarV.inner,
        editor.renderer.scrollBarH && editor.renderer.scrollBarH.inner,
        editor.textInput && editor.textInput.getElement()
    ].filter(Boolean), [400, 300, 250], this, "onMouseEvent");
    event.addMouseWheelListener(editor.container, this.onMouseWheel.bind(this, "mousewheel"));
    event.addTouchMoveListener(editor.container, this.onTouchMove.bind(this, "touchmove"));

    var gutterEl = editor.renderer.$gutter;
    event.addListener(gutterEl, "mousedown", this.onMouseEvent.bind(this, "guttermousedown"));
    event.addListener(gutterEl, "click", this.onMouseEvent.bind(this, "gutterclick"));
    event.addListener(gutterEl, "dblclick", this.onMouseEvent.bind(this, "gutterdblclick"));
    event.addListener(gutterEl, "mousemove", this.onMouseEvent.bind(this, "guttermousemove"));

    event.addListener(mouseTarget, "mousedown", focusEditor);
    event.addListener(gutterEl, "mousedown", focusEditor);
    if (useragent.isIE && editor.renderer.scrollBarV) {
        event.addListener(editor.renderer.scrollBarV.element, "mousedown", focusEditor);
        event.addListener(editor.renderer.scrollBarH.element, "mousedown", focusEditor);
    }

    editor.on("mousemove", function(e){
        if (_self.state || _self.$dragDelay || !_self.$dragEnabled)
            return;

        var character = editor.renderer.screenToTextCoordinates(e.x, e.y);
        var range = editor.session.selection.getRange();
        var renderer = editor.renderer;

        if (!range.isEmpty() && range.insideStart(character.row, character.column)) {
            renderer.setCursorStyle("default");
        } else {
            renderer.setCursorStyle("");
        }
    });
};

(function() {
    this.onMouseEvent = function(name, e) {
        this.editor._emit(name, new MouseEvent(e, this.editor));
    };

    this.onMouseMove = function(name, e) {
        var listeners = this.editor._eventRegistry && this.editor._eventRegistry.mousemove;
        if (!listeners || !listeners.length)
            return;

        this.editor._emit(name, new MouseEvent(e, this.editor));
    };

    this.onMouseWheel = function(name, e) {
        var mouseEvent = new MouseEvent(e, this.editor);
        mouseEvent.speed = this.$scrollSpeed * 2;
        mouseEvent.wheelX = e.wheelX;
        mouseEvent.wheelY = e.wheelY;

        this.editor._emit(name, mouseEvent);
    };
    
    this.onTouchMove = function (name, e) {
        var mouseEvent = new MouseEvent(e, this.editor);
        mouseEvent.speed = 1;//this.$scrollSpeed * 2;
        mouseEvent.wheelX = e.wheelX;
        mouseEvent.wheelY = e.wheelY;
        this.editor._emit(name, mouseEvent);
    };

    this.setState = function(state) {
        this.state = state;
    };

    this.captureMouse = function(ev, mouseMoveHandler) {
        this.x = ev.x;
        this.y = ev.y;

        this.isMousePressed = true;
        var renderer = this.editor.renderer;
        if (renderer.$keepTextAreaAtCursor)
            renderer.$keepTextAreaAtCursor = null;

        var self = this;
        var onMouseMove = function(e) {
            if (!e) return;
            if (useragent.isWebKit && !e.which && self.releaseMouse)
                return self.releaseMouse();

            self.x = e.clientX;
            self.y = e.clientY;
            mouseMoveHandler && mouseMoveHandler(e);
            self.mouseEvent = new MouseEvent(e, self.editor);
            self.$mouseMoved = true;
        };

        var onCaptureEnd = function(e) {
            clearInterval(timerId);
            onCaptureInterval();
            self[self.state + "End"] && self[self.state + "End"](e);
            self.state = "";
            if (renderer.$keepTextAreaAtCursor == null) {
                renderer.$keepTextAreaAtCursor = true;
                renderer.$moveTextAreaToCursor();
            }
            self.isMousePressed = false;
            self.$onCaptureMouseMove = self.releaseMouse = null;
            e && self.onMouseEvent("mouseup", e);
        };

        var onCaptureInterval = function() {
            self[self.state] && self[self.state]();
            self.$mouseMoved = false;
        };

        if (useragent.isOldIE && ev.domEvent.type == "dblclick") {
            return setTimeout(function() {onCaptureEnd(ev);});
        }

        self.$onCaptureMouseMove = onMouseMove;
        self.releaseMouse = event.capture(this.editor.container, onMouseMove, onCaptureEnd);
        var timerId = setInterval(onCaptureInterval, 20);
    };
    this.releaseMouse = null;
    this.cancelContextMenu = function() {
        var stop = function(e) {
            if (e && e.domEvent && e.domEvent.type != "contextmenu")
                return;
            this.editor.off("nativecontextmenu", stop);
            if (e && e.domEvent)
                event.stopEvent(e.domEvent);
        }.bind(this);
        setTimeout(stop, 10);
        this.editor.on("nativecontextmenu", stop);
    };
}).call(MouseHandler.prototype);

config.defineOptions(MouseHandler.prototype, "mouseHandler", {
    scrollSpeed: {initialValue: 2},
    dragDelay: {initialValue: (useragent.isMac ? 150 : 0)},
    dragEnabled: {initialValue: true},
    focusTimout: {initialValue: 0},
    tooltipFollowsMouse: {initialValue: true}
});


exports.MouseHandler = MouseHandler;
});

ace.define("ace/mouse/fold_handler",["require","exports","module"], function(require, exports, module) {
"use strict";

function FoldHandler(editor) {

    editor.on("click", function(e) {
        var position = e.getDocumentPosition();
        var session = editor.session;
        var fold = session.getFoldAt(position.row, position.column, 1);
        if (fold) {
            if (e.getAccelKey())
                session.removeFold(fold);
            else
                session.expandFold(fold);

            e.stop();
        }
    });

    editor.on("gutterclick", function(e) {
        var gutterRegion = editor.renderer.$gutterLayer.getRegion(e);

        if (gutterRegion == "foldWidgets") {
            var row = e.getDocumentPosition().row;
            var session = editor.session;
            if (session.foldWidgets && session.foldWidgets[row])
                editor.session.onFoldWidgetClick(row, e);
            if (!editor.isFocused())
                editor.focus();
            e.stop();
        }
    });

    editor.on("gutterdblclick", function(e) {
        var gutterRegion = editor.renderer.$gutterLayer.getRegion(e);

        if (gutterRegion == "foldWidgets") {
            var row = e.getDocumentPosition().row;
            var session = editor.session;
            var data = session.getParentFoldRangeData(row, true);
            var range = data.range || data.firstRange;

            if (range) {
                row = range.start.row;
                var fold = session.getFoldAt(row, session.getLine(row).length, 1);

                if (fold) {
                    session.removeFold(fold);
                } else {
                    session.addFold("...", range);
                    editor.renderer.scrollCursorIntoView({row: range.start.row, column: 0});
                }
            }
            e.stop();
        }
    });
}

exports.FoldHandler = FoldHandler;

});

ace.define("ace/keyboard/keybinding",["require","exports","module","ace/lib/keys","ace/lib/event"], function(require, exports, module) {
"use strict";

var keyUtil  = require("../lib/keys");
var event = require("../lib/event");

var KeyBinding = function(editor) {
    this.$editor = editor;
    this.$data = {editor: editor};
    this.$handlers = [];
    this.setDefaultHandler(editor.commands);
};

(function() {
    this.setDefaultHandler = function(kb) {
        this.removeKeyboardHandler(this.$defaultHandler);
        this.$defaultHandler = kb;
        this.addKeyboardHandler(kb, 0);
    };

    this.setKeyboardHandler = function(kb) {
        var h = this.$handlers;
        if (h[h.length - 1] == kb)
            return;

        while (h[h.length - 1] && h[h.length - 1] != this.$defaultHandler)
            this.removeKeyboardHandler(h[h.length - 1]);

        this.addKeyboardHandler(kb, 1);
    };

    this.addKeyboardHandler = function(kb, pos) {
        if (!kb)
            return;
        if (typeof kb == "function" && !kb.handleKeyboard)
            kb.handleKeyboard = kb;
        var i = this.$handlers.indexOf(kb);
        if (i != -1)
            this.$handlers.splice(i, 1);

        if (pos == undefined)
            this.$handlers.push(kb);
        else
            this.$handlers.splice(pos, 0, kb);

        if (i == -1 && kb.attach)
            kb.attach(this.$editor);
    };

    this.removeKeyboardHandler = function(kb) {
        var i = this.$handlers.indexOf(kb);
        if (i == -1)
            return false;
        this.$handlers.splice(i, 1);
        kb.detach && kb.detach(this.$editor);
        return true;
    };

    this.getKeyboardHandler = function() {
        return this.$handlers[this.$handlers.length - 1];
    };
    
    this.getStatusText = function() {
        var data = this.$data;
        var editor = data.editor;
        return this.$handlers.map(function(h) {
            return h.getStatusText && h.getStatusText(editor, data) || "";
        }).filter(Boolean).join(" ");
    };

    this.$callKeyboardHandlers = function(hashId, keyString, keyCode, e) {
        var toExecute;
        var success = false;
        var commands = this.$editor.commands;

        for (var i = this.$handlers.length; i--;) {
            toExecute = this.$handlers[i].handleKeyboard(
                this.$data, hashId, keyString, keyCode, e
            );
            if (!toExecute || !toExecute.command)
                continue;
            if (toExecute.command == "null") {
                success = true;
            } else {
                success = commands.exec(toExecute.command, this.$editor, toExecute.args, e);
            }
            if (success && e && hashId != -1 && 
                toExecute.passEvent != true && toExecute.command.passEvent != true
            ) {
                event.stopEvent(e);
            }
            if (success)
                break;
        }
        
        if (!success && hashId == -1) {
            toExecute = {command: "insertstring"};
            success = commands.exec("insertstring", this.$editor, keyString);
        }
        
        if (success && this.$editor._signal)
            this.$editor._signal("keyboardActivity", toExecute);
        
        return success;
    };

    this.onCommandKey = function(e, hashId, keyCode) {
        var keyString = keyUtil.keyCodeToString(keyCode);
        this.$callKeyboardHandlers(hashId, keyString, keyCode, e);
    };

    this.onTextInput = function(text) {
        this.$callKeyboardHandlers(-1, text);
    };

}).call(KeyBinding.prototype);

exports.KeyBinding = KeyBinding;
});

ace.define("ace/lib/bidiutil",["require","exports","module"], function(require, exports, module) {
"use strict";

var ArabicAlefBetIntervalsBegine = ['\u0621', '\u0641'];
var ArabicAlefBetIntervalsEnd = ['\u063A', '\u064a'];
var dir = 0, hiLevel = 0;
var lastArabic = false, hasUBAT_AL = false,  hasUBAT_B = false,  hasUBAT_S = false, hasBlockSep = false, hasSegSep = false;

var impTab_LTR = [	[	0,		3,		0,		1,		0,		0,		0	],	[	0,		3,		0,		1,		2,		2,		0	],	[	0,		3,		0,		0x11,		2,		0,		1	],	[	0,		3,		5,		5,		4,		1,		0	],	[	0,		3,		0x15,		0x15,		4,		0,		1	],	[	0,		3,		5,		5,		4,		2,		0	]
];

var impTab_RTL = [	[	2,		0,		1,		1,		0,		1,		0	],	[	2,		0,		1,		1,		0,		2,		0	],	[	2,		0,		2,		1,		3,		2,		0	],	[	2,		0,		2,		0x21,		3,		1,		1	]
];

var LTR = 0, RTL = 1;

var L = 0;
var R = 1;
var EN = 2;
var AN = 3;
var ON = 4;
var B = 5;
var S = 6;
var AL = 7;
var WS = 8;
var CS = 9;
var ES = 10;
var ET = 11;
var NSM = 12;
var LRE = 13;
var RLE = 14;
var PDF = 15;
var LRO = 16;
var RLO = 17;
var BN = 18;

var UnicodeTBL00 = [
BN,BN,BN,BN,BN,BN,BN,BN,BN,S,B,S,WS,B,BN,BN,
BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,B,B,B,S,
WS,ON,ON,ET,ET,ET,ON,ON,ON,ON,ON,ES,CS,ES,CS,CS,
EN,EN,EN,EN,EN,EN,EN,EN,EN,EN,CS,ON,ON,ON,ON,ON,
ON,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,
L,L,L,L,L,L,L,L,L,L,L,ON,ON,ON,ON,ON,
ON,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,
L,L,L,L,L,L,L,L,L,L,L,ON,ON,ON,ON,BN,
BN,BN,BN,BN,BN,B,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,
BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,
CS,ON,ET,ET,ET,ET,ON,ON,ON,ON,L,ON,ON,BN,ON,ON,
ET,ET,EN,EN,ON,L,ON,ON,ON,EN,L,ON,ON,ON,ON,ON
];

var UnicodeTBL20 = [
WS,WS,WS,WS,WS,WS,WS,WS,WS,WS,WS,BN,BN,BN,L,R	,
ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,
ON,ON,ON,ON,ON,ON,ON,ON,WS,B,LRE,RLE,PDF,LRO,RLO,CS,
ET,ET,ET,ET,ET,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,
ON,ON,ON,ON,CS,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,
ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,WS
];

function _computeLevels(chars, levels, len, charTypes) {
	var impTab = dir ? impTab_RTL : impTab_LTR
		, prevState = null, newClass = null, newLevel = null, newState = 0
		, action = null, cond = null, condPos = -1, i = null, ix = null, classes = [];

	if (!charTypes) {
		for (i = 0, charTypes = []; i < len; i++) {
			charTypes[i] = _getCharacterType(chars[i]);
		}
	}
	hiLevel = dir;
	lastArabic = false;
	hasUBAT_AL = false;
	hasUBAT_B = false;
	hasUBAT_S = false;
	for (ix = 0; ix < len; ix++){
		prevState = newState;
		classes[ix] = newClass = _getCharClass(chars, charTypes, classes, ix);
		newState = impTab[prevState][newClass];
		action = newState & 0xF0;
		newState &= 0x0F;
		levels[ix] = newLevel = impTab[newState][5];
		if (action > 0){
			if (action == 0x10){
				for(i = condPos; i < ix; i++){
					levels[i] = 1;
				}
				condPos = -1;
			} else {
				condPos = -1;
			}
		}
		cond = impTab[newState][6];
		if (cond){
			if(condPos == -1){
				condPos = ix;
			}
		}else{
			if (condPos > -1){
				for(i = condPos; i < ix; i++){
					levels[i] = newLevel;
				}
				condPos = -1;
			}
		}
		if (charTypes[ix] == B){
			levels[ix] = 0;
		}
		hiLevel |= newLevel;
	}
	if (hasUBAT_S){
		for(i = 0; i < len; i++){
			if(charTypes[i] == S){
				levels[i] = dir;
				for(var j = i - 1; j >= 0; j--){
					if(charTypes[j] == WS){
						levels[j] = dir;
					}else{
						break;
					}
				}
			}
		}
	}
}

function _invertLevel(lev, levels, _array) {
	if (hiLevel < lev){
		return;
	}
	if (lev == 1 && dir == RTL && !hasUBAT_B){
		_array.reverse();
		return;
	}
	var len = _array.length, start = 0, end, lo, hi, tmp;
	while(start < len){
		if (levels[start] >= lev){
			end = start + 1;
		while(end < len && levels[end] >= lev){
			end++;
		}
		for(lo = start, hi = end - 1 ; lo < hi; lo++, hi--){
			tmp = _array[lo];
			_array[lo] = _array[hi];
			_array[hi] = tmp;
		}
		start = end;
	}
	start++;
	}
}

function _getCharClass(chars, types, classes, ix) {			
	var cType = types[ix], wType, nType, len, i;
	switch(cType){
		case L:
		case R:
			lastArabic = false;
		case ON:
		case AN:
			return cType;
		case EN:
			return lastArabic ? AN : EN;
		case AL:
			lastArabic = true;
			hasUBAT_AL = true;
			return R;
		case WS:
			return ON;
		case CS:
			if (ix < 1 || (ix + 1) >= types.length ||
				((wType = classes[ix - 1]) != EN && wType != AN) ||
				((nType = types[ix + 1]) != EN && nType != AN)){
				return ON;
			}
			if (lastArabic){nType = AN;}
			return nType == wType ? nType : ON;
		case ES:
			wType = ix > 0 ? classes[ix - 1] : B;
			if (wType == EN && (ix + 1) < types.length && types[ix + 1] == EN){
				return EN;
			}
			return ON;
		case ET:
			if (ix > 0 && classes[ix - 1] == EN){
				return EN;
			}
			if (lastArabic){
				return ON;
			}
			i = ix + 1;
			len = types.length;
			while (i < len && types[i] == ET){
				i++;
			}
			if (i < len && types[i] == EN){
				return EN;
			}
			return ON;
		case NSM:
			len = types.length;
			i = ix + 1;
			while (i < len && types[i] == NSM){
				i++;
			}
			if (i < len){
				var c = chars[ix], rtlCandidate = (c >= 0x0591 && c <= 0x08FF) || c == 0xFB1E;
				
				wType = types[i];
				if (rtlCandidate && (wType == R || wType == AL)){
					return R;
				}
			}

			if (ix < 1 || (wType = types[ix - 1]) == B){
				return ON;
			}
			return classes[ix - 1];
		case B:
			lastArabic = false;
			hasUBAT_B = true;
			return dir;
		case S:
			hasUBAT_S = true;
			return ON;
		case LRE:
		case RLE:
		case LRO:
		case RLO:
		case PDF:
			lastArabic = false;
		case BN:
			return ON;
	}
}

function _getCharacterType( ch ) {		
	var uc = ch.charCodeAt(0), hi = uc >> 8;
	
	if (hi == 0) {		
		return ((uc > 0x00BF) ? L : UnicodeTBL00[uc]);
	} else if (hi == 5) {
		return (/[\u0591-\u05f4]/.test(ch) ? R : L);
	} else if (hi == 6) {
		if (/[\u0610-\u061a\u064b-\u065f\u06d6-\u06e4\u06e7-\u06ed]/.test(ch))
			return NSM;
		else if (/[\u0660-\u0669\u066b-\u066c]/.test(ch))
			return AN;
		else if (uc == 0x066A)
			return ET;
		else if (/[\u06f0-\u06f9]/.test(ch))
			return EN;			
		else
			return AL;
	} else if (hi == 0x20 && uc <= 0x205F) {
		return UnicodeTBL20[uc & 0xFF];
	} else if (hi == 0xFE) {
		return (uc >= 0xFE70 ? AL : ON);
	}		
	return ON;	
}

function _isArabicDiacritics( ch ) {
	return (ch >= '\u064b' && ch <= '\u0655');
}
exports.L = L;
exports.R = R;
exports.EN = EN;
exports.ON_R = 3;
exports.AN = 4;
exports.R_H = 5;
exports.B = 6;

exports.DOT = "\xB7";
exports.doBidiReorder = function(text, textCharTypes, isRtl) {
	if (text.length < 2)
		return {};
		
	var chars = text.split(""), logicalFromVisual = new Array(chars.length),
		bidiLevels = new Array(chars.length), levels = []; 

	dir = isRtl ? RTL : LTR;

	_computeLevels(chars, levels, chars.length, textCharTypes);

	for (var i = 0; i < logicalFromVisual.length; logicalFromVisual[i] = i, i++);

	_invertLevel(2, levels, logicalFromVisual);
	_invertLevel(1, levels, logicalFromVisual);

	for (var i = 0; i < logicalFromVisual.length - 1; i++) { //fix levels to reflect character width
		if (textCharTypes[i] === AN) {
			levels[i] = exports.AN;
		} else if (levels[i] === R && ((textCharTypes[i] > AL && textCharTypes[i] < LRE) 
			|| textCharTypes[i] === ON || textCharTypes[i] === BN)) {
			levels[i] = exports.ON_R;
		} else if ((i > 0 && chars[i - 1] === '\u0644') && /\u0622|\u0623|\u0625|\u0627/.test(chars[i])) {
			levels[i - 1] = levels[i] = exports.R_H;
			i++;
		}
	}
	if (chars[chars.length - 1] === exports.DOT)
		levels[chars.length - 1] = exports.B;
				
	for (var i = 0; i < logicalFromVisual.length; i++) {
		bidiLevels[i] = levels[logicalFromVisual[i]];
	}

	return {'logicalFromVisual': logicalFromVisual, 'bidiLevels': bidiLevels};
};
exports.hasBidiCharacters = function(text, textCharTypes){
	var ret = false;
	for (var i = 0; i < text.length; i++){
		textCharTypes[i] = _getCharacterType(text.charAt(i));
		if (!ret && (textCharTypes[i] == R || textCharTypes[i] == AL))
			ret = true;
	}
	return ret;
};	
exports.getVisualFromLogicalIdx = function(logIdx, rowMap) {
	for (var i = 0; i < rowMap.logicalFromVisual.length; i++) {
		if (rowMap.logicalFromVisual[i] == logIdx)
			return i;
	}
	return 0;
};

});

ace.define("ace/bidihandler",["require","exports","module","ace/lib/bidiutil","ace/lib/lang","ace/lib/useragent"], function(require, exports, module) {
"use strict";

var bidiUtil = require("./lib/bidiutil");
var lang = require("./lib/lang");
var useragent = require("./lib/useragent");
var bidiRE = /[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;
var BidiHandler = function(session) {
    this.session = session;
    this.bidiMap = {};
    this.currentRow = null;
    this.bidiUtil = bidiUtil;
    this.charWidths = [];
    this.EOL = "\xAC";
    this.showInvisibles = true;
    this.isRtlDir = false;
    this.line = "";
    this.wrapIndent = 0;
    this.isLastRow = false;
    this.EOF = "\xB6";
    this.seenBidi = false;
};

(function() {
    this.isBidiRow = function(screenRow, docRow, splitIndex) {
        if (!this.seenBidi)
            return false;
        if (screenRow !== this.currentRow) {
            this.currentRow = screenRow;
            this.updateRowLine(docRow, splitIndex);
            this.updateBidiMap();
        }
        return this.bidiMap.bidiLevels;
    };

    this.onChange = function(delta) {
        if (!this.seenBidi) {
            if (delta.action == "insert" && bidiRE.test(delta.lines.join("\n"))) {
                this.seenBidi = true;
                this.currentRow = null;
            }
        } 
        else {
            this.currentRow = null;
        }
    };

    this.getDocumentRow = function() {
        var docRow = 0;
        var rowCache = this.session.$screenRowCache;
        if (rowCache.length) {
            var index = this.session.$getRowCacheIndex(rowCache, this.currentRow);
            if (index >= 0)
                docRow = this.session.$docRowCache[index];
        }

        return docRow;
    };

    this.getSplitIndex = function() {
        var splitIndex = 0;
        var rowCache = this.session.$screenRowCache;
        if (rowCache.length) {
            var currentIndex, prevIndex = this.session.$getRowCacheIndex(rowCache, this.currentRow);
            while (this.currentRow - splitIndex > 0) {
                currentIndex = this.session.$getRowCacheIndex(rowCache, this.currentRow - splitIndex - 1);
                if (currentIndex !== prevIndex)
                    break;

                prevIndex = currentIndex;
                splitIndex++;
            }
        }

        return splitIndex;
    };

    this.updateRowLine = function(docRow, splitIndex) {
        if (docRow === undefined)
            docRow = this.getDocumentRow();
            
        this.wrapIndent = 0;
        this.isLastRow = (docRow === this.session.getLength() - 1);
        this.line = this.session.getLine(docRow);
        if (this.session.$useWrapMode) {
            var splits = this.session.$wrapData[docRow];
            if (splits) {
                if (splitIndex === undefined)
                    splitIndex = this.getSplitIndex();

                if(splitIndex > 0 && splits.length) {
                    this.wrapIndent = splits.indent;
                    this.line = (splitIndex < splits.length) ?
                        this.line.substring(splits[splitIndex - 1], splits[splits.length - 1]) :
                            this.line.substring(splits[splits.length - 1]);
                } else {
                    this.line = this.line.substring(0, splits[splitIndex]);
                }
            }
        }
        var session = this.session, shift = 0, size;
        this.line = this.line.replace(/\t|[\u1100-\u2029, \u202F-\uFFE6]/g, function(ch, i){
            if (ch === '\t' || session.isFullWidth(ch.charCodeAt(0))) {
                size = (ch === '\t') ? session.getScreenTabSize(i + shift) : 2;
                shift += size - 1;
                return lang.stringRepeat(bidiUtil.DOT, size);
            }
            return ch;
        });
    };
    
    this.updateBidiMap = function() {
        var textCharTypes = [], endOfLine = this.isLastRow ? this.EOF : this.EOL;
        var line = this.line + (this.showInvisibles ? endOfLine : bidiUtil.DOT);
        if (bidiUtil.hasBidiCharacters(line, textCharTypes)) {
            this.bidiMap = bidiUtil.doBidiReorder(line, textCharTypes, this.isRtlDir);
        } else {
            this.bidiMap = {};
        }
    };
    this.markAsDirty = function() {
        this.currentRow = null;
    };
    this.updateCharacterWidths = function(fontMetrics) {
        if (!this.seenBidi)
            return;
        if (this.characterWidth === fontMetrics.$characterSize.width)
            return;

        var characterWidth = this.characterWidth = fontMetrics.$characterSize.width;
        var bidiCharWidth = fontMetrics.$measureCharWidth("\u05d4");

        this.charWidths[bidiUtil.L] = this.charWidths[bidiUtil.EN] = this.charWidths[bidiUtil.ON_R] = characterWidth;
        this.charWidths[bidiUtil.R] = this.charWidths[bidiUtil.AN] = bidiCharWidth;
        this.charWidths[bidiUtil.R_H] = useragent.isChrome ? bidiCharWidth : bidiCharWidth * 0.45;
        this.charWidths[bidiUtil.B] = 0;

        this.currentRow = null;
    };

    this.getShowInvisibles = function() {
        return this.showInvisibles;
    };

    this.setShowInvisibles = function(showInvisibles) {
        this.showInvisibles = showInvisibles;
        this.currentRow = null;
    };

    this.setEolChar = function(eolChar) {
        this.EOL = eolChar; 
    };

    this.setTextDir = function(isRtlDir) {
        this.isRtlDir = isRtlDir; 
    };
    this.getPosLeft = function(col) {
        col -= this.wrapIndent;
        var visualIdx = bidiUtil.getVisualFromLogicalIdx(col > 0 ? col - 1 : 0, this.bidiMap),
            levels = this.bidiMap.bidiLevels, left = 0;

        if (col === 0 && levels[visualIdx] % 2 !== 0)
            visualIdx++;

        for (var i = 0; i < visualIdx; i++) {
            left += this.charWidths[levels[i]];
        }

        if (col !== 0 && levels[visualIdx] % 2 === 0)
            left += this.charWidths[levels[visualIdx]];

        if (this.wrapIndent)
            left += this.wrapIndent * this.charWidths[bidiUtil.L];

        return left;
    };
    this.getSelections = function(startCol, endCol) {
        var map = this.bidiMap, levels = map.bidiLevels, level, offset = this.wrapIndent * this.charWidths[bidiUtil.L], selections = [],
            selColMin = Math.min(startCol, endCol) - this.wrapIndent, selColMax = Math.max(startCol, endCol) - this.wrapIndent,
                isSelected = false, isSelectedPrev = false, selectionStart = 0;

        for (var logIdx, visIdx = 0; visIdx < levels.length; visIdx++) {
            logIdx = map.logicalFromVisual[visIdx];
            level = levels[visIdx];
            isSelected = (logIdx >= selColMin) && (logIdx < selColMax);
            if (isSelected && !isSelectedPrev) {
                selectionStart = offset;
            } else if (!isSelected && isSelectedPrev) {
                selections.push({left: selectionStart, width: offset - selectionStart});
            }
            offset += this.charWidths[level];
            isSelectedPrev = isSelected;
        }

        if (isSelected && (visIdx === levels.length)) {
            selections.push({left: selectionStart, width: offset - selectionStart});
        }

        return selections;
    };
    this.offsetToCol = function(posX) {
        var logicalIdx = 0, posX = Math.max(posX, 0),
            offset = 0, visualIdx = 0, levels = this.bidiMap.bidiLevels,
                charWidth = this.charWidths[levels[visualIdx]];

        if (this.wrapIndent) {
            posX -= this.wrapIndent * this.charWidths[bidiUtil.L];
        }
    
        while(posX > offset + charWidth/2) {
            offset += charWidth;
            if(visualIdx === levels.length - 1) {
                charWidth = 0;
                break;
            }
            charWidth = this.charWidths[levels[++visualIdx]];
        }
    
        if (visualIdx > 0 && (levels[visualIdx - 1] % 2 !== 0) && (levels[visualIdx] % 2 === 0)){
            if(posX < offset)
                visualIdx--;
            logicalIdx = this.bidiMap.logicalFromVisual[visualIdx];

        } else if (visualIdx > 0 && (levels[visualIdx - 1] % 2 === 0) && (levels[visualIdx] % 2 !== 0)){
            logicalIdx = 1 + ((posX > offset) ? this.bidiMap.logicalFromVisual[visualIdx]
                    : this.bidiMap.logicalFromVisual[visualIdx - 1]);

        } else if ((this.isRtlDir && visualIdx === levels.length - 1 && charWidth === 0 && (levels[visualIdx - 1] % 2 === 0))
                || (!this.isRtlDir && visualIdx === 0 && (levels[visualIdx] % 2 !== 0))){
            logicalIdx = 1 + this.bidiMap.logicalFromVisual[visualIdx];
        } else {
            if (visualIdx > 0 && (levels[visualIdx - 1] % 2 !== 0) && charWidth !== 0)
                visualIdx--;
            logicalIdx = this.bidiMap.logicalFromVisual[visualIdx];
        }

        return (logicalIdx + this.wrapIndent);
    };

}).call(BidiHandler.prototype);

exports.BidiHandler = BidiHandler;
});

ace.define("ace/range",["require","exports","module"], function(require, exports, module) {
"use strict";
var comparePoints = function(p1, p2) {
    return p1.row - p2.row || p1.column - p2.column;
};
var Range = function(startRow, startColumn, endRow, endColumn) {
    this.start = {
        row: startRow,
        column: startColumn
    };

    this.end = {
        row: endRow,
        column: endColumn
    };
};

(function() {
    this.isEqual = function(range) {
        return this.start.row === range.start.row &&
            this.end.row === range.end.row &&
            this.start.column === range.start.column &&
            this.end.column === range.end.column;
    };
    this.toString = function() {
        return ("Range: [" + this.start.row + "/" + this.start.column +
            "] -> [" + this.end.row + "/" + this.end.column + "]");
    };

    this.contains = function(row, column) {
        return this.compare(row, column) == 0;
    };
    this.compareRange = function(range) {
        var cmp,
            end = range.end,
            start = range.start;

        cmp = this.compare(end.row, end.column);
        if (cmp == 1) {
            cmp = this.compare(start.row, start.column);
            if (cmp == 1) {
                return 2;
            } else if (cmp == 0) {
                return 1;
            } else {
                return 0;
            }
        } else if (cmp == -1) {
            return -2;
        } else {
            cmp = this.compare(start.row, start.column);
            if (cmp == -1) {
                return -1;
            } else if (cmp == 1) {
                return 42;
            } else {
                return 0;
            }
        }
    };
    this.comparePoint = function(p) {
        return this.compare(p.row, p.column);
    };
    this.containsRange = function(range) {
        return this.comparePoint(range.start) == 0 && this.comparePoint(range.end) == 0;
    };
    this.intersects = function(range) {
        var cmp = this.compareRange(range);
        return (cmp == -1 || cmp == 0 || cmp == 1);
    };
    this.isEnd = function(row, column) {
        return this.end.row == row && this.end.column == column;
    };
    this.isStart = function(row, column) {
        return this.start.row == row && this.start.column == column;
    };
    this.setStart = function(row, column) {
        if (typeof row == "object") {
            this.start.column = row.column;
            this.start.row = row.row;
        } else {
            this.start.row = row;
            this.start.column = column;
        }
    };
    this.setEnd = function(row, column) {
        if (typeof row == "object") {
            this.end.column = row.column;
            this.end.row = row.row;
        } else {
            this.end.row = row;
            this.end.column = column;
        }
    };
    this.inside = function(row, column) {
        if (this.compare(row, column) == 0) {
            if (this.isEnd(row, column) || this.isStart(row, column)) {
                return false;
            } else {
                return true;
            }
        }
        return false;
    };
    this.insideStart = function(row, column) {
        if (this.compare(row, column) == 0) {
            if (this.isEnd(row, column)) {
                return false;
            } else {
                return true;
            }
        }
        return false;
    };
    this.insideEnd = function(row, column) {
        if (this.compare(row, column) == 0) {
            if (this.isStart(row, column)) {
                return false;
            } else {
                return true;
            }
        }
        return false;
    };
    this.compare = function(row, column) {
        if (!this.isMultiLine()) {
            if (row === this.start.row) {
                return column < this.start.column ? -1 : (column > this.end.column ? 1 : 0);
            }
        }

        if (row < this.start.row)
            return -1;

        if (row > this.end.row)
            return 1;

        if (this.start.row === row)
            return column >= this.start.column ? 0 : -1;

        if (this.end.row === row)
            return column <= this.end.column ? 0 : 1;

        return 0;
    };
    this.compareStart = function(row, column) {
        if (this.start.row == row && this.start.column == column) {
            return -1;
        } else {
            return this.compare(row, column);
        }
    };
    this.compareEnd = function(row, column) {
        if (this.end.row == row && this.end.column == column) {
            return 1;
        } else {
            return this.compare(row, column);
        }
    };
    this.compareInside = function(row, column) {
        if (this.end.row == row && this.end.column == column) {
            return 1;
        } else if (this.start.row == row && this.start.column == column) {
            return -1;
        } else {
            return this.compare(row, column);
        }
    };
    this.clipRows = function(firstRow, lastRow) {
        if (this.end.row > lastRow)
            var end = {row: lastRow + 1, column: 0};
        else if (this.end.row < firstRow)
            var end = {row: firstRow, column: 0};

        if (this.start.row > lastRow)
            var start = {row: lastRow + 1, column: 0};
        else if (this.start.row < firstRow)
            var start = {row: firstRow, column: 0};

        return Range.fromPoints(start || this.start, end || this.end);
    };
    this.extend = function(row, column) {
        var cmp = this.compare(row, column);

        if (cmp == 0)
            return this;
        else if (cmp == -1)
            var start = {row: row, column: column};
        else
            var end = {row: row, column: column};

        return Range.fromPoints(start || this.start, end || this.end);
    };

    this.isEmpty = function() {
        return (this.start.row === this.end.row && this.start.column === this.end.column);
    };
    this.isMultiLine = function() {
        return (this.start.row !== this.end.row);
    };
    this.clone = function() {
        return Range.fromPoints(this.start, this.end);
    };
    this.collapseRows = function() {
        if (this.end.column == 0)
            return new Range(this.start.row, 0, Math.max(this.start.row, this.end.row-1), 0);
        else
            return new Range(this.start.row, 0, this.end.row, 0);
    };
    this.toScreenRange = function(session) {
        var screenPosStart = session.documentToScreenPosition(this.start);
        var screenPosEnd = session.documentToScreenPosition(this.end);

        return new Range(
            screenPosStart.row, screenPosStart.column,
            screenPosEnd.row, screenPosEnd.column
        );
    };
    this.moveBy = function(row, column) {
        this.start.row += row;
        this.start.column += column;
        this.end.row += row;
        this.end.column += column;
    };

}).call(Range.prototype);
Range.fromPoints = function(start, end) {
    return new Range(start.row, start.column, end.row, end.column);
};
Range.comparePoints = comparePoints;

Range.comparePoints = function(p1, p2) {
    return p1.row - p2.row || p1.column - p2.column;
};


exports.Range = Range;
});

ace.define("ace/selection",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/lib/event_emitter","ace/range"], function(require, exports, module) {
"use strict";

var oop = require("./lib/oop");
var lang = require("./lib/lang");
var EventEmitter = require("./lib/event_emitter").EventEmitter;
var Range = require("./range").Range;
var Selection = function(session) {
    this.session = session;
    this.doc = session.getDocument();

    this.clearSelection();
    this.lead = this.selectionLead = this.doc.createAnchor(0, 0);
    this.anchor = this.selectionAnchor = this.doc.createAnchor(0, 0);

    var self = this;
    this.lead.on("change", function(e) {
        self._emit("changeCursor");
        if (!self.$isEmpty)
            self._emit("changeSelection");
        if (!self.$keepDesiredColumnOnChange && e.old.column != e.value.column)
            self.$desiredColumn = null;
    });

    this.selectionAnchor.on("change", function() {
        if (!self.$isEmpty)
            self._emit("changeSelection");
    });
};

(function() {

    oop.implement(this, EventEmitter);
    this.isEmpty = function() {
        return (this.$isEmpty || (
            this.anchor.row == this.lead.row &&
            this.anchor.column == this.lead.column
        ));
    };
    this.isMultiLine = function() {
        if (this.isEmpty()) {
            return false;
        }

        return this.getRange().isMultiLine();
    };
    this.getCursor = function() {
        return this.lead.getPosition();
    };
    this.setSelectionAnchor = function(row, column) {
        this.anchor.setPosition(row, column);

        if (this.$isEmpty) {
            this.$isEmpty = false;
            this._emit("changeSelection");
        }
    };
    this.getSelectionAnchor = function() {
        if (this.$isEmpty)
            return this.getSelectionLead();
        else
            return this.anchor.getPosition();
    };
    this.getSelectionLead = function() {
        return this.lead.getPosition();
    };
    this.shiftSelection = function(columns) {
        if (this.$isEmpty) {
            this.moveCursorTo(this.lead.row, this.lead.column + columns);
            return;
        }

        var anchor = this.getSelectionAnchor();
        var lead = this.getSelectionLead();

        var isBackwards = this.isBackwards();

        if (!isBackwards || anchor.column !== 0)
            this.setSelectionAnchor(anchor.row, anchor.column + columns);

        if (isBackwards || lead.column !== 0) {
            this.$moveSelection(function() {
                this.moveCursorTo(lead.row, lead.column + columns);
            });
        }
    };
    this.isBackwards = function() {
        var anchor = this.anchor;
        var lead = this.lead;
        return (anchor.row > lead.row || (anchor.row == lead.row && anchor.column > lead.column));
    };
    this.getRange = function() {
        var anchor = this.anchor;
        var lead = this.lead;

        if (this.isEmpty())
            return Range.fromPoints(lead, lead);

        if (this.isBackwards()) {
            return Range.fromPoints(lead, anchor);
        }
        else {
            return Range.fromPoints(anchor, lead);
        }
    };
    this.clearSelection = function() {
        if (!this.$isEmpty) {
            this.$isEmpty = true;
            this._emit("changeSelection");
        }
    };
    this.selectAll = function() {
        var lastRow = this.doc.getLength() - 1;
        this.setSelectionAnchor(0, 0);
        this.moveCursorTo(lastRow, this.doc.getLine(lastRow).length);
    };
    this.setRange =
    this.setSelectionRange = function(range, reverse) {
        if (reverse) {
            this.setSelectionAnchor(range.end.row, range.end.column);
            this.selectTo(range.start.row, range.start.column);
        } else {
            this.setSelectionAnchor(range.start.row, range.start.column);
            this.selectTo(range.end.row, range.end.column);
        }
        if (this.getRange().isEmpty())
            this.$isEmpty = true;
        this.$desiredColumn = null;
    };

    this.$moveSelection = function(mover) {
        var lead = this.lead;
        if (this.$isEmpty)
            this.setSelectionAnchor(lead.row, lead.column);

        mover.call(this);
    };
    this.selectTo = function(row, column) {
        this.$moveSelection(function() {
            this.moveCursorTo(row, column);
        });
    };
    this.selectToPosition = function(pos) {
        this.$moveSelection(function() {
            this.moveCursorToPosition(pos);
        });
    };
    this.moveTo = function(row, column) {
        this.clearSelection();
        this.moveCursorTo(row, column);
    };
    this.moveToPosition = function(pos) {
        this.clearSelection();
        this.moveCursorToPosition(pos);
    };
    this.selectUp = function() {
        this.$moveSelection(this.moveCursorUp);
    };
    this.selectDown = function() {
        this.$moveSelection(this.moveCursorDown);
    };
    this.selectRight = function() {
        this.$moveSelection(this.moveCursorRight);
    };
    this.selectLeft = function() {
        this.$moveSelection(this.moveCursorLeft);
    };
    this.selectLineStart = function() {
        this.$moveSelection(this.moveCursorLineStart);
    };
    this.selectLineEnd = function() {
        this.$moveSelection(this.moveCursorLineEnd);
    };
    this.selectFileEnd = function() {
        this.$moveSelection(this.moveCursorFileEnd);
    };
    this.selectFileStart = function() {
        this.$moveSelection(this.moveCursorFileStart);
    };
    this.selectWordRight = function() {
        this.$moveSelection(this.moveCursorWordRight);
    };
    this.selectWordLeft = function() {
        this.$moveSelection(this.moveCursorWordLeft);
    };
    this.getWordRange = function(row, column) {
        if (typeof column == "undefined") {
            var cursor = row || this.lead;
            row = cursor.row;
            column = cursor.column;
        }
        return this.session.getWordRange(row, column);
    };
    this.selectWord = function() {
        this.setSelectionRange(this.getWordRange());
    };
    this.selectAWord = function() {
        var cursor = this.getCursor();
        var range = this.session.getAWordRange(cursor.row, cursor.column);
        this.setSelectionRange(range);
    };

    this.getLineRange = function(row, excludeLastChar) {
        var rowStart = typeof row == "number" ? row : this.lead.row;
        var rowEnd;

        var foldLine = this.session.getFoldLine(rowStart);
        if (foldLine) {
            rowStart = foldLine.start.row;
            rowEnd = foldLine.end.row;
        } else {
            rowEnd = rowStart;
        }
        if (excludeLastChar === true)
            return new Range(rowStart, 0, rowEnd, this.session.getLine(rowEnd).length);
        else
            return new Range(rowStart, 0, rowEnd + 1, 0);
    };
    this.selectLine = function() {
        this.setSelectionRange(this.getLineRange());
    };
    this.moveCursorUp = function() {
        this.moveCursorBy(-1, 0);
    };
    this.moveCursorDown = function() {
        this.moveCursorBy(1, 0);
    };
    this.wouldMoveIntoSoftTab = function(cursor, tabSize, direction) {
        var start = cursor.column;
        var end = cursor.column + tabSize;

        if (direction < 0) {
            start = cursor.column - tabSize;
            end = cursor.column;
        }
        return this.session.isTabStop(cursor) && this.doc.getLine(cursor.row).slice(start, end).split(" ").length-1 == tabSize;
    };
    this.moveCursorLeft = function() {
        var cursor = this.lead.getPosition(),
            fold;

        if (fold = this.session.getFoldAt(cursor.row, cursor.column, -1)) {
            this.moveCursorTo(fold.start.row, fold.start.column);
        } else if (cursor.column === 0) {
            if (cursor.row > 0) {
                this.moveCursorTo(cursor.row - 1, this.doc.getLine(cursor.row - 1).length);
            }
        }
        else {
            var tabSize = this.session.getTabSize();
            if (this.wouldMoveIntoSoftTab(cursor, tabSize, -1) && !this.session.getNavigateWithinSoftTabs()) {
                this.moveCursorBy(0, -tabSize);
            } else {
                this.moveCursorBy(0, -1);
            }
        }
    };
    this.moveCursorRight = function() {
        var cursor = this.lead.getPosition(),
            fold;
        if (fold = this.session.getFoldAt(cursor.row, cursor.column, 1)) {
            this.moveCursorTo(fold.end.row, fold.end.column);
        }
        else if (this.lead.column == this.doc.getLine(this.lead.row).length) {
            if (this.lead.row < this.doc.getLength() - 1) {
                this.moveCursorTo(this.lead.row + 1, 0);
            }
        }
        else {
            var tabSize = this.session.getTabSize();
            var cursor = this.lead;
            if (this.wouldMoveIntoSoftTab(cursor, tabSize, 1) && !this.session.getNavigateWithinSoftTabs()) {
                this.moveCursorBy(0, tabSize);
            } else {
                this.moveCursorBy(0, 1);
            }
        }
    };
    this.moveCursorLineStart = function() {
        var row = this.lead.row;
        var column = this.lead.column;
        var screenRow = this.session.documentToScreenRow(row, column);
        var firstColumnPosition = this.session.screenToDocumentPosition(screenRow, 0);
        var beforeCursor = this.session.getDisplayLine(
            row, null, firstColumnPosition.row,
            firstColumnPosition.column
        );

        var leadingSpace = beforeCursor.match(/^\s*/);
        if (leadingSpace[0].length != column && !this.session.$useEmacsStyleLineStart)
            firstColumnPosition.column += leadingSpace[0].length;
        this.moveCursorToPosition(firstColumnPosition);
    };
    this.moveCursorLineEnd = function() {
        var lead = this.lead;
        var lineEnd = this.session.getDocumentLastRowColumnPosition(lead.row, lead.column);
        if (this.lead.column == lineEnd.column) {
            var line = this.session.getLine(lineEnd.row);
            if (lineEnd.column == line.length) {
                var textEnd = line.search(/\s+$/);
                if (textEnd > 0)
                    lineEnd.column = textEnd;
            }
        }

        this.moveCursorTo(lineEnd.row, lineEnd.column);
    };
    this.moveCursorFileEnd = function() {
        var row = this.doc.getLength() - 1;
        var column = this.doc.getLine(row).length;
        this.moveCursorTo(row, column);
    };
    this.moveCursorFileStart = function() {
        this.moveCursorTo(0, 0);
    };
    this.moveCursorLongWordRight = function() {
        var row = this.lead.row;
        var column = this.lead.column;
        var line = this.doc.getLine(row);
        var rightOfCursor = line.substring(column);

        var match;
        this.session.nonTokenRe.lastIndex = 0;
        this.session.tokenRe.lastIndex = 0;
        var fold = this.session.getFoldAt(row, column, 1);
        if (fold) {
            this.moveCursorTo(fold.end.row, fold.end.column);
            return;
        }
        if (match = this.session.nonTokenRe.exec(rightOfCursor)) {
            column += this.session.nonTokenRe.lastIndex;
            this.session.nonTokenRe.lastIndex = 0;
            rightOfCursor = line.substring(column);
        }
        if (column >= line.length) {
            this.moveCursorTo(row, line.length);
            this.moveCursorRight();
            if (row < this.doc.getLength() - 1)
                this.moveCursorWordRight();
            return;
        }
        if (match = this.session.tokenRe.exec(rightOfCursor)) {
            column += this.session.tokenRe.lastIndex;
            this.session.tokenRe.lastIndex = 0;
        }

        this.moveCursorTo(row, column);
    };
    this.moveCursorLongWordLeft = function() {
        var row = this.lead.row;
        var column = this.lead.column;
        var fold;
        if (fold = this.session.getFoldAt(row, column, -1)) {
            this.moveCursorTo(fold.start.row, fold.start.column);
            return;
        }

        var str = this.session.getFoldStringAt(row, column, -1);
        if (str == null) {
            str = this.doc.getLine(row).substring(0, column);
        }

        var leftOfCursor = lang.stringReverse(str);
        var match;
        this.session.nonTokenRe.lastIndex = 0;
        this.session.tokenRe.lastIndex = 0;
        if (match = this.session.nonTokenRe.exec(leftOfCursor)) {
            column -= this.session.nonTokenRe.lastIndex;
            leftOfCursor = leftOfCursor.slice(this.session.nonTokenRe.lastIndex);
            this.session.nonTokenRe.lastIndex = 0;
        }
        if (column <= 0) {
            this.moveCursorTo(row, 0);
            this.moveCursorLeft();
            if (row > 0)
                this.moveCursorWordLeft();
            return;
        }
        if (match = this.session.tokenRe.exec(leftOfCursor)) {
            column -= this.session.tokenRe.lastIndex;
            this.session.tokenRe.lastIndex = 0;
        }

        this.moveCursorTo(row, column);
    };

    this.$shortWordEndIndex = function(rightOfCursor) {
        var match, index = 0, ch;
        var whitespaceRe = /\s/;
        var tokenRe = this.session.tokenRe;

        tokenRe.lastIndex = 0;
        if (match = this.session.tokenRe.exec(rightOfCursor)) {
            index = this.session.tokenRe.lastIndex;
        } else {
            while ((ch = rightOfCursor[index]) && whitespaceRe.test(ch))
                index ++;

            if (index < 1) {
                tokenRe.lastIndex = 0;
                 while ((ch = rightOfCursor[index]) && !tokenRe.test(ch)) {
                    tokenRe.lastIndex = 0;
                    index ++;
                    if (whitespaceRe.test(ch)) {
                        if (index > 2) {
                            index--;
                            break;
                        } else {
                            while ((ch = rightOfCursor[index]) && whitespaceRe.test(ch))
                                index ++;
                            if (index > 2)
                                break;
                        }
                    }
                }
            }
        }
        tokenRe.lastIndex = 0;

        return index;
    };

    this.moveCursorShortWordRight = function() {
        var row = this.lead.row;
        var column = this.lead.column;
        var line = this.doc.getLine(row);
        var rightOfCursor = line.substring(column);

        var fold = this.session.getFoldAt(row, column, 1);
        if (fold)
            return this.moveCursorTo(fold.end.row, fold.end.column);

        if (column == line.length) {
            var l = this.doc.getLength();
            do {
                row++;
                rightOfCursor = this.doc.getLine(row);
            } while (row < l && /^\s*$/.test(rightOfCursor));

            if (!/^\s+/.test(rightOfCursor))
                rightOfCursor = "";
            column = 0;
        }

        var index = this.$shortWordEndIndex(rightOfCursor);

        this.moveCursorTo(row, column + index);
    };

    this.moveCursorShortWordLeft = function() {
        var row = this.lead.row;
        var column = this.lead.column;

        var fold;
        if (fold = this.session.getFoldAt(row, column, -1))
            return this.moveCursorTo(fold.start.row, fold.start.column);

        var line = this.session.getLine(row).substring(0, column);
        if (column === 0) {
            do {
                row--;
                line = this.doc.getLine(row);
            } while (row > 0 && /^\s*$/.test(line));

            column = line.length;
            if (!/\s+$/.test(line))
                line = "";
        }

        var leftOfCursor = lang.stringReverse(line);
        var index = this.$shortWordEndIndex(leftOfCursor);

        return this.moveCursorTo(row, column - index);
    };

    this.moveCursorWordRight = function() {
        if (this.session.$selectLongWords)
            this.moveCursorLongWordRight();
        else
            this.moveCursorShortWordRight();
    };

    this.moveCursorWordLeft = function() {
        if (this.session.$selectLongWords)
            this.moveCursorLongWordLeft();
        else
            this.moveCursorShortWordLeft();
    };
    this.moveCursorBy = function(rows, chars) {
        var screenPos = this.session.documentToScreenPosition(
            this.lead.row,
            this.lead.column
        );

        var offsetX;

        if (chars === 0) {
            if (rows !== 0) {
                if (this.session.$bidiHandler.isBidiRow(screenPos.row, this.lead.row)) {
                    offsetX = this.session.$bidiHandler.getPosLeft(screenPos.column);
                    screenPos.column = Math.round(offsetX / this.session.$bidiHandler.charWidths[0]);
                } else {
                    offsetX = screenPos.column * this.session.$bidiHandler.charWidths[0];
                }
            }

            if (this.$desiredColumn)
                screenPos.column = this.$desiredColumn;
            else
                this.$desiredColumn = screenPos.column;
        }

        var docPos = this.session.screenToDocumentPosition(screenPos.row + rows, screenPos.column, offsetX);
        
        if (rows !== 0 && chars === 0 && docPos.row === this.lead.row && docPos.column === this.lead.column) {
            if (this.session.lineWidgets && this.session.lineWidgets[docPos.row]) {
                if (docPos.row > 0 || rows > 0)
                    docPos.row++;
            }
        }
        this.moveCursorTo(docPos.row, docPos.column + chars, chars === 0);
    };
    this.moveCursorToPosition = function(position) {
        this.moveCursorTo(position.row, position.column);
    };
    this.moveCursorTo = function(row, column, keepDesiredColumn) {
        var fold = this.session.getFoldAt(row, column, 1);
        if (fold) {
            row = fold.start.row;
            column = fold.start.column;
        }

        this.$keepDesiredColumnOnChange = true;
        var line = this.session.getLine(row);
        if (/[\uDC00-\uDFFF]/.test(line.charAt(column)) && line.charAt(column - 1)) {
            if (this.lead.row == row && this.lead.column == column + 1)
                column = column - 1;
            else
                column = column + 1;
        }
        this.lead.setPosition(row, column);
        this.$keepDesiredColumnOnChange = false;

        if (!keepDesiredColumn)
            this.$desiredColumn = null;
    };
    this.moveCursorToScreen = function(row, column, keepDesiredColumn) {
        var pos = this.session.screenToDocumentPosition(row, column);
        this.moveCursorTo(pos.row, pos.column, keepDesiredColumn);
    };
    this.detach = function() {
        this.lead.detach();
        this.anchor.detach();
        this.session = this.doc = null;
    };

    this.fromOrientedRange = function(range) {
        this.setSelectionRange(range, range.cursor == range.start);
        this.$desiredColumn = range.desiredColumn || this.$desiredColumn;
    };

    this.toOrientedRange = function(range) {
        var r = this.getRange();
        if (range) {
            range.start.column = r.start.column;
            range.start.row = r.start.row;
            range.end.column = r.end.column;
            range.end.row = r.end.row;
        } else {
            range = r;
        }

        range.cursor = this.isBackwards() ? range.start : range.end;
        range.desiredColumn = this.$desiredColumn;
        return range;
    };
    this.getRangeOfMovements = function(func) {
        var start = this.getCursor();
        try {
            func(this);
            var end = this.getCursor();
            return Range.fromPoints(start,end);
        } catch(e) {
            return Range.fromPoints(start,start);
        } finally {
            this.moveCursorToPosition(start);
        }
    };

    this.toJSON = function() {
        if (this.rangeCount) {
            var data = this.ranges.map(function(r) {
                var r1 = r.clone();
                r1.isBackwards = r.cursor == r.start;
                return r1;
            });
        } else {
            var data = this.getRange();
            data.isBackwards = this.isBackwards();
        }
        return data;
    };

    this.fromJSON = function(data) {
        if (data.start == undefined) {
            if (this.rangeList) {
                this.toSingleRange(data[0]);
                for (var i = data.length; i--; ) {
                    var r = Range.fromPoints(data[i].start, data[i].end);
                    if (data[i].isBackwards)
                        r.cursor = r.start;
                    this.addRange(r, true);
                }
                return;
            } else
                data = data[0];
        }
        if (this.rangeList)
            this.toSingleRange(data);
        this.setSelectionRange(data, data.isBackwards);
    };

    this.isEqual = function(data) {
        if ((data.length || this.rangeCount) && data.length != this.rangeCount)
            return false;
        if (!data.length || !this.ranges)
            return this.getRange().isEqual(data);

        for (var i = this.ranges.length; i--; ) {
            if (!this.ranges[i].isEqual(data[i]))
                return false;
        }
        return true;
    };

}).call(Selection.prototype);

exports.Selection = Selection;
});

ace.define("ace/tokenizer",["require","exports","module","ace/config"], function(require, exports, module) {
"use strict";

var config = require("./config");
var MAX_TOKEN_COUNT = 2000;
var Tokenizer = function(rules) {
    this.states = rules;

    this.regExps = {};
    this.matchMappings = {};
    for (var key in this.states) {
        var state = this.states[key];
        var ruleRegExps = [];
        var matchTotal = 0;
        var mapping = this.matchMappings[key] = {defaultToken: "text"};
        var flag = "g";

        var splitterRurles = [];
        for (var i = 0; i < state.length; i++) {
            var rule = state[i];
            if (rule.defaultToken)
                mapping.defaultToken = rule.defaultToken;
            if (rule.caseInsensitive)
                flag = "gi";
            if (rule.regex == null)
                continue;

            if (rule.regex instanceof RegExp)
                rule.regex = rule.regex.toString().slice(1, -1);
            var adjustedregex = rule.regex;
            var matchcount = new RegExp("(?:(" + adjustedregex + ")|(.))").exec("a").length - 2;
            if (Array.isArray(rule.token)) {
                if (rule.token.length == 1 || matchcount == 1) {
                    rule.token = rule.token[0];
                } else if (matchcount - 1 != rule.token.length) {
                    this.reportError("number of classes and regexp groups doesn't match", { 
                        rule: rule,
                        groupCount: matchcount - 1
                    });
                    rule.token = rule.token[0];
                } else {
                    rule.tokenArray = rule.token;
                    rule.token = null;
                    rule.onMatch = this.$arrayTokens;
                }
            } else if (typeof rule.token == "function" && !rule.onMatch) {
                if (matchcount > 1)
                    rule.onMatch = this.$applyToken;
                else
                    rule.onMatch = rule.token;
            }

            if (matchcount > 1) {
                if (/\\\d/.test(rule.regex)) {
                    adjustedregex = rule.regex.replace(/\\([0-9]+)/g, function(match, digit) {
                        return "\\" + (parseInt(digit, 10) + matchTotal + 1);
                    });
                } else {
                    matchcount = 1;
                    adjustedregex = this.removeCapturingGroups(rule.regex);
                }
                if (!rule.splitRegex && typeof rule.token != "string")
                    splitterRurles.push(rule); // flag will be known only at the very end
            }

            mapping[matchTotal] = i;
            matchTotal += matchcount;

            ruleRegExps.push(adjustedregex);
            if (!rule.onMatch)
                rule.onMatch = null;
        }
        
        if (!ruleRegExps.length) {
            mapping[0] = 0;
            ruleRegExps.push("$");
        }
        
        splitterRurles.forEach(function(rule) {
            rule.splitRegex = this.createSplitterRegexp(rule.regex, flag);
        }, this);

        this.regExps[key] = new RegExp("(" + ruleRegExps.join(")|(") + ")|($)", flag);
    }
};

(function() {
    this.$setMaxTokenCount = function(m) {
        MAX_TOKEN_COUNT = m | 0;
    };
    
    this.$applyToken = function(str) {
        var values = this.splitRegex.exec(str).slice(1);
        var types = this.token.apply(this, values);
        if (typeof types === "string")
            return [{type: types, value: str}];

        var tokens = [];
        for (var i = 0, l = types.length; i < l; i++) {
            if (values[i])
                tokens[tokens.length] = {
                    type: types[i],
                    value: values[i]
                };
        }
        return tokens;
    };

    this.$arrayTokens = function(str) {
        if (!str)
            return [];
        var values = this.splitRegex.exec(str);
        if (!values)
            return "text";
        var tokens = [];
        var types = this.tokenArray;
        for (var i = 0, l = types.length; i < l; i++) {
            if (values[i + 1])
                tokens[tokens.length] = {
                    type: types[i],
                    value: values[i + 1]
                };
        }
        return tokens;
    };

    this.removeCapturingGroups = function(src) {
        var r = src.replace(
            /\[(?:\\.|[^\]])*?\]|\\.|\(\?[:=!]|(\()/g,
            function(x, y) {return y ? "(?:" : x;}
        );
        return r;
    };

    this.createSplitterRegexp = function(src, flag) {
        if (src.indexOf("(?=") != -1) {
            var stack = 0;
            var inChClass = false;
            var lastCapture = {};
            src.replace(/(\\.)|(\((?:\?[=!])?)|(\))|([\[\]])/g, function(
                m, esc, parenOpen, parenClose, square, index
            ) {
                if (inChClass) {
                    inChClass = square != "]";
                } else if (square) {
                    inChClass = true;
                } else if (parenClose) {
                    if (stack == lastCapture.stack) {
                        lastCapture.end = index+1;
                        lastCapture.stack = -1;
                    }
                    stack--;
                } else if (parenOpen) {
                    stack++;
                    if (parenOpen.length != 1) {
                        lastCapture.stack = stack;
                        lastCapture.start = index;
                    }
                }
                return m;
            });

            if (lastCapture.end != null && /^\)*$/.test(src.substr(lastCapture.end)))
                src = src.substring(0, lastCapture.start) + src.substr(lastCapture.end);
        }
        if (src.charAt(0) != "^") src = "^" + src;
        if (src.charAt(src.length - 1) != "$") src += "$";
        
        return new RegExp(src, (flag||"").replace("g", ""));
    };
    this.getLineTokens = function(line, startState) {
        if (startState && typeof startState != "string") {
            var stack = startState.slice(0);
            startState = stack[0];
            if (startState === "#tmp") {
                stack.shift();
                startState = stack.shift();
            }
        } else
            var stack = [];

        var currentState = startState || "start";
        var state = this.states[currentState];
        if (!state) {
            currentState = "start";
            state = this.states[currentState];
        }
        var mapping = this.matchMappings[currentState];
        var re = this.regExps[currentState];
        re.lastIndex = 0;

        var match, tokens = [];
        var lastIndex = 0;
        var matchAttempts = 0;

        var token = {type: null, value: ""};

        while (match = re.exec(line)) {
            var type = mapping.defaultToken;
            var rule = null;
            var value = match[0];
            var index = re.lastIndex;

            if (index - value.length > lastIndex) {
                var skipped = line.substring(lastIndex, index - value.length);
                if (token.type == type) {
                    token.value += skipped;
                } else {
                    if (token.type)
                        tokens.push(token);
                    token = {type: type, value: skipped};
                }
            }

            for (var i = 0; i < match.length-2; i++) {
                if (match[i + 1] === undefined)
                    continue;

                rule = state[mapping[i]];

                if (rule.onMatch)
                    type = rule.onMatch(value, currentState, stack, line);
                else
                    type = rule.token;

                if (rule.next) {
                    if (typeof rule.next == "string") {
                        currentState = rule.next;
                    } else {
                        currentState = rule.next(currentState, stack);
                    }
                    
                    state = this.states[currentState];
                    if (!state) {
                        this.reportError("state doesn't exist", currentState);
                        currentState = "start";
                        state = this.states[currentState];
                    }
                    mapping = this.matchMappings[currentState];
                    lastIndex = index;
                    re = this.regExps[currentState];
                    re.lastIndex = index;
                }
                if (rule.consumeLineEnd)
                    lastIndex = index;
                break;
            }

            if (value) {
                if (typeof type === "string") {
                    if ((!rule || rule.merge !== false) && token.type === type) {
                        token.value += value;
                    } else {
                        if (token.type)
                            tokens.push(token);
                        token = {type: type, value: value};
                    }
                } else if (type) {
                    if (token.type)
                        tokens.push(token);
                    token = {type: null, value: ""};
                    for (var i = 0; i < type.length; i++)
                        tokens.push(type[i]);
                }
            }

            if (lastIndex == line.length)
                break;

            lastIndex = index;

            if (matchAttempts++ > MAX_TOKEN_COUNT) {
                if (matchAttempts > 2 * line.length) {
                    this.reportError("infinite loop with in ace tokenizer", {
                        startState: startState,
                        line: line
                    });
                }
                while (lastIndex < line.length) {
                    if (token.type)
                        tokens.push(token);
                    token = {
                        value: line.substring(lastIndex, lastIndex += 2000),
                        type: "overflow"
                    };
                }
                currentState = "start";
                stack = [];
                break;
            }
        }

        if (token.type)
            tokens.push(token);
        
        if (stack.length > 1) {
            if (stack[0] !== currentState)
                stack.unshift("#tmp", currentState);
        }
        return {
            tokens : tokens,
            state : stack.length ? stack : currentState
        };
    };
    
    this.reportError = config.reportError;
    
}).call(Tokenizer.prototype);

exports.Tokenizer = Tokenizer;
});

ace.define("ace/mode/text_highlight_rules",["require","exports","module","ace/lib/lang"], function(require, exports, module) {
"use strict";

var lang = require("../lib/lang");

var TextHighlightRules = function() {

    this.$rules = {
        "start" : [{
            token : "empty_line",
            regex : '^$'
        }, {
            defaultToken : "text"
        }]
    };
};

(function() {

    this.addRules = function(rules, prefix) {
        if (!prefix) {
            for (var key in rules)
                this.$rules[key] = rules[key];
            return;
        }
        for (var key in rules) {
            var state = rules[key];
            for (var i = 0; i < state.length; i++) {
                var rule = state[i];
                if (rule.next || rule.onMatch) {
                    if (typeof rule.next == "string") {
                        if (rule.next.indexOf(prefix) !== 0)
                            rule.next = prefix + rule.next;
                    }
                    if (rule.nextState && rule.nextState.indexOf(prefix) !== 0)
                        rule.nextState = prefix + rule.nextState;
                }
            }
            this.$rules[prefix + key] = state;
        }
    };

    this.getRules = function() {
        return this.$rules;
    };

    this.embedRules = function (HighlightRules, prefix, escapeRules, states, append) {
        var embedRules = typeof HighlightRules == "function"
            ? new HighlightRules().getRules()
            : HighlightRules;
        if (states) {
            for (var i = 0; i < states.length; i++)
                states[i] = prefix + states[i];
        } else {
            states = [];
            for (var key in embedRules)
                states.push(prefix + key);
        }

        this.addRules(embedRules, prefix);

        if (escapeRules) {
            var addRules = Array.prototype[append ? "push" : "unshift"];
            for (var i = 0; i < states.length; i++)
                addRules.apply(this.$rules[states[i]], lang.deepCopy(escapeRules));
        }

        if (!this.$embeds)
            this.$embeds = [];
        this.$embeds.push(prefix);
    };

    this.getEmbeds = function() {
        return this.$embeds;
    };

    var pushState = function(currentState, stack) {
        if (currentState != "start" || stack.length)
            stack.unshift(this.nextState, currentState);
        return this.nextState;
    };
    var popState = function(currentState, stack) {
        stack.shift();
        return stack.shift() || "start";
    };

    this.normalizeRules = function() {
        var id = 0;
        var rules = this.$rules;
        function processState(key) {
            var state = rules[key];
            state.processed = true;
            for (var i = 0; i < state.length; i++) {
                var rule = state[i];
                var toInsert = null;
                if (Array.isArray(rule)) {
                    toInsert = rule;
                    rule = {};
                }
                if (!rule.regex && rule.start) {
                    rule.regex = rule.start;
                    if (!rule.next)
                        rule.next = [];
                    rule.next.push({
                        defaultToken: rule.token
                    }, {
                        token: rule.token + ".end",
                        regex: rule.end || rule.start,
                        next: "pop"
                    });
                    rule.token = rule.token + ".start";
                    rule.push = true;
                }
                var next = rule.next || rule.push;
                if (next && Array.isArray(next)) {
                    var stateName = rule.stateName;
                    if (!stateName)  {
                        stateName = rule.token;
                        if (typeof stateName != "string")
                            stateName = stateName[0] || "";
                        if (rules[stateName])
                            stateName += id++;
                    }
                    rules[stateName] = next;
                    rule.next = stateName;
                    processState(stateName);
                } else if (next == "pop") {
                    rule.next = popState;
                }

                if (rule.push) {
                    rule.nextState = rule.next || rule.push;
                    rule.next = pushState;
                    delete rule.push;
                }

                if (rule.rules) {
                    for (var r in rule.rules) {
                        if (rules[r]) {
                            if (rules[r].push)
                                rules[r].push.apply(rules[r], rule.rules[r]);
                        } else {
                            rules[r] = rule.rules[r];
                        }
                    }
                }
                var includeName = typeof rule == "string" ? rule : rule.include;
                if (includeName) {
                    if (Array.isArray(includeName))
                        toInsert = includeName.map(function(x) { return rules[x]; });
                    else
                        toInsert = rules[includeName];
                }

                if (toInsert) {
                    var args = [i, 1].concat(toInsert);
                    if (rule.noEscape)
                        args = args.filter(function(x) {return !x.next;});
                    state.splice.apply(state, args);
                    i--;
                }
                
                if (rule.keywordMap) {
                    rule.token = this.createKeywordMapper(
                        rule.keywordMap, rule.defaultToken || "text", rule.caseInsensitive
                    );
                    delete rule.defaultToken;
                }
            }
        }
        Object.keys(rules).forEach(processState, this);
    };

    this.createKeywordMapper = function(map, defaultToken, ignoreCase, splitChar) {
        var keywords = Object.create(null);
        Object.keys(map).forEach(function(className) {
            var a = map[className];
            if (ignoreCase)
                a = a.toLowerCase();
            var list = a.split(splitChar || "|");
            for (var i = list.length; i--; )
                keywords[list[i]] = className;
        });
        if (Object.getPrototypeOf(keywords)) {
            keywords.__proto__ = null;
        }
        this.$keywordList = Object.keys(keywords);
        map = null;
        return ignoreCase
            ? function(value) {return keywords[value.toLowerCase()] || defaultToken; }
            : function(value) {return keywords[value] || defaultToken; };
    };

    this.getKeywords = function() {
        return this.$keywords;
    };

}).call(TextHighlightRules.prototype);

exports.TextHighlightRules = TextHighlightRules;
});

ace.define("ace/mode/behaviour",["require","exports","module"], function(require, exports, module) {
"use strict";

var Behaviour = function() {
   this.$behaviours = {};
};

(function () {

    this.add = function (name, action, callback) {
        switch (undefined) {
          case this.$behaviours:
              this.$behaviours = {};
          case this.$behaviours[name]:
              this.$behaviours[name] = {};
        }
        this.$behaviours[name][action] = callback;
    };
    
    this.addBehaviours = function (behaviours) {
        for (var key in behaviours) {
            for (var action in behaviours[key]) {
                this.add(key, action, behaviours[key][action]);
            }
        }
    };
    
    this.remove = function (name) {
        if (this.$behaviours && this.$behaviours[name]) {
            delete this.$behaviours[name];
        }
    };
    
    this.inherit = function (mode, filter) {
        if (typeof mode === "function") {
            var behaviours = new mode().getBehaviours(filter);
        } else {
            var behaviours = mode.getBehaviours(filter);
        }
        this.addBehaviours(behaviours);
    };
    
    this.getBehaviours = function (filter) {
        if (!filter) {
            return this.$behaviours;
        } else {
            var ret = {};
            for (var i = 0; i < filter.length; i++) {
                if (this.$behaviours[filter[i]]) {
                    ret[filter[i]] = this.$behaviours[filter[i]];
                }
            }
            return ret;
        }
    };

}).call(Behaviour.prototype);

exports.Behaviour = Behaviour;
});

ace.define("ace/token_iterator",["require","exports","module","ace/range"], function(require, exports, module) {
"use strict";

var Range = require("./range").Range;
var TokenIterator = function(session, initialRow, initialColumn) {
    this.$session = session;
    this.$row = initialRow;
    this.$rowTokens = session.getTokens(initialRow);

    var token = session.getTokenAt(initialRow, initialColumn);
    this.$tokenIndex = token ? token.index : -1;
};

(function() { 
    this.stepBackward = function() {
        this.$tokenIndex -= 1;
        
        while (this.$tokenIndex < 0) {
            this.$row -= 1;
            if (this.$row < 0) {
                this.$row = 0;
                return null;
            }
                
            this.$rowTokens = this.$session.getTokens(this.$row);
            this.$tokenIndex = this.$rowTokens.length - 1;
        }
            
        return this.$rowTokens[this.$tokenIndex];
    };   
    this.stepForward = function() {
        this.$tokenIndex += 1;
        var rowCount;
        while (this.$tokenIndex >= this.$rowTokens.length) {
            this.$row += 1;
            if (!rowCount)
                rowCount = this.$session.getLength();
            if (this.$row >= rowCount) {
                this.$row = rowCount - 1;
                return null;
            }

            this.$rowTokens = this.$session.getTokens(this.$row);
            this.$tokenIndex = 0;
        }
            
        return this.$rowTokens[this.$tokenIndex];
    };      
    this.getCurrentToken = function () {
        return this.$rowTokens[this.$tokenIndex];
    };      
    this.getCurrentTokenRow = function () {
        return this.$row;
    };     
    this.getCurrentTokenColumn = function() {
        var rowTokens = this.$rowTokens;
        var tokenIndex = this.$tokenIndex;
        var column = rowTokens[tokenIndex].start;
        if (column !== undefined)
            return column;
            
        column = 0;
        while (tokenIndex > 0) {
            tokenIndex -= 1;
            column += rowTokens[tokenIndex].value.length;
        }
        
        return column;  
    };
    this.getCurrentTokenPosition = function() {
        return {row: this.$row, column: this.getCurrentTokenColumn()};
    };
    this.getCurrentTokenRange = function() {
        var token = this.$rowTokens[this.$tokenIndex];
        var column = this.getCurrentTokenColumn();
        return new Range(this.$row, column, this.$row, column + token.value.length);
    };
    
}).call(TokenIterator.prototype);

exports.TokenIterator = TokenIterator;
});

ace.define("ace/mode/behaviour/cstyle",["require","exports","module","ace/lib/oop","ace/mode/behaviour","ace/token_iterator","ace/lib/lang"], function(require, exports, module) {
"use strict";

var oop = require("../../lib/oop");
var Behaviour = require("../behaviour").Behaviour;
var TokenIterator = require("../../token_iterator").TokenIterator;
var lang = require("../../lib/lang");

var SAFE_INSERT_IN_TOKENS =
    ["text", "paren.rparen", "punctuation.operator"];
var SAFE_INSERT_BEFORE_TOKENS =
    ["text", "paren.rparen", "punctuation.operator", "comment"];

var context;
var contextCache = {};
var defaultQuotes = {'"' : '"', "'" : "'"};

var initContext = function(editor) {
    var id = -1;
    if (editor.multiSelect) {
        id = editor.selection.index;
        if (contextCache.rangeCount != editor.multiSelect.rangeCount)
            contextCache = {rangeCount: editor.multiSelect.rangeCount};
    }
    if (contextCache[id])
        return context = contextCache[id];
    context = contextCache[id] = {
        autoInsertedBrackets: 0,
        autoInsertedRow: -1,
        autoInsertedLineEnd: "",
        maybeInsertedBrackets: 0,
        maybeInsertedRow: -1,
        maybeInsertedLineStart: "",
        maybeInsertedLineEnd: ""
    };
};

var getWrapped = function(selection, selected, opening, closing) {
    var rowDiff = selection.end.row - selection.start.row;
    return {
        text: opening + selected + closing,
        selection: [
                0,
                selection.start.column + 1,
                rowDiff,
                selection.end.column + (rowDiff ? 0 : 1)
            ]
    };
};

var CstyleBehaviour = function(options) {
    this.add("braces", "insertion", function(state, action, editor, session, text) {
        var cursor = editor.getCursorPosition();
        var line = session.doc.getLine(cursor.row);
        if (text == '{') {
            initContext(editor);
            var selection = editor.getSelectionRange();
            var selected = session.doc.getTextRange(selection);
            if (selected !== "" && selected !== "{" && editor.getWrapBehavioursEnabled()) {
                return getWrapped(selection, selected, '{', '}');
            } else if (CstyleBehaviour.isSaneInsertion(editor, session)) {
                if (/[\]\}\)]/.test(line[cursor.column]) || editor.inMultiSelectMode || options && options.braces) {
                    CstyleBehaviour.recordAutoInsert(editor, session, "}");
                    return {
                        text: '{}',
                        selection: [1, 1]
                    };
                } else {
                    CstyleBehaviour.recordMaybeInsert(editor, session, "{");
                    return {
                        text: '{',
                        selection: [1, 1]
                    };
                }
            }
        } else if (text == '}') {
            initContext(editor);
            var rightChar = line.substring(cursor.column, cursor.column + 1);
            if (rightChar == '}') {
                var matching = session.$findOpeningBracket('}', {column: cursor.column + 1, row: cursor.row});
                if (matching !== null && CstyleBehaviour.isAutoInsertedClosing(cursor, line, text)) {
                    CstyleBehaviour.popAutoInsertedClosing();
                    return {
                        text: '',
                        selection: [1, 1]
                    };
                }
            }
        } else if (text == "\n" || text == "\r\n") {
            initContext(editor);
            var closing = "";
            if (CstyleBehaviour.isMaybeInsertedClosing(cursor, line)) {
                closing = lang.stringRepeat("}", context.maybeInsertedBrackets);
                CstyleBehaviour.clearMaybeInsertedClosing();
            }
            var rightChar = line.substring(cursor.column, cursor.column + 1);
            if (rightChar === '}') {
                var openBracePos = session.findMatchingBracket({row: cursor.row, column: cursor.column+1}, '}');
                if (!openBracePos)
                     return null;
                var next_indent = this.$getIndent(session.getLine(openBracePos.row));
            } else if (closing) {
                var next_indent = this.$getIndent(line);
            } else {
                CstyleBehaviour.clearMaybeInsertedClosing();
                return;
            }
            var indent = next_indent + session.getTabString();

            return {
                text: '\n' + indent + '\n' + next_indent + closing,
                selection: [1, indent.length, 1, indent.length]
            };
        } else {
            CstyleBehaviour.clearMaybeInsertedClosing();
        }
    });

    this.add("braces", "deletion", function(state, action, editor, session, range) {
        var selected = session.doc.getTextRange(range);
        if (!range.isMultiLine() && selected == '{') {
            initContext(editor);
            var line = session.doc.getLine(range.start.row);
            var rightChar = line.substring(range.end.column, range.end.column + 1);
            if (rightChar == '}') {
                range.end.column++;
                return range;
            } else {
                context.maybeInsertedBrackets--;
            }
        }
    });

    this.add("parens", "insertion", function(state, action, editor, session, text) {
        if (text == '(') {
            initContext(editor);
            var selection = editor.getSelectionRange();
            var selected = session.doc.getTextRange(selection);
            if (selected !== "" && editor.getWrapBehavioursEnabled()) {
                return getWrapped(selection, selected, '(', ')');
            } else if (CstyleBehaviour.isSaneInsertion(editor, session)) {
                CstyleBehaviour.recordAutoInsert(editor, session, ")");
                return {
                    text: '()',
                    selection: [1, 1]
                };
            }
        } else if (text == ')') {
            initContext(editor);
            var cursor = editor.getCursorPosition();
            var line = session.doc.getLine(cursor.row);
            var rightChar = line.substring(cursor.column, cursor.column + 1);
            if (rightChar == ')') {
                var matching = session.$findOpeningBracket(')', {column: cursor.column + 1, row: cursor.row});
                if (matching !== null && CstyleBehaviour.isAutoInsertedClosing(cursor, line, text)) {
                    CstyleBehaviour.popAutoInsertedClosing();
                    return {
                        text: '',
                        selection: [1, 1]
                    };
                }
            }
        }
    });

    this.add("parens", "deletion", function(state, action, editor, session, range) {
        var selected = session.doc.getTextRange(range);
        if (!range.isMultiLine() && selected == '(') {
            initContext(editor);
            var line = session.doc.getLine(range.start.row);
            var rightChar = line.substring(range.start.column + 1, range.start.column + 2);
            if (rightChar == ')') {
                range.end.column++;
                return range;
            }
        }
    });

    this.add("brackets", "insertion", function(state, action, editor, session, text) {
        if (text == '[') {
            initContext(editor);
            var selection = editor.getSelectionRange();
            var selected = session.doc.getTextRange(selection);
            if (selected !== "" && editor.getWrapBehavioursEnabled()) {
                return getWrapped(selection, selected, '[', ']');
            } else if (CstyleBehaviour.isSaneInsertion(editor, session)) {
                CstyleBehaviour.recordAutoInsert(editor, session, "]");
                return {
                    text: '[]',
                    selection: [1, 1]
                };
            }
        } else if (text == ']') {
            initContext(editor);
            var cursor = editor.getCursorPosition();
            var line = session.doc.getLine(cursor.row);
            var rightChar = line.substring(cursor.column, cursor.column + 1);
            if (rightChar == ']') {
                var matching = session.$findOpeningBracket(']', {column: cursor.column + 1, row: cursor.row});
                if (matching !== null && CstyleBehaviour.isAutoInsertedClosing(cursor, line, text)) {
                    CstyleBehaviour.popAutoInsertedClosing();
                    return {
                        text: '',
                        selection: [1, 1]
                    };
                }
            }
        }
    });

    this.add("brackets", "deletion", function(state, action, editor, session, range) {
        var selected = session.doc.getTextRange(range);
        if (!range.isMultiLine() && selected == '[') {
            initContext(editor);
            var line = session.doc.getLine(range.start.row);
            var rightChar = line.substring(range.start.column + 1, range.start.column + 2);
            if (rightChar == ']') {
                range.end.column++;
                return range;
            }
        }
    });

    this.add("string_dquotes", "insertion", function(state, action, editor, session, text) {
        var quotes = session.$mode.$quotes || defaultQuotes;
        if (text.length == 1 && quotes[text]) {
            if (this.lineCommentStart && this.lineCommentStart.indexOf(text) != -1) 
                return;
            initContext(editor);
            var quote = text;
            var selection = editor.getSelectionRange();
            var selected = session.doc.getTextRange(selection);
            if (selected !== "" && (selected.length != 1 || !quotes[selected]) && editor.getWrapBehavioursEnabled()) {
                return getWrapped(selection, selected, quote, quote);
            } else if (!selected) {
                var cursor = editor.getCursorPosition();
                var line = session.doc.getLine(cursor.row);
                var leftChar = line.substring(cursor.column-1, cursor.column);
                var rightChar = line.substring(cursor.column, cursor.column + 1);
                
                var token = session.getTokenAt(cursor.row, cursor.column);
                var rightToken = session.getTokenAt(cursor.row, cursor.column + 1);
                if (leftChar == "\\" && token && /escape/.test(token.type))
                    return null;
                
                var stringBefore = token && /string|escape/.test(token.type);
                var stringAfter = !rightToken || /string|escape/.test(rightToken.type);
                
                var pair;
                if (rightChar == quote) {
                    pair = stringBefore !== stringAfter;
                    if (pair && /string\.end/.test(rightToken.type))
                        pair = false;
                } else {
                    if (stringBefore && !stringAfter)
                        return null; // wrap string with different quote
                    if (stringBefore && stringAfter)
                        return null; // do not pair quotes inside strings
                    var wordRe = session.$mode.tokenRe;
                    wordRe.lastIndex = 0;
                    var isWordBefore = wordRe.test(leftChar);
                    wordRe.lastIndex = 0;
                    var isWordAfter = wordRe.test(leftChar);
                    if (isWordBefore || isWordAfter)
                        return null; // before or after alphanumeric
                    if (rightChar && !/[\s;,.})\]\\]/.test(rightChar))
                        return null; // there is rightChar and it isn't closing
                    pair = true;
                }
                return {
                    text: pair ? quote + quote : "",
                    selection: [1,1]
                };
            }
        }
    });

    this.add("string_dquotes", "deletion", function(state, action, editor, session, range) {
        var selected = session.doc.getTextRange(range);
        if (!range.isMultiLine() && (selected == '"' || selected == "'")) {
            initContext(editor);
            var line = session.doc.getLine(range.start.row);
            var rightChar = line.substring(range.start.column + 1, range.start.column + 2);
            if (rightChar == selected) {
                range.end.column++;
                return range;
            }
        }
    });

};

    
CstyleBehaviour.isSaneInsertion = function(editor, session) {
    var cursor = editor.getCursorPosition();
    var iterator = new TokenIterator(session, cursor.row, cursor.column);
    if (!this.$matchTokenType(iterator.getCurrentToken() || "text", SAFE_INSERT_IN_TOKENS)) {
        var iterator2 = new TokenIterator(session, cursor.row, cursor.column + 1);
        if (!this.$matchTokenType(iterator2.getCurrentToken() || "text", SAFE_INSERT_IN_TOKENS))
            return false;
    }
    iterator.stepForward();
    return iterator.getCurrentTokenRow() !== cursor.row ||
        this.$matchTokenType(iterator.getCurrentToken() || "text", SAFE_INSERT_BEFORE_TOKENS);
};

CstyleBehaviour.$matchTokenType = function(token, types) {
    return types.indexOf(token.type || token) > -1;
};

CstyleBehaviour.recordAutoInsert = function(editor, session, bracket) {
    var cursor = editor.getCursorPosition();
    var line = session.doc.getLine(cursor.row);
    if (!this.isAutoInsertedClosing(cursor, line, context.autoInsertedLineEnd[0]))
        context.autoInsertedBrackets = 0;
    context.autoInsertedRow = cursor.row;
    context.autoInsertedLineEnd = bracket + line.substr(cursor.column);
    context.autoInsertedBrackets++;
};

CstyleBehaviour.recordMaybeInsert = function(editor, session, bracket) {
    var cursor = editor.getCursorPosition();
    var line = session.doc.getLine(cursor.row);
    if (!this.isMaybeInsertedClosing(cursor, line))
        context.maybeInsertedBrackets = 0;
    context.maybeInsertedRow = cursor.row;
    context.maybeInsertedLineStart = line.substr(0, cursor.column) + bracket;
    context.maybeInsertedLineEnd = line.substr(cursor.column);
    context.maybeInsertedBrackets++;
};

CstyleBehaviour.isAutoInsertedClosing = function(cursor, line, bracket) {
    return context.autoInsertedBrackets > 0 &&
        cursor.row === context.autoInsertedRow &&
        bracket === context.autoInsertedLineEnd[0] &&
        line.substr(cursor.column) === context.autoInsertedLineEnd;
};

CstyleBehaviour.isMaybeInsertedClosing = function(cursor, line) {
    return context.maybeInsertedBrackets > 0 &&
        cursor.row === context.maybeInsertedRow &&
        line.substr(cursor.column) === context.maybeInsertedLineEnd &&
        line.substr(0, cursor.column) == context.maybeInsertedLineStart;
};

CstyleBehaviour.popAutoInsertedClosing = function() {
    context.autoInsertedLineEnd = context.autoInsertedLineEnd.substr(1);
    context.autoInsertedBrackets--;
};

CstyleBehaviour.clearMaybeInsertedClosing = function() {
    if (context) {
        context.maybeInsertedBrackets = 0;
        context.maybeInsertedRow = -1;
    }
};



oop.inherits(CstyleBehaviour, Behaviour);

exports.CstyleBehaviour = CstyleBehaviour;
});

ace.define("ace/unicode",["require","exports","module"], function(require, exports, module) {
"use strict";
exports.packages = {};

addUnicodePackage({
    L:  "0041-005A0061-007A00AA00B500BA00C0-00D600D8-00F600F8-02C102C6-02D102E0-02E402EC02EE0370-037403760377037A-037D03860388-038A038C038E-03A103A3-03F503F7-0481048A-05250531-055605590561-058705D0-05EA05F0-05F20621-064A066E066F0671-06D306D506E506E606EE06EF06FA-06FC06FF07100712-072F074D-07A507B107CA-07EA07F407F507FA0800-0815081A082408280904-0939093D09500958-0961097109720979-097F0985-098C098F09900993-09A809AA-09B009B209B6-09B909BD09CE09DC09DD09DF-09E109F009F10A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A59-0A5C0A5E0A72-0A740A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABD0AD00AE00AE10B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3D0B5C0B5D0B5F-0B610B710B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BD00C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D0C580C590C600C610C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBD0CDE0CE00CE10D05-0D0C0D0E-0D100D12-0D280D2A-0D390D3D0D600D610D7A-0D7F0D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60E01-0E300E320E330E40-0E460E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB00EB20EB30EBD0EC0-0EC40EC60EDC0EDD0F000F40-0F470F49-0F6C0F88-0F8B1000-102A103F1050-1055105A-105D106110651066106E-10701075-1081108E10A0-10C510D0-10FA10FC1100-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A1380-138F13A0-13F41401-166C166F-167F1681-169A16A0-16EA1700-170C170E-17111720-17311740-17511760-176C176E-17701780-17B317D717DC1820-18771880-18A818AA18B0-18F51900-191C1950-196D1970-19741980-19AB19C1-19C71A00-1A161A20-1A541AA71B05-1B331B45-1B4B1B83-1BA01BAE1BAF1C00-1C231C4D-1C4F1C5A-1C7D1CE9-1CEC1CEE-1CF11D00-1DBF1E00-1F151F18-1F1D1F20-1F451F48-1F4D1F50-1F571F591F5B1F5D1F5F-1F7D1F80-1FB41FB6-1FBC1FBE1FC2-1FC41FC6-1FCC1FD0-1FD31FD6-1FDB1FE0-1FEC1FF2-1FF41FF6-1FFC2071207F2090-209421022107210A-211321152119-211D212421262128212A-212D212F-2139213C-213F2145-2149214E218321842C00-2C2E2C30-2C5E2C60-2CE42CEB-2CEE2D00-2D252D30-2D652D6F2D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE2E2F300530063031-3035303B303C3041-3096309D-309F30A1-30FA30FC-30FF3105-312D3131-318E31A0-31B731F0-31FF3400-4DB54E00-9FCBA000-A48CA4D0-A4FDA500-A60CA610-A61FA62AA62BA640-A65FA662-A66EA67F-A697A6A0-A6E5A717-A71FA722-A788A78BA78CA7FB-A801A803-A805A807-A80AA80C-A822A840-A873A882-A8B3A8F2-A8F7A8FBA90A-A925A930-A946A960-A97CA984-A9B2A9CFAA00-AA28AA40-AA42AA44-AA4BAA60-AA76AA7AAA80-AAAFAAB1AAB5AAB6AAB9-AABDAAC0AAC2AADB-AADDABC0-ABE2AC00-D7A3D7B0-D7C6D7CB-D7FBF900-FA2DFA30-FA6DFA70-FAD9FB00-FB06FB13-FB17FB1DFB1F-FB28FB2A-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBB1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFBFE70-FE74FE76-FEFCFF21-FF3AFF41-FF5AFF66-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC",
    Ll: "0061-007A00AA00B500BA00DF-00F600F8-00FF01010103010501070109010B010D010F01110113011501170119011B011D011F01210123012501270129012B012D012F01310133013501370138013A013C013E014001420144014601480149014B014D014F01510153015501570159015B015D015F01610163016501670169016B016D016F0171017301750177017A017C017E-0180018301850188018C018D019201950199-019B019E01A101A301A501A801AA01AB01AD01B001B401B601B901BA01BD-01BF01C601C901CC01CE01D001D201D401D601D801DA01DC01DD01DF01E101E301E501E701E901EB01ED01EF01F001F301F501F901FB01FD01FF02010203020502070209020B020D020F02110213021502170219021B021D021F02210223022502270229022B022D022F02310233-0239023C023F0240024202470249024B024D024F-02930295-02AF037103730377037B-037D039003AC-03CE03D003D103D5-03D703D903DB03DD03DF03E103E303E503E703E903EB03ED03EF-03F303F503F803FB03FC0430-045F04610463046504670469046B046D046F04710473047504770479047B047D047F0481048B048D048F04910493049504970499049B049D049F04A104A304A504A704A904AB04AD04AF04B104B304B504B704B904BB04BD04BF04C204C404C604C804CA04CC04CE04CF04D104D304D504D704D904DB04DD04DF04E104E304E504E704E904EB04ED04EF04F104F304F504F704F904FB04FD04FF05010503050505070509050B050D050F05110513051505170519051B051D051F0521052305250561-05871D00-1D2B1D62-1D771D79-1D9A1E011E031E051E071E091E0B1E0D1E0F1E111E131E151E171E191E1B1E1D1E1F1E211E231E251E271E291E2B1E2D1E2F1E311E331E351E371E391E3B1E3D1E3F1E411E431E451E471E491E4B1E4D1E4F1E511E531E551E571E591E5B1E5D1E5F1E611E631E651E671E691E6B1E6D1E6F1E711E731E751E771E791E7B1E7D1E7F1E811E831E851E871E891E8B1E8D1E8F1E911E931E95-1E9D1E9F1EA11EA31EA51EA71EA91EAB1EAD1EAF1EB11EB31EB51EB71EB91EBB1EBD1EBF1EC11EC31EC51EC71EC91ECB1ECD1ECF1ED11ED31ED51ED71ED91EDB1EDD1EDF1EE11EE31EE51EE71EE91EEB1EED1EEF1EF11EF31EF51EF71EF91EFB1EFD1EFF-1F071F10-1F151F20-1F271F30-1F371F40-1F451F50-1F571F60-1F671F70-1F7D1F80-1F871F90-1F971FA0-1FA71FB0-1FB41FB61FB71FBE1FC2-1FC41FC61FC71FD0-1FD31FD61FD71FE0-1FE71FF2-1FF41FF61FF7210A210E210F2113212F21342139213C213D2146-2149214E21842C30-2C5E2C612C652C662C682C6A2C6C2C712C732C742C76-2C7C2C812C832C852C872C892C8B2C8D2C8F2C912C932C952C972C992C9B2C9D2C9F2CA12CA32CA52CA72CA92CAB2CAD2CAF2CB12CB32CB52CB72CB92CBB2CBD2CBF2CC12CC32CC52CC72CC92CCB2CCD2CCF2CD12CD32CD52CD72CD92CDB2CDD2CDF2CE12CE32CE42CEC2CEE2D00-2D25A641A643A645A647A649A64BA64DA64FA651A653A655A657A659A65BA65DA65FA663A665A667A669A66BA66DA681A683A685A687A689A68BA68DA68FA691A693A695A697A723A725A727A729A72BA72DA72F-A731A733A735A737A739A73BA73DA73FA741A743A745A747A749A74BA74DA74FA751A753A755A757A759A75BA75DA75FA761A763A765A767A769A76BA76DA76FA771-A778A77AA77CA77FA781A783A785A787A78CFB00-FB06FB13-FB17FF41-FF5A",
    Lu: "0041-005A00C0-00D600D8-00DE01000102010401060108010A010C010E01100112011401160118011A011C011E01200122012401260128012A012C012E01300132013401360139013B013D013F0141014301450147014A014C014E01500152015401560158015A015C015E01600162016401660168016A016C016E017001720174017601780179017B017D018101820184018601870189-018B018E-0191019301940196-0198019C019D019F01A001A201A401A601A701A901AC01AE01AF01B1-01B301B501B701B801BC01C401C701CA01CD01CF01D101D301D501D701D901DB01DE01E001E201E401E601E801EA01EC01EE01F101F401F6-01F801FA01FC01FE02000202020402060208020A020C020E02100212021402160218021A021C021E02200222022402260228022A022C022E02300232023A023B023D023E02410243-02460248024A024C024E03700372037603860388-038A038C038E038F0391-03A103A3-03AB03CF03D2-03D403D803DA03DC03DE03E003E203E403E603E803EA03EC03EE03F403F703F903FA03FD-042F04600462046404660468046A046C046E04700472047404760478047A047C047E0480048A048C048E04900492049404960498049A049C049E04A004A204A404A604A804AA04AC04AE04B004B204B404B604B804BA04BC04BE04C004C104C304C504C704C904CB04CD04D004D204D404D604D804DA04DC04DE04E004E204E404E604E804EA04EC04EE04F004F204F404F604F804FA04FC04FE05000502050405060508050A050C050E05100512051405160518051A051C051E0520052205240531-055610A0-10C51E001E021E041E061E081E0A1E0C1E0E1E101E121E141E161E181E1A1E1C1E1E1E201E221E241E261E281E2A1E2C1E2E1E301E321E341E361E381E3A1E3C1E3E1E401E421E441E461E481E4A1E4C1E4E1E501E521E541E561E581E5A1E5C1E5E1E601E621E641E661E681E6A1E6C1E6E1E701E721E741E761E781E7A1E7C1E7E1E801E821E841E861E881E8A1E8C1E8E1E901E921E941E9E1EA01EA21EA41EA61EA81EAA1EAC1EAE1EB01EB21EB41EB61EB81EBA1EBC1EBE1EC01EC21EC41EC61EC81ECA1ECC1ECE1ED01ED21ED41ED61ED81EDA1EDC1EDE1EE01EE21EE41EE61EE81EEA1EEC1EEE1EF01EF21EF41EF61EF81EFA1EFC1EFE1F08-1F0F1F18-1F1D1F28-1F2F1F38-1F3F1F48-1F4D1F591F5B1F5D1F5F1F68-1F6F1FB8-1FBB1FC8-1FCB1FD8-1FDB1FE8-1FEC1FF8-1FFB21022107210B-210D2110-211221152119-211D212421262128212A-212D2130-2133213E213F214521832C00-2C2E2C602C62-2C642C672C692C6B2C6D-2C702C722C752C7E-2C802C822C842C862C882C8A2C8C2C8E2C902C922C942C962C982C9A2C9C2C9E2CA02CA22CA42CA62CA82CAA2CAC2CAE2CB02CB22CB42CB62CB82CBA2CBC2CBE2CC02CC22CC42CC62CC82CCA2CCC2CCE2CD02CD22CD42CD62CD82CDA2CDC2CDE2CE02CE22CEB2CEDA640A642A644A646A648A64AA64CA64EA650A652A654A656A658A65AA65CA65EA662A664A666A668A66AA66CA680A682A684A686A688A68AA68CA68EA690A692A694A696A722A724A726A728A72AA72CA72EA732A734A736A738A73AA73CA73EA740A742A744A746A748A74AA74CA74EA750A752A754A756A758A75AA75CA75EA760A762A764A766A768A76AA76CA76EA779A77BA77DA77EA780A782A784A786A78BFF21-FF3A",
    Lt: "01C501C801CB01F21F88-1F8F1F98-1F9F1FA8-1FAF1FBC1FCC1FFC",
    Lm: "02B0-02C102C6-02D102E0-02E402EC02EE0374037A0559064006E506E607F407F507FA081A0824082809710E460EC610FC17D718431AA71C78-1C7D1D2C-1D611D781D9B-1DBF2071207F2090-20942C7D2D6F2E2F30053031-3035303B309D309E30FC-30FEA015A4F8-A4FDA60CA67FA717-A71FA770A788A9CFAA70AADDFF70FF9EFF9F",
    Lo: "01BB01C0-01C3029405D0-05EA05F0-05F20621-063F0641-064A066E066F0671-06D306D506EE06EF06FA-06FC06FF07100712-072F074D-07A507B107CA-07EA0800-08150904-0939093D09500958-096109720979-097F0985-098C098F09900993-09A809AA-09B009B209B6-09B909BD09CE09DC09DD09DF-09E109F009F10A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A59-0A5C0A5E0A72-0A740A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABD0AD00AE00AE10B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3D0B5C0B5D0B5F-0B610B710B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BD00C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D0C580C590C600C610C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBD0CDE0CE00CE10D05-0D0C0D0E-0D100D12-0D280D2A-0D390D3D0D600D610D7A-0D7F0D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60E01-0E300E320E330E40-0E450E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB00EB20EB30EBD0EC0-0EC40EDC0EDD0F000F40-0F470F49-0F6C0F88-0F8B1000-102A103F1050-1055105A-105D106110651066106E-10701075-1081108E10D0-10FA1100-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A1380-138F13A0-13F41401-166C166F-167F1681-169A16A0-16EA1700-170C170E-17111720-17311740-17511760-176C176E-17701780-17B317DC1820-18421844-18771880-18A818AA18B0-18F51900-191C1950-196D1970-19741980-19AB19C1-19C71A00-1A161A20-1A541B05-1B331B45-1B4B1B83-1BA01BAE1BAF1C00-1C231C4D-1C4F1C5A-1C771CE9-1CEC1CEE-1CF12135-21382D30-2D652D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE3006303C3041-3096309F30A1-30FA30FF3105-312D3131-318E31A0-31B731F0-31FF3400-4DB54E00-9FCBA000-A014A016-A48CA4D0-A4F7A500-A60BA610-A61FA62AA62BA66EA6A0-A6E5A7FB-A801A803-A805A807-A80AA80C-A822A840-A873A882-A8B3A8F2-A8F7A8FBA90A-A925A930-A946A960-A97CA984-A9B2AA00-AA28AA40-AA42AA44-AA4BAA60-AA6FAA71-AA76AA7AAA80-AAAFAAB1AAB5AAB6AAB9-AABDAAC0AAC2AADBAADCABC0-ABE2AC00-D7A3D7B0-D7C6D7CB-D7FBF900-FA2DFA30-FA6DFA70-FAD9FB1DFB1F-FB28FB2A-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBB1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFBFE70-FE74FE76-FEFCFF66-FF6FFF71-FF9DFFA0-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC",
    M:  "0300-036F0483-04890591-05BD05BF05C105C205C405C505C70610-061A064B-065E067006D6-06DC06DE-06E406E706E806EA-06ED07110730-074A07A6-07B007EB-07F30816-0819081B-08230825-08270829-082D0900-0903093C093E-094E0951-0955096209630981-098309BC09BE-09C409C709C809CB-09CD09D709E209E30A01-0A030A3C0A3E-0A420A470A480A4B-0A4D0A510A700A710A750A81-0A830ABC0ABE-0AC50AC7-0AC90ACB-0ACD0AE20AE30B01-0B030B3C0B3E-0B440B470B480B4B-0B4D0B560B570B620B630B820BBE-0BC20BC6-0BC80BCA-0BCD0BD70C01-0C030C3E-0C440C46-0C480C4A-0C4D0C550C560C620C630C820C830CBC0CBE-0CC40CC6-0CC80CCA-0CCD0CD50CD60CE20CE30D020D030D3E-0D440D46-0D480D4A-0D4D0D570D620D630D820D830DCA0DCF-0DD40DD60DD8-0DDF0DF20DF30E310E34-0E3A0E47-0E4E0EB10EB4-0EB90EBB0EBC0EC8-0ECD0F180F190F350F370F390F3E0F3F0F71-0F840F860F870F90-0F970F99-0FBC0FC6102B-103E1056-1059105E-10601062-10641067-106D1071-10741082-108D108F109A-109D135F1712-17141732-1734175217531772177317B6-17D317DD180B-180D18A91920-192B1930-193B19B0-19C019C819C91A17-1A1B1A55-1A5E1A60-1A7C1A7F1B00-1B041B34-1B441B6B-1B731B80-1B821BA1-1BAA1C24-1C371CD0-1CD21CD4-1CE81CED1CF21DC0-1DE61DFD-1DFF20D0-20F02CEF-2CF12DE0-2DFF302A-302F3099309AA66F-A672A67CA67DA6F0A6F1A802A806A80BA823-A827A880A881A8B4-A8C4A8E0-A8F1A926-A92DA947-A953A980-A983A9B3-A9C0AA29-AA36AA43AA4CAA4DAA7BAAB0AAB2-AAB4AAB7AAB8AABEAABFAAC1ABE3-ABEAABECABEDFB1EFE00-FE0FFE20-FE26",
    Mn: "0300-036F0483-04870591-05BD05BF05C105C205C405C505C70610-061A064B-065E067006D6-06DC06DF-06E406E706E806EA-06ED07110730-074A07A6-07B007EB-07F30816-0819081B-08230825-08270829-082D0900-0902093C0941-0948094D0951-095509620963098109BC09C1-09C409CD09E209E30A010A020A3C0A410A420A470A480A4B-0A4D0A510A700A710A750A810A820ABC0AC1-0AC50AC70AC80ACD0AE20AE30B010B3C0B3F0B41-0B440B4D0B560B620B630B820BC00BCD0C3E-0C400C46-0C480C4A-0C4D0C550C560C620C630CBC0CBF0CC60CCC0CCD0CE20CE30D41-0D440D4D0D620D630DCA0DD2-0DD40DD60E310E34-0E3A0E47-0E4E0EB10EB4-0EB90EBB0EBC0EC8-0ECD0F180F190F350F370F390F71-0F7E0F80-0F840F860F870F90-0F970F99-0FBC0FC6102D-10301032-10371039103A103D103E10581059105E-10601071-1074108210851086108D109D135F1712-17141732-1734175217531772177317B7-17BD17C617C9-17D317DD180B-180D18A91920-19221927192819321939-193B1A171A181A561A58-1A5E1A601A621A65-1A6C1A73-1A7C1A7F1B00-1B031B341B36-1B3A1B3C1B421B6B-1B731B801B811BA2-1BA51BA81BA91C2C-1C331C361C371CD0-1CD21CD4-1CE01CE2-1CE81CED1DC0-1DE61DFD-1DFF20D0-20DC20E120E5-20F02CEF-2CF12DE0-2DFF302A-302F3099309AA66FA67CA67DA6F0A6F1A802A806A80BA825A826A8C4A8E0-A8F1A926-A92DA947-A951A980-A982A9B3A9B6-A9B9A9BCAA29-AA2EAA31AA32AA35AA36AA43AA4CAAB0AAB2-AAB4AAB7AAB8AABEAABFAAC1ABE5ABE8ABEDFB1EFE00-FE0FFE20-FE26",
    Mc: "0903093E-09400949-094C094E0982098309BE-09C009C709C809CB09CC09D70A030A3E-0A400A830ABE-0AC00AC90ACB0ACC0B020B030B3E0B400B470B480B4B0B4C0B570BBE0BBF0BC10BC20BC6-0BC80BCA-0BCC0BD70C01-0C030C41-0C440C820C830CBE0CC0-0CC40CC70CC80CCA0CCB0CD50CD60D020D030D3E-0D400D46-0D480D4A-0D4C0D570D820D830DCF-0DD10DD8-0DDF0DF20DF30F3E0F3F0F7F102B102C10311038103B103C105610571062-10641067-106D108310841087-108C108F109A-109C17B617BE-17C517C717C81923-19261929-192B193019311933-193819B0-19C019C819C91A19-1A1B1A551A571A611A631A641A6D-1A721B041B351B3B1B3D-1B411B431B441B821BA11BA61BA71BAA1C24-1C2B1C341C351CE11CF2A823A824A827A880A881A8B4-A8C3A952A953A983A9B4A9B5A9BAA9BBA9BD-A9C0AA2FAA30AA33AA34AA4DAA7BABE3ABE4ABE6ABE7ABE9ABEAABEC",
    Me: "0488048906DE20DD-20E020E2-20E4A670-A672",
    N:  "0030-003900B200B300B900BC-00BE0660-066906F0-06F907C0-07C90966-096F09E6-09EF09F4-09F90A66-0A6F0AE6-0AEF0B66-0B6F0BE6-0BF20C66-0C6F0C78-0C7E0CE6-0CEF0D66-0D750E50-0E590ED0-0ED90F20-0F331040-10491090-10991369-137C16EE-16F017E0-17E917F0-17F91810-18191946-194F19D0-19DA1A80-1A891A90-1A991B50-1B591BB0-1BB91C40-1C491C50-1C5920702074-20792080-20892150-21822185-21892460-249B24EA-24FF2776-27932CFD30073021-30293038-303A3192-31953220-32293251-325F3280-328932B1-32BFA620-A629A6E6-A6EFA830-A835A8D0-A8D9A900-A909A9D0-A9D9AA50-AA59ABF0-ABF9FF10-FF19",
    Nd: "0030-00390660-066906F0-06F907C0-07C90966-096F09E6-09EF0A66-0A6F0AE6-0AEF0B66-0B6F0BE6-0BEF0C66-0C6F0CE6-0CEF0D66-0D6F0E50-0E590ED0-0ED90F20-0F291040-10491090-109917E0-17E91810-18191946-194F19D0-19DA1A80-1A891A90-1A991B50-1B591BB0-1BB91C40-1C491C50-1C59A620-A629A8D0-A8D9A900-A909A9D0-A9D9AA50-AA59ABF0-ABF9FF10-FF19",
    Nl: "16EE-16F02160-21822185-218830073021-30293038-303AA6E6-A6EF",
    No: "00B200B300B900BC-00BE09F4-09F90BF0-0BF20C78-0C7E0D70-0D750F2A-0F331369-137C17F0-17F920702074-20792080-20892150-215F21892460-249B24EA-24FF2776-27932CFD3192-31953220-32293251-325F3280-328932B1-32BFA830-A835",
    P:  "0021-00230025-002A002C-002F003A003B003F0040005B-005D005F007B007D00A100AB00B700BB00BF037E0387055A-055F0589058A05BE05C005C305C605F305F40609060A060C060D061B061E061F066A-066D06D40700-070D07F7-07F90830-083E0964096509700DF40E4F0E5A0E5B0F04-0F120F3A-0F3D0F850FD0-0FD4104A-104F10FB1361-13681400166D166E169B169C16EB-16ED1735173617D4-17D617D8-17DA1800-180A1944194519DE19DF1A1E1A1F1AA0-1AA61AA8-1AAD1B5A-1B601C3B-1C3F1C7E1C7F1CD32010-20272030-20432045-20512053-205E207D207E208D208E2329232A2768-277527C527C627E6-27EF2983-299829D8-29DB29FC29FD2CF9-2CFC2CFE2CFF2E00-2E2E2E302E313001-30033008-30113014-301F3030303D30A030FBA4FEA4FFA60D-A60FA673A67EA6F2-A6F7A874-A877A8CEA8CFA8F8-A8FAA92EA92FA95FA9C1-A9CDA9DEA9DFAA5C-AA5FAADEAADFABEBFD3EFD3FFE10-FE19FE30-FE52FE54-FE61FE63FE68FE6AFE6BFF01-FF03FF05-FF0AFF0C-FF0FFF1AFF1BFF1FFF20FF3B-FF3DFF3FFF5BFF5DFF5F-FF65",
    Pd: "002D058A05BE140018062010-20152E172E1A301C303030A0FE31FE32FE58FE63FF0D",
    Ps: "0028005B007B0F3A0F3C169B201A201E2045207D208D23292768276A276C276E27702772277427C527E627E827EA27EC27EE2983298529872989298B298D298F299129932995299729D829DA29FC2E222E242E262E283008300A300C300E3010301430163018301A301DFD3EFE17FE35FE37FE39FE3BFE3DFE3FFE41FE43FE47FE59FE5BFE5DFF08FF3BFF5BFF5FFF62",
    Pe: "0029005D007D0F3B0F3D169C2046207E208E232A2769276B276D276F27712773277527C627E727E927EB27ED27EF298429862988298A298C298E2990299229942996299829D929DB29FD2E232E252E272E293009300B300D300F3011301530173019301B301E301FFD3FFE18FE36FE38FE3AFE3CFE3EFE40FE42FE44FE48FE5AFE5CFE5EFF09FF3DFF5DFF60FF63",
    Pi: "00AB2018201B201C201F20392E022E042E092E0C2E1C2E20",
    Pf: "00BB2019201D203A2E032E052E0A2E0D2E1D2E21",
    Pc: "005F203F20402054FE33FE34FE4D-FE4FFF3F",
    Po: "0021-00230025-0027002A002C002E002F003A003B003F0040005C00A100B700BF037E0387055A-055F058905C005C305C605F305F40609060A060C060D061B061E061F066A-066D06D40700-070D07F7-07F90830-083E0964096509700DF40E4F0E5A0E5B0F04-0F120F850FD0-0FD4104A-104F10FB1361-1368166D166E16EB-16ED1735173617D4-17D617D8-17DA1800-18051807-180A1944194519DE19DF1A1E1A1F1AA0-1AA61AA8-1AAD1B5A-1B601C3B-1C3F1C7E1C7F1CD3201620172020-20272030-2038203B-203E2041-20432047-205120532055-205E2CF9-2CFC2CFE2CFF2E002E012E06-2E082E0B2E0E-2E162E182E192E1B2E1E2E1F2E2A-2E2E2E302E313001-3003303D30FBA4FEA4FFA60D-A60FA673A67EA6F2-A6F7A874-A877A8CEA8CFA8F8-A8FAA92EA92FA95FA9C1-A9CDA9DEA9DFAA5C-AA5FAADEAADFABEBFE10-FE16FE19FE30FE45FE46FE49-FE4CFE50-FE52FE54-FE57FE5F-FE61FE68FE6AFE6BFF01-FF03FF05-FF07FF0AFF0CFF0EFF0FFF1AFF1BFF1FFF20FF3CFF61FF64FF65",
    S:  "0024002B003C-003E005E0060007C007E00A2-00A900AC00AE-00B100B400B600B800D700F702C2-02C502D2-02DF02E5-02EB02ED02EF-02FF03750384038503F604820606-0608060B060E060F06E906FD06FE07F609F209F309FA09FB0AF10B700BF3-0BFA0C7F0CF10CF20D790E3F0F01-0F030F13-0F170F1A-0F1F0F340F360F380FBE-0FC50FC7-0FCC0FCE0FCF0FD5-0FD8109E109F13601390-139917DB194019E0-19FF1B61-1B6A1B74-1B7C1FBD1FBF-1FC11FCD-1FCF1FDD-1FDF1FED-1FEF1FFD1FFE20442052207A-207C208A-208C20A0-20B8210021012103-21062108210921142116-2118211E-2123212521272129212E213A213B2140-2144214A-214D214F2190-2328232B-23E82400-24262440-244A249C-24E92500-26CD26CF-26E126E326E8-26FF2701-27042706-2709270C-27272729-274B274D274F-27522756-275E2761-276727942798-27AF27B1-27BE27C0-27C427C7-27CA27CC27D0-27E527F0-29822999-29D729DC-29FB29FE-2B4C2B50-2B592CE5-2CEA2E80-2E992E9B-2EF32F00-2FD52FF0-2FFB300430123013302030363037303E303F309B309C319031913196-319F31C0-31E33200-321E322A-32503260-327F328A-32B032C0-32FE3300-33FF4DC0-4DFFA490-A4C6A700-A716A720A721A789A78AA828-A82BA836-A839AA77-AA79FB29FDFCFDFDFE62FE64-FE66FE69FF04FF0BFF1C-FF1EFF3EFF40FF5CFF5EFFE0-FFE6FFE8-FFEEFFFCFFFD",
    Sm: "002B003C-003E007C007E00AC00B100D700F703F60606-060820442052207A-207C208A-208C2140-2144214B2190-2194219A219B21A021A321A621AE21CE21CF21D221D421F4-22FF2308-230B23202321237C239B-23B323DC-23E125B725C125F8-25FF266F27C0-27C427C7-27CA27CC27D0-27E527F0-27FF2900-29822999-29D729DC-29FB29FE-2AFF2B30-2B442B47-2B4CFB29FE62FE64-FE66FF0BFF1C-FF1EFF5CFF5EFFE2FFE9-FFEC",
    Sc: "002400A2-00A5060B09F209F309FB0AF10BF90E3F17DB20A0-20B8A838FDFCFE69FF04FFE0FFE1FFE5FFE6",
    Sk: "005E006000A800AF00B400B802C2-02C502D2-02DF02E5-02EB02ED02EF-02FF0375038403851FBD1FBF-1FC11FCD-1FCF1FDD-1FDF1FED-1FEF1FFD1FFE309B309CA700-A716A720A721A789A78AFF3EFF40FFE3",
    So: "00A600A700A900AE00B000B60482060E060F06E906FD06FE07F609FA0B700BF3-0BF80BFA0C7F0CF10CF20D790F01-0F030F13-0F170F1A-0F1F0F340F360F380FBE-0FC50FC7-0FCC0FCE0FCF0FD5-0FD8109E109F13601390-1399194019E0-19FF1B61-1B6A1B74-1B7C210021012103-21062108210921142116-2118211E-2123212521272129212E213A213B214A214C214D214F2195-2199219C-219F21A121A221A421A521A7-21AD21AF-21CD21D021D121D321D5-21F32300-2307230C-231F2322-2328232B-237B237D-239A23B4-23DB23E2-23E82400-24262440-244A249C-24E92500-25B625B8-25C025C2-25F72600-266E2670-26CD26CF-26E126E326E8-26FF2701-27042706-2709270C-27272729-274B274D274F-27522756-275E2761-276727942798-27AF27B1-27BE2800-28FF2B00-2B2F2B452B462B50-2B592CE5-2CEA2E80-2E992E9B-2EF32F00-2FD52FF0-2FFB300430123013302030363037303E303F319031913196-319F31C0-31E33200-321E322A-32503260-327F328A-32B032C0-32FE3300-33FF4DC0-4DFFA490-A4C6A828-A82BA836A837A839AA77-AA79FDFDFFE4FFE8FFEDFFEEFFFCFFFD",
    Z:  "002000A01680180E2000-200A20282029202F205F3000",
    Zs: "002000A01680180E2000-200A202F205F3000",
    Zl: "2028",
    Zp: "2029",
    C:  "0000-001F007F-009F00AD03780379037F-0383038B038D03A20526-05300557055805600588058B-059005C8-05CF05EB-05EF05F5-0605061C061D0620065F06DD070E070F074B074C07B2-07BF07FB-07FF082E082F083F-08FF093A093B094F095609570973-097809800984098D098E0991099209A909B109B3-09B509BA09BB09C509C609C909CA09CF-09D609D8-09DB09DE09E409E509FC-0A000A040A0B-0A0E0A110A120A290A310A340A370A3A0A3B0A3D0A43-0A460A490A4A0A4E-0A500A52-0A580A5D0A5F-0A650A76-0A800A840A8E0A920AA90AB10AB40ABA0ABB0AC60ACA0ACE0ACF0AD1-0ADF0AE40AE50AF00AF2-0B000B040B0D0B0E0B110B120B290B310B340B3A0B3B0B450B460B490B4A0B4E-0B550B58-0B5B0B5E0B640B650B72-0B810B840B8B-0B8D0B910B96-0B980B9B0B9D0BA0-0BA20BA5-0BA70BAB-0BAD0BBA-0BBD0BC3-0BC50BC90BCE0BCF0BD1-0BD60BD8-0BE50BFB-0C000C040C0D0C110C290C340C3A-0C3C0C450C490C4E-0C540C570C5A-0C5F0C640C650C70-0C770C800C810C840C8D0C910CA90CB40CBA0CBB0CC50CC90CCE-0CD40CD7-0CDD0CDF0CE40CE50CF00CF3-0D010D040D0D0D110D290D3A-0D3C0D450D490D4E-0D560D58-0D5F0D640D650D76-0D780D800D810D840D97-0D990DB20DBC0DBE0DBF0DC7-0DC90DCB-0DCE0DD50DD70DE0-0DF10DF5-0E000E3B-0E3E0E5C-0E800E830E850E860E890E8B0E8C0E8E-0E930E980EA00EA40EA60EA80EA90EAC0EBA0EBE0EBF0EC50EC70ECE0ECF0EDA0EDB0EDE-0EFF0F480F6D-0F700F8C-0F8F0F980FBD0FCD0FD9-0FFF10C6-10CF10FD-10FF1249124E124F12571259125E125F1289128E128F12B112B612B712BF12C112C612C712D7131113161317135B-135E137D-137F139A-139F13F5-13FF169D-169F16F1-16FF170D1715-171F1737-173F1754-175F176D17711774-177F17B417B517DE17DF17EA-17EF17FA-17FF180F181A-181F1878-187F18AB-18AF18F6-18FF191D-191F192C-192F193C-193F1941-1943196E196F1975-197F19AC-19AF19CA-19CF19DB-19DD1A1C1A1D1A5F1A7D1A7E1A8A-1A8F1A9A-1A9F1AAE-1AFF1B4C-1B4F1B7D-1B7F1BAB-1BAD1BBA-1BFF1C38-1C3A1C4A-1C4C1C80-1CCF1CF3-1CFF1DE7-1DFC1F161F171F1E1F1F1F461F471F4E1F4F1F581F5A1F5C1F5E1F7E1F7F1FB51FC51FD41FD51FDC1FF01FF11FF51FFF200B-200F202A-202E2060-206F20722073208F2095-209F20B9-20CF20F1-20FF218A-218F23E9-23FF2427-243F244B-245F26CE26E226E4-26E727002705270A270B2728274C274E2753-2755275F27602795-279727B027BF27CB27CD-27CF2B4D-2B4F2B5A-2BFF2C2F2C5F2CF2-2CF82D26-2D2F2D66-2D6E2D70-2D7F2D97-2D9F2DA72DAF2DB72DBF2DC72DCF2DD72DDF2E32-2E7F2E9A2EF4-2EFF2FD6-2FEF2FFC-2FFF3040309730983100-3104312E-3130318F31B8-31BF31E4-31EF321F32FF4DB6-4DBF9FCC-9FFFA48D-A48FA4C7-A4CFA62C-A63FA660A661A674-A67BA698-A69FA6F8-A6FFA78D-A7FAA82C-A82FA83A-A83FA878-A87FA8C5-A8CDA8DA-A8DFA8FC-A8FFA954-A95EA97D-A97FA9CEA9DA-A9DDA9E0-A9FFAA37-AA3FAA4EAA4FAA5AAA5BAA7C-AA7FAAC3-AADAAAE0-ABBFABEEABEFABFA-ABFFD7A4-D7AFD7C7-D7CAD7FC-F8FFFA2EFA2FFA6EFA6FFADA-FAFFFB07-FB12FB18-FB1CFB37FB3DFB3FFB42FB45FBB2-FBD2FD40-FD4FFD90FD91FDC8-FDEFFDFEFDFFFE1A-FE1FFE27-FE2FFE53FE67FE6C-FE6FFE75FEFD-FF00FFBF-FFC1FFC8FFC9FFD0FFD1FFD8FFD9FFDD-FFDFFFE7FFEF-FFFBFFFEFFFF",
    Cc: "0000-001F007F-009F",
    Cf: "00AD0600-060306DD070F17B417B5200B-200F202A-202E2060-2064206A-206FFEFFFFF9-FFFB",
    Co: "E000-F8FF",
    Cs: "D800-DFFF",
    Cn: "03780379037F-0383038B038D03A20526-05300557055805600588058B-059005C8-05CF05EB-05EF05F5-05FF06040605061C061D0620065F070E074B074C07B2-07BF07FB-07FF082E082F083F-08FF093A093B094F095609570973-097809800984098D098E0991099209A909B109B3-09B509BA09BB09C509C609C909CA09CF-09D609D8-09DB09DE09E409E509FC-0A000A040A0B-0A0E0A110A120A290A310A340A370A3A0A3B0A3D0A43-0A460A490A4A0A4E-0A500A52-0A580A5D0A5F-0A650A76-0A800A840A8E0A920AA90AB10AB40ABA0ABB0AC60ACA0ACE0ACF0AD1-0ADF0AE40AE50AF00AF2-0B000B040B0D0B0E0B110B120B290B310B340B3A0B3B0B450B460B490B4A0B4E-0B550B58-0B5B0B5E0B640B650B72-0B810B840B8B-0B8D0B910B96-0B980B9B0B9D0BA0-0BA20BA5-0BA70BAB-0BAD0BBA-0BBD0BC3-0BC50BC90BCE0BCF0BD1-0BD60BD8-0BE50BFB-0C000C040C0D0C110C290C340C3A-0C3C0C450C490C4E-0C540C570C5A-0C5F0C640C650C70-0C770C800C810C840C8D0C910CA90CB40CBA0CBB0CC50CC90CCE-0CD40CD7-0CDD0CDF0CE40CE50CF00CF3-0D010D040D0D0D110D290D3A-0D3C0D450D490D4E-0D560D58-0D5F0D640D650D76-0D780D800D810D840D97-0D990DB20DBC0DBE0DBF0DC7-0DC90DCB-0DCE0DD50DD70DE0-0DF10DF5-0E000E3B-0E3E0E5C-0E800E830E850E860E890E8B0E8C0E8E-0E930E980EA00EA40EA60EA80EA90EAC0EBA0EBE0EBF0EC50EC70ECE0ECF0EDA0EDB0EDE-0EFF0F480F6D-0F700F8C-0F8F0F980FBD0FCD0FD9-0FFF10C6-10CF10FD-10FF1249124E124F12571259125E125F1289128E128F12B112B612B712BF12C112C612C712D7131113161317135B-135E137D-137F139A-139F13F5-13FF169D-169F16F1-16FF170D1715-171F1737-173F1754-175F176D17711774-177F17DE17DF17EA-17EF17FA-17FF180F181A-181F1878-187F18AB-18AF18F6-18FF191D-191F192C-192F193C-193F1941-1943196E196F1975-197F19AC-19AF19CA-19CF19DB-19DD1A1C1A1D1A5F1A7D1A7E1A8A-1A8F1A9A-1A9F1AAE-1AFF1B4C-1B4F1B7D-1B7F1BAB-1BAD1BBA-1BFF1C38-1C3A1C4A-1C4C1C80-1CCF1CF3-1CFF1DE7-1DFC1F161F171F1E1F1F1F461F471F4E1F4F1F581F5A1F5C1F5E1F7E1F7F1FB51FC51FD41FD51FDC1FF01FF11FF51FFF2065-206920722073208F2095-209F20B9-20CF20F1-20FF218A-218F23E9-23FF2427-243F244B-245F26CE26E226E4-26E727002705270A270B2728274C274E2753-2755275F27602795-279727B027BF27CB27CD-27CF2B4D-2B4F2B5A-2BFF2C2F2C5F2CF2-2CF82D26-2D2F2D66-2D6E2D70-2D7F2D97-2D9F2DA72DAF2DB72DBF2DC72DCF2DD72DDF2E32-2E7F2E9A2EF4-2EFF2FD6-2FEF2FFC-2FFF3040309730983100-3104312E-3130318F31B8-31BF31E4-31EF321F32FF4DB6-4DBF9FCC-9FFFA48D-A48FA4C7-A4CFA62C-A63FA660A661A674-A67BA698-A69FA6F8-A6FFA78D-A7FAA82C-A82FA83A-A83FA878-A87FA8C5-A8CDA8DA-A8DFA8FC-A8FFA954-A95EA97D-A97FA9CEA9DA-A9DDA9E0-A9FFAA37-AA3FAA4EAA4FAA5AAA5BAA7C-AA7FAAC3-AADAAAE0-ABBFABEEABEFABFA-ABFFD7A4-D7AFD7C7-D7CAD7FC-D7FFFA2EFA2FFA6EFA6FFADA-FAFFFB07-FB12FB18-FB1CFB37FB3DFB3FFB42FB45FBB2-FBD2FD40-FD4FFD90FD91FDC8-FDEFFDFEFDFFFE1A-FE1FFE27-FE2FFE53FE67FE6C-FE6FFE75FEFDFEFEFF00FFBF-FFC1FFC8FFC9FFD0FFD1FFD8FFD9FFDD-FFDFFFE7FFEF-FFF8FFFEFFFF"
});

function addUnicodePackage (pack) {
    var codePoint = /\w{4}/g;
    for (var name in pack)
        exports.packages[name] = pack[name].replace(codePoint, "\\u$&");
}

});

ace.define("ace/mode/text",["require","exports","module","ace/tokenizer","ace/mode/text_highlight_rules","ace/mode/behaviour/cstyle","ace/unicode","ace/lib/lang","ace/token_iterator","ace/range"], function(require, exports, module) {
"use strict";

var Tokenizer = require("../tokenizer").Tokenizer;
var TextHighlightRules = require("./text_highlight_rules").TextHighlightRules;
var CstyleBehaviour = require("./behaviour/cstyle").CstyleBehaviour;
var unicode = require("../unicode");
var lang = require("../lib/lang");
var TokenIterator = require("../token_iterator").TokenIterator;
var Range = require("../range").Range;

var Mode = function() {
    this.HighlightRules = TextHighlightRules;
};

(function() {
    this.$defaultBehaviour = new CstyleBehaviour();

    this.tokenRe = new RegExp("^["
        + unicode.packages.L
        + unicode.packages.Mn + unicode.packages.Mc
        + unicode.packages.Nd
        + unicode.packages.Pc + "\\$_]+", "g"
    );

    this.nonTokenRe = new RegExp("^(?:[^"
        + unicode.packages.L
        + unicode.packages.Mn + unicode.packages.Mc
        + unicode.packages.Nd
        + unicode.packages.Pc + "\\$_]|\\s])+", "g"
    );

    this.getTokenizer = function() {
        if (!this.$tokenizer) {
            this.$highlightRules = this.$highlightRules || new this.HighlightRules(this.$highlightRuleConfig);
            this.$tokenizer = new Tokenizer(this.$highlightRules.getRules());
        }
        return this.$tokenizer;
    };

    this.lineCommentStart = "";
    this.blockComment = "";

    this.toggleCommentLines = function(state, session, startRow, endRow) {
        var doc = session.doc;

        var ignoreBlankLines = true;
        var shouldRemove = true;
        var minIndent = Infinity;
        var tabSize = session.getTabSize();
        var insertAtTabStop = false;

        if (!this.lineCommentStart) {
            if (!this.blockComment)
                return false;
            var lineCommentStart = this.blockComment.start;
            var lineCommentEnd = this.blockComment.end;
            var regexpStart = new RegExp("^(\\s*)(?:" + lang.escapeRegExp(lineCommentStart) + ")");
            var regexpEnd = new RegExp("(?:" + lang.escapeRegExp(lineCommentEnd) + ")\\s*$");

            var comment = function(line, i) {
                if (testRemove(line, i))
                    return;
                if (!ignoreBlankLines || /\S/.test(line)) {
                    doc.insertInLine({row: i, column: line.length}, lineCommentEnd);
                    doc.insertInLine({row: i, column: minIndent}, lineCommentStart);
                }
            };

            var uncomment = function(line, i) {
                var m;
                if (m = line.match(regexpEnd))
                    doc.removeInLine(i, line.length - m[0].length, line.length);
                if (m = line.match(regexpStart))
                    doc.removeInLine(i, m[1].length, m[0].length);
            };

            var testRemove = function(line, row) {
                if (regexpStart.test(line))
                    return true;
                var tokens = session.getTokens(row);
                for (var i = 0; i < tokens.length; i++) {
                    if (tokens[i].type === "comment")
                        return true;
                }
            };
        } else {
            if (Array.isArray(this.lineCommentStart)) {
                var regexpStart = this.lineCommentStart.map(lang.escapeRegExp).join("|");
                var lineCommentStart = this.lineCommentStart[0];
            } else {
                var regexpStart = lang.escapeRegExp(this.lineCommentStart);
                var lineCommentStart = this.lineCommentStart;
            }
            regexpStart = new RegExp("^(\\s*)(?:" + regexpStart + ") ?");
            
            insertAtTabStop = session.getUseSoftTabs();

            var uncomment = function(line, i) {
                var m = line.match(regexpStart);
                if (!m) return;
                var start = m[1].length, end = m[0].length;
                if (!shouldInsertSpace(line, start, end) && m[0][end - 1] == " ")
                    end--;
                doc.removeInLine(i, start, end);
            };
            var commentWithSpace = lineCommentStart + " ";
            var comment = function(line, i) {
                if (!ignoreBlankLines || /\S/.test(line)) {
                    if (shouldInsertSpace(line, minIndent, minIndent))
                        doc.insertInLine({row: i, column: minIndent}, commentWithSpace);
                    else
                        doc.insertInLine({row: i, column: minIndent}, lineCommentStart);
                }
            };
            var testRemove = function(line, i) {
                return regexpStart.test(line);
            };
            
            var shouldInsertSpace = function(line, before, after) {
                var spaces = 0;
                while (before-- && line.charAt(before) == " ")
                    spaces++;
                if (spaces % tabSize != 0)
                    return false;
                var spaces = 0;
                while (line.charAt(after++) == " ")
                    spaces++;
                if (tabSize > 2)
                    return spaces % tabSize != tabSize - 1;
                else
                    return spaces % tabSize == 0;
                return true;
            };
        }

        function iter(fun) {
            for (var i = startRow; i <= endRow; i++)
                fun(doc.getLine(i), i);
        }


        var minEmptyLength = Infinity;
        iter(function(line, i) {
            var indent = line.search(/\S/);
            if (indent !== -1) {
                if (indent < minIndent)
                    minIndent = indent;
                if (shouldRemove && !testRemove(line, i))
                    shouldRemove = false;
            } else if (minEmptyLength > line.length) {
                minEmptyLength = line.length;
            }
        });

        if (minIndent == Infinity) {
            minIndent = minEmptyLength;
            ignoreBlankLines = false;
            shouldRemove = false;
        }

        if (insertAtTabStop && minIndent % tabSize != 0)
            minIndent = Math.floor(minIndent / tabSize) * tabSize;

        iter(shouldRemove ? uncomment : comment);
    };

    this.toggleBlockComment = function(state, session, range, cursor) {
        var comment = this.blockComment;
        if (!comment)
            return;
        if (!comment.start && comment[0])
            comment = comment[0];

        var iterator = new TokenIterator(session, cursor.row, cursor.column);
        var token = iterator.getCurrentToken();

        var sel = session.selection;
        var initialRange = session.selection.toOrientedRange();
        var startRow, colDiff;

        if (token && /comment/.test(token.type)) {
            var startRange, endRange;
            while (token && /comment/.test(token.type)) {
                var i = token.value.indexOf(comment.start);
                if (i != -1) {
                    var row = iterator.getCurrentTokenRow();
                    var column = iterator.getCurrentTokenColumn() + i;
                    startRange = new Range(row, column, row, column + comment.start.length);
                    break;
                }
                token = iterator.stepBackward();
            }

            var iterator = new TokenIterator(session, cursor.row, cursor.column);
            var token = iterator.getCurrentToken();
            while (token && /comment/.test(token.type)) {
                var i = token.value.indexOf(comment.end);
                if (i != -1) {
                    var row = iterator.getCurrentTokenRow();
                    var column = iterator.getCurrentTokenColumn() + i;
                    endRange = new Range(row, column, row, column + comment.end.length);
                    break;
                }
                token = iterator.stepForward();
            }
            if (endRange)
                session.remove(endRange);
            if (startRange) {
                session.remove(startRange);
                startRow = startRange.start.row;
                colDiff = -comment.start.length;
            }
        } else {
            colDiff = comment.start.length;
            startRow = range.start.row;
            session.insert(range.end, comment.end);
            session.insert(range.start, comment.start);
        }
        if (initialRange.start.row == startRow)
            initialRange.start.column += colDiff;
        if (initialRange.end.row == startRow)
            initialRange.end.column += colDiff;
        session.selection.fromOrientedRange(initialRange);
    };

    this.getNextLineIndent = function(state, line, tab) {
        return this.$getIndent(line);
    };

    this.checkOutdent = function(state, line, input) {
        return false;
    };

    this.autoOutdent = function(state, doc, row) {
    };

    this.$getIndent = function(line) {
        return line.match(/^\s*/)[0];
    };

    this.createWorker = function(session) {
        return null;
    };

    this.createModeDelegates = function (mapping) {
        this.$embeds = [];
        this.$modes = {};
        for (var i in mapping) {
            if (mapping[i]) {
                this.$embeds.push(i);
                this.$modes[i] = new mapping[i]();
            }
        }

        var delegations = ["toggleBlockComment", "toggleCommentLines", "getNextLineIndent", 
            "checkOutdent", "autoOutdent", "transformAction", "getCompletions"];

        for (var i = 0; i < delegations.length; i++) {
            (function(scope) {
              var functionName = delegations[i];
              var defaultHandler = scope[functionName];
              scope[delegations[i]] = function() {
                  return this.$delegator(functionName, arguments, defaultHandler);
              };
            }(this));
        }
    };

    this.$delegator = function(method, args, defaultHandler) {
        var state = args[0];
        if (typeof state != "string")
            state = state[0];
        for (var i = 0; i < this.$embeds.length; i++) {
            if (!this.$modes[this.$embeds[i]]) continue;

            var split = state.split(this.$embeds[i]);
            if (!split[0] && split[1]) {
                args[0] = split[1];
                var mode = this.$modes[this.$embeds[i]];
                return mode[method].apply(mode, args);
            }
        }
        var ret = defaultHandler.apply(this, args);
        return defaultHandler ? ret : undefined;
    };

    this.transformAction = function(state, action, editor, session, param) {
        if (this.$behaviour) {
            var behaviours = this.$behaviour.getBehaviours();
            for (var key in behaviours) {
                if (behaviours[key][action]) {
                    var ret = behaviours[key][action].apply(this, arguments);
                    if (ret) {
                        return ret;
                    }
                }
            }
        }
    };
    
    this.getKeywords = function(append) {
        if (!this.completionKeywords) {
            var rules = this.$tokenizer.rules;
            var completionKeywords = [];
            for (var rule in rules) {
                var ruleItr = rules[rule];
                for (var r = 0, l = ruleItr.length; r < l; r++) {
                    if (typeof ruleItr[r].token === "string") {
                        if (/keyword|support|storage/.test(ruleItr[r].token))
                            completionKeywords.push(ruleItr[r].regex);
                    }
                    else if (typeof ruleItr[r].token === "object") {
                        for (var a = 0, aLength = ruleItr[r].token.length; a < aLength; a++) {    
                            if (/keyword|support|storage/.test(ruleItr[r].token[a])) {
                                var rule = ruleItr[r].regex.match(/\(.+?\)/g)[a];
                                completionKeywords.push(rule.substr(1, rule.length - 2));
                            }
                        }
                    }
                }
            }
            this.completionKeywords = completionKeywords;
        }
        if (!append)
            return this.$keywordList;
        return completionKeywords.concat(this.$keywordList || []);
    };
    
    this.$createKeywordList = function() {
        if (!this.$highlightRules)
            this.getTokenizer();
        return this.$keywordList = this.$highlightRules.$keywordList || [];
    };

    this.getCompletions = function(state, session, pos, prefix) {
        var keywords = this.$keywordList || this.$createKeywordList();
        return keywords.map(function(word) {
            return {
                name: word,
                value: word,
                score: 0,
                meta: "keyword"
            };
        });
    };

    this.$id = "ace/mode/text";
}).call(Mode.prototype);

exports.Mode = Mode;
});

ace.define("ace/apply_delta",["require","exports","module"], function(require, exports, module) {
"use strict";

function throwDeltaError(delta, errorText){
    console.log("Invalid Delta:", delta);
    throw "Invalid Delta: " + errorText;
}

function positionInDocument(docLines, position) {
    return position.row    >= 0 && position.row    <  docLines.length &&
           position.column >= 0 && position.column <= docLines[position.row].length;
}

function validateDelta(docLines, delta) {
    if (delta.action != "insert" && delta.action != "remove")
        throwDeltaError(delta, "delta.action must be 'insert' or 'remove'");
    if (!(delta.lines instanceof Array))
        throwDeltaError(delta, "delta.lines must be an Array");
    if (!delta.start || !delta.end)
       throwDeltaError(delta, "delta.start/end must be an present");
    var start = delta.start;
    if (!positionInDocument(docLines, delta.start))
        throwDeltaError(delta, "delta.start must be contained in document");
    var end = delta.end;
    if (delta.action == "remove" && !positionInDocument(docLines, end))
        throwDeltaError(delta, "delta.end must contained in document for 'remove' actions");
    var numRangeRows = end.row - start.row;
    var numRangeLastLineChars = (end.column - (numRangeRows == 0 ? start.column : 0));
    if (numRangeRows != delta.lines.length - 1 || delta.lines[numRangeRows].length != numRangeLastLineChars)
        throwDeltaError(delta, "delta.range must match delta lines");
}

exports.applyDelta = function(docLines, delta, doNotValidate) {
    
    var row = delta.start.row;
    var startColumn = delta.start.column;
    var line = docLines[row] || "";
    switch (delta.action) {
        case "insert":
            var lines = delta.lines;
            if (lines.length === 1) {
                docLines[row] = line.substring(0, startColumn) + delta.lines[0] + line.substring(startColumn);
            } else {
                var args = [row, 1].concat(delta.lines);
                docLines.splice.apply(docLines, args);
                docLines[row] = line.substring(0, startColumn) + docLines[row];
                docLines[row + delta.lines.length - 1] += line.substring(startColumn);
            }
            break;
        case "remove":
            var endColumn = delta.end.column;
            var endRow = delta.end.row;
            if (row === endRow) {
                docLines[row] = line.substring(0, startColumn) + line.substring(endColumn);
            } else {
                docLines.splice(
                    row, endRow - row + 1,
                    line.substring(0, startColumn) + docLines[endRow].substring(endColumn)
                );
            }
            break;
    }
};
});

ace.define("ace/anchor",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"], function(require, exports, module) {
"use strict";

var oop = require("./lib/oop");
var EventEmitter = require("./lib/event_emitter").EventEmitter;

var Anchor = exports.Anchor = function(doc, row, column) {
    this.$onChange = this.onChange.bind(this);
    this.attach(doc);
    
    if (typeof column == "undefined")
        this.setPosition(row.row, row.column);
    else
        this.setPosition(row, column);
};

(function() {

    oop.implement(this, EventEmitter);
    this.getPosition = function() {
        return this.$clipPositionToDocument(this.row, this.column);
    };
    this.getDocument = function() {
        return this.document;
    };
    this.$insertRight = false;
    this.onChange = function(delta) {
        if (delta.start.row == delta.end.row && delta.start.row != this.row)
            return;

        if (delta.start.row > this.row)
            return;
            
        var point = $getTransformedPoint(delta, {row: this.row, column: this.column}, this.$insertRight);
        this.setPosition(point.row, point.column, true);
    };
    
    function $pointsInOrder(point1, point2, equalPointsInOrder) {
        var bColIsAfter = equalPointsInOrder ? point1.column <= point2.column : point1.column < point2.column;
        return (point1.row < point2.row) || (point1.row == point2.row && bColIsAfter);
    }
            
    function $getTransformedPoint(delta, point, moveIfEqual) {
        var deltaIsInsert = delta.action == "insert";
        var deltaRowShift = (deltaIsInsert ? 1 : -1) * (delta.end.row    - delta.start.row);
        var deltaColShift = (deltaIsInsert ? 1 : -1) * (delta.end.column - delta.start.column);
        var deltaStart = delta.start;
        var deltaEnd = deltaIsInsert ? deltaStart : delta.end; // Collapse insert range.
        if ($pointsInOrder(point, deltaStart, moveIfEqual)) {
            return {
                row: point.row,
                column: point.column
            };
        }
        if ($pointsInOrder(deltaEnd, point, !moveIfEqual)) {
            return {
                row: point.row + deltaRowShift,
                column: point.column + (point.row == deltaEnd.row ? deltaColShift : 0)
            };
        }
        
        return {
            row: deltaStart.row,
            column: deltaStart.column
        };
    }
    this.setPosition = function(row, column, noClip) {
        var pos;
        if (noClip) {
            pos = {
                row: row,
                column: column
            };
        } else {
            pos = this.$clipPositionToDocument(row, column);
        }

        if (this.row == pos.row && this.column == pos.column)
            return;

        var old = {
            row: this.row,
            column: this.column
        };

        this.row = pos.row;
        this.column = pos.column;
        this._signal("change", {
            old: old,
            value: pos
        });
    };
    this.detach = function() {
        this.document.removeEventListener("change", this.$onChange);
    };
    this.attach = function(doc) {
        this.document = doc || this.document;
        this.document.on("change", this.$onChange);
    };
    this.$clipPositionToDocument = function(row, column) {
        var pos = {};

        if (row >= this.document.getLength()) {
            pos.row = Math.max(0, this.document.getLength() - 1);
            pos.column = this.document.getLine(pos.row).length;
        }
        else if (row < 0) {
            pos.row = 0;
            pos.column = 0;
        }
        else {
            pos.row = row;
            pos.column = Math.min(this.document.getLine(pos.row).length, Math.max(0, column));
        }

        if (column < 0)
            pos.column = 0;

        return pos;
    };

}).call(Anchor.prototype);

});

ace.define("ace/document",["require","exports","module","ace/lib/oop","ace/apply_delta","ace/lib/event_emitter","ace/range","ace/anchor"], function(require, exports, module) {
"use strict";

var oop = require("./lib/oop");
var applyDelta = require("./apply_delta").applyDelta;
var EventEmitter = require("./lib/event_emitter").EventEmitter;
var Range = require("./range").Range;
var Anchor = require("./anchor").Anchor;

var Document = function(textOrLines) {
    this.$lines = [""];
    if (textOrLines.length === 0) {
        this.$lines = [""];
    } else if (Array.isArray(textOrLines)) {
        this.insertMergedLines({row: 0, column: 0}, textOrLines);
    } else {
        this.insert({row: 0, column:0}, textOrLines);
    }
};

(function() {

    oop.implement(this, EventEmitter);
    this.setValue = function(text) {
        var len = this.getLength() - 1;
        this.remove(new Range(0, 0, len, this.getLine(len).length));
        this.insert({row: 0, column: 0}, text);
    };
    this.getValue = function() {
        return this.getAllLines().join(this.getNewLineCharacter());
    };
    this.createAnchor = function(row, column) {
        return new Anchor(this, row, column);
    };
    if ("aaa".split(/a/).length === 0) {
        this.$split = function(text) {
            return text.replace(/\r\n|\r/g, "\n").split("\n");
        };
    } else {
        this.$split = function(text) {
            return text.split(/\r\n|\r|\n/);
        };
    }


    this.$detectNewLine = function(text) {
        var match = text.match(/^.*?(\r\n|\r|\n)/m);
        this.$autoNewLine = match ? match[1] : "\n";
        this._signal("changeNewLineMode");
    };
    this.getNewLineCharacter = function() {
        switch (this.$newLineMode) {
          case "windows":
            return "\r\n";
          case "unix":
            return "\n";
          default:
            return this.$autoNewLine || "\n";
        }
    };

    this.$autoNewLine = "";
    this.$newLineMode = "auto";
    this.setNewLineMode = function(newLineMode) {
        if (this.$newLineMode === newLineMode)
            return;

        this.$newLineMode = newLineMode;
        this._signal("changeNewLineMode");
    };
    this.getNewLineMode = function() {
        return this.$newLineMode;
    };
    this.isNewLine = function(text) {
        return (text == "\r\n" || text == "\r" || text == "\n");
    };
    this.getLine = function(row) {
        return this.$lines[row] || "";
    };
    this.getLines = function(firstRow, lastRow) {
        return this.$lines.slice(firstRow, lastRow + 1);
    };
    this.getAllLines = function() {
        return this.getLines(0, this.getLength());
    };
    this.getLength = function() {
        return this.$lines.length;
    };
    this.getTextRange = function(range) {
        return this.getLinesForRange(range).join(this.getNewLineCharacter());
    };
    this.getLinesForRange = function(range) {
        var lines;
        if (range.start.row === range.end.row) {
            lines = [this.getLine(range.start.row).substring(range.start.column, range.end.column)];
        } else {
            lines = this.getLines(range.start.row, range.end.row);
            lines[0] = (lines[0] || "").substring(range.start.column);
            var l = lines.length - 1;
            if (range.end.row - range.start.row == l)
                lines[l] = lines[l].substring(0, range.end.column);
        }
        return lines;
    };
    this.insertLines = function(row, lines) {
        console.warn("Use of document.insertLines is deprecated. Use the insertFullLines method instead.");
        return this.insertFullLines(row, lines);
    };
    this.removeLines = function(firstRow, lastRow) {
        console.warn("Use of document.removeLines is deprecated. Use the removeFullLines method instead.");
        return this.removeFullLines(firstRow, lastRow);
    };
    this.insertNewLine = function(position) {
        console.warn("Use of document.insertNewLine is deprecated. Use insertMergedLines(position, ['', '']) instead.");
        return this.insertMergedLines(position, ["", ""]);
    };
    this.insert = function(position, text) {
        if (this.getLength() <= 1)
            this.$detectNewLine(text);
        
        return this.insertMergedLines(position, this.$split(text));
    };
    this.insertInLine = function(position, text) {
        var start = this.clippedPos(position.row, position.column);
        var end = this.pos(position.row, position.column + text.length);
        
        this.applyDelta({
            start: start,
            end: end,
            action: "insert",
            lines: [text]
        }, true);
        
        return this.clonePos(end);
    };
    
    this.clippedPos = function(row, column) {
        var length = this.getLength();
        if (row === undefined) {
            row = length;
        } else if (row < 0) {
            row = 0;
        } else if (row >= length) {
            row = length - 1;
            column = undefined;
        }
        var line = this.getLine(row);
        if (column == undefined)
            column = line.length;
        column = Math.min(Math.max(column, 0), line.length);
        return {row: row, column: column};
    };
    
    this.clonePos = function(pos) {
        return {row: pos.row, column: pos.column};
    };
    
    this.pos = function(row, column) {
        return {row: row, column: column};
    };
    
    this.$clipPosition = function(position) {
        var length = this.getLength();
        if (position.row >= length) {
            position.row = Math.max(0, length - 1);
            position.column = this.getLine(length - 1).length;
        } else {
            position.row = Math.max(0, position.row);
            position.column = Math.min(Math.max(position.column, 0), this.getLine(position.row).length);
        }
        return position;
    };
    this.insertFullLines = function(row, lines) {
        row = Math.min(Math.max(row, 0), this.getLength());
        var column = 0;
        if (row < this.getLength()) {
            lines = lines.concat([""]);
            column = 0;
        } else {
            lines = [""].concat(lines);
            row--;
            column = this.$lines[row].length;
        }
        this.insertMergedLines({row: row, column: column}, lines);
    };    
    this.insertMergedLines = function(position, lines) {
        var start = this.clippedPos(position.row, position.column);
        var end = {
            row: start.row + lines.length - 1,
            column: (lines.length == 1 ? start.column : 0) + lines[lines.length - 1].length
        };
        
        this.applyDelta({
            start: start,
            end: end,
            action: "insert",
            lines: lines
        });
        
        return this.clonePos(end);
    };
    this.remove = function(range) {
        var start = this.clippedPos(range.start.row, range.start.column);
        var end = this.clippedPos(range.end.row, range.end.column);
        this.applyDelta({
            start: start,
            end: end,
            action: "remove",
            lines: this.getLinesForRange({start: start, end: end})
        });
        return this.clonePos(start);
    };
    this.removeInLine = function(row, startColumn, endColumn) {
        var start = this.clippedPos(row, startColumn);
        var end = this.clippedPos(row, endColumn);
        
        this.applyDelta({
            start: start,
            end: end,
            action: "remove",
            lines: this.getLinesForRange({start: start, end: end})
        }, true);
        
        return this.clonePos(start);
    };
    this.removeFullLines = function(firstRow, lastRow) {
        firstRow = Math.min(Math.max(0, firstRow), this.getLength() - 1);
        lastRow  = Math.min(Math.max(0, lastRow ), this.getLength() - 1);
        var deleteFirstNewLine = lastRow == this.getLength() - 1 && firstRow > 0;
        var deleteLastNewLine  = lastRow  < this.getLength() - 1;
        var startRow = ( deleteFirstNewLine ? firstRow - 1                  : firstRow                    );
        var startCol = ( deleteFirstNewLine ? this.getLine(startRow).length : 0                           );
        var endRow   = ( deleteLastNewLine  ? lastRow + 1                   : lastRow                     );
        var endCol   = ( deleteLastNewLine  ? 0                             : this.getLine(endRow).length ); 
        var range = new Range(startRow, startCol, endRow, endCol);
        var deletedLines = this.$lines.slice(firstRow, lastRow + 1);
        
        this.applyDelta({
            start: range.start,
            end: range.end,
            action: "remove",
            lines: this.getLinesForRange(range)
        });
        return deletedLines;
    };
    this.removeNewLine = function(row) {
        if (row < this.getLength() - 1 && row >= 0) {
            this.applyDelta({
                start: this.pos(row, this.getLine(row).length),
                end: this.pos(row + 1, 0),
                action: "remove",
                lines: ["", ""]
            });
        }
    };
    this.replace = function(range, text) {
        if (!(range instanceof Range))
            range = Range.fromPoints(range.start, range.end);
        if (text.length === 0 && range.isEmpty())
            return range.start;
        if (text == this.getTextRange(range))
            return range.end;

        this.remove(range);
        var end;
        if (text) {
            end = this.insert(range.start, text);
        }
        else {
            end = range.start;
        }
        
        return end;
    };
    this.applyDeltas = function(deltas) {
        for (var i=0; i<deltas.length; i++) {
            this.applyDelta(deltas[i]);
        }
    };
    this.revertDeltas = function(deltas) {
        for (var i=deltas.length-1; i>=0; i--) {
            this.revertDelta(deltas[i]);
        }
    };
    this.applyDelta = function(delta, doNotValidate) {
        var isInsert = delta.action == "insert";
        if (isInsert ? delta.lines.length <= 1 && !delta.lines[0]
            : !Range.comparePoints(delta.start, delta.end)) {
            return;
        }
        
        if (isInsert && delta.lines.length > 20000)
            this.$splitAndapplyLargeDelta(delta, 20000);
        applyDelta(this.$lines, delta, doNotValidate);
        this._signal("change", delta);
    };
    
    this.$splitAndapplyLargeDelta = function(delta, MAX) {
        var lines = delta.lines;
        var l = lines.length;
        var row = delta.start.row; 
        var column = delta.start.column;
        var from = 0, to = 0;
        do {
            from = to;
            to += MAX - 1;
            var chunk = lines.slice(from, to);
            if (to > l) {
                delta.lines = chunk;
                delta.start.row = row + from;
                delta.start.column = column;
                break;
            }
            chunk.push("");
            this.applyDelta({
                start: this.pos(row + from, column),
                end: this.pos(row + to, column = 0),
                action: delta.action,
                lines: chunk
            }, true);
        } while(true);
    };
    this.revertDelta = function(delta) {
        this.applyDelta({
            start: this.clonePos(delta.start),
            end: this.clonePos(delta.end),
            action: (delta.action == "insert" ? "remove" : "insert"),
            lines: delta.lines.slice()
        });
    };
    this.indexToPosition = function(index, startRow) {
        var lines = this.$lines || this.getAllLines();
        var newlineLength = this.getNewLineCharacter().length;
        for (var i = startRow || 0, l = lines.length; i < l; i++) {
            index -= lines[i].length + newlineLength;
            if (index < 0)
                return {row: i, column: index + lines[i].length + newlineLength};
        }
        return {row: l-1, column: lines[l-1].length};
    };
    this.positionToIndex = function(pos, startRow) {
        var lines = this.$lines || this.getAllLines();
        var newlineLength = this.getNewLineCharacter().length;
        var index = 0;
        var row = Math.min(pos.row, lines.length);
        for (var i = startRow || 0; i < row; ++i)
            index += lines[i].length + newlineLength;

        return index + pos.column;
    };

}).call(Document.prototype);

exports.Document = Document;
});

ace.define("ace/background_tokenizer",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"], function(require, exports, module) {
"use strict";

var oop = require("./lib/oop");
var EventEmitter = require("./lib/event_emitter").EventEmitter;

var BackgroundTokenizer = function(tokenizer, editor) {
    this.running = false;
    this.lines = [];
    this.states = [];
    this.currentLine = 0;
    this.tokenizer = tokenizer;

    var self = this;

    this.$worker = function() {
        if (!self.running) { return; }

        var workerStart = new Date();
        var currentLine = self.currentLine;
        var endLine = -1;
        var doc = self.doc;

        var startLine = currentLine;
        while (self.lines[currentLine])
            currentLine++;
        
        var len = doc.getLength();
        var processedLines = 0;
        self.running = false;
        while (currentLine < len) {
            self.$tokenizeRow(currentLine);
            endLine = currentLine;
            do {
                currentLine++;
            } while (self.lines[currentLine]);
            processedLines ++;
            if ((processedLines % 5 === 0) && (new Date() - workerStart) > 20) {                
                self.running = setTimeout(self.$worker, 20);
                break;
            }
        }
        self.currentLine = currentLine;
        
        if (endLine == -1)
            endLine = currentLine;
        
        if (startLine <= endLine)
            self.fireUpdateEvent(startLine, endLine);
    };
};

(function(){

    oop.implement(this, EventEmitter);
    this.setTokenizer = function(tokenizer) {
        this.tokenizer = tokenizer;
        this.lines = [];
        this.states = [];

        this.start(0);
    };
    this.setDocument = function(doc) {
        this.doc = doc;
        this.lines = [];
        this.states = [];

        this.stop();
    };
    this.fireUpdateEvent = function(firstRow, lastRow) {
        var data = {
            first: firstRow,
            last: lastRow
        };
        this._signal("update", {data: data});
    };
    this.start = function(startRow) {
        this.currentLine = Math.min(startRow || 0, this.currentLine, this.doc.getLength());
        this.lines.splice(this.currentLine, this.lines.length);
        this.states.splice(this.currentLine, this.states.length);

        this.stop();
        this.running = setTimeout(this.$worker, 700);
    };
    
    this.scheduleStart = function() {
        if (!this.running)
            this.running = setTimeout(this.$worker, 700);
    };

    this.$updateOnChange = function(delta) {
        var startRow = delta.start.row;
        var len = delta.end.row - startRow;

        if (len === 0) {
            this.lines[startRow] = null;
        } else if (delta.action == "remove") {
            this.lines.splice(startRow, len + 1, null);
            this.states.splice(startRow, len + 1, null);
        } else {
            var args = Array(len + 1);
            args.unshift(startRow, 1);
            this.lines.splice.apply(this.lines, args);
            this.states.splice.apply(this.states, args);
        }

        this.currentLine = Math.min(startRow, this.currentLine, this.doc.getLength());

        this.stop();
    };
    this.stop = function() {
        if (this.running)
            clearTimeout(this.running);
        this.running = false;
    };
    this.getTokens = function(row) {
        return this.lines[row] || this.$tokenizeRow(row);
    };
    this.getState = function(row) {
        if (this.currentLine == row)
            this.$tokenizeRow(row);
        return this.states[row] || "start";
    };

    this.$tokenizeRow = function(row) {
        var line = this.doc.getLine(row);
        var state = this.states[row - 1];

        var data = this.tokenizer.getLineTokens(line, state, row);

        if (this.states[row] + "" !== data.state + "") {
            this.states[row] = data.state;
            this.lines[row + 1] = null;
            if (this.currentLine > row + 1)
                this.currentLine = row + 1;
        } else if (this.currentLine == row) {
            this.currentLine = row + 1;
        }

        return this.lines[row] = data.tokens;
    };

}).call(BackgroundTokenizer.prototype);

exports.BackgroundTokenizer = BackgroundTokenizer;
});

ace.define("ace/search_highlight",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/range"], function(require, exports, module) {
"use strict";

var lang = require("./lib/lang");
var oop = require("./lib/oop");
var Range = require("./range").Range;

var SearchHighlight = function(regExp, clazz, type) {
    this.setRegexp(regExp);
    this.clazz = clazz;
    this.type = type || "text";
};

(function() {
    this.MAX_RANGES = 500;
    
    this.setRegexp = function(regExp) {
        if (this.regExp+"" == regExp+"")
            return;
        this.regExp = regExp;
        this.cache = [];
    };

    this.update = function(html, markerLayer, session, config) {
        if (!this.regExp)
            return;
        var start = config.firstRow, end = config.lastRow;

        for (var i = start; i <= end; i++) {
            var ranges = this.cache[i];
            if (ranges == null) {
                ranges = lang.getMatchOffsets(session.getLine(i), this.regExp);
                if (ranges.length > this.MAX_RANGES)
                    ranges = ranges.slice(0, this.MAX_RANGES);
                ranges = ranges.map(function(match) {
                    return new Range(i, match.offset, i, match.offset + match.length);
                });
                this.cache[i] = ranges.length ? ranges : "";
            }

            for (var j = ranges.length; j --; ) {
                markerLayer.drawSingleLineMarker(
                    html, ranges[j].toScreenRange(session), this.clazz, config);
            }
        }
    };

}).call(SearchHighlight.prototype);

exports.SearchHighlight = SearchHighlight;
});

ace.define("ace/edit_session/fold_line",["require","exports","module","ace/range"], function(require, exports, module) {
"use strict";

var Range = require("../range").Range;
function FoldLine(foldData, folds) {
    this.foldData = foldData;
    if (Array.isArray(folds)) {
        this.folds = folds;
    } else {
        folds = this.folds = [ folds ];
    }

    var last = folds[folds.length - 1];
    this.range = new Range(folds[0].start.row, folds[0].start.column,
                           last.end.row, last.end.column);
    this.start = this.range.start;
    this.end   = this.range.end;

    this.folds.forEach(function(fold) {
        fold.setFoldLine(this);
    }, this);
}

(function() {
    this.shiftRow = function(shift) {
        this.start.row += shift;
        this.end.row += shift;
        this.folds.forEach(function(fold) {
            fold.start.row += shift;
            fold.end.row += shift;
        });
    };

    this.addFold = function(fold) {
        if (fold.sameRow) {
            if (fold.start.row < this.startRow || fold.endRow > this.endRow) {
                throw new Error("Can't add a fold to this FoldLine as it has no connection");
            }
            this.folds.push(fold);
            this.folds.sort(function(a, b) {
                return -a.range.compareEnd(b.start.row, b.start.column);
            });
            if (this.range.compareEnd(fold.start.row, fold.start.column) > 0) {
                this.end.row = fold.end.row;
                this.end.column =  fold.end.column;
            } else if (this.range.compareStart(fold.end.row, fold.end.column) < 0) {
                this.start.row = fold.start.row;
                this.start.column = fold.start.column;
            }
        } else if (fold.start.row == this.end.row) {
            this.folds.push(fold);
            this.end.row = fold.end.row;
            this.end.column = fold.end.column;
        } else if (fold.end.row == this.start.row) {
            this.folds.unshift(fold);
            this.start.row = fold.start.row;
            this.start.column = fold.start.column;
        } else {
            throw new Error("Trying to add fold to FoldRow that doesn't have a matching row");
        }
        fold.foldLine = this;
    };

    this.containsRow = function(row) {
        return row >= this.start.row && row <= this.end.row;
    };

    this.walk = function(callback, endRow, endColumn) {
        var lastEnd = 0,
            folds = this.folds,
            fold,
            cmp, stop, isNewRow = true;

        if (endRow == null) {
            endRow = this.end.row;
            endColumn = this.end.column;
        }

        for (var i = 0; i < folds.length; i++) {
            fold = folds[i];

            cmp = fold.range.compareStart(endRow, endColumn);
            if (cmp == -1) {
                callback(null, endRow, endColumn, lastEnd, isNewRow);
                return;
            }

            stop = callback(null, fold.start.row, fold.start.column, lastEnd, isNewRow);
            stop = !stop && callback(fold.placeholder, fold.start.row, fold.start.column, lastEnd);
            if (stop || cmp === 0) {
                return;
            }
            isNewRow = !fold.sameRow;
            lastEnd = fold.end.column;
        }
        callback(null, endRow, endColumn, lastEnd, isNewRow);
    };

    this.getNextFoldTo = function(row, column) {
        var fold, cmp;
        for (var i = 0; i < this.folds.length; i++) {
            fold = this.folds[i];
            cmp = fold.range.compareEnd(row, column);
            if (cmp == -1) {
                return {
                    fold: fold,
                    kind: "after"
                };
            } else if (cmp === 0) {
                return {
                    fold: fold,
                    kind: "inside"
                };
            }
        }
        return null;
    };

    this.addRemoveChars = function(row, column, len) {
        var ret = this.getNextFoldTo(row, column),
            fold, folds;
        if (ret) {
            fold = ret.fold;
            if (ret.kind == "inside"
                && fold.start.column != column
                && fold.start.row != row)
            {
                window.console && window.console.log(row, column, fold);
            } else if (fold.start.row == row) {
                folds = this.folds;
                var i = folds.indexOf(fold);
                if (i === 0) {
                    this.start.column += len;
                }
                for (i; i < folds.length; i++) {
                    fold = folds[i];
                    fold.start.column += len;
                    if (!fold.sameRow) {
                        return;
                    }
                    fold.end.column += len;
                }
                this.end.column += len;
            }
        }
    };

    this.split = function(row, column) {
        var pos = this.getNextFoldTo(row, column);
        
        if (!pos || pos.kind == "inside")
            return null;
            
        var fold = pos.fold;
        var folds = this.folds;
        var foldData = this.foldData;
        
        var i = folds.indexOf(fold);
        var foldBefore = folds[i - 1];
        this.end.row = foldBefore.end.row;
        this.end.column = foldBefore.end.column;
        folds = folds.splice(i, folds.length - i);

        var newFoldLine = new FoldLine(foldData, folds);
        foldData.splice(foldData.indexOf(this) + 1, 0, newFoldLine);
        return newFoldLine;
    };

    this.merge = function(foldLineNext) {
        var folds = foldLineNext.folds;
        for (var i = 0; i < folds.length; i++) {
            this.addFold(folds[i]);
        }
        var foldData = this.foldData;
        foldData.splice(foldData.indexOf(foldLineNext), 1);
    };

    this.toString = function() {
        var ret = [this.range.toString() + ": [" ];

        this.folds.forEach(function(fold) {
            ret.push("  " + fold.toString());
        });
        ret.push("]");
        return ret.join("\n");
    };

    this.idxToPosition = function(idx) {
        var lastFoldEndColumn = 0;

        for (var i = 0; i < this.folds.length; i++) {
            var fold = this.folds[i];

            idx -= fold.start.column - lastFoldEndColumn;
            if (idx < 0) {
                return {
                    row: fold.start.row,
                    column: fold.start.column + idx
                };
            }

            idx -= fold.placeholder.length;
            if (idx < 0) {
                return fold.start;
            }

            lastFoldEndColumn = fold.end.column;
        }

        return {
            row: this.end.row,
            column: this.end.column + idx
        };
    };
}).call(FoldLine.prototype);

exports.FoldLine = FoldLine;
});

ace.define("ace/range_list",["require","exports","module","ace/range"], function(require, exports, module) {
"use strict";
var Range = require("./range").Range;
var comparePoints = Range.comparePoints;

var RangeList = function() {
    this.ranges = [];
};

(function() {
    this.comparePoints = comparePoints;

    this.pointIndex = function(pos, excludeEdges, startIndex) {
        var list = this.ranges;

        for (var i = startIndex || 0; i < list.length; i++) {
            var range = list[i];
            var cmpEnd = comparePoints(pos, range.end);
            if (cmpEnd > 0)
                continue;
            var cmpStart = comparePoints(pos, range.start);
            if (cmpEnd === 0)
                return excludeEdges && cmpStart !== 0 ? -i-2 : i;
            if (cmpStart > 0 || (cmpStart === 0 && !excludeEdges))
                return i;

            return -i-1;
        }
        return -i - 1;
    };

    this.add = function(range) {
        var excludeEdges = !range.isEmpty();
        var startIndex = this.pointIndex(range.start, excludeEdges);
        if (startIndex < 0)
            startIndex = -startIndex - 1;

        var endIndex = this.pointIndex(range.end, excludeEdges, startIndex);

        if (endIndex < 0)
            endIndex = -endIndex - 1;
        else
            endIndex++;
        return this.ranges.splice(startIndex, endIndex - startIndex, range);
    };

    this.addList = function(list) {
        var removed = [];
        for (var i = list.length; i--; ) {
            removed.push.apply(removed, this.add(list[i]));
        }
        return removed;
    };

    this.substractPoint = function(pos) {
        var i = this.pointIndex(pos);

        if (i >= 0)
            return this.ranges.splice(i, 1);
    };
    this.merge = function() {
        var removed = [];
        var list = this.ranges;
        
        list = list.sort(function(a, b) {
            return comparePoints(a.start, b.start);
        });
        
        var next = list[0], range;
        for (var i = 1; i < list.length; i++) {
            range = next;
            next = list[i];
            var cmp = comparePoints(range.end, next.start);
            if (cmp < 0)
                continue;

            if (cmp == 0 && !range.isEmpty() && !next.isEmpty())
                continue;

            if (comparePoints(range.end, next.end) < 0) {
                range.end.row = next.end.row;
                range.end.column = next.end.column;
            }

            list.splice(i, 1);
            removed.push(next);
            next = range;
            i--;
        }
        
        this.ranges = list;

        return removed;
    };

    this.contains = function(row, column) {
        return this.pointIndex({row: row, column: column}) >= 0;
    };

    this.containsPoint = function(pos) {
        return this.pointIndex(pos) >= 0;
    };

    this.rangeAtPoint = function(pos) {
        var i = this.pointIndex(pos);
        if (i >= 0)
            return this.ranges[i];
    };


    this.clipRows = function(startRow, endRow) {
        var list = this.ranges;
        if (list[0].start.row > endRow || list[list.length - 1].start.row < startRow)
            return [];

        var startIndex = this.pointIndex({row: startRow, column: 0});
        if (startIndex < 0)
            startIndex = -startIndex - 1;
        var endIndex = this.pointIndex({row: endRow, column: 0}, startIndex);
        if (endIndex < 0)
            endIndex = -endIndex - 1;

        var clipped = [];
        for (var i = startIndex; i < endIndex; i++) {
            clipped.push(list[i]);
        }
        return clipped;
    };

    this.removeAll = function() {
        return this.ranges.splice(0, this.ranges.length);
    };

    this.attach = function(session) {
        if (this.session)
            this.detach();

        this.session = session;
        this.onChange = this.$onChange.bind(this);

        this.session.on('change', this.onChange);
    };

    this.detach = function() {
        if (!this.session)
            return;
        this.session.removeListener('change', this.onChange);
        this.session = null;
    };

    this.$onChange = function(delta) {
        if (delta.action == "insert"){
            var start = delta.start;
            var end = delta.end;
        } else {
            var end = delta.start;
            var start = delta.end;
        }
        var startRow = start.row;
        var endRow = end.row;
        var lineDif = endRow - startRow;

        var colDiff = -start.column + end.column;
        var ranges = this.ranges;

        for (var i = 0, n = ranges.length; i < n; i++) {
            var r = ranges[i];
            if (r.end.row < startRow)
                continue;
            if (r.start.row > startRow)
                break;

            if (r.start.row == startRow && r.start.column >= start.column ) {
                if (r.start.column == start.column && this.$insertRight) {
                } else {
                    r.start.column += colDiff;
                    r.start.row += lineDif;
                }
            }
            if (r.end.row == startRow && r.end.column >= start.column) {
                if (r.end.column == start.column && this.$insertRight) {
                    continue;
                }
                if (r.end.column == start.column && colDiff > 0 && i < n - 1) {                
                    if (r.end.column > r.start.column && r.end.column == ranges[i+1].start.column)
                        r.end.column -= colDiff;
                }
                r.end.column += colDiff;
                r.end.row += lineDif;
            }
        }

        if (lineDif != 0 && i < n) {
            for (; i < n; i++) {
                var r = ranges[i];
                r.start.row += lineDif;
                r.end.row += lineDif;
            }
        }
    };

}).call(RangeList.prototype);

exports.RangeList = RangeList;
});

ace.define("ace/edit_session/fold",["require","exports","module","ace/range","ace/range_list","ace/lib/oop"], function(require, exports, module) {
"use strict";

var Range = require("../range").Range;
var RangeList = require("../range_list").RangeList;
var oop = require("../lib/oop");
var Fold = exports.Fold = function(range, placeholder) {
    this.foldLine = null;
    this.placeholder = placeholder;
    this.range = range;
    this.start = range.start;
    this.end = range.end;

    this.sameRow = range.start.row == range.end.row;
    this.subFolds = this.ranges = [];
};

oop.inherits(Fold, RangeList);

(function() {

    this.toString = function() {
        return '"' + this.placeholder + '" ' + this.range.toString();
    };

    this.setFoldLine = function(foldLine) {
        this.foldLine = foldLine;
        this.subFolds.forEach(function(fold) {
            fold.setFoldLine(foldLine);
        });
    };

    this.clone = function() {
        var range = this.range.clone();
        var fold = new Fold(range, this.placeholder);
        this.subFolds.forEach(function(subFold) {
            fold.subFolds.push(subFold.clone());
        });
        fold.collapseChildren = this.collapseChildren;
        return fold;
    };

    this.addSubFold = function(fold) {
        if (this.range.isEqual(fold))
            return;

        if (!this.range.containsRange(fold))
            throw new Error("A fold can't intersect already existing fold" + fold.range + this.range);
        consumeRange(fold, this.start);

        var row = fold.start.row, column = fold.start.column;
        for (var i = 0, cmp = -1; i < this.subFolds.length; i++) {
            cmp = this.subFolds[i].range.compare(row, column);
            if (cmp != 1)
                break;
        }
        var afterStart = this.subFolds[i];

        if (cmp == 0)
            return afterStart.addSubFold(fold);
        var row = fold.range.end.row, column = fold.range.end.column;
        for (var j = i, cmp = -1; j < this.subFolds.length; j++) {
            cmp = this.subFolds[j].range.compare(row, column);
            if (cmp != 1)
                break;
        }
        var afterEnd = this.subFolds[j];

        if (cmp == 0)
            throw new Error("A fold can't intersect already existing fold" + fold.range + this.range);

        var consumedFolds = this.subFolds.splice(i, j - i, fold);
        fold.setFoldLine(this.foldLine);

        return fold;
    };
    
    this.restoreRange = function(range) {
        return restoreRange(range, this.start);
    };

}).call(Fold.prototype);

function consumePoint(point, anchor) {
    point.row -= anchor.row;
    if (point.row == 0)
        point.column -= anchor.column;
}
function consumeRange(range, anchor) {
    consumePoint(range.start, anchor);
    consumePoint(range.end, anchor);
}
function restorePoint(point, anchor) {
    if (point.row == 0)
        point.column += anchor.column;
    point.row += anchor.row;
}
function restoreRange(range, anchor) {
    restorePoint(range.start, anchor);
    restorePoint(range.end, anchor);
}

});

ace.define("ace/edit_session/folding",["require","exports","module","ace/range","ace/edit_session/fold_line","ace/edit_session/fold","ace/token_iterator"], function(require, exports, module) {
"use strict";

var Range = require("../range").Range;
var FoldLine = require("./fold_line").FoldLine;
var Fold = require("./fold").Fold;
var TokenIterator = require("../token_iterator").TokenIterator;

function Folding() {
    this.getFoldAt = function(row, column, side) {
        var foldLine = this.getFoldLine(row);
        if (!foldLine)
            return null;

        var folds = foldLine.folds;
        for (var i = 0; i < folds.length; i++) {
            var fold = folds[i];
            if (fold.range.contains(row, column)) {
                if (side == 1 && fold.range.isEnd(row, column)) {
                    continue;
                } else if (side == -1 && fold.range.isStart(row, column)) {
                    continue;
                }
                return fold;
            }
        }
    };
    this.getFoldsInRange = function(range) {
        var start = range.start;
        var end = range.end;
        var foldLines = this.$foldData;
        var foundFolds = [];

        start.column += 1;
        end.column -= 1;

        for (var i = 0; i < foldLines.length; i++) {
            var cmp = foldLines[i].range.compareRange(range);
            if (cmp == 2) {
                continue;
            }
            else if (cmp == -2) {
                break;
            }

            var folds = foldLines[i].folds;
            for (var j = 0; j < folds.length; j++) {
                var fold = folds[j];
                cmp = fold.range.compareRange(range);
                if (cmp == -2) {
                    break;
                } else if (cmp == 2) {
                    continue;
                } else
                if (cmp == 42) {
                    break;
                }
                foundFolds.push(fold);
            }
        }
        start.column -= 1;
        end.column += 1;

        return foundFolds;
    };

    this.getFoldsInRangeList = function(ranges) {
        if (Array.isArray(ranges)) {
            var folds = [];
            ranges.forEach(function(range) {
                folds = folds.concat(this.getFoldsInRange(range));
            }, this);
        } else {
            var folds = this.getFoldsInRange(ranges);
        }
        return folds;
    };
    this.getAllFolds = function() {
        var folds = [];
        var foldLines = this.$foldData;
        
        for (var i = 0; i < foldLines.length; i++)
            for (var j = 0; j < foldLines[i].folds.length; j++)
                folds.push(foldLines[i].folds[j]);

        return folds;
    };
    this.getFoldStringAt = function(row, column, trim, foldLine) {
        foldLine = foldLine || this.getFoldLine(row);
        if (!foldLine)
            return null;

        var lastFold = {
            end: { column: 0 }
        };
        var str, fold;
        for (var i = 0; i < foldLine.folds.length; i++) {
            fold = foldLine.folds[i];
            var cmp = fold.range.compareEnd(row, column);
            if (cmp == -1) {
                str = this
                    .getLine(fold.start.row)
                    .substring(lastFold.end.column, fold.start.column);
                break;
            }
            else if (cmp === 0) {
                return null;
            }
            lastFold = fold;
        }
        if (!str)
            str = this.getLine(fold.start.row).substring(lastFold.end.column);

        if (trim == -1)
            return str.substring(0, column - lastFold.end.column);
        else if (trim == 1)
            return str.substring(column - lastFold.end.column);
        else
            return str;
    };

    this.getFoldLine = function(docRow, startFoldLine) {
        var foldData = this.$foldData;
        var i = 0;
        if (startFoldLine)
            i = foldData.indexOf(startFoldLine);
        if (i == -1)
            i = 0;
        for (i; i < foldData.length; i++) {
            var foldLine = foldData[i];
            if (foldLine.start.row <= docRow && foldLine.end.row >= docRow) {
                return foldLine;
            } else if (foldLine.end.row > docRow) {
                return null;
            }
        }
        return null;
    };
    this.getNextFoldLine = function(docRow, startFoldLine) {
        var foldData = this.$foldData;
        var i = 0;
        if (startFoldLine)
            i = foldData.indexOf(startFoldLine);
        if (i == -1)
            i = 0;
        for (i; i < foldData.length; i++) {
            var foldLine = foldData[i];
            if (foldLine.end.row >= docRow) {
                return foldLine;
            }
        }
        return null;
    };

    this.getFoldedRowCount = function(first, last) {
        var foldData = this.$foldData, rowCount = last-first+1;
        for (var i = 0; i < foldData.length; i++) {
            var foldLine = foldData[i],
                end = foldLine.end.row,
                start = foldLine.start.row;
            if (end >= last) {
                if (start < last) {
                    if (start >= first)
                        rowCount -= last-start;
                    else
                        rowCount = 0; // in one fold
                }
                break;
            } else if (end >= first){
                if (start >= first) // fold inside range
                    rowCount -=  end-start;
                else
                    rowCount -=  end-first+1;
            }
        }
        return rowCount;
    };

    this.$addFoldLine = function(foldLine) {
        this.$foldData.push(foldLine);
        this.$foldData.sort(function(a, b) {
            return a.start.row - b.start.row;
        });
        return foldLine;
    };
    this.addFold = function(placeholder, range) {
        var foldData = this.$foldData;
        var added = false;
        var fold;
        
        if (placeholder instanceof Fold)
            fold = placeholder;
        else {
            fold = new Fold(range, placeholder);
            fold.collapseChildren = range.collapseChildren;
        }
        this.$clipRangeToDocument(fold.range);

        var startRow = fold.start.row;
        var startColumn = fold.start.column;
        var endRow = fold.end.row;
        var endColumn = fold.end.column;
        if (!(startRow < endRow || 
            startRow == endRow && startColumn <= endColumn - 2))
            throw new Error("The range has to be at least 2 characters width");

        var startFold = this.getFoldAt(startRow, startColumn, 1);
        var endFold = this.getFoldAt(endRow, endColumn, -1);
        if (startFold && endFold == startFold)
            return startFold.addSubFold(fold);

        if (startFold && !startFold.range.isStart(startRow, startColumn))
            this.removeFold(startFold);
        
        if (endFold && !endFold.range.isEnd(endRow, endColumn))
            this.removeFold(endFold);
        var folds = this.getFoldsInRange(fold.range);
        if (folds.length > 0) {
            this.removeFolds(folds);
            folds.forEach(function(subFold) {
                fold.addSubFold(subFold);
            });
        }

        for (var i = 0; i < foldData.length; i++) {
            var foldLine = foldData[i];
            if (endRow == foldLine.start.row) {
                foldLine.addFold(fold);
                added = true;
                break;
            } else if (startRow == foldLine.end.row) {
                foldLine.addFold(fold);
                added = true;
                if (!fold.sameRow) {
                    var foldLineNext = foldData[i + 1];
                    if (foldLineNext && foldLineNext.start.row == endRow) {
                        foldLine.merge(foldLineNext);
                        break;
                    }
                }
                break;
            } else if (endRow <= foldLine.start.row) {
                break;
            }
        }

        if (!added)
            foldLine = this.$addFoldLine(new FoldLine(this.$foldData, fold));

        if (this.$useWrapMode)
            this.$updateWrapData(foldLine.start.row, foldLine.start.row);
        else
            this.$updateRowLengthCache(foldLine.start.row, foldLine.start.row);
        this.$modified = true;
        this._signal("changeFold", { data: fold, action: "add" });

        return fold;
    };

    this.addFolds = function(folds) {
        folds.forEach(function(fold) {
            this.addFold(fold);
        }, this);
    };

    this.removeFold = function(fold) {
        var foldLine = fold.foldLine;
        var startRow = foldLine.start.row;
        var endRow = foldLine.end.row;

        var foldLines = this.$foldData;
        var folds = foldLine.folds;
        if (folds.length == 1) {
            foldLines.splice(foldLines.indexOf(foldLine), 1);
        } else
        if (foldLine.range.isEnd(fold.end.row, fold.end.column)) {
            folds.pop();
            foldLine.end.row = folds[folds.length - 1].end.row;
            foldLine.end.column = folds[folds.length - 1].end.column;
        } else
        if (foldLine.range.isStart(fold.start.row, fold.start.column)) {
            folds.shift();
            foldLine.start.row = folds[0].start.row;
            foldLine.start.column = folds[0].start.column;
        } else
        if (fold.sameRow) {
            folds.splice(folds.indexOf(fold), 1);
        } else
        {
            var newFoldLine = foldLine.split(fold.start.row, fold.start.column);
            folds = newFoldLine.folds;
            folds.shift();
            newFoldLine.start.row = folds[0].start.row;
            newFoldLine.start.column = folds[0].start.column;
        }

        if (!this.$updating) {
            if (this.$useWrapMode)
                this.$updateWrapData(startRow, endRow);
            else
                this.$updateRowLengthCache(startRow, endRow);
        }
        this.$modified = true;
        this._signal("changeFold", { data: fold, action: "remove" });
    };

    this.removeFolds = function(folds) {
        var cloneFolds = [];
        for (var i = 0; i < folds.length; i++) {
            cloneFolds.push(folds[i]);
        }

        cloneFolds.forEach(function(fold) {
            this.removeFold(fold);
        }, this);
        this.$modified = true;
    };

    this.expandFold = function(fold) {
        this.removeFold(fold);
        fold.subFolds.forEach(function(subFold) {
            fold.restoreRange(subFold);
            this.addFold(subFold);
        }, this);
        if (fold.collapseChildren > 0) {
            this.foldAll(fold.start.row+1, fold.end.row, fold.collapseChildren-1);
        }
        fold.subFolds = [];
    };

    this.expandFolds = function(folds) {
        folds.forEach(function(fold) {
            this.expandFold(fold);
        }, this);
    };

    this.unfold = function(location, expandInner) {
        var range, folds;
        if (location == null) {
            range = new Range(0, 0, this.getLength(), 0);
            expandInner = true;
        } else if (typeof location == "number")
            range = new Range(location, 0, location, this.getLine(location).length);
        else if ("row" in location)
            range = Range.fromPoints(location, location);
        else
            range = location;
        
        folds = this.getFoldsInRangeList(range);
        if (expandInner) {
            this.removeFolds(folds);
        } else {
            var subFolds = folds;
            while (subFolds.length) {
                this.expandFolds(subFolds);
                subFolds = this.getFoldsInRangeList(range);
            }
        }
        if (folds.length)
            return folds;
    };
    this.isRowFolded = function(docRow, startFoldRow) {
        return !!this.getFoldLine(docRow, startFoldRow);
    };

    this.getRowFoldEnd = function(docRow, startFoldRow) {
        var foldLine = this.getFoldLine(docRow, startFoldRow);
        return foldLine ? foldLine.end.row : docRow;
    };

    this.getRowFoldStart = function(docRow, startFoldRow) {
        var foldLine = this.getFoldLine(docRow, startFoldRow);
        return foldLine ? foldLine.start.row : docRow;
    };

    this.getFoldDisplayLine = function(foldLine, endRow, endColumn, startRow, startColumn) {
        if (startRow == null)
            startRow = foldLine.start.row;
        if (startColumn == null)
            startColumn = 0;
        if (endRow == null)
            endRow = foldLine.end.row;
        if (endColumn == null)
            endColumn = this.getLine(endRow).length;
        var doc = this.doc;
        var textLine = "";

        foldLine.walk(function(placeholder, row, column, lastColumn) {
            if (row < startRow)
                return;
            if (row == startRow) {
                if (column < startColumn)
                    return;
                lastColumn = Math.max(startColumn, lastColumn);
            }

            if (placeholder != null) {
                textLine += placeholder;
            } else {
                textLine += doc.getLine(row).substring(lastColumn, column);
            }
        }, endRow, endColumn);
        return textLine;
    };

    this.getDisplayLine = function(row, endColumn, startRow, startColumn) {
        var foldLine = this.getFoldLine(row);

        if (!foldLine) {
            var line;
            line = this.doc.getLine(row);
            return line.substring(startColumn || 0, endColumn || line.length);
        } else {
            return this.getFoldDisplayLine(
                foldLine, row, endColumn, startRow, startColumn);
        }
    };

    this.$cloneFoldData = function() {
        var fd = [];
        fd = this.$foldData.map(function(foldLine) {
            var folds = foldLine.folds.map(function(fold) {
                return fold.clone();
            });
            return new FoldLine(fd, folds);
        });

        return fd;
    };

    this.toggleFold = function(tryToUnfold) {
        var selection = this.selection;
        var range = selection.getRange();
        var fold;
        var bracketPos;

        if (range.isEmpty()) {
            var cursor = range.start;
            fold = this.getFoldAt(cursor.row, cursor.column);

            if (fold) {
                this.expandFold(fold);
                return;
            } else if (bracketPos = this.findMatchingBracket(cursor)) {
                if (range.comparePoint(bracketPos) == 1) {
                    range.end = bracketPos;
                } else {
                    range.start = bracketPos;
                    range.start.column++;
                    range.end.column--;
                }
            } else if (bracketPos = this.findMatchingBracket({row: cursor.row, column: cursor.column + 1})) {
                if (range.comparePoint(bracketPos) == 1)
                    range.end = bracketPos;
                else
                    range.start = bracketPos;

                range.start.column++;
            } else {
                range = this.getCommentFoldRange(cursor.row, cursor.column) || range;
            }
        } else {
            var folds = this.getFoldsInRange(range);
            if (tryToUnfold && folds.length) {
                this.expandFolds(folds);
                return;
            } else if (folds.length == 1 ) {
                fold = folds[0];
            }
        }

        if (!fold)
            fold = this.getFoldAt(range.start.row, range.start.column);

        if (fold && fold.range.toString() == range.toString()) {
            this.expandFold(fold);
            return;
        }

        var placeholder = "...";
        if (!range.isMultiLine()) {
            placeholder = this.getTextRange(range);
            if (placeholder.length < 4)
                return;
            placeholder = placeholder.trim().substring(0, 2) + "..";
        }

        this.addFold(placeholder, range);
    };

    this.getCommentFoldRange = function(row, column, dir) {
        var iterator = new TokenIterator(this, row, column);
        var token = iterator.getCurrentToken();
        var type = token.type;
        if (token && /^comment|string/.test(type)) {
            type = type.match(/comment|string/)[0];
            if (type == "comment")
                type += "|doc-start";
            var re = new RegExp(type);
            var range = new Range();
            if (dir != 1) {
                do {
                    token = iterator.stepBackward();
                } while (token && re.test(token.type));
                iterator.stepForward();
            }
            
            range.start.row = iterator.getCurrentTokenRow();
            range.start.column = iterator.getCurrentTokenColumn() + 2;

            iterator = new TokenIterator(this, row, column);
            
            if (dir != -1) {
                var lastRow = -1;
                do {
                    token = iterator.stepForward();
                    if (lastRow == -1) {
                        var state = this.getState(iterator.$row);
                        if (!re.test(state))
                            lastRow = iterator.$row;
                    } else if (iterator.$row > lastRow) {
                        break;
                    }
                } while (token && re.test(token.type));
                token = iterator.stepBackward();
            } else
                token = iterator.getCurrentToken();

            range.end.row = iterator.getCurrentTokenRow();
            range.end.column = iterator.getCurrentTokenColumn() + token.value.length - 2;
            return range;
        }
    };

    this.foldAll = function(startRow, endRow, depth) {
        if (depth == undefined)
            depth = 100000; // JSON.stringify doesn't hanle Infinity
        var foldWidgets = this.foldWidgets;
        if (!foldWidgets)
            return; // mode doesn't support folding
        endRow = endRow || this.getLength();
        startRow = startRow || 0;
        for (var row = startRow; row < endRow; row++) {
            if (foldWidgets[row] == null)
                foldWidgets[row] = this.getFoldWidget(row);
            if (foldWidgets[row] != "start")
                continue;

            var range = this.getFoldWidgetRange(row);
            if (range && range.isMultiLine()
                && range.end.row <= endRow
                && range.start.row >= startRow
            ) {
                row = range.end.row;
                try {
                    var fold = this.addFold("...", range);
                    if (fold)
                        fold.collapseChildren = depth;
                } catch(e) {}
            }
        }
    };
    this.$foldStyles = {
        "manual": 1,
        "markbegin": 1,
        "markbeginend": 1
    };
    this.$foldStyle = "markbegin";
    this.setFoldStyle = function(style) {
        if (!this.$foldStyles[style])
            throw new Error("invalid fold style: " + style + "[" + Object.keys(this.$foldStyles).join(", ") + "]");
        
        if (this.$foldStyle == style)
            return;

        this.$foldStyle = style;
        
        if (style == "manual")
            this.unfold();
        var mode = this.$foldMode;
        this.$setFolding(null);
        this.$setFolding(mode);
    };

    this.$setFolding = function(foldMode) {
        if (this.$foldMode == foldMode)
            return;
            
        this.$foldMode = foldMode;
        
        this.off('change', this.$updateFoldWidgets);
        this.off('tokenizerUpdate', this.$tokenizerUpdateFoldWidgets);
        this._signal("changeAnnotation");
        
        if (!foldMode || this.$foldStyle == "manual") {
            this.foldWidgets = null;
            return;
        }
        
        this.foldWidgets = [];
        this.getFoldWidget = foldMode.getFoldWidget.bind(foldMode, this, this.$foldStyle);
        this.getFoldWidgetRange = foldMode.getFoldWidgetRange.bind(foldMode, this, this.$foldStyle);
        
        this.$updateFoldWidgets = this.updateFoldWidgets.bind(this);
        this.$tokenizerUpdateFoldWidgets = this.tokenizerUpdateFoldWidgets.bind(this);
        this.on('change', this.$updateFoldWidgets);
        this.on('tokenizerUpdate', this.$tokenizerUpdateFoldWidgets);
    };

    this.getParentFoldRangeData = function (row, ignoreCurrent) {
        var fw = this.foldWidgets;
        if (!fw || (ignoreCurrent && fw[row]))
            return {};

        var i = row - 1, firstRange;
        while (i >= 0) {
            var c = fw[i];
            if (c == null)
                c = fw[i] = this.getFoldWidget(i);

            if (c == "start") {
                var range = this.getFoldWidgetRange(i);
                if (!firstRange)
                    firstRange = range;
                if (range && range.end.row >= row)
                    break;
            }
            i--;
        }

        return {
            range: i !== -1 && range,
            firstRange: firstRange
        };
    };

    this.onFoldWidgetClick = function(row, e) {
        e = e.domEvent;
        var options = {
            children: e.shiftKey,
            all: e.ctrlKey || e.metaKey,
            siblings: e.altKey
        };
        
        var range = this.$toggleFoldWidget(row, options);
        if (!range) {
            var el = (e.target || e.srcElement);
            if (el && /ace_fold-widget/.test(el.className))
                el.className += " ace_invalid";
        }
    };
    
    this.$toggleFoldWidget = function(row, options) {
        if (!this.getFoldWidget)
            return;
        var type = this.getFoldWidget(row);
        var line = this.getLine(row);

        var dir = type === "end" ? -1 : 1;
        var fold = this.getFoldAt(row, dir === -1 ? 0 : line.length, dir);

        if (fold) {
            if (options.children || options.all)
                this.removeFold(fold);
            else
                this.expandFold(fold);
            return fold;
        }

        var range = this.getFoldWidgetRange(row, true);
        if (range && !range.isMultiLine()) {
            fold = this.getFoldAt(range.start.row, range.start.column, 1);
            if (fold && range.isEqual(fold.range)) {
                this.removeFold(fold);
                return fold;
            }
        }
        
        if (options.siblings) {
            var data = this.getParentFoldRangeData(row);
            if (data.range) {
                var startRow = data.range.start.row + 1;
                var endRow = data.range.end.row;
            }
            this.foldAll(startRow, endRow, options.all ? 10000 : 0);
        } else if (options.children) {
            endRow = range ? range.end.row : this.getLength();
            this.foldAll(row + 1, endRow, options.all ? 10000 : 0);
        } else if (range) {
            if (options.all) 
                range.collapseChildren = 10000;
            this.addFold("...", range);
        }
        
        return range;
    };
    
    
    
    this.toggleFoldWidget = function(toggleParent) {
        var row = this.selection.getCursor().row;
        row = this.getRowFoldStart(row);
        var range = this.$toggleFoldWidget(row, {});
        
        if (range)
            return;
        var data = this.getParentFoldRangeData(row, true);
        range = data.range || data.firstRange;
        
        if (range) {
            row = range.start.row;
            var fold = this.getFoldAt(row, this.getLine(row).length, 1);

            if (fold) {
                this.removeFold(fold);
            } else {
                this.addFold("...", range);
            }
        }
    };

    this.updateFoldWidgets = function(delta) {
        var firstRow = delta.start.row;
        var len = delta.end.row - firstRow;

        if (len === 0) {
            this.foldWidgets[firstRow] = null;
        } else if (delta.action == 'remove') {
            this.foldWidgets.splice(firstRow, len + 1, null);
        } else {
            var args = Array(len + 1);
            args.unshift(firstRow, 1);
            this.foldWidgets.splice.apply(this.foldWidgets, args);
        }
    };
    this.tokenizerUpdateFoldWidgets = function(e) {
        var rows = e.data;
        if (rows.first != rows.last) {
            if (this.foldWidgets.length > rows.first)
                this.foldWidgets.splice(rows.first, this.foldWidgets.length);
        }
    };
}

exports.Folding = Folding;

});

ace.define("ace/edit_session/bracket_match",["require","exports","module","ace/token_iterator","ace/range"], function(require, exports, module) {
"use strict";

var TokenIterator = require("../token_iterator").TokenIterator;
var Range = require("../range").Range;


function BracketMatch() {

    this.findMatchingBracket = function(position, chr) {
        if (position.column == 0) return null;

        var charBeforeCursor = chr || this.getLine(position.row).charAt(position.column-1);
        if (charBeforeCursor == "") return null;

        var match = charBeforeCursor.match(/([\(\[\{])|([\)\]\}])/);
        if (!match)
            return null;

        if (match[1])
            return this.$findClosingBracket(match[1], position);
        else
            return this.$findOpeningBracket(match[2], position);
    };
    
    this.getBracketRange = function(pos) {
        var line = this.getLine(pos.row);
        var before = true, range;

        var chr = line.charAt(pos.column-1);
        var match = chr && chr.match(/([\(\[\{])|([\)\]\}])/);
        if (!match) {
            chr = line.charAt(pos.column);
            pos = {row: pos.row, column: pos.column + 1};
            match = chr && chr.match(/([\(\[\{])|([\)\]\}])/);
            before = false;
        }
        if (!match)
            return null;

        if (match[1]) {
            var bracketPos = this.$findClosingBracket(match[1], pos);
            if (!bracketPos)
                return null;
            range = Range.fromPoints(pos, bracketPos);
            if (!before) {
                range.end.column++;
                range.start.column--;
            }
            range.cursor = range.end;
        } else {
            var bracketPos = this.$findOpeningBracket(match[2], pos);
            if (!bracketPos)
                return null;
            range = Range.fromPoints(bracketPos, pos);
            if (!before) {
                range.start.column++;
                range.end.column--;
            }
            range.cursor = range.start;
        }
        
        return range;
    };

    this.$brackets = {
        ")": "(",
        "(": ")",
        "]": "[",
        "[": "]",
        "{": "}",
        "}": "{"
    };

    this.$findOpeningBracket = function(bracket, position, typeRe) {
        var openBracket = this.$brackets[bracket];
        var depth = 1;

        var iterator = new TokenIterator(this, position.row, position.column);
        var token = iterator.getCurrentToken();
        if (!token)
            token = iterator.stepForward();
        if (!token)
            return;
        
         if (!typeRe){
            typeRe = new RegExp(
                "(\\.?" +
                token.type.replace(".", "\\.").replace("rparen", ".paren")
                    .replace(/\b(?:end)\b/, "(?:start|begin|end)")
                + ")+"
            );
        }
        var valueIndex = position.column - iterator.getCurrentTokenColumn() - 2;
        var value = token.value;
        
        while (true) {
        
            while (valueIndex >= 0) {
                var chr = value.charAt(valueIndex);
                if (chr == openBracket) {
                    depth -= 1;
                    if (depth == 0) {
                        return {row: iterator.getCurrentTokenRow(),
                            column: valueIndex + iterator.getCurrentTokenColumn()};
                    }
                }
                else if (chr == bracket) {
                    depth += 1;
                }
                valueIndex -= 1;
            }
            do {
                token = iterator.stepBackward();
            } while (token && !typeRe.test(token.type));

            if (token == null)
                break;
                
            value = token.value;
            valueIndex = value.length - 1;
        }
        
        return null;
    };

    this.$findClosingBracket = function(bracket, position, typeRe) {
        var closingBracket = this.$brackets[bracket];
        var depth = 1;

        var iterator = new TokenIterator(this, position.row, position.column);
        var token = iterator.getCurrentToken();
        if (!token)
            token = iterator.stepForward();
        if (!token)
            return;

        if (!typeRe){
            typeRe = new RegExp(
                "(\\.?" +
                token.type.replace(".", "\\.").replace("lparen", ".paren")
                    .replace(/\b(?:start|begin)\b/, "(?:start|begin|end)")
                + ")+"
            );
        }
        var valueIndex = position.column - iterator.getCurrentTokenColumn();

        while (true) {

            var value = token.value;
            var valueLength = value.length;
            while (valueIndex < valueLength) {
                var chr = value.charAt(valueIndex);
                if (chr == closingBracket) {
                    depth -= 1;
                    if (depth == 0) {
                        return {row: iterator.getCurrentTokenRow(),
                            column: valueIndex + iterator.getCurrentTokenColumn()};
                    }
                }
                else if (chr == bracket) {
                    depth += 1;
                }
                valueIndex += 1;
            }
            do {
                token = iterator.stepForward();
            } while (token && !typeRe.test(token.type));

            if (token == null)
                break;

            valueIndex = 0;
        }
        
        return null;
    };
}
exports.BracketMatch = BracketMatch;

});

ace.define("ace/edit_session",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/bidihandler","ace/config","ace/lib/event_emitter","ace/selection","ace/mode/text","ace/range","ace/document","ace/background_tokenizer","ace/search_highlight","ace/edit_session/folding","ace/edit_session/bracket_match"], function(require, exports, module) {
"use strict";

var oop = require("./lib/oop");
var lang = require("./lib/lang");
var BidiHandler = require("./bidihandler").BidiHandler;
var config = require("./config");
var EventEmitter = require("./lib/event_emitter").EventEmitter;
var Selection = require("./selection").Selection;
var TextMode = require("./mode/text").Mode;
var Range = require("./range").Range;
var Document = require("./document").Document;
var BackgroundTokenizer = require("./background_tokenizer").BackgroundTokenizer;
var SearchHighlight = require("./search_highlight").SearchHighlight;

var EditSession = function(text, mode) {
    this.$breakpoints = [];
    this.$decorations = [];
    this.$frontMarkers = {};
    this.$backMarkers = {};
    this.$markerId = 1;
    this.$undoSelect = true;

    this.$foldData = [];
    this.id = "session" + (++EditSession.$uid);
    this.$foldData.toString = function() {
        return this.join("\n");
    };
    this.on("changeFold", this.onChangeFold.bind(this));
    this.$onChange = this.onChange.bind(this);

    if (typeof text != "object" || !text.getLine)
        text = new Document(text);

    this.$bidiHandler = new BidiHandler(this);
    this.setDocument(text);
    this.selection = new Selection(this);

    config.resetOptions(this);
    this.setMode(mode);
    config._signal("session", this);
};


EditSession.$uid = 0;

(function() {

    oop.implement(this, EventEmitter);
    this.setDocument = function(doc) {
        if (this.doc)
            this.doc.removeListener("change", this.$onChange);

        this.doc = doc;
        doc.on("change", this.$onChange);

        if (this.bgTokenizer)
            this.bgTokenizer.setDocument(this.getDocument());

        this.resetCaches();
    };
    this.getDocument = function() {
        return this.doc;
    };
    this.$resetRowCache = function(docRow) {
        if (!docRow) {
            this.$docRowCache = [];
            this.$screenRowCache = [];
            return;
        }
        var l = this.$docRowCache.length;
        var i = this.$getRowCacheIndex(this.$docRowCache, docRow) + 1;
        if (l > i) {
            this.$docRowCache.splice(i, l);
            this.$screenRowCache.splice(i, l);
        }
    };

    this.$getRowCacheIndex = function(cacheArray, val) {
        var low = 0;
        var hi = cacheArray.length - 1;

        while (low <= hi) {
            var mid = (low + hi) >> 1;
            var c = cacheArray[mid];

            if (val > c)
                low = mid + 1;
            else if (val < c)
                hi = mid - 1;
            else
                return mid;
        }

        return low -1;
    };

    this.resetCaches = function() {
        this.$modified = true;
        this.$wrapData = [];
        this.$rowLengthCache = [];
        this.$resetRowCache(0);
        if (this.bgTokenizer)
            this.bgTokenizer.start(0);
    };

    this.onChangeFold = function(e) {
        var fold = e.data;
        this.$resetRowCache(fold.start.row);
    };

    this.onChange = function(delta) {
        this.$modified = true;
        this.$bidiHandler.onChange(delta);
        this.$resetRowCache(delta.start.row);

        var removedFolds = this.$updateInternalDataOnChange(delta);
        if (!this.$fromUndo && this.$undoManager && !delta.ignore) {
            this.$deltasDoc.push(delta);
            if (removedFolds && removedFolds.length != 0) {
                this.$deltasFold.push({
                    action: "removeFolds",
                    folds:  removedFolds
                });
            }

            this.$informUndoManager.schedule();
        }

        this.bgTokenizer && this.bgTokenizer.$updateOnChange(delta);
        this._signal("change", delta);
    };
    this.setValue = function(text) {
        this.doc.setValue(text);
        this.selection.moveTo(0, 0);

        this.$resetRowCache(0);
        this.$deltas = [];
        this.$deltasDoc = [];
        this.$deltasFold = [];
        this.setUndoManager(this.$undoManager);
        this.getUndoManager().reset();
    };
    this.getValue =
    this.toString = function() {
        return this.doc.getValue();
    };
    this.getSelection = function() {
        return this.selection;
    };
    this.getState = function(row) {
        return this.bgTokenizer.getState(row);
    };
    this.getTokens = function(row) {
        return this.bgTokenizer.getTokens(row);
    };
    this.getTokenAt = function(row, column) {
        var tokens = this.bgTokenizer.getTokens(row);
        var token, c = 0;
        if (column == null) {
            var i = tokens.length - 1;
            c = this.getLine(row).length;
        } else {
            for (var i = 0; i < tokens.length; i++) {
                c += tokens[i].value.length;
                if (c >= column)
                    break;
            }
        }
        token = tokens[i];
        if (!token)
            return null;
        token.index = i;
        token.start = c - token.value.length;
        return token;
    };
    this.setUndoManager = function(undoManager) {
        this.$undoManager = undoManager;
        this.$deltas = [];
        this.$deltasDoc = [];
        this.$deltasFold = [];

        if (this.$informUndoManager)
            this.$informUndoManager.cancel();

        if (undoManager) {
            var self = this;

            this.$syncInformUndoManager = function() {
                self.$informUndoManager.cancel();

                if (self.$deltasFold.length) {
                    self.$deltas.push({
                        group: "fold",
                        deltas: self.$deltasFold
                    });
                    self.$deltasFold = [];
                }

                if (self.$deltasDoc.length) {
                    self.$deltas.push({
                        group: "doc",
                        deltas: self.$deltasDoc
                    });
                    self.$deltasDoc = [];
                }

                if (self.$deltas.length > 0) {
                    undoManager.execute({
                        action: "aceupdate",
                        args: [self.$deltas, self],
                        merge: self.mergeUndoDeltas
                    });
                }
                self.mergeUndoDeltas = false;
                self.$deltas = [];
            };
            this.$informUndoManager = lang.delayedCall(this.$syncInformUndoManager);
        }
    };
    this.markUndoGroup = function() {
        if (this.$syncInformUndoManager)
            this.$syncInformUndoManager();
    };
    
    this.$defaultUndoManager = {
        undo: function() {},
        redo: function() {},
        reset: function() {}
    };
    this.getUndoManager = function() {
        return this.$undoManager || this.$defaultUndoManager;
    };
    this.getTabString = function() {
        if (this.getUseSoftTabs()) {
            return lang.stringRepeat(" ", this.getTabSize());
        } else {
            return "\t";
        }
    };
    this.setUseSoftTabs = function(val) {
        this.setOption("useSoftTabs", val);
    };
    this.getUseSoftTabs = function() {
        return this.$useSoftTabs && !this.$mode.$indentWithTabs;
    };
    this.setTabSize = function(tabSize) {
        this.setOption("tabSize", tabSize);
    };
    this.getTabSize = function() {
        return this.$tabSize;
    };
    this.isTabStop = function(position) {
        return this.$useSoftTabs && (position.column % this.$tabSize === 0);
    };
    this.setNavigateWithinSoftTabs = function (navigateWithinSoftTabs) {
        this.setOption("navigateWithinSoftTabs", navigateWithinSoftTabs);
    };
    this.getNavigateWithinSoftTabs = function() {
        return this.$navigateWithinSoftTabs;
    };

    this.$overwrite = false;
    this.setOverwrite = function(overwrite) {
        this.setOption("overwrite", overwrite);
    };
    this.getOverwrite = function() {
        return this.$overwrite;
    };
    this.toggleOverwrite = function() {
        this.setOverwrite(!this.$overwrite);
    };
    this.addGutterDecoration = function(row, className) {
        if (!this.$decorations[row])
            this.$decorations[row] = "";
        this.$decorations[row] += " " + className;
        this._signal("changeBreakpoint", {});
    };
    this.removeGutterDecoration = function(row, className) {
        this.$decorations[row] = (this.$decorations[row] || "").replace(" " + className, "");
        this._signal("changeBreakpoint", {});
    };
    this.getBreakpoints = function() {
        return this.$breakpoints;
    };
    this.setBreakpoints = function(rows) {
        this.$breakpoints = [];
        for (var i=0; i<rows.length; i++) {
            this.$breakpoints[rows[i]] = "ace_breakpoint";
        }
        this._signal("changeBreakpoint", {});
    };
    this.clearBreakpoints = function() {
        this.$breakpoints = [];
        this._signal("changeBreakpoint", {});
    };
    this.setBreakpoint = function(row, className) {
        if (className === undefined)
            className = "ace_breakpoint";
        if (className)
            this.$breakpoints[row] = className;
        else
            delete this.$breakpoints[row];
        this._signal("changeBreakpoint", {});
    };
    this.clearBreakpoint = function(row) {
        delete this.$breakpoints[row];
        this._signal("changeBreakpoint", {});
    };
    this.addMarker = function(range, clazz, type, inFront) {
        var id = this.$markerId++;

        var marker = {
            range : range,
            type : type || "line",
            renderer: typeof type == "function" ? type : null,
            clazz : clazz,
            inFront: !!inFront,
            id: id
        };

        if (inFront) {
            this.$frontMarkers[id] = marker;
            this._signal("changeFrontMarker");
        } else {
            this.$backMarkers[id] = marker;
            this._signal("changeBackMarker");
        }

        return id;
    };
    this.addDynamicMarker = function(marker, inFront) {
        if (!marker.update)
            return;
        var id = this.$markerId++;
        marker.id = id;
        marker.inFront = !!inFront;

        if (inFront) {
            this.$frontMarkers[id] = marker;
            this._signal("changeFrontMarker");
        } else {
            this.$backMarkers[id] = marker;
            this._signal("changeBackMarker");
        }

        return marker;
    };
    this.removeMarker = function(markerId) {
        var marker = this.$frontMarkers[markerId] || this.$backMarkers[markerId];
        if (!marker)
            return;

        var markers = marker.inFront ? this.$frontMarkers : this.$backMarkers;
        if (marker) {
            delete (markers[markerId]);
            this._signal(marker.inFront ? "changeFrontMarker" : "changeBackMarker");
        }
    };
    this.getMarkers = function(inFront) {
        return inFront ? this.$frontMarkers : this.$backMarkers;
    };

    this.highlight = function(re) {
        if (!this.$searchHighlight) {
            var highlight = new SearchHighlight(null, "ace_selected-word", "text");
            this.$searchHighlight = this.addDynamicMarker(highlight);
        }
        this.$searchHighlight.setRegexp(re);
    };
    this.highlightLines = function(startRow, endRow, clazz, inFront) {
        if (typeof endRow != "number") {
            clazz = endRow;
            endRow = startRow;
        }
        if (!clazz)
            clazz = "ace_step";

        var range = new Range(startRow, 0, endRow, Infinity);
        range.id = this.addMarker(range, clazz, "fullLine", inFront);
        return range;
    };
    this.setAnnotations = function(annotations) {
        this.$annotations = annotations;
        this._signal("changeAnnotation", {});
    };
    this.getAnnotations = function() {
        return this.$annotations || [];
    };
    this.clearAnnotations = function() {
        this.setAnnotations([]);
    };
    this.$detectNewLine = function(text) {
        var match = text.match(/^.*?(\r?\n)/m);
        if (match) {
            this.$autoNewLine = match[1];
        } else {
            this.$autoNewLine = "\n";
        }
    };
    this.getWordRange = function(row, column) {
        var line = this.getLine(row);

        var inToken = false;
        if (column > 0)
            inToken = !!line.charAt(column - 1).match(this.tokenRe);

        if (!inToken)
            inToken = !!line.charAt(column).match(this.tokenRe);

        if (inToken)
            var re = this.tokenRe;
        else if (/^\s+$/.test(line.slice(column-1, column+1)))
            var re = /\s/;
        else
            var re = this.nonTokenRe;

        var start = column;
        if (start > 0) {
            do {
                start--;
            }
            while (start >= 0 && line.charAt(start).match(re));
            start++;
        }

        var end = column;
        while (end < line.length && line.charAt(end).match(re)) {
            end++;
        }

        return new Range(row, start, row, end);
    };
    this.getAWordRange = function(row, column) {
        var wordRange = this.getWordRange(row, column);
        var line = this.getLine(wordRange.end.row);

        while (line.charAt(wordRange.end.column).match(/[ \t]/)) {
            wordRange.end.column += 1;
        }
        return wordRange;
    };
    this.setNewLineMode = function(newLineMode) {
        this.doc.setNewLineMode(newLineMode);
    };
    this.getNewLineMode = function() {
        return this.doc.getNewLineMode();
    };
    this.setUseWorker = function(useWorker) { this.setOption("useWorker", useWorker); };
    this.getUseWorker = function() { return this.$useWorker; };
    this.onReloadTokenizer = function(e) {
        var rows = e.data;
        this.bgTokenizer.start(rows.first);
        this._signal("tokenizerUpdate", e);
    };

    this.$modes = {};
    this.$mode = null;
    this.$modeId = null;
    this.setMode = function(mode, cb) {
        if (mode && typeof mode === "object") {
            if (mode.getTokenizer)
                return this.$onChangeMode(mode);
            var options = mode;
            var path = options.path;
        } else {
            path = mode || "ace/mode/text";
        }
        if (!this.$modes["ace/mode/text"])
            this.$modes["ace/mode/text"] = new TextMode();

        if (this.$modes[path] && !options) {
            this.$onChangeMode(this.$modes[path]);
            cb && cb();
            return;
        }
        this.$modeId = path;
        config.loadModule(["mode", path], function(m) {
            if (this.$modeId !== path)
                return cb && cb();
            if (this.$modes[path] && !options) {
                this.$onChangeMode(this.$modes[path]);
            } else if (m && m.Mode) {
                m = new m.Mode(options);
                if (!options) {
                    this.$modes[path] = m;
                    m.$id = path;
                }
                this.$onChangeMode(m);
            }
            cb && cb();
        }.bind(this));
        if (!this.$mode)
            this.$onChangeMode(this.$modes["ace/mode/text"], true);
    };

    this.$onChangeMode = function(mode, $isPlaceholder) {
        if (!$isPlaceholder)
            this.$modeId = mode.$id;
        if (this.$mode === mode) 
            return;

        this.$mode = mode;

        this.$stopWorker();

        if (this.$useWorker)
            this.$startWorker();

        var tokenizer = mode.getTokenizer();

        if(tokenizer.addEventListener !== undefined) {
            var onReloadTokenizer = this.onReloadTokenizer.bind(this);
            tokenizer.addEventListener("update", onReloadTokenizer);
        }

        if (!this.bgTokenizer) {
            this.bgTokenizer = new BackgroundTokenizer(tokenizer);
            var _self = this;
            this.bgTokenizer.addEventListener("update", function(e) {
                _self._signal("tokenizerUpdate", e);
            });
        } else {
            this.bgTokenizer.setTokenizer(tokenizer);
        }

        this.bgTokenizer.setDocument(this.getDocument());

        this.tokenRe = mode.tokenRe;
        this.nonTokenRe = mode.nonTokenRe;

        
        if (!$isPlaceholder) {
            if (mode.attachToSession)
                mode.attachToSession(this);
            this.$options.wrapMethod.set.call(this, this.$wrapMethod);
            this.$setFolding(mode.foldingRules);
            this.bgTokenizer.start(0);
            this._emit("changeMode");
        }
    };

    this.$stopWorker = function() {
        if (this.$worker) {
            this.$worker.terminate();
            this.$worker = null;
        }
    };

    this.$startWorker = function() {
        try {
            this.$worker = this.$mode.createWorker(this);
        } catch (e) {
            config.warn("Could not load worker", e);
            this.$worker = null;
        }
    };
    this.getMode = function() {
        return this.$mode;
    };

    this.$scrollTop = 0;
    this.setScrollTop = function(scrollTop) {
        if (this.$scrollTop === scrollTop || isNaN(scrollTop))
            return;

        this.$scrollTop = scrollTop;
        this._signal("changeScrollTop", scrollTop);
    };
    this.getScrollTop = function() {
        return this.$scrollTop;
    };

    this.$scrollLeft = 0;
    this.setScrollLeft = function(scrollLeft) {
        if (this.$scrollLeft === scrollLeft || isNaN(scrollLeft))
            return;

        this.$scrollLeft = scrollLeft;
        this._signal("changeScrollLeft", scrollLeft);
    };
    this.getScrollLeft = function() {
        return this.$scrollLeft;
    };
    this.getScreenWidth = function() {
        this.$computeWidth();
        if (this.lineWidgets) 
            return Math.max(this.getLineWidgetMaxWidth(), this.screenWidth);
        return this.screenWidth;
    };
    
    this.getLineWidgetMaxWidth = function() {
        if (this.lineWidgetsWidth != null) return this.lineWidgetsWidth;
        var width = 0;
        this.lineWidgets.forEach(function(w) {
            if (w && w.screenWidth > width)
                width = w.screenWidth;
        });
        return this.lineWidgetWidth = width;
    };

    this.$computeWidth = function(force) {
        if (this.$modified || force) {
            this.$modified = false;

            if (this.$useWrapMode)
                return this.screenWidth = this.$wrapLimit;

            var lines = this.doc.getAllLines();
            var cache = this.$rowLengthCache;
            var longestScreenLine = 0;
            var foldIndex = 0;
            var foldLine = this.$foldData[foldIndex];
            var foldStart = foldLine ? foldLine.start.row : Infinity;
            var len = lines.length;

            for (var i = 0; i < len; i++) {
                if (i > foldStart) {
                    i = foldLine.end.row + 1;
                    if (i >= len)
                        break;
                    foldLine = this.$foldData[foldIndex++];
                    foldStart = foldLine ? foldLine.start.row : Infinity;
                }

                if (cache[i] == null)
                    cache[i] = this.$getStringScreenWidth(lines[i])[0];

                if (cache[i] > longestScreenLine)
                    longestScreenLine = cache[i];
            }
            this.screenWidth = longestScreenLine;
        }
    };
    this.getLine = function(row) {
        return this.doc.getLine(row);
    };
    this.getLines = function(firstRow, lastRow) {
        return this.doc.getLines(firstRow, lastRow);
    };
    this.getLength = function() {
        return this.doc.getLength();
    };
    this.getTextRange = function(range) {
        return this.doc.getTextRange(range || this.selection.getRange());
    };
    this.insert = function(position, text) {
        return this.doc.insert(position, text);
    };
    this.remove = function(range) {
        return this.doc.remove(range);
    };
    this.removeFullLines = function(firstRow, lastRow){
        return this.doc.removeFullLines(firstRow, lastRow);
    };
    this.undoChanges = function(deltas, dontSelect) {
        if (!deltas.length)
            return;

        this.$fromUndo = true;
        var lastUndoRange = null;
        for (var i = deltas.length - 1; i != -1; i--) {
            var delta = deltas[i];
            if (delta.group == "doc") {
                this.doc.revertDeltas(delta.deltas);
                lastUndoRange =
                    this.$getUndoSelection(delta.deltas, true, lastUndoRange);
            } else {
                delta.deltas.forEach(function(foldDelta) {
                    this.addFolds(foldDelta.folds);
                }, this);
            }
        }
        this.$fromUndo = false;
        lastUndoRange &&
            this.$undoSelect &&
            !dontSelect &&
            this.selection.setSelectionRange(lastUndoRange);
        return lastUndoRange;
    };
    this.redoChanges = function(deltas, dontSelect) {
        if (!deltas.length)
            return;

        this.$fromUndo = true;
        var lastUndoRange = null;
        for (var i = 0; i < deltas.length; i++) {
            var delta = deltas[i];
            if (delta.group == "doc") {
                this.doc.applyDeltas(delta.deltas);
                lastUndoRange =
                    this.$getUndoSelection(delta.deltas, false, lastUndoRange);
            }
        }
        this.$fromUndo = false;
        lastUndoRange &&
            this.$undoSelect &&
            !dontSelect &&
            this.selection.setSelectionRange(lastUndoRange);
        return lastUndoRange;
    };
    this.setUndoSelect = function(enable) {
        this.$undoSelect = enable;
    };

    this.$getUndoSelection = function(deltas, isUndo, lastUndoRange) {
        function isInsert(delta) {
            return isUndo ? delta.action !== "insert" : delta.action === "insert";
        }

        var delta = deltas[0];
        var range, point;
        var lastDeltaIsInsert = false;
        if (isInsert(delta)) {
            range = Range.fromPoints(delta.start, delta.end);
            lastDeltaIsInsert = true;
        } else {
            range = Range.fromPoints(delta.start, delta.start);
            lastDeltaIsInsert = false;
        }

        for (var i = 1; i < deltas.length; i++) {
            delta = deltas[i];
            if (isInsert(delta)) {
                point = delta.start;
                if (range.compare(point.row, point.column) == -1) {
                    range.setStart(point);
                }
                point = delta.end;
                if (range.compare(point.row, point.column) == 1) {
                    range.setEnd(point);
                }
                lastDeltaIsInsert = true;
            } else {
                point = delta.start;
                if (range.compare(point.row, point.column) == -1) {
                    range = Range.fromPoints(delta.start, delta.start);
                }
                lastDeltaIsInsert = false;
            }
        }
        if (lastUndoRange != null) {
            if (Range.comparePoints(lastUndoRange.start, range.start) === 0) {
                lastUndoRange.start.column += range.end.column - range.start.column;
                lastUndoRange.end.column += range.end.column - range.start.column;
            }

            var cmp = lastUndoRange.compareRange(range);
            if (cmp == 1) {
                range.setStart(lastUndoRange.start);
            } else if (cmp == -1) {
                range.setEnd(lastUndoRange.end);
            }
        }

        return range;
    };
    this.replace = function(range, text) {
        return this.doc.replace(range, text);
    };
    this.moveText = function(fromRange, toPosition, copy) {
        var text = this.getTextRange(fromRange);
        var folds = this.getFoldsInRange(fromRange);

        var toRange = Range.fromPoints(toPosition, toPosition);
        if (!copy) {
            this.remove(fromRange);
            var rowDiff = fromRange.start.row - fromRange.end.row;
            var collDiff = rowDiff ? -fromRange.end.column : fromRange.start.column - fromRange.end.column;
            if (collDiff) {
                if (toRange.start.row == fromRange.end.row && toRange.start.column > fromRange.end.column)
                    toRange.start.column += collDiff;
                if (toRange.end.row == fromRange.end.row && toRange.end.column > fromRange.end.column)
                    toRange.end.column += collDiff;
            }
            if (rowDiff && toRange.start.row >= fromRange.end.row) {
                toRange.start.row += rowDiff;
                toRange.end.row += rowDiff;
            }
        }

        toRange.end = this.insert(toRange.start, text);
        if (folds.length) {
            var oldStart = fromRange.start;
            var newStart = toRange.start;
            var rowDiff = newStart.row - oldStart.row;
            var collDiff = newStart.column - oldStart.column;
            this.addFolds(folds.map(function(x) {
                x = x.clone();
                if (x.start.row == oldStart.row)
                    x.start.column += collDiff;
                if (x.end.row == oldStart.row)
                    x.end.column += collDiff;
                x.start.row += rowDiff;
                x.end.row += rowDiff;
                return x;
            }));
        }

        return toRange;
    };
    this.indentRows = function(startRow, endRow, indentString) {
        indentString = indentString.replace(/\t/g, this.getTabString());
        for (var row=startRow; row<=endRow; row++)
            this.doc.insertInLine({row: row, column: 0}, indentString);
    };
    this.outdentRows = function (range) {
        var rowRange = range.collapseRows();
        var deleteRange = new Range(0, 0, 0, 0);
        var size = this.getTabSize();

        for (var i = rowRange.start.row; i <= rowRange.end.row; ++i) {
            var line = this.getLine(i);

            deleteRange.start.row = i;
            deleteRange.end.row = i;
            for (var j = 0; j < size; ++j)
                if (line.charAt(j) != ' ')
                    break;
            if (j < size && line.charAt(j) == '\t') {
                deleteRange.start.column = j;
                deleteRange.end.column = j + 1;
            } else {
                deleteRange.start.column = 0;
                deleteRange.end.column = j;
            }
            this.remove(deleteRange);
        }
    };

    this.$moveLines = function(firstRow, lastRow, dir) {
        firstRow = this.getRowFoldStart(firstRow);
        lastRow = this.getRowFoldEnd(lastRow);
        if (dir < 0) {
            var row = this.getRowFoldStart(firstRow + dir);
            if (row < 0) return 0;
            var diff = row-firstRow;
        } else if (dir > 0) {
            var row = this.getRowFoldEnd(lastRow + dir);
            if (row > this.doc.getLength()-1) return 0;
            var diff = row-lastRow;
        } else {
            firstRow = this.$clipRowToDocument(firstRow);
            lastRow = this.$clipRowToDocument(lastRow);
            var diff = lastRow - firstRow + 1;
        }

        var range = new Range(firstRow, 0, lastRow, Number.MAX_VALUE);
        var folds = this.getFoldsInRange(range).map(function(x){
            x = x.clone();
            x.start.row += diff;
            x.end.row += diff;
            return x;
        });
        
        var lines = dir == 0
            ? this.doc.getLines(firstRow, lastRow)
            : this.doc.removeFullLines(firstRow, lastRow);
        this.doc.insertFullLines(firstRow+diff, lines);
        folds.length && this.addFolds(folds);
        return diff;
    };
    this.moveLinesUp = function(firstRow, lastRow) {
        return this.$moveLines(firstRow, lastRow, -1);
    };
    this.moveLinesDown = function(firstRow, lastRow) {
        return this.$moveLines(firstRow, lastRow, 1);
    };
    this.duplicateLines = function(firstRow, lastRow) {
        return this.$moveLines(firstRow, lastRow, 0);
    };


    this.$clipRowToDocument = function(row) {
        return Math.max(0, Math.min(row, this.doc.getLength()-1));
    };

    this.$clipColumnToRow = function(row, column) {
        if (column < 0)
            return 0;
        return Math.min(this.doc.getLine(row).length, column);
    };


    this.$clipPositionToDocument = function(row, column) {
        column = Math.max(0, column);

        if (row < 0) {
            row = 0;
            column = 0;
        } else {
            var len = this.doc.getLength();
            if (row >= len) {
                row = len - 1;
                column = this.doc.getLine(len-1).length;
            } else {
                column = Math.min(this.doc.getLine(row).length, column);
            }
        }

        return {
            row: row,
            column: column
        };
    };

    this.$clipRangeToDocument = function(range) {
        if (range.start.row < 0) {
            range.start.row = 0;
            range.start.column = 0;
        } else {
            range.start.column = this.$clipColumnToRow(
                range.start.row,
                range.start.column
            );
        }

        var len = this.doc.getLength() - 1;
        if (range.end.row > len) {
            range.end.row = len;
            range.end.column = this.doc.getLine(len).length;
        } else {
            range.end.column = this.$clipColumnToRow(
                range.end.row,
                range.end.column
            );
        }
        return range;
    };
    this.$wrapLimit = 80;
    this.$useWrapMode = false;
    this.$wrapLimitRange = {
        min : null,
        max : null
    };
    this.setUseWrapMode = function(useWrapMode) {
        if (useWrapMode != this.$useWrapMode) {
            this.$useWrapMode = useWrapMode;
            this.$modified = true;
            this.$resetRowCache(0);
            if (useWrapMode) {
                var len = this.getLength();
                this.$wrapData = Array(len);
                this.$updateWrapData(0, len - 1);
            }

            this._signal("changeWrapMode");
        }
    };
    this.getUseWrapMode = function() {
        return this.$useWrapMode;
    };
    this.setWrapLimitRange = function(min, max) {
        if (this.$wrapLimitRange.min !== min || this.$wrapLimitRange.max !== max) {
            this.$wrapLimitRange = { min: min, max: max };
            this.$modified = true;
            this.$bidiHandler.markAsDirty();
            if (this.$useWrapMode)
                this._signal("changeWrapMode");
        }
    };
    this.adjustWrapLimit = function(desiredLimit, $printMargin) {
        var limits = this.$wrapLimitRange;
        if (limits.max < 0)
            limits = {min: $printMargin, max: $printMargin};
        var wrapLimit = this.$constrainWrapLimit(desiredLimit, limits.min, limits.max);
        if (wrapLimit != this.$wrapLimit && wrapLimit > 1) {
            this.$wrapLimit = wrapLimit;
            this.$modified = true;
            if (this.$useWrapMode) {
                this.$updateWrapData(0, this.getLength() - 1);
                this.$resetRowCache(0);
                this._signal("changeWrapLimit");
            }
            return true;
        }
        return false;
    };

    this.$constrainWrapLimit = function(wrapLimit, min, max) {
        if (min)
            wrapLimit = Math.max(min, wrapLimit);

        if (max)
            wrapLimit = Math.min(max, wrapLimit);

        return wrapLimit;
    };
    this.getWrapLimit = function() {
        return this.$wrapLimit;
    };
    this.setWrapLimit = function (limit) {
        this.setWrapLimitRange(limit, limit);
    };
    this.getWrapLimitRange = function() {
        return {
            min : this.$wrapLimitRange.min,
            max : this.$wrapLimitRange.max
        };
    };

    this.$updateInternalDataOnChange = function(delta) {
        var useWrapMode = this.$useWrapMode;
        var action = delta.action;
        var start = delta.start;
        var end = delta.end;
        var firstRow = start.row;
        var lastRow = end.row;
        var len = lastRow - firstRow;
        var removedFolds = null;
        
        this.$updating = true;
        if (len != 0) {
            if (action === "remove") {
                this[useWrapMode ? "$wrapData" : "$rowLengthCache"].splice(firstRow, len);

                var foldLines = this.$foldData;
                removedFolds = this.getFoldsInRange(delta);
                this.removeFolds(removedFolds);

                var foldLine = this.getFoldLine(end.row);
                var idx = 0;
                if (foldLine) {
                    foldLine.addRemoveChars(end.row, end.column, start.column - end.column);
                    foldLine.shiftRow(-len);

                    var foldLineBefore = this.getFoldLine(firstRow);
                    if (foldLineBefore && foldLineBefore !== foldLine) {
                        foldLineBefore.merge(foldLine);
                        foldLine = foldLineBefore;
                    }
                    idx = foldLines.indexOf(foldLine) + 1;
                }

                for (idx; idx < foldLines.length; idx++) {
                    var foldLine = foldLines[idx];
                    if (foldLine.start.row >= end.row) {
                        foldLine.shiftRow(-len);
                    }
                }

                lastRow = firstRow;
            } else {
                var args = Array(len);
                args.unshift(firstRow, 0);
                var arr = useWrapMode ? this.$wrapData : this.$rowLengthCache;
                arr.splice.apply(arr, args);
                var foldLines = this.$foldData;
                var foldLine = this.getFoldLine(firstRow);
                var idx = 0;
                if (foldLine) {
                    var cmp = foldLine.range.compareInside(start.row, start.column);
                    if (cmp == 0) {
                        foldLine = foldLine.split(start.row, start.column);
                        if (foldLine) {
                            foldLine.shiftRow(len);
                            foldLine.addRemoveChars(lastRow, 0, end.column - start.column);
                        }
                    } else
                    if (cmp == -1) {
                        foldLine.addRemoveChars(firstRow, 0, end.column - start.column);
                        foldLine.shiftRow(len);
                    }
                    idx = foldLines.indexOf(foldLine) + 1;
                }

                for (idx; idx < foldLines.length; idx++) {
                    var foldLine = foldLines[idx];
                    if (foldLine.start.row >= firstRow) {
                        foldLine.shiftRow(len);
                    }
                }
            }
        } else {
            len = Math.abs(delta.start.column - delta.end.column);
            if (action === "remove") {
                removedFolds = this.getFoldsInRange(delta);
                this.removeFolds(removedFolds);

                len = -len;
            }
            var foldLine = this.getFoldLine(firstRow);
            if (foldLine) {
                foldLine.addRemoveChars(firstRow, start.column, len);
            }
        }

        if (useWrapMode && this.$wrapData.length != this.doc.getLength()) {
            console.error("doc.getLength() and $wrapData.length have to be the same!");
        }
        this.$updating = false;

        if (useWrapMode)
            this.$updateWrapData(firstRow, lastRow);
        else
            this.$updateRowLengthCache(firstRow, lastRow);

        return removedFolds;
    };

    this.$updateRowLengthCache = function(firstRow, lastRow, b) {
        this.$rowLengthCache[firstRow] = null;
        this.$rowLengthCache[lastRow] = null;
    };

    this.$updateWrapData = function(firstRow, lastRow) {
        var lines = this.doc.getAllLines();
        var tabSize = this.getTabSize();
        var wrapData = this.$wrapData;
        var wrapLimit = this.$wrapLimit;
        var tokens;
        var foldLine;

        var row = firstRow;
        lastRow = Math.min(lastRow, lines.length - 1);
        while (row <= lastRow) {
            foldLine = this.getFoldLine(row, foldLine);
            if (!foldLine) {
                tokens = this.$getDisplayTokens(lines[row]);
                wrapData[row] = this.$computeWrapSplits(tokens, wrapLimit, tabSize);
                row ++;
            } else {
                tokens = [];
                foldLine.walk(function(placeholder, row, column, lastColumn) {
                        var walkTokens;
                        if (placeholder != null) {
                            walkTokens = this.$getDisplayTokens(
                                            placeholder, tokens.length);
                            walkTokens[0] = PLACEHOLDER_START;
                            for (var i = 1; i < walkTokens.length; i++) {
                                walkTokens[i] = PLACEHOLDER_BODY;
                            }
                        } else {
                            walkTokens = this.$getDisplayTokens(
                                lines[row].substring(lastColumn, column),
                                tokens.length);
                        }
                        tokens = tokens.concat(walkTokens);
                    }.bind(this),
                    foldLine.end.row,
                    lines[foldLine.end.row].length + 1
                );

                wrapData[foldLine.start.row] = this.$computeWrapSplits(tokens, wrapLimit, tabSize);
                row = foldLine.end.row + 1;
            }
        }
    };
    var CHAR = 1,
        CHAR_EXT = 2,
        PLACEHOLDER_START = 3,
        PLACEHOLDER_BODY =  4,
        PUNCTUATION = 9,
        SPACE = 10,
        TAB = 11,
        TAB_SPACE = 12;


    this.$computeWrapSplits = function(tokens, wrapLimit, tabSize) {
        if (tokens.length == 0) {
            return [];
        }

        var splits = [];
        var displayLength = tokens.length;
        var lastSplit = 0, lastDocSplit = 0;

        var isCode = this.$wrapAsCode;

        var indentedSoftWrap = this.$indentedSoftWrap;
        var maxIndent = wrapLimit <= Math.max(2 * tabSize, 8)
            || indentedSoftWrap === false ? 0 : Math.floor(wrapLimit / 2);

        function getWrapIndent() {
            var indentation = 0;
            if (maxIndent === 0)
                return indentation;
            if (indentedSoftWrap) {
                for (var i = 0; i < tokens.length; i++) {
                    var token = tokens[i];
                    if (token == SPACE)
                        indentation += 1;
                    else if (token == TAB)
                        indentation += tabSize;
                    else if (token == TAB_SPACE)
                        continue;
                    else
                        break;
                }
            }
            if (isCode && indentedSoftWrap !== false)
                indentation += tabSize;
            return Math.min(indentation, maxIndent);
        }
        function addSplit(screenPos) {
            var displayed = tokens.slice(lastSplit, screenPos);
            var len = displayed.length;
            displayed.join("")
                .replace(/12/g, function() {
                    len -= 1;
                })
                .replace(/2/g, function() {
                    len -= 1;
                });

            if (!splits.length) {
                indent = getWrapIndent();
                splits.indent = indent;
            }
            lastDocSplit += len;
            splits.push(lastDocSplit);
            lastSplit = screenPos;
        }
        var indent = 0;
        while (displayLength - lastSplit > wrapLimit - indent) {
            var split = lastSplit + wrapLimit - indent;
            if (tokens[split - 1] >= SPACE && tokens[split] >= SPACE) {
                addSplit(split);
                continue;
            }
            if (tokens[split] == PLACEHOLDER_START || tokens[split] == PLACEHOLDER_BODY) {
                for (split; split != lastSplit - 1; split--) {
                    if (tokens[split] == PLACEHOLDER_START) {
                        break;
                    }
                }
                if (split > lastSplit) {
                    addSplit(split);
                    continue;
                }
                split = lastSplit + wrapLimit;
                for (split; split < tokens.length; split++) {
                    if (tokens[split] != PLACEHOLDER_BODY) {
                        break;
                    }
                }
                if (split == tokens.length) {
                    break;  // Breaks the while-loop.
                }
                addSplit(split);
                continue;
            }
            var minSplit = Math.max(split - (wrapLimit -(wrapLimit>>2)), lastSplit - 1);
            while (split > minSplit && tokens[split] < PLACEHOLDER_START) {
                split --;
            }
            if (isCode) {
                while (split > minSplit && tokens[split] < PLACEHOLDER_START) {
                    split --;
                }
                while (split > minSplit && tokens[split] == PUNCTUATION) {
                    split --;
                }
            } else {
                while (split > minSplit && tokens[split] < SPACE) {
                    split --;
                }
            }
            if (split > minSplit) {
                addSplit(++split);
                continue;
            }
            split = lastSplit + wrapLimit;
            if (tokens[split] == CHAR_EXT)
                split--;
            addSplit(split - indent);
        }
        return splits;
    };
    this.$getDisplayTokens = function(str, offset) {
        var arr = [];
        var tabSize;
        offset = offset || 0;

        for (var i = 0; i < str.length; i++) {
            var c = str.charCodeAt(i);
            if (c == 9) {
                tabSize = this.getScreenTabSize(arr.length + offset);
                arr.push(TAB);
                for (var n = 1; n < tabSize; n++) {
                    arr.push(TAB_SPACE);
                }
            }
            else if (c == 32) {
                arr.push(SPACE);
            } else if((c > 39 && c < 48) || (c > 57 && c < 64)) {
                arr.push(PUNCTUATION);
            }
            else if (c >= 0x1100 && isFullWidth(c)) {
                arr.push(CHAR, CHAR_EXT);
            } else {
                arr.push(CHAR);
            }
        }
        return arr;
    };
    this.$getStringScreenWidth = function(str, maxScreenColumn, screenColumn) {
        if (maxScreenColumn == 0)
            return [0, 0];
        if (maxScreenColumn == null)
            maxScreenColumn = Infinity;
        screenColumn = screenColumn || 0;

        var c, column;
        for (column = 0; column < str.length; column++) {
            c = str.charCodeAt(column);
            if (c == 9) {
                screenColumn += this.getScreenTabSize(screenColumn);
            }
            else if (c >= 0x1100 && isFullWidth(c)) {
                screenColumn += 2;
            } else {
                screenColumn += 1;
            }
            if (screenColumn > maxScreenColumn) {
                break;
            }
        }

        return [screenColumn, column];
    };

    this.lineWidgets = null;
    this.getRowLength = function(row) {
        if (this.lineWidgets)
            var h = this.lineWidgets[row] && this.lineWidgets[row].rowCount || 0;
        else 
            h = 0;
        if (!this.$useWrapMode || !this.$wrapData[row]) {
            return 1 + h;
        } else {
            return this.$wrapData[row].length + 1 + h;
        }
    };
    this.getRowLineCount = function(row) {
        if (!this.$useWrapMode || !this.$wrapData[row]) {
            return 1;
        } else {
            return this.$wrapData[row].length + 1;
        }
    };

    this.getRowWrapIndent = function(screenRow) {
        if (this.$useWrapMode) {
            var pos = this.screenToDocumentPosition(screenRow, Number.MAX_VALUE);
            var splits = this.$wrapData[pos.row];
            return splits.length && splits[0] < pos.column ? splits.indent : 0;
        } else {
            return 0;
        }
    };
    this.getScreenLastRowColumn = function(screenRow) {
        var pos = this.screenToDocumentPosition(screenRow, Number.MAX_VALUE);
        return this.documentToScreenColumn(pos.row, pos.column);
    };
    this.getDocumentLastRowColumn = function(docRow, docColumn) {
        var screenRow = this.documentToScreenRow(docRow, docColumn);
        return this.getScreenLastRowColumn(screenRow);
    };
    this.getDocumentLastRowColumnPosition = function(docRow, docColumn) {
        var screenRow = this.documentToScreenRow(docRow, docColumn);
        return this.screenToDocumentPosition(screenRow, Number.MAX_VALUE / 10);
    };
    this.getRowSplitData = function(row) {
        if (!this.$useWrapMode) {
            return undefined;
        } else {
            return this.$wrapData[row];
        }
    };
    this.getScreenTabSize = function(screenColumn) {
        return this.$tabSize - screenColumn % this.$tabSize;
    };


    this.screenToDocumentRow = function(screenRow, screenColumn) {
        return this.screenToDocumentPosition(screenRow, screenColumn).row;
    };


    this.screenToDocumentColumn = function(screenRow, screenColumn) {
        return this.screenToDocumentPosition(screenRow, screenColumn).column;
    };
    this.screenToDocumentPosition = function(screenRow, screenColumn, offsetX) {
        if (screenRow < 0)
            return {row: 0, column: 0};

        var line;
        var docRow = 0;
        var docColumn = 0;
        var column;
        var row = 0;
        var rowLength = 0;

        var rowCache = this.$screenRowCache;
        var i = this.$getRowCacheIndex(rowCache, screenRow);
        var l = rowCache.length;
        if (l && i >= 0) {
            var row = rowCache[i];
            var docRow = this.$docRowCache[i];
            var doCache = screenRow > rowCache[l - 1];
        } else {
            var doCache = !l;
        }

        var maxRow = this.getLength() - 1;
        var foldLine = this.getNextFoldLine(docRow);
        var foldStart = foldLine ? foldLine.start.row : Infinity;

        while (row <= screenRow) {
            rowLength = this.getRowLength(docRow);
            if (row + rowLength > screenRow || docRow >= maxRow) {
                break;
            } else {
                row += rowLength;
                docRow++;
                if (docRow > foldStart) {
                    docRow = foldLine.end.row+1;
                    foldLine = this.getNextFoldLine(docRow, foldLine);
                    foldStart = foldLine ? foldLine.start.row : Infinity;
                }
            }

            if (doCache) {
                this.$docRowCache.push(docRow);
                this.$screenRowCache.push(row);
            }
        }

        if (foldLine && foldLine.start.row <= docRow) {
            line = this.getFoldDisplayLine(foldLine);
            docRow = foldLine.start.row;
        } else if (row + rowLength <= screenRow || docRow > maxRow) {
            return {
                row: maxRow,
                column: this.getLine(maxRow).length
            };
        } else {
            line = this.getLine(docRow);
            foldLine = null;
        }
        var wrapIndent = 0, splitIndex = Math.floor(screenRow - row);
        if (this.$useWrapMode) {
            var splits = this.$wrapData[docRow];
            if (splits) {
                column = splits[splitIndex];
                if(splitIndex > 0 && splits.length) {
                    wrapIndent = splits.indent;
                    docColumn = splits[splitIndex - 1] || splits[splits.length - 1];
                    line = line.substring(docColumn);
                }
            }
        }

        if (offsetX !== undefined && this.$bidiHandler.isBidiRow(row + splitIndex, docRow, splitIndex))
            screenColumn = this.$bidiHandler.offsetToCol(offsetX);

        docColumn += this.$getStringScreenWidth(line, screenColumn - wrapIndent)[1];
        if (this.$useWrapMode && docColumn >= column)
            docColumn = column - 1;

        if (foldLine)
            return foldLine.idxToPosition(docColumn);

        return {row: docRow, column: docColumn};
    };
    this.documentToScreenPosition = function(docRow, docColumn) {
        if (typeof docColumn === "undefined")
            var pos = this.$clipPositionToDocument(docRow.row, docRow.column);
        else
            pos = this.$clipPositionToDocument(docRow, docColumn);

        docRow = pos.row;
        docColumn = pos.column;

        var screenRow = 0;
        var foldStartRow = null;
        var fold = null;
        fold = this.getFoldAt(docRow, docColumn, 1);
        if (fold) {
            docRow = fold.start.row;
            docColumn = fold.start.column;
        }

        var rowEnd, row = 0;


        var rowCache = this.$docRowCache;
        var i = this.$getRowCacheIndex(rowCache, docRow);
        var l = rowCache.length;
        if (l && i >= 0) {
            var row = rowCache[i];
            var screenRow = this.$screenRowCache[i];
            var doCache = docRow > rowCache[l - 1];
        } else {
            var doCache = !l;
        }

        var foldLine = this.getNextFoldLine(row);
        var foldStart = foldLine ?foldLine.start.row :Infinity;

        while (row < docRow) {
            if (row >= foldStart) {
                rowEnd = foldLine.end.row + 1;
                if (rowEnd > docRow)
                    break;
                foldLine = this.getNextFoldLine(rowEnd, foldLine);
                foldStart = foldLine ?foldLine.start.row :Infinity;
            }
            else {
                rowEnd = row + 1;
            }

            screenRow += this.getRowLength(row);
            row = rowEnd;

            if (doCache) {
                this.$docRowCache.push(row);
                this.$screenRowCache.push(screenRow);
            }
        }
        var textLine = "";
        if (foldLine && row >= foldStart) {
            textLine = this.getFoldDisplayLine(foldLine, docRow, docColumn);
            foldStartRow = foldLine.start.row;
        } else {
            textLine = this.getLine(docRow).substring(0, docColumn);
            foldStartRow = docRow;
        }
        var wrapIndent = 0;
        if (this.$useWrapMode) {
            var wrapRow = this.$wrapData[foldStartRow];
            if (wrapRow) {
                var screenRowOffset = 0;
                while (textLine.length >= wrapRow[screenRowOffset]) {
                    screenRow ++;
                    screenRowOffset++;
                }
                textLine = textLine.substring(
                    wrapRow[screenRowOffset - 1] || 0, textLine.length
                );
                wrapIndent = screenRowOffset > 0 ? wrapRow.indent : 0;
            }
        }

        return {
            row: screenRow,
            column: wrapIndent + this.$getStringScreenWidth(textLine)[0]
        };
    };
    this.documentToScreenColumn = function(row, docColumn) {
        return this.documentToScreenPosition(row, docColumn).column;
    };
    this.documentToScreenRow = function(docRow, docColumn) {
        return this.documentToScreenPosition(docRow, docColumn).row;
    };
    this.getScreenLength = function() {
        var screenRows = 0;
        var fold = null;
        if (!this.$useWrapMode) {
            screenRows = this.getLength();
            var foldData = this.$foldData;
            for (var i = 0; i < foldData.length; i++) {
                fold = foldData[i];
                screenRows -= fold.end.row - fold.start.row;
            }
        } else {
            var lastRow = this.$wrapData.length;
            var row = 0, i = 0;
            var fold = this.$foldData[i++];
            var foldStart = fold ? fold.start.row :Infinity;

            while (row < lastRow) {
                var splits = this.$wrapData[row];
                screenRows += splits ? splits.length + 1 : 1;
                row ++;
                if (row > foldStart) {
                    row = fold.end.row+1;
                    fold = this.$foldData[i++];
                    foldStart = fold ?fold.start.row :Infinity;
                }
            }
        }
        if (this.lineWidgets)
            screenRows += this.$getWidgetScreenLength();

        return screenRows;
    };
    this.$setFontMetrics = function(fm) {
        if (!this.$enableVarChar) return;
        this.$getStringScreenWidth = function(str, maxScreenColumn, screenColumn) {
            if (maxScreenColumn === 0)
                return [0, 0];
            if (!maxScreenColumn)
                maxScreenColumn = Infinity;
            screenColumn = screenColumn || 0;
            
            var c, column;
            for (column = 0; column < str.length; column++) {
                c = str.charAt(column);
                if (c === "\t") {
                    screenColumn += this.getScreenTabSize(screenColumn);
                } else {
                    screenColumn += fm.getCharacterWidth(c);
                }
                if (screenColumn > maxScreenColumn) {
                    break;
                }
            }
            
            return [screenColumn, column];
        };
    };
    
    this.destroy = function() {
        if (this.bgTokenizer) {
            this.bgTokenizer.setDocument(null);
            this.bgTokenizer = null;
        }
        this.$stopWorker();
    };

    this.isFullWidth = isFullWidth;
    function isFullWidth(c) {
        if (c < 0x1100)
            return false;
        return c >= 0x1100 && c <= 0x115F ||
               c >= 0x11A3 && c <= 0x11A7 ||
               c >= 0x11FA && c <= 0x11FF ||
               c >= 0x2329 && c <= 0x232A ||
               c >= 0x2E80 && c <= 0x2E99 ||
               c >= 0x2E9B && c <= 0x2EF3 ||
               c >= 0x2F00 && c <= 0x2FD5 ||
               c >= 0x2FF0 && c <= 0x2FFB ||
               c >= 0x3000 && c <= 0x303E ||
               c >= 0x3041 && c <= 0x3096 ||
               c >= 0x3099 && c <= 0x30FF ||
               c >= 0x3105 && c <= 0x312D ||
               c >= 0x3131 && c <= 0x318E ||
               c >= 0x3190 && c <= 0x31BA ||
               c >= 0x31C0 && c <= 0x31E3 ||
               c >= 0x31F0 && c <= 0x321E ||
               c >= 0x3220 && c <= 0x3247 ||
               c >= 0x3250 && c <= 0x32FE ||
               c >= 0x3300 && c <= 0x4DBF ||
               c >= 0x4E00 && c <= 0xA48C ||
               c >= 0xA490 && c <= 0xA4C6 ||
               c >= 0xA960 && c <= 0xA97C ||
               c >= 0xAC00 && c <= 0xD7A3 ||
               c >= 0xD7B0 && c <= 0xD7C6 ||
               c >= 0xD7CB && c <= 0xD7FB ||
               c >= 0xF900 && c <= 0xFAFF ||
               c >= 0xFE10 && c <= 0xFE19 ||
               c >= 0xFE30 && c <= 0xFE52 ||
               c >= 0xFE54 && c <= 0xFE66 ||
               c >= 0xFE68 && c <= 0xFE6B ||
               c >= 0xFF01 && c <= 0xFF60 ||
               c >= 0xFFE0 && c <= 0xFFE6;
    }

}).call(EditSession.prototype);

require("./edit_session/folding").Folding.call(EditSession.prototype);
require("./edit_session/bracket_match").BracketMatch.call(EditSession.prototype);


config.defineOptions(EditSession.prototype, "session", {
    wrap: {
        set: function(value) {
            if (!value || value == "off")
                value = false;
            else if (value == "free")
                value = true;
            else if (value == "printMargin")
                value = -1;
            else if (typeof value == "string")
                value = parseInt(value, 10) || false;

            if (this.$wrap == value)
                return;
            this.$wrap = value;
            if (!value) {
                this.setUseWrapMode(false);
            } else {
                var col = typeof value == "number" ? value : null;
                this.setWrapLimitRange(col, col);
                this.setUseWrapMode(true);
            }
        },
        get: function() {
            if (this.getUseWrapMode()) {
                if (this.$wrap == -1)
                    return "printMargin";
                if (!this.getWrapLimitRange().min)
                    return "free";
                return this.$wrap;
            }
            return "off";
        },
        handlesSet: true
    },    
    wrapMethod: {
        set: function(val) {
            val = val == "auto"
                ? this.$mode.type != "text"
                : val != "text";
            if (val != this.$wrapAsCode) {
                this.$wrapAsCode = val;
                if (this.$useWrapMode) {
                    this.$modified = true;
                    this.$resetRowCache(0);
                    this.$updateWrapData(0, this.getLength() - 1);
                }
            }
        },
        initialValue: "auto"
    },
    indentedSoftWrap: { initialValue: true },
    firstLineNumber: {
        set: function() {this._signal("changeBreakpoint");},
        initialValue: 1
    },
    useWorker: {
        set: function(useWorker) {
            this.$useWorker = useWorker;

            this.$stopWorker();
            if (useWorker)
                this.$startWorker();
        },
        initialValue: true
    },
    useSoftTabs: {initialValue: true},
    tabSize: {
        set: function(tabSize) {
            if (isNaN(tabSize) || this.$tabSize === tabSize) return;

            this.$modified = true;
            this.$rowLengthCache = [];
            this.$tabSize = tabSize;
            this._signal("changeTabSize");
        },
        initialValue: 4,
        handlesSet: true
    },
    navigateWithinSoftTabs: {initialValue: false},
    overwrite: {
        set: function(val) {this._signal("changeOverwrite");},
        initialValue: false
    },
    newLineMode: {
        set: function(val) {this.doc.setNewLineMode(val);},
        get: function() {return this.doc.getNewLineMode();},
        handlesSet: true
    },
    mode: {
        set: function(val) { this.setMode(val); },
        get: function() { return this.$modeId; }
    }
});

exports.EditSession = EditSession;
});

ace.define("ace/search",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/range"], function(require, exports, module) {
"use strict";

var lang = require("./lib/lang");
var oop = require("./lib/oop");
var Range = require("./range").Range;

var Search = function() {
    this.$options = {};
};

(function() {
    this.set = function(options) {
        oop.mixin(this.$options, options);
        return this;
    };
    this.getOptions = function() {
        return lang.copyObject(this.$options);
    };
    this.setOptions = function(options) {
        this.$options = options;
    };
    this.find = function(session) {
        var options = this.$options;
        var iterator = this.$matchIterator(session, options);
        if (!iterator)
            return false;

        var firstRange = null;
        iterator.forEach(function(sr, sc, er, ec) {
            firstRange = new Range(sr, sc, er, ec);
            if (sc == ec && options.start && options.start.start
                && options.skipCurrent != false && firstRange.isEqual(options.start)
            ) {
                firstRange = null;
                return false;
            }
            
            return true;
        });

        return firstRange;
    };
    this.findAll = function(session) {
        var options = this.$options;
        if (!options.needle)
            return [];
        this.$assembleRegExp(options);

        var range = options.range;
        var lines = range
            ? session.getLines(range.start.row, range.end.row)
            : session.doc.getAllLines();

        var ranges = [];
        var re = options.re;
        if (options.$isMultiLine) {
            var len = re.length;
            var maxRow = lines.length - len;
            var prevRange;
            outer: for (var row = re.offset || 0; row <= maxRow; row++) {
                for (var j = 0; j < len; j++)
                    if (lines[row + j].search(re[j]) == -1)
                        continue outer;
                
                var startLine = lines[row];
                var line = lines[row + len - 1];
                var startIndex = startLine.length - startLine.match(re[0])[0].length;
                var endIndex = line.match(re[len - 1])[0].length;
                
                if (prevRange && prevRange.end.row === row &&
                    prevRange.end.column > startIndex
                ) {
                    continue;
                }
                ranges.push(prevRange = new Range(
                    row, startIndex, row + len - 1, endIndex
                ));
                if (len > 2)
                    row = row + len - 2;
            }
        } else {
            for (var i = 0; i < lines.length; i++) {
                var matches = lang.getMatchOffsets(lines[i], re);
                for (var j = 0; j < matches.length; j++) {
                    var match = matches[j];
                    ranges.push(new Range(i, match.offset, i, match.offset + match.length));
                }
            }
        }

        if (range) {
            var startColumn = range.start.column;
            var endColumn = range.start.column;
            var i = 0, j = ranges.length - 1;
            while (i < j && ranges[i].start.column < startColumn && ranges[i].start.row == range.start.row)
                i++;

            while (i < j && ranges[j].end.column > endColumn && ranges[j].end.row == range.end.row)
                j--;
            
            ranges = ranges.slice(i, j + 1);
            for (i = 0, j = ranges.length; i < j; i++) {
                ranges[i].start.row += range.start.row;
                ranges[i].end.row += range.start.row;
            }
        }

        return ranges;
    };
    this.replace = function(input, replacement) {
        var options = this.$options;

        var re = this.$assembleRegExp(options);
        if (options.$isMultiLine)
            return replacement;

        if (!re)
            return;

        var match = re.exec(input);
        if (!match || match[0].length != input.length)
            return null;
        
        replacement = input.replace(re, replacement);
        if (options.preserveCase) {
            replacement = replacement.split("");
            for (var i = Math.min(input.length, input.length); i--; ) {
                var ch = input[i];
                if (ch && ch.toLowerCase() != ch)
                    replacement[i] = replacement[i].toUpperCase();
                else
                    replacement[i] = replacement[i].toLowerCase();
            }
            replacement = replacement.join("");
        }
        
        return replacement;
    };

    this.$assembleRegExp = function(options, $disableFakeMultiline) {
        if (options.needle instanceof RegExp)
            return options.re = options.needle;

        var needle = options.needle;

        if (!options.needle)
            return options.re = false;

        if (!options.regExp)
            needle = lang.escapeRegExp(needle);

        if (options.wholeWord)
            needle = addWordBoundary(needle, options);

        var modifier = options.caseSensitive ? "gm" : "gmi";

        options.$isMultiLine = !$disableFakeMultiline && /[\n\r]/.test(needle);
        if (options.$isMultiLine)
            return options.re = this.$assembleMultilineRegExp(needle, modifier);

        try {
            var re = new RegExp(needle, modifier);
        } catch(e) {
            re = false;
        }
        return options.re = re;
    };

    this.$assembleMultilineRegExp = function(needle, modifier) {
        var parts = needle.replace(/\r\n|\r|\n/g, "$\n^").split("\n");
        var re = [];
        for (var i = 0; i < parts.length; i++) try {
            re.push(new RegExp(parts[i], modifier));
        } catch(e) {
            return false;
        }
        return re;
    };

    this.$matchIterator = function(session, options) {
        var re = this.$assembleRegExp(options);
        if (!re)
            return false;
        var backwards = options.backwards == true;
        var skipCurrent = options.skipCurrent != false;

        var range = options.range;
        var start = options.start;
        if (!start)
            start = range ? range[backwards ? "end" : "start"] : session.selection.getRange();
         
        if (start.start)
            start = start[skipCurrent != backwards ? "end" : "start"];

        var firstRow = range ? range.start.row : 0;
        var lastRow = range ? range.end.row : session.getLength() - 1;
        
        if (backwards) {
            var forEach = function(callback) {
                var row = start.row;
                if (forEachInLine(row, start.column, callback))
                    return;
                for (row--; row >= firstRow; row--)
                    if (forEachInLine(row, Number.MAX_VALUE, callback))
                        return;
                if (options.wrap == false)
                    return;
                for (row = lastRow, firstRow = start.row; row >= firstRow; row--)
                    if (forEachInLine(row, Number.MAX_VALUE, callback))
                        return;
            };
        }
        else {
            var forEach = function(callback) {
                var row = start.row;
                if (forEachInLine(row, start.column, callback))
                    return;
                for (row = row + 1; row <= lastRow; row++)
                    if (forEachInLine(row, 0, callback))
                        return;
                if (options.wrap == false)
                    return;
                for (row = firstRow, lastRow = start.row; row <= lastRow; row++)
                    if (forEachInLine(row, 0, callback))
                        return;
            };
        }
        
        if (options.$isMultiLine) {
            var len = re.length;
            var forEachInLine = function(row, offset, callback) {
                var startRow = backwards ? row - len + 1 : row;
                if (startRow < 0) return;
                var line = session.getLine(startRow);
                var startIndex = line.search(re[0]);
                if (!backwards && startIndex < offset || startIndex === -1) return;
                for (var i = 1; i < len; i++) {
                    line = session.getLine(startRow + i);
                    if (line.search(re[i]) == -1)
                        return;
                }
                var endIndex = line.match(re[len - 1])[0].length;
                if (backwards && endIndex > offset) return;
                if (callback(startRow, startIndex, startRow + len - 1, endIndex))
                    return true;
            };
        }
        else if (backwards) {
            var forEachInLine = function(row, endIndex, callback) {
                var line = session.getLine(row);
                var matches = [];
                var m, last = 0;
                re.lastIndex = 0;
                while((m = re.exec(line))) {
                    var length = m[0].length;
                    last = m.index;
                    if (!length) {
                        if (last >= line.length) break;
                        re.lastIndex = last += 1;
                    }
                    if (m.index + length > endIndex)
                        break;
                    matches.push(m.index, length);
                }
                for (var i = matches.length - 1; i >= 0; i -= 2) {
                    var column = matches[i - 1];
                    var length = matches[i];
                    if (callback(row, column, row, column + length))
                        return true;
                }
            };
        }
        else {
            var forEachInLine = function(row, startIndex, callback) {
                var line = session.getLine(row);
                var m;
                var last = startIndex;
                re.lastIndex = startIndex;
                while((m = re.exec(line))) {
                    var length = m[0].length;
                    last = m.index;
                    if (callback(row, last, row,last + length))
                        return true;
                    if (!length) {
                        re.lastIndex = last += 1;
                        if (last >= line.length) return false;
                    }
                }
            };
        }
        return {forEach: forEach};
    };

}).call(Search.prototype);

function addWordBoundary(needle, options) {
    function wordBoundary(c) {
        if (/\w/.test(c) || options.regExp) return "\\b";
        return "";
    }
    return wordBoundary(needle[0]) + needle
        + wordBoundary(needle[needle.length - 1]);
}

exports.Search = Search;
});

ace.define("ace/keyboard/hash_handler",["require","exports","module","ace/lib/keys","ace/lib/useragent"], function(require, exports, module) {
"use strict";

var keyUtil = require("../lib/keys");
var useragent = require("../lib/useragent");
var KEY_MODS = keyUtil.KEY_MODS;

function HashHandler(config, platform) {
    this.platform = platform || (useragent.isMac ? "mac" : "win");
    this.commands = {};
    this.commandKeyBinding = {};
    this.addCommands(config);
    this.$singleCommand = true;
}

function MultiHashHandler(config, platform) {
    HashHandler.call(this, config, platform);
    this.$singleCommand = false;
}

MultiHashHandler.prototype = HashHandler.prototype;

(function() {
    

    this.addCommand = function(command) {
        if (this.commands[command.name])
            this.removeCommand(command);

        this.commands[command.name] = command;

        if (command.bindKey)
            this._buildKeyHash(command);
    };

    this.removeCommand = function(command, keepCommand) {
        var name = command && (typeof command === 'string' ? command : command.name);
        command = this.commands[name];
        if (!keepCommand)
            delete this.commands[name];
        var ckb = this.commandKeyBinding;
        for (var keyId in ckb) {
            var cmdGroup = ckb[keyId];
            if (cmdGroup == command) {
                delete ckb[keyId];
            } else if (Array.isArray(cmdGroup)) {
                var i = cmdGroup.indexOf(command);
                if (i != -1) {
                    cmdGroup.splice(i, 1);
                    if (cmdGroup.length == 1)
                        ckb[keyId] = cmdGroup[0];
                }
            }
        }
    };

    this.bindKey = function(key, command, position) {
        if (typeof key == "object" && key) {
            if (position == undefined)
                position = key.position;
            key = key[this.platform];
        }
        if (!key)
            return;
        if (typeof command == "function")
            return this.addCommand({exec: command, bindKey: key, name: command.name || key});
        
        key.split("|").forEach(function(keyPart) {
            var chain = "";
            if (keyPart.indexOf(" ") != -1) {
                var parts = keyPart.split(/\s+/);
                keyPart = parts.pop();
                parts.forEach(function(keyPart) {
                    var binding = this.parseKeys(keyPart);
                    var id = KEY_MODS[binding.hashId] + binding.key;
                    chain += (chain ? " " : "") + id;
                    this._addCommandToBinding(chain, "chainKeys");
                }, this);
                chain += " ";
            }
            var binding = this.parseKeys(keyPart);
            var id = KEY_MODS[binding.hashId] + binding.key;
            this._addCommandToBinding(chain + id, command, position);
        }, this);
    };
    
    function getPosition(command) {
        return typeof command == "object" && command.bindKey
            && command.bindKey.position 
            || (command.isDefault ? -100 : 0);
    }
    this._addCommandToBinding = function(keyId, command, position) {
        var ckb = this.commandKeyBinding, i;
        if (!command) {
            delete ckb[keyId];
        } else if (!ckb[keyId] || this.$singleCommand) {
            ckb[keyId] = command;
        } else {
            if (!Array.isArray(ckb[keyId])) {
                ckb[keyId] = [ckb[keyId]];
            } else if ((i = ckb[keyId].indexOf(command)) != -1) {
                ckb[keyId].splice(i, 1);
            }
            
            if (typeof position != "number") {
                position = getPosition(command);
            }

            var commands = ckb[keyId];
            for (i = 0; i < commands.length; i++) {
                var other = commands[i];
                var otherPos = getPosition(other);
                if (otherPos > position)
                    break;
            }
            commands.splice(i, 0, command);
        }
    };

    this.addCommands = function(commands) {
        commands && Object.keys(commands).forEach(function(name) {
            var command = commands[name];
            if (!command)
                return;
            
            if (typeof command === "string")
                return this.bindKey(command, name);

            if (typeof command === "function")
                command = { exec: command };

            if (typeof command !== "object")
                return;

            if (!command.name)
                command.name = name;

            this.addCommand(command);
        }, this);
    };

    this.removeCommands = function(commands) {
        Object.keys(commands).forEach(function(name) {
            this.removeCommand(commands[name]);
        }, this);
    };

    this.bindKeys = function(keyList) {
        Object.keys(keyList).forEach(function(key) {
            this.bindKey(key, keyList[key]);
        }, this);
    };

    this._buildKeyHash = function(command) {
        this.bindKey(command.bindKey, command);
    };
    this.parseKeys = function(keys) {
        var parts = keys.toLowerCase().split(/[\-\+]([\-\+])?/).filter(function(x){return x;});
        var key = parts.pop();

        var keyCode = keyUtil[key];
        if (keyUtil.FUNCTION_KEYS[keyCode])
            key = keyUtil.FUNCTION_KEYS[keyCode].toLowerCase();
        else if (!parts.length)
            return {key: key, hashId: -1};
        else if (parts.length == 1 && parts[0] == "shift")
            return {key: key.toUpperCase(), hashId: -1};

        var hashId = 0;
        for (var i = parts.length; i--;) {
            var modifier = keyUtil.KEY_MODS[parts[i]];
            if (modifier == null) {
                if (typeof console != "undefined")
                    console.error("invalid modifier " + parts[i] + " in " + keys);
                return false;
            }
            hashId |= modifier;
        }
        return {key: key, hashId: hashId};
    };

    this.findKeyCommand = function findKeyCommand(hashId, keyString) {
        var key = KEY_MODS[hashId] + keyString;
        return this.commandKeyBinding[key];
    };

    this.handleKeyboard = function(data, hashId, keyString, keyCode) {
        if (keyCode < 0) return;
        var key = KEY_MODS[hashId] + keyString;
        var command = this.commandKeyBinding[key];
        if (data.$keyChain) {
            data.$keyChain += " " + key;
            command = this.commandKeyBinding[data.$keyChain] || command;
        }
        
        if (command) {
            if (command == "chainKeys" || command[command.length - 1] == "chainKeys") {
                data.$keyChain = data.$keyChain || key;
                return {command: "null"};
            }
        }
        
        if (data.$keyChain) {
            if ((!hashId || hashId == 4) && keyString.length == 1)
                data.$keyChain = data.$keyChain.slice(0, -key.length - 1); // wait for input
            else if (hashId == -1 || keyCode > 0)
                data.$keyChain = ""; // reset keyChain
        }
        return {command: command};
    };
    
    this.getStatusText = function(editor, data) {
        return data.$keyChain || "";
    };

}).call(HashHandler.prototype);

exports.HashHandler = HashHandler;
exports.MultiHashHandler = MultiHashHandler;
});

ace.define("ace/commands/command_manager",["require","exports","module","ace/lib/oop","ace/keyboard/hash_handler","ace/lib/event_emitter"], function(require, exports, module) {
"use strict";

var oop = require("../lib/oop");
var MultiHashHandler = require("../keyboard/hash_handler").MultiHashHandler;
var EventEmitter = require("../lib/event_emitter").EventEmitter;

var CommandManager = function(platform, commands) {
    MultiHashHandler.call(this, commands, platform);
    this.byName = this.commands;
    this.setDefaultHandler("exec", function(e) {
        return e.command.exec(e.editor, e.args || {});
    });
};

oop.inherits(CommandManager, MultiHashHandler);

(function() {

    oop.implement(this, EventEmitter);

    this.exec = function(command, editor, args) {
        if (Array.isArray(command)) {
            for (var i = command.length; i--; ) {
                if (this.exec(command[i], editor, args)) return true;
            }
            return false;
        }

        if (typeof command === "string")
            command = this.commands[command];

        if (!command)
            return false;

        if (editor && editor.$readOnly && !command.readOnly)
            return false;

        if (command.isAvailable && !command.isAvailable(editor))
            return false;

        var e = {editor: editor, command: command, args: args};
        e.returnValue = this._emit("exec", e);
        this._signal("afterExec", e);

        return e.returnValue === false ? false : true;
    };

    this.toggleRecording = function(editor) {
        if (this.$inReplay)
            return;

        editor && editor._emit("changeStatus");
        if (this.recording) {
            this.macro.pop();
            this.removeEventListener("exec", this.$addCommandToMacro);

            if (!this.macro.length)
                this.macro = this.oldMacro;

            return this.recording = false;
        }
        if (!this.$addCommandToMacro) {
            this.$addCommandToMacro = function(e) {
                this.macro.push([e.command, e.args]);
            }.bind(this);
        }

        this.oldMacro = this.macro;
        this.macro = [];
        this.on("exec", this.$addCommandToMacro);
        return this.recording = true;
    };

    this.replay = function(editor) {
        if (this.$inReplay || !this.macro)
            return;

        if (this.recording)
            return this.toggleRecording(editor);

        try {
            this.$inReplay = true;
            this.macro.forEach(function(x) {
                if (typeof x == "string")
                    this.exec(x, editor);
                else
                    this.exec(x[0], editor, x[1]);
            }, this);
        } finally {
            this.$inReplay = false;
        }
    };

    this.trimMacro = function(m) {
        return m.map(function(x){
            if (typeof x[0] != "string")
                x[0] = x[0].name;
            if (!x[1])
                x = x[0];
            return x;
        });
    };

}).call(CommandManager.prototype);

exports.CommandManager = CommandManager;

});

ace.define("ace/commands/default_commands",["require","exports","module","ace/lib/lang","ace/config","ace/range"], function(require, exports, module) {
"use strict";

var lang = require("../lib/lang");
var config = require("../config");
var Range = require("../range").Range;

function bindKey(win, mac) {
    return {win: win, mac: mac};
}
exports.commands = [{
    name: "showSettingsMenu",
    bindKey: bindKey("Ctrl-,", "Command-,"),
    exec: function(editor) {
        config.loadModule("ace/ext/settings_menu", function(module) {
            module.init(editor);
            editor.showSettingsMenu();
        });
    },
    readOnly: true
}, {
    name: "goToNextError",
    bindKey: bindKey("Alt-E", "F4"),
    exec: function(editor) {
        config.loadModule("ace/ext/error_marker", function(module) {
            module.showErrorMarker(editor, 1);
        });
    },
    scrollIntoView: "animate",
    readOnly: true
}, {
    name: "goToPreviousError",
    bindKey: bindKey("Alt-Shift-E", "Shift-F4"),
    exec: function(editor) {
        config.loadModule("ace/ext/error_marker", function(module) {
            module.showErrorMarker(editor, -1);
        });
    },
    scrollIntoView: "animate",
    readOnly: true
}, {
    name: "selectall",
    bindKey: bindKey("Ctrl-A", "Command-A"),
    exec: function(editor) { editor.selectAll(); },
    readOnly: true
}, {
    name: "centerselection",
    bindKey: bindKey(null, "Ctrl-L"),
    exec: function(editor) { editor.centerSelection(); },
    readOnly: true
}, {
    name: "gotoline",
    bindKey: bindKey("Ctrl-L", "Command-L"),
    exec: function(editor) {
        var line = parseInt(prompt("Enter line number:"), 10);
        if (!isNaN(line)) {
            editor.gotoLine(line);
        }
    },
    readOnly: true
}, {
    name: "fold",
    bindKey: bindKey("Alt-L|Ctrl-F1", "Command-Alt-L|Command-F1"),
    exec: function(editor) { editor.session.toggleFold(false); },
    multiSelectAction: "forEach",
    scrollIntoView: "center",
    readOnly: true
}, {
    name: "unfold",
    bindKey: bindKey("Alt-Shift-L|Ctrl-Shift-F1", "Command-Alt-Shift-L|Command-Shift-F1"),
    exec: function(editor) { editor.session.toggleFold(true); },
    multiSelectAction: "forEach",
    scrollIntoView: "center",
    readOnly: true
}, {
    name: "toggleFoldWidget",
    bindKey: bindKey("F2", "F2"),
    exec: function(editor) { editor.session.toggleFoldWidget(); },
    multiSelectAction: "forEach",
    scrollIntoView: "center",
    readOnly: true
}, {
    name: "toggleParentFoldWidget",
    bindKey: bindKey("Alt-F2", "Alt-F2"),
    exec: function(editor) { editor.session.toggleFoldWidget(true); },
    multiSelectAction: "forEach",
    scrollIntoView: "center",
    readOnly: true
}, {
    name: "foldall",
    bindKey: bindKey(null, "Ctrl-Command-Option-0"),
    exec: function(editor) { editor.session.foldAll(); },
    scrollIntoView: "center",
    readOnly: true
}, {
    name: "foldOther",
    bindKey: bindKey("Alt-0", "Command-Option-0"),
    exec: function(editor) { 
        editor.session.foldAll();
        editor.session.unfold(editor.selection.getAllRanges());
    },
    scrollIntoView: "center",
    readOnly: true
}, {
    name: "unfoldall",
    bindKey: bindKey("Alt-Shift-0", "Command-Option-Shift-0"),
    exec: function(editor) { editor.session.unfold(); },
    scrollIntoView: "center",
    readOnly: true
}, {
    name: "findnext",
    bindKey: bindKey("Ctrl-K", "Command-G"),
    exec: function(editor) { editor.findNext(); },
    multiSelectAction: "forEach",
    scrollIntoView: "center",
    readOnly: true
}, {
    name: "findprevious",
    bindKey: bindKey("Ctrl-Shift-K", "Command-Shift-G"),
    exec: function(editor) { editor.findPrevious(); },
    multiSelectAction: "forEach",
    scrollIntoView: "center",
    readOnly: true
}, {
    name: "selectOrFindNext",
    bindKey: bindKey("Alt-K", "Ctrl-G"),
    exec: function(editor) {
        if (editor.selection.isEmpty())
            editor.selection.selectWord();
        else
            editor.findNext(); 
    },
    readOnly: true
}, {
    name: "selectOrFindPrevious",
    bindKey: bindKey("Alt-Shift-K", "Ctrl-Shift-G"),
    exec: function(editor) { 
        if (editor.selection.isEmpty())
            editor.selection.selectWord();
        else
            editor.findPrevious();
    },
    readOnly: true
}, {
    name: "find",
    bindKey: bindKey("Ctrl-F", "Command-F"),
    exec: function(editor) {
        config.loadModule("ace/ext/searchbox", function(e) {e.Search(editor);});
    },
    readOnly: true
}, {
    name: "overwrite",
    bindKey: "Insert",
    exec: function(editor) { editor.toggleOverwrite(); },
    readOnly: true
}, {
    name: "selecttostart",
    bindKey: bindKey("Ctrl-Shift-Home", "Command-Shift-Home|Command-Shift-Up"),
    exec: function(editor) { editor.getSelection().selectFileStart(); },
    multiSelectAction: "forEach",
    readOnly: true,
    scrollIntoView: "animate",
    aceCommandGroup: "fileJump"
}, {
    name: "gotostart",
    bindKey: bindKey("Ctrl-Home", "Command-Home|Command-Up"),
    exec: function(editor) { editor.navigateFileStart(); },
    multiSelectAction: "forEach",
    readOnly: true,
    scrollIntoView: "animate",
    aceCommandGroup: "fileJump"
}, {
    name: "selectup",
    bindKey: bindKey("Shift-Up", "Shift-Up|Ctrl-Shift-P"),
    exec: function(editor) { editor.getSelection().selectUp(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "golineup",
    bindKey: bindKey("Up", "Up|Ctrl-P"),
    exec: function(editor, args) { editor.navigateUp(args.times); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "selecttoend",
    bindKey: bindKey("Ctrl-Shift-End", "Command-Shift-End|Command-Shift-Down"),
    exec: function(editor) { editor.getSelection().selectFileEnd(); },
    multiSelectAction: "forEach",
    readOnly: true,
    scrollIntoView: "animate",
    aceCommandGroup: "fileJump"
}, {
    name: "gotoend",
    bindKey: bindKey("Ctrl-End", "Command-End|Command-Down"),
    exec: function(editor) { editor.navigateFileEnd(); },
    multiSelectAction: "forEach",
    readOnly: true,
    scrollIntoView: "animate",
    aceCommandGroup: "fileJump"
}, {
    name: "selectdown",
    bindKey: bindKey("Shift-Down", "Shift-Down|Ctrl-Shift-N"),
    exec: function(editor) { editor.getSelection().selectDown(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "golinedown",
    bindKey: bindKey("Down", "Down|Ctrl-N"),
    exec: function(editor, args) { editor.navigateDown(args.times); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "selectwordleft",
    bindKey: bindKey("Ctrl-Shift-Left", "Option-Shift-Left"),
    exec: function(editor) { editor.getSelection().selectWordLeft(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "gotowordleft",
    bindKey: bindKey("Ctrl-Left", "Option-Left"),
    exec: function(editor) { editor.navigateWordLeft(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "selecttolinestart",
    bindKey: bindKey("Alt-Shift-Left", "Command-Shift-Left|Ctrl-Shift-A"),
    exec: function(editor) { editor.getSelection().selectLineStart(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "gotolinestart",
    bindKey: bindKey("Alt-Left|Home", "Command-Left|Home|Ctrl-A"),
    exec: function(editor) { editor.navigateLineStart(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "selectleft",
    bindKey: bindKey("Shift-Left", "Shift-Left|Ctrl-Shift-B"),
    exec: function(editor) { editor.getSelection().selectLeft(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "gotoleft",
    bindKey: bindKey("Left", "Left|Ctrl-B"),
    exec: function(editor, args) { editor.navigateLeft(args.times); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "selectwordright",
    bindKey: bindKey("Ctrl-Shift-Right", "Option-Shift-Right"),
    exec: function(editor) { editor.getSelection().selectWordRight(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "gotowordright",
    bindKey: bindKey("Ctrl-Right", "Option-Right"),
    exec: function(editor) { editor.navigateWordRight(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "selecttolineend",
    bindKey: bindKey("Alt-Shift-Right", "Command-Shift-Right|Shift-End|Ctrl-Shift-E"),
    exec: function(editor) { editor.getSelection().selectLineEnd(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "gotolineend",
    bindKey: bindKey("Alt-Right|End", "Command-Right|End|Ctrl-E"),
    exec: function(editor) { editor.navigateLineEnd(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "selectright",
    bindKey: bindKey("Shift-Right", "Shift-Right"),
    exec: function(editor) { editor.getSelection().selectRight(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "gotoright",
    bindKey: bindKey("Right", "Right|Ctrl-F"),
    exec: function(editor, args) { editor.navigateRight(args.times); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "selectpagedown",
    bindKey: "Shift-PageDown",
    exec: function(editor) { editor.selectPageDown(); },
    readOnly: true
}, {
    name: "pagedown",
    bindKey: bindKey(null, "Option-PageDown"),
    exec: function(editor) { editor.scrollPageDown(); },
    readOnly: true
}, {
    name: "gotopagedown",
    bindKey: bindKey("PageDown", "PageDown|Ctrl-V"),
    exec: function(editor) { editor.gotoPageDown(); },
    readOnly: true
}, {
    name: "selectpageup",
    bindKey: "Shift-PageUp",
    exec: function(editor) { editor.selectPageUp(); },
    readOnly: true
}, {
    name: "pageup",
    bindKey: bindKey(null, "Option-PageUp"),
    exec: function(editor) { editor.scrollPageUp(); },
    readOnly: true
}, {
    name: "gotopageup",
    bindKey: "PageUp",
    exec: function(editor) { editor.gotoPageUp(); },
    readOnly: true
}, {
    name: "scrollup",
    bindKey: bindKey("Ctrl-Up", null),
    exec: function(e) { e.renderer.scrollBy(0, -2 * e.renderer.layerConfig.lineHeight); },
    readOnly: true
}, {
    name: "scrolldown",
    bindKey: bindKey("Ctrl-Down", null),
    exec: function(e) { e.renderer.scrollBy(0, 2 * e.renderer.layerConfig.lineHeight); },
    readOnly: true
}, {
    name: "selectlinestart",
    bindKey: "Shift-Home",
    exec: function(editor) { editor.getSelection().selectLineStart(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "selectlineend",
    bindKey: "Shift-End",
    exec: function(editor) { editor.getSelection().selectLineEnd(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "togglerecording",
    bindKey: bindKey("Ctrl-Alt-E", "Command-Option-E"),
    exec: function(editor) { editor.commands.toggleRecording(editor); },
    readOnly: true
}, {
    name: "replaymacro",
    bindKey: bindKey("Ctrl-Shift-E", "Command-Shift-E"),
    exec: function(editor) { editor.commands.replay(editor); },
    readOnly: true
}, {
    name: "jumptomatching",
    bindKey: bindKey("Ctrl-P", "Ctrl-P"),
    exec: function(editor) { editor.jumpToMatching(); },
    multiSelectAction: "forEach",
    scrollIntoView: "animate",
    readOnly: true
}, {
    name: "selecttomatching",
    bindKey: bindKey("Ctrl-Shift-P", "Ctrl-Shift-P"),
    exec: function(editor) { editor.jumpToMatching(true); },
    multiSelectAction: "forEach",
    scrollIntoView: "animate",
    readOnly: true
}, {
    name: "expandToMatching",
    bindKey: bindKey("Ctrl-Shift-M", "Ctrl-Shift-M"),
    exec: function(editor) { editor.jumpToMatching(true, true); },
    multiSelectAction: "forEach",
    scrollIntoView: "animate",
    readOnly: true
}, {
    name: "passKeysToBrowser",
    bindKey: bindKey(null, null),
    exec: function() {},
    passEvent: true,
    readOnly: true
}, {
    name: "copy",
    exec: function(editor) {
    },
    readOnly: true
},
{
    name: "cut",
    exec: function(editor) {
        var range = editor.getSelectionRange();
        editor._emit("cut", range);

        if (!editor.selection.isEmpty()) {
            editor.session.remove(range);
            editor.clearSelection();
        }
    },
    scrollIntoView: "cursor",
    multiSelectAction: "forEach"
}, {
    name: "paste",
    exec: function(editor, args) {
        editor.$handlePaste(args);
    },
    scrollIntoView: "cursor"
}, {
    name: "removeline",
    bindKey: bindKey("Ctrl-D", "Command-D"),
    exec: function(editor) { editor.removeLines(); },
    scrollIntoView: "cursor",
    multiSelectAction: "forEachLine"
}, {
    name: "duplicateSelection",
    bindKey: bindKey("Ctrl-Shift-D", "Command-Shift-D"),
    exec: function(editor) { editor.duplicateSelection(); },
    scrollIntoView: "cursor",
    multiSelectAction: "forEach"
}, {
    name: "sortlines",
    bindKey: bindKey("Ctrl-Alt-S", "Command-Alt-S"),
    exec: function(editor) { editor.sortLines(); },
    scrollIntoView: "selection",
    multiSelectAction: "forEachLine"
}, {
    name: "togglecomment",
    bindKey: bindKey("Ctrl-/", "Command-/"),
    exec: function(editor) { editor.toggleCommentLines(); },
    multiSelectAction: "forEachLine",
    scrollIntoView: "selectionPart"
}, {
    name: "toggleBlockComment",
    bindKey: bindKey("Ctrl-Shift-/", "Command-Shift-/"),
    exec: function(editor) { editor.toggleBlockComment(); },
    multiSelectAction: "forEach",
    scrollIntoView: "selectionPart"
}, {
    name: "modifyNumberUp",
    bindKey: bindKey("Ctrl-Shift-Up", "Alt-Shift-Up"),
    exec: function(editor) { editor.modifyNumber(1); },
    scrollIntoView: "cursor",
    multiSelectAction: "forEach"
}, {
    name: "modifyNumberDown",
    bindKey: bindKey("Ctrl-Shift-Down", "Alt-Shift-Down"),
    exec: function(editor) { editor.modifyNumber(-1); },
    scrollIntoView: "cursor",
    multiSelectAction: "forEach"
}, {
    name: "replace",
    bindKey: bindKey("Ctrl-H", "Command-Option-F"),
    exec: function(editor) {
        config.loadModule("ace/ext/searchbox", function(e) {e.Search(editor, true);});
    }
}, {
    name: "undo",
    bindKey: bindKey("Ctrl-Z", "Command-Z"),
    exec: function(editor) { editor.undo(); }
}, {
    name: "redo",
    bindKey: bindKey("Ctrl-Shift-Z|Ctrl-Y", "Command-Shift-Z|Command-Y"),
    exec: function(editor) { editor.redo(); }
}, {
    name: "copylinesup",
    bindKey: bindKey("Alt-Shift-Up", "Command-Option-Up"),
    exec: function(editor) { editor.copyLinesUp(); },
    scrollIntoView: "cursor"
}, {
    name: "movelinesup",
    bindKey: bindKey("Alt-Up", "Option-Up"),
    exec: function(editor) { editor.moveLinesUp(); },
    scrollIntoView: "cursor"
}, {
    name: "copylinesdown",
    bindKey: bindKey("Alt-Shift-Down", "Command-Option-Down"),
    exec: function(editor) { editor.copyLinesDown(); },
    scrollIntoView: "cursor"
}, {
    name: "movelinesdown",
    bindKey: bindKey("Alt-Down", "Option-Down"),
    exec: function(editor) { editor.moveLinesDown(); },
    scrollIntoView: "cursor"
}, {
    name: "del",
    bindKey: bindKey("Delete", "Delete|Ctrl-D|Shift-Delete"),
    exec: function(editor) { editor.remove("right"); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "backspace",
    bindKey: bindKey(
        "Shift-Backspace|Backspace",
        "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"
    ),
    exec: function(editor) { editor.remove("left"); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "cut_or_delete",
    bindKey: bindKey("Shift-Delete", null),
    exec: function(editor) { 
        if (editor.selection.isEmpty()) {
            editor.remove("left");
        } else {
            return false;
        }
    },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "removetolinestart",
    bindKey: bindKey("Alt-Backspace", "Command-Backspace"),
    exec: function(editor) { editor.removeToLineStart(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "removetolineend",
    bindKey: bindKey("Alt-Delete", "Ctrl-K|Command-Delete"),
    exec: function(editor) { editor.removeToLineEnd(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "removetolinestarthard",
    bindKey: bindKey("Ctrl-Shift-Backspace", null),
    exec: function(editor) {
        var range = editor.selection.getRange();
        range.start.column = 0;
        editor.session.remove(range);
    },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "removetolineendhard",
    bindKey: bindKey("Ctrl-Shift-Delete", null),
    exec: function(editor) {
        var range = editor.selection.getRange();
        range.end.column = Number.MAX_VALUE;
        editor.session.remove(range);
    },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "removewordleft",
    bindKey: bindKey("Ctrl-Backspace", "Alt-Backspace|Ctrl-Alt-Backspace"),
    exec: function(editor) { editor.removeWordLeft(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "removewordright",
    bindKey: bindKey("Ctrl-Delete", "Alt-Delete"),
    exec: function(editor) { editor.removeWordRight(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "outdent",
    bindKey: bindKey("Shift-Tab", "Shift-Tab"),
    exec: function(editor) { editor.blockOutdent(); },
    multiSelectAction: "forEach",
    scrollIntoView: "selectionPart"
}, {
    name: "indent",
    bindKey: bindKey("Tab", "Tab"),
    exec: function(editor) { editor.indent(); },
    multiSelectAction: "forEach",
    scrollIntoView: "selectionPart"
}, {
    name: "blockoutdent",
    bindKey: bindKey("Ctrl-[", "Ctrl-["),
    exec: function(editor) { editor.blockOutdent(); },
    multiSelectAction: "forEachLine",
    scrollIntoView: "selectionPart"
}, {
    name: "blockindent",
    bindKey: bindKey("Ctrl-]", "Ctrl-]"),
    exec: function(editor) { editor.blockIndent(); },
    multiSelectAction: "forEachLine",
    scrollIntoView: "selectionPart"
}, {
    name: "insertstring",
    exec: function(editor, str) { editor.insert(str); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "inserttext",
    exec: function(editor, args) {
        editor.insert(lang.stringRepeat(args.text  || "", args.times || 1));
    },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "splitline",
    bindKey: bindKey(null, "Ctrl-O"),
    exec: function(editor) { editor.splitLine(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "transposeletters",
    bindKey: bindKey("Alt-Shift-X", "Ctrl-T"),
    exec: function(editor) { editor.transposeLetters(); },
    multiSelectAction: function(editor) {editor.transposeSelections(1); },
    scrollIntoView: "cursor"
}, {
    name: "touppercase",
    bindKey: bindKey("Ctrl-U", "Ctrl-U"),
    exec: function(editor) { editor.toUpperCase(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "tolowercase",
    bindKey: bindKey("Ctrl-Shift-U", "Ctrl-Shift-U"),
    exec: function(editor) { editor.toLowerCase(); },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
}, {
    name: "expandtoline",
    bindKey: bindKey("Ctrl-Shift-L", "Command-Shift-L"),
    exec: function(editor) {
        var range = editor.selection.getRange();

        range.start.column = range.end.column = 0;
        range.end.row++;
        editor.selection.setRange(range, false);
    },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "joinlines",
    bindKey: bindKey(null, null),
    exec: function(editor) {
        var isBackwards = editor.selection.isBackwards();
        var selectionStart = isBackwards ? editor.selection.getSelectionLead() : editor.selection.getSelectionAnchor();
        var selectionEnd = isBackwards ? editor.selection.getSelectionAnchor() : editor.selection.getSelectionLead();
        var firstLineEndCol = editor.session.doc.getLine(selectionStart.row).length;
        var selectedText = editor.session.doc.getTextRange(editor.selection.getRange());
        var selectedCount = selectedText.replace(/\n\s*/, " ").length;
        var insertLine = editor.session.doc.getLine(selectionStart.row);

        for (var i = selectionStart.row + 1; i <= selectionEnd.row + 1; i++) {
            var curLine = lang.stringTrimLeft(lang.stringTrimRight(editor.session.doc.getLine(i)));
            if (curLine.length !== 0) {
                curLine = " " + curLine;
            }
            insertLine += curLine;
        }

        if (selectionEnd.row + 1 < (editor.session.doc.getLength() - 1)) {
            insertLine += editor.session.doc.getNewLineCharacter();
        }

        editor.clearSelection();
        editor.session.doc.replace(new Range(selectionStart.row, 0, selectionEnd.row + 2, 0), insertLine);

        if (selectedCount > 0) {
            editor.selection.moveCursorTo(selectionStart.row, selectionStart.column);
            editor.selection.selectTo(selectionStart.row, selectionStart.column + selectedCount);
        } else {
            firstLineEndCol = editor.session.doc.getLine(selectionStart.row).length > firstLineEndCol ? (firstLineEndCol + 1) : firstLineEndCol;
            editor.selection.moveCursorTo(selectionStart.row, firstLineEndCol);
        }
    },
    multiSelectAction: "forEach",
    readOnly: true
}, {
    name: "invertSelection",
    bindKey: bindKey(null, null),
    exec: function(editor) {
        var endRow = editor.session.doc.getLength() - 1;
        var endCol = editor.session.doc.getLine(endRow).length;
        var ranges = editor.selection.rangeList.ranges;
        var newRanges = [];
        if (ranges.length < 1) {
            ranges = [editor.selection.getRange()];
        }

        for (var i = 0; i < ranges.length; i++) {
            if (i == (ranges.length - 1)) {
                if (!(ranges[i].end.row === endRow && ranges[i].end.column === endCol)) {
                    newRanges.push(new Range(ranges[i].end.row, ranges[i].end.column, endRow, endCol));
                }
            }

            if (i === 0) {
                if (!(ranges[i].start.row === 0 && ranges[i].start.column === 0)) {
                    newRanges.push(new Range(0, 0, ranges[i].start.row, ranges[i].start.column));
                }
            } else {
                newRanges.push(new Range(ranges[i-1].end.row, ranges[i-1].end.column, ranges[i].start.row, ranges[i].start.column));
            }
        }

        editor.exitMultiSelectMode();
        editor.clearSelection();

        for(var i = 0; i < newRanges.length; i++) {
            editor.selection.addRange(newRanges[i], false);
        }
    },
    readOnly: true,
    scrollIntoView: "none"
}];

});

ace.define("ace/editor",["require","exports","module","ace/lib/fixoldbrowsers","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/useragent","ace/keyboard/textinput","ace/mouse/mouse_handler","ace/mouse/fold_handler","ace/keyboard/keybinding","ace/edit_session","ace/search","ace/range","ace/lib/event_emitter","ace/commands/command_manager","ace/commands/default_commands","ace/config","ace/token_iterator"], function(require, exports, module) {
"use strict";

require("./lib/fixoldbrowsers");

var oop = require("./lib/oop");
var dom = require("./lib/dom");
var lang = require("./lib/lang");
var useragent = require("./lib/useragent");
var TextInput = require("./keyboard/textinput").TextInput;
var MouseHandler = require("./mouse/mouse_handler").MouseHandler;
var FoldHandler = require("./mouse/fold_handler").FoldHandler;
var KeyBinding = require("./keyboard/keybinding").KeyBinding;
var EditSession = require("./edit_session").EditSession;
var Search = require("./search").Search;
var Range = require("./range").Range;
var EventEmitter = require("./lib/event_emitter").EventEmitter;
var CommandManager = require("./commands/command_manager").CommandManager;
var defaultCommands = require("./commands/default_commands").commands;
var config = require("./config");
var TokenIterator = require("./token_iterator").TokenIterator;
var Editor = function(renderer, session) {
    var container = renderer.getContainerElement();
    this.container = container;
    this.renderer = renderer;
    this.id = "editor" + (++Editor.$uid);

    this.commands = new CommandManager(useragent.isMac ? "mac" : "win", defaultCommands);
    if (typeof document == "object") {
        this.textInput  = new TextInput(renderer.getTextAreaContainer(), this);
        this.renderer.textarea = this.textInput.getElement();
        this.$mouseHandler = new MouseHandler(this);
        new FoldHandler(this);
    }

    this.keyBinding = new KeyBinding(this);

    this.$blockScrolling = 0;
    this.$search = new Search().set({
        wrap: true
    });

    this.$historyTracker = this.$historyTracker.bind(this);
    this.commands.on("exec", this.$historyTracker);

    this.$initOperationListeners();
    
    this._$emitInputEvent = lang.delayedCall(function() {
        this._signal("input", {});
        if (this.session && this.session.bgTokenizer)
            this.session.bgTokenizer.scheduleStart();
    }.bind(this));
    
    this.on("change", function(_, _self) {
        _self._$emitInputEvent.schedule(31);
    });

    this.setSession(session || new EditSession(""));
    config.resetOptions(this);
    config._signal("editor", this);
};

Editor.$uid = 0;

(function(){

    oop.implement(this, EventEmitter);

    this.$initOperationListeners = function() {
        function last(a) {return a[a.length - 1];}

        this.selections = [];
        this.commands.on("exec", this.startOperation.bind(this), true);
        this.commands.on("afterExec", this.endOperation.bind(this), true);

        this.$opResetTimer = lang.delayedCall(this.endOperation.bind(this));

        this.on("change", function() {
            this.curOp || this.startOperation();
            this.curOp.docChanged = true;
        }.bind(this), true);

        this.on("changeSelection", function() {
            this.curOp || this.startOperation();
            this.curOp.selectionChanged = true;
        }.bind(this), true);
    };

    this.curOp = null;
    this.prevOp = {};
    this.startOperation = function(commadEvent) {
        if (this.curOp) {
            if (!commadEvent || this.curOp.command)
                return;
            this.prevOp = this.curOp;
        }
        if (!commadEvent) {
            this.previousCommand = null;
            commadEvent = {};
        }

        this.$opResetTimer.schedule();
        this.curOp = {
            command: commadEvent.command || {},
            args: commadEvent.args,
            scrollTop: this.renderer.scrollTop
        };
        if (this.curOp.command.name && this.curOp.command.scrollIntoView !== undefined)
            this.$blockScrolling++;
    };

    this.endOperation = function(e) {
        if (this.curOp) {
            if (e && e.returnValue === false)
                return this.curOp = null;
            this._signal("beforeEndOperation");
            var command = this.curOp.command;
            if (command.name && this.$blockScrolling > 0)
                this.$blockScrolling--;
            var scrollIntoView = command && command.scrollIntoView;
            if (scrollIntoView) {
                switch (scrollIntoView) {
                    case "center-animate":
                        scrollIntoView = "animate";
                    case "center":
                        this.renderer.scrollCursorIntoView(null, 0.5);
                        break;
                    case "animate":
                    case "cursor":
                        this.renderer.scrollCursorIntoView();
                        break;
                    case "selectionPart":
                        var range = this.selection.getRange();
                        var config = this.renderer.layerConfig;
                        if (range.start.row >= config.lastRow || range.end.row <= config.firstRow) {
                            this.renderer.scrollSelectionIntoView(this.selection.anchor, this.selection.lead);
                        }
                        break;
                    default:
                        break;
                }
                if (scrollIntoView == "animate")
                    this.renderer.animateScrolling(this.curOp.scrollTop);
            }
            
            this.prevOp = this.curOp;
            this.curOp = null;
        }
    };
    this.$mergeableCommands = ["backspace", "del", "insertstring"];
    this.$historyTracker = function(e) {
        if (!this.$mergeUndoDeltas)
            return;

        var prev = this.prevOp;
        var mergeableCommands = this.$mergeableCommands;
        var shouldMerge = prev.command && (e.command.name == prev.command.name);
        if (e.command.name == "insertstring") {
            var text = e.args;
            if (this.mergeNextCommand === undefined)
                this.mergeNextCommand = true;

            shouldMerge = shouldMerge
                && this.mergeNextCommand // previous command allows to coalesce with
                && (!/\s/.test(text) || /\s/.test(prev.args)); // previous insertion was of same type

            this.mergeNextCommand = true;
        } else {
            shouldMerge = shouldMerge
                && mergeableCommands.indexOf(e.command.name) !== -1; // the command is mergeable
        }

        if (
            this.$mergeUndoDeltas != "always"
            && Date.now() - this.sequenceStartTime > 2000
        ) {
            shouldMerge = false; // the sequence is too long
        }

        if (shouldMerge)
            this.session.mergeUndoDeltas = true;
        else if (mergeableCommands.indexOf(e.command.name) !== -1)
            this.sequenceStartTime = Date.now();
    };
    this.setKeyboardHandler = function(keyboardHandler, cb) {
        if (keyboardHandler && typeof keyboardHandler === "string") {
            this.$keybindingId = keyboardHandler;
            var _self = this;
            config.loadModule(["keybinding", keyboardHandler], function(module) {
                if (_self.$keybindingId == keyboardHandler)
                    _self.keyBinding.setKeyboardHandler(module && module.handler);
                cb && cb();
            });
        } else {
            this.$keybindingId = null;
            this.keyBinding.setKeyboardHandler(keyboardHandler);
            cb && cb();
        }
    };
    this.getKeyboardHandler = function() {
        return this.keyBinding.getKeyboardHandler();
    };
    this.setSession = function(session) {
        if (this.session == session)
            return;
        if (this.curOp) this.endOperation();
        this.curOp = {};

        var oldSession = this.session;
        if (oldSession) {
            this.session.off("change", this.$onDocumentChange);
            this.session.off("changeMode", this.$onChangeMode);
            this.session.off("tokenizerUpdate", this.$onTokenizerUpdate);
            this.session.off("changeTabSize", this.$onChangeTabSize);
            this.session.off("changeWrapLimit", this.$onChangeWrapLimit);
            this.session.off("changeWrapMode", this.$onChangeWrapMode);
            this.session.off("changeFold", this.$onChangeFold);
            this.session.off("changeFrontMarker", this.$onChangeFrontMarker);
            this.session.off("changeBackMarker", this.$onChangeBackMarker);
            this.session.off("changeBreakpoint", this.$onChangeBreakpoint);
            this.session.off("changeAnnotation", this.$onChangeAnnotation);
            this.session.off("changeOverwrite", this.$onCursorChange);
            this.session.off("changeScrollTop", this.$onScrollTopChange);
            this.session.off("changeScrollLeft", this.$onScrollLeftChange);

            var selection = this.session.getSelection();
            selection.off("changeCursor", this.$onCursorChange);
            selection.off("changeSelection", this.$onSelectionChange);
        }

        this.session = session;
        if (session) {
            this.$onDocumentChange = this.onDocumentChange.bind(this);
            session.on("change", this.$onDocumentChange);
            this.renderer.setSession(session);
    
            this.$onChangeMode = this.onChangeMode.bind(this);
            session.on("changeMode", this.$onChangeMode);
    
            this.$onTokenizerUpdate = this.onTokenizerUpdate.bind(this);
            session.on("tokenizerUpdate", this.$onTokenizerUpdate);
    
            this.$onChangeTabSize = this.renderer.onChangeTabSize.bind(this.renderer);
            session.on("changeTabSize", this.$onChangeTabSize);
    
            this.$onChangeWrapLimit = this.onChangeWrapLimit.bind(this);
            session.on("changeWrapLimit", this.$onChangeWrapLimit);
    
            this.$onChangeWrapMode = this.onChangeWrapMode.bind(this);
            session.on("changeWrapMode", this.$onChangeWrapMode);
    
            this.$onChangeFold = this.onChangeFold.bind(this);
            session.on("changeFold", this.$onChangeFold);
    
            this.$onChangeFrontMarker = this.onChangeFrontMarker.bind(this);
            this.session.on("changeFrontMarker", this.$onChangeFrontMarker);
    
            this.$onChangeBackMarker = this.onChangeBackMarker.bind(this);
            this.session.on("changeBackMarker", this.$onChangeBackMarker);
    
            this.$onChangeBreakpoint = this.onChangeBreakpoint.bind(this);
            this.session.on("changeBreakpoint", this.$onChangeBreakpoint);
    
            this.$onChangeAnnotation = this.onChangeAnnotation.bind(this);
            this.session.on("changeAnnotation", this.$onChangeAnnotation);
    
            this.$onCursorChange = this.onCursorChange.bind(this);
            this.session.on("changeOverwrite", this.$onCursorChange);
    
            this.$onScrollTopChange = this.onScrollTopChange.bind(this);
            this.session.on("changeScrollTop", this.$onScrollTopChange);
    
            this.$onScrollLeftChange = this.onScrollLeftChange.bind(this);
            this.session.on("changeScrollLeft", this.$onScrollLeftChange);
    
            this.selection = session.getSelection();
            this.selection.on("changeCursor", this.$onCursorChange);
    
            this.$onSelectionChange = this.onSelectionChange.bind(this);
            this.selection.on("changeSelection", this.$onSelectionChange);
    
            this.onChangeMode();
    
            this.$blockScrolling += 1;
            this.onCursorChange();
            this.$blockScrolling -= 1;
    
            this.onScrollTopChange();
            this.onScrollLeftChange();
            this.onSelectionChange();
            this.onChangeFrontMarker();
            this.onChangeBackMarker();
            this.onChangeBreakpoint();
            this.onChangeAnnotation();
            this.session.getUseWrapMode() && this.renderer.adjustWrapLimit();
            this.renderer.updateFull();
        } else {
            this.selection = null;
            this.renderer.setSession(session);
        }

        this._signal("changeSession", {
            session: session,
            oldSession: oldSession
        });
        
        this.curOp = null;
        
        oldSession && oldSession._signal("changeEditor", {oldEditor: this});
        session && session._signal("changeEditor", {editor: this});
        
        if (session && session.bgTokenizer)
            session.bgTokenizer.scheduleStart();
    };
    this.getSession = function() {
        return this.session;
    };
    this.setValue = function(val, cursorPos) {
        this.session.doc.setValue(val);

        if (!cursorPos)
            this.selectAll();
        else if (cursorPos == 1)
            this.navigateFileEnd();
        else if (cursorPos == -1)
            this.navigateFileStart();

        return val;
    };
    this.getValue = function() {
        return this.session.getValue();
    };
    this.getSelection = function() {
        return this.selection;
    };
    this.resize = function(force) {
        this.renderer.onResize(force);
    };
    this.setTheme = function(theme, cb) {
        this.renderer.setTheme(theme, cb);
    };
    this.getTheme = function() {
        return this.renderer.getTheme();
    };
    this.setStyle = function(style) {
        this.renderer.setStyle(style);
    };
    this.unsetStyle = function(style) {
        this.renderer.unsetStyle(style);
    };
    this.getFontSize = function () {
        return this.getOption("fontSize") ||
           dom.computedStyle(this.container, "fontSize");
    };
    this.setFontSize = function(size) {
        this.setOption("fontSize", size);
    };

    this.$highlightBrackets = function() {
        if (this.session.$bracketHighlight) {
            this.session.removeMarker(this.session.$bracketHighlight);
            this.session.$bracketHighlight = null;
        }

        if (this.$highlightPending) {
            return;
        }
        var self = this;
        this.$highlightPending = true;
        setTimeout(function() {
            self.$highlightPending = false;
            var session = self.session;
            if (!session || !session.bgTokenizer) return;
            var pos = session.findMatchingBracket(self.getCursorPosition());
            if (pos) {
                var range = new Range(pos.row, pos.column, pos.row, pos.column + 1);
            } else if (session.$mode.getMatching) {
                var range = session.$mode.getMatching(self.session);
            }
            if (range)
                session.$bracketHighlight = session.addMarker(range, "ace_bracket", "text");
        }, 50);
    };
    this.$highlightTags = function() {
        if (this.$highlightTagPending)
            return;
        var self = this;
        this.$highlightTagPending = true;
        setTimeout(function() {
            self.$highlightTagPending = false;
            
            var session = self.session;
            if (!session || !session.bgTokenizer) return;
            
            var pos = self.getCursorPosition();
            var iterator = new TokenIterator(self.session, pos.row, pos.column);
            var token = iterator.getCurrentToken();
            
            if (!token || !/\b(?:tag-open|tag-name)/.test(token.type)) {
                session.removeMarker(session.$tagHighlight);
                session.$tagHighlight = null;
                return;
            }
            
            if (token.type.indexOf("tag-open") != -1) {
                token = iterator.stepForward();
                if (!token)
                    return;
            }
            
            var tag = token.value;
            var depth = 0;
            var prevToken = iterator.stepBackward();
            
            if (prevToken.value == '<'){
                do {
                    prevToken = token;
                    token = iterator.stepForward();
                    
                    if (token && token.value === tag && token.type.indexOf('tag-name') !== -1) {
                        if (prevToken.value === '<'){
                            depth++;
                        } else if (prevToken.value === '</'){
                            depth--;
                        }
                    }
                    
                } while (token && depth >= 0);
            } else {
                do {
                    token = prevToken;
                    prevToken = iterator.stepBackward();
                    
                    if (token && token.value === tag && token.type.indexOf('tag-name') !== -1) {
                        if (prevToken.value === '<') {
                            depth++;
                        } else if (prevToken.value === '</') {
                            depth--;
                        }
                    }
                } while (prevToken && depth <= 0);
                iterator.stepForward();
            }
            
            if (!token) {
                session.removeMarker(session.$tagHighlight);
                session.$tagHighlight = null;
                return;
            }
            
            var row = iterator.getCurrentTokenRow();
            var column = iterator.getCurrentTokenColumn();
            var range = new Range(row, column, row, column+token.value.length);
            var sbm = session.$backMarkers[session.$tagHighlight];
            if (session.$tagHighlight && sbm != undefined && range.compareRange(sbm.range) !== 0) {
                session.removeMarker(session.$tagHighlight);
                session.$tagHighlight = null;
            }
            
            if (range && !session.$tagHighlight)
                session.$tagHighlight = session.addMarker(range, "ace_bracket", "text");
        }, 50);
    };
    this.focus = function() {
        var _self = this;
        setTimeout(function() {
            _self.textInput.focus();
        });
        this.textInput.focus();
    };
    this.isFocused = function() {
        return this.textInput.isFocused();
    };
    this.blur = function() {
        this.textInput.blur();
    };
    this.onFocus = function(e) {
        if (this.$isFocused)
            return;
        this.$isFocused = true;
        this.renderer.showCursor();
        this.renderer.visualizeFocus();
        this._emit("focus", e);
    };
    this.onBlur = function(e) {
        if (!this.$isFocused)
            return;
        this.$isFocused = false;
        this.renderer.hideCursor();
        this.renderer.visualizeBlur();
        this._emit("blur", e);
    };

    this.$cursorChange = function() {
        this.renderer.updateCursor();
    };
    this.onDocumentChange = function(delta) {
        var wrap = this.session.$useWrapMode;
        var lastRow = (delta.start.row == delta.end.row ? delta.end.row : Infinity);
        this.renderer.updateLines(delta.start.row, lastRow, wrap);

        this._signal("change", delta);
        this.$cursorChange();
        this.$updateHighlightActiveLine();
    };

    this.onTokenizerUpdate = function(e) {
        var rows = e.data;
        this.renderer.updateLines(rows.first, rows.last);
    };


    this.onScrollTopChange = function() {
        this.renderer.scrollToY(this.session.getScrollTop());
    };

    this.onScrollLeftChange = function() {
        this.renderer.scrollToX(this.session.getScrollLeft());
    };
    this.onCursorChange = function() {
        this.$cursorChange();

        if (!this.$blockScrolling) {
            config.warn("Automatically scrolling cursor into view after selection change",
                "this will be disabled in the next version",
                "set editor.$blockScrolling = Infinity to disable this message"
            );
            this.renderer.scrollCursorIntoView();
        }

        this.$highlightBrackets();
        this.$highlightTags();
        this.$updateHighlightActiveLine();
        this._signal("changeSelection");
    };

    this.$updateHighlightActiveLine = function() {
        var session = this.getSession();

        var highlight;
        if (this.$highlightActiveLine) {
            if ((this.$selectionStyle != "line" || !this.selection.isMultiLine()))
                highlight = this.getCursorPosition();
            if (this.renderer.$maxLines && this.session.getLength() === 1 && !(this.renderer.$minLines > 1))
                highlight = false;
        }

        if (session.$highlightLineMarker && !highlight) {
            session.removeMarker(session.$highlightLineMarker.id);
            session.$highlightLineMarker = null;
        } else if (!session.$highlightLineMarker && highlight) {
            var range = new Range(highlight.row, highlight.column, highlight.row, Infinity);
            range.id = session.addMarker(range, "ace_active-line", "screenLine");
            session.$highlightLineMarker = range;
        } else if (highlight) {
            session.$highlightLineMarker.start.row = highlight.row;
            session.$highlightLineMarker.end.row = highlight.row;
            session.$highlightLineMarker.start.column = highlight.column;
            session._signal("changeBackMarker");
        }
    };

    this.onSelectionChange = function(e) {
        var session = this.session;

        if (session.$selectionMarker) {
            session.removeMarker(session.$selectionMarker);
        }
        session.$selectionMarker = null;

        if (!this.selection.isEmpty()) {
            var range = this.selection.getRange();
            var style = this.getSelectionStyle();
            session.$selectionMarker = session.addMarker(range, "ace_selection", style);
        } else {
            this.$updateHighlightActiveLine();
        }

        var re = this.$highlightSelectedWord && this.$getSelectionHighLightRegexp();
        this.session.highlight(re);

        this._signal("changeSelection");
    };

    this.$getSelectionHighLightRegexp = function() {
        var session = this.session;

        var selection = this.getSelectionRange();
        if (selection.isEmpty() || selection.isMultiLine())
            return;

        var startOuter = selection.start.column - 1;
        var endOuter = selection.end.column + 1;
        var line = session.getLine(selection.start.row);
        var lineCols = line.length;
        var needle = line.substring(Math.max(startOuter, 0),
                                    Math.min(endOuter, lineCols));
        if ((startOuter >= 0 && /^[\w\d]/.test(needle)) ||
            (endOuter <= lineCols && /[\w\d]$/.test(needle)))
            return;

        needle = line.substring(selection.start.column, selection.end.column);
        if (!/^[\w\d]+$/.test(needle))
            return;

        var re = this.$search.$assembleRegExp({
            wholeWord: true,
            caseSensitive: true,
            needle: needle
        });

        return re;
    };


    this.onChangeFrontMarker = function() {
        this.renderer.updateFrontMarkers();
    };

    this.onChangeBackMarker = function() {
        this.renderer.updateBackMarkers();
    };


    this.onChangeBreakpoint = function() {
        this.renderer.updateBreakpoints();
    };

    this.onChangeAnnotation = function() {
        this.renderer.setAnnotations(this.session.getAnnotations());
    };


    this.onChangeMode = function(e) {
        this.renderer.updateText();
        this._emit("changeMode", e);
    };


    this.onChangeWrapLimit = function() {
        this.renderer.updateFull();
    };

    this.onChangeWrapMode = function() {
        this.renderer.onResize(true);
    };


    this.onChangeFold = function() {
        this.$updateHighlightActiveLine();
        this.renderer.updateFull();
    };
    this.getSelectedText = function() {
        return this.session.getTextRange(this.getSelectionRange());
    };
    this.getCopyText = function() {
        var text = this.getSelectedText();
        this._signal("copy", text);
        return text;
    };
    this.onCopy = function() {
        this.commands.exec("copy", this);
    };
    this.onCut = function() {
        this.commands.exec("cut", this);
    };
    this.onPaste = function(text, event) {
        var e = {text: text, event: event};
        this.commands.exec("paste", this, e);
    };
    
    this.$handlePaste = function(e) {
        if (typeof e == "string") 
            e = {text: e};
        this._signal("paste", e);
        var text = e.text;
        if (!this.inMultiSelectMode || this.inVirtualSelectionMode) {
            this.insert(text);
        } else {
            var lines = text.split(/\r\n|\r|\n/);
            var ranges = this.selection.rangeList.ranges;
    
            if (lines.length > ranges.length || lines.length < 2 || !lines[1])
                return this.commands.exec("insertstring", this, text);
    
            for (var i = ranges.length; i--;) {
                var range = ranges[i];
                if (!range.isEmpty())
                    this.session.remove(range);
    
                this.session.insert(range.start, lines[i]);
            }
        }
    };

    this.execCommand = function(command, args) {
        return this.commands.exec(command, this, args);
    };
    this.insert = function(text, pasted) {
        var session = this.session;
        var mode = session.getMode();
        var cursor = this.getCursorPosition();

        if (this.getBehavioursEnabled() && !pasted) {
            var transform = mode.transformAction(session.getState(cursor.row), 'insertion', this, session, text);
            if (transform) {
                if (text !== transform.text) {
                    this.session.mergeUndoDeltas = false;
                    this.$mergeNextCommand = false;
                }
                text = transform.text;

            }
        }
        
        if (text == "\t")
            text = this.session.getTabString();
        if (!this.selection.isEmpty()) {
            var range = this.getSelectionRange();
            cursor = this.session.remove(range);
            this.clearSelection();
        }
        else if (this.session.getOverwrite() && text.indexOf("\n") == -1) {
            var range = new Range.fromPoints(cursor, cursor);
            range.end.column += text.length;
            this.session.remove(range);
        }

        if (text == "\n" || text == "\r\n") {
            var line = session.getLine(cursor.row);
            if (cursor.column > line.search(/\S|$/)) {
                var d = line.substr(cursor.column).search(/\S|$/);
                session.doc.removeInLine(cursor.row, cursor.column, cursor.column + d);
            }
        }
        this.clearSelection();

        var start = cursor.column;
        var lineState = session.getState(cursor.row);
        var line = session.getLine(cursor.row);
        var shouldOutdent = mode.checkOutdent(lineState, line, text);
        var end = session.insert(cursor, text);

        if (transform && transform.selection) {
            if (transform.selection.length == 2) { // Transform relative to the current column
                this.selection.setSelectionRange(
                    new Range(cursor.row, start + transform.selection[0],
                              cursor.row, start + transform.selection[1]));
            } else { // Transform relative to the current row.
                this.selection.setSelectionRange(
                    new Range(cursor.row + transform.selection[0],
                              transform.selection[1],
                              cursor.row + transform.selection[2],
                              transform.selection[3]));
            }
        }

        if (session.getDocument().isNewLine(text)) {
            var lineIndent = mode.getNextLineIndent(lineState, line.slice(0, cursor.column), session.getTabString());

            session.insert({row: cursor.row+1, column: 0}, lineIndent);
        }
        if (shouldOutdent)
            mode.autoOutdent(lineState, session, cursor.row);
    };

    this.onTextInput = function(text) {
        this.keyBinding.onTextInput(text);
    };

    this.onCommandKey = function(e, hashId, keyCode) {
        this.keyBinding.onCommandKey(e, hashId, keyCode);
    };
    this.setOverwrite = function(overwrite) {
        this.session.setOverwrite(overwrite);
    };
    this.getOverwrite = function() {
        return this.session.getOverwrite();
    };
    this.toggleOverwrite = function() {
        this.session.toggleOverwrite();
    };
    this.setScrollSpeed = function(speed) {
        this.setOption("scrollSpeed", speed);
    };
    this.getScrollSpeed = function() {
        return this.getOption("scrollSpeed");
    };
    this.setDragDelay = function(dragDelay) {
        this.setOption("dragDelay", dragDelay);
    };
    this.getDragDelay = function() {
        return this.getOption("dragDelay");
    };
    this.setSelectionStyle = function(val) {
        this.setOption("selectionStyle", val);
    };
    this.getSelectionStyle = function() {
        return this.getOption("selectionStyle");
    };
    this.setHighlightActiveLine = function(shouldHighlight) {
        this.setOption("highlightActiveLine", shouldHighlight);
    };
    this.getHighlightActiveLine = function() {
        return this.getOption("highlightActiveLine");
    };
    this.setHighlightGutterLine = function(shouldHighlight) {
        this.setOption("highlightGutterLine", shouldHighlight);
    };

    this.getHighlightGutterLine = function() {
        return this.getOption("highlightGutterLine");
    };
    this.setHighlightSelectedWord = function(shouldHighlight) {
        this.setOption("highlightSelectedWord", shouldHighlight);
    };
    this.getHighlightSelectedWord = function() {
        return this.$highlightSelectedWord;
    };

    this.setAnimatedScroll = function(shouldAnimate){
        this.renderer.setAnimatedScroll(shouldAnimate);
    };

    this.getAnimatedScroll = function(){
        return this.renderer.getAnimatedScroll();
    };
    this.setShowInvisibles = function(showInvisibles) {
        this.renderer.setShowInvisibles(showInvisibles);
    };
    this.getShowInvisibles = function() {
        return this.renderer.getShowInvisibles();
    };

    this.setDisplayIndentGuides = function(display) {
        this.renderer.setDisplayIndentGuides(display);
    };

    this.getDisplayIndentGuides = function() {
        return this.renderer.getDisplayIndentGuides();
    };
    this.setShowPrintMargin = function(showPrintMargin) {
        this.renderer.setShowPrintMargin(showPrintMargin);
    };
    this.getShowPrintMargin = function() {
        return this.renderer.getShowPrintMargin();
    };
    this.setPrintMarginColumn = function(showPrintMargin) {
        this.renderer.setPrintMarginColumn(showPrintMargin);
    };
    this.getPrintMarginColumn = function() {
        return this.renderer.getPrintMarginColumn();
    };
    this.setReadOnly = function(readOnly) {
        this.setOption("readOnly", readOnly);
    };
    this.getReadOnly = function() {
        return this.getOption("readOnly");
    };
    this.setBehavioursEnabled = function (enabled) {
        this.setOption("behavioursEnabled", enabled);
    };
    this.getBehavioursEnabled = function () {
        return this.getOption("behavioursEnabled");
    };
    this.setWrapBehavioursEnabled = function (enabled) {
        this.setOption("wrapBehavioursEnabled", enabled);
    };
    this.getWrapBehavioursEnabled = function () {
        return this.getOption("wrapBehavioursEnabled");
    };
    this.setShowFoldWidgets = function(show) {
        this.setOption("showFoldWidgets", show);

    };
    this.getShowFoldWidgets = function() {
        return this.getOption("showFoldWidgets");
    };

    this.setFadeFoldWidgets = function(fade) {
        this.setOption("fadeFoldWidgets", fade);
    };

    this.getFadeFoldWidgets = function() {
        return this.getOption("fadeFoldWidgets");
    };
    this.remove = function(dir) {
        if (this.selection.isEmpty()){
            if (dir == "left")
                this.selection.selectLeft();
            else
                this.selection.selectRight();
        }

        var range = this.getSelectionRange();
        if (this.getBehavioursEnabled()) {
            var session = this.session;
            var state = session.getState(range.start.row);
            var new_range = session.getMode().transformAction(state, 'deletion', this, session, range);

            if (range.end.column === 0) {
                var text = session.getTextRange(range);
                if (text[text.length - 1] == "\n") {
                    var line = session.getLine(range.end.row);
                    if (/^\s+$/.test(line)) {
                        range.end.column = line.length;
                    }
                }
            }
            if (new_range)
                range = new_range;
        }

        this.session.remove(range);
        this.clearSelection();
    };
    this.removeWordRight = function() {
        if (this.selection.isEmpty())
            this.selection.selectWordRight();

        this.session.remove(this.getSelectionRange());
        this.clearSelection();
    };
    this.removeWordLeft = function() {
        if (this.selection.isEmpty())
            this.selection.selectWordLeft();

        this.session.remove(this.getSelectionRange());
        this.clearSelection();
    };
    this.removeToLineStart = function() {
        if (this.selection.isEmpty())
            this.selection.selectLineStart();

        this.session.remove(this.getSelectionRange());
        this.clearSelection();
    };
    this.removeToLineEnd = function() {
        if (this.selection.isEmpty())
            this.selection.selectLineEnd();

        var range = this.getSelectionRange();
        if (range.start.column == range.end.column && range.start.row == range.end.row) {
            range.end.column = 0;
            range.end.row++;
        }

        this.session.remove(range);
        this.clearSelection();
    };
    this.splitLine = function() {
        if (!this.selection.isEmpty()) {
            this.session.remove(this.getSelectionRange());
            this.clearSelection();
        }

        var cursor = this.getCursorPosition();
        this.insert("\n");
        this.moveCursorToPosition(cursor);
    };
    this.transposeLetters = function() {
        if (!this.selection.isEmpty()) {
            return;
        }

        var cursor = this.getCursorPosition();
        var column = cursor.column;
        if (column === 0)
            return;

        var line = this.session.getLine(cursor.row);
        var swap, range;
        if (column < line.length) {
            swap = line.charAt(column) + line.charAt(column-1);
            range = new Range(cursor.row, column-1, cursor.row, column+1);
        }
        else {
            swap = line.charAt(column-1) + line.charAt(column-2);
            range = new Range(cursor.row, column-2, cursor.row, column);
        }
        this.session.replace(range, swap);
        this.session.selection.moveToPosition(range.end);
    };
    this.toLowerCase = function() {
        var originalRange = this.getSelectionRange();
        if (this.selection.isEmpty()) {
            this.selection.selectWord();
        }

        var range = this.getSelectionRange();
        var text = this.session.getTextRange(range);
        this.session.replace(range, text.toLowerCase());
        this.selection.setSelectionRange(originalRange);
    };
    this.toUpperCase = function() {
        var originalRange = this.getSelectionRange();
        if (this.selection.isEmpty()) {
            this.selection.selectWord();
        }

        var range = this.getSelectionRange();
        var text = this.session.getTextRange(range);
        this.session.replace(range, text.toUpperCase());
        this.selection.setSelectionRange(originalRange);
    };
    this.indent = function() {
        var session = this.session;
        var range = this.getSelectionRange();

        if (range.start.row < range.end.row) {
            var rows = this.$getSelectedRows();
            session.indentRows(rows.first, rows.last, "\t");
            return;
        } else if (range.start.column < range.end.column) {
            var text = session.getTextRange(range);
            if (!/^\s+$/.test(text)) {
                var rows = this.$getSelectedRows();
                session.indentRows(rows.first, rows.last, "\t");
                return;
            }
        }
        
        var line = session.getLine(range.start.row);
        var position = range.start;
        var size = session.getTabSize();
        var column = session.documentToScreenColumn(position.row, position.column);

        if (this.session.getUseSoftTabs()) {
            var count = (size - column % size);
            var indentString = lang.stringRepeat(" ", count);
        } else {
            var count = column % size;
            while (line[range.start.column - 1] == " " && count) {
                range.start.column--;
                count--;
            }
            this.selection.setSelectionRange(range);
            indentString = "\t";
        }
        return this.insert(indentString);
    };
    this.blockIndent = function() {
        var rows = this.$getSelectedRows();
        this.session.indentRows(rows.first, rows.last, "\t");
    };
    this.blockOutdent = function() {
        var selection = this.session.getSelection();
        this.session.outdentRows(selection.getRange());
    };
    this.sortLines = function() {
        var rows = this.$getSelectedRows();
        var session = this.session;

        var lines = [];
        for (var i = rows.first; i <= rows.last; i++)
            lines.push(session.getLine(i));

        lines.sort(function(a, b) {
            if (a.toLowerCase() < b.toLowerCase()) return -1;
            if (a.toLowerCase() > b.toLowerCase()) return 1;
            return 0;
        });

        var deleteRange = new Range(0, 0, 0, 0);
        for (var i = rows.first; i <= rows.last; i++) {
            var line = session.getLine(i);
            deleteRange.start.row = i;
            deleteRange.end.row = i;
            deleteRange.end.column = line.length;
            session.replace(deleteRange, lines[i-rows.first]);
        }
    };
    this.toggleCommentLines = function() {
        var state = this.session.getState(this.getCursorPosition().row);
        var rows = this.$getSelectedRows();
        this.session.getMode().toggleCommentLines(state, this.session, rows.first, rows.last);
    };

    this.toggleBlockComment = function() {
        var cursor = this.getCursorPosition();
        var state = this.session.getState(cursor.row);
        var range = this.getSelectionRange();
        this.session.getMode().toggleBlockComment(state, this.session, range, cursor);
    };
    this.getNumberAt = function(row, column) {
        var _numberRx = /[\-]?[0-9]+(?:\.[0-9]+)?/g;
        _numberRx.lastIndex = 0;

        var s = this.session.getLine(row);
        while (_numberRx.lastIndex < column) {
            var m = _numberRx.exec(s);
            if(m.index <= column && m.index+m[0].length >= column){
                var number = {
                    value: m[0],
                    start: m.index,
                    end: m.index+m[0].length
                };
                return number;
            }
        }
        return null;
    };
    this.modifyNumber = function(amount) {
        var row = this.selection.getCursor().row;
        var column = this.selection.getCursor().column;
        var charRange = new Range(row, column-1, row, column);

        var c = this.session.getTextRange(charRange);
        if (!isNaN(parseFloat(c)) && isFinite(c)) {
            var nr = this.getNumberAt(row, column);
            if (nr) {
                var fp = nr.value.indexOf(".") >= 0 ? nr.start + nr.value.indexOf(".") + 1 : nr.end;
                var decimals = nr.start + nr.value.length - fp;

                var t = parseFloat(nr.value);
                t *= Math.pow(10, decimals);


                if(fp !== nr.end && column < fp){
                    amount *= Math.pow(10, nr.end - column - 1);
                } else {
                    amount *= Math.pow(10, nr.end - column);
                }

                t += amount;
                t /= Math.pow(10, decimals);
                var nnr = t.toFixed(decimals);
                var replaceRange = new Range(row, nr.start, row, nr.end);
                this.session.replace(replaceRange, nnr);
                this.moveCursorTo(row, Math.max(nr.start +1, column + nnr.length - nr.value.length));

            }
        }
    };
    this.removeLines = function() {
        var rows = this.$getSelectedRows();
        this.session.removeFullLines(rows.first, rows.last);
        this.clearSelection();
    };

    this.duplicateSelection = function() {
        var sel = this.selection;
        var doc = this.session;
        var range = sel.getRange();
        var reverse = sel.isBackwards();
        if (range.isEmpty()) {
            var row = range.start.row;
            doc.duplicateLines(row, row);
        } else {
            var point = reverse ? range.start : range.end;
            var endPoint = doc.insert(point, doc.getTextRange(range), false);
            range.start = point;
            range.end = endPoint;

            sel.setSelectionRange(range, reverse);
        }
    };
    this.moveLinesDown = function() {
        this.$moveLines(1, false);
    };
    this.moveLinesUp = function() {
        this.$moveLines(-1, false);
    };
    this.moveText = function(range, toPosition, copy) {
        return this.session.moveText(range, toPosition, copy);
    };
    this.copyLinesUp = function() {
        this.$moveLines(-1, true);
    };
    this.copyLinesDown = function() {
        this.$moveLines(1, true);
    };
    this.$moveLines = function(dir, copy) {
        var rows, moved;
        var selection = this.selection;
        if (!selection.inMultiSelectMode || this.inVirtualSelectionMode) {
            var range = selection.toOrientedRange();
            rows = this.$getSelectedRows(range);
            moved = this.session.$moveLines(rows.first, rows.last, copy ? 0 : dir);
            if (copy && dir == -1) moved = 0;
            range.moveBy(moved, 0);
            selection.fromOrientedRange(range);
        } else {
            var ranges = selection.rangeList.ranges;
            selection.rangeList.detach(this.session);
            this.inVirtualSelectionMode = true;
            
            var diff = 0;
            var totalDiff = 0;
            var l = ranges.length;
            for (var i = 0; i < l; i++) {
                var rangeIndex = i;
                ranges[i].moveBy(diff, 0);
                rows = this.$getSelectedRows(ranges[i]);
                var first = rows.first;
                var last = rows.last;
                while (++i < l) {
                    if (totalDiff) ranges[i].moveBy(totalDiff, 0);
                    var subRows = this.$getSelectedRows(ranges[i]);
                    if (copy && subRows.first != last)
                        break;
                    else if (!copy && subRows.first > last + 1)
                        break;
                    last = subRows.last;
                }
                i--;
                diff = this.session.$moveLines(first, last, copy ? 0 : dir);
                if (copy && dir == -1) rangeIndex = i + 1;
                while (rangeIndex <= i) {
                    ranges[rangeIndex].moveBy(diff, 0);
                    rangeIndex++;
                }
                if (!copy) diff = 0;
                totalDiff += diff;
            }
            
            selection.fromOrientedRange(selection.ranges[0]);
            selection.rangeList.attach(this.session);
            this.inVirtualSelectionMode = false;
        }
    };
    this.$getSelectedRows = function(range) {
        range = (range || this.getSelectionRange()).collapseRows();

        return {
            first: this.session.getRowFoldStart(range.start.row),
            last: this.session.getRowFoldEnd(range.end.row)
        };
    };

    this.onCompositionStart = function(text) {
        this.renderer.showComposition(this.getCursorPosition());
    };

    this.onCompositionUpdate = function(text) {
        this.renderer.setCompositionText(text);
    };

    this.onCompositionEnd = function() {
        this.renderer.hideComposition();
    };
    this.getFirstVisibleRow = function() {
        return this.renderer.getFirstVisibleRow();
    };
    this.getLastVisibleRow = function() {
        return this.renderer.getLastVisibleRow();
    };
    this.isRowVisible = function(row) {
        return (row >= this.getFirstVisibleRow() && row <= this.getLastVisibleRow());
    };
    this.isRowFullyVisible = function(row) {
        return (row >= this.renderer.getFirstFullyVisibleRow() && row <= this.renderer.getLastFullyVisibleRow());
    };
    this.$getVisibleRowCount = function() {
        return this.renderer.getScrollBottomRow() - this.renderer.getScrollTopRow() + 1;
    };

    this.$moveByPage = function(dir, select) {
        var renderer = this.renderer;
        var config = this.renderer.layerConfig;
        var rows = dir * Math.floor(config.height / config.lineHeight);

        this.$blockScrolling++;
        if (select === true) {
            this.selection.$moveSelection(function(){
                this.moveCursorBy(rows, 0);
            });
        } else if (select === false) {
            this.selection.moveCursorBy(rows, 0);
            this.selection.clearSelection();
        }
        this.$blockScrolling--;

        var scrollTop = renderer.scrollTop;

        renderer.scrollBy(0, rows * config.lineHeight);
        if (select != null)
            renderer.scrollCursorIntoView(null, 0.5);

        renderer.animateScrolling(scrollTop);
    };
    this.selectPageDown = function() {
        this.$moveByPage(1, true);
    };
    this.selectPageUp = function() {
        this.$moveByPage(-1, true);
    };
    this.gotoPageDown = function() {
       this.$moveByPage(1, false);
    };
    this.gotoPageUp = function() {
        this.$moveByPage(-1, false);
    };
    this.scrollPageDown = function() {
        this.$moveByPage(1);
    };
    this.scrollPageUp = function() {
        this.$moveByPage(-1);
    };
    this.scrollToRow = function(row) {
        this.renderer.scrollToRow(row);
    };
    this.scrollToLine = function(line, center, animate, callback) {
        this.renderer.scrollToLine(line, center, animate, callback);
    };
    this.centerSelection = function() {
        var range = this.getSelectionRange();
        var pos = {
            row: Math.floor(range.start.row + (range.end.row - range.start.row) / 2),
            column: Math.floor(range.start.column + (range.end.column - range.start.column) / 2)
        };
        this.renderer.alignCursor(pos, 0.5);
    };
    this.getCursorPosition = function() {
        return this.selection.getCursor();
    };
    this.getCursorPositionScreen = function() {
        return this.session.documentToScreenPosition(this.getCursorPosition());
    };
    this.getSelectionRange = function() {
        return this.selection.getRange();
    };
    this.selectAll = function() {
        this.$blockScrolling += 1;
        this.selection.selectAll();
        this.$blockScrolling -= 1;
    };
    this.clearSelection = function() {
        this.selection.clearSelection();
    };
    this.moveCursorTo = function(row, column) {
        this.selection.moveCursorTo(row, column);
    };
    this.moveCursorToPosition = function(pos) {
        this.selection.moveCursorToPosition(pos);
    };
    this.jumpToMatching = function(select, expand) {
        var cursor = this.getCursorPosition();
        var iterator = new TokenIterator(this.session, cursor.row, cursor.column);
        var prevToken = iterator.getCurrentToken();
        var token = prevToken || iterator.stepForward();

        if (!token) return;
        var matchType;
        var found = false;
        var depth = {};
        var i = cursor.column - token.start;
        var bracketType;
        var brackets = {
            ")": "(",
            "(": "(",
            "]": "[",
            "[": "[",
            "{": "{",
            "}": "{"
        };
        
        do {
            if (token.value.match(/[{}()\[\]]/g)) {
                for (; i < token.value.length && !found; i++) {
                    if (!brackets[token.value[i]]) {
                        continue;
                    }

                    bracketType = brackets[token.value[i]] + '.' + token.type.replace("rparen", "lparen");

                    if (isNaN(depth[bracketType])) {
                        depth[bracketType] = 0;
                    }

                    switch (token.value[i]) {
                        case '(':
                        case '[':
                        case '{':
                            depth[bracketType]++;
                            break;
                        case ')':
                        case ']':
                        case '}':
                            depth[bracketType]--;

                            if (depth[bracketType] === -1) {
                                matchType = 'bracket';
                                found = true;
                            }
                        break;
                    }
                }
            }
            else if (token && token.type.indexOf('tag-name') !== -1) {
                if (isNaN(depth[token.value])) {
                    depth[token.value] = 0;
                }
                
                if (prevToken.value === '<') {
                    depth[token.value]++;
                }
                else if (prevToken.value === '</') {
                    depth[token.value]--;
                }
                
                if (depth[token.value] === -1) {
                    matchType = 'tag';
                    found = true;
                }
            }

            if (!found) {
                prevToken = token;
                token = iterator.stepForward();
                i = 0;
            }
        } while (token && !found);
        if (!matchType)
            return;

        var range, pos;
        if (matchType === 'bracket') {
            range = this.session.getBracketRange(cursor);
            if (!range) {
                range = new Range(
                    iterator.getCurrentTokenRow(),
                    iterator.getCurrentTokenColumn() + i - 1,
                    iterator.getCurrentTokenRow(),
                    iterator.getCurrentTokenColumn() + i - 1
                );
                pos = range.start;
                if (expand || pos.row === cursor.row && Math.abs(pos.column - cursor.column) < 2)
                    range = this.session.getBracketRange(pos);
            }
        }
        else if (matchType === 'tag') {
            if (token && token.type.indexOf('tag-name') !== -1) 
                var tag = token.value;
            else
                return;

            range = new Range(
                iterator.getCurrentTokenRow(),
                iterator.getCurrentTokenColumn() - 2,
                iterator.getCurrentTokenRow(),
                iterator.getCurrentTokenColumn() - 2
            );
            if (range.compare(cursor.row, cursor.column) === 0) {
                found = false;
                do {
                    token = prevToken;
                    prevToken = iterator.stepBackward();
                    
                    if (prevToken) {
                        if (prevToken.type.indexOf('tag-close') !== -1) {
                            range.setEnd(iterator.getCurrentTokenRow(), iterator.getCurrentTokenColumn() + 1);
                        }

                        if (token.value === tag && token.type.indexOf('tag-name') !== -1) {
                            if (prevToken.value === '<') {
                                depth[tag]++;
                            }
                            else if (prevToken.value === '</') {
                                depth[tag]--;
                            }
                            
                            if (depth[tag] === 0)
                                found = true;
                        }
                    }
                } while (prevToken && !found);
            }
            if (token && token.type.indexOf('tag-name')) {
                pos = range.start;
                if (pos.row == cursor.row && Math.abs(pos.column - cursor.column) < 2)
                    pos = range.end;
            }
        }

        pos = range && range.cursor || pos;
        if (pos) {
            if (select) {
                if (range && expand) {
                    this.selection.setRange(range);
                } else if (range && range.isEqual(this.getSelectionRange())) {
                    this.clearSelection();
                } else {
                    this.selection.selectTo(pos.row, pos.column);
                }
            } else {
                this.selection.moveTo(pos.row, pos.column);
            }
        }
    };
    this.gotoLine = function(lineNumber, column, animate) {
        this.selection.clearSelection();
        this.session.unfold({row: lineNumber - 1, column: column || 0});

        this.$blockScrolling += 1;
        this.exitMultiSelectMode && this.exitMultiSelectMode();
        this.moveCursorTo(lineNumber - 1, column || 0);
        this.$blockScrolling -= 1;

        if (!this.isRowFullyVisible(lineNumber - 1))
            this.scrollToLine(lineNumber - 1, true, animate);
    };
    this.navigateTo = function(row, column) {
        this.selection.moveTo(row, column);
    };
    this.navigateUp = function(times) {
        if (this.selection.isMultiLine() && !this.selection.isBackwards()) {
            var selectionStart = this.selection.anchor.getPosition();
            return this.moveCursorToPosition(selectionStart);
        }
        this.selection.clearSelection();
        this.selection.moveCursorBy(-times || -1, 0);
    };
    this.navigateDown = function(times) {
        if (this.selection.isMultiLine() && this.selection.isBackwards()) {
            var selectionEnd = this.selection.anchor.getPosition();
            return this.moveCursorToPosition(selectionEnd);
        }
        this.selection.clearSelection();
        this.selection.moveCursorBy(times || 1, 0);
    };
    this.navigateLeft = function(times) {
        if (!this.selection.isEmpty()) {
            var selectionStart = this.getSelectionRange().start;
            this.moveCursorToPosition(selectionStart);
        }
        else {
            times = times || 1;
            while (times--) {
                this.selection.moveCursorLeft();
            }
        }
        this.clearSelection();
    };
    this.navigateRight = function(times) {
        if (!this.selection.isEmpty()) {
            var selectionEnd = this.getSelectionRange().end;
            this.moveCursorToPosition(selectionEnd);
        }
        else {
            times = times || 1;
            while (times--) {
                this.selection.moveCursorRight();
            }
        }
        this.clearSelection();
    };
    this.navigateLineStart = function() {
        this.selection.moveCursorLineStart();
        this.clearSelection();
    };
    this.navigateLineEnd = function() {
        this.selection.moveCursorLineEnd();
        this.clearSelection();
    };
    this.navigateFileEnd = function() {
        this.selection.moveCursorFileEnd();
        this.clearSelection();
    };
    this.navigateFileStart = function() {
        this.selection.moveCursorFileStart();
        this.clearSelection();
    };
    this.navigateWordRight = function() {
        this.selection.moveCursorWordRight();
        this.clearSelection();
    };
    this.navigateWordLeft = function() {
        this.selection.moveCursorWordLeft();
        this.clearSelection();
    };
    this.replace = function(replacement, options) {
        if (options)
            this.$search.set(options);

        var range = this.$search.find(this.session);
        var replaced = 0;
        if (!range)
            return replaced;

        if (this.$tryReplace(range, replacement)) {
            replaced = 1;
        }
        if (range !== null) {
            this.selection.setSelectionRange(range);
            this.renderer.scrollSelectionIntoView(range.start, range.end);
        }

        return replaced;
    };
    this.replaceAll = function(replacement, options) {
        if (options) {
            this.$search.set(options);
        }

        var ranges = this.$search.findAll(this.session);
        var replaced = 0;
        if (!ranges.length)
            return replaced;

        this.$blockScrolling += 1;

        var selection = this.getSelectionRange();
        this.selection.moveTo(0, 0);

        for (var i = ranges.length - 1; i >= 0; --i) {
            if(this.$tryReplace(ranges[i], replacement)) {
                replaced++;
            }
        }

        this.selection.setSelectionRange(selection);
        this.$blockScrolling -= 1;

        return replaced;
    };

    this.$tryReplace = function(range, replacement) {
        var input = this.session.getTextRange(range);
        replacement = this.$search.replace(input, replacement);
        if (replacement !== null) {
            range.end = this.session.replace(range, replacement);
            return range;
        } else {
            return null;
        }
    };
    this.getLastSearchOptions = function() {
        return this.$search.getOptions();
    };
    this.find = function(needle, options, animate) {
        if (!options)
            options = {};

        if (typeof needle == "string" || needle instanceof RegExp)
            options.needle = needle;
        else if (typeof needle == "object")
            oop.mixin(options, needle);

        var range = this.selection.getRange();
        if (options.needle == null) {
            needle = this.session.getTextRange(range)
                || this.$search.$options.needle;
            if (!needle) {
                range = this.session.getWordRange(range.start.row, range.start.column);
                needle = this.session.getTextRange(range);
            }
            this.$search.set({needle: needle});
        }

        this.$search.set(options);
        if (!options.start)
            this.$search.set({start: range});

        var newRange = this.$search.find(this.session);
        if (options.preventScroll)
            return newRange;
        if (newRange) {
            this.revealRange(newRange, animate);
            return newRange;
        }
        if (options.backwards)
            range.start = range.end;
        else
            range.end = range.start;
        this.selection.setRange(range);
    };
    this.findNext = function(options, animate) {
        this.find({skipCurrent: true, backwards: false}, options, animate);
    };
    this.findPrevious = function(options, animate) {
        this.find(options, {skipCurrent: true, backwards: true}, animate);
    };

    this.revealRange = function(range, animate) {
        this.$blockScrolling += 1;
        this.session.unfold(range);
        this.selection.setSelectionRange(range);
        this.$blockScrolling -= 1;

        var scrollTop = this.renderer.scrollTop;
        this.renderer.scrollSelectionIntoView(range.start, range.end, 0.5);
        if (animate !== false)
            this.renderer.animateScrolling(scrollTop);
    };
    this.undo = function() {
        this.$blockScrolling++;
        this.session.getUndoManager().undo();
        this.$blockScrolling--;
        this.renderer.scrollCursorIntoView(null, 0.5);
    };
    this.redo = function() {
        this.$blockScrolling++;
        this.session.getUndoManager().redo();
        this.$blockScrolling--;
        this.renderer.scrollCursorIntoView(null, 0.5);
    };
    this.destroy = function() {
        this.renderer.destroy();
        this._signal("destroy", this);
        if (this.session) {
            this.session.destroy();
        }
    };
    this.setAutoScrollEditorIntoView = function(enable) {
        if (!enable)
            return;
        var rect;
        var self = this;
        var shouldScroll = false;
        if (!this.$scrollAnchor)
            this.$scrollAnchor = document.createElement("div");
        var scrollAnchor = this.$scrollAnchor;
        scrollAnchor.style.cssText = "position:absolute";
        this.container.insertBefore(scrollAnchor, this.container.firstChild);
        var onChangeSelection = this.on("changeSelection", function() {
            shouldScroll = true;
        });
        var onBeforeRender = this.renderer.on("beforeRender", function() {
            if (shouldScroll)
                rect = self.renderer.container.getBoundingClientRect();
        });
        var onAfterRender = this.renderer.on("afterRender", function() {
            if (shouldScroll && rect && (self.isFocused()
                || self.searchBox && self.searchBox.isFocused())
            ) {
                var renderer = self.renderer;
                var pos = renderer.$cursorLayer.$pixelPos;
                var config = renderer.layerConfig;
                var top = pos.top - config.offset;
                if (pos.top >= 0 && top + rect.top < 0) {
                    shouldScroll = true;
                } else if (pos.top < config.height &&
                    pos.top + rect.top + config.lineHeight > window.innerHeight) {
                    shouldScroll = false;
                } else {
                    shouldScroll = null;
                }
                if (shouldScroll != null) {
                    scrollAnchor.style.top = top + "px";
                    scrollAnchor.style.left = pos.left + "px";
                    scrollAnchor.style.height = config.lineHeight + "px";
                    scrollAnchor.scrollIntoView(shouldScroll);
                }
                shouldScroll = rect = null;
            }
        });
        this.setAutoScrollEditorIntoView = function(enable) {
            if (enable)
                return;
            delete this.setAutoScrollEditorIntoView;
            this.off("changeSelection", onChangeSelection);
            this.renderer.off("afterRender", onAfterRender);
            this.renderer.off("beforeRender", onBeforeRender);
        };
    };


    this.$resetCursorStyle = function() {
        var style = this.$cursorStyle || "ace";
        var cursorLayer = this.renderer.$cursorLayer;
        if (!cursorLayer)
            return;
        cursorLayer.setSmoothBlinking(/smooth/.test(style));
        cursorLayer.isBlinking = !this.$readOnly && style != "wide";
        dom.setCssClass(cursorLayer.element, "ace_slim-cursors", /slim/.test(style));
    };

}).call(Editor.prototype);



config.defineOptions(Editor.prototype, "editor", {
    selectionStyle: {
        set: function(style) {
            this.onSelectionChange();
            this._signal("changeSelectionStyle", {data: style});
        },
        initialValue: "line"
    },
    highlightActiveLine: {
        set: function() {this.$updateHighlightActiveLine();},
        initialValue: true
    },
    highlightSelectedWord: {
        set: function(shouldHighlight) {this.$onSelectionChange();},
        initialValue: true
    },
    readOnly: {
        set: function(readOnly) {
            this.$resetCursorStyle(); 
        },
        initialValue: false
    },
    cursorStyle: {
        set: function(val) { this.$resetCursorStyle(); },
        values: ["ace", "slim", "smooth", "wide"],
        initialValue: "ace"
    },
    mergeUndoDeltas: {
        values: [false, true, "always"],
        initialValue: true
    },
    behavioursEnabled: {initialValue: true},
    wrapBehavioursEnabled: {initialValue: true},
    autoScrollEditorIntoView: {
        set: function(val) {this.setAutoScrollEditorIntoView(val);}
    },
    keyboardHandler: {
        set: function(val) { this.setKeyboardHandler(val); },
        get: function() { return this.keybindingId; },
        handlesSet: true
    },

    hScrollBarAlwaysVisible: "renderer",
    vScrollBarAlwaysVisible: "renderer",
    highlightGutterLine: "renderer",
    animatedScroll: "renderer",
    showInvisibles: "renderer",
    showPrintMargin: "renderer",
    printMarginColumn: "renderer",
    printMargin: "renderer",
    fadeFoldWidgets: "renderer",
    showFoldWidgets: "renderer",
    showLineNumbers: "renderer",
    showGutter: "renderer",
    displayIndentGuides: "renderer",
    fontSize: "renderer",
    fontFamily: "renderer",
    maxLines: "renderer",
    minLines: "renderer",
    scrollPastEnd: "renderer",
    fixedWidthGutter: "renderer",
    theme: "renderer",

    scrollSpeed: "$mouseHandler",
    dragDelay: "$mouseHandler",
    dragEnabled: "$mouseHandler",
    focusTimout: "$mouseHandler",
    tooltipFollowsMouse: "$mouseHandler",

    firstLineNumber: "session",
    overwrite: "session",
    newLineMode: "session",
    useWorker: "session",
    useSoftTabs: "session",
    tabSize: "session",
    wrap: "session",
    indentedSoftWrap: "session",
    foldStyle: "session",
    mode: "session"
});

exports.Editor = Editor;
});

ace.define("ace/undomanager",["require","exports","module"], function(require, exports, module) {
"use strict";
var UndoManager = function() {
    this.reset();
};

(function() {
    this.execute = function(options) {
        var deltaSets = options.args[0];
        this.$doc  = options.args[1];
        if (options.merge && this.hasUndo()){
            this.dirtyCounter--;
            deltaSets = this.$undoStack.pop().concat(deltaSets);
        }
        this.$undoStack.push(deltaSets);
        this.$redoStack = [];
        if (this.dirtyCounter < 0) {
            this.dirtyCounter = NaN;
        }
        this.dirtyCounter++;
    };
    this.undo = function(dontSelect) {
        var deltaSets = this.$undoStack.pop();
        var undoSelectionRange = null;
        if (deltaSets) {
            undoSelectionRange = this.$doc.undoChanges(deltaSets, dontSelect);
            this.$redoStack.push(deltaSets);
            this.dirtyCounter--;
        }

        return undoSelectionRange;
    };
    this.redo = function(dontSelect) {
        var deltaSets = this.$redoStack.pop();
        var redoSelectionRange = null;
        if (deltaSets) {
            redoSelectionRange =
                this.$doc.redoChanges(this.$deserializeDeltas(deltaSets), dontSelect);
            this.$undoStack.push(deltaSets);
            this.dirtyCounter++;
        }
        return redoSelectionRange;
    };
    this.reset = function() {
        this.$undoStack = [];
        this.$redoStack = [];
        this.dirtyCounter = 0;
    };
    this.hasUndo = function() {
        return this.$undoStack.length > 0;
    };
    this.hasRedo = function() {
        return this.$redoStack.length > 0;
    };
    this.markClean = function() {
        this.dirtyCounter = 0;
    };
    this.isClean = function() {
        return this.dirtyCounter === 0;
    };
    this.$serializeDeltas = function(deltaSets) {
        return cloneDeltaSetsObj(deltaSets, $serializeDelta);
    };
    this.$deserializeDeltas = function(deltaSets) {
        return cloneDeltaSetsObj(deltaSets, $deserializeDelta);
    };
    
    function $serializeDelta(delta){
        return {
            action: delta.action,
            start: delta.start,
            end: delta.end,
            lines: delta.lines.length == 1 ? null : delta.lines,
            text: delta.lines.length == 1 ? delta.lines[0] : null
        };
    }
        
    function $deserializeDelta(delta) {
        return {
            action: delta.action,
            start: delta.start,
            end: delta.end,
            lines: delta.lines || [delta.text]
        };
    }
    
    function cloneDeltaSetsObj(deltaSets_old, fnGetModifiedDelta) {
        var deltaSets_new = new Array(deltaSets_old.length);
        for (var i = 0; i < deltaSets_old.length; i++) {
            var deltaSet_old = deltaSets_old[i];
            var deltaSet_new = { group: deltaSet_old.group, deltas: new Array(deltaSet_old.length)};
            
            for (var j = 0; j < deltaSet_old.deltas.length; j++) {
                var delta_old = deltaSet_old.deltas[j];
                deltaSet_new.deltas[j] = fnGetModifiedDelta(delta_old);
            }
            
            deltaSets_new[i] = deltaSet_new;
        }
        return deltaSets_new;
    }
    
}).call(UndoManager.prototype);

exports.UndoManager = UndoManager;
});

ace.define("ace/layer/gutter",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/lang","ace/lib/event_emitter"], function(require, exports, module) {
"use strict";

var dom = require("../lib/dom");
var oop = require("../lib/oop");
var lang = require("../lib/lang");
var EventEmitter = require("../lib/event_emitter").EventEmitter;

var Gutter = function(parentEl) {
    this.element = dom.createElement("div");
    this.element.className = "ace_layer ace_gutter-layer";
    parentEl.appendChild(this.element);
    this.setShowFoldWidgets(this.$showFoldWidgets);
    
    this.gutterWidth = 0;

    this.$annotations = [];
    this.$updateAnnotations = this.$updateAnnotations.bind(this);

    this.$cells = [];
};

(function() {

    oop.implement(this, EventEmitter);

    this.setSession = function(session) {
        if (this.session)
            this.session.removeEventListener("change", this.$updateAnnotations);
        this.session = session;
        if (session)
            session.on("change", this.$updateAnnotations);
    };

    this.addGutterDecoration = function(row, className){
        if (window.console)
            console.warn && console.warn("deprecated use session.addGutterDecoration");
        this.session.addGutterDecoration(row, className);
    };

    this.removeGutterDecoration = function(row, className){
        if (window.console)
            console.warn && console.warn("deprecated use session.removeGutterDecoration");
        this.session.removeGutterDecoration(row, className);
    };

    this.setAnnotations = function(annotations) {
        this.$annotations = [];
        for (var i = 0; i < annotations.length; i++) {
            var annotation = annotations[i];
            var row = annotation.row;
            var rowInfo = this.$annotations[row];
            if (!rowInfo)
                rowInfo = this.$annotations[row] = {text: []};
           
            var annoText = annotation.text;
            annoText = annoText ? lang.escapeHTML(annoText) : annotation.html || "";

            if (rowInfo.text.indexOf(annoText) === -1)
                rowInfo.text.push(annoText);

            var type = annotation.type;
            if (type == "error")
                rowInfo.className = " ace_error";
            else if (type == "warning" && rowInfo.className != " ace_error")
                rowInfo.className = " ace_warning";
            else if (type == "info" && (!rowInfo.className))
                rowInfo.className = " ace_info";
        }
    };

    this.$updateAnnotations = function (delta) {
        if (!this.$annotations.length)
            return;
        var firstRow = delta.start.row;
        var len = delta.end.row - firstRow;
        if (len === 0) {
        } else if (delta.action == 'remove') {
            this.$annotations.splice(firstRow, len + 1, null);
        } else {
            var args = new Array(len + 1);
            args.unshift(firstRow, 1);
            this.$annotations.splice.apply(this.$annotations, args);
        }
    };

    this.update = function(config) {
        var session = this.session;
        var firstRow = config.firstRow;
        var lastRow = Math.min(config.lastRow + config.gutterOffset,  // needed to compensate for hor scollbar
            session.getLength() - 1);
        var fold = session.getNextFoldLine(firstRow);
        var foldStart = fold ? fold.start.row : Infinity;
        var foldWidgets = this.$showFoldWidgets && session.foldWidgets;
        var breakpoints = session.$breakpoints;
        var decorations = session.$decorations;
        var firstLineNumber = session.$firstLineNumber;
        var lastLineNumber = 0;
        
        var gutterRenderer = session.gutterRenderer || this.$renderer;

        var cell = null;
        var index = -1;
        var row = firstRow;
        while (true) {
            if (row > foldStart) {
                row = fold.end.row + 1;
                fold = session.getNextFoldLine(row, fold);
                foldStart = fold ? fold.start.row : Infinity;
            }
            if (row > lastRow) {
                while (this.$cells.length > index + 1) {
                    cell = this.$cells.pop();
                    this.element.removeChild(cell.element);
                }
                break;
            }

            cell = this.$cells[++index];
            if (!cell) {
                cell = {element: null, textNode: null, foldWidget: null};
                cell.element = dom.createElement("div");
                cell.textNode = document.createTextNode('');
                cell.element.appendChild(cell.textNode);
                this.element.appendChild(cell.element);
                this.$cells[index] = cell;
            }

            var className = "ace_gutter-cell ";
            if (breakpoints[row])
                className += breakpoints[row];
            if (decorations[row])
                className += decorations[row];
            if (this.$annotations[row])
                className += this.$annotations[row].className;
            if (cell.element.className != className)
                cell.element.className = className;

            var height = session.getRowLength(row) * config.lineHeight + "px";
            if (height != cell.element.style.height)
                cell.element.style.height = height;

            if (foldWidgets) {
                var c = foldWidgets[row];
                if (c == null)
                    c = foldWidgets[row] = session.getFoldWidget(row);
            }

            if (c) {
                if (!cell.foldWidget) {
                    cell.foldWidget = dom.createElement("span");
                    cell.element.appendChild(cell.foldWidget);
                }
                var className = "ace_fold-widget ace_" + c;
                if (c == "start" && row == foldStart && row < fold.end.row)
                    className += " ace_closed";
                else
                    className += " ace_open";
                if (cell.foldWidget.className != className)
                    cell.foldWidget.className = className;

                var height = config.lineHeight + "px";
                if (cell.foldWidget.style.height != height)
                    cell.foldWidget.style.height = height;
            } else {
                if (cell.foldWidget) {
                    cell.element.removeChild(cell.foldWidget);
                    cell.foldWidget = null;
                }
            }
            
            var text = lastLineNumber = gutterRenderer
                ? gutterRenderer.getText(session, row)
                : row + firstLineNumber;
            if (text !== cell.textNode.data)
                cell.textNode.data = text;

            row++;
        }

        this.element.style.height = config.minHeight + "px";

        if (this.$fixedWidth || session.$useWrapMode)
            lastLineNumber = session.getLength() + firstLineNumber;

        var gutterWidth = gutterRenderer 
            ? gutterRenderer.getWidth(session, lastLineNumber, config)
            : lastLineNumber.toString().length * config.characterWidth;
        
        var padding = this.$padding || this.$computePadding();
        gutterWidth += padding.left + padding.right;
        if (gutterWidth !== this.gutterWidth && !isNaN(gutterWidth)) {
            this.gutterWidth = gutterWidth;
            this.element.style.width = Math.ceil(this.gutterWidth) + "px";
            this._emit("changeGutterWidth", gutterWidth);
        }
    };

    this.$fixedWidth = false;
    
    this.$showLineNumbers = true;
    this.$renderer = "";
    this.setShowLineNumbers = function(show) {
        this.$renderer = !show && {
            getWidth: function() {return "";},
            getText: function() {return "";}
        };
    };
    
    this.getShowLineNumbers = function() {
        return this.$showLineNumbers;
    };
    
    this.$showFoldWidgets = true;
    this.setShowFoldWidgets = function(show) {
        if (show)
            dom.addCssClass(this.element, "ace_folding-enabled");
        else
            dom.removeCssClass(this.element, "ace_folding-enabled");

        this.$showFoldWidgets = show;
        this.$padding = null;
    };
    
    this.getShowFoldWidgets = function() {
        return this.$showFoldWidgets;
    };

    this.$computePadding = function() {
        if (!this.element.firstChild)
            return {left: 0, right: 0};
        var style = dom.computedStyle(this.element.firstChild);
        this.$padding = {};
        this.$padding.left = parseInt(style.paddingLeft) + 1 || 0;
        this.$padding.right = parseInt(style.paddingRight) || 0;
        return this.$padding;
    };

    this.getRegion = function(point) {
        var padding = this.$padding || this.$computePadding();
        var rect = this.element.getBoundingClientRect();
        if (point.x < padding.left + rect.left)
            return "markers";
        if (this.$showFoldWidgets && point.x > rect.right - padding.right)
            return "foldWidgets";
    };

}).call(Gutter.prototype);

exports.Gutter = Gutter;

});

ace.define("ace/layer/marker",["require","exports","module","ace/range","ace/lib/dom"], function(require, exports, module) {
"use strict";

var Range = require("../range").Range;
var dom = require("../lib/dom");

var Marker = function(parentEl) {
    this.element = dom.createElement("div");
    this.element.className = "ace_layer ace_marker-layer";
    parentEl.appendChild(this.element);
};

(function() {

    this.$padding = 0;

    this.setPadding = function(padding) {
        this.$padding = padding;
    };
    this.setSession = function(session) {
        this.session = session;
    };
    
    this.setMarkers = function(markers) {
        this.markers = markers;
    };

    this.update = function(config) {
        if (!config) return;

        this.config = config;


        var html = [];
        for (var key in this.markers) {
            var marker = this.markers[key];

            if (!marker.range) {
                marker.update(html, this, this.session, config);
                continue;
            }

            var range = marker.range.clipRows(config.firstRow, config.lastRow);
            if (range.isEmpty()) continue;

            range = range.toScreenRange(this.session);
            if (marker.renderer) {
                var top = this.$getTop(range.start.row, config);
                var left = this.$padding + (this.session.$bidiHandler.isBidiRow(range.start.row)
                    ? this.session.$bidiHandler.getPosLeft(range.start.column)
                    : range.start.column * config.characterWidth);
                marker.renderer(html, range, left, top, config);
            } else if (marker.type == "fullLine") {
                this.drawFullLineMarker(html, range, marker.clazz, config);
            } else if (marker.type == "screenLine") {
                this.drawScreenLineMarker(html, range, marker.clazz, config);
            } else if (range.isMultiLine()) {
                if (marker.type == "text")
                    this.drawTextMarker(html, range, marker.clazz, config);
                else
                    this.drawMultiLineMarker(html, range, marker.clazz, config);
            } else {
                if (this.session.$bidiHandler.isBidiRow(range.start.row)) {
                    this.drawBidiSingleLineMarker(html, range, marker.clazz + " ace_start" + " ace_br15", config);
                } else {
                    this.drawSingleLineMarker(html, range, marker.clazz + " ace_start" + " ace_br15", config);
                }
            }
        }
        this.element.innerHTML = html.join("");
    };

    this.$getTop = function(row, layerConfig) {
        return (row - layerConfig.firstRowScreen) * layerConfig.lineHeight;
    };

    function getBorderClass(tl, tr, br, bl) {
        return (tl ? 1 : 0) | (tr ? 2 : 0) | (br ? 4 : 0) | (bl ? 8 : 0);
    }
    this.drawTextMarker = function(stringBuilder, range, clazz, layerConfig, extraStyle) {
        var session = this.session;
        var start = range.start.row;
        var end = range.end.row;
        var row = start;
        var prev = 0; 
        var curr = 0;
        var next = session.getScreenLastRowColumn(row);
        var clazzModified = null;
        var lineRange = new Range(row, range.start.column, row, curr);
        for (; row <= end; row++) {
            lineRange.start.row = lineRange.end.row = row;
            lineRange.start.column = row == start ? range.start.column : session.getRowWrapIndent(row);
            lineRange.end.column = next;
            prev = curr;
            curr = next;
            next = row + 1 < end ? session.getScreenLastRowColumn(row + 1) : row == end ? 0 : range.end.column;
            clazzModified = clazz + (row == start  ? " ace_start" : "") + " ace_br"
                + getBorderClass(row == start || row == start + 1 && range.start.column, prev < curr, curr > next, row == end);
            
            if (this.session.$bidiHandler.isBidiRow(row)) {
                this.drawBidiSingleLineMarker(stringBuilder, lineRange, clazzModified, 
                    layerConfig, row == end ? 0 : 1, extraStyle);
            } else {
                this.drawSingleLineMarker(stringBuilder, lineRange, clazzModified,  
                    layerConfig, row == end ? 0 : 1, extraStyle);
            }
        }
    };
    this.drawMultiLineMarker = function(stringBuilder, range, clazz, config, extraStyle) {
        var padding = this.$padding;
        var height, top, left;
        extraStyle = extraStyle || "";
       if (this.session.$bidiHandler.isBidiRow(range.start.row)) {
           var range1 = range.clone();
           range1.end.row = range1.start.row;
           range1.end.column = this.session.getLine(range1.start.row).length;
           this.drawBidiSingleLineMarker(stringBuilder, range1, clazz + " ace_br1 ace_start", config, null, extraStyle);
        } else {
           height = config.lineHeight;
           top = this.$getTop(range.start.row, config);
           left = padding + range.start.column * config.characterWidth;
           stringBuilder.push(
               "<div class='", clazz, " ace_br1 ace_start' style='",
               "height:", height, "px;",
               "right:0;",
               "top:", top, "px;",
               "left:", left, "px;", extraStyle, "'></div>"
           );
        }
        if (this.session.$bidiHandler.isBidiRow(range.end.row)) {
           var range1 = range.clone();
           range1.start.row = range1.end.row;
           range1.start.column = 0;
           this.drawBidiSingleLineMarker(stringBuilder, range1, clazz + " ace_br12", config, null, extraStyle);
        } else {
           var width = range.end.column * config.characterWidth;
           height = config.lineHeight;
           top = this.$getTop(range.end.row, config);
           stringBuilder.push(
               "<div class='", clazz, " ace_br12' style='",
               "height:", height, "px;",
               "width:", width, "px;",
               "top:", top, "px;",
               "left:", padding, "px;", extraStyle, "'></div>"
           );
        }
        height = (range.end.row - range.start.row - 1) * config.lineHeight;
        if (height <= 0)
            return;
        top = this.$getTop(range.start.row + 1, config);
        
        var radiusClass = (range.start.column ? 1 : 0) | (range.end.column ? 0 : 8);

        stringBuilder.push(
            "<div class='", clazz, (radiusClass ? " ace_br" + radiusClass : ""), "' style='",
            "height:", height, "px;",
            "right:0;",
            "top:", top, "px;",
            "left:", padding, "px;", extraStyle, "'></div>"
        );
    };
    this.drawSingleLineMarker = function(stringBuilder, range, clazz, config, extraLength, extraStyle) {
        var height = config.lineHeight;
        var width = (range.end.column + (extraLength || 0) - range.start.column) * config.characterWidth;

        var top = this.$getTop(range.start.row, config);
        var left = this.$padding + range.start.column * config.characterWidth;

        stringBuilder.push(
            "<div class='", clazz, "' style='",
            "height:", height, "px;",
            "width:", width, "px;",
            "top:", top, "px;",
            "left:", left, "px;", extraStyle || "", "'></div>"
        );
    };
    this.drawBidiSingleLineMarker = function(stringBuilder, range, clazz, config, extraLength, extraStyle) {
        var height = config.lineHeight, top = this.$getTop(range.start.row, config), padding = this.$padding;
        var selections = this.session.$bidiHandler.getSelections(range.start.column, range.end.column);

        selections.forEach(function(selection) {
            stringBuilder.push(
                "<div class='", clazz, "' style='",
                "height:", height, "px;",
                "width:", selection.width + (extraLength || 0), "px;",
                "top:", top, "px;",
                "left:", padding + selection.left, "px;", extraStyle || "", "'></div>"
            );
        });
    };

    this.drawFullLineMarker = function(stringBuilder, range, clazz, config, extraStyle) {
        var top = this.$getTop(range.start.row, config);
        var height = config.lineHeight;
        if (range.start.row != range.end.row)
            height += this.$getTop(range.end.row, config) - top;

        stringBuilder.push(
            "<div class='", clazz, "' style='",
            "height:", height, "px;",
            "top:", top, "px;",
            "left:0;right:0;", extraStyle || "", "'></div>"
        );
    };
    
    this.drawScreenLineMarker = function(stringBuilder, range, clazz, config, extraStyle) {
        var top = this.$getTop(range.start.row, config);
        var height = config.lineHeight;

        stringBuilder.push(
            "<div class='", clazz, "' style='",
            "height:", height, "px;",
            "top:", top, "px;",
            "left:0;right:0;", extraStyle || "", "'></div>"
        );
    };

}).call(Marker.prototype);

exports.Marker = Marker;

});

ace.define("ace/layer/text",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/useragent","ace/lib/event_emitter"], function(require, exports, module) {
"use strict";

var oop = require("../lib/oop");
var dom = require("../lib/dom");
var lang = require("../lib/lang");
var useragent = require("../lib/useragent");
var EventEmitter = require("../lib/event_emitter").EventEmitter;

var Text = function(parentEl) {
    this.element = dom.createElement("div");
    this.element.className = "ace_layer ace_text-layer";
    parentEl.appendChild(this.element);
    this.$updateEolChar = this.$updateEolChar.bind(this);
};

(function() {

    oop.implement(this, EventEmitter);

    this.EOF_CHAR = "\xB6";
    this.EOL_CHAR_LF = "\xAC";
    this.EOL_CHAR_CRLF = "\xa4";
    this.EOL_CHAR = this.EOL_CHAR_LF;
    this.TAB_CHAR = "\u2014"; //"\u21E5";
    this.SPACE_CHAR = "\xB7";
    this.$padding = 0;

    this.$updateEolChar = function() {
        var EOL_CHAR = this.session.doc.getNewLineCharacter() == "\n"
           ? this.EOL_CHAR_LF
           : this.EOL_CHAR_CRLF;
        if (this.EOL_CHAR != EOL_CHAR) {
            this.EOL_CHAR = EOL_CHAR;
            return true;
        }
    };

    this.setPadding = function(padding) {
        this.$padding = padding;
        this.element.style.padding = "0 " + padding + "px";
    };

    this.getLineHeight = function() {
        return this.$fontMetrics.$characterSize.height || 0;
    };

    this.getCharacterWidth = function() {
        return this.$fontMetrics.$characterSize.width || 0;
    };
    
    this.$setFontMetrics = function(measure) {
        this.$fontMetrics = measure;
        this.$fontMetrics.on("changeCharacterSize", function(e) {
            this._signal("changeCharacterSize", e);
        }.bind(this));
        this.$pollSizeChanges();
    };

    this.checkForSizeChanges = function() {
        this.$fontMetrics.checkForSizeChanges();
    };
    this.$pollSizeChanges = function() {
        return this.$pollSizeChangesTimer = this.$fontMetrics.$pollSizeChanges();
    };
    this.setSession = function(session) {
        this.session = session;
        if (session)
            this.$computeTabString();
    };

    this.showInvisibles = false;
    this.setShowInvisibles = function(showInvisibles) {
        if (this.showInvisibles == showInvisibles)
            return false;

        this.showInvisibles = showInvisibles;
        this.$computeTabString();
        return true;
    };

    this.displayIndentGuides = true;
    this.setDisplayIndentGuides = function(display) {
        if (this.displayIndentGuides == display)
            return false;

        this.displayIndentGuides = display;
        this.$computeTabString();
        return true;
    };

    this.$tabStrings = [];
    this.onChangeTabSize =
    this.$computeTabString = function() {
        var tabSize = this.session.getTabSize();
        this.tabSize = tabSize;
        var tabStr = this.$tabStrings = [0];
        for (var i = 1; i < tabSize + 1; i++) {
            if (this.showInvisibles) {
                tabStr.push("<span class='ace_invisible ace_invisible_tab'>"
                    + lang.stringRepeat(this.TAB_CHAR, i)
                    + "</span>");
            } else {
                tabStr.push(lang.stringRepeat(" ", i));
            }
        }
        if (this.displayIndentGuides) {
            this.$indentGuideRe =  /\s\S| \t|\t |\s$/;
            var className = "ace_indent-guide";
            var spaceClass = "";
            var tabClass = "";
            if (this.showInvisibles) {
                className += " ace_invisible";
                spaceClass = " ace_invisible_space";
                tabClass = " ace_invisible_tab";
                var spaceContent = lang.stringRepeat(this.SPACE_CHAR, this.tabSize);
                var tabContent = lang.stringRepeat(this.TAB_CHAR, this.tabSize);
            } else{
                var spaceContent = lang.stringRepeat(" ", this.tabSize);
                var tabContent = spaceContent;
            }

            this.$tabStrings[" "] = "<span class='" + className + spaceClass + "'>" + spaceContent + "</span>";
            this.$tabStrings["\t"] = "<span class='" + className + tabClass + "'>" + tabContent + "</span>";
        }
    };

    this.updateLines = function(config, firstRow, lastRow) {
        if (this.config.lastRow != config.lastRow ||
            this.config.firstRow != config.firstRow) {
            this.scrollLines(config);
        }
        this.config = config;

        var first = Math.max(firstRow, config.firstRow);
        var last = Math.min(lastRow, config.lastRow);

        var lineElements = this.element.childNodes;
        var lineElementsIdx = 0;

        for (var row = config.firstRow; row < first; row++) {
            var foldLine = this.session.getFoldLine(row);
            if (foldLine) {
                if (foldLine.containsRow(first)) {
                    first = foldLine.start.row;
                    break;
                } else {
                    row = foldLine.end.row;
                }
            }
            lineElementsIdx ++;
        }

        var row = first;
        var foldLine = this.session.getNextFoldLine(row);
        var foldStart = foldLine ? foldLine.start.row : Infinity;

        while (true) {
            if (row > foldStart) {
                row = foldLine.end.row+1;
                foldLine = this.session.getNextFoldLine(row, foldLine);
                foldStart = foldLine ? foldLine.start.row :Infinity;
            }
            if (row > last)
                break;

            var lineElement = lineElements[lineElementsIdx++];
            if (lineElement) {
                var html = [];
                this.$renderLine(
                    html, row, !this.$useLineGroups(), row == foldStart ? foldLine : false
                );
                lineElement.style.height = config.lineHeight * this.session.getRowLength(row) + "px";
                lineElement.innerHTML = html.join("");
            }
            row++;
        }
    };

    this.scrollLines = function(config) {
        var oldConfig = this.config;
        this.config = config;

        if (!oldConfig || oldConfig.lastRow < config.firstRow)
            return this.update(config);

        if (config.lastRow < oldConfig.firstRow)
            return this.update(config);

        var el = this.element;
        if (oldConfig.firstRow < config.firstRow)
            for (var row=this.session.getFoldedRowCount(oldConfig.firstRow, config.firstRow - 1); row>0; row--)
                el.removeChild(el.firstChild);

        if (oldConfig.lastRow > config.lastRow)
            for (var row=this.session.getFoldedRowCount(config.lastRow + 1, oldConfig.lastRow); row>0; row--)
                el.removeChild(el.lastChild);

        if (config.firstRow < oldConfig.firstRow) {
            var fragment = this.$renderLinesFragment(config, config.firstRow, oldConfig.firstRow - 1);
            if (el.firstChild)
                el.insertBefore(fragment, el.firstChild);
            else
                el.appendChild(fragment);
        }

        if (config.lastRow > oldConfig.lastRow) {
            var fragment = this.$renderLinesFragment(config, oldConfig.lastRow + 1, config.lastRow);
            el.appendChild(fragment);
        }
    };

    this.$renderLinesFragment = function(config, firstRow, lastRow) {
        var fragment = this.element.ownerDocument.createDocumentFragment();
        var row = firstRow;
        var foldLine = this.session.getNextFoldLine(row);
        var foldStart = foldLine ? foldLine.start.row : Infinity;

        while (true) {
            if (row > foldStart) {
                row = foldLine.end.row+1;
                foldLine = this.session.getNextFoldLine(row, foldLine);
                foldStart = foldLine ? foldLine.start.row : Infinity;
            }
            if (row > lastRow)
                break;

            var container = dom.createElement("div");

            var html = [];
            this.$renderLine(html, row, false, row == foldStart ? foldLine : false);
            container.innerHTML = html.join("");
            if (this.$useLineGroups()) {
                container.className = 'ace_line_group';
                fragment.appendChild(container);
                container.style.height = config.lineHeight * this.session.getRowLength(row) + "px";

            } else {
                while(container.firstChild)
                    fragment.appendChild(container.firstChild);
            }

            row++;
        }
        return fragment;
    };

    this.update = function(config) {
        this.config = config;

        var html = [];
        var firstRow = config.firstRow, lastRow = config.lastRow;

        var row = firstRow;
        var foldLine = this.session.getNextFoldLine(row);
        var foldStart = foldLine ? foldLine.start.row : Infinity;

        while (true) {
            if (row > foldStart) {
                row = foldLine.end.row+1;
                foldLine = this.session.getNextFoldLine(row, foldLine);
                foldStart = foldLine ? foldLine.start.row :Infinity;
            }
            if (row > lastRow)
                break;

            if (this.$useLineGroups())
                html.push("<div class='ace_line_group' style='height:", config.lineHeight*this.session.getRowLength(row), "px'>");

            this.$renderLine(html, row, false, row == foldStart ? foldLine : false);

            if (this.$useLineGroups())
                html.push("</div>"); // end the line group

            row++;
        }
        this.element.innerHTML = html.join("");
    };

    this.$textToken = {
        "text": true,
        "rparen": true,
        "lparen": true
    };

    this.$renderToken = function(stringBuilder, screenColumn, token, value) {
        var self = this;
        var replaceReg = /\t|&|<|>|( +)|([\x00-\x1f\x80-\xa0\xad\u1680\u180E\u2000-\u200f\u2028\u2029\u202F\u205F\u3000\uFEFF\uFFF9-\uFFFC])|[\u1100-\u115F\u11A3-\u11A7\u11FA-\u11FF\u2329-\u232A\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3000-\u303E\u3041-\u3096\u3099-\u30FF\u3105-\u312D\u3131-\u318E\u3190-\u31BA\u31C0-\u31E3\u31F0-\u321E\u3220-\u3247\u3250-\u32FE\u3300-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFAFF\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFF01-\uFF60\uFFE0-\uFFE6]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g;
        var replaceFunc = function(c, a, b, tabIdx, idx4) {
            if (a) {
                return self.showInvisibles
                    ? "<span class='ace_invisible ace_invisible_space'>" + lang.stringRepeat(self.SPACE_CHAR, c.length) + "</span>"
                    : c;
            } else if (c == "&") {
                return "&#38;";
            } else if (c == "<") {
                return "&#60;";
            } else if (c == ">") {
                return "&#62;";
            } else if (c == "\t") {
                var tabSize = self.session.getScreenTabSize(screenColumn + tabIdx);
                screenColumn += tabSize - 1;
                return self.$tabStrings[tabSize];
            } else if (c == "\u3000") {
                var classToUse = self.showInvisibles ? "ace_cjk ace_invisible ace_invisible_space" : "ace_cjk";
                var space = self.showInvisibles ? self.SPACE_CHAR : "";
                screenColumn += 1;
                return "<span class='" + classToUse + "' style='width:" +
                    (self.config.characterWidth * 2) +
                    "px'>" + space + "</span>";
            } else if (b) {
                return "<span class='ace_invisible ace_invisible_space ace_invalid'>" + self.SPACE_CHAR + "</span>";
            } else {
                screenColumn += 1;
                return "<span class='ace_cjk' style='width:" +
                    (self.config.characterWidth * 2) +
                    "px'>" + c + "</span>";
            }
        };

        var output = value.replace(replaceReg, replaceFunc);

        if (!this.$textToken[token.type]) {
            var classes = "ace_" + token.type.replace(/\./g, " ace_");
            var style = "";
            if (token.type == "fold")
                style = " style='width:" + (token.value.length * this.config.characterWidth) + "px;' ";
            stringBuilder.push("<span class='", classes, "'", style, ">", output, "</span>");
        }
        else {
            stringBuilder.push(output);
        }
        return screenColumn + value.length;
    };

    this.renderIndentGuide = function(stringBuilder, value, max) {
        var cols = value.search(this.$indentGuideRe);
        if (cols <= 0 || cols >= max)
            return value;
        if (value[0] == " ") {
            cols -= cols % this.tabSize;
            stringBuilder.push(lang.stringRepeat(this.$tabStrings[" "], cols/this.tabSize));
            return value.substr(cols);
        } else if (value[0] == "\t") {
            stringBuilder.push(lang.stringRepeat(this.$tabStrings["\t"], cols));
            return value.substr(cols);
        }
        return value;
    };

    this.$renderWrappedLine = function(stringBuilder, tokens, splits, onlyContents) {
        var chars = 0;
        var split = 0;
        var splitChars = splits[0];
        var screenColumn = 0;

        for (var i = 0; i < tokens.length; i++) {
            var token = tokens[i];
            var value = token.value;
            if (i == 0 && this.displayIndentGuides) {
                chars = value.length;
                value = this.renderIndentGuide(stringBuilder, value, splitChars);
                if (!value)
                    continue;
                chars -= value.length;
            }

            if (chars + value.length < splitChars) {
                screenColumn = this.$renderToken(stringBuilder, screenColumn, token, value);
                chars += value.length;
            } else {
                while (chars + value.length >= splitChars) {
                    screenColumn = this.$renderToken(
                        stringBuilder, screenColumn,
                        token, value.substring(0, splitChars - chars)
                    );
                    value = value.substring(splitChars - chars);
                    chars = splitChars;

                    if (!onlyContents) {
                        stringBuilder.push("</div>",
                            "<div class='ace_line' style='height:",
                            this.config.lineHeight, "px'>"
                        );
                    }

                    stringBuilder.push(lang.stringRepeat("\xa0", splits.indent));

                    split ++;
                    screenColumn = 0;
                    splitChars = splits[split] || Number.MAX_VALUE;
                }
                if (value.length != 0) {
                    chars += value.length;
                    screenColumn = this.$renderToken(
                        stringBuilder, screenColumn, token, value
                    );
                }
            }
        }
    };

    this.$renderSimpleLine = function(stringBuilder, tokens) {
        var screenColumn = 0;
        var token = tokens[0];
        var value = token.value;
        if (this.displayIndentGuides)
            value = this.renderIndentGuide(stringBuilder, value);
        if (value)
            screenColumn = this.$renderToken(stringBuilder, screenColumn, token, value);
        for (var i = 1; i < tokens.length; i++) {
            token = tokens[i];
            value = token.value;
            screenColumn = this.$renderToken(stringBuilder, screenColumn, token, value);
        }
    };
    this.$renderLine = function(stringBuilder, row, onlyContents, foldLine) {
        if (!foldLine && foldLine != false)
            foldLine = this.session.getFoldLine(row);

        if (foldLine)
            var tokens = this.$getFoldLineTokens(row, foldLine);
        else
            var tokens = this.session.getTokens(row);


        if (!onlyContents) {
            stringBuilder.push(
                "<div class='ace_line' style='height:", 
                    this.config.lineHeight * (
                        this.$useLineGroups() ? 1 :this.session.getRowLength(row)
                    ), "px'>"
            );
        }

        if (tokens.length) {
            var splits = this.session.getRowSplitData(row);
            if (splits && splits.length)
                this.$renderWrappedLine(stringBuilder, tokens, splits, onlyContents);
            else
                this.$renderSimpleLine(stringBuilder, tokens);
        }

        if (this.showInvisibles) {
            if (foldLine)
                row = foldLine.end.row;

            stringBuilder.push(
                "<span class='ace_invisible ace_invisible_eol'>",
                row == this.session.getLength() - 1 ? this.EOF_CHAR : this.EOL_CHAR,
                "</span>"
            );
        }
        if (!onlyContents)
            stringBuilder.push("</div>");
    };

    this.$getFoldLineTokens = function(row, foldLine) {
        var session = this.session;
        var renderTokens = [];

        function addTokens(tokens, from, to) {
            var idx = 0, col = 0;
            while ((col + tokens[idx].value.length) < from) {
                col += tokens[idx].value.length;
                idx++;

                if (idx == tokens.length)
                    return;
            }
            if (col != from) {
                var value = tokens[idx].value.substring(from - col);
                if (value.length > (to - from))
                    value = value.substring(0, to - from);

                renderTokens.push({
                    type: tokens[idx].type,
                    value: value
                });

                col = from + value.length;
                idx += 1;
            }

            while (col < to && idx < tokens.length) {
                var value = tokens[idx].value;
                if (value.length + col > to) {
                    renderTokens.push({
                        type: tokens[idx].type,
                        value: value.substring(0, to - col)
                    });
                } else
                    renderTokens.push(tokens[idx]);
                col += value.length;
                idx += 1;
            }
        }

        var tokens = session.getTokens(row);
        foldLine.walk(function(placeholder, row, column, lastColumn, isNewRow) {
            if (placeholder != null) {
                renderTokens.push({
                    type: "fold",
                    value: placeholder
                });
            } else {
                if (isNewRow)
                    tokens = session.getTokens(row);

                if (tokens.length)
                    addTokens(tokens, lastColumn, column);
            }
        }, foldLine.end.row, this.session.getLine(foldLine.end.row).length);

        return renderTokens;
    };

    this.$useLineGroups = function() {
        return this.session.getUseWrapMode();
    };

    this.destroy = function() {
        clearInterval(this.$pollSizeChangesTimer);
        if (this.$measureNode)
            this.$measureNode.parentNode.removeChild(this.$measureNode);
        delete this.$measureNode;
    };

}).call(Text.prototype);

exports.Text = Text;

});

ace.define("ace/layer/cursor",["require","exports","module","ace/lib/dom"], function(require, exports, module) {
"use strict";

var dom = require("../lib/dom");
var isIE8;

var Cursor = function(parentEl) {
    this.element = dom.createElement("div");
    this.element.className = "ace_layer ace_cursor-layer";
    parentEl.appendChild(this.element);
    
    if (isIE8 === undefined)
        isIE8 = !("opacity" in this.element.style);

    this.isVisible = false;
    this.isBlinking = true;
    this.blinkInterval = 1000;
    this.smoothBlinking = false;

    this.cursors = [];
    this.cursor = this.addCursor();
    dom.addCssClass(this.element, "ace_hidden-cursors");
    this.$updateCursors = (isIE8
        ? this.$updateVisibility
        : this.$updateOpacity).bind(this);
};

(function() {
    
    this.$updateVisibility = function(val) {
        var cursors = this.cursors;
        for (var i = cursors.length; i--; )
            cursors[i].style.visibility = val ? "" : "hidden";
    };
    this.$updateOpacity = function(val) {
        var cursors = this.cursors;
        for (var i = cursors.length; i--; )
            cursors[i].style.opacity = val ? "" : "0";
    };
    

    this.$padding = 0;
    this.setPadding = function(padding) {
        this.$padding = padding;
    };

    this.setSession = function(session) {
        this.session = session;
    };

    this.setBlinking = function(blinking) {
        if (blinking != this.isBlinking){
            this.isBlinking = blinking;
            this.restartTimer();
        }
    };

    this.setBlinkInterval = function(blinkInterval) {
        if (blinkInterval != this.blinkInterval){
            this.blinkInterval = blinkInterval;
            this.restartTimer();
        }
    };

    this.setSmoothBlinking = function(smoothBlinking) {
        if (smoothBlinking != this.smoothBlinking && !isIE8) {
            this.smoothBlinking = smoothBlinking;
            dom.setCssClass(this.element, "ace_smooth-blinking", smoothBlinking);
            this.$updateCursors(true);
            this.$updateCursors = (this.$updateOpacity).bind(this);
            this.restartTimer();
        }
    };

    this.addCursor = function() {
        var el = dom.createElement("div");
        el.className = "ace_cursor";
        this.element.appendChild(el);
        this.cursors.push(el);
        return el;
    };

    this.removeCursor = function() {
        if (this.cursors.length > 1) {
            var el = this.cursors.pop();
            el.parentNode.removeChild(el);
            return el;
        }
    };

    this.hideCursor = function() {
        this.isVisible = false;
        dom.addCssClass(this.element, "ace_hidden-cursors");
        this.restartTimer();
    };

    this.showCursor = function() {
        this.isVisible = true;
        dom.removeCssClass(this.element, "ace_hidden-cursors");
        this.restartTimer();
    };

    this.restartTimer = function() {
        var update = this.$updateCursors;
        clearInterval(this.intervalId);
        clearTimeout(this.timeoutId);
        if (this.smoothBlinking) {
            dom.removeCssClass(this.element, "ace_smooth-blinking");
        }
        
        update(true);

        if (!this.isBlinking || !this.blinkInterval || !this.isVisible)
            return;

        if (this.smoothBlinking) {
            setTimeout(function(){
                dom.addCssClass(this.element, "ace_smooth-blinking");
            }.bind(this));
        }
        
        var blink = function(){
            this.timeoutId = setTimeout(function() {
                update(false);
            }, 0.6 * this.blinkInterval);
        }.bind(this);

        this.intervalId = setInterval(function() {
            update(true);
            blink();
        }, this.blinkInterval);

        blink();
    };

    this.getPixelPosition = function(position, onScreen) {
        if (!this.config || !this.session)
            return {left : 0, top : 0};

        if (!position)
            position = this.session.selection.getCursor();
        var pos = this.session.documentToScreenPosition(position);
        var cursorLeft = this.$padding + (this.session.$bidiHandler.isBidiRow(pos.row, position.row)
            ? this.session.$bidiHandler.getPosLeft(pos.column)
            : pos.column * this.config.characterWidth);

        var cursorTop = (pos.row - (onScreen ? this.config.firstRowScreen : 0)) *
            this.config.lineHeight;

        return {left : cursorLeft, top : cursorTop};
    };

    this.update = function(config) {
        this.config = config;

        var selections = this.session.$selectionMarkers;
        var i = 0, cursorIndex = 0;

        if (selections === undefined || selections.length === 0){
            selections = [{cursor: null}];
        }

        for (var i = 0, n = selections.length; i < n; i++) {
            var pixelPos = this.getPixelPosition(selections[i].cursor, true);
            if ((pixelPos.top > config.height + config.offset ||
                 pixelPos.top < 0) && i > 1) {
                continue;
            }

            var style = (this.cursors[cursorIndex++] || this.addCursor()).style;
            
            if (!this.drawCursor) {
                style.left = pixelPos.left + "px";
                style.top = pixelPos.top + "px";
                style.width = config.characterWidth + "px";
                style.height = config.lineHeight + "px";
            } else {
                this.drawCursor(style, pixelPos, config, selections[i], this.session);
            }
        }
        while (this.cursors.length > cursorIndex)
            this.removeCursor();

        var overwrite = this.session.getOverwrite();
        this.$setOverwrite(overwrite);
        this.$pixelPos = pixelPos;
        this.restartTimer();
    };
    
    this.drawCursor = null;

    this.$setOverwrite = function(overwrite) {
        if (overwrite != this.overwrite) {
            this.overwrite = overwrite;
            if (overwrite)
                dom.addCssClass(this.element, "ace_overwrite-cursors");
            else
                dom.removeCssClass(this.element, "ace_overwrite-cursors");
        }
    };

    this.destroy = function() {
        clearInterval(this.intervalId);
        clearTimeout(this.timeoutId);
    };

}).call(Cursor.prototype);

exports.Cursor = Cursor;

});

ace.define("ace/scrollbar",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/event","ace/lib/event_emitter"], function(require, exports, module) {
"use strict";

var oop = require("./lib/oop");
var dom = require("./lib/dom");
var event = require("./lib/event");
var EventEmitter = require("./lib/event_emitter").EventEmitter;
var MAX_SCROLL_H = 0x8000;
var ScrollBar = function(parent) {
    this.element = dom.createElement("div");
    this.element.className = "ace_scrollbar ace_scrollbar" + this.classSuffix;

    this.inner = dom.createElement("div");
    this.inner.className = "ace_scrollbar-inner";
    this.element.appendChild(this.inner);

    parent.appendChild(this.element);

    this.setVisible(false);
    this.skipEvent = false;

    event.addListener(this.element, "scroll", this.onScroll.bind(this));
    event.addListener(this.element, "mousedown", event.preventDefault);
};

(function() {
    oop.implement(this, EventEmitter);

    this.setVisible = function(isVisible) {
        this.element.style.display = isVisible ? "" : "none";
        this.isVisible = isVisible;
        this.coeff = 1;
    };
}).call(ScrollBar.prototype);
var VScrollBar = function(parent, renderer) {
    ScrollBar.call(this, parent);
    this.scrollTop = 0;
    this.scrollHeight = 0;
    renderer.$scrollbarWidth = 
    this.width = dom.scrollbarWidth(parent.ownerDocument);
    this.inner.style.width =
    this.element.style.width = (this.width || 15) + 5 + "px";
    this.$minWidth = 0;
};

oop.inherits(VScrollBar, ScrollBar);

(function() {

    this.classSuffix = '-v';
    this.onScroll = function() {
        if (!this.skipEvent) {
            this.scrollTop = this.element.scrollTop;
            if (this.coeff != 1) {
                var h = this.element.clientHeight / this.scrollHeight;
                this.scrollTop = this.scrollTop * (1 - h) / (this.coeff - h);
            }
            this._emit("scroll", {data: this.scrollTop});
        }
        this.skipEvent = false;
    };
    this.getWidth = function() {
        return Math.max(this.isVisible ? this.width : 0, this.$minWidth || 0);
    };
    this.setHeight = function(height) {
        this.element.style.height = height + "px";
    };
    this.setInnerHeight = 
    this.setScrollHeight = function(height) {
        this.scrollHeight = height;
        if (height > MAX_SCROLL_H) {
            this.coeff = MAX_SCROLL_H / height;
            height = MAX_SCROLL_H;
        } else if (this.coeff != 1) {
            this.coeff = 1;
        }
        this.inner.style.height = height + "px";
    };
    this.setScrollTop = function(scrollTop) {
        if (this.scrollTop != scrollTop) {
            this.skipEvent = true;
            this.scrollTop = scrollTop;
            this.element.scrollTop = scrollTop * this.coeff;
        }
    };

}).call(VScrollBar.prototype);
var HScrollBar = function(parent, renderer) {
    ScrollBar.call(this, parent);
    this.scrollLeft = 0;
    this.height = renderer.$scrollbarWidth;
    this.inner.style.height =
    this.element.style.height = (this.height || 15) + 5 + "px";
};

oop.inherits(HScrollBar, ScrollBar);

(function() {

    this.classSuffix = '-h';
    this.onScroll = function() {
        if (!this.skipEvent) {
            this.scrollLeft = this.element.scrollLeft;
            this._emit("scroll", {data: this.scrollLeft});
        }
        this.skipEvent = false;
    };
    this.getHeight = function() {
        return this.isVisible ? this.height : 0;
    };
    this.setWidth = function(width) {
        this.element.style.width = width + "px";
    };
    this.setInnerWidth = function(width) {
        this.inner.style.width = width + "px";
    };
    this.setScrollWidth = function(width) {
        this.inner.style.width = width + "px";
    };
    this.setScrollLeft = function(scrollLeft) {
        if (this.scrollLeft != scrollLeft) {
            this.skipEvent = true;
            this.scrollLeft = this.element.scrollLeft = scrollLeft;
        }
    };

}).call(HScrollBar.prototype);


exports.ScrollBar = VScrollBar; // backward compatibility
exports.ScrollBarV = VScrollBar; // backward compatibility
exports.ScrollBarH = HScrollBar; // backward compatibility

exports.VScrollBar = VScrollBar;
exports.HScrollBar = HScrollBar;
});

ace.define("ace/renderloop",["require","exports","module","ace/lib/event"], function(require, exports, module) {
"use strict";

var event = require("./lib/event");


var RenderLoop = function(onRender, win) {
    this.onRender = onRender;
    this.pending = false;
    this.changes = 0;
    this.window = win || window;
};

(function() {


    this.schedule = function(change) {
        this.changes = this.changes | change;
        if (!this.pending && this.changes) {
            this.pending = true;
            var _self = this;
            event.nextFrame(function() {
                _self.pending = false;
                var changes;
                while (changes = _self.changes) {
                    _self.changes = 0;
                    _self.onRender(changes);
                }
            }, this.window);
        }
    };

}).call(RenderLoop.prototype);

exports.RenderLoop = RenderLoop;
});

ace.define("ace/layer/font_metrics",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/useragent","ace/lib/event_emitter"], function(require, exports, module) {

var oop = require("../lib/oop");
var dom = require("../lib/dom");
var lang = require("../lib/lang");
var useragent = require("../lib/useragent");
var EventEmitter = require("../lib/event_emitter").EventEmitter;

var CHAR_COUNT = 0;

var FontMetrics = exports.FontMetrics = function(parentEl) {
    this.el = dom.createElement("div");
    this.$setMeasureNodeStyles(this.el.style, true);
    
    this.$main = dom.createElement("div");
    this.$setMeasureNodeStyles(this.$main.style);
    
    this.$measureNode = dom.createElement("div");
    this.$setMeasureNodeStyles(this.$measureNode.style);
    
    
    this.el.appendChild(this.$main);
    this.el.appendChild(this.$measureNode);
    parentEl.appendChild(this.el);
    
    if (!CHAR_COUNT)
        this.$testFractionalRect();
    this.$measureNode.innerHTML = lang.stringRepeat("X", CHAR_COUNT);
    
    this.$characterSize = {width: 0, height: 0};
    this.checkForSizeChanges();
};

(function() {

    oop.implement(this, EventEmitter);
        
    this.$characterSize = {width: 0, height: 0};
    
    this.$testFractionalRect = function() {
        var el = dom.createElement("div");
        this.$setMeasureNodeStyles(el.style);
        el.style.width = "0.2px";
        document.documentElement.appendChild(el);
        var w = el.getBoundingClientRect().width;
        if (w > 0 && w < 1)
            CHAR_COUNT = 50;
        else
            CHAR_COUNT = 100;
        el.parentNode.removeChild(el);
    };
    
    this.$setMeasureNodeStyles = function(style, isRoot) {
        style.width = style.height = "auto";
        style.left = style.top = "0px";
        style.visibility = "hidden";
        style.position = "absolute";
        style.whiteSpace = "pre";

        if (useragent.isIE < 8) {
            style["font-family"] = "inherit";
        } else {
            style.font = "inherit";
        }
        style.overflow = isRoot ? "hidden" : "visible";
    };

    this.checkForSizeChanges = function() {
        var size = this.$measureSizes();
        if (size && (this.$characterSize.width !== size.width || this.$characterSize.height !== size.height)) {
            this.$measureNode.style.fontWeight = "bold";
            var boldSize = this.$measureSizes();
            this.$measureNode.style.fontWeight = "";
            this.$characterSize = size;
            this.charSizes = Object.create(null);
            this.allowBoldFonts = boldSize && boldSize.width === size.width && boldSize.height === size.height;
            this._emit("changeCharacterSize", {data: size});
        }
    };

    this.$pollSizeChanges = function() {
        if (this.$pollSizeChangesTimer)
            return this.$pollSizeChangesTimer;
        var self = this;
        return this.$pollSizeChangesTimer = setInterval(function() {
            self.checkForSizeChanges();
        }, 500);
    };
    
    this.setPolling = function(val) {
        if (val) {
            this.$pollSizeChanges();
        } else if (this.$pollSizeChangesTimer) {
            clearInterval(this.$pollSizeChangesTimer);
            this.$pollSizeChangesTimer = 0;
        }
    };

    this.$measureSizes = function() {
        if (CHAR_COUNT === 50) {
            var rect = null;
            try { 
               rect = this.$measureNode.getBoundingClientRect();
            } catch(e) {
               rect = {width: 0, height:0 };
            }
            var size = {
                height: rect.height,
                width: rect.width / CHAR_COUNT
            };
        } else {
            var size = {
                height: this.$measureNode.clientHeight,
                width: this.$measureNode.clientWidth / CHAR_COUNT
            };
        }
        if (size.width === 0 || size.height === 0)
            return null;
        return size;
    };

    this.$measureCharWidth = function(ch) {
        this.$main.innerHTML = lang.stringRepeat(ch, CHAR_COUNT);
        var rect = this.$main.getBoundingClientRect();
        return rect.width / CHAR_COUNT;
    };
    
    this.getCharacterWidth = function(ch) {
        var w = this.charSizes[ch];
        if (w === undefined) {
            w = this.charSizes[ch] = this.$measureCharWidth(ch) / this.$characterSize.width;
        }
        return w;
    };

    this.destroy = function() {
        clearInterval(this.$pollSizeChangesTimer);
        if (this.el && this.el.parentNode)
            this.el.parentNode.removeChild(this.el);
    };

}).call(FontMetrics.prototype);

});

ace.define("ace/virtual_renderer",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/config","ace/lib/useragent","ace/layer/gutter","ace/layer/marker","ace/layer/text","ace/layer/cursor","ace/scrollbar","ace/scrollbar","ace/renderloop","ace/layer/font_metrics","ace/lib/event_emitter"], function(require, exports, module) {
"use strict";

var oop = require("./lib/oop");
var dom = require("./lib/dom");
var config = require("./config");
var useragent = require("./lib/useragent");
var GutterLayer = require("./layer/gutter").Gutter;
var MarkerLayer = require("./layer/marker").Marker;
var TextLayer = require("./layer/text").Text;
var CursorLayer = require("./layer/cursor").Cursor;
var HScrollBar = require("./scrollbar").HScrollBar;
var VScrollBar = require("./scrollbar").VScrollBar;
var RenderLoop = require("./renderloop").RenderLoop;
var FontMetrics = require("./layer/font_metrics").FontMetrics;
var EventEmitter = require("./lib/event_emitter").EventEmitter;
var editorCss = ".ace_editor {\
position: relative;\
overflow: hidden;\
font: 12px/normal 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace;\
direction: ltr;\
text-align: left;\
-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\
}\
.ace_scroller {\
position: absolute;\
overflow: hidden;\
top: 0;\
bottom: 0;\
background-color: inherit;\
-ms-user-select: none;\
-moz-user-select: none;\
-webkit-user-select: none;\
user-select: none;\
cursor: text;\
}\
.ace_content {\
position: absolute;\
-moz-box-sizing: border-box;\
-webkit-box-sizing: border-box;\
box-sizing: border-box;\
min-width: 100%;\
}\
.ace_dragging .ace_scroller:before{\
position: absolute;\
top: 0;\
left: 0;\
right: 0;\
bottom: 0;\
content: '';\
background: rgba(250, 250, 250, 0.01);\
z-index: 1000;\
}\
.ace_dragging.ace_dark .ace_scroller:before{\
background: rgba(0, 0, 0, 0.01);\
}\
.ace_selecting, .ace_selecting * {\
cursor: text !important;\
}\
.ace_gutter {\
position: absolute;\
overflow : hidden;\
width: auto;\
top: 0;\
bottom: 0;\
left: 0;\
cursor: default;\
z-index: 4;\
-ms-user-select: none;\
-moz-user-select: none;\
-webkit-user-select: none;\
user-select: none;\
}\
.ace_gutter-active-line {\
position: absolute;\
left: 0;\
right: 0;\
}\
.ace_scroller.ace_scroll-left {\
box-shadow: 17px 0 16px -16px rgba(0, 0, 0, 0.4) inset;\
}\
.ace_gutter-cell {\
padding-left: 19px;\
padding-right: 6px;\
background-repeat: no-repeat;\
}\
.ace_gutter-cell.ace_error {\
background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABOFBMVEX/////////QRswFAb/Ui4wFAYwFAYwFAaWGAfDRymzOSH/PxswFAb/SiUwFAYwFAbUPRvjQiDllog5HhHdRybsTi3/Tyv9Tir+Syj/UC3////XurebMBIwFAb/RSHbPx/gUzfdwL3kzMivKBAwFAbbvbnhPx66NhowFAYwFAaZJg8wFAaxKBDZurf/RB6mMxb/SCMwFAYwFAbxQB3+RB4wFAb/Qhy4Oh+4QifbNRcwFAYwFAYwFAb/QRzdNhgwFAYwFAbav7v/Uy7oaE68MBK5LxLewr/r2NXewLswFAaxJw4wFAbkPRy2PyYwFAaxKhLm1tMwFAazPiQwFAaUGAb/QBrfOx3bvrv/VC/maE4wFAbRPBq6MRO8Qynew8Dp2tjfwb0wFAbx6eju5+by6uns4uH9/f36+vr/GkHjAAAAYnRSTlMAGt+64rnWu/bo8eAA4InH3+DwoN7j4eLi4xP99Nfg4+b+/u9B/eDs1MD1mO7+4PHg2MXa347g7vDizMLN4eG+Pv7i5evs/v79yu7S3/DV7/498Yv24eH+4ufQ3Ozu/v7+y13sRqwAAADLSURBVHjaZc/XDsFgGIBhtDrshlitmk2IrbHFqL2pvXf/+78DPokj7+Fz9qpU/9UXJIlhmPaTaQ6QPaz0mm+5gwkgovcV6GZzd5JtCQwgsxoHOvJO15kleRLAnMgHFIESUEPmawB9ngmelTtipwwfASilxOLyiV5UVUyVAfbG0cCPHig+GBkzAENHS0AstVF6bacZIOzgLmxsHbt2OecNgJC83JERmePUYq8ARGkJx6XtFsdddBQgZE2nPR6CICZhawjA4Fb/chv+399kfR+MMMDGOQAAAABJRU5ErkJggg==\");\
background-repeat: no-repeat;\
background-position: 2px center;\
}\
.ace_gutter-cell.ace_warning {\
background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAmVBMVEX///8AAAD///8AAAAAAABPSzb/5sAAAAB/blH/73z/ulkAAAAAAAD85pkAAAAAAAACAgP/vGz/rkDerGbGrV7/pkQICAf////e0IsAAAD/oED/qTvhrnUAAAD/yHD/njcAAADuv2r/nz//oTj/p064oGf/zHAAAAA9Nir/tFIAAAD/tlTiuWf/tkIAAACynXEAAAAAAAAtIRW7zBpBAAAAM3RSTlMAABR1m7RXO8Ln31Z36zT+neXe5OzooRDfn+TZ4p3h2hTf4t3k3ucyrN1K5+Xaks52Sfs9CXgrAAAAjklEQVR42o3PbQ+CIBQFYEwboPhSYgoYunIqqLn6/z8uYdH8Vmdnu9vz4WwXgN/xTPRD2+sgOcZjsge/whXZgUaYYvT8QnuJaUrjrHUQreGczuEafQCO/SJTufTbroWsPgsllVhq3wJEk2jUSzX3CUEDJC84707djRc5MTAQxoLgupWRwW6UB5fS++NV8AbOZgnsC7BpEAAAAABJRU5ErkJggg==\");\
background-position: 2px center;\
}\
.ace_gutter-cell.ace_info {\
background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAJ0Uk5TAAB2k804AAAAPklEQVQY02NgIB68QuO3tiLznjAwpKTgNyDbMegwisCHZUETUZV0ZqOquBpXj2rtnpSJT1AEnnRmL2OgGgAAIKkRQap2htgAAAAASUVORK5CYII=\");\
background-position: 2px center;\
}\
.ace_dark .ace_gutter-cell.ace_info {\
background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAChoaGAgIAqKiq+vr6tra1ZWVmUlJSbm5s8PDxubm56enrdgzg3AAAAAXRSTlMAQObYZgAAAClJREFUeNpjYMAPdsMYHegyJZFQBlsUlMFVCWUYKkAZMxZAGdxlDMQBAG+TBP4B6RyJAAAAAElFTkSuQmCC\");\
}\
.ace_scrollbar {\
position: absolute;\
right: 0;\
bottom: 0;\
z-index: 6;\
}\
.ace_scrollbar-inner {\
position: absolute;\
cursor: text;\
left: 0;\
top: 0;\
}\
.ace_scrollbar-v{\
overflow-x: hidden;\
overflow-y: scroll;\
top: 0;\
}\
.ace_scrollbar-h {\
overflow-x: scroll;\
overflow-y: hidden;\
left: 0;\
}\
.ace_print-margin {\
position: absolute;\
height: 100%;\
}\
.ace_text-input {\
position: absolute;\
z-index: 0;\
width: 0.5em;\
height: 1em;\
opacity: 0;\
background: transparent;\
-moz-appearance: none;\
appearance: none;\
border: none;\
resize: none;\
outline: none;\
overflow: hidden;\
font: inherit;\
padding: 0 1px;\
margin: 0 -1px;\
text-indent: -1em;\
-ms-user-select: text;\
-moz-user-select: text;\
-webkit-user-select: text;\
user-select: text;\
white-space: pre!important;\
}\
.ace_text-input.ace_composition {\
background: inherit;\
color: inherit;\
z-index: 1000;\
opacity: 1;\
text-indent: 0;\
}\
.ace_layer {\
z-index: 1;\
position: absolute;\
overflow: hidden;\
word-wrap: normal;\
white-space: pre;\
height: 100%;\
width: 100%;\
-moz-box-sizing: border-box;\
-webkit-box-sizing: border-box;\
box-sizing: border-box;\
pointer-events: none;\
}\
.ace_gutter-layer {\
position: relative;\
width: auto;\
text-align: right;\
pointer-events: auto;\
}\
.ace_text-layer {\
font: inherit !important;\
}\
.ace_cjk {\
display: inline-block;\
text-align: center;\
}\
.ace_cursor-layer {\
z-index: 4;\
}\
.ace_cursor {\
z-index: 4;\
position: absolute;\
-moz-box-sizing: border-box;\
-webkit-box-sizing: border-box;\
box-sizing: border-box;\
border-left: 2px solid;\
transform: translatez(0);\
}\
.ace_multiselect .ace_cursor {\
border-left-width: 1px;\
}\
.ace_slim-cursors .ace_cursor {\
border-left-width: 1px;\
}\
.ace_overwrite-cursors .ace_cursor {\
border-left-width: 0;\
border-bottom: 1px solid;\
}\
.ace_hidden-cursors .ace_cursor {\
opacity: 0.2;\
}\
.ace_smooth-blinking .ace_cursor {\
-webkit-transition: opacity 0.18s;\
transition: opacity 0.18s;\
}\
.ace_marker-layer .ace_step, .ace_marker-layer .ace_stack {\
position: absolute;\
z-index: 3;\
}\
.ace_marker-layer .ace_selection {\
position: absolute;\
z-index: 5;\
}\
.ace_marker-layer .ace_bracket {\
position: absolute;\
z-index: 6;\
}\
.ace_marker-layer .ace_active-line {\
position: absolute;\
z-index: 2;\
}\
.ace_marker-layer .ace_selected-word {\
position: absolute;\
z-index: 4;\
-moz-box-sizing: border-box;\
-webkit-box-sizing: border-box;\
box-sizing: border-box;\
}\
.ace_line .ace_fold {\
-moz-box-sizing: border-box;\
-webkit-box-sizing: border-box;\
box-sizing: border-box;\
display: inline-block;\
height: 11px;\
margin-top: -2px;\
vertical-align: middle;\
background-image:\
url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII=\"),\
url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACJJREFUeNpi+P//fxgTAwPDBxDxD078RSX+YeEyDFMCIMAAI3INmXiwf2YAAAAASUVORK5CYII=\");\
background-repeat: no-repeat, repeat-x;\
background-position: center center, top left;\
color: transparent;\
border: 1px solid black;\
border-radius: 2px;\
cursor: pointer;\
pointer-events: auto;\
}\
.ace_dark .ace_fold {\
}\
.ace_fold:hover{\
background-image:\
url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII=\"),\
url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACBJREFUeNpi+P//fz4TAwPDZxDxD5X4i5fLMEwJgAADAEPVDbjNw87ZAAAAAElFTkSuQmCC\");\
}\
.ace_tooltip {\
background-color: #FFF;\
background-image: -webkit-linear-gradient(top, transparent, rgba(0, 0, 0, 0.1));\
background-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.1));\
border: 1px solid gray;\
border-radius: 1px;\
box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);\
color: black;\
max-width: 100%;\
padding: 3px 4px;\
position: fixed;\
z-index: 999999;\
-moz-box-sizing: border-box;\
-webkit-box-sizing: border-box;\
box-sizing: border-box;\
cursor: default;\
white-space: pre;\
word-wrap: break-word;\
line-height: normal;\
font-style: normal;\
font-weight: normal;\
letter-spacing: normal;\
pointer-events: none;\
}\
.ace_folding-enabled > .ace_gutter-cell {\
padding-right: 13px;\
}\
.ace_fold-widget {\
-moz-box-sizing: border-box;\
-webkit-box-sizing: border-box;\
box-sizing: border-box;\
margin: 0 -12px 0 1px;\
display: none;\
width: 11px;\
vertical-align: top;\
background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42mWKsQ0AMAzC8ixLlrzQjzmBiEjp0A6WwBCSPgKAXoLkqSot7nN3yMwR7pZ32NzpKkVoDBUxKAAAAABJRU5ErkJggg==\");\
background-repeat: no-repeat;\
background-position: center;\
border-radius: 3px;\
border: 1px solid transparent;\
cursor: pointer;\
}\
.ace_folding-enabled .ace_fold-widget {\
display: inline-block;   \
}\
.ace_fold-widget.ace_end {\
background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42m3HwQkAMAhD0YzsRchFKI7sAikeWkrxwScEB0nh5e7KTPWimZki4tYfVbX+MNl4pyZXejUO1QAAAABJRU5ErkJggg==\");\
}\
.ace_fold-widget.ace_closed {\
background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAGCAYAAAAG5SQMAAAAOUlEQVR42jXKwQkAMAgDwKwqKD4EwQ26sSOkVWjgIIHAzPiCgaqiqnJHZnKICBERHN194O5b9vbLuAVRL+l0YWnZAAAAAElFTkSuQmCCXA==\");\
}\
.ace_fold-widget:hover {\
border: 1px solid rgba(0, 0, 0, 0.3);\
background-color: rgba(255, 255, 255, 0.2);\
box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);\
}\
.ace_fold-widget:active {\
border: 1px solid rgba(0, 0, 0, 0.4);\
background-color: rgba(0, 0, 0, 0.05);\
box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);\
}\
.ace_dark .ace_fold-widget {\
background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHklEQVQIW2P4//8/AzoGEQ7oGCaLLAhWiSwB146BAQCSTPYocqT0AAAAAElFTkSuQmCC\");\
}\
.ace_dark .ace_fold-widget.ace_end {\
background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAH0lEQVQIW2P4//8/AxQ7wNjIAjDMgC4AxjCVKBirIAAF0kz2rlhxpAAAAABJRU5ErkJggg==\");\
}\
.ace_dark .ace_fold-widget.ace_closed {\
background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAFCAYAAACAcVaiAAAAHElEQVQIW2P4//+/AxAzgDADlOOAznHAKgPWAwARji8UIDTfQQAAAABJRU5ErkJggg==\");\
}\
.ace_dark .ace_fold-widget:hover {\
box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);\
background-color: rgba(255, 255, 255, 0.1);\
}\
.ace_dark .ace_fold-widget:active {\
box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);\
}\
.ace_fold-widget.ace_invalid {\
background-color: #FFB4B4;\
border-color: #DE5555;\
}\
.ace_fade-fold-widgets .ace_fold-widget {\
-webkit-transition: opacity 0.4s ease 0.05s;\
transition: opacity 0.4s ease 0.05s;\
opacity: 0;\
}\
.ace_fade-fold-widgets:hover .ace_fold-widget {\
-webkit-transition: opacity 0.05s ease 0.05s;\
transition: opacity 0.05s ease 0.05s;\
opacity:1;\
}\
.ace_underline {\
text-decoration: underline;\
}\
.ace_bold {\
font-weight: bold;\
}\
.ace_nobold .ace_bold {\
font-weight: normal;\
}\
.ace_italic {\
font-style: italic;\
}\
.ace_error-marker {\
background-color: rgba(255, 0, 0,0.2);\
position: absolute;\
z-index: 9;\
}\
.ace_highlight-marker {\
background-color: rgba(255, 255, 0,0.2);\
position: absolute;\
z-index: 8;\
}\
.ace_br1 {border-top-left-radius    : 3px;}\
.ace_br2 {border-top-right-radius   : 3px;}\
.ace_br3 {border-top-left-radius    : 3px; border-top-right-radius:    3px;}\
.ace_br4 {border-bottom-right-radius: 3px;}\
.ace_br5 {border-top-left-radius    : 3px; border-bottom-right-radius: 3px;}\
.ace_br6 {border-top-right-radius   : 3px; border-bottom-right-radius: 3px;}\
.ace_br7 {border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px;}\
.ace_br8 {border-bottom-left-radius : 3px;}\
.ace_br9 {border-top-left-radius    : 3px; border-bottom-left-radius:  3px;}\
.ace_br10{border-top-right-radius   : 3px; border-bottom-left-radius:  3px;}\
.ace_br11{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-left-radius:  3px;}\
.ace_br12{border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}\
.ace_br13{border-top-left-radius    : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}\
.ace_br14{border-top-right-radius   : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}\
.ace_br15{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;}\
.ace_text-input-ios {\
position: absolute !important;\
top: -100000px !important;\
left: -100000px !important;\
}\
";

dom.importCssString(editorCss, "ace_editor.css");

var VirtualRenderer = function(container, theme) {
    var _self = this;

    this.container = container || dom.createElement("div");
    this.$keepTextAreaAtCursor = !useragent.isOldIE;

    dom.addCssClass(this.container, "ace_editor");

    this.setTheme(theme);

    this.$gutter = dom.createElement("div");
    this.$gutter.className = "ace_gutter";
    this.container.appendChild(this.$gutter);
    this.$gutter.setAttribute("aria-hidden", true);

    this.scroller = dom.createElement("div");
    this.scroller.className = "ace_scroller";
    this.container.appendChild(this.scroller);

    this.content = dom.createElement("div");
    this.content.className = "ace_content";
    this.scroller.appendChild(this.content);

    this.$gutterLayer = new GutterLayer(this.$gutter);
    this.$gutterLayer.on("changeGutterWidth", this.onGutterResize.bind(this));

    this.$markerBack = new MarkerLayer(this.content);

    var textLayer = this.$textLayer = new TextLayer(this.content);
    this.canvas = textLayer.element;

    this.$markerFront = new MarkerLayer(this.content);

    this.$cursorLayer = new CursorLayer(this.content);
    this.$horizScroll = false;
    this.$vScroll = false;

    this.scrollBar = 
    this.scrollBarV = new VScrollBar(this.container, this);
    this.scrollBarH = new HScrollBar(this.container, this);
    this.scrollBarV.addEventListener("scroll", function(e) {
        if (!_self.$scrollAnimation)
            _self.session.setScrollTop(e.data - _self.scrollMargin.top);
    });
    this.scrollBarH.addEventListener("scroll", function(e) {
        if (!_self.$scrollAnimation)
            _self.session.setScrollLeft(e.data - _self.scrollMargin.left);
    });

    this.scrollTop = 0;
    this.scrollLeft = 0;

    this.cursorPos = {
        row : 0,
        column : 0
    };

    this.$fontMetrics = new FontMetrics(this.container);
    this.$textLayer.$setFontMetrics(this.$fontMetrics);
    this.$textLayer.addEventListener("changeCharacterSize", function(e) {
        _self.updateCharacterSize();
        _self.onResize(true, _self.gutterWidth, _self.$size.width, _self.$size.height);
        _self._signal("changeCharacterSize", e);
    });

    this.$size = {
        width: 0,
        height: 0,
        scrollerHeight: 0,
        scrollerWidth: 0,
        $dirty: true
    };

    this.layerConfig = {
        width : 1,
        padding : 0,
        firstRow : 0,
        firstRowScreen: 0,
        lastRow : 0,
        lineHeight : 0,
        characterWidth : 0,
        minHeight : 1,
        maxHeight : 1,
        offset : 0,
        height : 1,
        gutterOffset: 1
    };
    
    this.scrollMargin = {
        left: 0,
        right: 0,
        top: 0,
        bottom: 0,
        v: 0,
        h: 0
    };

    this.$loop = new RenderLoop(
        this.$renderChanges.bind(this),
        this.container.ownerDocument.defaultView
    );
    this.$loop.schedule(this.CHANGE_FULL);

    this.updateCharacterSize();
    this.setPadding(4);
    config.resetOptions(this);
    config._emit("renderer", this);
};

(function() {

    this.CHANGE_CURSOR = 1;
    this.CHANGE_MARKER = 2;
    this.CHANGE_GUTTER = 4;
    this.CHANGE_SCROLL = 8;
    this.CHANGE_LINES = 16;
    this.CHANGE_TEXT = 32;
    this.CHANGE_SIZE = 64;
    this.CHANGE_MARKER_BACK = 128;
    this.CHANGE_MARKER_FRONT = 256;
    this.CHANGE_FULL = 512;
    this.CHANGE_H_SCROLL = 1024;

    oop.implement(this, EventEmitter);

    this.updateCharacterSize = function() {
        if (this.$textLayer.allowBoldFonts != this.$allowBoldFonts) {
            this.$allowBoldFonts = this.$textLayer.allowBoldFonts;
            this.setStyle("ace_nobold", !this.$allowBoldFonts);
        }

        this.layerConfig.characterWidth =
        this.characterWidth = this.$textLayer.getCharacterWidth();
        this.layerConfig.lineHeight =
        this.lineHeight = this.$textLayer.getLineHeight();
        this.$updatePrintMargin();
    };
    this.setSession = function(session) {
        if (this.session)
            this.session.doc.off("changeNewLineMode", this.onChangeNewLineMode);
            
        this.session = session;
        if (session && this.scrollMargin.top && session.getScrollTop() <= 0)
            session.setScrollTop(-this.scrollMargin.top);

        this.$cursorLayer.setSession(session);
        this.$markerBack.setSession(session);
        this.$markerFront.setSession(session);
        this.$gutterLayer.setSession(session);
        this.$textLayer.setSession(session);
        if (!session)
            return;
        
        this.$loop.schedule(this.CHANGE_FULL);
        this.session.$setFontMetrics(this.$fontMetrics);
        this.scrollBarH.scrollLeft = this.scrollBarV.scrollTop = null;
        
        this.onChangeNewLineMode = this.onChangeNewLineMode.bind(this);
        this.onChangeNewLineMode();
        this.session.doc.on("changeNewLineMode", this.onChangeNewLineMode);
    };
    this.updateLines = function(firstRow, lastRow, force) {
        if (lastRow === undefined)
            lastRow = Infinity;

        if (!this.$changedLines) {
            this.$changedLines = {
                firstRow: firstRow,
                lastRow: lastRow
            };
        }
        else {
            if (this.$changedLines.firstRow > firstRow)
                this.$changedLines.firstRow = firstRow;

            if (this.$changedLines.lastRow < lastRow)
                this.$changedLines.lastRow = lastRow;
        }
        if (this.$changedLines.lastRow < this.layerConfig.firstRow) {
            if (force)
                this.$changedLines.lastRow = this.layerConfig.lastRow;
            else
                return;
        }
        if (this.$changedLines.firstRow > this.layerConfig.lastRow)
            return;
        this.$loop.schedule(this.CHANGE_LINES);
    };

    this.onChangeNewLineMode = function() {
        this.$loop.schedule(this.CHANGE_TEXT);
        this.$textLayer.$updateEolChar();
        this.session.$bidiHandler.setEolChar(this.$textLayer.EOL_CHAR);
    };
    
    this.onChangeTabSize = function() {
        this.$loop.schedule(this.CHANGE_TEXT | this.CHANGE_MARKER);
        this.$textLayer.onChangeTabSize();
    };
    this.updateText = function() {
        this.$loop.schedule(this.CHANGE_TEXT);
    };
    this.updateFull = function(force) {
        if (force)
            this.$renderChanges(this.CHANGE_FULL, true);
        else
            this.$loop.schedule(this.CHANGE_FULL);
    };
    this.updateFontSize = function() {
        this.$textLayer.checkForSizeChanges();
    };

    this.$changes = 0;
    this.$updateSizeAsync = function() {
        if (this.$loop.pending)
            this.$size.$dirty = true;
        else
            this.onResize();
    };
    this.onResize = function(force, gutterWidth, width, height) {
        if (this.resizing > 2)
            return;
        else if (this.resizing > 0)
            this.resizing++;
        else
            this.resizing = force ? 1 : 0;
        var el = this.container;
        if (!height)
            height = el.clientHeight || el.scrollHeight;
        if (!width)
            width = el.clientWidth || el.scrollWidth;
        var changes = this.$updateCachedSize(force, gutterWidth, width, height);

        
        if (!this.$size.scrollerHeight || (!width && !height))
            return this.resizing = 0;

        if (force)
            this.$gutterLayer.$padding = null;

        if (force)
            this.$renderChanges(changes | this.$changes, true);
        else
            this.$loop.schedule(changes | this.$changes);

        if (this.resizing)
            this.resizing = 0;
        this.scrollBarV.scrollLeft = this.scrollBarV.scrollTop = null;
    };
    
    this.$updateCachedSize = function(force, gutterWidth, width, height) {
        height -= (this.$extraHeight || 0);
        var changes = 0;
        var size = this.$size;
        var oldSize = {
            width: size.width,
            height: size.height,
            scrollerHeight: size.scrollerHeight,
            scrollerWidth: size.scrollerWidth
        };
        if (height && (force || size.height != height)) {
            size.height = height;
            changes |= this.CHANGE_SIZE;

            size.scrollerHeight = size.height;
            if (this.$horizScroll)
                size.scrollerHeight -= this.scrollBarH.getHeight();
            this.scrollBarV.element.style.bottom = this.scrollBarH.getHeight() + "px";

            changes = changes | this.CHANGE_SCROLL;
        }

        if (width && (force || size.width != width)) {
            changes |= this.CHANGE_SIZE;
            size.width = width;
            
            if (gutterWidth == null)
                gutterWidth = this.$showGutter ? this.$gutter.offsetWidth : 0;
            
            this.gutterWidth = gutterWidth;
            
            this.scrollBarH.element.style.left = 
            this.scroller.style.left = gutterWidth + "px";
            size.scrollerWidth = Math.max(0, width - gutterWidth - this.scrollBarV.getWidth());           
            
            this.scrollBarH.element.style.right = 
            this.scroller.style.right = this.scrollBarV.getWidth() + "px";
            this.scroller.style.bottom = this.scrollBarH.getHeight() + "px";

            if (this.session && this.session.getUseWrapMode() && this.adjustWrapLimit() || force)
                changes |= this.CHANGE_FULL;
        }
        
        size.$dirty = !width || !height;

        if (changes)
            this._signal("resize", oldSize);

        return changes;
    };

    this.onGutterResize = function() {
        var gutterWidth = this.$showGutter ? this.$gutter.offsetWidth : 0;
        if (gutterWidth != this.gutterWidth)
            this.$changes |= this.$updateCachedSize(true, gutterWidth, this.$size.width, this.$size.height);

        if (this.session.getUseWrapMode() && this.adjustWrapLimit()) {
            this.$loop.schedule(this.CHANGE_FULL);
        } else if (this.$size.$dirty) {
            this.$loop.schedule(this.CHANGE_FULL);
        } else {
            this.$computeLayerConfig();
            this.$loop.schedule(this.CHANGE_MARKER);
        }
    };
    this.adjustWrapLimit = function() {
        var availableWidth = this.$size.scrollerWidth - this.$padding * 2;
        var limit = Math.floor(availableWidth / this.characterWidth);
        return this.session.adjustWrapLimit(limit, this.$showPrintMargin && this.$printMarginColumn);
    };
    this.setAnimatedScroll = function(shouldAnimate){
        this.setOption("animatedScroll", shouldAnimate);
    };
    this.getAnimatedScroll = function() {
        return this.$animatedScroll;
    };
    this.setShowInvisibles = function(showInvisibles) {
        this.setOption("showInvisibles", showInvisibles);
        this.session.$bidiHandler.setShowInvisibles(showInvisibles);
    };
    this.getShowInvisibles = function() {
        return this.getOption("showInvisibles");
    };
    this.getDisplayIndentGuides = function() {
        return this.getOption("displayIndentGuides");
    };

    this.setDisplayIndentGuides = function(display) {
        this.setOption("displayIndentGuides", display);
    };
    this.setShowPrintMargin = function(showPrintMargin) {
        this.setOption("showPrintMargin", showPrintMargin);
    };
    this.getShowPrintMargin = function() {
        return this.getOption("showPrintMargin");
    };
    this.setPrintMarginColumn = function(showPrintMargin) {
        this.setOption("printMarginColumn", showPrintMargin);
    };
    this.getPrintMarginColumn = function() {
        return this.getOption("printMarginColumn");
    };
    this.getShowGutter = function(){
        return this.getOption("showGutter");
    };
    this.setShowGutter = function(show){
        return this.setOption("showGutter", show);
    };

    this.getFadeFoldWidgets = function(){
        return this.getOption("fadeFoldWidgets");
    };

    this.setFadeFoldWidgets = function(show) {
        this.setOption("fadeFoldWidgets", show);
    };

    this.setHighlightGutterLine = function(shouldHighlight) {
        this.setOption("highlightGutterLine", shouldHighlight);
    };

    this.getHighlightGutterLine = function() {
        return this.getOption("highlightGutterLine");
    };

    this.$updateGutterLineHighlight = function() {
        var pos = this.$cursorLayer.$pixelPos;
        var height = this.layerConfig.lineHeight;
        if (this.session.getUseWrapMode()) {
            var cursor = this.session.selection.getCursor();
            cursor.column = 0;
            pos = this.$cursorLayer.getPixelPosition(cursor, true);
            height *= this.session.getRowLength(cursor.row);
        }
        this.$gutterLineHighlight.style.top = pos.top - this.layerConfig.offset + "px";
        this.$gutterLineHighlight.style.height = height + "px";
    };

    this.$updatePrintMargin = function() {
        if (!this.$showPrintMargin && !this.$printMarginEl)
            return;

        if (!this.$printMarginEl) {
            var containerEl = dom.createElement("div");
            containerEl.className = "ace_layer ace_print-margin-layer";
            this.$printMarginEl = dom.createElement("div");
            this.$printMarginEl.className = "ace_print-margin";
            containerEl.appendChild(this.$printMarginEl);
            this.content.insertBefore(containerEl, this.content.firstChild);
        }

        var style = this.$printMarginEl.style;
        style.left = ((this.characterWidth * this.$printMarginColumn) + this.$padding) + "px";
        style.visibility = this.$showPrintMargin ? "visible" : "hidden";
        
        if (this.session && this.session.$wrap == -1)
            this.adjustWrapLimit();
    };
    this.getContainerElement = function() {
        return this.container;
    };
    this.getMouseEventTarget = function() {
        return this.scroller;
    };
    this.getTextAreaContainer = function() {
        return this.container;
    };
    this.$moveTextAreaToCursor = function() {
        if (!this.$keepTextAreaAtCursor)
            return;
        var config = this.layerConfig;
        var posTop = this.$cursorLayer.$pixelPos.top;
        var posLeft = this.$cursorLayer.$pixelPos.left;
        posTop -= config.offset;

        var style = this.textarea.style;
        var h = this.lineHeight;
        if (posTop < 0 || posTop > config.height - h) {
            style.top = style.left = "0";
            return;
        }

        var w = this.characterWidth;
        if (this.$composition) {
            var val = this.textarea.value.replace(/^\x01+/, "");
            w *= (this.session.$getStringScreenWidth(val)[0]+2);
            h += 2;
        }
        posLeft -= this.scrollLeft;
        if (posLeft > this.$size.scrollerWidth - w)
            posLeft = this.$size.scrollerWidth - w;

        posLeft += this.gutterWidth;
        style.height = h + "px";
        style.width = w + "px";
        style.left = Math.min(posLeft, this.$size.scrollerWidth - w) + "px";
        style.top = Math.min(posTop, this.$size.height - h) + "px";
    };
    this.getFirstVisibleRow = function() {
        return this.layerConfig.firstRow;
    };
    this.getFirstFullyVisibleRow = function() {
        return this.layerConfig.firstRow + (this.layerConfig.offset === 0 ? 0 : 1);
    };
    this.getLastFullyVisibleRow = function() {
        var config = this.layerConfig;
        var lastRow = config.lastRow;
        var top = this.session.documentToScreenRow(lastRow, 0) * config.lineHeight;
        if (top - this.session.getScrollTop() > config.height - config.lineHeight)
            return lastRow - 1;
        return lastRow;
    };
    this.getLastVisibleRow = function() {
        return this.layerConfig.lastRow;
    };

    this.$padding = null;
    this.setPadding = function(padding) {
        this.$padding = padding;
        this.$textLayer.setPadding(padding);
        this.$cursorLayer.setPadding(padding);
        this.$markerFront.setPadding(padding);
        this.$markerBack.setPadding(padding);
        this.$loop.schedule(this.CHANGE_FULL);
        this.$updatePrintMargin();
    };
    
    this.setScrollMargin = function(top, bottom, left, right) {
        var sm = this.scrollMargin;
        sm.top = top|0;
        sm.bottom = bottom|0;
        sm.right = right|0;
        sm.left = left|0;
        sm.v = sm.top + sm.bottom;
        sm.h = sm.left + sm.right;
        if (sm.top && this.scrollTop <= 0 && this.session)
            this.session.setScrollTop(-sm.top);
        this.updateFull();
    };
    this.getHScrollBarAlwaysVisible = function() {
        return this.$hScrollBarAlwaysVisible;
    };
    this.setHScrollBarAlwaysVisible = function(alwaysVisible) {
        this.setOption("hScrollBarAlwaysVisible", alwaysVisible);
    };
    this.getVScrollBarAlwaysVisible = function() {
        return this.$vScrollBarAlwaysVisible;
    };
    this.setVScrollBarAlwaysVisible = function(alwaysVisible) {
        this.setOption("vScrollBarAlwaysVisible", alwaysVisible);
    };

    this.$updateScrollBarV = function() {
        var scrollHeight = this.layerConfig.maxHeight;
        var scrollerHeight = this.$size.scrollerHeight;
        if (!this.$maxLines && this.$scrollPastEnd) {
            scrollHeight -= (scrollerHeight - this.lineHeight) * this.$scrollPastEnd;
            if (this.scrollTop > scrollHeight - scrollerHeight) {
                scrollHeight = this.scrollTop + scrollerHeight;
                this.scrollBarV.scrollTop = null;
            }
        }
        this.scrollBarV.setScrollHeight(scrollHeight + this.scrollMargin.v);
        this.scrollBarV.setScrollTop(this.scrollTop + this.scrollMargin.top);
    };
    this.$updateScrollBarH = function() {
        this.scrollBarH.setScrollWidth(this.layerConfig.width + 2 * this.$padding + this.scrollMargin.h);
        this.scrollBarH.setScrollLeft(this.scrollLeft + this.scrollMargin.left);
    };
    
    this.$frozen = false;
    this.freeze = function() {
        this.$frozen = true;
    };
    
    this.unfreeze = function() {
        this.$frozen = false;
    };

    this.$renderChanges = function(changes, force) {
        if (this.$changes) {
            changes |= this.$changes;
            this.$changes = 0;
        }
        if ((!this.session || !this.container.offsetWidth || this.$frozen) || (!changes && !force)) {
            this.$changes |= changes;
            return; 
        } 
        if (this.$size.$dirty) {
            this.$changes |= changes;
            return this.onResize(true);
        }
        if (!this.lineHeight) {
            this.$textLayer.checkForSizeChanges();
        }
        
        this._signal("beforeRender");
        
        if (this.session && this.session.$bidiHandler)
            this.session.$bidiHandler.updateCharacterWidths(this.$fontMetrics);

        var config = this.layerConfig;
        if (changes & this.CHANGE_FULL ||
            changes & this.CHANGE_SIZE ||
            changes & this.CHANGE_TEXT ||
            changes & this.CHANGE_LINES ||
            changes & this.CHANGE_SCROLL ||
            changes & this.CHANGE_H_SCROLL
        ) {
            changes |= this.$computeLayerConfig();
            if (config.firstRow != this.layerConfig.firstRow && config.firstRowScreen == this.layerConfig.firstRowScreen) {
                var st = this.scrollTop + (config.firstRow - this.layerConfig.firstRow) * this.lineHeight;
                if (st > 0) {
                    this.scrollTop = st;
                    changes = changes | this.CHANGE_SCROLL;
                    changes |= this.$computeLayerConfig();
                }
            }
            config = this.layerConfig;
            this.$updateScrollBarV();
            if (changes & this.CHANGE_H_SCROLL)
                this.$updateScrollBarH();
            this.$gutterLayer.element.style.marginTop = (-config.offset) + "px";
            this.content.style.marginTop = (-config.offset) + "px";
            this.content.style.width = config.width + 2 * this.$padding + "px";
            this.content.style.height = config.minHeight + "px";
        }
        if (changes & this.CHANGE_H_SCROLL) {
            this.content.style.marginLeft = -this.scrollLeft + "px";
            this.scroller.className = this.scrollLeft <= 0 ? "ace_scroller" : "ace_scroller ace_scroll-left";
        }
        if (changes & this.CHANGE_FULL) {
            this.$textLayer.update(config);
            if (this.$showGutter)
                this.$gutterLayer.update(config);
            this.$markerBack.update(config);
            this.$markerFront.update(config);
            this.$cursorLayer.update(config);
            this.$moveTextAreaToCursor();
            this.$highlightGutterLine && this.$updateGutterLineHighlight();
            this._signal("afterRender");
            return;
        }
        if (changes & this.CHANGE_SCROLL) {
            if (changes & this.CHANGE_TEXT || changes & this.CHANGE_LINES)
                this.$textLayer.update(config);
            else
                this.$textLayer.scrollLines(config);

            if (this.$showGutter)
                this.$gutterLayer.update(config);
            this.$markerBack.update(config);
            this.$markerFront.update(config);
            this.$cursorLayer.update(config);
            this.$highlightGutterLine && this.$updateGutterLineHighlight();
            this.$moveTextAreaToCursor();
            this._signal("afterRender");
            return;
        }

        if (changes & this.CHANGE_TEXT) {
            this.$textLayer.update(config);
            if (this.$showGutter)
                this.$gutterLayer.update(config);
        }
        else if (changes & this.CHANGE_LINES) {
            if (this.$updateLines() || (changes & this.CHANGE_GUTTER) && this.$showGutter)
                this.$gutterLayer.update(config);
        }
        else if (changes & this.CHANGE_TEXT || changes & this.CHANGE_GUTTER) {
            if (this.$showGutter)
                this.$gutterLayer.update(config);
        }

        if (changes & this.CHANGE_CURSOR) {
            this.$cursorLayer.update(config);
            this.$moveTextAreaToCursor();
            this.$highlightGutterLine && this.$updateGutterLineHighlight();
        }

        if (changes & (this.CHANGE_MARKER | this.CHANGE_MARKER_FRONT)) {
            this.$markerFront.update(config);
        }

        if (changes & (this.CHANGE_MARKER | this.CHANGE_MARKER_BACK)) {
            this.$markerBack.update(config);
        }

        this._signal("afterRender");
    };

    
    this.$autosize = function() {
        var height = this.session.getScreenLength() * this.lineHeight;
        var maxHeight = this.$maxLines * this.lineHeight;
        var desiredHeight = Math.min(maxHeight, 
            Math.max((this.$minLines || 1) * this.lineHeight, height)
        ) + this.scrollMargin.v + (this.$extraHeight || 0);
        if (this.$horizScroll)
            desiredHeight += this.scrollBarH.getHeight();
        if (this.$maxPixelHeight && desiredHeight > this.$maxPixelHeight)
            desiredHeight = this.$maxPixelHeight;
        var vScroll = height > maxHeight;
        
        if (desiredHeight != this.desiredHeight ||
            this.$size.height != this.desiredHeight || vScroll != this.$vScroll) {
            if (vScroll != this.$vScroll) {
                this.$vScroll = vScroll;
                this.scrollBarV.setVisible(vScroll);
            }
            
            var w = this.container.clientWidth;
            this.container.style.height = desiredHeight + "px";
            this.$updateCachedSize(true, this.$gutterWidth, w, desiredHeight);
            this.desiredHeight = desiredHeight;
            
            this._signal("autosize");
        }
    };
    
    this.$computeLayerConfig = function() {
        var session = this.session;
        var size = this.$size;
        
        var hideScrollbars = size.height <= 2 * this.lineHeight;
        var screenLines = this.session.getScreenLength();
        var maxHeight = screenLines * this.lineHeight;

        var longestLine = this.$getLongestLine();
        
        var horizScroll = !hideScrollbars && (this.$hScrollBarAlwaysVisible ||
            size.scrollerWidth - longestLine - 2 * this.$padding < 0);

        var hScrollChanged = this.$horizScroll !== horizScroll;
        if (hScrollChanged) {
            this.$horizScroll = horizScroll;
            this.scrollBarH.setVisible(horizScroll);
        }
        var vScrollBefore = this.$vScroll; // autosize can change vscroll value in which case we need to update longestLine
        if (this.$maxLines && this.lineHeight > 1)
            this.$autosize();

        var offset = this.scrollTop % this.lineHeight;
        var minHeight = size.scrollerHeight + this.lineHeight;
        
        var scrollPastEnd = !this.$maxLines && this.$scrollPastEnd
            ? (size.scrollerHeight - this.lineHeight) * this.$scrollPastEnd
            : 0;
        maxHeight += scrollPastEnd;
        
        var sm = this.scrollMargin;
        this.session.setScrollTop(Math.max(-sm.top,
            Math.min(this.scrollTop, maxHeight - size.scrollerHeight + sm.bottom)));

        this.session.setScrollLeft(Math.max(-sm.left, Math.min(this.scrollLeft, 
            longestLine + 2 * this.$padding - size.scrollerWidth + sm.right)));
        
        var vScroll = !hideScrollbars && (this.$vScrollBarAlwaysVisible ||
            size.scrollerHeight - maxHeight + scrollPastEnd < 0 || this.scrollTop > sm.top);
        var vScrollChanged = vScrollBefore !== vScroll;
        if (vScrollChanged) {
            this.$vScroll = vScroll;
            this.scrollBarV.setVisible(vScroll);
        }

        var lineCount = Math.ceil(minHeight / this.lineHeight) - 1;
        var firstRow = Math.max(0, Math.round((this.scrollTop - offset) / this.lineHeight));
        var lastRow = firstRow + lineCount;
        var firstRowScreen, firstRowHeight;
        var lineHeight = this.lineHeight;
        firstRow = session.screenToDocumentRow(firstRow, 0);
        var foldLine = session.getFoldLine(firstRow);
        if (foldLine) {
            firstRow = foldLine.start.row;
        }

        firstRowScreen = session.documentToScreenRow(firstRow, 0);
        firstRowHeight = session.getRowLength(firstRow) * lineHeight;

        lastRow = Math.min(session.screenToDocumentRow(lastRow, 0), session.getLength() - 1);
        minHeight = size.scrollerHeight + session.getRowLength(lastRow) * lineHeight +
                                                firstRowHeight;

        offset = this.scrollTop - firstRowScreen * lineHeight;

        var changes = 0;
        if (this.layerConfig.width != longestLine) 
            changes = this.CHANGE_H_SCROLL;
        if (hScrollChanged || vScrollChanged) {
            changes = this.$updateCachedSize(true, this.gutterWidth, size.width, size.height);
            this._signal("scrollbarVisibilityChanged");
            if (vScrollChanged)
                longestLine = this.$getLongestLine();
        }
        
        this.layerConfig = {
            width : longestLine,
            padding : this.$padding,
            firstRow : firstRow,
            firstRowScreen: firstRowScreen,
            lastRow : lastRow,
            lineHeight : lineHeight,
            characterWidth : this.characterWidth,
            minHeight : minHeight,
            maxHeight : maxHeight,
            offset : offset,
            gutterOffset : lineHeight ? Math.max(0, Math.ceil((offset + size.height - size.scrollerHeight) / lineHeight)) : 0,
            height : this.$size.scrollerHeight
        };

        return changes;
    };

    this.$updateLines = function() {
        if (!this.$changedLines) return;
        var firstRow = this.$changedLines.firstRow;
        var lastRow = this.$changedLines.lastRow;
        this.$changedLines = null;

        var layerConfig = this.layerConfig;

        if (firstRow > layerConfig.lastRow + 1) { return; }
        if (lastRow < layerConfig.firstRow) { return; }
        if (lastRow === Infinity) {
            if (this.$showGutter)
                this.$gutterLayer.update(layerConfig);
            this.$textLayer.update(layerConfig);
            return;
        }
        this.$textLayer.updateLines(layerConfig, firstRow, lastRow);
        return true;
    };

    this.$getLongestLine = function() {
        var charCount = this.session.getScreenWidth();
        if (this.showInvisibles && !this.session.$useWrapMode)
            charCount += 1;

        return Math.max(this.$size.scrollerWidth - 2 * this.$padding, Math.round(charCount * this.characterWidth));
    };
    this.updateFrontMarkers = function() {
        this.$markerFront.setMarkers(this.session.getMarkers(true));
        this.$loop.schedule(this.CHANGE_MARKER_FRONT);
    };
    this.updateBackMarkers = function() {
        this.$markerBack.setMarkers(this.session.getMarkers());
        this.$loop.schedule(this.CHANGE_MARKER_BACK);
    };
    this.addGutterDecoration = function(row, className){
        this.$gutterLayer.addGutterDecoration(row, className);
    };
    this.removeGutterDecoration = function(row, className){
        this.$gutterLayer.removeGutterDecoration(row, className);
    };
    this.updateBreakpoints = function(rows) {
        this.$loop.schedule(this.CHANGE_GUTTER);
    };
    this.setAnnotations = function(annotations) {
        this.$gutterLayer.setAnnotations(annotations);
        this.$loop.schedule(this.CHANGE_GUTTER);
    };
    this.updateCursor = function() {
        this.$loop.schedule(this.CHANGE_CURSOR);
    };
    this.hideCursor = function() {
        this.$cursorLayer.hideCursor();
    };
    this.showCursor = function() {
        this.$cursorLayer.showCursor();
    };

    this.scrollSelectionIntoView = function(anchor, lead, offset) {
        this.scrollCursorIntoView(anchor, offset);
        this.scrollCursorIntoView(lead, offset);
    };
    this.scrollCursorIntoView = function(cursor, offset, $viewMargin) {
        if (this.$size.scrollerHeight === 0)
            return;

        var pos = this.$cursorLayer.getPixelPosition(cursor);

        var left = pos.left;
        var top = pos.top;
        
        var topMargin = $viewMargin && $viewMargin.top || 0;
        var bottomMargin = $viewMargin && $viewMargin.bottom || 0;
        
        var scrollTop = this.$scrollAnimation ? this.session.getScrollTop() : this.scrollTop;
        
        if (scrollTop + topMargin > top) {
            if (offset && scrollTop + topMargin > top + this.lineHeight)
                top -= offset * this.$size.scrollerHeight;
            if (top === 0)
                top = -this.scrollMargin.top;
            this.session.setScrollTop(top);
        } else if (scrollTop + this.$size.scrollerHeight - bottomMargin < top + this.lineHeight) {
            if (offset && scrollTop + this.$size.scrollerHeight - bottomMargin < top -  this.lineHeight)
                top += offset * this.$size.scrollerHeight;
            this.session.setScrollTop(top + this.lineHeight - this.$size.scrollerHeight);
        }

        var scrollLeft = this.scrollLeft;

        if (scrollLeft > left) {
            if (left < this.$padding + 2 * this.layerConfig.characterWidth)
                left = -this.scrollMargin.left;
            this.session.setScrollLeft(left);
        } else if (scrollLeft + this.$size.scrollerWidth < left + this.characterWidth) {
            this.session.setScrollLeft(Math.round(left + this.characterWidth - this.$size.scrollerWidth));
        } else if (scrollLeft <= this.$padding && left - scrollLeft < this.characterWidth) {
            this.session.setScrollLeft(0);
        }
    };
    this.getScrollTop = function() {
        return this.session.getScrollTop();
    };
    this.getScrollLeft = function() {
        return this.session.getScrollLeft();
    };
    this.getScrollTopRow = function() {
        return this.scrollTop / this.lineHeight;
    };
    this.getScrollBottomRow = function() {
        return Math.max(0, Math.floor((this.scrollTop + this.$size.scrollerHeight) / this.lineHeight) - 1);
    };
    this.scrollToRow = function(row) {
        this.session.setScrollTop(row * this.lineHeight);
    };

    this.alignCursor = function(cursor, alignment) {
        if (typeof cursor == "number")
            cursor = {row: cursor, column: 0};

        var pos = this.$cursorLayer.getPixelPosition(cursor);
        var h = this.$size.scrollerHeight - this.lineHeight;
        var offset = pos.top - h * (alignment || 0);

        this.session.setScrollTop(offset);
        return offset;
    };

    this.STEPS = 8;
    this.$calcSteps = function(fromValue, toValue){
        var i = 0;
        var l = this.STEPS;
        var steps = [];

        var func  = function(t, x_min, dx) {
            return dx * (Math.pow(t - 1, 3) + 1) + x_min;
        };

        for (i = 0; i < l; ++i)
            steps.push(func(i / this.STEPS, fromValue, toValue - fromValue));

        return steps;
    };
    this.scrollToLine = function(line, center, animate, callback) {
        var pos = this.$cursorLayer.getPixelPosition({row: line, column: 0});
        var offset = pos.top;
        if (center)
            offset -= this.$size.scrollerHeight / 2;

        var initialScroll = this.scrollTop;
        this.session.setScrollTop(offset);
        if (animate !== false)
            this.animateScrolling(initialScroll, callback);
    };

    this.animateScrolling = function(fromValue, callback) {
        var toValue = this.scrollTop;
        if (!this.$animatedScroll)
            return;
        var _self = this;
        
        if (fromValue == toValue)
            return;
        
        if (this.$scrollAnimation) {
            var oldSteps = this.$scrollAnimation.steps;
            if (oldSteps.length) {
                fromValue = oldSteps[0];
                if (fromValue == toValue)
                    return;
            }
        }
        
        var steps = _self.$calcSteps(fromValue, toValue);
        this.$scrollAnimation = {from: fromValue, to: toValue, steps: steps};

        clearInterval(this.$timer);

        _self.session.setScrollTop(steps.shift());
        _self.session.$scrollTop = toValue;
        this.$timer = setInterval(function() {
            if (steps.length) {
                _self.session.setScrollTop(steps.shift());
                _self.session.$scrollTop = toValue;
            } else if (toValue != null) {
                _self.session.$scrollTop = -1;
                _self.session.setScrollTop(toValue);
                toValue = null;
            } else {
                _self.$timer = clearInterval(_self.$timer);
                _self.$scrollAnimation = null;
                callback && callback();
            }
        }, 10);
    };
    this.scrollToY = function(scrollTop) {
        if (this.scrollTop !== scrollTop) {
            this.$loop.schedule(this.CHANGE_SCROLL);
            this.scrollTop = scrollTop;
        }
    };
    this.scrollToX = function(scrollLeft) {
        if (this.scrollLeft !== scrollLeft)
            this.scrollLeft = scrollLeft;
        this.$loop.schedule(this.CHANGE_H_SCROLL);
    };
    this.scrollTo = function(x, y) {
        this.session.setScrollTop(y);
        this.session.setScrollLeft(y);
    };
    this.scrollBy = function(deltaX, deltaY) {
        deltaY && this.session.setScrollTop(this.session.getScrollTop() + deltaY);
        deltaX && this.session.setScrollLeft(this.session.getScrollLeft() + deltaX);
    };
    this.isScrollableBy = function(deltaX, deltaY) {
        if (deltaY < 0 && this.session.getScrollTop() >= 1 - this.scrollMargin.top)
           return true;
        if (deltaY > 0 && this.session.getScrollTop() + this.$size.scrollerHeight
            - this.layerConfig.maxHeight < -1 + this.scrollMargin.bottom)
           return true;
        if (deltaX < 0 && this.session.getScrollLeft() >= 1 - this.scrollMargin.left)
            return true;
        if (deltaX > 0 && this.session.getScrollLeft() + this.$size.scrollerWidth
            - this.layerConfig.width < -1 + this.scrollMargin.right)
           return true;
    };

    this.pixelToScreenCoordinates = function(x, y) {
        var canvasPos = this.scroller.getBoundingClientRect();

        var offsetX = x + this.scrollLeft - canvasPos.left - this.$padding;
        var offset = offsetX / this.characterWidth;
        var row = Math.floor((y + this.scrollTop - canvasPos.top) / this.lineHeight);
        var col = Math.round(offset);

        return {row: row, column: col, side: offset - col > 0 ? 1 : -1, offsetX:  offsetX};
    };

    this.screenToTextCoordinates = function(x, y) {
        var canvasPos = this.scroller.getBoundingClientRect();
        var offsetX = x + this.scrollLeft - canvasPos.left - this.$padding;
        
        var col = Math.round(offsetX / this.characterWidth);

        var row = (y + this.scrollTop - canvasPos.top) / this.lineHeight;

        return this.session.screenToDocumentPosition(row, Math.max(col, 0), offsetX);
    };
    this.textToScreenCoordinates = function(row, column) {
        var canvasPos = this.scroller.getBoundingClientRect();
        var pos = this.session.documentToScreenPosition(row, column);

        var x = this.$padding + (this.session.$bidiHandler.isBidiRow(pos.row, row)
             ? this.session.$bidiHandler.getPosLeft(pos.column)
             : Math.round(pos.column * this.characterWidth));
        
        var y = pos.row * this.lineHeight;

        return {
            pageX: canvasPos.left + x - this.scrollLeft,
            pageY: canvasPos.top + y - this.scrollTop
        };
    };
    this.visualizeFocus = function() {
        dom.addCssClass(this.container, "ace_focus");
    };
    this.visualizeBlur = function() {
        dom.removeCssClass(this.container, "ace_focus");
    };
    this.showComposition = function(position) {
        if (!this.$composition)
            this.$composition = {
                keepTextAreaAtCursor: this.$keepTextAreaAtCursor,
                cssText: this.textarea.style.cssText
            };

        this.$keepTextAreaAtCursor = true;
        dom.addCssClass(this.textarea, "ace_composition");
        this.textarea.style.cssText = "";
        this.$moveTextAreaToCursor();
    };
    this.setCompositionText = function(text) {
        this.$moveTextAreaToCursor();
    };
    this.hideComposition = function() {
        if (!this.$composition)
            return;

        dom.removeCssClass(this.textarea, "ace_composition");
        this.$keepTextAreaAtCursor = this.$composition.keepTextAreaAtCursor;
        this.textarea.style.cssText = this.$composition.cssText;
        this.$composition = null;
    };
    this.setTheme = function(theme, cb) {
        var _self = this;
        this.$themeId = theme;
        _self._dispatchEvent('themeChange',{theme:theme});

        if (!theme || typeof theme == "string") {
            var moduleName = theme || this.$options.theme.initialValue;
            config.loadModule(["theme", moduleName], afterLoad);
        } else {
            afterLoad(theme);
        }

        function afterLoad(module) {
            if (_self.$themeId != theme)
                return cb && cb();
            if (!module || !module.cssClass)
                throw new Error("couldn't load module " + theme + " or it didn't call define");
            dom.importCssString(
                module.cssText,
                module.cssClass,
                _self.container.ownerDocument
            );

            if (_self.theme)
                dom.removeCssClass(_self.container, _self.theme.cssClass);

            var padding = "padding" in module ? module.padding 
                : "padding" in (_self.theme || {}) ? 4 : _self.$padding;
            if (_self.$padding && padding != _self.$padding)
                _self.setPadding(padding);
            _self.$theme = module.cssClass;

            _self.theme = module;
            dom.addCssClass(_self.container, module.cssClass);
            dom.setCssClass(_self.container, "ace_dark", module.isDark);
            if (_self.$size) {
                _self.$size.width = 0;
                _self.$updateSizeAsync();
            }

            _self._dispatchEvent('themeLoaded', {theme:module});
            cb && cb();
        }
    };
    this.getTheme = function() {
        return this.$themeId;
    };
    this.setStyle = function(style, include) {
        dom.setCssClass(this.container, style, include !== false);
    };
    this.unsetStyle = function(style) {
        dom.removeCssClass(this.container, style);
    };
    
    this.setCursorStyle = function(style) {
        if (this.scroller.style.cursor != style)
            this.scroller.style.cursor = style;
    };
    this.setMouseCursor = function(cursorStyle) {
        this.scroller.style.cursor = cursorStyle;
    };
    this.destroy = function() {
        this.$textLayer.destroy();
        this.$cursorLayer.destroy();
    };

}).call(VirtualRenderer.prototype);


config.defineOptions(VirtualRenderer.prototype, "renderer", {
    animatedScroll: {initialValue: false},
    showInvisibles: {
        set: function(value) {
            if (this.$textLayer.setShowInvisibles(value))
                this.$loop.schedule(this.CHANGE_TEXT);
        },
        initialValue: false
    },
    showPrintMargin: {
        set: function() { this.$updatePrintMargin(); },
        initialValue: true
    },
    printMarginColumn: {
        set: function() { this.$updatePrintMargin(); },
        initialValue: 80
    },
    printMargin: {
        set: function(val) {
            if (typeof val == "number")
                this.$printMarginColumn = val;
            this.$showPrintMargin = !!val;
            this.$updatePrintMargin();
        },
        get: function() {
            return this.$showPrintMargin && this.$printMarginColumn; 
        }
    },
    showGutter: {
        set: function(show){
            this.$gutter.style.display = show ? "block" : "none";
            this.$loop.schedule(this.CHANGE_FULL);
            this.onGutterResize();
        },
        initialValue: true
    },
    fadeFoldWidgets: {
        set: function(show) {
            dom.setCssClass(this.$gutter, "ace_fade-fold-widgets", show);
        },
        initialValue: false
    },
    showFoldWidgets: {
        set: function(show) {this.$gutterLayer.setShowFoldWidgets(show);},
        initialValue: true
    },
    showLineNumbers: {
        set: function(show) {
            this.$gutterLayer.setShowLineNumbers(show);
            this.$loop.schedule(this.CHANGE_GUTTER);
        },
        initialValue: true
    },
    displayIndentGuides: {
        set: function(show) {
            if (this.$textLayer.setDisplayIndentGuides(show))
                this.$loop.schedule(this.CHANGE_TEXT);
        },
        initialValue: true
    },
    highlightGutterLine: {
        set: function(shouldHighlight) {
            if (!this.$gutterLineHighlight) {
                this.$gutterLineHighlight = dom.createElement("div");
                this.$gutterLineHighlight.className = "ace_gutter-active-line";
                this.$gutter.appendChild(this.$gutterLineHighlight);
                return;
            }

            this.$gutterLineHighlight.style.display = shouldHighlight ? "" : "none";
            if (this.$cursorLayer.$pixelPos)
                this.$updateGutterLineHighlight();
        },
        initialValue: false,
        value: true
    },
    hScrollBarAlwaysVisible: {
        set: function(val) {
            if (!this.$hScrollBarAlwaysVisible || !this.$horizScroll)
                this.$loop.schedule(this.CHANGE_SCROLL);
        },
        initialValue: false
    },
    vScrollBarAlwaysVisible: {
        set: function(val) {
            if (!this.$vScrollBarAlwaysVisible || !this.$vScroll)
                this.$loop.schedule(this.CHANGE_SCROLL);
        },
        initialValue: false
    },
    fontSize:  {
        set: function(size) {
            if (typeof size == "number")
                size = size + "px";
            this.container.style.fontSize = size;
            this.updateFontSize();
        },
        initialValue: 12
    },
    fontFamily: {
        set: function(name) {
            this.container.style.fontFamily = name;
            this.updateFontSize();
        }
    },
    maxLines: {
        set: function(val) {
            this.updateFull();
        }
    },
    minLines: {
        set: function(val) {
            this.updateFull();
        }
    },
    maxPixelHeight: {
        set: function(val) {
            this.updateFull();
        },
        initialValue: 0
    },
    scrollPastEnd: {
        set: function(val) {
            val = +val || 0;
            if (this.$scrollPastEnd == val)
                return;
            this.$scrollPastEnd = val;
            this.$loop.schedule(this.CHANGE_SCROLL);
        },
        initialValue: 0,
        handlesSet: true
    },
    fixedWidthGutter: {
        set: function(val) {
            this.$gutterLayer.$fixedWidth = !!val;
            this.$loop.schedule(this.CHANGE_GUTTER);
        }
    },
    theme: {
        set: function(val) { this.setTheme(val); },
        get: function() { return this.$themeId || this.theme; },
        initialValue: "./theme/textmate",
        handlesSet: true
    }
});

exports.VirtualRenderer = VirtualRenderer;
});

ace.define("ace/worker/worker_client",["require","exports","module","ace/lib/oop","ace/lib/net","ace/lib/event_emitter","ace/config"], function(require, exports, module) {
"use strict";

var oop = require("../lib/oop");
var net = require("../lib/net");
var EventEmitter = require("../lib/event_emitter").EventEmitter;
var config = require("../config");

function $workerBlob(workerUrl) {
    var script = "importScripts('" + net.qualifyURL(workerUrl) + "');";
    try {
        return new Blob([script], {"type": "application/javascript"});
    } catch (e) { // Backwards-compatibility
        var BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;
        var blobBuilder = new BlobBuilder();
        blobBuilder.append(script);
        return blobBuilder.getBlob("application/javascript");
    }
}

function createWorker(workerUrl) {
    var blob = $workerBlob(workerUrl);
    var URL = window.URL || window.webkitURL;
    var blobURL = URL.createObjectURL(blob);
    return new Worker(blobURL);
}

var WorkerClient = function(topLevelNamespaces, mod, classname, workerUrl, importScripts) {
    this.$sendDeltaQueue = this.$sendDeltaQueue.bind(this);
    this.changeListener = this.changeListener.bind(this);
    this.onMessage = this.onMessage.bind(this);
    if (require.nameToUrl && !require.toUrl)
        require.toUrl = require.nameToUrl;
    
    if (config.get("packaged") || !require.toUrl) {
        workerUrl = workerUrl || config.moduleUrl(mod, "worker");
    } else {
        var normalizePath = this.$normalizePath;
        workerUrl = workerUrl || normalizePath(require.toUrl("ace/worker/worker.js", null, "_"));

        var tlns = {};
        topLevelNamespaces.forEach(function(ns) {
            tlns[ns] = normalizePath(require.toUrl(ns, null, "_").replace(/(\.js)?(\?.*)?$/, ""));
        });
    }

    this.$worker = createWorker(workerUrl);
    if (importScripts) {
        this.send("importScripts", importScripts);
    }
    this.$worker.postMessage({
        init : true,
        tlns : tlns,
        module : mod,
        classname : classname
    });

    this.callbackId = 1;
    this.callbacks = {};

    this.$worker.onmessage = this.onMessage;
};

(function(){

    oop.implement(this, EventEmitter);

    this.onMessage = function(e) {
        var msg = e.data;
        switch (msg.type) {
            case "event":
                this._signal(msg.name, {data: msg.data});
                break;
            case "call":
                var callback = this.callbacks[msg.id];
                if (callback) {
                    callback(msg.data);
                    delete this.callbacks[msg.id];
                }
                break;
            case "error":
                this.reportError(msg.data);
                break;
            case "log":
                window.console && console.log && console.log.apply(console, msg.data);
                break;
        }
    };
    
    this.reportError = function(err) {
        window.console && console.error && console.error(err);
    };

    this.$normalizePath = function(path) {
        return net.qualifyURL(path);
    };

    this.terminate = function() {
        this._signal("terminate", {});
        this.deltaQueue = null;
        this.$worker.terminate();
        this.$worker = null;
        if (this.$doc)
            this.$doc.off("change", this.changeListener);
        this.$doc = null;
    };

    this.send = function(cmd, args) {
        this.$worker.postMessage({command: cmd, args: args});
    };

    this.call = function(cmd, args, callback) {
        if (callback) {
            var id = this.callbackId++;
            this.callbacks[id] = callback;
            args.push(id);
        }
        this.send(cmd, args);
    };

    this.emit = function(event, data) {
        try {
            this.$worker.postMessage({event: event, data: {data: data.data}});
        }
        catch(ex) {
            console.error(ex.stack);
        }
    };

    this.attachToDocument = function(doc) {
        if (this.$doc)
            this.terminate();

        this.$doc = doc;
        this.call("setValue", [doc.getValue()]);
        doc.on("change", this.changeListener);
    };

    this.changeListener = function(delta) {
        if (!this.deltaQueue) {
            this.deltaQueue = [];
            setTimeout(this.$sendDeltaQueue, 0);
        }
        if (delta.action == "insert")
            this.deltaQueue.push(delta.start, delta.lines);
        else
            this.deltaQueue.push(delta.start, delta.end);
    };

    this.$sendDeltaQueue = function() {
        var q = this.deltaQueue;
        if (!q) return;
        this.deltaQueue = null;
        if (q.length > 50 && q.length > this.$doc.getLength() >> 1) {
            this.call("setValue", [this.$doc.getValue()]);
        } else
            this.emit("change", {data: q});
    };

}).call(WorkerClient.prototype);


var UIWorkerClient = function(topLevelNamespaces, mod, classname) {
    this.$sendDeltaQueue = this.$sendDeltaQueue.bind(this);
    this.changeListener = this.changeListener.bind(this);
    this.callbackId = 1;
    this.callbacks = {};
    this.messageBuffer = [];

    var main = null;
    var emitSync = false;
    var sender = Object.create(EventEmitter);
    var _self = this;

    this.$worker = {};
    this.$worker.terminate = function() {};
    this.$worker.postMessage = function(e) {
        _self.messageBuffer.push(e);
        if (main) {
            if (emitSync)
                setTimeout(processNext);
            else
                processNext();
        }
    };
    this.setEmitSync = function(val) { emitSync = val; };

    var processNext = function() {
        var msg = _self.messageBuffer.shift();
        if (msg.command)
            main[msg.command].apply(main, msg.args);
        else if (msg.event)
            sender._signal(msg.event, msg.data);
    };

    sender.postMessage = function(msg) {
        _self.onMessage({data: msg});
    };
    sender.callback = function(data, callbackId) {
        this.postMessage({type: "call", id: callbackId, data: data});
    };
    sender.emit = function(name, data) {
        this.postMessage({type: "event", name: name, data: data});
    };

    config.loadModule(["worker", mod], function(Main) {
        main = new Main[classname](sender);
        while (_self.messageBuffer.length)
            processNext();
    });
};

UIWorkerClient.prototype = WorkerClient.prototype;

exports.UIWorkerClient = UIWorkerClient;
exports.WorkerClient = WorkerClient;
exports.createWorker = createWorker;


});

ace.define("ace/placeholder",["require","exports","module","ace/range","ace/lib/event_emitter","ace/lib/oop"], function(require, exports, module) {
"use strict";

var Range = require("./range").Range;
var EventEmitter = require("./lib/event_emitter").EventEmitter;
var oop = require("./lib/oop");

var PlaceHolder = function(session, length, pos, others, mainClass, othersClass) {
    var _self = this;
    this.length = length;
    this.session = session;
    this.doc = session.getDocument();
    this.mainClass = mainClass;
    this.othersClass = othersClass;
    this.$onUpdate = this.onUpdate.bind(this);
    this.doc.on("change", this.$onUpdate);
    this.$others = others;
    
    this.$onCursorChange = function() {
        setTimeout(function() {
            _self.onCursorChange();
        });
    };
    
    this.$pos = pos;
    var undoStack = session.getUndoManager().$undoStack || session.getUndoManager().$undostack || {length: -1};
    this.$undoStackDepth = undoStack.length;
    this.setup();

    session.selection.on("changeCursor", this.$onCursorChange);
};

(function() {

    oop.implement(this, EventEmitter);
    this.setup = function() {
        var _self = this;
        var doc = this.doc;
        var session = this.session;
        
        this.selectionBefore = session.selection.toJSON();
        if (session.selection.inMultiSelectMode)
            session.selection.toSingleRange();

        this.pos = doc.createAnchor(this.$pos.row, this.$pos.column);
        var pos = this.pos;
        pos.$insertRight = true;
        pos.detach();
        pos.markerId = session.addMarker(new Range(pos.row, pos.column, pos.row, pos.column + this.length), this.mainClass, null, false);
        this.others = [];
        this.$others.forEach(function(other) {
            var anchor = doc.createAnchor(other.row, other.column);
            anchor.$insertRight = true;
            anchor.detach();
            _self.others.push(anchor);
        });
        session.setUndoSelect(false);
    };
    this.showOtherMarkers = function() {
        if (this.othersActive) return;
        var session = this.session;
        var _self = this;
        this.othersActive = true;
        this.others.forEach(function(anchor) {
            anchor.markerId = session.addMarker(new Range(anchor.row, anchor.column, anchor.row, anchor.column+_self.length), _self.othersClass, null, false);
        });
    };
    this.hideOtherMarkers = function() {
        if (!this.othersActive) return;
        this.othersActive = false;
        for (var i = 0; i < this.others.length; i++) {
            this.session.removeMarker(this.others[i].markerId);
        }
    };
    this.onUpdate = function(delta) {
        if (this.$updating)
            return this.updateAnchors(delta);
            
        var range = delta;
        if (range.start.row !== range.end.row) return;
        if (range.start.row !== this.pos.row) return;
        this.$updating = true;
        var lengthDiff = delta.action === "insert" ? range.end.column - range.start.column : range.start.column - range.end.column;
        var inMainRange = range.start.column >= this.pos.column && range.start.column <= this.pos.column + this.length + 1;
        var distanceFromStart = range.start.column - this.pos.column;
        
        this.updateAnchors(delta);
        
        if (inMainRange)
            this.length += lengthDiff;

        if (inMainRange && !this.session.$fromUndo) {
            if (delta.action === 'insert') {
                for (var i = this.others.length - 1; i >= 0; i--) {
                    var otherPos = this.others[i];
                    var newPos = {row: otherPos.row, column: otherPos.column + distanceFromStart};
                    this.doc.insertMergedLines(newPos, delta.lines);
                }
            } else if (delta.action === 'remove') {
                for (var i = this.others.length - 1; i >= 0; i--) {
                    var otherPos = this.others[i];
                    var newPos = {row: otherPos.row, column: otherPos.column + distanceFromStart};
                    this.doc.remove(new Range(newPos.row, newPos.column, newPos.row, newPos.column - lengthDiff));
                }
            }
        }
        
        this.$updating = false;
        this.updateMarkers();
    };
    
    this.updateAnchors = function(delta) {
        this.pos.onChange(delta);
        for (var i = this.others.length; i--;)
            this.others[i].onChange(delta);
        this.updateMarkers();
    };
    
    this.updateMarkers = function() {
        if (this.$updating)
            return;
        var _self = this;
        var session = this.session;
        var updateMarker = function(pos, className) {
            session.removeMarker(pos.markerId);
            pos.markerId = session.addMarker(new Range(pos.row, pos.column, pos.row, pos.column+_self.length), className, null, false);
        };
        updateMarker(this.pos, this.mainClass);
        for (var i = this.others.length; i--;)
            updateMarker(this.others[i], this.othersClass);
    };

    this.onCursorChange = function(event) {
        if (this.$updating || !this.session) return;
        var pos = this.session.selection.getCursor();
        if (pos.row === this.pos.row && pos.column >= this.pos.column && pos.column <= this.pos.column + this.length) {
            this.showOtherMarkers();
            this._emit("cursorEnter", event);
        } else {
            this.hideOtherMarkers();
            this._emit("cursorLeave", event);
        }
    };    
    this.detach = function() {
        this.session.removeMarker(this.pos && this.pos.markerId);
        this.hideOtherMarkers();
        this.doc.removeEventListener("change", this.$onUpdate);
        this.session.selection.removeEventListener("changeCursor", this.$onCursorChange);
        this.session.setUndoSelect(true);
        this.session = null;
    };
    this.cancel = function() {
        if (this.$undoStackDepth === -1)
            return;
        var undoManager = this.session.getUndoManager();
        var undosRequired = (undoManager.$undoStack || undoManager.$undostack).length - this.$undoStackDepth;
        for (var i = 0; i < undosRequired; i++) {
            undoManager.undo(true);
        }
        if (this.selectionBefore)
            this.session.selection.fromJSON(this.selectionBefore);
    };
}).call(PlaceHolder.prototype);


exports.PlaceHolder = PlaceHolder;
});

ace.define("ace/mouse/multi_select_handler",["require","exports","module","ace/lib/event","ace/lib/useragent"], function(require, exports, module) {

var event = require("../lib/event");
var useragent = require("../lib/useragent");
function isSamePoint(p1, p2) {
    return p1.row == p2.row && p1.column == p2.column;
}

function onMouseDown(e) {
    var ev = e.domEvent;
    var alt = ev.altKey;
    var shift = ev.shiftKey;
    var ctrl = ev.ctrlKey;
    var accel = e.getAccelKey();
    var button = e.getButton();
    
    if (ctrl && useragent.isMac)
        button = ev.button;

    if (e.editor.inMultiSelectMode && button == 2) {
        e.editor.textInput.onContextMenu(e.domEvent);
        return;
    }
    
    if (!ctrl && !alt && !accel) {
        if (button === 0 && e.editor.inMultiSelectMode)
            e.editor.exitMultiSelectMode();
        return;
    }
    
    if (button !== 0)
        return;

    var editor = e.editor;
    var selection = editor.selection;
    var isMultiSelect = editor.inMultiSelectMode;
    var pos = e.getDocumentPosition();
    var cursor = selection.getCursor();
    var inSelection = e.inSelection() || (selection.isEmpty() && isSamePoint(pos, cursor));

    var mouseX = e.x, mouseY = e.y;
    var onMouseSelection = function(e) {
        mouseX = e.clientX;
        mouseY = e.clientY;
    };
    
    var session = editor.session;
    var screenAnchor = editor.renderer.pixelToScreenCoordinates(mouseX, mouseY);
    var screenCursor = screenAnchor;
    
    var selectionMode;
    if (editor.$mouseHandler.$enableJumpToDef) {
        if (ctrl && alt || accel && alt)
            selectionMode = shift ? "block" : "add";
        else if (alt && editor.$blockSelectEnabled)
            selectionMode = "block";
    } else {
        if (accel && !alt) {
            selectionMode = "add";
            if (!isMultiSelect && shift)
                return;
        } else if (alt && editor.$blockSelectEnabled) {
            selectionMode = "block";
        }
    }
    
    if (selectionMode && useragent.isMac && ev.ctrlKey) {
        editor.$mouseHandler.cancelContextMenu();
    }

    if (selectionMode == "add") {
        if (!isMultiSelect && inSelection)
            return; // dragging

        if (!isMultiSelect) {
            var range = selection.toOrientedRange();
            editor.addSelectionMarker(range);
        }

        var oldRange = selection.rangeList.rangeAtPoint(pos);
        
        
        editor.$blockScrolling++;
        editor.inVirtualSelectionMode = true;
        
        if (shift) {
            oldRange = null;
            range = selection.ranges[0] || range;
            editor.removeSelectionMarker(range);
        }
        editor.once("mouseup", function() {
            var tmpSel = selection.toOrientedRange();

            if (oldRange && tmpSel.isEmpty() && isSamePoint(oldRange.cursor, tmpSel.cursor))
                selection.substractPoint(tmpSel.cursor);
            else {
                if (shift) {
                    selection.substractPoint(range.cursor);
                } else if (range) {
                    editor.removeSelectionMarker(range);
                    selection.addRange(range);
                }
                selection.addRange(tmpSel);
            }
            editor.$blockScrolling--;
            editor.inVirtualSelectionMode = false;
        });

    } else if (selectionMode == "block") {
        e.stop();
        editor.inVirtualSelectionMode = true;        
        var initialRange;
        var rectSel = [];
        var blockSelect = function() {
            var newCursor = editor.renderer.pixelToScreenCoordinates(mouseX, mouseY);
            var cursor = session.screenToDocumentPosition(newCursor.row, newCursor.column, newCursor.offsetX);

            if (isSamePoint(screenCursor, newCursor) && isSamePoint(cursor, selection.lead))
                return;
            screenCursor = newCursor;
            
            editor.$blockScrolling++;
            editor.selection.moveToPosition(cursor);
            editor.renderer.scrollCursorIntoView();

            editor.removeSelectionMarkers(rectSel);
            rectSel = selection.rectangularRangeBlock(screenCursor, screenAnchor);
            if (editor.$mouseHandler.$clickSelection && rectSel.length == 1 && rectSel[0].isEmpty())
                rectSel[0] = editor.$mouseHandler.$clickSelection.clone();
            rectSel.forEach(editor.addSelectionMarker, editor);
            editor.updateSelectionMarkers();
            editor.$blockScrolling--;
        };
        editor.$blockScrolling++;
        if (isMultiSelect && !accel) {
            selection.toSingleRange();
        } else if (!isMultiSelect && accel) {
            initialRange = selection.toOrientedRange();
            editor.addSelectionMarker(initialRange);
        }
        
        if (shift)
            screenAnchor = session.documentToScreenPosition(selection.lead);            
        else
            selection.moveToPosition(pos);
        editor.$blockScrolling--;
        
        screenCursor = {row: -1, column: -1};

        var onMouseSelectionEnd = function(e) {
            clearInterval(timerId);
            editor.removeSelectionMarkers(rectSel);
            if (!rectSel.length)
                rectSel = [selection.toOrientedRange()];
            editor.$blockScrolling++;
            if (initialRange) {
                editor.removeSelectionMarker(initialRange);
                selection.toSingleRange(initialRange);
            }
            for (var i = 0; i < rectSel.length; i++)
                selection.addRange(rectSel[i]);
            editor.inVirtualSelectionMode = false;
            editor.$mouseHandler.$clickSelection = null;
            editor.$blockScrolling--;
        };

        var onSelectionInterval = blockSelect;

        event.capture(editor.container, onMouseSelection, onMouseSelectionEnd);
        var timerId = setInterval(function() {onSelectionInterval();}, 20);

        return e.preventDefault();
    }
}


exports.onMouseDown = onMouseDown;

});

ace.define("ace/commands/multi_select_commands",["require","exports","module","ace/keyboard/hash_handler"], function(require, exports, module) {
exports.defaultCommands = [{
    name: "addCursorAbove",
    exec: function(editor) { editor.selectMoreLines(-1); },
    bindKey: {win: "Ctrl-Alt-Up", mac: "Ctrl-Alt-Up"},
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "addCursorBelow",
    exec: function(editor) { editor.selectMoreLines(1); },
    bindKey: {win: "Ctrl-Alt-Down", mac: "Ctrl-Alt-Down"},
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "addCursorAboveSkipCurrent",
    exec: function(editor) { editor.selectMoreLines(-1, true); },
    bindKey: {win: "Ctrl-Alt-Shift-Up", mac: "Ctrl-Alt-Shift-Up"},
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "addCursorBelowSkipCurrent",
    exec: function(editor) { editor.selectMoreLines(1, true); },
    bindKey: {win: "Ctrl-Alt-Shift-Down", mac: "Ctrl-Alt-Shift-Down"},
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "selectMoreBefore",
    exec: function(editor) { editor.selectMore(-1); },
    bindKey: {win: "Ctrl-Alt-Left", mac: "Ctrl-Alt-Left"},
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "selectMoreAfter",
    exec: function(editor) { editor.selectMore(1); },
    bindKey: {win: "Ctrl-Alt-Right", mac: "Ctrl-Alt-Right"},
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "selectNextBefore",
    exec: function(editor) { editor.selectMore(-1, true); },
    bindKey: {win: "Ctrl-Alt-Shift-Left", mac: "Ctrl-Alt-Shift-Left"},
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "selectNextAfter",
    exec: function(editor) { editor.selectMore(1, true); },
    bindKey: {win: "Ctrl-Alt-Shift-Right", mac: "Ctrl-Alt-Shift-Right"},
    scrollIntoView: "cursor",
    readOnly: true
}, {
    name: "splitIntoLines",
    exec: function(editor) { editor.multiSelect.splitIntoLines(); },
    bindKey: {win: "Ctrl-Alt-L", mac: "Ctrl-Alt-L"},
    readOnly: true
}, {
    name: "alignCursors",
    exec: function(editor) { editor.alignCursors(); },
    bindKey: {win: "Ctrl-Alt-A", mac: "Ctrl-Alt-A"},
    scrollIntoView: "cursor"
}, {
    name: "findAll",
    exec: function(editor) { editor.findAll(); },
    bindKey: {win: "Ctrl-Alt-K", mac: "Ctrl-Alt-G"},
    scrollIntoView: "cursor",
    readOnly: true
}];
exports.multiSelectCommands = [{
    name: "singleSelection",
    bindKey: "esc",
    exec: function(editor) { editor.exitMultiSelectMode(); },
    scrollIntoView: "cursor",
    readOnly: true,
    isAvailable: function(editor) {return editor && editor.inMultiSelectMode;}
}];

var HashHandler = require("../keyboard/hash_handler").HashHandler;
exports.keyboardHandler = new HashHandler(exports.multiSelectCommands);

});

ace.define("ace/multi_select",["require","exports","module","ace/range_list","ace/range","ace/selection","ace/mouse/multi_select_handler","ace/lib/event","ace/lib/lang","ace/commands/multi_select_commands","ace/search","ace/edit_session","ace/editor","ace/config"], function(require, exports, module) {

var RangeList = require("./range_list").RangeList;
var Range = require("./range").Range;
var Selection = require("./selection").Selection;
var onMouseDown = require("./mouse/multi_select_handler").onMouseDown;
var event = require("./lib/event");
var lang = require("./lib/lang");
var commands = require("./commands/multi_select_commands");
exports.commands = commands.defaultCommands.concat(commands.multiSelectCommands);
var Search = require("./search").Search;
var search = new Search();

function find(session, needle, dir) {
    search.$options.wrap = true;
    search.$options.needle = needle;
    search.$options.backwards = dir == -1;
    return search.find(session);
}
var EditSession = require("./edit_session").EditSession;
(function() {
    this.getSelectionMarkers = function() {
        return this.$selectionMarkers;
    };
}).call(EditSession.prototype);
(function() {
    this.ranges = null;
    this.rangeList = null;
    this.addRange = function(range, $blockChangeEvents) {
        if (!range)
            return;

        if (!this.inMultiSelectMode && this.rangeCount === 0) {
            var oldRange = this.toOrientedRange();
            this.rangeList.add(oldRange);
            this.rangeList.add(range);
            if (this.rangeList.ranges.length != 2) {
                this.rangeList.removeAll();
                return $blockChangeEvents || this.fromOrientedRange(range);
            }
            this.rangeList.removeAll();
            this.rangeList.add(oldRange);
            this.$onAddRange(oldRange);
        }

        if (!range.cursor)
            range.cursor = range.end;

        var removed = this.rangeList.add(range);

        this.$onAddRange(range);

        if (removed.length)
            this.$onRemoveRange(removed);

        if (this.rangeCount > 1 && !this.inMultiSelectMode) {
            this._signal("multiSelect");
            this.inMultiSelectMode = true;
            this.session.$undoSelect = false;
            this.rangeList.attach(this.session);
        }

        return $blockChangeEvents || this.fromOrientedRange(range);
    };

    this.toSingleRange = function(range) {
        range = range || this.ranges[0];
        var removed = this.rangeList.removeAll();
        if (removed.length)
            this.$onRemoveRange(removed);

        range && this.fromOrientedRange(range);
    };
    this.substractPoint = function(pos) {
        var removed = this.rangeList.substractPoint(pos);
        if (removed) {
            this.$onRemoveRange(removed);
            return removed[0];
        }
    };
    this.mergeOverlappingRanges = function() {
        var removed = this.rangeList.merge();
        if (removed.length)
            this.$onRemoveRange(removed);
        else if(this.ranges[0])
            this.fromOrientedRange(this.ranges[0]);
    };

    this.$onAddRange = function(range) {
        this.rangeCount = this.rangeList.ranges.length;
        this.ranges.unshift(range);
        this._signal("addRange", {range: range});
    };

    this.$onRemoveRange = function(removed) {
        this.rangeCount = this.rangeList.ranges.length;
        if (this.rangeCount == 1 && this.inMultiSelectMode) {
            var lastRange = this.rangeList.ranges.pop();
            removed.push(lastRange);
            this.rangeCount = 0;
        }

        for (var i = removed.length; i--; ) {
            var index = this.ranges.indexOf(removed[i]);
            this.ranges.splice(index, 1);
        }

        this._signal("removeRange", {ranges: removed});

        if (this.rangeCount === 0 && this.inMultiSelectMode) {
            this.inMultiSelectMode = false;
            this._signal("singleSelect");
            this.session.$undoSelect = true;
            this.rangeList.detach(this.session);
        }

        lastRange = lastRange || this.ranges[0];
        if (lastRange && !lastRange.isEqual(this.getRange()))
            this.fromOrientedRange(lastRange);
    };
    this.$initRangeList = function() {
        if (this.rangeList)
            return;

        this.rangeList = new RangeList();
        this.ranges = [];
        this.rangeCount = 0;
    };
    this.getAllRanges = function() {
        return this.rangeCount ? this.rangeList.ranges.concat() : [this.getRange()];
    };

    this.splitIntoLines = function () {
        if (this.rangeCount > 1) {
            var ranges = this.rangeList.ranges;
            var lastRange = ranges[ranges.length - 1];
            var range = Range.fromPoints(ranges[0].start, lastRange.end);

            this.toSingleRange();
            this.setSelectionRange(range, lastRange.cursor == lastRange.start);
        } else {
            var range = this.getRange();
            var isBackwards = this.isBackwards();
            var startRow = range.start.row;
            var endRow = range.end.row;
            if (startRow == endRow) {
                if (isBackwards)
                    var start = range.end, end = range.start;
                else
                    var start = range.start, end = range.end;
                
                this.addRange(Range.fromPoints(end, end));
                this.addRange(Range.fromPoints(start, start));
                return;
            }

            var rectSel = [];
            var r = this.getLineRange(startRow, true);
            r.start.column = range.start.column;
            rectSel.push(r);

            for (var i = startRow + 1; i < endRow; i++)
                rectSel.push(this.getLineRange(i, true));

            r = this.getLineRange(endRow, true);
            r.end.column = range.end.column;
            rectSel.push(r);

            rectSel.forEach(this.addRange, this);
        }
    };
    this.toggleBlockSelection = function () {
        if (this.rangeCount > 1) {
            var ranges = this.rangeList.ranges;
            var lastRange = ranges[ranges.length - 1];
            var range = Range.fromPoints(ranges[0].start, lastRange.end);

            this.toSingleRange();
            this.setSelectionRange(range, lastRange.cursor == lastRange.start);
        } else {
            var cursor = this.session.documentToScreenPosition(this.selectionLead);
            var anchor = this.session.documentToScreenPosition(this.selectionAnchor);

            var rectSel = this.rectangularRangeBlock(cursor, anchor);
            rectSel.forEach(this.addRange, this);
        }
    };
    this.rectangularRangeBlock = function(screenCursor, screenAnchor, includeEmptyLines) {
        var rectSel = [];

        var xBackwards = screenCursor.column < screenAnchor.column;
        if (xBackwards) {
            var startColumn = screenCursor.column;
            var endColumn = screenAnchor.column;
            var startOffsetX = screenCursor.offsetX;
            var endOffsetX = screenAnchor.offsetX;
        } else {
            var startColumn = screenAnchor.column;
            var endColumn = screenCursor.column;
            var startOffsetX = screenAnchor.offsetX;
            var endOffsetX = screenCursor.offsetX;
        }

        var yBackwards = screenCursor.row < screenAnchor.row;
        if (yBackwards) {
            var startRow = screenCursor.row;
            var endRow = screenAnchor.row;
        } else {
            var startRow = screenAnchor.row;
            var endRow = screenCursor.row;
        }

        if (startColumn < 0)
            startColumn = 0;
        if (startRow < 0)
            startRow = 0;

        if (startRow == endRow)
            includeEmptyLines = true;

        for (var row = startRow; row <= endRow; row++) {
            var range = Range.fromPoints(
                this.session.screenToDocumentPosition(row, startColumn, startOffsetX),
                this.session.screenToDocumentPosition(row, endColumn, endOffsetX)
            );
            if (range.isEmpty()) {
                if (docEnd && isSamePoint(range.end, docEnd))
                    break;
                var docEnd = range.end;
            }
            range.cursor = xBackwards ? range.start : range.end;
            rectSel.push(range);
        }

        if (yBackwards)
            rectSel.reverse();

        if (!includeEmptyLines) {
            var end = rectSel.length - 1;
            while (rectSel[end].isEmpty() && end > 0)
                end--;
            if (end > 0) {
                var start = 0;
                while (rectSel[start].isEmpty())
                    start++;
            }
            for (var i = end; i >= start; i--) {
                if (rectSel[i].isEmpty())
                    rectSel.splice(i, 1);
            }
        }

        return rectSel;
    };
}).call(Selection.prototype);
var Editor = require("./editor").Editor;
(function() {
    this.updateSelectionMarkers = function() {
        this.renderer.updateCursor();
        this.renderer.updateBackMarkers();
    };
    this.addSelectionMarker = function(orientedRange) {
        if (!orientedRange.cursor)
            orientedRange.cursor = orientedRange.end;

        var style = this.getSelectionStyle();
        orientedRange.marker = this.session.addMarker(orientedRange, "ace_selection", style);

        this.session.$selectionMarkers.push(orientedRange);
        this.session.selectionMarkerCount = this.session.$selectionMarkers.length;
        return orientedRange;
    };
    this.removeSelectionMarker = function(range) {
        if (!range.marker)
            return;
        this.session.removeMarker(range.marker);
        var index = this.session.$selectionMarkers.indexOf(range);
        if (index != -1)
            this.session.$selectionMarkers.splice(index, 1);
        this.session.selectionMarkerCount = this.session.$selectionMarkers.length;
    };

    this.removeSelectionMarkers = function(ranges) {
        var markerList = this.session.$selectionMarkers;
        for (var i = ranges.length; i--; ) {
            var range = ranges[i];
            if (!range.marker)
                continue;
            this.session.removeMarker(range.marker);
            var index = markerList.indexOf(range);
            if (index != -1)
                markerList.splice(index, 1);
        }
        this.session.selectionMarkerCount = markerList.length;
    };

    this.$onAddRange = function(e) {
        this.addSelectionMarker(e.range);
        this.renderer.updateCursor();
        this.renderer.updateBackMarkers();
    };

    this.$onRemoveRange = function(e) {
        this.removeSelectionMarkers(e.ranges);
        this.renderer.updateCursor();
        this.renderer.updateBackMarkers();
    };

    this.$onMultiSelect = function(e) {
        if (this.inMultiSelectMode)
            return;
        this.inMultiSelectMode = true;

        this.setStyle("ace_multiselect");
        this.keyBinding.addKeyboardHandler(commands.keyboardHandler);
        this.commands.setDefaultHandler("exec", this.$onMultiSelectExec);

        this.renderer.updateCursor();
        this.renderer.updateBackMarkers();
    };

    this.$onSingleSelect = function(e) {
        if (this.session.multiSelect.inVirtualMode)
            return;
        this.inMultiSelectMode = false;

        this.unsetStyle("ace_multiselect");
        this.keyBinding.removeKeyboardHandler(commands.keyboardHandler);

        this.commands.removeDefaultHandler("exec", this.$onMultiSelectExec);
        this.renderer.updateCursor();
        this.renderer.updateBackMarkers();
        this._emit("changeSelection");
    };

    this.$onMultiSelectExec = function(e) {
        var command = e.command;
        var editor = e.editor;
        if (!editor.multiSelect)
            return;
        if (!command.multiSelectAction) {
            var result = command.exec(editor, e.args || {});
            editor.multiSelect.addRange(editor.multiSelect.toOrientedRange());
            editor.multiSelect.mergeOverlappingRanges();
        } else if (command.multiSelectAction == "forEach") {
            result = editor.forEachSelection(command, e.args);
        } else if (command.multiSelectAction == "forEachLine") {
            result = editor.forEachSelection(command, e.args, true);
        } else if (command.multiSelectAction == "single") {
            editor.exitMultiSelectMode();
            result = command.exec(editor, e.args || {});
        } else {
            result = command.multiSelectAction(editor, e.args || {});
        }
        return result;
    }; 
    this.forEachSelection = function(cmd, args, options) {
        if (this.inVirtualSelectionMode)
            return;
        var keepOrder = options && options.keepOrder;
        var $byLines = options == true || options && options.$byLines;
        var session = this.session;
        var selection = this.selection;
        var rangeList = selection.rangeList;
        var ranges = (keepOrder ? selection : rangeList).ranges;
        var result;
        
        if (!ranges.length)
            return cmd.exec ? cmd.exec(this, args || {}) : cmd(this, args || {});
        
        var reg = selection._eventRegistry;
        selection._eventRegistry = {};

        var tmpSel = new Selection(session);
        this.inVirtualSelectionMode = true;
        for (var i = ranges.length; i--;) {
            if ($byLines) {
                while (i > 0 && ranges[i].start.row == ranges[i - 1].end.row)
                    i--;
            }
            tmpSel.fromOrientedRange(ranges[i]);
            tmpSel.index = i;
            this.selection = session.selection = tmpSel;
            var cmdResult = cmd.exec ? cmd.exec(this, args || {}) : cmd(this, args || {});
            if (!result && cmdResult !== undefined)
                result = cmdResult;
            tmpSel.toOrientedRange(ranges[i]);
        }
        tmpSel.detach();

        this.selection = session.selection = selection;
        this.inVirtualSelectionMode = false;
        selection._eventRegistry = reg;
        selection.mergeOverlappingRanges();
        
        var anim = this.renderer.$scrollAnimation;
        this.onCursorChange();
        this.onSelectionChange();
        if (anim && anim.from == anim.to)
            this.renderer.animateScrolling(anim.from);
        
        return result;
    };
    this.exitMultiSelectMode = function() {
        if (!this.inMultiSelectMode || this.inVirtualSelectionMode)
            return;
        this.multiSelect.toSingleRange();
    };

    this.getSelectedText = function() {
        var text = "";
        if (this.inMultiSelectMode && !this.inVirtualSelectionMode) {
            var ranges = this.multiSelect.rangeList.ranges;
            var buf = [];
            for (var i = 0; i < ranges.length; i++) {
                buf.push(this.session.getTextRange(ranges[i]));
            }
            var nl = this.session.getDocument().getNewLineCharacter();
            text = buf.join(nl);
            if (text.length == (buf.length - 1) * nl.length)
                text = "";
        } else if (!this.selection.isEmpty()) {
            text = this.session.getTextRange(this.getSelectionRange());
        }
        return text;
    };
    
    this.$checkMultiselectChange = function(e, anchor) {
        if (this.inMultiSelectMode && !this.inVirtualSelectionMode) {
            var range = this.multiSelect.ranges[0];
            if (this.multiSelect.isEmpty() && anchor == this.multiSelect.anchor)
                return;
            var pos = anchor == this.multiSelect.anchor
                ? range.cursor == range.start ? range.end : range.start
                : range.cursor;
            if (pos.row != anchor.row 
                || this.session.$clipPositionToDocument(pos.row, pos.column).column != anchor.column)
                this.multiSelect.toSingleRange(this.multiSelect.toOrientedRange());
        }
    };
    this.findAll = function(needle, options, additive) {
        options = options || {};
        options.needle = needle || options.needle;
        if (options.needle == undefined) {
            var range = this.selection.isEmpty()
                ? this.selection.getWordRange()
                : this.selection.getRange();
            options.needle = this.session.getTextRange(range);
        }    
        this.$search.set(options);
        
        var ranges = this.$search.findAll(this.session);
        if (!ranges.length)
            return 0;

        this.$blockScrolling += 1;
        var selection = this.multiSelect;

        if (!additive)
            selection.toSingleRange(ranges[0]);

        for (var i = ranges.length; i--; )
            selection.addRange(ranges[i], true);
        if (range && selection.rangeList.rangeAtPoint(range.start))
            selection.addRange(range, true);
        
        this.$blockScrolling -= 1;

        return ranges.length;
    };
    this.selectMoreLines = function(dir, skip) {
        var range = this.selection.toOrientedRange();
        var isBackwards = range.cursor == range.end;

        var screenLead = this.session.documentToScreenPosition(range.cursor);
        if (this.selection.$desiredColumn)
            screenLead.column = this.selection.$desiredColumn;

        var lead = this.session.screenToDocumentPosition(screenLead.row + dir, screenLead.column);

        if (!range.isEmpty()) {
            var screenAnchor = this.session.documentToScreenPosition(isBackwards ? range.end : range.start);
            var anchor = this.session.screenToDocumentPosition(screenAnchor.row + dir, screenAnchor.column);
        } else {
            var anchor = lead;
        }

        if (isBackwards) {
            var newRange = Range.fromPoints(lead, anchor);
            newRange.cursor = newRange.start;
        } else {
            var newRange = Range.fromPoints(anchor, lead);
            newRange.cursor = newRange.end;
        }

        newRange.desiredColumn = screenLead.column;
        if (!this.selection.inMultiSelectMode) {
            this.selection.addRange(range);
        } else {
            if (skip)
                var toRemove = range.cursor;
        }

        this.selection.addRange(newRange);
        if (toRemove)
            this.selection.substractPoint(toRemove);
    };
    this.transposeSelections = function(dir) {
        var session = this.session;
        var sel = session.multiSelect;
        var all = sel.ranges;

        for (var i = all.length; i--; ) {
            var range = all[i];
            if (range.isEmpty()) {
                var tmp = session.getWordRange(range.start.row, range.start.column);
                range.start.row = tmp.start.row;
                range.start.column = tmp.start.column;
                range.end.row = tmp.end.row;
                range.end.column = tmp.end.column;
            }
        }
        sel.mergeOverlappingRanges();

        var words = [];
        for (var i = all.length; i--; ) {
            var range = all[i];
            words.unshift(session.getTextRange(range));
        }

        if (dir < 0)
            words.unshift(words.pop());
        else
            words.push(words.shift());

        for (var i = all.length; i--; ) {
            var range = all[i];
            var tmp = range.clone();
            session.replace(range, words[i]);
            range.start.row = tmp.start.row;
            range.start.column = tmp.start.column;
        }
    };
    this.selectMore = function(dir, skip, stopAtFirst) {
        var session = this.session;
        var sel = session.multiSelect;

        var range = sel.toOrientedRange();
        if (range.isEmpty()) {
            range = session.getWordRange(range.start.row, range.start.column);
            range.cursor = dir == -1 ? range.start : range.end;
            this.multiSelect.addRange(range);
            if (stopAtFirst)
                return;
        }
        var needle = session.getTextRange(range);

        var newRange = find(session, needle, dir);
        if (newRange) {
            newRange.cursor = dir == -1 ? newRange.start : newRange.end;
            this.$blockScrolling += 1;
            this.session.unfold(newRange);
            this.multiSelect.addRange(newRange);
            this.$blockScrolling -= 1;
            this.renderer.scrollCursorIntoView(null, 0.5);
        }
        if (skip)
            this.multiSelect.substractPoint(range.cursor);
    };
    this.alignCursors = function() {
        var session = this.session;
        var sel = session.multiSelect;
        var ranges = sel.ranges;
        var row = -1;
        var sameRowRanges = ranges.filter(function(r) {
            if (r.cursor.row == row)
                return true;
            row = r.cursor.row;
        });
        
        if (!ranges.length || sameRowRanges.length == ranges.length - 1) {
            var range = this.selection.getRange();
            var fr = range.start.row, lr = range.end.row;
            var guessRange = fr == lr;
            if (guessRange) {
                var max = this.session.getLength();
                var line;
                do {
                    line = this.session.getLine(lr);
                } while (/[=:]/.test(line) && ++lr < max);
                do {
                    line = this.session.getLine(fr);
                } while (/[=:]/.test(line) && --fr > 0);
                
                if (fr < 0) fr = 0;
                if (lr >= max) lr = max - 1;
            }
            var lines = this.session.removeFullLines(fr, lr);
            lines = this.$reAlignText(lines, guessRange);
            this.session.insert({row: fr, column: 0}, lines.join("\n") + "\n");
            if (!guessRange) {
                range.start.column = 0;
                range.end.column = lines[lines.length - 1].length;
            }
            this.selection.setRange(range);
        } else {
            sameRowRanges.forEach(function(r) {
                sel.substractPoint(r.cursor);
            });

            var maxCol = 0;
            var minSpace = Infinity;
            var spaceOffsets = ranges.map(function(r) {
                var p = r.cursor;
                var line = session.getLine(p.row);
                var spaceOffset = line.substr(p.column).search(/\S/g);
                if (spaceOffset == -1)
                    spaceOffset = 0;

                if (p.column > maxCol)
                    maxCol = p.column;
                if (spaceOffset < minSpace)
                    minSpace = spaceOffset;
                return spaceOffset;
            });
            ranges.forEach(function(r, i) {
                var p = r.cursor;
                var l = maxCol - p.column;
                var d = spaceOffsets[i] - minSpace;
                if (l > d)
                    session.insert(p, lang.stringRepeat(" ", l - d));
                else
                    session.remove(new Range(p.row, p.column, p.row, p.column - l + d));

                r.start.column = r.end.column = maxCol;
                r.start.row = r.end.row = p.row;
                r.cursor = r.end;
            });
            sel.fromOrientedRange(ranges[0]);
            this.renderer.updateCursor();
            this.renderer.updateBackMarkers();
        }
    };

    this.$reAlignText = function(lines, forceLeft) {
        var isLeftAligned = true, isRightAligned = true;
        var startW, textW, endW;

        return lines.map(function(line) {
            var m = line.match(/(\s*)(.*?)(\s*)([=:].*)/);
            if (!m)
                return [line];

            if (startW == null) {
                startW = m[1].length;
                textW = m[2].length;
                endW = m[3].length;
                return m;
            }

            if (startW + textW + endW != m[1].length + m[2].length + m[3].length)
                isRightAligned = false;
            if (startW != m[1].length)
                isLeftAligned = false;

            if (startW > m[1].length)
                startW = m[1].length;
            if (textW < m[2].length)
                textW = m[2].length;
            if (endW > m[3].length)
                endW = m[3].length;

            return m;
        }).map(forceLeft ? alignLeft :
            isLeftAligned ? isRightAligned ? alignRight : alignLeft : unAlign);

        function spaces(n) {
            return lang.stringRepeat(" ", n);
        }

        function alignLeft(m) {
            return !m[2] ? m[0] : spaces(startW) + m[2]
                + spaces(textW - m[2].length + endW)
                + m[4].replace(/^([=:])\s+/, "$1 ");
        }
        function alignRight(m) {
            return !m[2] ? m[0] : spaces(startW + textW - m[2].length) + m[2]
                + spaces(endW, " ")
                + m[4].replace(/^([=:])\s+/, "$1 ");
        }
        function unAlign(m) {
            return !m[2] ? m[0] : spaces(startW) + m[2]
                + spaces(endW)
                + m[4].replace(/^([=:])\s+/, "$1 ");
        }
    };
}).call(Editor.prototype);


function isSamePoint(p1, p2) {
    return p1.row == p2.row && p1.column == p2.column;
}
exports.onSessionChange = function(e) {
    var session = e.session;
    if (session && !session.multiSelect) {
        session.$selectionMarkers = [];
        session.selection.$initRangeList();
        session.multiSelect = session.selection;
    }
    this.multiSelect = session && session.multiSelect;

    var oldSession = e.oldSession;
    if (oldSession) {
        oldSession.multiSelect.off("addRange", this.$onAddRange);
        oldSession.multiSelect.off("removeRange", this.$onRemoveRange);
        oldSession.multiSelect.off("multiSelect", this.$onMultiSelect);
        oldSession.multiSelect.off("singleSelect", this.$onSingleSelect);
        oldSession.multiSelect.lead.off("change", this.$checkMultiselectChange);
        oldSession.multiSelect.anchor.off("change", this.$checkMultiselectChange);
    }

    if (session) {
        session.multiSelect.on("addRange", this.$onAddRange);
        session.multiSelect.on("removeRange", this.$onRemoveRange);
        session.multiSelect.on("multiSelect", this.$onMultiSelect);
        session.multiSelect.on("singleSelect", this.$onSingleSelect);
        session.multiSelect.lead.on("change", this.$checkMultiselectChange);
        session.multiSelect.anchor.on("change", this.$checkMultiselectChange);
    }

    if (session && this.inMultiSelectMode != session.selection.inMultiSelectMode) {
        if (session.selection.inMultiSelectMode)
            this.$onMultiSelect();
        else
            this.$onSingleSelect();
    }
};
function MultiSelect(editor) {
    if (editor.$multiselectOnSessionChange)
        return;
    editor.$onAddRange = editor.$onAddRange.bind(editor);
    editor.$onRemoveRange = editor.$onRemoveRange.bind(editor);
    editor.$onMultiSelect = editor.$onMultiSelect.bind(editor);
    editor.$onSingleSelect = editor.$onSingleSelect.bind(editor);
    editor.$multiselectOnSessionChange = exports.onSessionChange.bind(editor);
    editor.$checkMultiselectChange = editor.$checkMultiselectChange.bind(editor);

    editor.$multiselectOnSessionChange(editor);
    editor.on("changeSession", editor.$multiselectOnSessionChange);

    editor.on("mousedown", onMouseDown);
    editor.commands.addCommands(commands.defaultCommands);

    addAltCursorListeners(editor);
}

function addAltCursorListeners(editor){
    var el = editor.textInput.getElement();
    var altCursor = false;
    event.addListener(el, "keydown", function(e) {
        var altDown = e.keyCode == 18 && !(e.ctrlKey || e.shiftKey || e.metaKey);
        if (editor.$blockSelectEnabled && altDown) {
            if (!altCursor) {
                editor.renderer.setMouseCursor("crosshair");
                altCursor = true;
            }
        } else if (altCursor) {
            reset();
        }
    });

    event.addListener(el, "keyup", reset);
    event.addListener(el, "blur", reset);
    function reset(e) {
        if (altCursor) {
            editor.renderer.setMouseCursor("");
            altCursor = false;
        }
    }
}

exports.MultiSelect = MultiSelect;


require("./config").defineOptions(Editor.prototype, "editor", {
    enableMultiselect: {
        set: function(val) {
            MultiSelect(this);
            if (val) {
                this.on("changeSession", this.$multiselectOnSessionChange);
                this.on("mousedown", onMouseDown);
            } else {
                this.off("changeSession", this.$multiselectOnSessionChange);
                this.off("mousedown", onMouseDown);
            }
        },
        value: true
    },
    enableBlockSelect: {
        set: function(val) {
            this.$blockSelectEnabled = val;
        },
        value: true
    }
});



});

ace.define("ace/mode/folding/fold_mode",["require","exports","module","ace/range"], function(require, exports, module) {
"use strict";

var Range = require("../../range").Range;

var FoldMode = exports.FoldMode = function() {};

(function() {

    this.foldingStartMarker = null;
    this.foldingStopMarker = null;
    this.getFoldWidget = function(session, foldStyle, row) {
        var line = session.getLine(row);
        if (this.foldingStartMarker.test(line))
            return "start";
        if (foldStyle == "markbeginend"
                && this.foldingStopMarker
                && this.foldingStopMarker.test(line))
            return "end";
        return "";
    };

    this.getFoldWidgetRange = function(session, foldStyle, row) {
        return null;
    };

    this.indentationBlock = function(session, row, column) {
        var re = /\S/;
        var line = session.getLine(row);
        var startLevel = line.search(re);
        if (startLevel == -1)
            return;

        var startColumn = column || line.length;
        var maxRow = session.getLength();
        var startRow = row;
        var endRow = row;

        while (++row < maxRow) {
            var level = session.getLine(row).search(re);

            if (level == -1)
                continue;

            if (level <= startLevel)
                break;

            endRow = row;
        }

        if (endRow > startRow) {
            var endColumn = session.getLine(endRow).length;
            return new Range(startRow, startColumn, endRow, endColumn);
        }
    };

    this.openingBracketBlock = function(session, bracket, row, column, typeRe) {
        var start = {row: row, column: column + 1};
        var end = session.$findClosingBracket(bracket, start, typeRe);
        if (!end)
            return;

        var fw = session.foldWidgets[end.row];
        if (fw == null)
            fw = session.getFoldWidget(end.row);

        if (fw == "start" && end.row > start.row) {
            end.row --;
            end.column = session.getLine(end.row).length;
        }
        return Range.fromPoints(start, end);
    };

    this.closingBracketBlock = function(session, bracket, row, column, typeRe) {
        var end = {row: row, column: column};
        var start = session.$findOpeningBracket(bracket, end);

        if (!start)
            return;

        start.column++;
        end.column--;

        return  Range.fromPoints(start, end);
    };
}).call(FoldMode.prototype);

});

ace.define("ace/theme/textmate",["require","exports","module","ace/lib/dom"], function(require, exports, module) {
"use strict";

exports.isDark = false;
exports.cssClass = "ace-tm";
exports.cssText = ".ace-tm .ace_gutter {\
background: #f0f0f0;\
color: #333;\
}\
.ace-tm .ace_print-margin {\
width: 1px;\
background: #e8e8e8;\
}\
.ace-tm .ace_fold {\
background-color: #6B72E6;\
}\
.ace-tm {\
background-color: #FFFFFF;\
color: black;\
}\
.ace-tm .ace_cursor {\
color: black;\
}\
.ace-tm .ace_invisible {\
color: rgb(191, 191, 191);\
}\
.ace-tm .ace_storage,\
.ace-tm .ace_keyword {\
color: blue;\
}\
.ace-tm .ace_constant {\
color: rgb(197, 6, 11);\
}\
.ace-tm .ace_constant.ace_buildin {\
color: rgb(88, 72, 246);\
}\
.ace-tm .ace_constant.ace_language {\
color: rgb(88, 92, 246);\
}\
.ace-tm .ace_constant.ace_library {\
color: rgb(6, 150, 14);\
}\
.ace-tm .ace_invalid {\
background-color: rgba(255, 0, 0, 0.1);\
color: red;\
}\
.ace-tm .ace_support.ace_function {\
color: rgb(60, 76, 114);\
}\
.ace-tm .ace_support.ace_constant {\
color: rgb(6, 150, 14);\
}\
.ace-tm .ace_support.ace_type,\
.ace-tm .ace_support.ace_class {\
color: rgb(109, 121, 222);\
}\
.ace-tm .ace_keyword.ace_operator {\
color: rgb(104, 118, 135);\
}\
.ace-tm .ace_string {\
color: rgb(3, 106, 7);\
}\
.ace-tm .ace_comment {\
color: rgb(76, 136, 107);\
}\
.ace-tm .ace_comment.ace_doc {\
color: rgb(0, 102, 255);\
}\
.ace-tm .ace_comment.ace_doc.ace_tag {\
color: rgb(128, 159, 191);\
}\
.ace-tm .ace_constant.ace_numeric {\
color: rgb(0, 0, 205);\
}\
.ace-tm .ace_variable {\
color: rgb(49, 132, 149);\
}\
.ace-tm .ace_xml-pe {\
color: rgb(104, 104, 91);\
}\
.ace-tm .ace_entity.ace_name.ace_function {\
color: #0000A2;\
}\
.ace-tm .ace_heading {\
color: rgb(12, 7, 255);\
}\
.ace-tm .ace_list {\
color:rgb(185, 6, 144);\
}\
.ace-tm .ace_meta.ace_tag {\
color:rgb(0, 22, 142);\
}\
.ace-tm .ace_string.ace_regex {\
color: rgb(255, 0, 0)\
}\
.ace-tm .ace_marker-layer .ace_selection {\
background: rgb(181, 213, 255);\
}\
.ace-tm.ace_multiselect .ace_selection.ace_start {\
box-shadow: 0 0 3px 0px white;\
}\
.ace-tm .ace_marker-layer .ace_step {\
background: rgb(252, 255, 0);\
}\
.ace-tm .ace_marker-layer .ace_stack {\
background: rgb(164, 229, 101);\
}\
.ace-tm .ace_marker-layer .ace_bracket {\
margin: -1px 0 0 -1px;\
border: 1px solid rgb(192, 192, 192);\
}\
.ace-tm .ace_marker-layer .ace_active-line {\
background: rgba(0, 0, 0, 0.07);\
}\
.ace-tm .ace_gutter-active-line {\
background-color : #dcdcdc;\
}\
.ace-tm .ace_marker-layer .ace_selected-word {\
background: rgb(250, 250, 255);\
border: 1px solid rgb(200, 200, 250);\
}\
.ace-tm .ace_indent-guide {\
background: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==\") right repeat-y;\
}\
";

var dom = require("../lib/dom");
dom.importCssString(exports.cssText, exports.cssClass);
});

ace.define("ace/line_widgets",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/range"], function(require, exports, module) {
"use strict";

var oop = require("./lib/oop");
var dom = require("./lib/dom");
var Range = require("./range").Range;


function LineWidgets(session) {
    this.session = session;
    this.session.widgetManager = this;
    this.session.getRowLength = this.getRowLength;
    this.session.$getWidgetScreenLength = this.$getWidgetScreenLength;
    this.updateOnChange = this.updateOnChange.bind(this);
    this.renderWidgets = this.renderWidgets.bind(this);
    this.measureWidgets = this.measureWidgets.bind(this);
    this.session._changedWidgets = [];
    this.$onChangeEditor = this.$onChangeEditor.bind(this);
    
    this.session.on("change", this.updateOnChange);
    this.session.on("changeFold", this.updateOnFold);
    this.session.on("changeEditor", this.$onChangeEditor);
}

(function() {
    this.getRowLength = function(row) {
        var h;
        if (this.lineWidgets)
            h = this.lineWidgets[row] && this.lineWidgets[row].rowCount || 0;
        else 
            h = 0;
        if (!this.$useWrapMode || !this.$wrapData[row]) {
            return 1 + h;
        } else {
            return this.$wrapData[row].length + 1 + h;
        }
    };

    this.$getWidgetScreenLength = function() {
        var screenRows = 0;
        this.lineWidgets.forEach(function(w){
            if (w && w.rowCount && !w.hidden)
                screenRows += w.rowCount;
        });
        return screenRows;
    };    
    
    this.$onChangeEditor = function(e) {
        this.attach(e.editor);
    };
    
    this.attach = function(editor) {
        if (editor  && editor.widgetManager && editor.widgetManager != this)
            editor.widgetManager.detach();

        if (this.editor == editor)
            return;

        this.detach();
        this.editor = editor;
        
        if (editor) {
            editor.widgetManager = this;
            editor.renderer.on("beforeRender", this.measureWidgets);
            editor.renderer.on("afterRender", this.renderWidgets);
        }
    };
    this.detach = function(e) {
        var editor = this.editor;
        if (!editor)
            return;
        
        this.editor = null;
        editor.widgetManager = null;
        
        editor.renderer.off("beforeRender", this.measureWidgets);
        editor.renderer.off("afterRender", this.renderWidgets);
        var lineWidgets = this.session.lineWidgets;
        lineWidgets && lineWidgets.forEach(function(w) {
            if (w && w.el && w.el.parentNode) {
                w._inDocument = false;
                w.el.parentNode.removeChild(w.el);
            }
        });
    };

    this.updateOnFold = function(e, session) {
        var lineWidgets = session.lineWidgets;
        if (!lineWidgets || !e.action)
            return;
        var fold = e.data;
        var start = fold.start.row;
        var end = fold.end.row;
        var hide = e.action == "add";
        for (var i = start + 1; i < end; i++) {
            if (lineWidgets[i])
                lineWidgets[i].hidden = hide;
        }
        if (lineWidgets[end]) {
            if (hide) {
                if (!lineWidgets[start])
                    lineWidgets[start] = lineWidgets[end];
                else
                    lineWidgets[end].hidden = hide;
            } else {
                if (lineWidgets[start] == lineWidgets[end])
                    lineWidgets[start] = undefined;
                lineWidgets[end].hidden = hide;
            }
        }
    };
    
    this.updateOnChange = function(delta) {
        var lineWidgets = this.session.lineWidgets;
        if (!lineWidgets) return;
        
        var startRow = delta.start.row;
        var len = delta.end.row - startRow;

        if (len === 0) {
        } else if (delta.action == 'remove') {
            var removed = lineWidgets.splice(startRow + 1, len);
            removed.forEach(function(w) {
                w && this.removeLineWidget(w);
            }, this);
            this.$updateRows();
        } else {
            var args = new Array(len);
            args.unshift(startRow, 0);
            lineWidgets.splice.apply(lineWidgets, args);
            this.$updateRows();
        }
    };
    
    this.$updateRows = function() {
        var lineWidgets = this.session.lineWidgets;
        if (!lineWidgets) return;
        var noWidgets = true;
        lineWidgets.forEach(function(w, i) {
            if (w) {
                noWidgets = false;
                w.row = i;
                while (w.$oldWidget) {
                    w.$oldWidget.row = i;
                    w = w.$oldWidget;
                }
            }
        });
        if (noWidgets)
            this.session.lineWidgets = null;
    };

    this.addLineWidget = function(w) {
        if (!this.session.lineWidgets)
            this.session.lineWidgets = new Array(this.session.getLength());
        
        var old = this.session.lineWidgets[w.row];
        if (old) {
            w.$oldWidget = old;
            if (old.el && old.el.parentNode) {
                old.el.parentNode.removeChild(old.el);
                old._inDocument = false;
            }
        }
            
        this.session.lineWidgets[w.row] = w;
        
        w.session = this.session;
        
        var renderer = this.editor.renderer;
        if (w.html && !w.el) {
            w.el = dom.createElement("div");
            w.el.innerHTML = w.html;
        }
        if (w.el) {
            dom.addCssClass(w.el, "ace_lineWidgetContainer");
            w.el.style.position = "absolute";
            w.el.style.zIndex = 5;
            renderer.container.appendChild(w.el);
            w._inDocument = true;
        }
        
        if (!w.coverGutter) {
            w.el.style.zIndex = 3;
        }
        if (w.pixelHeight == null) {
            w.pixelHeight = w.el.offsetHeight;
        }
        if (w.rowCount == null) {
            w.rowCount = w.pixelHeight / renderer.layerConfig.lineHeight;
        }
        
        var fold = this.session.getFoldAt(w.row, 0);
        w.$fold = fold;
        if (fold) {
            var lineWidgets = this.session.lineWidgets;
            if (w.row == fold.end.row && !lineWidgets[fold.start.row])
                lineWidgets[fold.start.row] = w;
            else
                w.hidden = true;
        }
            
        this.session._emit("changeFold", {data:{start:{row: w.row}}});
        
        this.$updateRows();
        this.renderWidgets(null, renderer);
        this.onWidgetChanged(w);
        return w;
    };
    
    this.removeLineWidget = function(w) {
        w._inDocument = false;
        w.session = null;
        if (w.el && w.el.parentNode)
            w.el.parentNode.removeChild(w.el);
        if (w.editor && w.editor.destroy) try {
            w.editor.destroy();
        } catch(e){}
        if (this.session.lineWidgets) {
            var w1 = this.session.lineWidgets[w.row];
            if (w1 == w) {
                this.session.lineWidgets[w.row] = w.$oldWidget;
                if (w.$oldWidget)
                    this.onWidgetChanged(w.$oldWidget);
            } else {
                while (w1) {
                    if (w1.$oldWidget == w) {
                        w1.$oldWidget = w.$oldWidget;
                        break;
                    }
                    w1 = w1.$oldWidget;
                }
            }
        }
        this.session._emit("changeFold", {data:{start:{row: w.row}}});
        this.$updateRows();
    };
    
    this.getWidgetsAtRow = function(row) {
        var lineWidgets = this.session.lineWidgets;
        var w = lineWidgets && lineWidgets[row];
        var list = [];
        while (w) {
            list.push(w);
            w = w.$oldWidget;
        }
        return list;
    };
    
    this.onWidgetChanged = function(w) {
        this.session._changedWidgets.push(w);
        this.editor && this.editor.renderer.updateFull();
    };
    
    this.measureWidgets = function(e, renderer) {
        var changedWidgets = this.session._changedWidgets;
        var config = renderer.layerConfig;
        
        if (!changedWidgets || !changedWidgets.length) return;
        var min = Infinity;
        for (var i = 0; i < changedWidgets.length; i++) {
            var w = changedWidgets[i];
            if (!w || !w.el) continue;
            if (w.session != this.session) continue;
            if (!w._inDocument) {
                if (this.session.lineWidgets[w.row] != w)
                    continue;
                w._inDocument = true;
                renderer.container.appendChild(w.el);
            }
            
            w.h = w.el.offsetHeight;
            
            if (!w.fixedWidth) {
                w.w = w.el.offsetWidth;
                w.screenWidth = Math.ceil(w.w / config.characterWidth);
            }
            
            var rowCount = w.h / config.lineHeight;
            if (w.coverLine) {
                rowCount -= this.session.getRowLineCount(w.row);
                if (rowCount < 0)
                    rowCount = 0;
            }
            if (w.rowCount != rowCount) {
                w.rowCount = rowCount;
                if (w.row < min)
                    min = w.row;
            }
        }
        if (min != Infinity) {
            this.session._emit("changeFold", {data:{start:{row: min}}});
            this.session.lineWidgetWidth = null;
        }
        this.session._changedWidgets = [];
    };
    
    this.renderWidgets = function(e, renderer) {
        var config = renderer.layerConfig;
        var lineWidgets = this.session.lineWidgets;
        if (!lineWidgets)
            return;
        var first = Math.min(this.firstRow, config.firstRow);
        var last = Math.max(this.lastRow, config.lastRow, lineWidgets.length);
        
        while (first > 0 && !lineWidgets[first])
            first--;
        
        this.firstRow = config.firstRow;
        this.lastRow = config.lastRow;

        renderer.$cursorLayer.config = config;
        for (var i = first; i <= last; i++) {
            var w = lineWidgets[i];
            if (!w || !w.el) continue;
            if (w.hidden) {
                w.el.style.top = -100 - (w.pixelHeight || 0) + "px";
                continue;
            }
            if (!w._inDocument) {
                w._inDocument = true;
                renderer.container.appendChild(w.el);
            }
            var top = renderer.$cursorLayer.getPixelPosition({row: i, column:0}, true).top;
            if (!w.coverLine)
                top += config.lineHeight * this.session.getRowLineCount(w.row);
            w.el.style.top = top - config.offset + "px";
            
            var left = w.coverGutter ? 0 : renderer.gutterWidth;
            if (!w.fixedWidth)
                left -= renderer.scrollLeft;
            w.el.style.left = left + "px";
            
            if (w.fullWidth && w.screenWidth) {
                w.el.style.minWidth = config.width + 2 * config.padding + "px";
            }
            
            if (w.fixedWidth) {
                w.el.style.right = renderer.scrollBar.getWidth() + "px";
            } else {
                w.el.style.right = "";
            }
        }
    };
    
}).call(LineWidgets.prototype);


exports.LineWidgets = LineWidgets;

});

ace.define("ace/ext/error_marker",["require","exports","module","ace/line_widgets","ace/lib/dom","ace/range"], function(require, exports, module) {
"use strict";
var LineWidgets = require("../line_widgets").LineWidgets;
var dom = require("../lib/dom");
var Range = require("../range").Range;

function binarySearch(array, needle, comparator) {
    var first = 0;
    var last = array.length - 1;

    while (first <= last) {
        var mid = (first + last) >> 1;
        var c = comparator(needle, array[mid]);
        if (c > 0)
            first = mid + 1;
        else if (c < 0)
            last = mid - 1;
        else
            return mid;
    }
    return -(first + 1);
}

function findAnnotations(session, row, dir) {
    var annotations = session.getAnnotations().sort(Range.comparePoints);
    if (!annotations.length)
        return;
    
    var i = binarySearch(annotations, {row: row, column: -1}, Range.comparePoints);
    if (i < 0)
        i = -i - 1;
    
    if (i >= annotations.length)
        i = dir > 0 ? 0 : annotations.length - 1;
    else if (i === 0 && dir < 0)
        i = annotations.length - 1;
    
    var annotation = annotations[i];
    if (!annotation || !dir)
        return;

    if (annotation.row === row) {
        do {
            annotation = annotations[i += dir];
        } while (annotation && annotation.row === row);
        if (!annotation)
            return annotations.slice();
    }
    
    
    var matched = [];
    row = annotation.row;
    do {
        matched[dir < 0 ? "unshift" : "push"](annotation);
        annotation = annotations[i += dir];
    } while (annotation && annotation.row == row);
    return matched.length && matched;
}

exports.showErrorMarker = function(editor, dir) {
    var session = editor.session;
    if (!session.widgetManager) {
        session.widgetManager = new LineWidgets(session);
        session.widgetManager.attach(editor);
    }
    
    var pos = editor.getCursorPosition();
    var row = pos.row;
    var oldWidget = session.widgetManager.getWidgetsAtRow(row).filter(function(w) {
        return w.type == "errorMarker";
    })[0];
    if (oldWidget) {
        oldWidget.destroy();
    } else {
        row -= dir;
    }
    var annotations = findAnnotations(session, row, dir);
    var gutterAnno;
    if (annotations) {
        var annotation = annotations[0];
        pos.column = (annotation.pos && typeof annotation.column != "number"
            ? annotation.pos.sc
            : annotation.column) || 0;
        pos.row = annotation.row;
        gutterAnno = editor.renderer.$gutterLayer.$annotations[pos.row];
    } else if (oldWidget) {
        return;
    } else {
        gutterAnno = {
            text: ["Looks good!"],
            className: "ace_ok"
        };
    }
    editor.session.unfold(pos.row);
    editor.selection.moveToPosition(pos);
    
    var w = {
        row: pos.row, 
        fixedWidth: true,
        coverGutter: true,
        el: dom.createElement("div"),
        type: "errorMarker"
    };
    var el = w.el.appendChild(dom.createElement("div"));
    var arrow = w.el.appendChild(dom.createElement("div"));
    arrow.className = "error_widget_arrow " + gutterAnno.className;
    
    var left = editor.renderer.$cursorLayer
        .getPixelPosition(pos).left;
    arrow.style.left = left + editor.renderer.gutterWidth - 5 + "px";
    
    w.el.className = "error_widget_wrapper";
    el.className = "error_widget " + gutterAnno.className;
    el.innerHTML = gutterAnno.text.join("<br>");
    
    el.appendChild(dom.createElement("div"));
    
    var kb = function(_, hashId, keyString) {
        if (hashId === 0 && (keyString === "esc" || keyString === "return")) {
            w.destroy();
            return {command: "null"};
        }
    };
    
    w.destroy = function() {
        if (editor.$mouseHandler.isMousePressed)
            return;
        editor.keyBinding.removeKeyboardHandler(kb);
        session.widgetManager.removeLineWidget(w);
        editor.off("changeSelection", w.destroy);
        editor.off("changeSession", w.destroy);
        editor.off("mouseup", w.destroy);
        editor.off("change", w.destroy);
    };
    
    editor.keyBinding.addKeyboardHandler(kb);
    editor.on("changeSelection", w.destroy);
    editor.on("changeSession", w.destroy);
    editor.on("mouseup", w.destroy);
    editor.on("change", w.destroy);
    
    editor.session.widgetManager.addLineWidget(w);
    
    w.el.onmousedown = editor.focus.bind(editor);
    
    editor.renderer.scrollCursorIntoView(null, 0.5, {bottom: w.el.offsetHeight});
};


dom.importCssString("\
    .error_widget_wrapper {\
        background: inherit;\
        color: inherit;\
        border:none\
    }\
    .error_widget {\
        border-top: solid 2px;\
        border-bottom: solid 2px;\
        margin: 5px 0;\
        padding: 10px 40px;\
        white-space: pre-wrap;\
    }\
    .error_widget.ace_error, .error_widget_arrow.ace_error{\
        border-color: #ff5a5a\
    }\
    .error_widget.ace_warning, .error_widget_arrow.ace_warning{\
        border-color: #F1D817\
    }\
    .error_widget.ace_info, .error_widget_arrow.ace_info{\
        border-color: #5a5a5a\
    }\
    .error_widget.ace_ok, .error_widget_arrow.ace_ok{\
        border-color: #5aaa5a\
    }\
    .error_widget_arrow {\
        position: absolute;\
        border: solid 5px;\
        border-top-color: transparent!important;\
        border-right-color: transparent!important;\
        border-left-color: transparent!important;\
        top: -5px;\
    }\
", "");

});

ace.define("ace/ace",["require","exports","module","ace/lib/fixoldbrowsers","ace/lib/dom","ace/lib/event","ace/editor","ace/edit_session","ace/undomanager","ace/virtual_renderer","ace/worker/worker_client","ace/keyboard/hash_handler","ace/placeholder","ace/multi_select","ace/mode/folding/fold_mode","ace/theme/textmate","ace/ext/error_marker","ace/config"], function(require, exports, module) {
"use strict";

require("./lib/fixoldbrowsers");

var dom = require("./lib/dom");
var event = require("./lib/event");

var Editor = require("./editor").Editor;
var EditSession = require("./edit_session").EditSession;
var UndoManager = require("./undomanager").UndoManager;
var Renderer = require("./virtual_renderer").VirtualRenderer;
require("./worker/worker_client");
require("./keyboard/hash_handler");
require("./placeholder");
require("./multi_select");
require("./mode/folding/fold_mode");
require("./theme/textmate");
require("./ext/error_marker");

exports.config = require("./config");
exports.require = require;

if (typeof define === "function")
    exports.define = define;
exports.edit = function(el) {
    if (typeof el == "string") {
        var _id = el;
        el = document.getElementById(_id);
        if (!el)
            throw new Error("ace.edit can't find div #" + _id);
    }

    if (el && el.env && el.env.editor instanceof Editor)
        return el.env.editor;

    var value = "";
    if (el && /input|textarea/i.test(el.tagName)) {
        var oldNode = el;
        value = oldNode.value;
        el = dom.createElement("pre");
        oldNode.parentNode.replaceChild(el, oldNode);
    } else if (el) {
        value = dom.getInnerText(el);
        el.innerHTML = "";
    }

    var doc = exports.createEditSession(value);

    var editor = new Editor(new Renderer(el));
    editor.setSession(doc);

    var env = {
        document: doc,
        editor: editor,
        onResize: editor.resize.bind(editor, null)
    };
    if (oldNode) env.textarea = oldNode;
    event.addListener(window, "resize", env.onResize);
    editor.on("destroy", function() {
        event.removeListener(window, "resize", env.onResize);
        env.editor.container.env = null; // prevent memory leak on old ie
    });
    editor.container.env = editor.env = env;
    return editor;
};
exports.createEditSession = function(text, mode) {
    var doc = new EditSession(text, mode);
    doc.setUndoManager(new UndoManager());
    return doc;
};
exports.EditSession = EditSession;
exports.UndoManager = UndoManager;
exports.version = "1.2.9";
});
            (function() {
                ace.require(["ace/ace"], function(a) {
                    if (a) {
                        a.config.init(true);
                        a.define = ace.define;
                    }
                    if (!window.ace)
                        window.ace = a;
                    for (var key in a) if (a.hasOwnProperty(key))
                        window.ace[key] = a[key];
                });
            })();
        
ace.define("ace/theme/dracula",["require","exports","module","ace/lib/dom"], function(require, exports, module) {

exports.isDark = true;
exports.cssClass = "ace-dracula";
exports.cssText = "\
ace-dracula .ace_gutter {\
background: #282a36;\
color: rgb(144,145,148)\
}\
.ace-dracula .ace_print-margin {\
width: 1px;\
background: #e8e8e8\
}\
.ace-dracula {\
background-color: #282a36;\
color: #f8f8f2\
}\
.ace-dracula .ace_cursor {\
color: #f8f8f0\
}\
.ace-dracula .ace_marker-layer .ace_selection {\
background: #44475a\
}\
.ace-dracula.ace_multiselect .ace_selection.ace_start {\
box-shadow: 0 0 3px 0px #282a36;\
border-radius: 2px\
}\
.ace-dracula .ace_marker-layer .ace_step {\
background: rgb(198, 219, 174)\
}\
.ace-dracula .ace_marker-layer .ace_bracket {\
margin: -1px 0 0 -1px;\
border: 1px solid #3B3A32\
}\
.ace-dracula .ace_marker-layer .ace_active-line {\
background: #44475a\
}\
.ace-dracula .ace_gutter-active-line {\
background-color: #44475a\
}\
.ace-dracula .ace_marker-layer .ace_selected-word {\
border: 1px solid #44475a\
}\
.ace-dracula .ace_fold {\
background-color: #50fa7b;\
border-color: #f8f8f2\
}\
.ace-dracula .ace_keyword {\
color: #ff79c6\
}\
.ace-dracula .ace_constant.ace_language {\
color: #bd93f9\
}\
.ace-dracula .ace_constant.ace_numeric {\
color: #bd93f9\
}\
.ace-dracula .ace_constant.ace_character {\
color: #bd93f9\
}\
.ace-dracula .ace_constant.ace_character.ace_escape {\
color: #ff79c6\
}\
.ace-dracula .ace_constant.ace_other {\
color: #bd93f9\
}\
.ace-dracula .ace_support.ace_function {\
color: #8be9fd\
}\
.ace-dracula .ace_support.ace_constant {\
color: #6be5fd\
}\
.ace-dracula .ace_support.ace_class {\
font-style: italic;\
color: #66d9ef\
}\
.ace-dracula .ace_support.ace_type {\
font-style: italic;\
color: #66d9ef\
}\
.ace-dracula .ace_storage {\
color: #ff79c6\
}\
.ace-dracula .ace_storage.ace_type {\
font-style: italic;\
color: #8be9fd\
}\
.ace-dracula .ace_invalid {\
color: #F8F8F0;\
background-color: #ff79c6\
}\
.ace-dracula .ace_invalid.ace_deprecated {\
color: #F8F8F0;\
background-color: #bd93f9\
}\
.ace-dracula .ace_string {\
color: #f1fa8c\
}\
.ace-dracula .ace_comment {\
color: #6272a4\
}\
.ace-dracula .ace_variable {\
color: #50fa7b\
}\
.ace-dracula .ace_variable.ace_parameter {\
font-style: italic;\
color: #ffb86c\
}\
.ace-dracula .ace_entity.ace_other.ace_attribute-name {\
color: #50fa7b\
}\
.ace-dracula .ace_entity.ace_name.ace_function {\
color: #50fa7b\
}\
.ace-dracula .ace_entity.ace_name.ace_tag {\
color: #ff79c6\
}\
";

var dom = require("../lib/dom");
dom.importCssString(exports.cssText, exports.cssClass);
});

ace.define("ace/mode/sh_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"], function(require, exports, module) {
"use strict";

var oop = require("../lib/oop");
var TextHighlightRules = require("./text_highlight_rules").TextHighlightRules;

var reservedKeywords = exports.reservedKeywords = (
        '!|{|}|case|do|done|elif|else|'+
        'esac|fi|for|if|in|then|until|while|'+
        '&|;|export|local|read|typeset|unset|'+
        'elif|select|set|function|declare|readonly'
    );

var languageConstructs = exports.languageConstructs = (
    '[|]|alias|bg|bind|break|builtin|'+
     'cd|command|compgen|complete|continue|'+
     'dirs|disown|echo|enable|eval|exec|'+
     'exit|fc|fg|getopts|hash|help|history|'+
     'jobs|kill|let|logout|popd|printf|pushd|'+
     'pwd|return|set|shift|shopt|source|'+
     'suspend|test|times|trap|type|ulimit|'+
     'umask|unalias|wait'
);

var ShHighlightRules = function() {
    var keywordMapper = this.createKeywordMapper({
        "keyword": reservedKeywords,
        "support.function.builtin": languageConstructs,
        "invalid.deprecated": "debugger"
    }, "identifier");

    var integer = "(?:(?:[1-9]\\d*)|(?:0))";

    var fraction = "(?:\\.\\d+)";
    var intPart = "(?:\\d+)";
    var pointFloat = "(?:(?:" + intPart + "?" + fraction + ")|(?:" + intPart + "\\.))";
    var exponentFloat = "(?:(?:" + pointFloat + "|" +  intPart + ")" + ")";
    var floatNumber = "(?:" + exponentFloat + "|" + pointFloat + ")";
    var fileDescriptor = "(?:&" + intPart + ")";

    var variableName = "[a-zA-Z_][a-zA-Z0-9_]*";
    var variable = "(?:" + variableName + "(?==))";

    var builtinVariable = "(?:\\$(?:SHLVL|\\$|\\!|\\?))";

    var func = "(?:" + variableName + "\\s*\\(\\))";

    this.$rules = {
        "start" : [{
            token : "constant",
            regex : /\\./
        }, {
            token : ["text", "comment"],
            regex : /(^|\s)(#.*)$/
        }, {
            token : "string.start",
            regex : '"',
            push : [{
                token : "constant.language.escape",
                regex : /\\(?:[$`"\\]|$)/
            }, {
                include : "variables"
            }, {
                token : "keyword.operator",
                regex : /`/ // TODO highlight `
            }, {
                token : "string.end",
                regex : '"',
                next: "pop"
            }, {
                defaultToken: "string"
            }]
        }, {
            token : "string",
            regex : "\\$'",
            push : [{
                token : "constant.language.escape",
                regex : /\\(?:[abeEfnrtv\\'"]|x[a-fA-F\d]{1,2}|u[a-fA-F\d]{4}([a-fA-F\d]{4})?|c.|\d{1,3})/
            }, {
                token : "string",
                regex : "'",
                next: "pop"
            }, {
                defaultToken: "string"
            }]
        }, {
            regex : "<<<",
            token : "keyword.operator"
        }, {
            stateName: "heredoc",
            regex : "(<<-?)(\\s*)(['\"`]?)([\\w\\-]+)(['\"`]?)",
            onMatch : function(value, currentState, stack) {
                var next = value[2] == '-' ? "indentedHeredoc" : "heredoc";
                var tokens = value.split(this.splitRegex);
                stack.push(next, tokens[4]);
                return [
                    {type:"constant", value: tokens[1]},
                    {type:"text", value: tokens[2]},
                    {type:"string", value: tokens[3]},
                    {type:"support.class", value: tokens[4]},
                    {type:"string", value: tokens[5]}
                ];
            },
            rules: {
                heredoc: [{
                    onMatch:  function(value, currentState, stack) {
                        if (value === stack[1]) {
                            stack.shift();
                            stack.shift();
                            this.next = stack[0] || "start";
                            return "support.class";
                        }
                        this.next = "";
                        return "string";
                    },
                    regex: ".*$",
                    next: "start"
                }],
                indentedHeredoc: [{
                    token: "string",
                    regex: "^\t+"
                }, {
                    onMatch:  function(value, currentState, stack) {
                        if (value === stack[1]) {
                            stack.shift();
                            stack.shift();
                            this.next = stack[0] || "start";
                            return "support.class";
                        }
                        this.next = "";
                        return "string";
                    },
                    regex: ".*$",
                    next: "start"
                }]
            }
        }, {
            regex : "$",
            token : "empty",
            next : function(currentState, stack) {
                if (stack[0] === "heredoc" || stack[0] === "indentedHeredoc")
                    return stack[0];
                return currentState;
            }
        }, {
            token : ["keyword", "text", "text", "text", "variable"],
            regex : /(declare|local|readonly)(\s+)(?:(-[fixar]+)(\s+))?([a-zA-Z_][a-zA-Z0-9_]*\b)/
        }, {
            token : "variable.language",
            regex : builtinVariable
        }, {
            token : "variable",
            regex : variable
        }, {
            include : "variables"
        }, {
            token : "support.function",
            regex : func
        }, {
            token : "support.function",
            regex : fileDescriptor
        }, {
            token : "string",           // ' string
            start : "'", end : "'"
        }, {
            token : "constant.numeric", // float
            regex : floatNumber
        }, {
            token : "constant.numeric", // integer
            regex : integer + "\\b"
        }, {
            token : keywordMapper,
            regex : "[a-zA-Z_][a-zA-Z0-9_]*\\b"
        }, {
            token : "keyword.operator",
            regex : "\\+|\\-|\\*|\\*\\*|\\/|\\/\\/|~|<|>|<=|=>|=|!=|[%&|`]"
        }, {
            token : "punctuation.operator",
            regex : ";"
        }, {
            token : "paren.lparen",
            regex : "[\\[\\(\\{]"
        }, {
            token : "paren.rparen",
            regex : "[\\]]"
        }, {
            token : "paren.rparen",
            regex : "[\\)\\}]",
            next : "pop"
        }],
        variables: [{
            token : "variable",
            regex : /(\$)(\w+)/
        }, {
            token : ["variable", "paren.lparen"],
            regex : /(\$)(\()/,
            push : "start"
        }, {
            token : ["variable", "paren.lparen", "keyword.operator", "variable", "keyword.operator"],
            regex : /(\$)(\{)([#!]?)(\w+|[*@#?\-$!0_])(:[?+\-=]?|##?|%%?|,,?\/|\^\^?)?/,
            push : "start"
        }, {
            token : "variable",
            regex : /\$[*@#?\-$!0_]/
        }, {
            token : ["variable", "paren.lparen"],
            regex : /(\$)(\{)/,
            push : "start"
        }]
    };
    
    this.normalizeRules();
};

oop.inherits(ShHighlightRules, TextHighlightRules);

exports.ShHighlightRules = ShHighlightRules;
});

ace.define("ace/mode/folding/cstyle",["require","exports","module","ace/lib/oop","ace/range","ace/mode/folding/fold_mode"], function(require, exports, module) {
"use strict";

var oop = require("../../lib/oop");
var Range = require("../../range").Range;
var BaseFoldMode = require("./fold_mode").FoldMode;

var FoldMode = exports.FoldMode = function(commentRegex) {
    if (commentRegex) {
        this.foldingStartMarker = new RegExp(
            this.foldingStartMarker.source.replace(/\|[^|]*?$/, "|" + commentRegex.start)
        );
        this.foldingStopMarker = new RegExp(
            this.foldingStopMarker.source.replace(/\|[^|]*?$/, "|" + commentRegex.end)
        );
    }
};
oop.inherits(FoldMode, BaseFoldMode);

(function() {
    
    this.foldingStartMarker = /([\{\[\(])[^\}\]\)]*$|^\s*(\/\*)/;
    this.foldingStopMarker = /^[^\[\{\(]*([\}\]\)])|^[\s\*]*(\*\/)/;
    this.singleLineBlockCommentRe= /^\s*(\/\*).*\*\/\s*$/;
    this.tripleStarBlockCommentRe = /^\s*(\/\*\*\*).*\*\/\s*$/;
    this.startRegionRe = /^\s*(\/\*|\/\/)#?region\b/;
    this._getFoldWidgetBase = this.getFoldWidget;
    this.getFoldWidget = function(session, foldStyle, row) {
        var line = session.getLine(row);
    
        if (this.singleLineBlockCommentRe.test(line)) {
            if (!this.startRegionRe.test(line) && !this.tripleStarBlockCommentRe.test(line))
                return "";
        }
    
        var fw = this._getFoldWidgetBase(session, foldStyle, row);
    
        if (!fw && this.startRegionRe.test(line))
            return "start"; // lineCommentRegionStart
    
        return fw;
    };

    this.getFoldWidgetRange = function(session, foldStyle, row, forceMultiline) {
        var line = session.getLine(row);
        
        if (this.startRegionRe.test(line))
            return this.getCommentRegionBlock(session, line, row);
        
        var match = line.match(this.foldingStartMarker);
        if (match) {
            var i = match.index;

            if (match[1])
                return this.openingBracketBlock(session, match[1], row, i);
                
            var range = session.getCommentFoldRange(row, i + match[0].length, 1);
            
            if (range && !range.isMultiLine()) {
                if (forceMultiline) {
                    range = this.getSectionRange(session, row);
                } else if (foldStyle != "all")
                    range = null;
            }
            
            return range;
        }

        if (foldStyle === "markbegin")
            return;

        var match = line.match(this.foldingStopMarker);
        if (match) {
            var i = match.index + match[0].length;

            if (match[1])
                return this.closingBracketBlock(session, match[1], row, i);

            return session.getCommentFoldRange(row, i, -1);
        }
    };
    
    this.getSectionRange = function(session, row) {
        var line = session.getLine(row);
        var startIndent = line.search(/\S/);
        var startRow = row;
        var startColumn = line.length;
        row = row + 1;
        var endRow = row;
        var maxRow = session.getLength();
        while (++row < maxRow) {
            line = session.getLine(row);
            var indent = line.search(/\S/);
            if (indent === -1)
                continue;
            if  (startIndent > indent)
                break;
            var subRange = this.getFoldWidgetRange(session, "all", row);
            
            if (subRange) {
                if (subRange.start.row <= startRow) {
                    break;
                } else if (subRange.isMultiLine()) {
                    row = subRange.end.row;
                } else if (startIndent == indent) {
                    break;
                }
            }
            endRow = row;
        }
        
        return new Range(startRow, startColumn, endRow, session.getLine(endRow).length);
    };
    this.getCommentRegionBlock = function(session, line, row) {
        var startColumn = line.search(/\s*$/);
        var maxRow = session.getLength();
        var startRow = row;
        
        var re = /^\s*(?:\/\*|\/\/|--)#?(end)?region\b/;
        var depth = 1;
        while (++row < maxRow) {
            line = session.getLine(row);
            var m = re.exec(line);
            if (!m) continue;
            if (m[1]) depth--;
            else depth++;

            if (!depth) break;
        }

        var endRow = row;
        if (endRow > startRow) {
            return new Range(startRow, startColumn, endRow, line.length);
        }
    };

}).call(FoldMode.prototype);

});

ace.define("ace/mode/sh",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/sh_highlight_rules","ace/range","ace/mode/folding/cstyle","ace/mode/behaviour/cstyle"], function(require, exports, module) {
"use strict";

var oop = require("../lib/oop");
var TextMode = require("./text").Mode;
var ShHighlightRules = require("./sh_highlight_rules").ShHighlightRules;
var Range = require("../range").Range;
var CStyleFoldMode = require("./folding/cstyle").FoldMode;
var CstyleBehaviour = require("./behaviour/cstyle").CstyleBehaviour;

var Mode = function() {
    this.HighlightRules = ShHighlightRules;
    this.foldingRules = new CStyleFoldMode();
    this.$behaviour = new CstyleBehaviour();
};
oop.inherits(Mode, TextMode);

(function() {

   
    this.lineCommentStart = "#";

    this.getNextLineIndent = function(state, line, tab) {
        var indent = this.$getIndent(line);

        var tokenizedLine = this.getTokenizer().getLineTokens(line, state);
        var tokens = tokenizedLine.tokens;

        if (tokens.length && tokens[tokens.length-1].type == "comment") {
            return indent;
        }

        if (state == "start") {
            var match = line.match(/^.*[\{\(\[:]\s*$/);
            if (match) {
                indent += tab;
            }
        }

        return indent;
    };

    var outdents = {
        "pass": 1,
        "return": 1,
        "raise": 1,
        "break": 1,
        "continue": 1
    };

    this.checkOutdent = function(state, line, input) {
        if (input !== "\r\n" && input !== "\r" && input !== "\n")
            return false;

        var tokens = this.getTokenizer().getLineTokens(line.trim(), state).tokens;

        if (!tokens)
            return false;
        do {
            var last = tokens.pop();
        } while (last && (last.type == "comment" || (last.type == "text" && last.value.match(/^\s+$/))));

        if (!last)
            return false;

        return (last.type == "keyword" && outdents[last.value]);
    };

    this.autoOutdent = function(state, doc, row) {

        row += 1;
        var indent = this.$getIndent(doc.getLine(row));
        var tab = doc.getTabString();
        if (indent.slice(-tab.length) == tab)
            doc.remove(new Range(row, indent.length-tab.length, row, indent.length));
    };

    this.$id = "ace/mode/sh";
}).call(Mode.prototype);

exports.Mode = Mode;
});

ace.define("ace/mode/python_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"], function(require, exports, module) {
"use strict";

var oop = require("../lib/oop");
var TextHighlightRules = require("./text_highlight_rules").TextHighlightRules;

var PythonHighlightRules = function() {

    var keywords = (
        "and|as|assert|break|class|continue|def|del|elif|else|except|exec|" +
        "finally|for|from|global|if|import|in|is|lambda|not|or|pass|print|" +
        "raise|return|try|while|with|yield|async|await"
    );

    var builtinConstants = (
        "True|False|None|NotImplemented|Ellipsis|__debug__"
    );

    var builtinFunctions = (
        "abs|divmod|input|open|staticmethod|all|enumerate|int|ord|str|any|" +
        "eval|isinstance|pow|sum|basestring|execfile|issubclass|print|super|" +
        "binfile|iter|property|tuple|bool|filter|len|range|type|bytearray|" +
        "float|list|raw_input|unichr|callable|format|locals|reduce|unicode|" +
        "chr|frozenset|long|reload|vars|classmethod|getattr|map|repr|xrange|" +
        "cmp|globals|max|reversed|zip|compile|hasattr|memoryview|round|" +
        "__import__|complex|hash|min|set|apply|delattr|help|next|setattr|" +
        "buffer|dict|hex|object|slice|coerce|dir|id|oct|sorted|intern"
    );
    var keywordMapper = this.createKeywordMapper({
        "invalid.deprecated": "debugger",
        "support.function": builtinFunctions,
        "constant.language": builtinConstants,
        "keyword": keywords
    }, "identifier");

    var strPre = "(?:r|u|ur|R|U|UR|Ur|uR)?";

    var decimalInteger = "(?:(?:[1-9]\\d*)|(?:0))";
    var octInteger = "(?:0[oO]?[0-7]+)";
    var hexInteger = "(?:0[xX][\\dA-Fa-f]+)";
    var binInteger = "(?:0[bB][01]+)";
    var integer = "(?:" + decimalInteger + "|" + octInteger + "|" + hexInteger + "|" + binInteger + ")";

    var exponent = "(?:[eE][+-]?\\d+)";
    var fraction = "(?:\\.\\d+)";
    var intPart = "(?:\\d+)";
    var pointFloat = "(?:(?:" + intPart + "?" + fraction + ")|(?:" + intPart + "\\.))";
    var exponentFloat = "(?:(?:" + pointFloat + "|" +  intPart + ")" + exponent + ")";
    var floatNumber = "(?:" + exponentFloat + "|" + pointFloat + ")";

    var stringEscape =  "\\\\(x[0-9A-Fa-f]{2}|[0-7]{3}|[\\\\abfnrtv'\"]|U[0-9A-Fa-f]{8}|u[0-9A-Fa-f]{4})";

    this.$rules = {
        "start" : [ {
            token : "comment",
            regex : "#.*$"
        }, {
            token : "string",           // multi line """ string start
            regex : strPre + '"{3}',
            next : "qqstring3"
        }, {
            token : "string",           // " string
            regex : strPre + '"(?=.)',
            next : "qqstring"
        }, {
            token : "string",           // multi line ''' string start
            regex : strPre + "'{3}",
            next : "qstring3"
        }, {
            token : "string",           // ' string
            regex : strPre + "'(?=.)",
            next : "qstring"
        }, {
            token : "constant.numeric", // imaginary
            regex : "(?:" + floatNumber + "|\\d+)[jJ]\\b"
        }, {
            token : "constant.numeric", // float
            regex : floatNumber
        }, {
            token : "constant.numeric", // long integer
            regex : integer + "[lL]\\b"
        }, {
            token : "constant.numeric", // integer
            regex : integer + "\\b"
        }, {
            token : keywordMapper,
            regex : "[a-zA-Z_$][a-zA-Z0-9_$]*\\b"
        }, {
            token : "keyword.operator",
            regex : "\\+|\\-|\\*|\\*\\*|\\/|\\/\\/|%|<<|>>|&|\\||\\^|~|<|>|<=|=>|==|!=|<>|="
        }, {
            token : "paren.lparen",
            regex : "[\\[\\(\\{]"
        }, {
            token : "paren.rparen",
            regex : "[\\]\\)\\}]"
        }, {
            token : "text",
            regex : "\\s+"
        } ],
        "qqstring3" : [ {
            token : "constant.language.escape",
            regex : stringEscape
        }, {
            token : "string", // multi line """ string end
            regex : '"{3}',
            next : "start"
        }, {
            defaultToken : "string"
        } ],
        "qstring3" : [ {
            token : "constant.language.escape",
            regex : stringEscape
        }, {
            token : "string",  // multi line ''' string end
            regex : "'{3}",
            next : "start"
        }, {
            defaultToken : "string"
        } ],
        "qqstring" : [{
            token : "constant.language.escape",
            regex : stringEscape
        }, {
            token : "string",
            regex : "\\\\$",
            next  : "qqstring"
        }, {
            token : "string",
            regex : '"|$',
            next  : "start"
        }, {
            defaultToken: "string"
        }],
        "qstring" : [{
            token : "constant.language.escape",
            regex : stringEscape
        }, {
            token : "string",
            regex : "\\\\$",
            next  : "qstring"
        }, {
            token : "string",
            regex : "'|$",
            next  : "start"
        }, {
            defaultToken: "string"
        }]
    };
};

oop.inherits(PythonHighlightRules, TextHighlightRules);

exports.PythonHighlightRules = PythonHighlightRules;
});

ace.define("ace/mode/folding/pythonic",["require","exports","module","ace/lib/oop","ace/mode/folding/fold_mode"], function(require, exports, module) {
"use strict";

var oop = require("../../lib/oop");
var BaseFoldMode = require("./fold_mode").FoldMode;

var FoldMode = exports.FoldMode = function(markers) {
    this.foldingStartMarker = new RegExp("([\\[{])(?:\\s*)$|(" + markers + ")(?:\\s*)(?:#.*)?$");
};
oop.inherits(FoldMode, BaseFoldMode);

(function() {

    this.getFoldWidgetRange = function(session, foldStyle, row) {
        var line = session.getLine(row);
        var match = line.match(this.foldingStartMarker);
        if (match) {
            if (match[1])
                return this.openingBracketBlock(session, match[1], row, match.index);
            if (match[2])
                return this.indentationBlock(session, row, match.index + match[2].length);
            return this.indentationBlock(session, row);
        }
    };

}).call(FoldMode.prototype);

});

ace.define("ace/mode/python",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/python_highlight_rules","ace/mode/folding/pythonic","ace/range"], function(require, exports, module) {
"use strict";

var oop = require("../lib/oop");
var TextMode = require("./text").Mode;
var PythonHighlightRules = require("./python_highlight_rules").PythonHighlightRules;
var PythonFoldMode = require("./folding/pythonic").FoldMode;
var Range = require("../range").Range;

var Mode = function() {
    this.HighlightRules = PythonHighlightRules;
    this.foldingRules = new PythonFoldMode("\\:");
    this.$behaviour = this.$defaultBehaviour;
};
oop.inherits(Mode, TextMode);

(function() {

    this.lineCommentStart = "#";

    this.getNextLineIndent = function(state, line, tab) {
        var indent = this.$getIndent(line);

        var tokenizedLine = this.getTokenizer().getLineTokens(line, state);
        var tokens = tokenizedLine.tokens;

        if (tokens.length && tokens[tokens.length-1].type == "comment") {
            return indent;
        }

        if (state == "start") {
            var match = line.match(/^.*[\{\(\[:]\s*$/);
            if (match) {
                indent += tab;
            }
        }

        return indent;
    };

    var outdents = {
        "pass": 1,
        "return": 1,
        "raise": 1,
        "break": 1,
        "continue": 1
    };
    
    this.checkOutdent = function(state, line, input) {
        if (input !== "\r\n" && input !== "\r" && input !== "\n")
            return false;

        var tokens = this.getTokenizer().getLineTokens(line.trim(), state).tokens;
        
        if (!tokens)
            return false;
        do {
            var last = tokens.pop();
        } while (last && (last.type == "comment" || (last.type == "text" && last.value.match(/^\s+$/))));
        
        if (!last)
            return false;
        
        return (last.type == "keyword" && outdents[last.value]);
    };

    this.autoOutdent = function(state, doc, row) {
        
        row += 1;
        var indent = this.$getIndent(doc.getLine(row));
        var tab = doc.getTabString();
        if (indent.slice(-tab.length) == tab)
            doc.remove(new Range(row, indent.length-tab.length, row, indent.length));
    };

    this.$id = "ace/mode/python";
}).call(Mode.prototype);

exports.Mode = Mode;
});

ace.define("ace/mode/perl_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"], function(require, exports, module) {
"use strict";

var oop = require("../lib/oop");
var TextHighlightRules = require("./text_highlight_rules").TextHighlightRules;

var PerlHighlightRules = function() {

    var keywords = (
        "base|constant|continue|else|elsif|for|foreach|format|goto|if|last|local|my|next|" +
         "no|package|parent|redo|require|scalar|sub|unless|until|while|use|vars"
    );

    var buildinConstants = ("ARGV|ENV|INC|SIG");

    var builtinFunctions = (
        "getprotobynumber|getprotobyname|getservbyname|gethostbyaddr|" +
         "gethostbyname|getservbyport|getnetbyaddr|getnetbyname|getsockname|" +
         "getpeername|setpriority|getprotoent|setprotoent|getpriority|" +
         "endprotoent|getservent|setservent|endservent|sethostent|socketpair|" +
         "getsockopt|gethostent|endhostent|setsockopt|setnetent|quotemeta|" +
         "localtime|prototype|getnetent|endnetent|rewinddir|wantarray|getpwuid|" +
         "closedir|getlogin|readlink|endgrent|getgrgid|getgrnam|shmwrite|" +
         "shutdown|readline|endpwent|setgrent|readpipe|formline|truncate|" +
         "dbmclose|syswrite|setpwent|getpwnam|getgrent|getpwent|ucfirst|sysread|" +
         "setpgrp|shmread|sysseek|sysopen|telldir|defined|opendir|connect|" +
         "lcfirst|getppid|binmode|syscall|sprintf|getpgrp|readdir|seekdir|" +
         "waitpid|reverse|unshift|symlink|dbmopen|semget|msgrcv|rename|listen|" +
         "chroot|msgsnd|shmctl|accept|unpack|exists|fileno|shmget|system|" +
         "unlink|printf|gmtime|msgctl|semctl|values|rindex|substr|splice|" +
         "length|msgget|select|socket|return|caller|delete|alarm|ioctl|index|" +
         "undef|lstat|times|srand|chown|fcntl|close|write|umask|rmdir|study|" +
         "sleep|chomp|untie|print|utime|mkdir|atan2|split|crypt|flock|chmod|" +
         "BEGIN|bless|chdir|semop|shift|reset|link|stat|chop|grep|fork|dump|" +
         "join|open|tell|pipe|exit|glob|warn|each|bind|sort|pack|eval|push|" +
         "keys|getc|kill|seek|sqrt|send|wait|rand|tied|read|time|exec|recv|" +
         "eof|chr|int|ord|exp|pos|pop|sin|log|abs|oct|hex|tie|cos|vec|END|ref|" +
         "map|die|uc|lc|do"
    );

    var keywordMapper = this.createKeywordMapper({
        "keyword": keywords,
        "constant.language": buildinConstants,
        "support.function": builtinFunctions
    }, "identifier");

    this.$rules = {
        "start" : [
            {
                token : "comment.doc",
                regex : "^=(?:begin|item)\\b",
                next : "block_comment"
            }, {
                token : "string.regexp",
                regex : "[/](?:(?:\\[(?:\\\\]|[^\\]])+\\])|(?:\\\\/|[^\\]/]))*[/]\\w*\\s*(?=[).,;]|$)"
            }, {
                token : "string", // single line
                regex : '["](?:(?:\\\\.)|(?:[^"\\\\]))*?["]'
            }, {
                token : "string", // multi line string start
                regex : '["].*\\\\$',
                next : "qqstring"
            }, {
                token : "string", // single line
                regex : "['](?:(?:\\\\.)|(?:[^'\\\\]))*?[']"
            }, {
                token : "string", // multi line string start
                regex : "['].*\\\\$",
                next : "qstring"
            }, {
                token : "constant.numeric", // hex
                regex : "0x[0-9a-fA-F]+\\b"
            }, {
                token : "constant.numeric", // float
                regex : "[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"
            }, {
                token : keywordMapper,
                regex : "[a-zA-Z_$][a-zA-Z0-9_$]*\\b"
            }, {
                token : "keyword.operator",
                regex : "%#|\\$#|\\.\\.\\.|\\|\\|=|>>=|<<=|<=>|&&=|=>|!~|\\^=|&=|\\|=|\\.=|x=|%=|\\/=|\\*=|\\-=|\\+=|=~|\\*\\*|\\-\\-|\\.\\.|\\|\\||&&|\\+\\+|\\->|!=|==|>=|<=|>>|<<|,|=|\\?\\:|\\^|\\||x|%|\\/|\\*|<|&|\\\\|~|!|>|\\.|\\-|\\+|\\-C|\\-b|\\-S|\\-u|\\-t|\\-p|\\-l|\\-d|\\-f|\\-g|\\-s|\\-z|\\-k|\\-e|\\-O|\\-T|\\-B|\\-M|\\-A|\\-X|\\-W|\\-c|\\-R|\\-o|\\-x|\\-w|\\-r|\\b(?:and|cmp|eq|ge|gt|le|lt|ne|not|or|xor)"
            }, {
                token : "comment",
                regex : "#.*$"
            }, {
                token : "lparen",
                regex : "[[({]"
            }, {
                token : "rparen",
                regex : "[\\])}]"
            }, {
                token : "text",
                regex : "\\s+"
            }
        ],
        "qqstring" : [
            {
                token : "string",
                regex : '(?:(?:\\\\.)|(?:[^"\\\\]))*?"',
                next : "start"
            }, {
                token : "string",
                regex : '.+'
            }
        ],
        "qstring" : [
            {
                token : "string",
                regex : "(?:(?:\\\\.)|(?:[^'\\\\]))*?'",
                next : "start"
            }, {
                token : "string",
                regex : '.+'
            }
        ],
        "block_comment": [
            {
                token: "comment.doc", 
                regex: "^=cut\\b",
                next: "start"
            },
            {
                defaultToken: "comment.doc"
            }
        ]
    };
};

oop.inherits(PerlHighlightRules, TextHighlightRules);

exports.PerlHighlightRules = PerlHighlightRules;
});

ace.define("ace/mode/matching_brace_outdent",["require","exports","module","ace/range"], function(require, exports, module) {
"use strict";

var Range = require("../range").Range;

var MatchingBraceOutdent = function() {};

(function() {

    this.checkOutdent = function(line, input) {
        if (! /^\s+$/.test(line))
            return false;

        return /^\s*\}/.test(input);
    };

    this.autoOutdent = function(doc, row) {
        var line = doc.getLine(row);
        var match = line.match(/^(\s*\})/);

        if (!match) return 0;

        var column = match[1].length;
        var openBracePos = doc.findMatchingBracket({row: row, column: column});

        if (!openBracePos || openBracePos.row == row) return 0;

        var indent = this.$getIndent(doc.getLine(openBracePos.row));
        doc.replace(new Range(row, 0, row, column-1), indent);
    };

    this.$getIndent = function(line) {
        return line.match(/^\s*/)[0];
    };

}).call(MatchingBraceOutdent.prototype);

exports.MatchingBraceOutdent = MatchingBraceOutdent;
});

ace.define("ace/mode/folding/cstyle",["require","exports","module","ace/lib/oop","ace/range","ace/mode/folding/fold_mode"], function(require, exports, module) {
"use strict";

var oop = require("../../lib/oop");
var Range = require("../../range").Range;
var BaseFoldMode = require("./fold_mode").FoldMode;

var FoldMode = exports.FoldMode = function(commentRegex) {
    if (commentRegex) {
        this.foldingStartMarker = new RegExp(
            this.foldingStartMarker.source.replace(/\|[^|]*?$/, "|" + commentRegex.start)
        );
        this.foldingStopMarker = new RegExp(
            this.foldingStopMarker.source.replace(/\|[^|]*?$/, "|" + commentRegex.end)
        );
    }
};
oop.inherits(FoldMode, BaseFoldMode);

(function() {
    
    this.foldingStartMarker = /([\{\[\(])[^\}\]\)]*$|^\s*(\/\*)/;
    this.foldingStopMarker = /^[^\[\{\(]*([\}\]\)])|^[\s\*]*(\*\/)/;
    this.singleLineBlockCommentRe= /^\s*(\/\*).*\*\/\s*$/;
    this.tripleStarBlockCommentRe = /^\s*(\/\*\*\*).*\*\/\s*$/;
    this.startRegionRe = /^\s*(\/\*|\/\/)#?region\b/;
    this._getFoldWidgetBase = this.getFoldWidget;
    this.getFoldWidget = function(session, foldStyle, row) {
        var line = session.getLine(row);
    
        if (this.singleLineBlockCommentRe.test(line)) {
            if (!this.startRegionRe.test(line) && !this.tripleStarBlockCommentRe.test(line))
                return "";
        }
    
        var fw = this._getFoldWidgetBase(session, foldStyle, row);
    
        if (!fw && this.startRegionRe.test(line))
            return "start"; // lineCommentRegionStart
    
        return fw;
    };

    this.getFoldWidgetRange = function(session, foldStyle, row, forceMultiline) {
        var line = session.getLine(row);
        
        if (this.startRegionRe.test(line))
            return this.getCommentRegionBlock(session, line, row);
        
        var match = line.match(this.foldingStartMarker);
        if (match) {
            var i = match.index;

            if (match[1])
                return this.openingBracketBlock(session, match[1], row, i);
                
            var range = session.getCommentFoldRange(row, i + match[0].length, 1);
            
            if (range && !range.isMultiLine()) {
                if (forceMultiline) {
                    range = this.getSectionRange(session, row);
                } else if (foldStyle != "all")
                    range = null;
            }
            
            return range;
        }

        if (foldStyle === "markbegin")
            return;

        var match = line.match(this.foldingStopMarker);
        if (match) {
            var i = match.index + match[0].length;

            if (match[1])
                return this.closingBracketBlock(session, match[1], row, i);

            return session.getCommentFoldRange(row, i, -1);
        }
    };
    
    this.getSectionRange = function(session, row) {
        var line = session.getLine(row);
        var startIndent = line.search(/\S/);
        var startRow = row;
        var startColumn = line.length;
        row = row + 1;
        var endRow = row;
        var maxRow = session.getLength();
        while (++row < maxRow) {
            line = session.getLine(row);
            var indent = line.search(/\S/);
            if (indent === -1)
                continue;
            if  (startIndent > indent)
                break;
            var subRange = this.getFoldWidgetRange(session, "all", row);
            
            if (subRange) {
                if (subRange.start.row <= startRow) {
                    break;
                } else if (subRange.isMultiLine()) {
                    row = subRange.end.row;
                } else if (startIndent == indent) {
                    break;
                }
            }
            endRow = row;
        }
        
        return new Range(startRow, startColumn, endRow, session.getLine(endRow).length);
    };
    this.getCommentRegionBlock = function(session, line, row) {
        var startColumn = line.search(/\s*$/);
        var maxRow = session.getLength();
        var startRow = row;
        
        var re = /^\s*(?:\/\*|\/\/|--)#?(end)?region\b/;
        var depth = 1;
        while (++row < maxRow) {
            line = session.getLine(row);
            var m = re.exec(line);
            if (!m) continue;
            if (m[1]) depth--;
            else depth++;

            if (!depth) break;
        }

        var endRow = row;
        if (endRow > startRow) {
            return new Range(startRow, startColumn, endRow, line.length);
        }
    };

}).call(FoldMode.prototype);

});

ace.define("ace/mode/perl",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/perl_highlight_rules","ace/mode/matching_brace_outdent","ace/mode/folding/cstyle"], function(require, exports, module) {
"use strict";

var oop = require("../lib/oop");
var TextMode = require("./text").Mode;
var PerlHighlightRules = require("./perl_highlight_rules").PerlHighlightRules;
var MatchingBraceOutdent = require("./matching_brace_outdent").MatchingBraceOutdent;
var CStyleFoldMode = require("./folding/cstyle").FoldMode;

var Mode = function() {
    this.HighlightRules = PerlHighlightRules;
    
    this.$outdent = new MatchingBraceOutdent();
    this.foldingRules = new CStyleFoldMode({start: "^=(begin|item)\\b", end: "^=(cut)\\b"});
    this.$behaviour = this.$defaultBehaviour;
};
oop.inherits(Mode, TextMode);

(function() {

    this.lineCommentStart = "#";
    this.blockComment = [
        {start: "=begin", end: "=cut", lineStartOnly: true},
        {start: "=item", end: "=cut", lineStartOnly: true}
    ];


    this.getNextLineIndent = function(state, line, tab) {
        var indent = this.$getIndent(line);

        var tokenizedLine = this.getTokenizer().getLineTokens(line, state);
        var tokens = tokenizedLine.tokens;

        if (tokens.length && tokens[tokens.length-1].type == "comment") {
            return indent;
        }

        if (state == "start") {
            var match = line.match(/^.*[\{\(\[:]\s*$/);
            if (match) {
                indent += tab;
            }
        }

        return indent;
    };

    this.checkOutdent = function(state, line, input) {
        return this.$outdent.checkOutdent(line, input);
    };

    this.autoOutdent = function(state, doc, row) {
        this.$outdent.autoOutdent(doc, row);
    };

    this.$id = "ace/mode/perl";
}).call(Mode.prototype);

exports.Mode = Mode;
});

!function(a){"use strict";if("function"==typeof define&&define.amd)define(["jquery","moment"],a);else if("object"==typeof exports)module.exports=a(require("jquery"),require("moment"));else{if("undefined"==typeof jQuery)throw"bootstrap-datetimepicker requires jQuery to be loaded first";if("undefined"==typeof moment)throw"bootstrap-datetimepicker requires Moment.js to be loaded first";a(jQuery,moment)}}(function(a,b){"use strict";if(!b)throw new Error("bootstrap-datetimepicker requires Moment.js to be loaded first");var c=function(c,d){var e,f,g,h,i,j,k,l={},m=!0,n=!1,o=!1,p=0,q=[{clsName:"days",navFnc:"M",navStep:1},{clsName:"months",navFnc:"y",navStep:1},{clsName:"years",navFnc:"y",navStep:10},{clsName:"decades",navFnc:"y",navStep:100}],r=["days","months","years","decades"],s=["top","bottom","auto"],t=["left","right","auto"],u=["default","top","bottom"],v={up:38,38:"up",down:40,40:"down",left:37,37:"left",right:39,39:"right",tab:9,9:"tab",escape:27,27:"escape",enter:13,13:"enter",pageUp:33,33:"pageUp",pageDown:34,34:"pageDown",shift:16,16:"shift",control:17,17:"control",space:32,32:"space",t:84,84:"t",delete:46,46:"delete"},w={},x=function(){return void 0!==b.tz&&void 0!==d.timeZone&&null!==d.timeZone&&""!==d.timeZone},y=function(a){var c;return c=void 0===a||null===a?b():b.isDate(a)||b.isMoment(a)?b(a):x()?b.tz(a,j,d.useStrict,d.timeZone):b(a,j,d.useStrict),x()&&c.tz(d.timeZone),c},z=function(a){if("string"!=typeof a||a.length>1)throw new TypeError("isEnabled expects a single character string parameter");switch(a){case"y":return i.indexOf("Y")!==-1;case"M":return i.indexOf("M")!==-1;case"d":return i.toLowerCase().indexOf("d")!==-1;case"h":case"H":return i.toLowerCase().indexOf("h")!==-1;case"m":return i.indexOf("m")!==-1;case"s":return i.indexOf("s")!==-1;default:return!1}},A=function(){return z("h")||z("m")||z("s")},B=function(){return z("y")||z("M")||z("d")},C=function(){var b=a("<thead>").append(a("<tr>").append(a("<th>").addClass("prev").attr("data-action","previous").append(a("<span>").addClass(d.icons.previous))).append(a("<th>").addClass("picker-switch").attr("data-action","pickerSwitch").attr("colspan",d.calendarWeeks?"6":"5")).append(a("<th>").addClass("next").attr("data-action","next").append(a("<span>").addClass(d.icons.next)))),c=a("<tbody>").append(a("<tr>").append(a("<td>").attr("colspan",d.calendarWeeks?"8":"7")));return[a("<div>").addClass("datepicker-days").append(a("<table>").addClass("table-condensed").append(b).append(a("<tbody>"))),a("<div>").addClass("datepicker-months").append(a("<table>").addClass("table-condensed").append(b.clone()).append(c.clone())),a("<div>").addClass("datepicker-years").append(a("<table>").addClass("table-condensed").append(b.clone()).append(c.clone())),a("<div>").addClass("datepicker-decades").append(a("<table>").addClass("table-condensed").append(b.clone()).append(c.clone()))]},D=function(){var b=a("<tr>"),c=a("<tr>"),e=a("<tr>");return z("h")&&(b.append(a("<td>").append(a("<a>").attr({href:"#",tabindex:"-1",title:d.tooltips.incrementHour}).addClass("btn").attr("data-action","incrementHours").append(a("<span>").addClass(d.icons.up)))),c.append(a("<td>").append(a("<span>").addClass("timepicker-hour").attr({"data-time-component":"hours",title:d.tooltips.pickHour}).attr("data-action","showHours"))),e.append(a("<td>").append(a("<a>").attr({href:"#",tabindex:"-1",title:d.tooltips.decrementHour}).addClass("btn").attr("data-action","decrementHours").append(a("<span>").addClass(d.icons.down))))),z("m")&&(z("h")&&(b.append(a("<td>").addClass("separator")),c.append(a("<td>").addClass("separator").html(":")),e.append(a("<td>").addClass("separator"))),b.append(a("<td>").append(a("<a>").attr({href:"#",tabindex:"-1",title:d.tooltips.incrementMinute}).addClass("btn").attr("data-action","incrementMinutes").append(a("<span>").addClass(d.icons.up)))),c.append(a("<td>").append(a("<span>").addClass("timepicker-minute").attr({"data-time-component":"minutes",title:d.tooltips.pickMinute}).attr("data-action","showMinutes"))),e.append(a("<td>").append(a("<a>").attr({href:"#",tabindex:"-1",title:d.tooltips.decrementMinute}).addClass("btn").attr("data-action","decrementMinutes").append(a("<span>").addClass(d.icons.down))))),z("s")&&(z("m")&&(b.append(a("<td>").addClass("separator")),c.append(a("<td>").addClass("separator").html(":")),e.append(a("<td>").addClass("separator"))),b.append(a("<td>").append(a("<a>").attr({href:"#",tabindex:"-1",title:d.tooltips.incrementSecond}).addClass("btn").attr("data-action","incrementSeconds").append(a("<span>").addClass(d.icons.up)))),c.append(a("<td>").append(a("<span>").addClass("timepicker-second").attr({"data-time-component":"seconds",title:d.tooltips.pickSecond}).attr("data-action","showSeconds"))),e.append(a("<td>").append(a("<a>").attr({href:"#",tabindex:"-1",title:d.tooltips.decrementSecond}).addClass("btn").attr("data-action","decrementSeconds").append(a("<span>").addClass(d.icons.down))))),h||(b.append(a("<td>").addClass("separator")),c.append(a("<td>").append(a("<button>").addClass("btn btn-primary").attr({"data-action":"togglePeriod",tabindex:"-1",title:d.tooltips.togglePeriod}))),e.append(a("<td>").addClass("separator"))),a("<div>").addClass("timepicker-picker").append(a("<table>").addClass("table-condensed").append([b,c,e]))},E=function(){var b=a("<div>").addClass("timepicker-hours").append(a("<table>").addClass("table-condensed")),c=a("<div>").addClass("timepicker-minutes").append(a("<table>").addClass("table-condensed")),d=a("<div>").addClass("timepicker-seconds").append(a("<table>").addClass("table-condensed")),e=[D()];return z("h")&&e.push(b),z("m")&&e.push(c),z("s")&&e.push(d),e},F=function(){var b=[];return d.showTodayButton&&b.push(a("<td>").append(a("<a>").attr({"data-action":"today",title:d.tooltips.today}).append(a("<span>").addClass(d.icons.today)))),!d.sideBySide&&B()&&A()&&b.push(a("<td>").append(a("<a>").attr({"data-action":"togglePicker",title:d.tooltips.selectTime}).append(a("<span>").addClass(d.icons.time)))),d.showClear&&b.push(a("<td>").append(a("<a>").attr({"data-action":"clear",title:d.tooltips.clear}).append(a("<span>").addClass(d.icons.clear)))),d.showClose&&b.push(a("<td>").append(a("<a>").attr({"data-action":"close",title:d.tooltips.close}).append(a("<span>").addClass(d.icons.close)))),a("<table>").addClass("table-condensed").append(a("<tbody>").append(a("<tr>").append(b)))},G=function(){var b=a("<div>").addClass("bootstrap-datetimepicker-widget dropdown-menu"),c=a("<div>").addClass("datepicker").append(C()),e=a("<div>").addClass("timepicker").append(E()),f=a("<ul>").addClass("list-unstyled"),g=a("<li>").addClass("picker-switch"+(d.collapse?" accordion-toggle":"")).append(F());return d.inline&&b.removeClass("dropdown-menu"),h&&b.addClass("usetwentyfour"),z("s")&&!h&&b.addClass("wider"),d.sideBySide&&B()&&A()?(b.addClass("timepicker-sbs"),"top"===d.toolbarPlacement&&b.append(g),b.append(a("<div>").addClass("row").append(c.addClass("col-md-6")).append(e.addClass("col-md-6"))),"bottom"===d.toolbarPlacement&&b.append(g),b):("top"===d.toolbarPlacement&&f.append(g),B()&&f.append(a("<li>").addClass(d.collapse&&A()?"collapse in":"").append(c)),"default"===d.toolbarPlacement&&f.append(g),A()&&f.append(a("<li>").addClass(d.collapse&&B()?"collapse":"").append(e)),"bottom"===d.toolbarPlacement&&f.append(g),b.append(f))},H=function(){var b,e={};return b=c.is("input")||d.inline?c.data():c.find("input").data(),b.dateOptions&&b.dateOptions instanceof Object&&(e=a.extend(!0,e,b.dateOptions)),a.each(d,function(a){var c="date"+a.charAt(0).toUpperCase()+a.slice(1);void 0!==b[c]&&(e[a]=b[c])}),e},I=function(){var b,e=(n||c).position(),f=(n||c).offset(),g=d.widgetPositioning.vertical,h=d.widgetPositioning.horizontal;if(d.widgetParent)b=d.widgetParent.append(o);else if(c.is("input"))b=c.after(o).parent();else{if(d.inline)return void(b=c.append(o));b=c,c.children().first().after(o)}if("auto"===g&&(g=f.top+1.5*o.height()>=a(window).height()+a(window).scrollTop()&&o.height()+c.outerHeight()<f.top?"top":"bottom"),"auto"===h&&(h=b.width()<f.left+o.outerWidth()/2&&f.left+o.outerWidth()>a(window).width()?"right":"left"),"top"===g?o.addClass("top").removeClass("bottom"):o.addClass("bottom").removeClass("top"),"right"===h?o.addClass("pull-right"):o.removeClass("pull-right"),"static"===b.css("position")&&(b=b.parents().filter(function(){return"static"!==a(this).css("position")}).first()),0===b.length)throw new Error("datetimepicker component should be placed within a non-static positioned container");o.css({top:"top"===g?"auto":e.top+c.outerHeight(),bottom:"top"===g?b.outerHeight()-(b===c?0:e.top):"auto",left:"left"===h?b===c?0:e.left:"auto",right:"left"===h?"auto":b.outerWidth()-c.outerWidth()-(b===c?0:e.left)})},J=function(a){"dp.change"===a.type&&(a.date&&a.date.isSame(a.oldDate)||!a.date&&!a.oldDate)||c.trigger(a)},K=function(a){"y"===a&&(a="YYYY"),J({type:"dp.update",change:a,viewDate:f.clone()})},L=function(a){o&&(a&&(k=Math.max(p,Math.min(3,k+a))),o.find(".datepicker > div").hide().filter(".datepicker-"+q[k].clsName).show())},M=function(){var b=a("<tr>"),c=f.clone().startOf("w").startOf("d");for(d.calendarWeeks===!0&&b.append(a("<th>").addClass("cw").text("#"));c.isBefore(f.clone().endOf("w"));)b.append(a("<th>").addClass("dow").text(c.format("dd"))),c.add(1,"d");o.find(".datepicker-days thead").append(b)},N=function(a){return d.disabledDates[a.format("YYYY-MM-DD")]===!0},O=function(a){return d.enabledDates[a.format("YYYY-MM-DD")]===!0},P=function(a){return d.disabledHours[a.format("H")]===!0},Q=function(a){return d.enabledHours[a.format("H")]===!0},R=function(b,c){if(!b.isValid())return!1;if(d.disabledDates&&"d"===c&&N(b))return!1;if(d.enabledDates&&"d"===c&&!O(b))return!1;if(d.minDate&&b.isBefore(d.minDate,c))return!1;if(d.maxDate&&b.isAfter(d.maxDate,c))return!1;if(d.daysOfWeekDisabled&&"d"===c&&d.daysOfWeekDisabled.indexOf(b.day())!==-1)return!1;if(d.disabledHours&&("h"===c||"m"===c||"s"===c)&&P(b))return!1;if(d.enabledHours&&("h"===c||"m"===c||"s"===c)&&!Q(b))return!1;if(d.disabledTimeIntervals&&("h"===c||"m"===c||"s"===c)){var e=!1;if(a.each(d.disabledTimeIntervals,function(){if(b.isBetween(this[0],this[1]))return e=!0,!1}),e)return!1}return!0},S=function(){for(var b=[],c=f.clone().startOf("y").startOf("d");c.isSame(f,"y");)b.push(a("<span>").attr("data-action","selectMonth").addClass("month").text(c.format("MMM"))),c.add(1,"M");o.find(".datepicker-months td").empty().append(b)},T=function(){var b=o.find(".datepicker-months"),c=b.find("th"),g=b.find("tbody").find("span");c.eq(0).find("span").attr("title",d.tooltips.prevYear),c.eq(1).attr("title",d.tooltips.selectYear),c.eq(2).find("span").attr("title",d.tooltips.nextYear),b.find(".disabled").removeClass("disabled"),R(f.clone().subtract(1,"y"),"y")||c.eq(0).addClass("disabled"),c.eq(1).text(f.year()),R(f.clone().add(1,"y"),"y")||c.eq(2).addClass("disabled"),g.removeClass("active"),e.isSame(f,"y")&&!m&&g.eq(e.month()).addClass("active"),g.each(function(b){R(f.clone().month(b),"M")||a(this).addClass("disabled")})},U=function(){var a=o.find(".datepicker-years"),b=a.find("th"),c=f.clone().subtract(5,"y"),g=f.clone().add(6,"y"),h="";for(b.eq(0).find("span").attr("title",d.tooltips.prevDecade),b.eq(1).attr("title",d.tooltips.selectDecade),b.eq(2).find("span").attr("title",d.tooltips.nextDecade),a.find(".disabled").removeClass("disabled"),d.minDate&&d.minDate.isAfter(c,"y")&&b.eq(0).addClass("disabled"),b.eq(1).text(c.year()+"-"+g.year()),d.maxDate&&d.maxDate.isBefore(g,"y")&&b.eq(2).addClass("disabled");!c.isAfter(g,"y");)h+='<span data-action="selectYear" class="year'+(c.isSame(e,"y")&&!m?" active":"")+(R(c,"y")?"":" disabled")+'">'+c.year()+"</span>",c.add(1,"y");a.find("td").html(h)},V=function(){var a,c=o.find(".datepicker-decades"),g=c.find("th"),h=b({y:f.year()-f.year()%100-1}),i=h.clone().add(100,"y"),j=h.clone(),k=!1,l=!1,m="";for(g.eq(0).find("span").attr("title",d.tooltips.prevCentury),g.eq(2).find("span").attr("title",d.tooltips.nextCentury),c.find(".disabled").removeClass("disabled"),(h.isSame(b({y:1900}))||d.minDate&&d.minDate.isAfter(h,"y"))&&g.eq(0).addClass("disabled"),g.eq(1).text(h.year()+"-"+i.year()),(h.isSame(b({y:2e3}))||d.maxDate&&d.maxDate.isBefore(i,"y"))&&g.eq(2).addClass("disabled");!h.isAfter(i,"y");)a=h.year()+12,k=d.minDate&&d.minDate.isAfter(h,"y")&&d.minDate.year()<=a,l=d.maxDate&&d.maxDate.isAfter(h,"y")&&d.maxDate.year()<=a,m+='<span data-action="selectDecade" class="decade'+(e.isAfter(h)&&e.year()<=a?" active":"")+(R(h,"y")||k||l?"":" disabled")+'" data-selection="'+(h.year()+6)+'">'+(h.year()+1)+" - "+(h.year()+12)+"</span>",h.add(12,"y");m+="<span></span><span></span><span></span>",c.find("td").html(m),g.eq(1).text(j.year()+1+"-"+h.year())},W=function(){var b,c,g,h=o.find(".datepicker-days"),i=h.find("th"),j=[],k=[];if(B()){for(i.eq(0).find("span").attr("title",d.tooltips.prevMonth),i.eq(1).attr("title",d.tooltips.selectMonth),i.eq(2).find("span").attr("title",d.tooltips.nextMonth),h.find(".disabled").removeClass("disabled"),i.eq(1).text(f.format(d.dayViewHeaderFormat)),R(f.clone().subtract(1,"M"),"M")||i.eq(0).addClass("disabled"),R(f.clone().add(1,"M"),"M")||i.eq(2).addClass("disabled"),b=f.clone().startOf("M").startOf("w").startOf("d"),g=0;g<42;g++)0===b.weekday()&&(c=a("<tr>"),d.calendarWeeks&&c.append('<td class="cw">'+b.week()+"</td>"),j.push(c)),k=["day"],b.isBefore(f,"M")&&k.push("old"),b.isAfter(f,"M")&&k.push("new"),b.isSame(e,"d")&&!m&&k.push("active"),R(b,"d")||k.push("disabled"),b.isSame(y(),"d")&&k.push("today"),0!==b.day()&&6!==b.day()||k.push("weekend"),J({type:"dp.classify",date:b,classNames:k}),c.append('<td data-action="selectDay" data-day="'+b.format("L")+'" class="'+k.join(" ")+'">'+b.date()+"</td>"),b.add(1,"d");h.find("tbody").empty().append(j),T(),U(),V()}},X=function(){var b=o.find(".timepicker-hours table"),c=f.clone().startOf("d"),d=[],e=a("<tr>");for(f.hour()>11&&!h&&c.hour(12);c.isSame(f,"d")&&(h||f.hour()<12&&c.hour()<12||f.hour()>11);)c.hour()%4===0&&(e=a("<tr>"),d.push(e)),e.append('<td data-action="selectHour" class="hour'+(R(c,"h")?"":" disabled")+'">'+c.format(h?"HH":"hh")+"</td>"),c.add(1,"h");b.empty().append(d)},Y=function(){for(var b=o.find(".timepicker-minutes table"),c=f.clone().startOf("h"),e=[],g=a("<tr>"),h=1===d.stepping?5:d.stepping;f.isSame(c,"h");)c.minute()%(4*h)===0&&(g=a("<tr>"),e.push(g)),g.append('<td data-action="selectMinute" class="minute'+(R(c,"m")?"":" disabled")+'">'+c.format("mm")+"</td>"),c.add(h,"m");b.empty().append(e)},Z=function(){for(var b=o.find(".timepicker-seconds table"),c=f.clone().startOf("m"),d=[],e=a("<tr>");f.isSame(c,"m");)c.second()%20===0&&(e=a("<tr>"),d.push(e)),e.append('<td data-action="selectSecond" class="second'+(R(c,"s")?"":" disabled")+'">'+c.format("ss")+"</td>"),c.add(5,"s");b.empty().append(d)},$=function(){var a,b,c=o.find(".timepicker span[data-time-component]");h||(a=o.find(".timepicker [data-action=togglePeriod]"),b=e.clone().add(e.hours()>=12?-12:12,"h"),a.text(e.format("A")),R(b,"h")?a.removeClass("disabled"):a.addClass("disabled")),c.filter("[data-time-component=hours]").text(e.format(h?"HH":"hh")),c.filter("[data-time-component=minutes]").text(e.format("mm")),c.filter("[data-time-component=seconds]").text(e.format("ss")),X(),Y(),Z()},_=function(){o&&(W(),$())},aa=function(a){var b=m?null:e;if(!a)return m=!0,g.val(""),c.data("date",""),J({type:"dp.change",date:!1,oldDate:b}),void _();if(a=a.clone().locale(d.locale),x()&&a.tz(d.timeZone),1!==d.stepping)for(a.minutes(Math.round(a.minutes()/d.stepping)*d.stepping).seconds(0);d.minDate&&a.isBefore(d.minDate);)a.add(d.stepping,"minutes");R(a)?(e=a,f=e.clone(),g.val(e.format(i)),c.data("date",e.format(i)),m=!1,_(),J({type:"dp.change",date:e.clone(),oldDate:b})):(d.keepInvalid?J({type:"dp.change",date:a,oldDate:b}):g.val(m?"":e.format(i)),J({type:"dp.error",date:a,oldDate:b}))},ba=function(){var b=!1;return o?(o.find(".collapse").each(function(){var c=a(this).data("collapse");return!c||!c.transitioning||(b=!0,!1)}),b?l:(n&&n.hasClass("btn")&&n.toggleClass("active"),o.hide(),a(window).off("resize",I),o.off("click","[data-action]"),o.off("mousedown",!1),o.remove(),o=!1,J({type:"dp.hide",date:e.clone()}),g.blur(),f=e.clone(),l)):l},ca=function(){aa(null)},da=function(a){return void 0===d.parseInputDate?(!b.isMoment(a)||a instanceof Date)&&(a=y(a)):a=d.parseInputDate(a),a},ea={next:function(){var a=q[k].navFnc;f.add(q[k].navStep,a),W(),K(a)},previous:function(){var a=q[k].navFnc;f.subtract(q[k].navStep,a),W(),K(a)},pickerSwitch:function(){L(1)},selectMonth:function(b){var c=a(b.target).closest("tbody").find("span").index(a(b.target));f.month(c),k===p?(aa(e.clone().year(f.year()).month(f.month())),d.inline||ba()):(L(-1),W()),K("M")},selectYear:function(b){var c=parseInt(a(b.target).text(),10)||0;f.year(c),k===p?(aa(e.clone().year(f.year())),d.inline||ba()):(L(-1),W()),K("YYYY")},selectDecade:function(b){var c=parseInt(a(b.target).data("selection"),10)||0;f.year(c),k===p?(aa(e.clone().year(f.year())),d.inline||ba()):(L(-1),W()),K("YYYY")},selectDay:function(b){var c=f.clone();a(b.target).is(".old")&&c.subtract(1,"M"),a(b.target).is(".new")&&c.add(1,"M"),aa(c.date(parseInt(a(b.target).text(),10))),A()||d.keepOpen||d.inline||ba()},incrementHours:function(){var a=e.clone().add(1,"h");R(a,"h")&&aa(a)},incrementMinutes:function(){var a=e.clone().add(d.stepping,"m");R(a,"m")&&aa(a)},incrementSeconds:function(){var a=e.clone().add(1,"s");R(a,"s")&&aa(a)},decrementHours:function(){var a=e.clone().subtract(1,"h");R(a,"h")&&aa(a)},decrementMinutes:function(){var a=e.clone().subtract(d.stepping,"m");R(a,"m")&&aa(a)},decrementSeconds:function(){var a=e.clone().subtract(1,"s");R(a,"s")&&aa(a)},togglePeriod:function(){aa(e.clone().add(e.hours()>=12?-12:12,"h"))},togglePicker:function(b){var c,e=a(b.target),f=e.closest("ul"),g=f.find(".in"),h=f.find(".collapse:not(.in)");if(g&&g.length){if(c=g.data("collapse"),c&&c.transitioning)return;g.collapse?(g.collapse("hide"),h.collapse("show")):(g.removeClass("in"),h.addClass("in")),e.is("span")?e.toggleClass(d.icons.time+" "+d.icons.date):e.find("span").toggleClass(d.icons.time+" "+d.icons.date)}},showPicker:function(){o.find(".timepicker > div:not(.timepicker-picker)").hide(),o.find(".timepicker .timepicker-picker").show()},showHours:function(){o.find(".timepicker .timepicker-picker").hide(),o.find(".timepicker .timepicker-hours").show()},showMinutes:function(){o.find(".timepicker .timepicker-picker").hide(),o.find(".timepicker .timepicker-minutes").show()},showSeconds:function(){o.find(".timepicker .timepicker-picker").hide(),o.find(".timepicker .timepicker-seconds").show()},selectHour:function(b){var c=parseInt(a(b.target).text(),10);h||(e.hours()>=12?12!==c&&(c+=12):12===c&&(c=0)),aa(e.clone().hours(c)),ea.showPicker.call(l)},selectMinute:function(b){aa(e.clone().minutes(parseInt(a(b.target).text(),10))),ea.showPicker.call(l)},selectSecond:function(b){aa(e.clone().seconds(parseInt(a(b.target).text(),10))),ea.showPicker.call(l)},clear:ca,today:function(){var a=y();R(a,"d")&&aa(a)},close:ba},fa=function(b){return!a(b.currentTarget).is(".disabled")&&(ea[a(b.currentTarget).data("action")].apply(l,arguments),!1)},ga=function(){var b,c={year:function(a){return a.month(0).date(1).hours(0).seconds(0).minutes(0)},month:function(a){return a.date(1).hours(0).seconds(0).minutes(0)},day:function(a){return a.hours(0).seconds(0).minutes(0)},hour:function(a){return a.seconds(0).minutes(0)},minute:function(a){return a.seconds(0)}};return g.prop("disabled")||!d.ignoreReadonly&&g.prop("readonly")||o?l:(void 0!==g.val()&&0!==g.val().trim().length?aa(da(g.val().trim())):m&&d.useCurrent&&(d.inline||g.is("input")&&0===g.val().trim().length)&&(b=y(),"string"==typeof d.useCurrent&&(b=c[d.useCurrent](b)),aa(b)),o=G(),M(),S(),o.find(".timepicker-hours").hide(),o.find(".timepicker-minutes").hide(),o.find(".timepicker-seconds").hide(),_(),L(),a(window).on("resize",I),o.on("click","[data-action]",fa),o.on("mousedown",!1),n&&n.hasClass("btn")&&n.toggleClass("active"),I(),o.show(),d.focusOnShow&&!g.is(":focus")&&g.focus(),J({type:"dp.show"}),l)},ha=function(){return o?ba():ga()},ia=function(a){var b,c,e,f,g=null,h=[],i={},j=a.which,k="p";w[j]=k;for(b in w)w.hasOwnProperty(b)&&w[b]===k&&(h.push(b),parseInt(b,10)!==j&&(i[b]=!0));for(b in d.keyBinds)if(d.keyBinds.hasOwnProperty(b)&&"function"==typeof d.keyBinds[b]&&(e=b.split(" "),e.length===h.length&&v[j]===e[e.length-1])){for(f=!0,c=e.length-2;c>=0;c--)if(!(v[e[c]]in i)){f=!1;break}if(f){g=d.keyBinds[b];break}}g&&(g.call(l,o),a.stopPropagation(),a.preventDefault())},ja=function(a){w[a.which]="r",a.stopPropagation(),a.preventDefault()},ka=function(b){var c=a(b.target).val().trim(),d=c?da(c):null;return aa(d),b.stopImmediatePropagation(),!1},la=function(){g.on({change:ka,blur:d.debug?"":ba,keydown:ia,keyup:ja,focus:d.allowInputToggle?ga:""}),c.is("input")?g.on({focus:ga}):n&&(n.on("click",ha),n.on("mousedown",!1))},ma=function(){g.off({change:ka,blur:blur,keydown:ia,keyup:ja,focus:d.allowInputToggle?ba:""}),c.is("input")?g.off({focus:ga}):n&&(n.off("click",ha),n.off("mousedown",!1))},na=function(b){var c={};return a.each(b,function(){var a=da(this);a.isValid()&&(c[a.format("YYYY-MM-DD")]=!0)}),!!Object.keys(c).length&&c},oa=function(b){var c={};return a.each(b,function(){c[this]=!0}),!!Object.keys(c).length&&c},pa=function(){var a=d.format||"L LT";i=a.replace(/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,function(a){var b=e.localeData().longDateFormat(a)||a;return b.replace(/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,function(a){return e.localeData().longDateFormat(a)||a})}),j=d.extraFormats?d.extraFormats.slice():[],j.indexOf(a)<0&&j.indexOf(i)<0&&j.push(i),h=i.toLowerCase().indexOf("a")<1&&i.replace(/\[.*?\]/g,"").indexOf("h")<1,z("y")&&(p=2),z("M")&&(p=1),z("d")&&(p=0),k=Math.max(p,k),m||aa(e)};if(l.destroy=function(){ba(),ma(),c.removeData("DateTimePicker"),c.removeData("date")},l.toggle=ha,l.show=ga,l.hide=ba,l.disable=function(){return ba(),n&&n.hasClass("btn")&&n.addClass("disabled"),g.prop("disabled",!0),l},l.enable=function(){return n&&n.hasClass("btn")&&n.removeClass("disabled"),g.prop("disabled",!1),l},l.ignoreReadonly=function(a){if(0===arguments.length)return d.ignoreReadonly;if("boolean"!=typeof a)throw new TypeError("ignoreReadonly () expects a boolean parameter");return d.ignoreReadonly=a,l},l.options=function(b){if(0===arguments.length)return a.extend(!0,{},d);if(!(b instanceof Object))throw new TypeError("options() options parameter should be an object");return a.extend(!0,d,b),a.each(d,function(a,b){if(void 0===l[a])throw new TypeError("option "+a+" is not recognized!");l[a](b)}),l},l.date=function(a){if(0===arguments.length)return m?null:e.clone();if(!(null===a||"string"==typeof a||b.isMoment(a)||a instanceof Date))throw new TypeError("date() parameter must be one of [null, string, moment or Date]");return aa(null===a?null:da(a)),l},l.format=function(a){if(0===arguments.length)return d.format;if("string"!=typeof a&&("boolean"!=typeof a||a!==!1))throw new TypeError("format() expects a string or boolean:false parameter "+a);return d.format=a,i&&pa(),l},l.timeZone=function(a){if(0===arguments.length)return d.timeZone;if("string"!=typeof a)throw new TypeError("newZone() expects a string parameter");return d.timeZone=a,l},l.dayViewHeaderFormat=function(a){if(0===arguments.length)return d.dayViewHeaderFormat;if("string"!=typeof a)throw new TypeError("dayViewHeaderFormat() expects a string parameter");return d.dayViewHeaderFormat=a,l},l.extraFormats=function(a){if(0===arguments.length)return d.extraFormats;if(a!==!1&&!(a instanceof Array))throw new TypeError("extraFormats() expects an array or false parameter");return d.extraFormats=a,j&&pa(),l},l.disabledDates=function(b){if(0===arguments.length)return d.disabledDates?a.extend({},d.disabledDates):d.disabledDates;if(!b)return d.disabledDates=!1,_(),l;if(!(b instanceof Array))throw new TypeError("disabledDates() expects an array parameter");return d.disabledDates=na(b),d.enabledDates=!1,_(),l},l.enabledDates=function(b){if(0===arguments.length)return d.enabledDates?a.extend({},d.enabledDates):d.enabledDates;if(!b)return d.enabledDates=!1,_(),l;if(!(b instanceof Array))throw new TypeError("enabledDates() expects an array parameter");return d.enabledDates=na(b),d.disabledDates=!1,_(),l},l.daysOfWeekDisabled=function(a){if(0===arguments.length)return d.daysOfWeekDisabled.splice(0);if("boolean"==typeof a&&!a)return d.daysOfWeekDisabled=!1,_(),l;if(!(a instanceof Array))throw new TypeError("daysOfWeekDisabled() expects an array parameter");if(d.daysOfWeekDisabled=a.reduce(function(a,b){return b=parseInt(b,10),b>6||b<0||isNaN(b)?a:(a.indexOf(b)===-1&&a.push(b),a)},[]).sort(),d.useCurrent&&!d.keepInvalid){for(var b=0;!R(e,"d");){if(e.add(1,"d"),31===b)throw"Tried 31 times to find a valid date";b++}aa(e)}return _(),l},l.maxDate=function(a){if(0===arguments.length)return d.maxDate?d.maxDate.clone():d.maxDate;if("boolean"==typeof a&&a===!1)return d.maxDate=!1,_(),l;"string"==typeof a&&("now"!==a&&"moment"!==a||(a=y()));var b=da(a);if(!b.isValid())throw new TypeError("maxDate() Could not parse date parameter: "+a);if(d.minDate&&b.isBefore(d.minDate))throw new TypeError("maxDate() date parameter is before options.minDate: "+b.format(i));return d.maxDate=b,d.useCurrent&&!d.keepInvalid&&e.isAfter(a)&&aa(d.maxDate),f.isAfter(b)&&(f=b.clone().subtract(d.stepping,"m")),_(),l},l.minDate=function(a){if(0===arguments.length)return d.minDate?d.minDate.clone():d.minDate;if("boolean"==typeof a&&a===!1)return d.minDate=!1,_(),l;"string"==typeof a&&("now"!==a&&"moment"!==a||(a=y()));var b=da(a);if(!b.isValid())throw new TypeError("minDate() Could not parse date parameter: "+a);if(d.maxDate&&b.isAfter(d.maxDate))throw new TypeError("minDate() date parameter is after options.maxDate: "+b.format(i));return d.minDate=b,d.useCurrent&&!d.keepInvalid&&e.isBefore(a)&&aa(d.minDate),f.isBefore(b)&&(f=b.clone().add(d.stepping,"m")),_(),l},l.defaultDate=function(a){if(0===arguments.length)return d.defaultDate?d.defaultDate.clone():d.defaultDate;if(!a)return d.defaultDate=!1,l;"string"==typeof a&&(a="now"===a||"moment"===a?y():y(a));var b=da(a);if(!b.isValid())throw new TypeError("defaultDate() Could not parse date parameter: "+a);if(!R(b))throw new TypeError("defaultDate() date passed is invalid according to component setup validations");return d.defaultDate=b,(d.defaultDate&&d.inline||""===g.val().trim())&&aa(d.defaultDate),l},l.locale=function(a){if(0===arguments.length)return d.locale;if(!b.localeData(a))throw new TypeError("locale() locale "+a+" is not loaded from moment locales!");return d.locale=a,e.locale(d.locale),f.locale(d.locale),i&&pa(),o&&(ba(),ga()),l},l.stepping=function(a){return 0===arguments.length?d.stepping:(a=parseInt(a,10),(isNaN(a)||a<1)&&(a=1),d.stepping=a,l)},l.useCurrent=function(a){var b=["year","month","day","hour","minute"];if(0===arguments.length)return d.useCurrent;if("boolean"!=typeof a&&"string"!=typeof a)throw new TypeError("useCurrent() expects a boolean or string parameter");if("string"==typeof a&&b.indexOf(a.toLowerCase())===-1)throw new TypeError("useCurrent() expects a string parameter of "+b.join(", "));return d.useCurrent=a,l},l.collapse=function(a){if(0===arguments.length)return d.collapse;if("boolean"!=typeof a)throw new TypeError("collapse() expects a boolean parameter");return d.collapse===a?l:(d.collapse=a,o&&(ba(),ga()),l)},l.icons=function(b){if(0===arguments.length)return a.extend({},d.icons);if(!(b instanceof Object))throw new TypeError("icons() expects parameter to be an Object");return a.extend(d.icons,b),o&&(ba(),ga()),l},l.tooltips=function(b){if(0===arguments.length)return a.extend({},d.tooltips);if(!(b instanceof Object))throw new TypeError("tooltips() expects parameter to be an Object");return a.extend(d.tooltips,b),o&&(ba(),ga()),l},l.useStrict=function(a){if(0===arguments.length)return d.useStrict;if("boolean"!=typeof a)throw new TypeError("useStrict() expects a boolean parameter");return d.useStrict=a,l},l.sideBySide=function(a){if(0===arguments.length)return d.sideBySide;if("boolean"!=typeof a)throw new TypeError("sideBySide() expects a boolean parameter");return d.sideBySide=a,o&&(ba(),ga()),l},l.viewMode=function(a){if(0===arguments.length)return d.viewMode;if("string"!=typeof a)throw new TypeError("viewMode() expects a string parameter");if(r.indexOf(a)===-1)throw new TypeError("viewMode() parameter must be one of ("+r.join(", ")+") value");return d.viewMode=a,k=Math.max(r.indexOf(a),p),L(),l},l.toolbarPlacement=function(a){if(0===arguments.length)return d.toolbarPlacement;if("string"!=typeof a)throw new TypeError("toolbarPlacement() expects a string parameter");if(u.indexOf(a)===-1)throw new TypeError("toolbarPlacement() parameter must be one of ("+u.join(", ")+") value");return d.toolbarPlacement=a,o&&(ba(),ga()),l},l.widgetPositioning=function(b){if(0===arguments.length)return a.extend({},d.widgetPositioning);if("[object Object]"!=={}.toString.call(b))throw new TypeError("widgetPositioning() expects an object variable");if(b.horizontal){if("string"!=typeof b.horizontal)throw new TypeError("widgetPositioning() horizontal variable must be a string");if(b.horizontal=b.horizontal.toLowerCase(),t.indexOf(b.horizontal)===-1)throw new TypeError("widgetPositioning() expects horizontal parameter to be one of ("+t.join(", ")+")");d.widgetPositioning.horizontal=b.horizontal}if(b.vertical){if("string"!=typeof b.vertical)throw new TypeError("widgetPositioning() vertical variable must be a string");if(b.vertical=b.vertical.toLowerCase(),s.indexOf(b.vertical)===-1)throw new TypeError("widgetPositioning() expects vertical parameter to be one of ("+s.join(", ")+")");d.widgetPositioning.vertical=b.vertical}return _(),l},l.calendarWeeks=function(a){if(0===arguments.length)return d.calendarWeeks;if("boolean"!=typeof a)throw new TypeError("calendarWeeks() expects parameter to be a boolean value");return d.calendarWeeks=a,_(),l},l.showTodayButton=function(a){if(0===arguments.length)return d.showTodayButton;if("boolean"!=typeof a)throw new TypeError("showTodayButton() expects a boolean parameter");return d.showTodayButton=a,o&&(ba(),ga()),l},l.showClear=function(a){if(0===arguments.length)return d.showClear;if("boolean"!=typeof a)throw new TypeError("showClear() expects a boolean parameter");return d.showClear=a,o&&(ba(),ga()),l},l.widgetParent=function(b){if(0===arguments.length)return d.widgetParent;if("string"==typeof b&&(b=a(b)),null!==b&&"string"!=typeof b&&!(b instanceof a))throw new TypeError("widgetParent() expects a string or a jQuery object parameter");return d.widgetParent=b,o&&(ba(),ga()),l},l.keepOpen=function(a){if(0===arguments.length)return d.keepOpen;if("boolean"!=typeof a)throw new TypeError("keepOpen() expects a boolean parameter");return d.keepOpen=a,l},l.focusOnShow=function(a){if(0===arguments.length)return d.focusOnShow;if("boolean"!=typeof a)throw new TypeError("focusOnShow() expects a boolean parameter");return d.focusOnShow=a,l},l.inline=function(a){if(0===arguments.length)return d.inline;if("boolean"!=typeof a)throw new TypeError("inline() expects a boolean parameter");return d.inline=a,l},l.clear=function(){return ca(),l},l.keyBinds=function(a){return 0===arguments.length?d.keyBinds:(d.keyBinds=a,l)},l.getMoment=function(a){return y(a)},l.debug=function(a){if("boolean"!=typeof a)throw new TypeError("debug() expects a boolean parameter");return d.debug=a,l},l.allowInputToggle=function(a){if(0===arguments.length)return d.allowInputToggle;if("boolean"!=typeof a)throw new TypeError("allowInputToggle() expects a boolean parameter");return d.allowInputToggle=a,l},l.showClose=function(a){if(0===arguments.length)return d.showClose;if("boolean"!=typeof a)throw new TypeError("showClose() expects a boolean parameter");return d.showClose=a,l},l.keepInvalid=function(a){if(0===arguments.length)return d.keepInvalid;if("boolean"!=typeof a)throw new TypeError("keepInvalid() expects a boolean parameter");
return d.keepInvalid=a,l},l.datepickerInput=function(a){if(0===arguments.length)return d.datepickerInput;if("string"!=typeof a)throw new TypeError("datepickerInput() expects a string parameter");return d.datepickerInput=a,l},l.parseInputDate=function(a){if(0===arguments.length)return d.parseInputDate;if("function"!=typeof a)throw new TypeError("parseInputDate() sholud be as function");return d.parseInputDate=a,l},l.disabledTimeIntervals=function(b){if(0===arguments.length)return d.disabledTimeIntervals?a.extend({},d.disabledTimeIntervals):d.disabledTimeIntervals;if(!b)return d.disabledTimeIntervals=!1,_(),l;if(!(b instanceof Array))throw new TypeError("disabledTimeIntervals() expects an array parameter");return d.disabledTimeIntervals=b,_(),l},l.disabledHours=function(b){if(0===arguments.length)return d.disabledHours?a.extend({},d.disabledHours):d.disabledHours;if(!b)return d.disabledHours=!1,_(),l;if(!(b instanceof Array))throw new TypeError("disabledHours() expects an array parameter");if(d.disabledHours=oa(b),d.enabledHours=!1,d.useCurrent&&!d.keepInvalid){for(var c=0;!R(e,"h");){if(e.add(1,"h"),24===c)throw"Tried 24 times to find a valid date";c++}aa(e)}return _(),l},l.enabledHours=function(b){if(0===arguments.length)return d.enabledHours?a.extend({},d.enabledHours):d.enabledHours;if(!b)return d.enabledHours=!1,_(),l;if(!(b instanceof Array))throw new TypeError("enabledHours() expects an array parameter");if(d.enabledHours=oa(b),d.disabledHours=!1,d.useCurrent&&!d.keepInvalid){for(var c=0;!R(e,"h");){if(e.add(1,"h"),24===c)throw"Tried 24 times to find a valid date";c++}aa(e)}return _(),l},l.viewDate=function(a){if(0===arguments.length)return f.clone();if(!a)return f=e.clone(),l;if(!("string"==typeof a||b.isMoment(a)||a instanceof Date))throw new TypeError("viewDate() parameter must be one of [string, moment or Date]");return f=da(a),K(),l},c.is("input"))g=c;else if(g=c.find(d.datepickerInput),0===g.length)g=c.find("input");else if(!g.is("input"))throw new Error('CSS class "'+d.datepickerInput+'" cannot be applied to non input element');if(c.hasClass("input-group")&&(n=0===c.find(".datepickerbutton").length?c.find(".input-group-addon"):c.find(".datepickerbutton")),!d.inline&&!g.is("input"))throw new Error("Could not initialize DateTimePicker without an input element");return e=y(),f=e.clone(),a.extend(!0,d,H()),l.options(d),pa(),la(),g.prop("disabled")&&l.disable(),g.is("input")&&0!==g.val().trim().length?aa(da(g.val().trim())):d.defaultDate&&void 0===g.attr("placeholder")&&aa(d.defaultDate),d.inline&&ga(),l};return a.fn.datetimepicker=function(b){b=b||{};var d,e=Array.prototype.slice.call(arguments,1),f=!0,g=["destroy","hide","show","toggle"];if("object"==typeof b)return this.each(function(){var d,e=a(this);e.data("DateTimePicker")||(d=a.extend(!0,{},a.fn.datetimepicker.defaults,b),e.data("DateTimePicker",c(e,d)))});if("string"==typeof b)return this.each(function(){var c=a(this),g=c.data("DateTimePicker");if(!g)throw new Error('bootstrap-datetimepicker("'+b+'") method was called on an element that is not using DateTimePicker');d=g[b].apply(g,e),f=d===g}),f||a.inArray(b,g)>-1?this:d;throw new TypeError("Invalid arguments for DateTimePicker: "+b)},a.fn.datetimepicker.defaults={timeZone:"",format:!1,dayViewHeaderFormat:"MMMM YYYY",extraFormats:!1,stepping:1,minDate:!1,maxDate:!1,useCurrent:!0,collapse:!0,locale:b.locale(),defaultDate:!1,disabledDates:!1,enabledDates:!1,icons:{time:"glyphicon glyphicon-time",date:"glyphicon glyphicon-calendar",up:"glyphicon glyphicon-chevron-up",down:"glyphicon glyphicon-chevron-down",previous:"glyphicon glyphicon-chevron-left",next:"glyphicon glyphicon-chevron-right",today:"glyphicon glyphicon-screenshot",clear:"glyphicon glyphicon-trash",close:"glyphicon glyphicon-remove"},tooltips:{today:"Go to today",clear:"Clear selection",close:"Close the picker",selectMonth:"Select Month",prevMonth:"Previous Month",nextMonth:"Next Month",selectYear:"Select Year",prevYear:"Previous Year",nextYear:"Next Year",selectDecade:"Select Decade",prevDecade:"Previous Decade",nextDecade:"Next Decade",prevCentury:"Previous Century",nextCentury:"Next Century",pickHour:"Pick Hour",incrementHour:"Increment Hour",decrementHour:"Decrement Hour",pickMinute:"Pick Minute",incrementMinute:"Increment Minute",decrementMinute:"Decrement Minute",pickSecond:"Pick Second",incrementSecond:"Increment Second",decrementSecond:"Decrement Second",togglePeriod:"Toggle Period",selectTime:"Select Time"},useStrict:!1,sideBySide:!1,daysOfWeekDisabled:!1,calendarWeeks:!1,viewMode:"days",toolbarPlacement:"default",showTodayButton:!1,showClear:!1,showClose:!1,widgetPositioning:{horizontal:"auto",vertical:"auto"},widgetParent:null,ignoreReadonly:!1,keepOpen:!1,focusOnShow:!0,inline:!1,keepInvalid:!1,datepickerInput:".datepickerinput",keyBinds:{up:function(a){if(a){var b=this.date()||this.getMoment();a.find(".datepicker").is(":visible")?this.date(b.clone().subtract(7,"d")):this.date(b.clone().add(this.stepping(),"m"))}},down:function(a){if(!a)return void this.show();var b=this.date()||this.getMoment();a.find(".datepicker").is(":visible")?this.date(b.clone().add(7,"d")):this.date(b.clone().subtract(this.stepping(),"m"))},"control up":function(a){if(a){var b=this.date()||this.getMoment();a.find(".datepicker").is(":visible")?this.date(b.clone().subtract(1,"y")):this.date(b.clone().add(1,"h"))}},"control down":function(a){if(a){var b=this.date()||this.getMoment();a.find(".datepicker").is(":visible")?this.date(b.clone().add(1,"y")):this.date(b.clone().subtract(1,"h"))}},left:function(a){if(a){var b=this.date()||this.getMoment();a.find(".datepicker").is(":visible")&&this.date(b.clone().subtract(1,"d"))}},right:function(a){if(a){var b=this.date()||this.getMoment();a.find(".datepicker").is(":visible")&&this.date(b.clone().add(1,"d"))}},pageUp:function(a){if(a){var b=this.date()||this.getMoment();a.find(".datepicker").is(":visible")&&this.date(b.clone().subtract(1,"M"))}},pageDown:function(a){if(a){var b=this.date()||this.getMoment();a.find(".datepicker").is(":visible")&&this.date(b.clone().add(1,"M"))}},enter:function(){this.hide()},escape:function(){this.hide()},"control space":function(a){a&&a.find(".timepicker").is(":visible")&&a.find('.btn[data-action="togglePeriod"]').click()},t:function(){this.date(this.getMoment())},delete:function(){this.clear()}},debug:!1,allowInputToggle:!1,disabledTimeIntervals:!1,disabledHours:!1,enabledHours:!1,viewDate:!1},a.fn.datetimepicker});
(function() {
  'use strict';

  angular.module('openc3', ['ngTable', 'ngCookies', 'ngSanitize', 'ngMessages', 'ngStorage', 'ui.router', 'ui.bootstrap', 'toastr',  'perfect_scrollbar','ngWebSocket','ngMd5', 'ngFileUpload']);
})();

(function () {
    'use strict';
    ConfigEditRelyController.$inject = ["$uibModalInstance", "$http", "$state", "nodeStr", "ngTableParams", "projectid", "$injector"];
    angular
        .module('openc3')
        .controller('ConfigEditRelyController', ConfigEditRelyController);

    function ConfigEditRelyController($uibModalInstance, $http, $state, nodeStr, ngTableParams, projectid, $injector ) {

        var vm = this;
        vm.nodeStr = nodeStr;

        vm.cancel = function(){ $uibModalInstance.dismiss(); };
        var toastr = toastr || $injector.get('toastr');

        vm.treeid = $state.params.treeid;

        vm.reload = function(){
            vm.loadover = false;
            $http.get('/api/ci/rely/' + projectid ).success(function(data){
                vm.relyTable = new ngTableParams({count:20}, {counts:[],data:data.data});
                vm.loadover = true;
            });
        };

        vm.reload();

        vm.reloadticket = function(){
            $http.get('/api/ci/ticket').success(function(data){
                if(data.stat){
                    vm.ticketinfo = data.data;
                }
                else{
                    toastr.error( "获取凭据失败:" + data.info )
                }
            });
        };

        vm.reloadticket();

        vm.addrtype = '';
        vm.changeaddr = function()
        {
            if ( vm.newrely.addr == "" )
            {
                vm.addrtype = ''
            }
            else
            {
                if( vm.newrely.addr.match( /git@/ ) ||  vm.newrely.addr.match( /\.git/ ) )
                {
                    vm.addrtype = 'git';
                }else
                {

                    vm.addrtype = 'svn';
                }
            }
        }

 
        vm.module = { username: '__default__' };
        vm.setUsername = function(name) {
            vm.module.username = name;
        }

        vm.add =function() {
          swal({
            title: "添加依赖",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){
             $http.post('/api/ci/rely/' + projectid, vm.newrely ).success(function(data){
                 if(data.stat == true) 
                 { 
                     vm.newrely = {};
                     vm.reload();
                 } else { 
                     toastr.error( "添加失败:" + data.info )
                 }
             });
          });
        }

        vm.del =function(id) {
          swal({
            title: "删除依赖",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){
             $http.delete('/api/ci/rely/' + projectid + '/' + id ).success(function(data){
                 if(data.stat == true) 
                 { 
                     toastr.success( "删除成功!" )
                     vm.reload();
                 } else { 
                     toastr.error( "删除失败:" + data.info )
                 }
             });
          });
        }
    }
})();

(function () {
    'use strict';
     CiAddImageController.$inject = ["$uibModalInstance", "$http"];
    angular
        .module('openc3')
        .controller('CiAddImageController', CiAddImageController);

    function CiAddImageController($uibModalInstance, $http) {
        var vm = this;
        vm.cancel_show = function(){ $uibModalInstance.dismiss(); };
 
     }
})();

(function() {
    'use strict';

    taskLogController.$inject = ["$websocket", "$location", "$injector"];
    angular
        .module('openc3')
        .component( 'jobxTaskLogArea', {
            templateUrl: 'app/pages/history/jobx/detail/log-area/log.html',
            controller: taskLogController,
            bindings: { taskuuid: '=', jobxaddr: '='}
        });

    function taskLogController($websocket, $location, $injector) {
        var vm = this;
        vm.height = vm.height || '200';
        var toastr = toastr || $injector.get('toastr');

        var wsH = "ws://"
        if ( window.location.protocol == 'https:' )
        {
            wsH = "wss://"
        }

        var urlMySocket = wsH + window.location.host + "/api/jobx/slave/"+vm.jobxaddr+"/ws?uuid="+vm.taskuuid;

        vm.ws = $websocket(urlMySocket);
        vm.ws.onOpen(function (){
            console.log("opening ws");
        });
        vm.ws.onMessage(function (message) {
            setMessageInnerHTML(message.data)
        });
        vm.ws.onError(function (message) {
            toastr.error('打开日志失败')
        });
        vm.ws.onClose(function (message) {
        });
        function setMessageInnerHTML(innerHTML) {
            document.getElementById('messagejobxtask').innerHTML += innerHTML + '<br/>';
        }
    }
})();

(function() {
    'use strict';

    LogController.$inject = ["$websocket", "$location", "$injector", "$scope", "$interval"];
    angular
        .module('openc3')
        .component('jobSubtaskLogArea', {
            templateUrl: 'app/pages/history/job/detail/sublog-area/log.html',
            controller: LogController,
            bindings: { jobuuid: '=', jobaddr: '=', loguuid:'='}
        });

    function LogController($websocket, $location, $injector, $scope, $interval) {
        var vm = this;
        vm.height = vm.height || '200';
        var toastr = toastr || $injector.get('toastr');

        var wsH = "ws://"
        if ( window.location.protocol == 'https:' )
        {
            wsH = "wss://"
        }
        var urlMySocket = wsH + window.location.host + "/api/job/slave/"+vm.jobaddr+"/ws?uuid="+vm.loguuid;

        vm.ws = $websocket(urlMySocket);
        vm.ws.onOpen(function (){
            console.log("open ws");
        });
        vm.ws.onMessage(function (message) {
            setMessageInnerHTML(message.data)
        });
        vm.ws.onError(function (message) {
            toastr.error('打开日志失败')
        });
        vm.ws.onClose(function (message) {
            console.log("close ws");
        });
        function setMessageInnerHTML(innerHTML) {
            document.getElementById('messagejobsubtask').innerHTML += innerHTML + '<br/>';
        }

        var reRun = $interval(function () {
            if (vm.taskuuid){ vm.reload(); }
            vm.ws.send("H")
        }, 5000);

        $scope.$on('$destroy', function(){
            $interval.cancel(reRun);
        });
    }
})();

(function() {
    'use strict';

    taskLogController.$inject = ["$websocket", "$location", "$injector"];
    angular
        .module('openc3')
        .component( 'jobTaskLogArea', {
            templateUrl: 'app/pages/history/job/detail/log-area/log.html',
            controller: taskLogController,
            bindings: { taskuuid: '=', jobaddr: '='}
        });

    function taskLogController($websocket, $location, $injector) {
        var vm = this;
        vm.height = vm.height || '200';
        var toastr = toastr || $injector.get('toastr');

        var wsH = "ws://"
        if ( window.location.protocol == 'https:' )
        {
            wsH = "wss://"
        }
        var urlMySocket = wsH + window.location.host + "/api/job/slave/"+vm.jobaddr+"/ws?uuid="+vm.taskuuid;

        vm.ws = $websocket(urlMySocket);
        vm.ws.onOpen(function (){
            console.log("opening ws");
        });
        vm.ws.onMessage(function (message) {
            setMessageInnerHTML(message.data)
        });
        vm.ws.onError(function (message) {
            toastr.error('打开日志失败')
        });
        vm.ws.onClose(function (message) {
        });
        function setMessageInnerHTML(innerHTML) {
            document.getElementById('messagejobtask').innerHTML += innerHTML + '<br/>';
        }
    }
})();

(function() {
    'use strict';

    CiCtrlLogController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService"];
    angular
        .module('openc3')
        .controller('CiCtrlLogController', CiCtrlLogController);

    function CiCtrlLogController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.reload = function(){
            vm.loadover = false;
            $http.get('/api/ci/log/' + vm.treeid).success(function(data){
                vm.activeRegionTable = new ngTableParams({count:50}, {counts:[],data:data.data});
                vm.loadover = true;
            });
        };

        vm.reload();

    }
})();

(function() {
    'use strict';

    FindTagController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$websocket", "$injector"];
    angular
        .module('openc3')
        .controller('FindTagController', FindTagController);

    function FindTagController($uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $websocket, $injector ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        vm.projectid = $state.params.projectid;
        var toastr = toastr || $injector.get('toastr');

        vm.cancel = function(){ $uibModalInstance.dismiss()};
        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.openws = function()
        {
            vm.siteaddr = window.location.host;

            var wsH = "ws://"
            if ( window.location.protocol == 'https:' )
            {
                wsH = "wss://"
            }
            var urlMySocket = wsH + vm.siteaddr + "/api/ci/slave/"+ vm.project.slave +"/ws?uuid="+ vm.projectid;
            vm.ws = $websocket(urlMySocket);

            vm.logDetail = '';
            vm.ws.onOpen(function (){
               console.log("opening ws");
            });

             vm.ws.onMessage(function (message) {
                 if(  message.data == 'wsresetws' )
                 {
                     vm.logDetail = '';
                 }
                 else
                 {
                     vm.logDetail = vm.logDetail + message.data
                 }

             });

             vm.ws.onError(function (message) {
                 toastr.error('打开日志失败')
             });

        }

        vm.reloadprojectinfo = function(){
            $http.get('/api/ci/project/' + vm.treeid + '/' + vm.projectid ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.project = data.data;
                    if (vm.project.slave){
                        vm.openws();
                    }
                } else {
                    toastr.error( "加载项目信息失败:" + data.info )
                }
            });
        };

        vm.reloadprojectinfo();

        vm.loadfindtags_at_onceover = true;
        vm.findtags_at_once = function(){
            vm.loadfindtags_at_onceover = false;
            $http.put('/api/ci/project/' + vm.treeid + '/' + vm.projectid + '/findtags_at_once' ).success(function(data){
                if(data.stat == true) 
                {
                    vm.loadfindtags_at_onceover = true;
                } else { 
                    toastr.error( "触发寻找tag失败:" + data.info )
                }
            });
        };

    }
})();

(function() {
    'use strict';

    EditJob2CiController.$inject = ["$timeout", "$state", "$http", "editdata", "editjobuuid", "jobtypes", "editjobname", "mon_ids", "mon_status", "treeid", "$uibModal", "$scope", "treeService", "resoureceService", "$uibModalInstance", "setjobuuid", "reloadhome", "$injector"];
    angular
        .module('openc3')
        .controller('EditJob2CiController', EditJob2CiController);

    function EditJob2CiController($timeout, $state, $http,editdata,editjobuuid,jobtypes,editjobname,mon_ids,mon_status,treeid, $uibModal, $scope, treeService,resoureceService, $uibModalInstance, setjobuuid, reloadhome, $injector ) {
        var vm = this;

        vm.cancel = function(){ $uibModalInstance.dismiss(); reloadhome();};

        var toastr = toastr || $injector.get('toastr');

        $scope.dataready = true;
        $scope.searchShow = true;
        $scope.nosearch = true;
        $scope.saveHide = false;
        $scope.saveOK = true;
        $scope.editState = false;
        $scope.newjobname = editjobname;
        vm.allNewJob = [];
        vm.treeid = treeid;
        vm.editJobData = editdata;
        vm.editjobuuid = editjobuuid;
        vm.editjobtypes = jobtypes;
        vm.editjobname = editjobname;
        vm.mon_ids = 0;
        vm.mon_status = mon_status;
        vm.cloneNodes = [];
        $scope.monVar = true;
        vm.allVar = [];
        $scope.var = {
            "jobuuid":"",
            "name":"",
            "value":"",
            "describe":" "
        };
//        if (!vm.editJobData){
//            $state.go('home.business.job', {
//                treeid:vm.treeid,
//            });
//        }
        treeService.sync.then(function(){           // when the tree was success.
            vm.nodeStr = treeService.selectname();  // get tree name
        });
        vm.hideMonVar = function () {
            $scope.monVar = !$scope.monVar;
        };
        vm.delVar = function (idx, item) {
            vm.allVar.splice(idx,1)
        };
        vm.addVar = function () {
            vm.allVar.push(angular.copy($scope.var));
        };
        vm.getVar = function () {
            $http.get('/api/job/variable/' + vm.treeid + "/" +vm.editjobuuid).then(
                function successCallback (response) {
                    if (response.data.stat){
                        vm.allVar = response.data.data;
                    }else {
                        toastr.error( "获取变量失败:" + response.data.info )
                    }
                },
                function errorCallback (response) {
                    toastr.error( "获取变量失败:" + response.status )
                }
            );
        };

        if(vm.editjobuuid){
            vm.getVar();
        }

        vm.saveVar = function () {
            var Var = {};
            Var.jobuuid = vm.editjobuuid;
            Var.data = vm.allVar;
            $http.post('/api/job/variable/'+ vm.treeid+'/update', Var).then(
                function successCallback(response) {
                    if (!response.data.stat){
                        toastr.error( "保存变量失败:" + response.data.info )
                    }
                },
                function errorCallback (response ){
                    toastr.error( "保存变量失败:" + response.status )
                }
            );

        };

        vm.count = function(pluginType){
            var count = 0;
            for(var i = 0; i < vm.allNewJob.length; i++) {
                if (vm.allNewJob[i].plugin_type == pluginType){
                    count = count + 1;
                }
            }
            return count;
        };

        vm.createScriptJob = function (idx) {
            var count = vm.count("cmd");
            var seq = count + 1;
            var openChoice = $uibModal.open({
                templateUrl: 'app/pages/business/job/plugin/cmd.html',
                controller: 'scriptJobController',
                controllerAs: 'scriptjob',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    editData : function () {return ""},
                    seq : function () {return seq}
                }
            });

            openChoice.result.then(
                function (result) {
                    if (idx >= 0){
                        vm.allNewJob.splice(idx, 0, result);
                    }else {
                        vm.allNewJob.push(result)
                    }

                },function (reason) {
                    console.log("createScriptJob error reason", reason)
                }
            );
        };

        vm.createScpJob = function (idx) {
            var count = vm.count("scp");
            var seq = count + 1;
            var openChoice = $uibModal.open({
                templateUrl: 'app/pages/business/job/plugin/scp.html',
                controller: 'scpJobController',
                controllerAs: 'scpjob',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    editData : function () {return ""},
                    seq : function () {return seq}
                }
            });

            openChoice.result.then(
                function (result) {
                    if (idx >= 0){
                        vm.allNewJob.splice(idx, 0, result);
                    }else {
                        vm.allNewJob.push(result)
                    }

                },function (reason) {
                    console.log("createScpJob error reason", reason)
                }
            );
        };

        vm.createApprovalJob = function (idx) {
            var count = vm.count("approval");
            var seq = count + 1;
            var openChoice = $uibModal.open({
                templateUrl: 'app/pages/business/job/plugin/approval.html',
                controller: 'approvalJobController',
                controllerAs: 'approvaljob',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    editData : function () {return ""},
                    seq : function () {return seq}
                }
            }); 

            openChoice.result.then(
                function (result) {
                    if (idx >= 0){
                        vm.allNewJob.splice(idx, 0, result);
                    }else {
                        vm.allNewJob.push(result)
                    }

                },function (reason) {
                    console.log("createScpJob error reason", reason)
                }
            );
        };

        vm.copyScp = function (id) {
            var d = vm.allNewJob[id]
            var tempdata = {
                'chmod': d.chmod,
                'chown': d.chown,
                'dp': d.dp,
                'dst': d.dst,
                'dst_type': d.dst_type,
                'scp_delete': d.scp_delete,
                'sp': d.sp,
                'src': d.src,
                'src_type':d.src_type,
                'plugin_type':'scp',
                'name': d.name + '_copy',
                'user': d.user,
                'timeout': d.timeout,
                'pause': d.pause,
                'deployenv' : d.deployenv,
                'action' : d.action,
                'batches' : d.batches
            }
            vm.allNewJob.splice(id + 1, 0, tempdata);
        };

        vm.editScp = function (id) {
            var editData = vm.allNewJob[id];
            var openEdit= $uibModal.open({
                templateUrl: 'app/pages/business/job/plugin/scp.html',
                controller: 'scpJobController',
                controllerAs: 'scpjob',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    editData : function () {return editData},
                    seq : function () {return 0}
                }
            }); 

            openEdit.result.then(
                function (result) {
                    vm.allNewJob.splice(id, 1, result);
                },function (reason) {
                    console.log("editScp error reason", reason)
                }
            ); 
        };

         vm.copyApproval = function (id) {
            var d = vm.allNewJob[id]
            var tempdata = {
                'plugin_type':'approval',
                'name': d.name + '_copy',
                'approver': d.approver,
                'cont': d.cont,
                'everyone': d.everyone,
                'timeout': d.timeout,
                'deployenv' : d.deployenv,
                'action' : d.action,
                'batches' : d.batches
            }
            vm.allNewJob.splice(id + 1, 0, tempdata);
        };

        vm.editApproval = function (id) {
            var editData = vm.allNewJob[id];
            var openEdit= $uibModal.open({
                templateUrl: 'app/pages/business/job/plugin/approval.html',
                controller: 'approvalJobController',
                controllerAs: 'approvaljob',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    editData : function () {return editData},
                    seq : function () {return 0}
                }
            }); 

            openEdit.result.then(
                function (result) {
                    vm.allNewJob.splice(id, 1, result);
                },function (reason) {
                    console.log("editScp error reason", reason)
                }
            );
        };

//
        vm.createKubernetes = function (id) {
            var tempdata1 = {
                'plugin_type':'cmd',
                'name': "kubernetes发布",
                'user': "0",
                'node_type': "builtin",
                'node_cont': "openc3skipnode",
                'scripts_type': "buildin",
                'scripts_cont': "#!kubernetes",
                'scripts_argv': "deploy $version",
                'timeout': "60",
                'pause': "",
                'deployenv' : "always",
                'action' : "always",
                'batches' : "always",
            }
            var tempdata2 = {
                'plugin_type':'cmd',
                'name': "kubernetes等待更新完成",
                'user': "0",
                'node_type': "builtin",
                'node_cont': "openc3skipnode",
                'scripts_type': "buildin",
                'scripts_cont': "#!kubernetes",
                'scripts_argv': "check $version",
                'timeout': "60",
                'pause': "",
                'deployenv' : "always",
                'action' : "always",
                'batches' : "always",
            }

            vm.allNewJob.push(tempdata1)
            vm.allNewJob.push(tempdata2)
        };
//
 
        vm.copyScript = function (id) {
            var d = vm.allNewJob[id]
            var tempdata = {
                'plugin_type':'cmd',
                'name': d.name + '_copy',
                'user': d.user,
                'node_type':d.node_type,
                'node_cont':d.node_cont,
                'scripts_type':d.scripts_type,
                'scripts_cont': d.scripts_cont,
                'scripts_argv': d.scripts_argv,
                'timeout': d.timeout,
                'pause': d.pause,
                'deployenv' : d.deployenv,
                'action' : d.action,
                'batches' : d.batches
            }
            vm.allNewJob.splice(id + 1, 0, tempdata);
        };

        vm.editScript = function (id) {
            var editData = vm.allNewJob[id];
            var openChoice = $uibModal.open({
                templateUrl: 'app/pages/business/job/plugin/cmd.html',
                controller: 'scriptJobController',
                controllerAs: 'scriptjob',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () {return vm.treeid},
                    editData : function () {return editData},
                    seq : function () {return 0}
                }
            });

            openChoice.result.then(
                function (result) {
                    vm.allNewJob.splice(id, 1, result);
                },function (reason) {
                    console.log("editScript error reason", reason)
                }
            ); 
        };

        vm.deljobdata = function (id) {
            vm.allNewJob.splice(id, 1);
        };

        vm.saveCreateData = function () {
            if (vm.allNewJob.length >0){
                if (!$scope.newjobname){
                    swal({
                        title:"作业名称为空",
                        type:'error'
                    });
                }
                else {
                    var post_data = {
                        "name":$scope.newjobname,
                        "mon_ids":$scope.mon_ids,
                        "mon_status":$scope.mon_status,
                        "data":vm.allNewJob,
                        "permanent":"permanent",
                    };
                    // {stat: true, uuid: "PAApw1VP7LhK", data: true}
                    if ($scope.editState){

                        resoureceService.job.updateJob([vm.treeid,vm.editjobuuid], post_data, null)
                            .then(function (repo) {
                                if (repo.stat){
                                    // vm.allNewJob.splice(0, vm.allNewJob.length);
                                    $scope.newjobname = "";
                                    $scope.saveHide = true;
                                    $scope.saveOK = false;
                                    $scope.jobuuid = $scope.editjobuuid;
                                    vm.saveVar();
                                }

                            }, function (repo) {
                                console.log("update job error:", repo);
                            })
                    }else {
                        resoureceService.job.createJob(vm.treeid, post_data, null)
                            .then(function (repo) {
                                if (repo.stat){
                                    // vm.allNewJob.splice(0, vm.allNewJob.length);
                                    $scope.newjobname = "";
                                    $scope.saveHide = true;
                                    $scope.saveOK = false;
                                    $scope.jobuuid = repo.uuid;
                                    setjobuuid( repo.uuid );
                                }

                            }, function (repo) {
                                console.log("post error result", repo);
                            })
                    }
                }
            }else {
                toastr.error("数据不全")
            }
        };

        vm.up = function (idx){
            if (idx>0){
                [vm.allNewJob[idx-1], vm.allNewJob[idx]] = [vm.allNewJob[idx], vm.allNewJob[idx-1]]
            }
        };

        vm.down = function (idx){
            if (idx<vm.allNewJob.length-1){
                [vm.allNewJob[idx+1], vm.allNewJob[idx]] = [vm.allNewJob[idx], vm.allNewJob[idx+1]]
            }
        };

        if (vm.editjobuuid && vm.editJobData){
            $scope.newjobname = vm.editjobname;
            if (vm.mon_status) {
                $scope.mon_status=true;
            }else{
                $scope.mon_status=false;
            }
            $scope.mon_ids = vm.mon_ids;
            var jobTypesList = [];
            angular.forEach(vm.editjobtypes.split(","), function (jtype, i) {
                jobTypesList.push(jtype.split("_")[0])
            });
            angular.forEach(vm.editJobData, function (data, index) {
                data.plugin_type = jobTypesList[index];
                vm.allNewJob.push(data);
            });
            $scope.editState = true;
        }else if(vm.copyjob){
            var jobTypesList = [];
            angular.forEach(vm.editjobtypes.split(","), function (jtype, i) {
                jobTypesList.push(jtype.split("_")[0])
            });
            angular.forEach(vm.editJobData, function (data, index) {
                data.plugin_type = jobTypesList[index];
                vm.allNewJob.push(data);
            });
        }

    }

})();

(function() {
    'use strict';

    CiController.$inject = ["$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "genericService", "$injector", "$timeout"];
    angular
        .module('openc3')
        .controller('CiController', CiController);

    function CiController($location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, genericService, $injector, $timeout ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        vm.projectid = $state.params.projectid;
        vm.seftime = genericService.seftime
        var toastr = toastr || $injector.get('toastr');

        vm.siteaddr = window.location.protocol + '//' + window.location.host;

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });
        $scope.panelcolor = { "success": "green", "fail": "red", "refuse": "orange", "running": "#98b2bc", "decision": "#aaa", "ignore": "#aaa" }

        vm.showEditLog = function () {
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/flowline/detail/log.html',
                controller: 'CiCtrlLogController',
                controllerAs: 'cictrlLog',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    getGroup: function () {return vm.getGroupInfo},
                    groupid: function () {},
                }
            });
        };

        vm.showTagFind = function () {
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/flowline/detail/findtag.html',
                controller: 'FindTagController',
                controllerAs: 'findtag',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    projectid: function () {},
                }
            });
        };

        vm.reload = function(){
            vm.loadover = false;
            $http.get('/api/ci/version/' + vm.treeid + '/' + vm.projectid ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.activeRegionTable = new ngTableParams({count:20}, {counts:[],data:data.data});
                    vm.loadover = true;
                } else { 
                    toastr.error( "加载版本失败:" + data.info )
                }
            });
        };

        vm.stop = function(){
            $http.put('api/ci/version/' + vm.treeid + '/' + vm.projectid + '/stop_project').success(function(data){
                if (data.stat == true) {
                    swal({ title: "停止成功!", type:'success' });
                    vm.reload();
                } else {
                    swal({title: "停止失败！", text: data.info, type: 'error'});
                }
            });
        };

        vm.reload();

        vm.reloadprojectinfo = function(){
            $http.get('/api/ci/project/' + vm.treeid + '/' + vm.projectid ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.project = data.data;
                } else {
                    toastr.error( "加载项目信息失败:" + data.info )
                }
            });
        };

        vm.reloadprojectinfo();

        vm.showlog = function(versionuuid,slave){
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/flowline/showlog.html',
                controller: 'CiShowLogController',
                controllerAs: 'showlog', 
                backdrop: 'static', 
                size: 'lg', 
                keyboard: false,
                windowClass:'modal-class',
                bindToController: true,
                resolve: {
                    nodeStr: function () { return vm.nodeStr },
                    reloadhome: function () { return vm.reload },
                    versionuuid: function () { return versionuuid },
                    slave: function () { return slave }
                }
            });
        };

        vm.build = function( uuid ){
          swal({
            title: "确定构建",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){
            $http.put('/api/ci/version/' + vm.treeid + '/' + vm.projectid + '/' + uuid + '/build' ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.reload();
                } else { 
                    toastr.error( "提交失败:" + data.info )
                }
            })

          })
        };

         vm.killbuild = function( uuid, slave ){
          swal({
            title: "确定停止",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){
            $http.put('/api/ci/slave/' + slave + '/killbuild/' + uuid  ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.reload();
                } else { 
                    toastr.error( "停止操作失败:" + data.info )
                }
            })

          })
        };

        vm.isRollbackTask = function (uuid){
            uuid = uuid.slice(uuid.length - 1);
            if (64 < uuid.charCodeAt(0) && uuid.charCodeAt(0) < 91) {
                return 1
            } else {
                return 0
            }
        };

        vm.taskInfoTest = {}
        vm.taskInfoOnline = {}
        vm.taskInfoRollback = {}

        vm.getTaskInfo = function (treeId) {
            $http.get('/api/jobx/task/' + treeId + '?allowslavenull=1&name=_ci_' + vm.projectid + '_' ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        angular.forEach(response.data.data, function (value, key) {

                        var version = vm.cversion( value.variable );
                        var rollbackversion = vm.crollbackversion( value.variable );
                        var jobtype = vm.cjobtype( value.variable );

                        value.version = version
                        value.rollbackversion = rollbackversion

                        if( jobtype == 'test' )
                        {
                            if( ! vm.taskInfoTest[version] )
                            {
                                vm.taskInfoTest[version] = []
                            }
                            vm.taskInfoTest[version].push(value)
                        }

                        if( jobtype == 'online' )
                        {
                            var isRollbackTask = vm.isRollbackTask( value.uuid)
                            if( isRollbackTask )
                            {
                                var str = value.uuid
                                var strrep = str.length - 1
                                str = str.replace(str[strrep],str[strrep].toLowerCase());
                                value.uuid = str
                                vm.taskInfoRollback[value.uuid] = value
                            }
                            else
                            {
                                if( ! vm.taskInfoOnline[version] )
                                {
                                    vm.taskInfoOnline[version] = []
                                }
                                vm.taskInfoOnline[version].push(value)
                            }
                        }

                        });
                    }else {
                    }
                },
                function errorCallback (response){
                });
        };
        vm.getTaskInfo(vm.treeid);

        vm.cversion = function(text) {
            var w = '';
            var re=/\bversion:.*/;
            if (re.test(text)){
                var reStr = re.exec(text)[0];
                w = reStr.split(" ")[1]
                var xx = /'/;
                if( xx.test(w) )
                {
                    w = w.split("'")[1]
                }
            }
            return w
        }

        vm.crollbackversion = function(text) {
            var w = '';
            var re=/\b_rollbackVersion_:.*/;
            if (re.test(text)){
                var reStr = re.exec(text)[0];
                w = reStr.split(" ")[1]
                var xx = /'/;
                if( xx.test(w) )
                {
                    w = w.split("'")[1]
                }
            }
            return w
        }

        vm.cjobtype = function(text) {
            var w = '';
            var re=/\b_jobtype_:.*/;
            if (re.test(text)){
                var reStr = re.exec(text)[0];
                w = reStr.split(" ")[1]
                var xx = /'/;
                if( xx.test(w) )
                {
                    w = w.split("'")[1]
                }
            }
            return w
        }


        vm.deployDetail = function(uuid){
            $state.go('home.history.jobxdetail', {treeid:vm.treeid, taskuuid:uuid, accesspage:true});
        };

        vm.runJob = function(version, jobtype ) {
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/flowline/runTask2Ci.html',
                controller: 'RunTask2CiController',
                controllerAs: 'runtask2ci', 
                backdrop: 'static', 
                size: 'lg', 
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () { return vm.treeid },
                    version: function () { return version },
                    jobtype: function () { return jobtype },
                    name: function () { return '_ci_' + vm.projectid + '_' },
                    groupname: function () { return '_ci_' + jobtype + '_'  + vm.projectid + '_' },
                    showIPstr: function () { return $scope.showIPstr[jobtype] },
                    jobStep: function () { return vm.jobStep },
                    projectname: function () { return vm.project.name },
                    projectid: function () { return vm.projectid },
                }
            });
        }

        vm.editconfig = function () {
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/flowline/detail/config.html',
                controller: 'ConfigController',
                controllerAs: 'config',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    getGroup: function () {return vm.getGroupInfo},
                    projectid: function () {return vm.projectid},
                    treeid: function () {return vm.treeid},
                    name: function () {return vm.project.name},
                    groupid: function () {},
                }
            });
        };

    $scope.showIPstr = { 'test': [], 'online': [] };
    $scope.showIPstrLen = { 'test': 0, 'online': 0 };
    vm.loadNodeInfo = function(envname)
    {
        $scope.showIPstr[envname] = [];
        $scope.showIPstrLen[envname] = 0;
        $http.get('/api/jobx/group/' + vm.treeid+"/"+'_ci_' + envname + '_' + vm.projectid + '_'+"/node/byname").then(
            function successCallback(response) {
                if (response.data.stat){
                    vm.groupData = response.data.data;
                    angular.forEach(vm.groupData, function (subip, i) {
                        var suball = [];
                        var onelen = subip.length;
                        if (onelen >0){
                            var ss = 0;
                            var group_num = 0;
                            var ipstr = [];
                            angular.forEach(subip, function (ip, n) {
                                if (ss === 8){
                                    suball.push(ipstr.join());
                                    ss = 0;
                                    ipstr = []
                                }
                                ipstr.push(ip);
                                if(onelen === n+1){
                                    suball.push(ipstr.join());
                                }
                                ss +=1;
                                group_num += 1;
                            });
                            var infos = {"num": group_num, "infos": suball};
                            $scope.showIPstr[envname].push(infos);
                        }
                    })
                    $scope.showIPstrLen[envname] = $scope.showIPstr[envname].length
                }else {
                    toastr.error("获取项目机器信息失败："+response.data.info)
                }
           },
           function errorCallback (response ){
               toastr.error("获取项目机器信息失败："+response.status)
       });

    }

    vm.loadNodeInfo('test');
    vm.loadNodeInfo('online');

    vm.jobStep = []
    vm.jobStepLen = 0
    vm.loadJobInfo = function()
    {
        vm.jobStep = []
        vm.jobStepLen = 0
        $http.get('/api/job/jobs/' + vm.treeid+"/byname?name="+'_ci_' + vm.projectid + '_' ).then(
            function successCallback(response) {
                if (response.data.stat){
                    vm.jobData = response.data.data;
                    if( vm.jobData.data )
                    {
                        angular.forEach(vm.jobData.data, function (d) {
                                vm.jobStep.push(d.name);
                        });
                        vm.jobStepLen = vm.jobStep.length
                    }
                }else {
                    toastr.error( "获取作业信息失败" + response.data.info );
                }
           },
           function errorCallback (response ){
                toastr.error( "获取作业信息失败" + response.status );
       });

    }

    vm.loadJobInfo();

    vm.projectvvversioncount = {}
    vm.projectvvversionnode = {}
    vm.projectvv = +{}
    vm.reloadvv = function(){
        $http.get('/api/job/vv/' + vm.treeid + '?name=APP__ci_' + vm.projectid + '__VERSION' ).success(function(data){
            if(data.stat == true) 
            { 
                vm.projectvv = data.data;
                angular.forEach(vm.projectvv, function (d) {
                    if( ! vm.projectvvversioncount[d.value] )
                    {
                        vm.projectvvversioncount[d.value] = 0
                        vm.projectvvversionnode[d.value] = []
                    }
                    vm.projectvvversioncount[d.value] = vm.projectvvversioncount[d.value] + 1
                    vm.projectvvversionnode[d.value].push( d.node )
                });
            } else {
                toastr.error( "加载项目变量失败:" + data.info )
            }
        });
    };

    vm.reloadvv();

    vm.shownum = function(num)
    {
        if( ! num )
        {
            return 0
        }
        return num
    }



        vm.versionitems = {};
        vm.versions = [];



        vm.getVersion = function () {
            $http.get('/api/job/vv/' + vm.treeid + '/analysis/version').then(
                function successCallback(response) {
                    if (response.data.stat) {
                        vm.allversion = response.data.data;
                        angular.forEach(vm.allversion, function(project){
                            vm.versionitems[project.name] = [];
                            if( project.name == 'APP__ci_' + vm.projectid  + '__VERSION')
                            {
                                vm.versions.push(project.name);
                            }
                            angular.forEach(project.data, function(value, key) {
                                vm.versionitems[project.name].push([key, parseFloat(value)]);
                            });
                        });
                        $timeout(function(){vm.showVersions(vm.versionitems)}, 0);
                    }else{
                        toastr.error( "获取作业信息失败：" + response.data.info )
                    };
                });
                function errorCallback(response) {
                    toastr.error( "获取作业信息失败：" + response.status )
                }
        };

        vm.describedeployment = function () {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/describedeployment.html',
                controller: 'KubernetesDescribeDeploymentController',
                controllerAs: 'kubernetesdescribedeployment',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return vm.project.ci_type_kind},
                    name: function () {return vm.project.ci_type_name},
                    namespace: function () {return vm.project.ci_type_namespace},
                    ticketid: function () {return vm.project.ci_type_ticketid},
                }
            });
        };


        vm.getVersion();

        vm.lastversion = {};
        vm.getLastVersion = function () {
            $http.get('/api/jobx/flowline_version/' + vm.projectid ).then(
                function successCallback(response) {
                    if (response.data.stat) {
                        vm.lastversion = response.data.data;
                    }else{
                        toastr.error( "获取作业信息失败：" + response.data.info )
                    };
                });
                function errorCallback(response) {
                    toastr.error( "获取作业信息失败：" + response.status )
                }
        };


        vm.getLastVersion();

        vm.showVersions = function (data) {
            var data_info = JSON.stringify(data);
            angular.forEach(data, function (value, key) {
                var container = '#' + key;
                $(container).highcharts({
                    chart: {
                        plotBackgroundColor: null,
                        plotBorderWidth: null,
                        plotShadow: false
                    },
                    title: {
                        text: ''
                    },
                    tooltip: {
                        headerFormat: '{series.name}<br>',
                        pointFormat: '{point.name}: <b>{point.percentage:.1f}%</b>'
                    },
                    plotOptions: {
                        pie: {
                            allowPointSelect: true,
                            cursor: 'pointer',
                            dataLabels: {
                                enabled: true,
                                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                                style: {
                                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                                }
                            }
                        }
                    },
                    series: [{
                        type: 'pie',
                        name: '',
                        data: value
                    }]
                });
            });

        };


    }
})();

(function() {
    'use strict';

    ConfigController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "projectid", "$scope", "name", "$injector", "treeid"];
    angular
        .module('openc3')
        .controller('ConfigController', ConfigController);

    function ConfigController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, projectid, $scope, name, $injector, treeid ) {

        var vm = this;

//        vm.treeid = $state.params.treeid;  // 不要通过params获取服务树ID，在k8s管理中，可能在A节点打开B节点的配置
        vm.treeid = treeid;

        vm.siteaddr = window.location.protocol + '//' + window.location.host;
        vm.projectid = projectid
        vm.groupid = {}
        vm.name = name
        var toastr = toastr || $injector.get('toastr');

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });


        vm.reload = function(){
            vm.loadover = false;
            $http.get('/api/ci/project/' + vm.treeid + '/' + projectid ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.project = data.data;

                    vm.loadks8info();
                    vm.reloadticket();

                    if ( vm.project.rely == 1 ) { vm.rely = true; } else { vm.rely = false; }
                    if ( vm.project.autobuild == 1 ) { vm.autobuild = true; } else { vm.autobuild = false; }
                    if ( vm.project.webhook == 1 ) { vm.webhook = true; } else { vm.webhook = false; }
                    if ( vm.project.status == 1 ) { vm.status = true; } else { vm.status = false; }
                    if ( vm.project.autofindtags == 1 ) { vm.autofindtags = true; } else { vm.autofindtags = false; }
                    if ( vm.project.callonlineenv == 1 ) { vm.callonlineenv = true; } else { vm.callonlineenv = false; }
                    if ( vm.project.calltestenv == 1 ) { vm.calltestenv = true; } else { vm.calltestenv = false; }

                    vm.loadover = true;
                } else { 
                    toastr.error("加载配置失败:" + data.info)
                }
            });
        };

        vm.reload();

        vm.reloadimage = function(){
            $http.get('/api/ci/images').success(function(data){
                if( data.stat )
                {
                     vm.dockerimage = [ {id: '', name: '' }, { id: 'centos:5', name: 'centos:5' }, { id: 'centos:6', name: 'centos:6' }, { id: 'centos:7', name: 'centos:7' } ];
                     angular.forEach(data.data, function (value, key) {
                         vm.dockerimage.push(value)
                     });
                }
                else
                {
                    toastr.error( "加载镜像列表失败:" + data.info )
                }
            });
        };

        vm.reloadimage();

        vm.reloadticket = function(){
            var typestr = "";
            if( vm.project.ci_type === 'kubernetes'  )
            {
                typestr = "&type=Harbor";
            }
            $http.get('/api/ci/ticket?projectid=' + vm.projectid + typestr ).success(function(data){
                if( data.stat)
                {
                    vm.ticketinfo = data.data;
                    vm.ticketinfo.unshift({ id: '', name: '' })
                }
                else
                {
                    toastr.error( "加载凭据列表失败:" + data.info )
                }
            });
        };


        vm.setcitype = function(type) {
            vm.project.ci_type = type;
            if( type = 'kubernetes' )
            {
                 vm.project.ci_type_kind = "deployment";
                 vm.project.follow_up = "harbor_push_image.pl";
                 vm.project.ci_type_dockerfile = "dockerfile";
            }
            vm.reloadticket();
        }

        vm.show_help = function () {
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/flowline/detail/config/add_image.html',
                controller: 'CiAddImageController',
                controllerAs: 'add_image',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                }
            });
        };

        vm.save =function() {
          swal({
            title: "保存配置",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){
             vm.project.rely = 0;
             if ( vm.rely )
             {
                 vm.project.rely = 1;
             }
             vm.project.autobuild = 0;
             if( vm.autobuild )
             {
                vm.project.autobuild = 1;
             }
             vm.project.webhook = 0;
             if( vm.webhook )
             {
                vm.project.webhook = 1;
             }
             vm.project.status = 0;
             if( vm.status )
             {
                vm.project.status = 1;
             }
             vm.project.autofindtags = 0;
             if( vm.autofindtags )
             {
                vm.project.autofindtags = 1;
             }
             vm.project.callonlineenv = 0;
             if( vm.callonlineenv )
             {
                vm.project.callonlineenv = 1;
             }
             vm.project.calltestenv = 0;
             if( vm.calltestenv )
             {
                vm.project.calltestenv = 1;
             }
 
 
             $http.post('/api/ci/project/' + vm.treeid + '/' + projectid , vm.project ).success(function(data){
                 if(data.stat == true) 
                 { 
                     toastr.success( "保存成功!" )
                     vm.reload();
                 } else { 
                     toastr.error( "保存失败:" + data.info )
                 }
             });
//
             if(  vm.project.ci_type === "kubernetes" )
             {
                 vm.KubernetesSaveGroup();
             }

          });
        }

        vm.editrely = function(){
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/flowline/detail/config/editrely.html',
                controller: 'ConfigEditRelyController',
                controllerAs: 'editrely', 
                backdrop: 'static', 
                size: 'lg', 
                keyboard: false,
                bindToController: true,
                resolve: {
                    nodeStr: function () { return vm.nodeStr },
                    projectid: function () { return projectid }
                }
            });
        };

        vm.editgroup = function(grouptype){
            $uibModal.open({
                templateUrl: 'app/pages/business/nodebatch/create.html',
                controller: 'CreateJobGroupController',
                controllerAs: 'createjobgroup',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    groupid: function () { return vm.groupid[grouptype] },
                    ciid: function () { return projectid },
                    grouptype: function () { return grouptype },
                    reloadhome: function () { return vm.editreload },
                }
            });
        };

//KubernetesSaveGroup
        vm.KubernetesSaveGroup = function(){
            vm.KubernetesSaveGroupByEnv('test');
            vm.KubernetesSaveGroupByEnv('online');
        };
        vm.KubernetesSaveGroupByEnv = function(env){
            var postData = {};
            postData['group_type'] = 'list';
            postData['name'] = '_ci_' + env + '_' + projectid + '_';
            postData['node'] = env + '.env';
            postData['note'] = 'ci';
            var groupid = vm.groupid[env];

            // 编辑分组
            if(groupid){
                resoureceService.group.updategroupxx([vm.treeid, groupid],postData, null).then(function () {
                }).finally(function(){

                });
            }
            // 创建分组
            else {
                resoureceService.group.creategroupxx(vm.treeid,postData, null).then(function () {
                }).finally(function(){

                });
            }

        };

//

        vm.editreload = function(t)
        {
            vm.getGroupInfo()
            vm.loadNodeInfo(t)
        }
        vm.getGroupInfo = function () {
            $http.get('/api/jobx/group/' + vm.treeid).then(
                function successCallback(response) {
                    if (response.data.stat){
                        angular.forEach(response.data.data, function (data, index) {
                            if( data.name == '_ci_test_' + projectid + '_' )
                            {
                                vm.groupid['test'] = data.id
                            }
                            if( data.name == '_ci_online_' + projectid + '_' )
                            {
                                vm.groupid['online'] = data.id
                            }
 
                        });
                    }else {
                        toastr.error("获取分组信息失败:"+response.data.info)
                    }
                },
                function errorCallback (response){
                    toastr.error("获取分组信息失败:"+response.status)
                });
        };
        vm.getGroupInfo(vm.treeid);


        vm.setjobuuid = function( uuid ){  vm.jobuuid = uuid};
        vm.editjob = function(){

            if( ! vm.jobuuid )
            {
                $uibModal.open({
                    templateUrl: 'app/pages/quickentry/flowline/detail/editjob.html',
                    controller: 'EditJob2CiController',
                    controllerAs: 'editjob2ci',
                    backdrop: 'static',
                    size: 'lg',
                    keyboard: false,
                    bindToController: true,
                    resolve: {
                        treeid: function () {return vm.treeid},
                        editjobuuid: function () { return vm.editjobuuid },
                        editdata: function () { return vm.editJobDatas },
                        jobtypes: function () { return vm.jobTypes },
                        mon_ids: function () { return vm.mon_ids },
                        mon_status: function () { return vm.mon_status },
                        setjobuuid: function () { return vm.setjobuuid },
                        editjobname: function () { return '_ci_' + projectid + '_' },
                        reloadhome: function () { return vm.loadJobInfo },
                    }
                });
                return;
            }

            $http.get('/api/job/jobs/'  + vm.treeid+"/"+ vm.jobuuid ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.jobDetail = response.data.data;
                        vm.editjobuuid = vm.jobDetail.uuid;
                        vm.editJobDatas = vm.jobDetail.data;
                        vm.editJobName = vm.jobDetail.name;
                        vm.mon_ids = vm.jobDetail.mon_ids;
                        vm.mon_status = vm.jobDetail.mon_status;
                        vm.jobTypes = vm.jobDetail.uuids;
                        if (vm.editjobuuid){
                            $uibModal.open({
                                templateUrl: 'app/pages/quickentry/flowline/detail/editjob.html',
                                controller: 'EditJob2CiController',
                                controllerAs: 'editjob2ci',
                                backdrop: 'static',
                                size: 'lg',
                                keyboard: false,
                                bindToController: true,
                                resolve: {
                                    treeid: function () {return vm.treeid},
                                    editjobuuid: function () { return vm.editjobuuid },
                                    editdata: function () { return vm.editJobDatas },
                                    jobtypes: function () { return vm.jobTypes },
                                    mon_ids: function () { return vm.mon_ids },
                                    mon_status: function () { return vm.mon_status },
                                    setjobuuid: function () { return vm.setjobuuid },
                                    editjobname: function () { return vm.editJobName },
                                    reloadhome: function () { return vm.loadJobInfo },
                               }
                            });
 
                    //        $state.go('home.work.editjob', {
                    //            treeid:vm.treeid,
                    //            editjobuuid:vm.editjobuuid,
                    //            editdata:vm.editJobDatas,
                    //            jobtypes:vm.jobTypes,
                    //            mon_ids:vm.mon_ids,
                    //            mon_status:vm.mon_status,
                    //            editjobname:vm.editJobName,
                    //        });
                        }else {
                            toastr.error("获取作业请求成功，但获取作业详细信息失败。请检查！")
                        }
                    }else {
                        toastr.error( "获取作业详细信息失败:"+response.data.info );
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取作业详细信息失败:"+response.status );
                });
        };

        vm.getJobInfo = function (treeId) {
            $http.get('/api/job/jobs/' + treeId).then(
                function successCallback(response) {
                    if (response.data.stat){
                        angular.forEach(response.data.data, function (data, index) {
                            if( data.name == '_ci_' + projectid + '_' )
                            {
                                vm.jobuuid = data.uuid
                            }
                        });
                    }else {
                        toastr.error("获取分组信息失败："+response.data.info)
                    }
                },
                function errorCallback (response){
                    toastr.error("获取分组信息失败："+response.status)
                });
        };
        vm.getJobInfo(vm.treeid);


    $scope.showIPstr = { 'test': [], 'online': [] };
    vm.loadNodeInfo = function(envname)
    {
        $scope.showIPstr[envname] = [];
        $http.get('/api/jobx/group/' + vm.treeid+"/"+'_ci_' + envname + '_' + projectid + '_'+"/node/byname").then(
            function successCallback(response) {
                if (response.data.stat){
                    vm.groupData = response.data.data;
                    angular.forEach(vm.groupData, function (subip, i) {
                        var suball = [];
                        var onelen = subip.length;
                        if (onelen >0){
                            var ss = 0;
                            var group_num = 0;
                            var ipstr = [];
                            angular.forEach(subip, function (ip, n) {
                                if (ss === 8){
                                    suball.push(ipstr.join());
                                    ss = 0;
                                    ipstr = []
                                }
                                ipstr.push(ip);
                                if(onelen === n+1){
                                    suball.push(ipstr.join());
                                }
                                ss +=1;
                                group_num += 1;
                            });
                            var infos = {"num": group_num, "infos": suball};
                            $scope.showIPstr[envname].push(infos);
                        }
                    })
                }else {
                    toastr.error("获取项目机器信息失败："+response.data.info)
                }
           },
           function errorCallback (response ){
                toastr.error("获取项目机器信息失败："+response.status)
       });

    }

    vm.loadNodeInfo('test');
    vm.loadNodeInfo('online');


    vm.jobStep = []
    vm.loadJobInfo = function()
    {
        vm.jobStep = []
        $http.get('/api/job/jobs/' + vm.treeid+"/byname?name="+'_ci_' + projectid + '_' ).then(
            function successCallback(response) {
                if (response.data.stat){
                    vm.jobData = response.data.data;
                    if( vm.jobData.data )
                    {
                        angular.forEach(vm.jobData.data, function (d) {
                                vm.jobStep.push(d.name);
                        });
                    }
                }else {
                    toastr.error( "获取作业信息失败" + response.data.info );
                }
           },
           function errorCallback (response ){
                toastr.error( "获取作业信息失败" + response.status );
       });
    }

    vm.loadJobInfo();
 

//k8s 相关
    //集群
    vm.clusterlist = [];
    vm.getClusterList = function()
    {
        $http.get('/api/ci/ticket/KubeConfig' ).then(
            function successCallback(response) {
                if (response.data.stat){
                    vm.clusterlist = response.data.data;
                }else {
                    toastr.error( "获取作业信息失败" + response.data.info );
                }
           },
           function errorCallback (response ){
                toastr.error( "获取作业信息失败" + response.status );
       });
    }

    vm.addCluster = function () {
        $uibModal.open({
            templateUrl: 'app/pages/global/ticket/createTicket.html',
            controller: 'CreateTicketController',
            controllerAs: 'createticket',
            backdrop: 'static',
            size: 'lg',
            keyboard: false,
            bindToController: true,
            resolve: {
                ticketid: function () {},
                homereload: function () { return vm.getClusterList },
                type: function () { return 'create' },
                title: function () { return '添加kubernetes集群' },
                point: function () { return 'KubeConfig' },
            }
        });

    };

    //命名空间

    vm.getNamespaceList = function(){
        if( vm.project.ci_type_ticketid === "" )
        {
            return;
        }
        $http.get("/api/ci/v2/kubernetes/namespace?ticketid=" +vm.project.ci_type_ticketid ).then(
            function successCallback(response) {
                if (response.data.stat){

                    vm.namespacelist = response.data.data;
                }else {
                    vm.namespacelist = [];
                }
            },
            function errorCallback (response){
                vm.namespacelist = [];
            });

    };

    vm.addNamespace = function () {
        var selecteCluster = {};
         angular.forEach(vm.clusterlist, function (value, key) {
             if(value.id == vm.project.ci_type_ticketid )
             {
                 selecteCluster = value;
             }
        });
 
        $uibModal.open({
            templateUrl: 'app/pages/kubernetesmanage/createnamespace.html',
            controller: 'KubernetesCreateNamespaceController',
            controllerAs: 'kubernetescreatenamespace',
            backdrop: 'static',
            size: 'lg',
            keyboard: false,
            bindToController: true,
            resolve: {
                treeid: function () {return vm.treeid},
                ticketid: function () {return vm.project.ci_type_ticketid},
                clusterinfo: function () {return selecteCluster},
                homereload: function () { return vm.getNamespaceList },
            }
        });
    };


//deployment
    vm.getDeploymentList = function(){
        if( vm.project.ci_type_ticketid === "" )
        {
            return;
        }
        $http.get("/api/ci/v2/kubernetes/deployment?ticketid=" +vm.project.ci_type_ticketid + "&namespace=" + vm.project.ci_type_namespace ).then(
            function successCallback(response) {
                if (response.data.stat){

                    vm.deploymentlist = response.data.data;
                }else {
                    vm.deploymentlist = [];
                }
            },
            function errorCallback (response){
                vm.deploymentlist = [];
            });

    };

    vm.createDeployment = function () {
        var selecteCluster = {};
         angular.forEach(vm.clusterlist, function (value, key) {
             if(value.id == vm.project.ci_type_ticketid )
             {
                 selecteCluster = value;
             }
        });
 
        $uibModal.open({
            templateUrl: 'app/pages/kubernetesmanage/createdeployment.html',
            controller: 'KubernetesCreateDeploymentController',
            controllerAs: 'kubernetescreatedeployment',
            backdrop: 'static',
            size: 'lg',
            keyboard: false,
            bindToController: true,
            resolve: {
                treeid: function () {return vm.treeid},
                ticketid: function () {return vm.project.ci_type_ticketid},
                clusterinfo: function () {return selecteCluster},
                namespace: function () {return vm.project.ci_type_namespace},
                name: function () {return ''},
                homereload: function () {return vm.getDeploymentList},
            }
        });
    };

//Container
    vm.getContainerList = function(){
        if( vm.project.ci_type_ticketid === "" )
        {
            return;
        }
        $http.get("/api/ci/v2/kubernetes/app/flowlineinfo?ticketid=" +vm.project.ci_type_ticketid + "&type=deployment&namespace=" + vm.project.ci_type_namespace + "&name=" + vm.project.ci_type_name ).then(
            function successCallback(response) {
                if (response.data.stat){

                    vm.containerlist = response.data.data;
                }else {
                    vm.containerlist = [];
                }
            },
            function errorCallback (response){
                vm.containerlist = [];
            });

    };

    vm.loadks8info = function(){
        vm.getClusterList();
        vm.getNamespaceList();
        vm.getDeploymentList();
        vm.getContainerList();
    };


    vm.changeCluster = function() {
        vm.project.ci_type_namespace = "";
        vm.project.ci_type_name = "";
        vm.project.ci_type_container = "";
        vm.getNamespaceList();
    };

    vm.changeNamespace = function() {
        vm.project.ci_type_name = "";
        vm.project.ci_type_container = "";
        vm.getDeploymentList();
    };
    vm.changeDeployment = function() {
        vm.project.ci_type_container = "";
        vm.getContainerList();
    };


    vm.addImageAddr = function() {
        var matched = false; 
        angular.forEach(vm.containerlist, function (value, key) {
            if( value.name === vm.project.ci_type_container )
            {
                vm.project.ci_type_repository = value.repository;
                matched = true;
            }
        });
 
        if( matched )
        {
            swal({title: "提取成功", text: vm.project.ci_type_repository, type: 'success'});
        }
        else
        {
            swal({title: "提取失败", text: "没有找到镜像仓库信息", type: 'error'});
        }

    };

    vm.addImageAddrByTicket_set = function(repo) {
        vm.project.ci_type_repository = repo
    }
    vm.addImageAddrByTicket = function () {

        $uibModal.open({
            templateUrl: 'app/pages/kubernetesmanage/harborimage.html',
            controller: 'KubernetesHarborImageController',
            controllerAs: 'kubernetesharborimage',
            backdrop: 'static',
            size: 'lg',
            keyboard: false,
            bindToController: true,
            resolve: {
                treeid: function () {return vm.treeid},
                ticketid: function () {return vm.project.follow_up_ticketid},
                homereload: function () {return vm.addImageAddrByTicket_set},
            }
        });
    };

    vm.addHarbor = function () {
        $uibModal.open({
            templateUrl: 'app/pages/global/ticket/createTicket.html',
            controller: 'CreateTicketController',
            controllerAs: 'createticket',
            backdrop: 'static',
            size: 'lg',
            keyboard: false,
            bindToController: true,
            resolve: {
                ticketid: function () {},
                homereload: function () { return vm.reloadticket },
                type: function () { return 'create' },
                title: function () { return '创建Harbor镜像仓库凭据' },
                point: function () { return 'Harbor' },
            }
        });

    };


    }
})();

(function () {
    'use strict';
    CreateProjectByTemplateController.$inject = ["$state", "$http", "ngTableParams", "$uibModalInstance", "$scope", "resoureceService", "treeid", "reload", "$uibModal"];
    angular
        .module('openc3')
        .controller('CreateProjectByTemplateController', CreateProjectByTemplateController);

    function CreateProjectByTemplateController( $state, $http, ngTableParams, $uibModalInstance, $scope, resoureceService, treeid, reload, $uibModal) {

        var vm = this;

        vm.cancel = function(){ $uibModalInstance.dismiss()};

        vm.reload = function(){
            vm.loadover = false;
            $http.get('/api/ci/group/0' ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.activeRegionTable = new ngTableParams({count:20}, {counts:[],data:data.data.reverse()});
                    vm.loadover = true;
                } else { 
                    swal({ title: "加载版本失败!", text: data.info, type:'error' });
                }
            });
        };

        vm.reload();

        vm.copyProjectByTemplate = function (id, name) {
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/flowline/copyProjectByTemplate.html',
                controller: 'CopyProjectByTemplateController',
                controllerAs: 'copyProjectByTemplate',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () { return treeid},
                    sourceid: function () { return id},
                    sourcename: function () { return name},
                    reload : function () { return reload},
                    cancel : function () { return vm.cancel},
                }
            });
        };
    }
})();


(function () {
    'use strict';
    CreateProjectController.$inject = ["$state", "$http", "ngTableParams", "$uibModalInstance", "$scope", "resoureceService", "treeid", "reload"];
    angular
        .module('openc3')
        .controller('CreateProjectController', CreateProjectController);

    function CreateProjectController( $state, $http, ngTableParams, $uibModalInstance, $scope, resoureceService, treeid, reload) {

        var vm = this;

        vm.cancel = function(){ $uibModalInstance.dismiss()};
        vm.add = function(){
            $http.post('/api/ci/group/' + treeid , { name: $scope.projectname } ).success(function(data){
                vm.install = { username: 'root' };
                    if(data.stat == true) {
                        vm.cancel();
                        reload();
                    } else { swal({ title: "创建失败!", text: data.info, type:'error' }); }

            });
        };
    }
})();


(function() {
    'use strict';

showNodeController.$inject = ["$uibModalInstance", "$state", "nodes"];
    angular
        .module('openc3')
        .controller('showNodeController', showNodeController);

    function showNodeController($uibModalInstance, $state, nodes) {

        var vm = this;
        vm.cancel = function(){ $uibModalInstance.dismiss()};
        vm.nodes = nodes;

}})();

(function() {
    'use strict';

HistoryJobxDetailLogController.$inject = ["$uibModalInstance", "taskuuid", "slave"];
    angular
        .module('openc3')
        .controller('HistoryJobxDetailLogController', HistoryJobxDetailLogController);

    function HistoryJobxDetailLogController($uibModalInstance,taskuuid,slave) {
        var vm = this;
        vm.cancel = function(){ $uibModalInstance.dismiss()};
        vm.taskuuid = taskuuid;
        vm.logaddr = slave;

}})();

(function() {
    'use strict';

    HistoryJobxDetailController.$inject = ["$location", "$window", "$timeout", "$interval", "$stateParams", "$state", "$http", "$uibModal", "$scope", "resoureceService", "$injector", "genericService"];
    angular
        .module('openc3')
        .controller('HistoryJobxDetailController', HistoryJobxDetailController)
        .filter('shownode', function () {
            return function (text) {
                var node_str = '';
                var ss = text.split(",");
                if (ss.length >3){
                    node_str = ss.slice(0, 3).join(",") + "..."
                }else {
                    node_str = text;
                }
                return node_str;
            }
        });

    function HistoryJobxDetailController($location, $window, $timeout, $interval,$stateParams,$state, $http, $uibModal, $scope, resoureceService, $injector, genericService) {

        var vm = this;
        vm.chuuid2deploy = function ( uuid ) {

            var u = uuid.slice(uuid.length - 1);
            if (64 < u.charCodeAt(0) && u.charCodeAt(0) < 91) {
                return vm.changeUuid(uuid);
            } else {
                return uuid
            }
        };
        vm.seftime = genericService.seftime

        vm.rollbackexpire = function( starttime )
        {
            var S = new Date()

            var sec =   (S.getTime() - starttime * 1000)  /1000;
            if( sec > 604800 )
            {
                return 1
            }
            else
            {
                return 0
            }
        }

        vm.firstload = true
        vm.changeUuid = function (uuid) {
            var endC = uuid.slice(uuid.length - 1);
            uuid = uuid.slice(0,uuid.length-1);
            if (64 < endC.charCodeAt(0) && endC.charCodeAt(0) < 91) {
                endC  = endC.toLowerCase();
            }else if (96 < endC.charCodeAt(0) && endC.charCodeAt(0) < 123) {
                endC = endC.toUpperCase();
            }
            uuid = uuid + endC;
            return uuid
        }

        vm.getVersionByV = function (text) {
            var w = '';
            var re=/\bversion:.*/;
            if (re.test(text)){
                var reStr = re.exec(text)[0];
                w = reStr.split(":")[1]
            }
         
            return w
        };
 
        vm.getRollbackByV = function (text) {
            var w = '';
            var re=/\b_rollbackVersion_:.*/;
            if (re.test(text)){
                var reStr = re.exec(text)[0];
                w = reStr.split(":")[1]
            }
         
            return w
        };
 



        vm.taskuuid = vm.chuuid2deploy($stateParams.taskuuid);

        vm.accesspage = $stateParams.accesspage;        // 访问方式是否为页面，决定是否显示返回按钮
        vm.treeid = $state.params.treeid;
        vm.rollbackExist = false;
        vm.rollbackName = "_skip_";
        vm.jobinfobyuuid = {}
        vm.mainjobinfobyuuid = {}
        var toastr = toastr || $injector.get('toastr');

        $scope.panelcolor = { "success": "success", "fail": "danger", "refuse": "danger", "running": "info", "decision": "warning", "ignore": "danger" }
        vm.statuszh = { null: "准备","": "等待", "init": "就绪", "success": "成功", "fail": "失败", "refuse": "拒绝", "decision": "待定", "running": "运行中", "ignore": "忽略" }
        vm.backid;
        vm.backidcalled = false;

        vm.cprojectid = function(text) {
            var w = text.split("_");
            if(w[1] == 'ci' && w[0] == '' && w[3] == '' )
            {
                return w[2]
            }
            else
            {
                return ''
            }
        }

        vm.versiondetail = function (id) {
            $state.go('home.quickentry.flowlinedetail', {treeid:vm.treeid, projectid: id});
        };

        if(vm.taskuuid){
            vm.tasklogShow = true;
        }
        vm.jobReloadStatus = {}

        vm.projectinfo = {};
        vm.reload = function(){
            vm.loadover = false
            $http.get('/api/jobx/task/'+ vm.treeid +"/" + vm.taskuuid).then(
                function successCallback(response) {
                    if (response.data.stat){

                        vm.dversion = vm.getVersionByV(response.data.data.variable)
                        vm.rversion = vm.getRollbackByV(response.data.data.variable)

                        $scope.taskDetail = response.data.data;
                        vm.backid = vm.cprojectid($scope.taskDetail.name)
                        if( vm.backid && ! vm.backidcalled )
                        {
                            $http.get('/api/ci/project/'+ vm.treeid + "/" + vm.backid ).then(
                                function successCallback(response) {
                                   if (response.data.stat){
                                       vm.backname  = response.data.data.name;
                                       vm.projectinfo  = response.data.data;
                                   } else{ toastr.error("获取流水线信息失败" + response.data.info);}
                                }, function errorCallback (response){ 
                                toastr.error("获取流水线信息失败" + response.status);
                            });
 
                            vm.backidcalled = true
                        }
                        if (response.data.data.status != "running" && response.data.data.status != "init") {
                            $interval.cancel(F5);
                        }

                        if (vm.rollbackExist) {
                            vm.rollbackLinkShow = true;
                            vm.rollbackShow = false;
                        } else {
                            vm.rollbackLinkShow = false;
                            vm.rollbackShow = true;
                        }
                    }else {
                        toastr.error("获取jobx信息失败" + response.data.info);
                    }
                },
                function errorCallback (response){
                    toastr.error("获取jobx信息失败" + response.status);
                });

                $http.get('/api/jobx/subtask/'+ vm.treeid +"/" + vm.taskuuid).then(
                    function successCallback(response) {
                        if (response.data.stat){
                            $scope.subtaskDetail = response.data.data;

                            vm.loadover = true
                            angular.forEach($scope.subtaskDetail, function (jobinfo, index) {

                               if( ! vm.jobinfobyuuid[jobinfo.uuid] && vm.jobinfobyuuid.default )
                               {
                                   vm.jobinfobyuuid[jobinfo.uuid] = vm.jobinfobyuuid.default
                               }

                               if( jobinfo.status != 'init' && ! vm.jobReloadStatus[jobinfo.uuid] ) {
                                   vm.loadover = false
                                   $http.get('/api/job/subtask/'+ vm.treeid + "/" + jobinfo.uuid).then(
                                       function successCallback(response) {
                                           if (response.data.stat){
                                               vm.jobinfobyuuid[jobinfo.uuid] = response.data.data

                                               if(! vm.jobinfobyuuid.default ) {
                                                    var xxxx = []

                                                    angular.forEach( response.data.data, function (data, index) {
                                                       xxxx.push({ "status": null, "extended": { "name":  data.extended.name} })
                                                    });
                                    
                                               vm.jobinfobyuuid.default = xxxx
                                               }
                                                vm.loadover = true
                                           }else{ toastr.error("获取job信息失败" + response.data.info);}
                                      }, function errorCallback (response){
                                          toastr.error("获取job信息失败" + response.data.info);
                                      });

                                   $http.get('/api/job/task/'+ vm.treeid + "/" + jobinfo.uuid).then(
                                      function successCallback(response) {
                                          if (response.data.stat){
                                              vm.mainjobinfobyuuid[jobinfo.uuid] = response.data.data
                                              if( response.data.data.status == 'success' || response.data.data.status == 'fail' )
                                              {
                                                  vm.jobReloadStatus[jobinfo.uuid] = true
                                              }
                                          } else{ toastr.error("获取job信息失败" + response.data.info);}
                                      }, function errorCallback (response){ 
                                          toastr.error("获取job信息失败" + response.status);
                                      });
                                }
                            });
                        }
                        else
                        {
                            toastr.error("获取jobx信息失败" + response.data.info);
                        }
                    },
                    function errorCallback (response){
                         toastr.error("获取jobx信息失败" + response.status);
                    });
        };




        vm.reloaXd = function(){
            vm.loadoveXr = false
            $http.get('/api/jobx/task/'+ vm.treeid +"/" + vm.taskuuiXd).then(
                function successCallback(response) {
                    if (response.data.stat){
                        $scope.taskDetaiXl = response.data.data;
                        vm.backiXd = vm.cprojectid($scope.taskDetail.name)
                        if (response.data.data.status != "running" && response.data.data.status != "init") {
                            $interval.cancel(FX5);
                        }

                    }else {
                        toastr.error("获取jobx信息失败" + response.data.info);
                    }
                },
                function errorCallback (response){
                    toastr.error("获取jobx信息失败" + response.status);
                });

                $http.get('/api/jobx/subtask/'+ vm.treeid +"/" + vm.taskuuiXd).then(
                    function successCallback(response) {
                        if (response.data.stat){
                            $scope.subtaskDetaiXl = response.data.data;

                            vm.loadoveXr = true
                            vm.firstload = false
                            angular.forEach($scope.subtaskDetaiXl, function (jobinfo, index) {

                               if( ! vm.jobinfobyuuid[jobinfo.uuid] && vm.jobinfobyuuid.default )
                               {
                                   vm.jobinfobyuuid[jobinfo.uuid] = vm.jobinfobyuuid.default
                               }
                               if( jobinfo.status != 'init' && ! vm.jobReloadStatus[jobinfo.uuid] ) {
                                   vm.loadoveXr = false
                                   $http.get('/api/job/subtask/'+ vm.treeid + "/" + jobinfo.uuid).then(
                                       function successCallback(response) {
                                           if (response.data.stat){
                                               vm.jobinfobyuuid[jobinfo.uuid] = response.data.data
                                                vm.loadoveXr = true
                                           }else{ toastr.error("获取job信息失败" + response.data.info);}
                                      }, function errorCallback (response){
                                          toastr.error("获取job信息失败" + response.data.info);
                                      });

                                   $http.get('/api/job/task/'+ vm.treeid + "/" + jobinfo.uuid).then(
                                      function successCallback(response) {
                                          if (response.data.stat){
                                              vm.mainjobinfobyuuid[jobinfo.uuid] = response.data.data
                                              if( response.data.data.status == 'success' || response.data.data.status == 'fail' )
                                              {
                                                  vm.jobReloadStatus[jobinfo.uuid] = true
                                              }
                                          } else{ toastr.error("获取job信息失败" + response.data.info);}
                                      }, function errorCallback (response){ 
                                          toastr.error("获取job信息失败" + response.status);
                                      });
                                }
                            });
                        }
                        else
                        {
                            toastr.error("获取jobx信息失败" + response.data.info);
                        }
                    },
                    function errorCallback (response){
                         toastr.error("获取jobx信息失败" + response.status);
                    });
        };




        vm.runDetail = function (item,jobuuid) {
            var runjobdata = item;
            $uibModal.open({
                templateUrl: 'app/pages/history/job/detail/sublog.html',
                controller: 'HistoryJobDetailSublogController',
                controllerAs: 'historyjobdetailsublog',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    repoData : function () {return runjobdata},
                    subtaskuuid:function () {return runjobdata.uuid},
                    taskuuid:function () {return jobuuid},
                    salve:function () {return vm.mainjobinfobyuuid[jobuuid].slave}
                }
            });
        };
 
        vm.runJobConfirm = function (item,jobuuid) {
            var d = {
                "taskuuid":jobuuid,
                "subtaskuuid":item.uuid,
                "subtasktype":item.subtask_type,
                "control":"next"
            };
            $uibModal.open({
                templateUrl: 'app/pages/history/job/detail/confirm.html',
                controller: 'HistoryJobDetailConfirmController',
                controllerAs: 'historyjobdetailconfirm',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId :function () {return vm.treeid},
                    msg : function () {return item.pause},
                    postdata : function () {return d}
                }
            });// end open
        };

        vm.Runnigs = function (item,jobuuid) {
            var d = {
                "taskuuid":jobuuid,
                "subtaskuuid":item.uuid,
                "subtasktype":item.subtask_type,
                "control":"running"
            };
            resoureceService.task.runRunnings(vm.treeid,  d, null)
                .then(function () {
                })
                .finally(function(){
                });
        };
 
        vm.runIgnore = function (item,jobuuid) {
            var d = {
                "taskuuid":jobuuid,
                "subtaskuuid":item.uuid,
                "subtasktype":item.subtask_type,
                "control":"ignore"
            };
            resoureceService.task.runIgnore(vm.treeid,  d, null)
                .then(function () {
                })
                .finally(function(){
                });
        };
 
        vm.runShutTask = function (item,jobuuid) {
            var d = {
                "taskuuid":jobuuid,
                "subtaskuuid":item.uuid,
                "subtasktype":item.subtask_type,
                "control":"fail"
            };
            resoureceService.task.runShutTask(vm.treeid,  d, null)
                .then(function () {
                })
                .finally(function(){
                });
        };
 
        vm.isRollback = function () {
            var uuid = vm.changeUuid(vm.taskuuid);
            $http.get('/api/jobx/task/' + vm.treeid + "/" + uuid).then(
                function successCallback(response) {
                    if (response.data.stat && response.data.data) {
                        vm.rollbackExist = true;
                        vm.rollbackName = response.data.data.name
                    } else {
                        vm.rollbackExist = false;
                    }
                    vm.reload();
                },
                function errorCallback(response) {
                });
        };
        vm.killTask = function (taskuuid) {
            resoureceService.task.stoptask([vm.treeid,taskuuid],null, null).finally(function(){});
        };
        vm.killTaskByJs = function () {
            var promise =  $http.delete('/api/jobx/task/' + vm.treeid + '/' + vm.taskuuid)
            return promise.then(function (data) {
                var response = data.data;
                return response.data
            });
        };
        vm.runConfirm = function (subuuid) {
            resoureceService.task.confirmtask([vm.treeid,subuuid],null, null)
                .then(function (repo) {
                })
                .finally(function(){});
        };


        vm.sleep = function (sec){
            var tt = new Date().getTime();
            while(new Date().getTime() - tt <= sec);
        };

        vm.rollbackJudge = function (rollbackType) {
            if (rollbackType == "rollback" && $scope.taskDetail.status == "running") {
                swal({
                    title: '操作中...',
                    showConfirmButton: false
                });
                var Kill = $interval(function () {
                    if ($scope.taskDetail.status != "running"){
                        vm.rollback(rollbackType);
                        $interval.cancel(Kill);
                    }
                    vm.killTaskByJs();
                    vm.reload();
                }, 3000);
            }else {
                vm.rollback(rollbackType);
            }

        };
        vm.rollback = function (rollbackType) {
            $http.put('/api/jobx/task/' + vm.treeid + '/' + vm.taskuuid + '/' + rollbackType).then(
                function successCallback(response) {
                    // if (JSON.stringify(response.data)) {
                    //     swal("执行成功");
                    // } else {
                    //     swal("执行失败");
                    // }
                    $window.location.reload();
                },
                function errorCallback(response) {
                });
            return
        }
        vm.taskuuiXd = vm.changeUuid(vm.taskuuid);
        vm.rollbackLink = function () {
            var curUrl = $location.absUrl();
            var uuid = vm.changeUuid(vm.taskuuid);
            $state.go('home.history.jobxdetail', {treeid:vm.treeid, taskuuid:uuid, accesspage:true});
        }
        vm.showRollbackInfo = function () {
            if (vm.rollbackName == "_skip_") {
                return '不回滚'
            } else {
                return '已回滚'
            }
        };
        vm.runtaskDetail = function (subuuid) {
            window.open('/#/history/jobdetail/' + vm.treeid +"/"+ subuuid, '_blank')
        };
        $scope.setStatuColor = function (tag) {
            var c = "";

            if(!tag){
                c = "#aaa";
            }
            else if (tag == "success"){
                c = "green";
            }else if (tag == "fail"){
                c = "red";
            }else if (tag == "refuse"){
                c = "red";
            }else if (tag == "init"){
                c = "#473e3e"
            }else if(tag == "running"){
                c = "#ff6211"
            }else if(tag == "WaitConfirm"){
                c = "#089fb8";
            }
            return {"color" : c ,"font-weight": "bold"}

        };
        vm.taskLogDetail = function () {
            $uibModal.open({
                templateUrl: 'app/pages/history/jobx/detail/log.html',
                controller: 'HistoryJobxDetailLogController',
                controllerAs: 'historyjobxdetaillog',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                clickOutsideToClose:false,
                resolve: {
                    taskuuid:function () {return vm.taskuuid},
                    slave:function () {return $scope.taskDetail.slave},
                }
            });
        };
        vm.taskLogDetaiXl = function () {
            $uibModal.open({
                templateUrl: 'app/pages/history/jobx/detail/log.html',
                controller: 'HistoryJobxDetailLogController',
                controllerAs: 'historyjobxdetaillog',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                clickOutsideToClose:false,
                resolve: {
                    taskuuid:function () {return vm.taskuuiXd},
                    slave:function () {return $scope.taskDetaiXl.slave},
                }
            });
        };

        vm.describedeployment = function (type,name,namespace) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/describedeployment.html',
                controller: 'KubernetesDescribeDeploymentController',
                controllerAs: 'kubernetesdescribedeployment',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return vm.projectinfo.ci_type_kind},
                    name: function () {return vm.projectinfo.ci_type_name},
                    namespace: function () {return vm.projectinfo.ci_type_namespace},
                    ticketid: function () {return vm.projectinfo.ci_type_ticketid}, 
                }
            });
        };



        vm.showNode = function (nods) {
            $uibModal.open({
                templateUrl: 'app/pages/history/jobx/detail/shownode.html',
                controller: 'showNodeController',
                controllerAs: 'shownode',
                backdrop: 'static',
                size: 'lg',
                keyboard:true,
                bindToController: true,
                resolve: {
                    nodes:function () {return nods},
                }
            });
        };
        vm.isRollback(); 

        var F5 = $interval(function () {
            vm.reload();
        }, 5000);
        var FX5 = $interval(function () {
            if( vm.rversion )
            {
                 vm.reloaXd();
            }
        }, 5000);

 
        $scope.$on('$destroy', function(){
            $interval.cancel(F5);
            $interval.cancel(FX5);
        });
    }

})();

(function() {
    'use strict';

HistoryJobDetailSublogController.$inject = ["$uibModalInstance", "$scope", "$interval", "$state", "$http", "repoData", "subtaskuuid", "taskuuid", "salve", "genericService"];
    angular
        .module('openc3')
        .controller('HistoryJobDetailSublogController', HistoryJobDetailSublogController);

    function HistoryJobDetailSublogController($uibModalInstance,$scope,$interval, $state, $http, repoData, subtaskuuid, taskuuid, salve, genericService) {

        var vm = this;
        vm.seftime = genericService.seftime
        vm.treeid = $state.params.treeid;
        vm.cancel = function(){ $uibModalInstance.dismiss()};
        vm.taskuuid = taskuuid;
        vm.logaddr = salve;
        vm.loguuid = taskuuid+subtaskuuid+repoData.subtask_type;

        vm.statuszh = { "": "等待执行", "success": "执行成功", "fail": "执行失败", "decision": "执行失败", "running": "执行中", "ignore": "忽略" }
        vm.statuscolor = { "": "#aaa", "success": "green", "fail": "red", "decision": "red", "running": "orange" }
        vm.pluginname = { "approval": "审批", "cmd": "远程命令", "scp": "同步文件" }

        vm.reload = function () {
            $http.get('/api/job/subtask/' + vm.treeid + "/" + taskuuid +"/"+subtaskuuid).then(
                function successCallback(response){
                    if (response.data.stat){
                        vm.taskInfo = response.data.data;
                        $scope.statucolor = { "color": vm.statuscolor[vm.taskInfo.status] }
                        if( vm.taskInfo.status == 'success' || vm.taskInfo.status == 'fail')
                        {
                            $interval.cancel(reRun);
                        }
                    }else{
                        swal('获取信息失败', response.data.info, 'error' );
                    }
                },
                function errorCallback (response){
                    swal('获取信息失败', response.status, 'error' );
                });
        };

        vm.reload();
        var reRun = $interval(function () {
            vm.reload();
        }, 5000);

        $scope.$on('$destroy', function(){
            $interval.cancel(reRun);
        });

}})();

(function() {
    'use strict';

HistoryJobDetailLogController.$inject = ["$uibModalInstance", "taskuuid", "slave"];
    angular
        .module('openc3')
        .controller('HistoryJobDetailLogController', HistoryJobDetailLogController);

    function HistoryJobDetailLogController($uibModalInstance,taskuuid,slave) {
        var vm = this;
        vm.cancel = function(){ $uibModalInstance.dismiss()};
        vm.taskuuid = taskuuid;
        vm.logaddr = slave;

}})();

(function() {
    'use strict';

    HistoryJobDetailController.$inject = ["$interval", "$location", "$state", "$http", "$uibModal", "$stateParams", "$scope", "$injector", "genericService"];
    angular
        .module('openc3')
        .controller('HistoryJobDetailController', HistoryJobDetailController);

    function HistoryJobDetailController($interval, $location, $state, $http, $uibModal, $stateParams, $scope, $injector, genericService) {

        var vm = this;
        vm.seftime = genericService.seftime
        vm.treeid = $state.params.treeid;
        vm.taskuuid = $state.params.taskuuid;
        vm.jobuuid = $stateParams.jobuuid;
        vm.jobtype = $stateParams.jobtype;
        vm.tasklength = 0;
        vm.allRuningData = [];
        vm.statuszh = { "": "等待执行", "success": "执行成功", "fail": "执行失败","refuse":"审批拒绝", "decision": "执行失败", "running": "执行中", "ignore": "忽略" }
        vm.statuscolor = { "": "#aaa", "success": "green", "fail": "red", "refuse": "orange", "decision": "red", "running": "orange" }

        $scope.setStatuColor = function (stat) {
            if(!stat){ stat = "" }
            return {"color" : vm.statuscolor[stat] ,"font-weight": "bold"}
        };

        var toastr = toastr || $injector.get('toastr');

        vm.getScpCmdTask = function () {
            $http.get('/api/job/task/' + vm.treeid + "/" + vm.taskuuid  ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        var quickData = response.data.data;
                        var serverCount = response.data.data.slave.split(",").length;
                        quickData.count = serverCount;
                        vm.allRuningData.splice(0, vm.allRuningData.length);
                        vm.allRuningData.push(quickData);

                    }else {
                        swal('获取信息失败', response.data.info, 'error' );
                    }
                },
                function errorCallback (response){
                    swal('获取信息失败', response.status, 'error' );
                });
        };
        vm.show = {}
        vm.HideMsg = function (id) {
            if( ! vm.show[id] )
            {
                vm.show[id] = 0
            }
            if( vm.show[id] )
            {
                vm.show[id] = 0
            }
            else
            {
                vm.show[id] = 1
            }
        };

        vm.getsubTaskDetails = function () {
            $http.get('/api/job/subtask/' + vm.treeid+ "/" + vm.taskuuid).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.allRuningData = response.data.data;
                        vm.tasklength = vm.allRuningData.length -1;
                    }else {
                        swal('获取信息失败', response.data.info, 'error' );
                    }
                },
                function errorCallback (response){
                    swal('获取信息失败', response.status, 'error' );
                });

        };
        vm.runDetail = function (idx) {
            var runjobdata = vm.allRuningData[idx];
            $uibModal.open({
                templateUrl: 'app/pages/history/job/detail/sublog.html',
                controller: 'HistoryJobDetailSublogController',
                controllerAs: 'historyjobdetailsublog',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    repoData : function () {return runjobdata},
                    subtaskuuid:function () {return runjobdata.uuid},
                    taskuuid:function () {return vm.taskuuid},
                    salve:function () {return $scope.salve}
                }
            });
            vm.reload();
        };

        vm.killTask = function(){
            swal({
                title: "终止任务",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                cancelButtonText: "取消",
                confirmButtonText: "确定",
                closeOnConfirm: true
            }, function(){
                $http.delete( '/api/job/slave/' + $scope.salve + "/killtask/" + vm.taskuuid ).success(function(data){
                    if (data.stat){
                        vm.reload();
                    }else {
                        swal({ title:'终止任务失败', text: data.info, type:'error' });
                    }
 
                });
              });
        };

        vm.taskLogDetail = function () {
            $uibModal.open({
                templateUrl: 'app/pages/history/job/detail/log.html',
                controller: 'HistoryJobDetailLogController',
                controllerAs: 'historyjobdetaillog',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    taskuuid:function () {return vm.taskuuid},
                    slave:function () {return $scope.salve},
                    errormsg:function () {return $scope.errorreason}
                }
            });
        };

        vm.Runnigs = function (idx, item) {
            var d = {
                "taskuuid":vm.taskuuid,
                "subtaskuuid":item.uuid,
                "subtasktype":item.subtask_type,
                "control":"running"
            };

            swal({
                title: "重试任务",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                cancelButtonText: "取消",
                confirmButtonText: "确定",
                closeOnConfirm: true
            }, function(){
                $http.put( '/api/job/subtask/' + vm.treeid, d ).success(function(data){
                    if (data.stat){
                        vm.reload();
                    }else {
                        toastr.error("操作失败"+data.info);
                    }
                });
              });
        };

        vm.runIgnore = function (idx, item) {
            var d = {
                "taskuuid":vm.taskuuid,
                "subtaskuuid":item.uuid,
                "subtasktype":item.subtask_type,
                "control":"ignore"
            };
            swal({
                title: "忽略错误",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                cancelButtonText: "取消",
                confirmButtonText: "确定",
                closeOnConfirm: true
            }, function(){
                $http.post( '/api/job/subtask/' + vm.treeid, d ).success(function(data){
                    if (data.stat){
                        vm.reload();
                    }else {
                        toastr.error("操作失败"+data.info);
                    }
                });
              });
  
        };

        vm.runShutTask = function (idx, item) {
            var d = {
                "taskuuid":vm.taskuuid,
                "subtaskuuid":item.uuid,
                "subtasktype":item.subtask_type,
                "control":"fail"
            };

            swal({
                title: "终止整个任务",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                cancelButtonText: "取消",
                confirmButtonText: "确定",
                closeOnConfirm: true
            }, function(){
                $http.post( '/api/job/subtask/' + vm.treeid, d ).success(function(data){
                    if (data.stat){
                        vm.reload();
                    }else {
                        toastr.error("操作失败"+data.info);
                    }
                });
              });

        };

        vm.runConfirm = function (idx, item,runmsg) {
            var d = {
                "taskuuid":vm.taskuuid,
                "subtaskuuid":item.uuid,
                "subtasktype":item.subtask_type,
                "control":"next"
            };
            $uibModal.open({
                templateUrl: 'app/pages/history/job/detail/confirm.html',
                controller: 'HistoryJobDetailConfirmController',
                controllerAs: 'historyjobdetailconfirm',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId :function () {return vm.treeid},
                    msg : function () {return runmsg},
                    postdata : function () {return d}
                }
            });
            vm.reload();
        };

        vm.reload =  function () {
            vm.loadover = false
            $http.get('/api/job/task/' + vm.treeid + "/" + vm.taskuuid).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.loadover = true
                        var task_msg = response.data.data;
                        $scope.taskname = task_msg.name;
                        $scope.runuser = task_msg.user;
                        $scope.starttime = task_msg.starttime;
                        $scope.errreason = task_msg.reason;
                        $scope.finishtime = task_msg.finishtime;
                        $scope.runtime = task_msg.runtime;
                        $scope.status = task_msg.status;
                        $scope.loguuid = task_msg.uuid+task_msg.jobuuid+task_msg.jobtype.split("_")[1];
                        $scope.jobuuid = task_msg.uuid;
                        $scope.salve = task_msg.slave;
                        $scope.errorreason = task_msg.reason;
                        $scope.variable = task_msg.variable;

                        if ($scope.status == "fail" || $scope.status == "success"){
                            $interval.cancel(reRun);
                        }
                        if (task_msg.jobtype){
                            vm.jobtype = task_msg.jobtype;
                        }
                        if(vm.jobtype =='jobs') {
                            vm.getsubTaskDetails();
                        }else if (vm.jobtype){
                            vm.getScpCmdTask();
                        }

                    }else {
                        swal('获取信息失败', response.data.info, 'error' );
                    }
                },
                function errorCallback (response){
                    swal('获取信息失败', response.status, 'error' );
                });

            };

        vm.reload();

        var reRun = $interval(function () {
            if (vm.taskuuid){ vm.reload(); }
        }, 5000);

        $scope.$on('$destroy', function(){
            $interval.cancel(reRun);
        });
    }

})();

(function () {
    'use strict';
    HistoryJobDetailConfirmController.$inject = ["$uibModalInstance", "$scope", "treeId", "msg", "postdata", "$injector", "$http"];
    angular
        .module('openc3')
        .controller('HistoryJobDetailConfirmController', HistoryJobDetailConfirmController);

    function HistoryJobDetailConfirmController($uibModalInstance, $scope,treeId, msg, postdata, $injector, $http ) {

        var vm = this;
        vm.runmsg = msg;
        vm.cancel = function(){ $uibModalInstance.dismiss()};
        var toastr = toastr || $injector.get('toastr');
        vm.Confirm = function(){
            $http.put( '/api/job/subtask/' + treeId, postdata ).success(function(data){
                if (data.stat){
                    vm.cancel();
                }else {
                    toastr.error("操作失败"+data.info);
                }
            });
 
        };
    }
})();


(function () {
    'use strict';
    GroupInfoController.$inject = ["$uibModalInstance", "$http", "$scope", "ngTableParams", "resoureceService", "treeId", "selectedType", "allmachineInfo", "$injector"];
    angular
        .module('openc3')
        .controller('GroupInfoController', GroupInfoController);

    function GroupInfoController($uibModalInstance,$http, $scope, ngTableParams,resoureceService, treeId, selectedType,allmachineInfo, $injector) {

        var vm = this;
        $scope.selected = [];
        $scope.selectedData = [];
        $scope.allData = [];
        $scope.allType = [];
        $scope.selected_inip = [];
        $scope.selected_exip = [];
        $scope.selected_name = [];
        $scope.radioselected = {};
        $scope.selectedData = [];
        $scope.selectedDataName = [];
        $scope.selectedDataInip = [];
        $scope.selectedDataExip = [];
        $scope.selectType = [];
        $scope.unClick = "true";
        var toastr = toastr || $injector.get('toastr');

        vm.showMachine = function () {
            if (allmachineInfo && allmachineInfo.stat){
                if (selectedType == "machineName") {
                    vm.machine_Table = new ngTableParams({count: 10}, {counts: [], data: allmachineInfo.data.reverse()});
                    $scope.allData = allmachineInfo.data;
                    vm.choiceType = "ip";

                }else if (selectedType =="machineType" ){
                    angular.forEach(allmachineInfo.data, function(data){
                        if ($scope.allType.indexOf(data.type) == -1){
                            $scope.allType.push(data.type);
                        }
                    });
                    vm.type_Table = new ngTableParams({count: 10}, {counts: [], data: $scope.allType});

                    vm.choiceType = "group";
                }
            }else {
                toastr.error( "获取机器信息失败!" )
            }
        };

        vm.cleanSelected = function () {
            $scope.selected = [];
            var from = $scope.formType;

            if (from == "ip"){
                $scope.allData = vm.machineData;
            }else if(from == "group"){
                $scope.allData = vm.groupData;
            }
        };

        vm.cancel = function(){
            $uibModalInstance.dismiss()
        };

        vm.ok = function(){
            var ips = [];
            var re_ips = ips.concat($scope.selectedDataName, $scope.selectedDataInip, $scope.selectedDataExip);

            if (selectedType == "machineName"){
                $uibModalInstance.close(
                    re_ips
                );

            }else if (selectedType =="machineType" ){
                $uibModalInstance.close(
                    $scope.selectType
                )
            }

        };
        var changeSelected = function (action, id, data, type) {
            if (action == 'add') {
                if (type == 'name'){
                    $scope.selected_name.push(id);
                    $scope.selectedDataName.push(data);
                }
                if (type == 'inip'){
                    $scope.selected_inip.push(id);
                    $scope.selectedDataInip.push(data);
                }
                if (type == 'exip'){
                    $scope.selected_exip.push(id);
                    $scope.selectedDataExip.push(data);
                }
            }
            if (action == 'remove'){
                if (type == 'name'){
                    $scope.selected_name.splice($scope.selected_name.indexOf(id), 1);
                    $scope.selectedDataName.splice($scope.selectedDataName.indexOf(data), 1)
                }
                if (type == 'inip'){
                    $scope.selected_inip.splice($scope.selected_inip.indexOf(id), 1);
                    $scope.selectedDataInip.splice($scope.selectedDataInip.indexOf(data), 1)
                }
                if (type == 'exip'){
                    $scope.selected_exip.splice($scope.selected_exip.indexOf(id), 1);
                    $scope.selectedDataExip.splice($scope.selectedDataExip.indexOf(data), 1)
                }
            }
        };
        // 机器名称
        $scope.nameUpdateSelection = function ($event, id, data) {
            var checkbox = $event.target;
            var action = (checkbox.checked ? 'add' : 'remove');
            changeSelected(action, id, data, 'name');
        };
        // 内网IP
        $scope.inipUpdateSelection = function ($event, id, data) {
            var checkbox = $event.target;
            var action = (checkbox.checked ? 'add' : 'remove');
            changeSelected(action, id, data, 'inip');
        };
        // 外网IP
        $scope.exipUpdateSelection = function ($event, id, data) {
            var checkbox = $event.target;
            var action = (checkbox.checked ? 'add' : 'remove');
            changeSelected(action, id, data, 'exip');
        };

        var updateSelected = function (action, id, data) {
            if (action == 'add' & $scope.selected.indexOf(id) == -1) {
                $scope.selected.push(id);
                $scope.selectedData.push(data.name);
            }
            if (action == 'remove' && $scope.selected.indexOf(id) != -1){
                $scope.selected.splice($scope.selected.indexOf(id), 1);
                $scope.selectedData.splice($scope.selectedData.indexOf(data.name), 1)
            }
        };
        var updateTypeSelected = function (action, data) {
            if (action == 'add' & $scope.selectType.indexOf(data) == -1) {
                $scope.selectType.push(data);
            }
            if (action == 'remove' && $scope.selected.indexOf(data) != -1){
                $scope.selectType.splice($scope.selectType.indexOf(data), 1);
            }
        };
        $scope.updateSelection = function ($event, id, data) {
            var checkbox = $event.target;
            var action = (checkbox.checked ? 'add' : 'remove');
            updateSelected(action, id, data);
        };
        $scope.updateTypeSelection = function ($event, data) {
            var checkbox = $event.target;
            var action = (checkbox.checked ? 'add' : 'remove');
            updateTypeSelected(action, data);
        };
        $scope.selectAll = function ($event) {
            var checkbox = $event.target;
            var action = (checkbox.checked ? 'add' : 'remove');
            for (var i = 0; i < $scope.allData.length; i++) {
                var entity = $scope.allData[i];
                updateSelected(action, entity.id, entity);
            }
        };
        // $scope.getSelectedClass = function (entity) {
        //     return $scope.isSelected(entity.id) ? 'selected' : '';
        // };
        $scope.isSelected = function (id, type) {
            if (type == 'name'){
                return $scope.selected_name.indexOf(id) >= 0;
            }
            if (type == 'inip'){
                return $scope.selected_inip.indexOf(id) >= 0;
            }
            if (type == 'exip'){
                return $scope.selected_exip.indexOf(id) >= 0;
            }
        };
        $scope.isTypeSelected = function (data) {
            return $scope.selectType.indexOf(data) >= 0;
        };
        $scope.isSelectedAll = function () {
            return $scope.selected.length === $scope.allData.length;
        };
        vm.showMachine();

    }
})();


(function() {
    'use strict';

scpJobController.$inject = ["$scope", "$filter", "$state", "$http", "$uibModalInstance", "$window", "$uibModal", "$timeout", "treeService", "resoureceService", "scriptId", "editData", "seq"];
    angular
        .module('openc3')
        .controller('scpJobController', scpJobController);

    function scpJobController($scope,$filter, $state, $http,$uibModalInstance,$window,$uibModal, $timeout,treeService,resoureceService, scriptId, editData, seq) {

        var vm = this;
        $scope.dataready = true;
        vm.choiceNode = [];
        vm.choiceAllFiles = [];
        vm.scriptid = scriptId.getter();
        scriptId.del();
        vm.treeid = $state.params.treeid;
        vm.scriptHide = true;
        $scope.srcShow = false;
        $scope.varShow = false;
        $scope.choiceShow = false;

        vm.postdata = { deployenv: 'always', action: 'always', batches: 'always' };

        $scope.userShow = false;
        $scope.chownShow = false;
        $scope.dstServerShow = false;
        $scope.srcServerShow = false;
        $scope.scp_dir = true;
        $scope.title = "目标路径以'/'结尾代表一个目录，不以‘/’结尾表示一个文件。如：/tmp/表示将文件保存到此目录下，/tmp/test.txt表示将文件保存到此目录下，文件名为test.txt";
        $scope.varData = {
            'ci':null,
            'version':null
        };
        $scope.srcDate = {
            'sp':'',
            'src_type':'',
            'src':'',
        };
        $scope.dstDate = {
            'plugin_type':'scp',
            'name':'',
            'user':'',
            'dst_type':'',
            'dst':'',
            'dp':'',
            'chown':'',
            'chmod':'755',
            'timeout':'60',
            'pause':'',
        };
        if (!editData){$scope.dstDate.name = "文件分发_"+seq};
        $scope.copySrcdata = angular.copy($scope.srcDate);
        vm.cancel = function(){ $uibModalInstance.dismiss()};

        vm.getProUser = function () {
            if (vm.treeid){
                $http.get('/api/job/userlist/' + vm.treeid).then(

                    function successCallback (response) {
                        if (response.data.stat){
                            $scope.dataready = true;
                            $scope.allProUsers= response.data.data;
                        }else {
                            $scope.dataready = false;
                            $scope.dataerror = "获取账户信息失败："+response.data.info;
                        }
                    },
                    function errorCallback () {
                        $scope.dataready = false;
                        $scope.dataerror = "获取账户信息失败："+response.status;
                    }
                );
            }
        };

        vm.addProUser = function () {
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/addUser.html',
                controller: 'AddUserController',
                controllerAs: 'addUser',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    reloadUser : function () { return vm.getProUser}
                }
            });
        };

        vm.delChoice = function (id, name) {
            if (id >=0){
                $scope.choiceResult.splice(id, 1);
                angular.forEach(vm.choiceNode, function (data, index) {
                    if (data == name){
                        vm.choiceNode.splice(index, 1);
                    }
                });
                $scope.dstDate.dst = vm.choiceNode.join(",")
            }
        };

        vm.choiceSourceServer = function () {
            var openChoice = $uibModal.open({
                templateUrl: 'app/components/machine/choiceMachine.html',
                controller: 'ChoiceController',
                controllerAs: 'choice',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},

                }
            });
            openChoice.result.then(
                function (result) {
                    if (result.length != 0){
                        if (result.length >0){
                            if (result[0].plugin){
                                $scope.copySrcdata.src_type = "group";
                                $scope.copySrcdata.src = result[0].id;
                                $scope.srouceServerResult ="组： "+result[0].name;
                                $scope.copySrcdata.src_group = result[0].name;
                            }else{
                                $scope.copySrcdata.src_type = "builtin";
                                $scope.srouceServerResult = "节点： ";
                                vm.choiceNode.splice(0, vm.choiceNode.length);
                                angular.forEach(result, function (data) {
                                    vm.choiceNode.push(data);
                                    $scope.srouceServerResult += data+ ",";
                                });
                                $scope.copySrcdata.src = vm.choiceNode.join(",")
                            }
                        }
                        else if(result.variable){
                            $scope.copySrcdata.src_type = "variable";
                            $scope.copySrcdata.src = result.variable;
                            $scope.srouceServerResult = result.variable;
                        }
                    }
                },function (reason) {
                    console.log("error reason", reason)
                }
            );

        };

        // 选择目标地址
        vm.choiceServer = function () {
            var openChoice = $uibModal.open({
                templateUrl: 'app/components/machine/choiceMachine.html',
                controller: 'ChoiceController',
                controllerAs: 'choice',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},

                }
            });
            openChoice.result.then(
                function (result) {
                    if (result.length != 0){
                        $scope.choiceShow = true;
                        $scope.choiceResult = result;
                        if (result.length >0){
                            if (result[0].plugin){
                                $scope.choiceType = "分组类型";
                                $scope.dstDate.dst_type = "group";
                                $scope.dstDate.dst = result[0].id;
                                vm.choiceNode.splice(0, vm.choiceNode.length);
                                // angular.forEach(result, function (data) {
                                //     vm.choiceNode.push(data.id);
                                // });
                            }
                            else {
                                $scope.choiceType = "节点类型";
                                $scope.dstDate.dst_type = "builtin";
                                vm.choiceNode.splice(0, vm.choiceNode.length);
                                angular.forEach(result, function (data) {
                                    vm.choiceNode.push(data);
                                });
                                $scope.dstDate.dst = vm.choiceNode.join(",")
                            }
                        }
                        else if(result.variable){
                            $scope.dstDate.dst_type = "variable";
                            $scope.choiceType = "变量";
                            $scope.choiceResult = [result];
                            $scope.dstDate.dst = result.variable;
                            vm.choiceNode.push(result.variable);
                        }

                    }
                },function (reason) {
                    console.log("error reason", reason)
                }
            );
        };
        vm.choiceVariable = function () {
            var openChoice = $uibModal.open({
                templateUrl: 'app/components/variable/choiceVar.html',
                controller: 'ChoiceVarController',
                controllerAs: 'choicevar',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {}
            });
            openChoice.result.then(
                function (result) {
                    if (result.length != 0){
                        $scope.srcShow = false;
                        $scope.shareResult = [];
                        $scope.varShow = true;
                        $scope.varData = result;
                        $scope.copySrcdata.src = result.ci;
                        $scope.copySrcdata.src_type = "ci";
                        $scope.copySrcdata.sp = result.version;
                    }
                },function (reason) {
                    console.log("error reason", reason)
                }
            );
        };
        vm.choiceSourceFile = function () {
            vm.choiceSourceServer();
            $scope.varShow = false;
            $scope.srcShow = true;
            $scope.copySrcdata.sp = '';
            $scope.copySrcdata.src = '';
            $scope.srouceServerResult = "";
            $scope.shareResult = [];
        };
        vm.choiceShareFiles = function () {
            var openChoice = $uibModal.open({
                templateUrl: 'app/pages/business/file/choiceFile.html',
                controller: 'ChoiceFileController',
                controllerAs: 'choicefile',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {}
            });
            openChoice.result.then(
                function (result) {
                    if (result.length != 0){
                        $scope.srcShow = false;
                        $scope.varShow = false;
                        $scope.shareResult = result;
                        console.log(result[0].name);
                        console.log(typeof result[0]);
                        $scope.copySrcdata.sp = result[0].name;
                        $scope.copySrcdata.src_type = "fileserver";
                        $scope.copySrcdata.src = "";
                    }
                },function (reason) {
                    console.log("error reason", reason)
                }
            ); // end result
        };

        vm.runLog = function(d){
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/taskDetail.html',
                controller: 'JobDetailController',
                controllerAs: 'jobDetail',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    repoData : function () { return d}
                }
            });
        };

        vm.returnData = function () {
            if($scope.copySrcdata.src_type){
                if($scope.copySrcdata.src_type != "fileserver" && !$scope.copySrcdata.src){
                    alert("请选择源服务器");
                    $scope.srcServerShow = true;
                }else {
                    $scope.srcServerShow = false;
                }
            }else {
                $scope.srcServerShow = true;
                alert("请选择源服务器");
            }

            if ($scope.dstUser){
                $scope.dstDate.user = $scope.dstUser;
                $scope.userShow = false;
            }else {
                $scope.userShow = true;
            }

            if ($scope.fileChown){
                $scope.dstDate.chown = $scope.fileChown;
                $scope.chownShow = false;
            }else {
                $scope.chownShow = true;
            }

            if($scope.dstDate.dst){
                $scope.dstServerShow = false;
            }else {
                $scope.dstServerShow = true;
                alert("请选择目标服务器");
                return
            }
            $scope.dstDate.timeout = parseInt($scope.dstDate.timeout);
            var post_data = $.extend($scope.dstDate, $scope.copySrcdata);
            post_data.deployenv = vm.postdata.deployenv;
            post_data.action = vm.postdata.action;
            post_data.batches = vm.postdata.batches;
            $uibModalInstance.close(
                post_data
            );
        };

        vm.getProUser();

        if (editData){
            $scope.editmode = true;
            $scope.dstDate.name = editData.name;

            vm.postdata = { deployenv: editData.deployenv, action: editData.action, batches: editData.batches };

            if (editData.src_type == "fileserver"){
                $scope.shareResult = [{"name":editData.sp}];
                $scope.copySrcdata.sp = editData.sp;
                $scope.copySrcdata.src_type = editData.src_type;
            }else if(editData.src_type == "ci"){
                $scope.varShow = true;
                $scope.varData = {'version':editData.sp, 'ci':editData.src};
                $scope.copySrcdata.sp = editData.sp;
                $scope.copySrcdata.src_type = editData.src_type;
                $scope.copySrcdata.src = editData.src;
            }
            else {
                $scope.srcShow = true;
                $scope.shareResult = [];
                $scope.copySrcdata.sp = editData.sp;
                $scope.copySrcdata.src_type = editData.src_type;
                $scope.copySrcdata.src = editData.src;
                if (editData.src_type == "group"){
                    $scope.srouceServerResult ="组： "+ editData.src_group;
                }else if(editData.src_type == "builtin"){
                    $scope.srouceServerResult = "节点： " + editData.src;
                    if (editData.dp.endsWith("/")) {
                        $scope.scp_dir = true;
                        if (editData.scp_delete == 1) {$scope.dstDate.scp_delete = true;}
                    };
                }else if(editData.src_type == "variable"){
                    $scope.srouceServerResult = editData.src;
                }
            }
            $scope.dstUser = editData.user;
            $scope.dstDate.user = editData.user;
            $scope.dstDate.dp = editData.dp;
            $scope.dstDate.dst_type = editData.dst_type;
            // dp:"/tmp/ttt"
            // dst:"10.60.1.1"
            // dst_type:"builtin"
            $scope.nodeType = editData.dst_type;
            $scope.choiceResult = [];
            if ($scope.nodeType == "group"){
                $scope.choiceType = "分组类型";
                // choiceResult
                $http.get('/api/job/nodegroup/' + vm.treeid +"/"+ editData.dst).then(
                    function successCallback (response) {
                        if (response.data.stat){
                            $scope.choiceResult.push({"name":response.data.data.name});
                        }else {
                        }
                    },
                    function errorCallback () {
                    }
                );
                vm.choiceNode.push(editData.dst);
                $scope.dstDate.dst = editData.dst;
                $scope.choiceShow = true;

            }else if($scope.nodeType == "builtin"){
                $scope.choiceType = "节点类型";
                angular.forEach(editData.dst.split(","), function (ip, index) {
                    $scope.choiceResult.push(ip);
                    vm.choiceNode.push(ip);
                });
                $scope.choiceShow = true;
                $scope.dstDate.dst = vm.choiceNode.join(",");

            }else if($scope.nodeType == "variable"){
                $scope.choiceType = "变量";
                // angular.forEach(editData.dst.split(","), function (ip, index) {
                //     $scope.choiceResult.push(ip);
                //     vm.choiceNode.push(ip);
                // });
                $scope.choiceResult.push({"variable":editData.dst});
                $scope.choiceShow = true;
                $scope.dstDate.dst = editData.dst;

            }

            $scope.dstDate.dp = editData.dp;
            $scope.fileChown = editData.chown;
            $scope.dstDate.chmod = editData.chmod;
            $scope.dstDate.timeout = parseInt(editData.timeout);
            $scope.dstDate.pause = editData.pause;

        }
}})();

(function() {
    'use strict';

scriptJobController.$inject = ["$scope", "$filter", "$state", "$http", "$window", "$uibModal", "$uibModalInstance", "$timeout", "treeService", "resoureceService", "treeId", "editData", "seq"];
    angular
        .module('openc3')
        .controller('scriptJobController', scriptJobController);

    function scriptJobController($scope,$filter, $state, $http,$window,$uibModal,$uibModalInstance, $timeout,treeService,resoureceService,treeId, editData, seq) {
        var vm = this;

        $scope.dataready = true;
        vm.choiceNode = [];
        vm.treeid = treeId;
        vm.scriptHide = true;
        $scope.choiceShow = false;
        $scope.s_timeout = '60';
        $scope.scriptType = "shell";
        $scope.scriptUnclick = false;
        if (!editData){$scope.s_name = "执行脚本_"+seq};

        vm.postdata = { deployenv: 'always', action: 'always', batches: 'always' };

        vm.cancel = function(){ $uibModalInstance.dismiss()};

        vm.getAllScript = function () {
            vm.scriptHide = true;
            if (vm.treeid){
                $http.get('/api/job/scripts/' + vm.treeid).success(function(data){
                    vm.scriptHide = true;
                    if (data.stat){
                        $scope.allScript = data.data;
                    }
                });
            }
        };

        vm.getProUser = function () {
            if (vm.treeid){
                $http.get('/api/job/userlist/' + vm.treeid).then(
                    function successCallback (response) {
                        if (response.data.stat){
                            $scope.dataready = true;
                            $scope.allProUsers = response.data.data;
                        }else {
                            $scope.dataready = false;
                            $scope.dataerror = "获取账户信息失败："+response.data.info;
                        }
                    },
                    function errorCallback () {
                        $scope.dataready = false;
                        $scope.dataerror = "获取账户信息失败：";
                    }
                );
            }
        };

        vm.addProUser = function () {
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/addUser.html',
                controller: 'AddUserController',
                controllerAs: 'addUser',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    reloadUser : function () { return vm.getProUser}
                }
            });
        };

        vm.delChoice = function (id, name) {
            if (id >=0){
                $scope.choiceResult.splice(id, 1);
                angular.forEach(vm.choiceNode, function (data, index) {
                    if (data == name){
                        vm.choiceNode.splice(index, 1);
                    }
                });

            }
        };

        vm.choiceServer = function () {
            var openChoice = $uibModal.open({
                templateUrl: 'app/components/machine/choiceMachine.html',
                controller: 'ChoiceController',
                controllerAs: 'choice',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                }
            });
            openChoice.result.then(
                function (result) {
                    if (result.length != 0){
                        $scope.choiceShow = true;
                        $scope.choiceResult = result;
                        if (result.length >0){
                            if (result[0].plugin){
                                $scope.choiceType = "分组类型";
                                $scope.nodeType = "group";
                                vm.choiceNode.splice(0, vm.choiceNode.length);
                                angular.forEach(result, function (data) {
                                    vm.choiceNode.push(data.id);
                                });
                            }else {
                                $scope.choiceType = "节点类型";
                                $scope.nodeType = "builtin";
                                vm.choiceNode.splice(0, vm.choiceNode.length);
                                angular.forEach(result, function (data) {
                                    vm.choiceNode.push(data);
                                });
                            }
                        } else if(result.variable){
                            $scope.nodeType = "variable";
                            vm.dstServevar = result.variable;
                            $scope.choiceType = "变量类型";
                            $scope.choiceResult = [result];
                            vm.choiceNode = [];
                            vm.choiceNode.push(result.variable);
                        }
                    }
                },function (reason) {
                    console.log("error reason", reason)
                }
            );
        };

        vm.editorSh = function (data, re) {
            vm.shEditor = ace.edit("editor");
            var sheditor  = vm.shEditor;
            sheditor.setTheme("ace/theme/dracula");
            sheditor.session.setMode("ace/mode/sh");
            document.getElementById('editor').style.fontSize='14px';
            sheditor.setShowPrintMargin(false);
            sheditor.setHighlightActiveLine(false);
            if (data){
                sheditor.setValue(data);
            }
            if (re){
                sheditor.setReadOnly(true)
            }
            vm.leaveeditor();
        };
        vm.editorPy = function (data, re) {
            vm.pyEditor = ace.edit("editor");
            var pyeditor = vm.pyEditor;
            pyeditor.setTheme("ace/theme/dracula");
            pyeditor.session.setMode("ace/mode/python");
            document.getElementById('editor').style.fontSize='14px';
            document.getElementById('editor').style.font='14px';
            pyeditor.setShowPrintMargin(false);
            pyeditor.setHighlightActiveLine(false);
            if (data){
                pyeditor.setValue(data);
            }
            if (re){
                pyeditor.setReadOnly(true)
            }
            vm.leaveeditor();
        };

        vm.editorPerl = function (data, re) {
            vm.perlEditor = ace.edit("editor");
            var perleditor = vm.perlEditor;
            perleditor.setTheme("ace/theme/dracula");
            perleditor.session.setMode("ace/mode/perl");
            document.getElementById('editor').style.fontSize='14px';
            document.getElementById('editor').style.font='14px';
            perleditor.setShowPrintMargin(false);
            perleditor.setHighlightActiveLine(false);
            if (data){
                perleditor.setValue(data);
            }
            if (re){
                perleditor.setReadOnly(true)
            }
            vm.leaveeditor();
        };

        vm.editorPhp = function (data, re) {
            vm.phpEditor = ace.edit("editor");
            var phpeditor = vm.phpEditor;
            phpeditor.setTheme("ace/theme/dracula");
            phpeditor.session.setMode("ace/mode/perl");
            document.getElementById('editor').style.fontSize='14px';
            document.getElementById('editor').style.font='14px';
            phpeditor.setShowPrintMargin(false);
            phpeditor.setHighlightActiveLine(false);
            if (data){
                phpeditor.setValue(data);
            }
            if (re){
                phpeditor.setReadOnly(true)
            }
            vm.leaveeditor();
        };

        vm.editorBuildin = function (data, re) {
            vm.buildinEditor = ace.edit("editor");
            var buildineditor = vm.buildinEditor;
            buildineditor.setTheme("ace/theme/dracula");
            buildineditor.session.setMode("ace/mode/sh");
            document.getElementById('editor').style.fontSize='14px';
            document.getElementById('editor').style.font='14px';
            buildineditor.setShowPrintMargin(false);
            buildineditor.setHighlightActiveLine(false);
            if (data){
                buildineditor.setValue(data);
            }
            if (re){
                buildineditor.setReadOnly(true)
            }
            vm.leaveeditor();
        };

        vm.editorAuto = function (data, re) {
            vm.autoEditor = ace.edit("editor");
            var autoeditor  = vm.autoEditor;
            autoeditor.setTheme("ace/theme/dracula");
            autoeditor.session.setMode("ace/mode/sh");
            document.getElementById('editor').style.fontSize='14px';
            autoeditor.setShowPrintMargin(false);
            autoeditor.setHighlightActiveLine(false);
            if (data){
                autoeditor.setValue(data);
            }
            if (re){
                autoeditor.setReadOnly(true)
            }
            vm.leaveeditor();
        };

        vm.showmachinelist = 1;

        vm.leaveeditor = function() {
            vm.showmachinelist = 1;
            if($scope.scriptType == "buildin"){
                var cont = vm.buildinEditor.getValue();
                if( cont.search(/^#!kubectl\b/) == 0 )
                {
                    vm.showmachinelist = 0;
                }
                if( cont.search(/^#!terraform\b/) == 0 )
                {
                    vm.showmachinelist = 0;
                }
                if( cont.search(/^#!kubestar\b/) == 0 )
                {
                    vm.showmachinelist = 0;
                }
                if( cont.search(/^#!awsecs\b/) == 0 )
                {
                    vm.showmachinelist = 0;
                }
                if( cont.search(/^#!sendemail\b/) == 0 )
                {
                    vm.showmachinelist = 0;
                }
                if( cont.search(/^#!sendmesg\b/) == 0 )
                {
                    vm.showmachinelist = 0;
                }
                if( cont.search(/^#!flowcaller\b/) == 0 )
                {
                    vm.showmachinelist = 0;
                }
                if( cont.search(/^#!cdnrefresh\b/) == 0 )
                {
                    vm.showmachinelist = 0;
                }
                if( cont.search(/^#!kubernetes\b/) == 0 )
                {
                    vm.showmachinelist = 0;
                }
            }
        }

        vm.buildinSet = function( name ) {
            vm.editorBuildin( '#!' + name, false );
        }

        vm.scriptTypeEditor = {
            "shell": vm.editorSh,
            "python": vm.editorPy,
            "perl": vm.editorPerl,
            "php": vm.editorPhp,
            "buildin": vm.editorBuildin,
            "auto": vm.editorAuto,
        };

        vm.click = '';
        vm.scriptManual =function () {
            if (vm.click != "manual"){
                ace.edit("editor").setValue('');
                ace.edit("editor").setReadOnly(false);
                $scope.unClick = false;
                vm.editorSh(null, false);
                $scope.scriptType = "shell";
            }
            $scope.scriptUnclick = false;
            vm.scriptHide = true;
            vm.click = "manual";
        };

        vm.from = 'manual';
        vm.scriptClone =function () {
            if (vm.click != "clone"){
                vm.scriptHide = false;
                $scope.selectedScript = '';
                ace.edit("editor").setValue('');
                ace.edit("editor").setReadOnly(false);
                $scope.scriptType = "";
                vm.s_name = "";
            }
            vm.click = "clone";

        };

        vm.scriptLocal =function () {
            if (vm.click != "local"){
                vm.scriptHide = false;
                $scope.selectedScript = '';
                ace.edit("editor").setValue('');
                ace.edit("editor").setReadOnly(true);
                $scope.scriptType = "";
            }
            vm.click = "local";

        };
        vm.inputScript = function () {
            vm.selected_id = $scope.selectedScript.id;
            $http.get('/api/job/scripts/' + vm.treeid + "/" + vm.selected_id).success(function(data){
                if (data.stat){
                    var inputEdit = vm.scriptTypeEditor[data.data.type];
                    var scriptData = data.data;
                    if (vm.from == "clone"){
                        inputEdit(data.data.cont, false);

                    }else if (vm.from == "local"){
                        inputEdit(data.data.cont, true);
                        vm.s_name = scriptData.name;
                        $scope.localId = scriptData.id;
                    }
                    $scope.scriptType = data.data.type;
                }
            });
        };

        vm.returnSave = function (scriptForm) {
            var cont = '';
            if ($scope.scriptType == "shell"){
                cont = vm.shEditor.getValue();
            }else if($scope.scriptType == "python"){
                cont = vm.pyEditor.getValue();
            }else if($scope.scriptType == "perl"){
                cont = vm.perlEditor.getValue();
            }else if($scope.scriptType == "php"){
                cont = vm.phpEditor.getValue();
            }else if($scope.scriptType == "buildin"){
                cont = vm.buildinEditor.getValue();
                if( vm.showmachinelist == 0  )
                {
                    $scope.nodeType = 'builtin';
                    vm.choiceNode = [ 'openc3skipnode' ]
                }
            }else if($scope.scriptType == "auto"){
                cont = vm.autoEditor.getValue();
            }
            cont = cont.replace(/\r\n/g, "\n");
            if (!$scope.s_argv){
                $scope.s_argv = " "
            }
            if (!vm.from){
                alert("脚本来源不能为空!");
                return
            }else if (vm.choiceNode.length == 0){
                alert("所选机器不能为空!");
                return
            }else if(!$scope.scriptType){
                alert("脚本类型不能为空！");
                return
            }
            if(vm.from == 'local'){
                $scope.scriptType = 'cite';
                cont = $scope.localId;
            }
            var post_data ={
                'plugin_type':'cmd',
                'name': vm.s_name,
                'user': $scope.selectedUser,
                'node_type':$scope.nodeType,
                'node_cont':vm.choiceNode.join(","),
                'scripts_type':$scope.scriptType,
                'scripts_cont': cont,
                'scripts_argv': $scope.s_argv,
                'timeout': parseInt($scope.s_timeout),
                'pause': $scope.pause,
                'deployenv' : vm.postdata.deployenv,
                'action' : vm.postdata.action,
                'batches' : vm.postdata.batches
            };
            $uibModalInstance.close(
                post_data
            );

        };

        if (editData){
            vm.s_name = editData.name;
            $scope.selectedUser = editData.user;
            $scope.nodeType = editData.node_type;
            $scope.choiceResult = [];
            if ($scope.nodeType == "group"){
                $scope.choiceType = "分组类型";
                $http.get('/api/job/nodegroup/' + vm.treeid +"/"+ editData.node_cont).then(
                    function successCallback (response) {
                        if (response.data.stat){
                            $scope.choiceResult.push({"name":response.data.data.name});
                        }else {
                        }
                    },
                    function errorCallback () {
                    }
                );

                vm.choiceNode.push(editData.dst);
                $scope.choiceShow = true;

            }else if($scope.nodeType == "builtin"){
                $scope.choiceType = "节点类型";
                angular.forEach(editData.node_cont.split(","), function (ip, index) {
                    $scope.choiceResult.push(ip);
                    vm.choiceNode.push(ip);
                });
                $scope.choiceShow = true;
            }else if($scope.nodeType == "variable"){
                $scope.choiceType = "变量类型";

                $scope.choiceResult.push({"variable":editData.node_cont});
                vm.choiceNode.push(editData.node_cont);
                $scope.choiceShow = true;
            }
            vm.from = "manual";
            $scope.scriptType = editData.scripts_type;
            if ($scope.scriptType == "shell"){
                $timeout(function () {
                    vm.editorSh(editData.scripts_cont, false);
                }, 1000);

            }else if($scope.scriptType == "python"){
                $timeout(function () {
                    vm.editorPy(editData.scripts_cont, false);
                }, 1000);
            }else if($scope.scriptType == "perl"){
                $timeout(function () {
                    vm.editorPerl(editData.scripts_cont, false);
                }, 1000);
            }else if($scope.scriptType == "php"){
                $timeout(function () {
                    vm.editorPhp(editData.scripts_cont, false);
                }, 1000);
            }else if($scope.scriptType == "buildin"){
                $timeout(function () {
                    vm.editorBuildin(editData.scripts_cont, false);
                }, 1000);
            }else if($scope.scriptType == "auto"){
                $timeout(function () {
                    vm.editorAuto(editData.scripts_cont, false);
                }, 1000);
            }else if($scope.scriptType == "cite"){
                vm.from = "local";

                $http.get('/api/job/scripts/' + vm.treeid+"/"+editData.scripts_cont).then(
                    function successCallback (response) {
                        if (response.data.stat){
                            var localscript = response.data.data;
                            $scope.scriptType = localscript.type;
                            $scope.localId = localscript.id;
                            $timeout(function () {
                                var typefunc = vm.scriptTypeEditor[localscript.type];
                                typefunc(localscript.cont, true);
                                $scope.scriptUnclick = true;
                            }, 1000);
                        }else {
                        }
                    },
                    function errorCallback () {
                    }
                );

            }
            $scope.s_argv = editData.scripts_argv;
            $scope.s_timeout = parseInt(editData.timeout);
            $scope.pause = editData.pause;

            vm.postdata = { deployenv: editData.deployenv, action: editData.action, batches: editData.batches };
        }
        if (vm.scriptid){
            $http.get('/api/job/scripts/' + vm.treeid + "/" + vm.scriptid).success(function(data){

                var scriptDict = data.data;
                vm.s_name = scriptDict.name;
                vm.s_cont = scriptDict.cont;
                $scope.scriptType = scriptDict.type;
                $scope.unClick = "true";
                vm.from = "local";
                if (scriptDict.type == "shell"){
                    vm.editorSh(vm.s_cont, true);
                }else if (scriptDict.type == "python"){
                    vm.editorPy(vm.s_cont, true);
                }else if (scriptDict.type == "perl"){
                    vm.editorPerl(vm.s_cont, true);
                }else if (scriptDict.type == "php"){
                    vm.editorPhp(vm.s_cont, true);
                }else if (scriptDict.type == "buildin"){
                    vm.editorBuildin(vm.s_cont, true);
                }else if (scriptDict.type == "auto"){
                    vm.editorAuto(vm.s_cont, true);
                }
                // editor.setReadOnly(false);
                // $("#editor").find("textarea").attr('readonly', 'readonly')
            });

        }else {
            vm.getAllScript();

        }
        vm.getProUser();

        vm.reloadticket = function(ticketid){
            $http.get('/api/ci/ticket?type=JobBuildin&ticketid=' + ticketid ).success(function(data){
                if( data.stat)
                {
                    vm.ticketinfo = data.data;
                    vm.ticketinfo.unshift({ id: '0', name: 'null' })
                }
                else
                {
                    toastr.error( "加载凭据列表失败:" + data.info )
                }
            });
        };

        if( editData )
        {
            var reg1 = new RegExp(/^[0-9]+$/);
            if (reg1.test(editData.user)) {
                vm.reloadticket( editData.user );
            }
        }
        else
        {
            vm.reloadticket( 0 );
        }

        $timeout(vm.editorSh, 500,true,"", false);

}})();

(function() {
    'use strict';

approvalJobController.$inject = ["$state", "$http", "$uibModalInstance", "editData", "seq"];
    angular
        .module('openc3')
        .controller('approvalJobController', approvalJobController);

    function approvalJobController($state, $http,$uibModalInstance, editData, seq) {

        var vm = this;

        vm.treeid = $state.params.treeid;
        vm.cancel = function(){ $uibModalInstance.dismiss()};

        vm.postdata = { timeout: '86400', approver: '', cont: '', name: '', deployenv: 'always',action: 'always', batches: 'always', everyone: 'on', plugin_type: 'approval' };
        if (!editData){vm.postdata.name = "审批_"+seq};

        if( editData )
        {
            vm.postdata = editData
        }

        vm.returnData = function () {
            var post_data = vm.postdata;
            $uibModalInstance.close(
                post_data
            );
            vm.cancel()
        };

}})();

(function(){
    'use strict';

        postCloneController.$inject = ["$uibModalInstance", "$http", "cloneNodes", "jobInfo"];
    angular
        .module('openc3')
        .controller('postCloneController', postCloneController);

        function postCloneController($uibModalInstance, $http, cloneNodes, jobInfo) {

            var vm = this;
            vm.cancel = function(){ $uibModalInstance.dismiss()};
            vm.cloneNodes = cloneNodes;
            vm.jobuuid = "";

            angular.forEach(vm.cloneNodes, function (node, id) {
                vm.cloneNodes[id]["status"] = null;
                vm.cloneNodes[id]["msg"] = null;
            });
            angular.forEach(vm.cloneNodes, function (node, id) {
                $http.post('/api/job/jobs/'+ id, jobInfo).then(
                    function successCallback(response) {
                        if (response.data.stat){
                            vm.cloneNodes[id]["status"] = true;
                            vm.jobuuid = response.data.uuid;
                        }else {
                            vm.cloneNodes[id]["status"] = false;
                            vm.cloneNodes[id]["msg"] = response.data.info;
                        }
                    },
                    function errorCallback (response){
                        vm.cloneNodes[id]["status"] = false;
                        vm.cloneNodes[id]["msg"] = "请求错误";
                    }
                );
            });

            vm.closeTab = function () {
                $uibModalInstance.close(
                    vm.jobuuid
                );
            };


        }

})();

(function(){
    'use strict';

        cloneJobController.$inject = ["$rootScope", "$scope", "$injector", "$stateParams", "$uibModalInstance", "$window", "$http", "$state"];
    angular
        .module('openc3')
        .controller('cloneJobController', cloneJobController);

        function cloneJobController($rootScope, $scope,$injector, $stateParams,$uibModalInstance, $window, $http, $state) {

            var vm = this;
            vm.cancel = function(){ $uibModalInstance.dismiss()};
            vm.zTree = '';
            var toastr = toastr || $injector.get('toastr');
            vm.cloneNodes = {};

            angular.element('.scroller').css('height', $window.innerHeight-95);
            angular.element($window).bind('resize', function(){
                angular.element('.scroller').css('height', $window.innerHeight-95);
            });
            var setting = {
                view: {
                    dblClickExpand: false,
                    showTitle:false
                }
            };

            vm.sync = $http.get('/api/connector/connectorx/usertree').success(function(nodes) {
                $.fn.zTree.init(angular.element('#openc3treeclone'), setting, nodes.data);
                vm.zTree = $.fn.zTree.getZTreeObj('openc3treeclone');
                if (vm.zTree){
                    var treeNode = vm.zTree.getNodeByParam('id', $state.params.treeid);
                    var proName = $state.current.name;
                    if (proName.indexOf('home.global') == 0 ){
                        return
                    }
                    if(treeNode == null){
                        return;
                    }
                }
                return vm.zTree;
            });


            vm.sync.then(function(){
                vm.zTree = $.fn.zTree.getZTreeObj('openc3treeclone');
                vm.focusCurrent();
                vm.zTree.setting.callback.onClick = function(event, treeId, treeNode){
                    if(treeNode.hasOwnProperty('id')){
                        if (treeNode.id != 0){
                            $scope.$apply(function () {
                                vm.cloneNodes[treeNode.id] = {"id":treeNode.id, "name":treeNode.name};
                            });

                        } else {
                            toastr.error("没有节点权限");
                        }
                    } else {
                        toastr.error("没有节点权限");
                    }
                }
            });

            vm.delNode = function (idx) {
                delete(vm.cloneNodes[idx]);
            };
            // 返回所选节点数据
            vm.saveNode = function () {
                $uibModalInstance.close(
                    vm.cloneNodes
                );
            };
            // focus current node
            vm.focusCurrent = function(){
                var cNode = vm.zTree.getNodeByParam('id', $state.params.treeid);
                vm.zTree.selectNode(cNode);
                vm.zTree.expandNode(cNode);
            };

            // expand/collapse tree
            vm.expandAll = function(flag){
                vm.zTree.expandAll(flag);
            };

            // tree refresh
            vm.refresh = function(){
                angular.element('.treeFresh').addClass('fa-spin');
                $http.get('/api/connector/connectorx/usertree').success(function(nodes) {
                    $.fn.zTree.init(angular.element('#openc3treeclone'), vm.zTree.setting, nodes.data);
                    angular.element('.treeFresh').removeClass('fa-spin');
                    vm.focusCurrent();
                });
            };
        }

})();

(function () {
    'use strict';
    AgentRegionController.$inject = ["$uibModalInstance", "$http", "$state", "nodeStr", "ngTableParams", "reloadhome"];
    angular
        .module('openc3')
        .controller('AgentRegionController', AgentRegionController);

    function AgentRegionController($uibModalInstance, $http, $state, nodeStr, ngTableParams, reloadhome ) {

        var vm = this;
        vm.nodeStr = nodeStr;

        vm.cancel = function(){ $uibModalInstance.dismiss(); reloadhome();};

        vm.treeid = $state.params.treeid;

        vm.selected = {}
        vm.reload = function(){
            vm.loadover =false;
            $http.get('/api/agent/region/' + vm.treeid + '?relation=1').success(function(data){
                vm.list = data.data;
                $http.get('/api/agent/project_region_relation/' + vm.treeid ).success(function(data){
                    vm.relation = {};
                    for( var i in data.data )
                    {
                        vm.relation[data.data[i].regionid]='1';
                    }

                    for( var i =0; i< vm.list.length; i++ )
                    {
                        if(vm.relation.hasOwnProperty( vm.list[i].id ))
                        {
                            vm.list[i].selected = true;
                            vm.selected[vm.list[i].id] = true;
                        }
                        else
                        {
                            vm.list[i].selected = false;
                            vm.selected[vm.list[i].id] = false;
                        }
                    }
                    vm.proxylistTable = new ngTableParams({count:500}, {counts:[],data:vm.list});
                    vm.loadover =true;
                });
            });

        };

        vm.reload();

        vm.showRegion = function( b ){
            vm.showRegionBool = b;
        }
 
        vm.createRegion = function(){
          swal({
            title: "是否添加区域",
            text: "区域名:"+ vm.regionText,
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){
            $http.post('/api/agent/region/' + vm.treeid, { "name": vm.regionText}).success(function(data){
                vm.regionText = '';
                vm.reload();
            });
          });
        }

        vm.deleteRegion = function(id) {
          swal({
            title: "是否要删除该区域",
            text: "将会删除区域下所有的数据",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){
            $http.delete('/api/agent/region/' + vm.treeid+'/'+id ).success(function(data){
                vm.reload();
            });
          });
        }
        vm.save =function() {
          swal({
            title: "保存区域选择",
            text: "取消选择的区域的proxy和agent将被删除",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){
            for( var i =0; i< vm.list.length; i++ ){
                if(vm.selected[vm.list[i].id] != vm.list[i].selected)
                {
                    if( vm.list[i].selected )
                    {
                        $http.post('/api/agent/project_region_relation/' + vm.treeid, { "regionid": vm.list[i].id}).success(function(data){
                            console.log( data )
                        });
                    }
                    else
                    {
                        $http.delete('/api/agent/project_region_relation/' + vm.treeid+'/'+vm.list[i].id ).success(function(data){
                            console.log( data )
                        });
                    }
                }
            }
          });
        }
    }
})();

(function () {
    'use strict';
    AgentProxyController.$inject = ["$uibModalInstance", "$http", "$uibModal", "$state", "nodeStr", "regionid", "regionname", "ngTableParams", "reloadhome"];
    angular
        .module('openc3')
        .controller('AgentProxyController', AgentProxyController);

    /** @ngInject */
    function AgentProxyController($uibModalInstance, $http, $uibModal, $state, nodeStr, regionid, regionname,  ngTableParams, reloadhome ) {

        var vm = this;
        vm.nodeStr = nodeStr;
        vm.regionid = regionid;
        vm.regionname = regionname;
        vm.reloadhome = reloadhome

        vm.cancel = function(){ $uibModalInstance.dismiss(); vm.reloadhome(); };

        vm.siteaddr = window.location.host;
        vm.treeid = $state.params.treeid;

        vm.reload = function(){
            vm.loadover = false;
            $http.get('/api/agent/proxy/' + vm.treeid+'/'+regionid).success(function(data){
                vm.list = data.data;
                vm.proxylistTable = new ngTableParams({count:500}, {counts:[],data:vm.list});
                vm.loadover = true;
            });
        };

        vm.reload();

        vm.install = { username: 'root'};
        vm.showProxy = function( b ){
            vm.showProxyBool = b;
        }
 
        vm.deleteProxy = function(id) {
          swal({
            title: "删除代理",
            text: "代理被删除后，如果该区域下没有可用的代理，区域下的机器调用将会失败",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){
            $http.delete('/api/agent/proxy/' + vm.treeid+'/'+id ).success(function(data){
                if(data.stat == false) { swal({ title: "删除失败!", text: data.info, type:'error' });}
                vm.reload();
            });
         });
        }
       vm.installProxy = function( installtype ) {
            $http.post('/api/agent/proxy/' + vm.treeid +'/' + regionid, vm.install ).success(function(data){
                if(data.stat) {
                    swal({ title: "提交成功!", type:'success' });
                    vm.install.ip = ''
                } else { 
                    swal({ title: "提交失败!", text: data.info, type:'error' });
                }
                vm.reload();
            });
        }

        vm.updateselectip = function(ips) {
            vm.install.ip = ips;
        }

        vm.selectIpFromTree = function() {
            $uibModal.open({
                templateUrl: 'app/pages/business/agent/detail/host.html',
                controller: 'AgentHostController',
                controllerAs: 'host', 
                backdrop: 'static', 
                size: 'lg', 
                keyboard: false,
                bindToController: true,
                resolve: {
                    nodeStr: function () { return vm.nodeStr },
                    regionid: function () { return regionid },
                    selectip: function() { return vm.updateselectip }
                }
            });
        }
    }
})();

(function() {
    'use strict';

    AgentCtrlLogController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService"];
    angular
        .module('openc3')
        .controller('AgentCtrlLogController', AgentCtrlLogController);

    /** @ngInject */
    function AgentCtrlLogController($uibModalInstance,$location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService) {

        var vm = this;
        vm.treeid = $state.params.treeid;

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });


        vm.reload = function(){
            vm.loadover = false;
            $http.get('/api/agent/log/' + vm.treeid).success(function(data){
                vm.activeRegionTable = new ngTableParams({count:50}, {counts:[],data:data.data});
                vm.loadover = true;
            });
        };

        vm.reload();

    }
})();

(function () {
    'use strict';
    AgentHostController.$inject = ["$scope", "$uibModalInstance", "$http", "$state", "nodeStr", "regionid", "ngTableParams", "selectip"];
    angular
        .module('openc3')
        .controller('AgentHostController', AgentHostController);

    /** @ngInject */
    function AgentHostController($scope, $uibModalInstance, $http, $state, nodeStr, regionid, ngTableParams,selectip) {

        var vm = this;
        vm.nodeStr = nodeStr;
        vm.regionid = regionid;
        $scope.all_name = false;
        $scope.all_inip = false;
        $scope.all_exip = false;

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        vm.treeid = $state.params.treeid;

        vm.reload = function(){
            vm.loadover = false;
            $http.get('/api/agent/nodeinfo/' + vm.treeid).success(function(data){
                vm.list = data.data;
                vm.hostlistTable = new ngTableParams({count:500}, {counts:[],data:vm.list});
                vm.loadover = true;
            });
        };

        vm.reload();

        vm.install = { type: 'host' };
        vm.showHost = function( b ){
            vm.showHostBool = b;
        }
 
        vm.check_name = function(all_name) {
            for (var i = vm.list.length - 1; i >= 0; i--) {
                vm.list[i].selected_name = all_name;
            }
            $scope.s_name = all_name;
        };
        vm.check_inip = function(all_inip) {
            for (var i = vm.list.length - 1; i >= 0; i--) {
                vm.list[i].selected_inip = all_inip;
            }
            $scope.s_inip = all_inip;
        };
        vm.check_exip = function(all_exip) {
            for (var i = vm.list.length - 1; i >= 0; i--) {
                vm.list[i].selected_exip = all_exip;
            }
            $scope.s_exip = all_exip;
        };

        vm.save =function() {
            var arr = new Array();
            for( var i =0; i< vm.list.length; i++ ){
                if( vm.list[i].selected_name )
                {
                    arr.push( vm.list[i].name );
                }
                if( vm.list[i].selected_inip )
                {
                    arr.push( vm.list[i].inip );
                }
                if( vm.list[i].selected_exip )
                {
                    arr.push( vm.list[i].exip  );
                }
                selectip( arr.join( "," ) );
 
            }
            $uibModalInstance.dismiss(); 

        }

        vm.installHost = function() {
            $http.post('/api/agent/install/' + vm.treeid +'/' + regionid, vm.install ).success(function(data){
                vm.install = { type : 'host'};
            });
        }
    }

})();

(function () {
    'use strict';
    AgentAgentController.$inject = ["$uibModalInstance", "$http", "$uibModal", "$state", "nodeStr", "regionid", "regionname", "ngTableParams", "reloadhome"];
    angular
        .module('openc3')
        .controller('AgentAgentController', AgentAgentController);

    function AgentAgentController($uibModalInstance, $http, $uibModal, $state, nodeStr, regionid, regionname, ngTableParams, reloadhome) {

        var vm = this;
        vm.nodeStr = nodeStr;
        vm.regionid = regionid;
        vm.regionname = regionname;

        vm.reloadhome = reloadhome
        vm.cancel = function(){ $uibModalInstance.dismiss(); vm.reloadhome();};

        vm.treeid = $state.params.treeid;

        vm.reload = function(){
            vm.loadover = false;
            $http.get('/api/agent/agent/' + vm.treeid+'/'+regionid).success(function(data){
                vm.list = data.data;
                vm.agentlistTable = new ngTableParams({count:500}, {counts:[],data:vm.list});
                vm.loadover = true;
            });

        };

        vm.reload();

        vm.install = { username: 'root' };
        vm.showAgent = function( b ){
            vm.showAgentBool = b;
        }
 
       vm.deleteAgent = function(id) {
          swal({
            title: "删除网段",
            text: "删除网段",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){
            $http.delete('/api/agent/agent/' + vm.treeid+'/'+id ).success(function(data){
                if(data.stat == true) { swal({ title: "删除成功!", type:'success' }); vm.install.ip='';} else { swal({ title: "删除失败!", text: data.info, type:'error' });}
                vm.reload();
            });
          });
        }

        vm.installAgent = function( installtype ) {
          swal({
            title: "确认操作",
            text: "提交结束后请到安装历史中查看日志",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){
            vm.install.type = installtype + '_' + 'agent';
            $http.post('/api/agent/install/' + vm.treeid +'/' + regionid, vm.install ).success(function(data){
                vm.install = { username: 'root' };
                if(data.stat == true) { swal({ title: "提交成功!", type:'success' }); vm.install.ip='';} else { swal({ title: "提交失败!", text: data.info, type:'error' }); }
            });
          });
        }

        vm.addSubNet = function() {
            $http.post('/api/agent/agent/' + vm.treeid +'/' + regionid + '/subnet', { subnet: vm.install.ip } ).success(function(data){
                if(data.stat == false) { swal({ title: "添加失败!", text: data.info, type:'error' }); }
                vm.reload();
            });
        }

        vm.updateselectip = function(ips) {
            vm.install.ip = ips;
        }

        vm.selectIpFromTree = function() {
            $uibModal.open({
                templateUrl: 'app/pages/business/agent/detail/host.html',
                controller: 'AgentHostController',
                controllerAs: 'host', 
                backdrop: 'static', 
                size: 'lg', 
                keyboard: false,
                bindToController: true,
                resolve: {
                    nodeStr: function () { return vm.nodeStr },
                    regionid: function () { return regionid },
                    selectip: function() { return vm.updateselectip }
                }
            });
        }
    }
})();

(function() {
    'use strict';

    TerminalCmdController.$inject = ["$timeout", "$state", "$http", "$uibModal", "$scope", "treeService", "ngTableParams", "resoureceService", "$injector"];
    angular
        .module('openc3')
        .controller('TerminalCmdController', TerminalCmdController);

    function TerminalCmdController($timeout, $state, $http, $uibModal, $scope, treeService, ngTableParams, resoureceService, $injector) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');
        $scope.selected_inip = [];
        $scope.selected_exip = [];
        $scope.selected_name = [];
        $scope.radioselected = {};
        $scope.selectedData = [];
        $scope.selectedDataName = [];
        $scope.selectedDataInip = [];
        $scope.selectedDataExip = [];
        $scope.choiceShow = false;
        $scope.selectedUser = 'root';

        treeService.sync.then(function(){ 
            vm.nodeStr = treeService.selectname(); 
        });

        if (vm.treeid){
            $http.get('/api/job/userlist/' + vm.treeid).then(

                function successCallback (response) {
                    if (response.data.stat){
                        $scope.allProUsers= response.data.data;
                    }else {
                        toastr.error( "获取执行账户列表失败："+response.data.info)
                    }
                },
                function errorCallback () {
                    toastr.error( "获取执行账户列表失败："+response.status)
                }
            );
        }

        vm.reload = function () {
            vm.loadover = false
            $http.get('/api/agent/nodeinfo/' + vm.treeid).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.machine_Table = new ngTableParams({count:10}, {counts:[],data:response.data.data.reverse()});
                        vm.loadover = true
                    }else {
                        toastr.error( "获取机器列表失败："+response.data.info)
                    }
                },
                function errorCallback (response ){
                    toastr.error( "获取机器列表失败："+response.status)
                });
        };

        vm.reload();

        var changeSelected = function (action, id, data, type) {
            if (action == 'add') {
                if (type == 'name'){
                    $scope.selectedData.push(data)
                }
                if (type == 'inip'){
                    $scope.selectedData.push(data)
                }
                if (type == 'exip'){
                    $scope.selectedData.push(data)
                }
            }
            if (action == 'remove'){
                if (type == 'name'){
                    $scope.selectedData.splice($scope.selectedData.indexOf(data), 1)
                }
                if (type == 'inip'){
                    $scope.selectedData.splice($scope.selectedData.indexOf(data), 1)
                }
                if (type == 'exip'){
                    $scope.selectedData.splice($scope.selectedData.indexOf(data), 1)
                }
            }
        };
        // 机器名称
        $scope.nameUpdateSelection = function ($event, id, data) {
            var checkbox = $event.target;
            var action = (checkbox.checked ? 'add' : 'remove');
            changeSelected(action, id, data, 'name');
        };
        // 内网IP
        $scope.inipUpdateSelection = function ($event, id, data) {
            var checkbox = $event.target;
            var action = (checkbox.checked ? 'add' : 'remove');
            changeSelected(action, id, data, 'inip');
        };
        // 外网IP
        $scope.exipUpdateSelection = function ($event, id, data) {
            var checkbox = $event.target;
            var action = (checkbox.checked ? 'add' : 'remove');
            changeSelected(action, id, data, 'exip');
        };
        $scope.isSelected = function (addr) {
            return $scope.selectedData.indexOf(addr) >= 0;
        };
        vm.delChoice = function (id) {
            if (id >=0){
                $scope.selectedData.splice(id, 1);
            }
        };

        vm.delAllData = function () {
            $scope.selectedData.splice(0,$scope.selectedData.length);
        };

        $scope.openOneTab = function (name) {
            var terminalAddr = window.location.protocol + "//" + window.location.host+"/api/job/cmd/";
            var s = vm.treeid+"?node=" + name + '&bash=1' +'&sudo=' + $scope.selectedUser + '&siteaddr=' + window.location.protocol + "//" + window.location.host;
            window.open(terminalAddr+s, '_blank')
        };

        vm.openNewTab = function () {
            if($scope.selectedData.length<=0){
                swal({
                    title:"所选节点为空",
                    type:'error'
                });
            }
            else {
                var terminalAddr = window.location.protocol + "//" + window.location.host+"/api/job/cmd/";
                var node_str = $scope.selectedData.join(",");
                var s = vm.treeid+"?node=" + node_str +'&sudo=' + $scope.selectedUser + '&siteaddr=' + window.location.protocol + "//" + window.location.host;
                window.open(terminalAddr+s, '_blank')
            }

        };

        vm.openTailLog = function () {
            if($scope.selectedData.length<=0){
                swal({
                    title:"所选节点为空",
                    type:'error'
                });
            }
            else {
                var terminalAddr = window.location.protocol + "//"+window.location.host+"/api/job/cmd/";
                var node_str = $scope.selectedData.join(",");
                var s = vm.treeid + "?node=" + node_str +'&sudo=' + $scope.selectedUser + '&tail=1';
                window.open(terminalAddr + s, '_blank');
            }

        };
    }

})();

(function() {
    'use strict';

    SmallApplicationController.$inject = ["$state", "$http", "$scope", "ngTableParams"];
    angular
        .module('openc3')
        .controller('SmallApplicationController', SmallApplicationController);

    /** @ngInject */
    function SmallApplicationController( $state, $http, $scope, ngTableParams ) {

        var vm = this;

        vm.reload = function () {
            vm.loadover = false
            $http.get('/api/job/smallapplication').then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.dataTable = new ngTableParams({count:100}, {counts:[],data:response.data.data});
                        vm.loadover = true
                    }else {
                        swal('获取信息失败', response.data.info, 'error' );
                    }
                },
                function errorCallback (response ){
                    swal('获取信息失败', response.status, 'error' );
                });
        };

        vm.reload()
    }

})();

(function() {
    'use strict';

    SmallApplicationEditController.$inject = ["$state", "$http", "$scope", "$uibModal", "ngTableParams"];
    angular
        .module('openc3')
        .controller('SmallApplicationEditController', SmallApplicationEditController);

    /** @ngInject */
    function SmallApplicationEditController( $state, $http, $scope, $uibModal, ngTableParams ) {

        var vm = this;
        vm.treeid = $state.params.treeid;

        vm.reload = function () {
            vm.loadover = false
            $http.get('/api/job/smallapplication').then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.dataTable = new ngTableParams({count:100}, {counts:[],data:response.data.data});
                        vm.loadover = true
                    }else {
                        swal('获取信息失败', response.data.info, 'error' );
                    }
                },
                function errorCallback (response ){
                    swal('获取信息失败', response.status, 'error' );
                });
        };

        vm.reload()

        vm.createSmallApplication = function () {
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/smallapplication/create.html',
                controller: 'SmallApplicationCreateController',
                controllerAs: 'smallapplicationcreate',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () { return vm.treeid},
                    reload : function () { return vm.reload}
                }
            });
        };

       vm.deleteSmallApplication = function(id) {
          swal({
            title: "删除轻应用",
            text: "删除",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){
            $http.delete('/api/job/smallapplication/' + id ).success(function(data){
                if(data.stat == true) {
                    swal({ title: "删除成功!", type:'success' });
                    vm.reload();
                } else {
                    swal({ title: "删除失败!", text: data.info, type:'error' });
                }
            });
          });
        }

    }

})();

(function () {
    'use strict';
    SmallApplicationCreateController.$inject = ["$state", "$http", "ngTableParams", "$uibModalInstance", "$scope", "resoureceService", "$injector", "treeid", "reload"];
    angular
        .module('openc3')
        .controller('SmallApplicationCreateController', SmallApplicationCreateController);

    function SmallApplicationCreateController( $state, $http, ngTableParams, $uibModalInstance, $scope, resoureceService, $injector, treeid, reload ) {

        var vm = this;

        var toastr = toastr || $injector.get('toastr');

        vm.postdata = { "parameter" : ""};

        vm.cancel = function(){ $uibModalInstance.dismiss()};

        vm.add = function(){
            vm.postdata.jobid = $scope.choiceJob.id
            $http.post('/api/job/smallapplication', vm.postdata ).success(function(data){
                    if(data.stat == true) {
                        vm.cancel();
                        reload();
                    } else { swal({ title: "创建失败!", text: data.info, type:'error' }); }

            });
        };


        $scope.allJobs = [];        // 保存所有项目下的作业

        vm.getAllJob = function () {
            vm.ciinfo = {}

            $http.get('/api/ci/group/' + treeid).success(function(data){
                if(data.stat)
                {
                    angular.forEach(data.data, function (value, key) {
                        vm.ciinfo['_ci_'+value.id+'_'] = value.name
                        vm.ciinfo['_ci_test_'+value.id+'_'] = value.name + ':测试'
                        vm.ciinfo['_ci_online_'+value.id+'_'] = value.name + ':线上'
                    });

                    $http.get('/api/job/jobs/' + treeid).then(
                        function successCallback(response) {
                            if (response.data.stat){
                                $scope.allJobs = response.data.data
                                angular.forEach($scope.allJobs, function (value, key) {
                                    if(vm.ciinfo[value.name])
                                    {
                                        value.alias = '(流水线:' + vm.ciinfo[value.name] +')'
                                    }else{
                                        value.alias = value.name
                                    }
                                });
                            }else {
                                toastr.error( "获取项目机器信息失败："+response.data.info )
                            }
                        },
                        function errorCallback (response ){
                            toastr.error( "获取项目机器信息失败："+response.status )
                        });
                }
                else
                {
                    toastr.error( "加载流水线名称失败:" + data.info )
                }
            });
        };

        vm.getAllJob();
    }
})();


(function() {
    'use strict';

    SendfileController.$inject = ["$timeout", "$state", "$http", "$uibModal", "$scope", "treeService", "ngTableParams", "resoureceService", "$injector", "$filter"];
    angular
        .module('openc3')
        .controller('SendfileController', SendfileController);

    function SendfileController($timeout, $state, $http, $uibModal, $scope, treeService, ngTableParams, resoureceService, $injector, $filter) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');
        $scope.selectedUser = 'root';

        treeService.sync.then(function(){ 
            vm.nodeStr = treeService.selectname(); 
        });

        if (vm.treeid){
            $http.get('/api/job/userlist/' + vm.treeid).then(

                function successCallback (response) {
                    if (response.data.stat){
                        $scope.allProUsers= response.data.data;
                    }else {
                        toastr.error( "获取执行账户列表失败："+response.data.info)
                    }
                },
                function errorCallback () {
                    toastr.error( "获取执行账户列表失败："+response.status)
                }
            );
        }

        vm.reloadfileserver = function(){
            $http.get('/api/job/fileserver/' + vm.treeid ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.fileserver_Table = new ngTableParams({count:15}, {counts:[],data:response.data.data.reverse()});
                    }else {
                        toastr.error( "获取文件管理列表失败："+response.data.info)
                    }
                },
                function errorCallback (response ){
                    toastr.error( "获取文件管理列表失败："+response.status)
                });
        }

        vm.reload = function () {
            vm.loadover = false

            if( vm.filepath )
            {
                $http.get('/api/job/sendfile/list/' + vm.treeid + '?sudo=' + $scope.selectedUser + '&path=' + vm.filepath  ).then(
                    function successCallback(response) {
                        if (response.data.stat){
                            vm.dir_Table = new ngTableParams({count:200}, {counts:[],data:response.data.data});
                            vm.loadover = true
                        }else {
                            toastr.error( "获取目录列表失败："+response.data.info)
                        }
                    },
                    function errorCallback (response ){
                        toastr.error( "获取目录列表失败："+response.status)
                    });

                vm.reloadfileserver();

                var nowTime = $filter('date')(new Date, "yyyy-MM-dd");

                $http.get('/api/job/task/' + vm.treeid + '?name=sendfile&time_start=' + nowTime ).then(
                    function successCallback(response) {
                        if (response.data.stat){
                            vm.sendfiletask_Table = new ngTableParams({count:15}, {counts:[],data:response.data.data.reverse()});
                            vm.loadover = true
                        }else {
                            toastr.error( "获取文件管理列表失败："+response.data.info)
                        }
                    },
                    function errorCallback (response ){
                        toastr.error( "获取文件管理列表失败："+response.status)
                    });
            }
            else
            {
                $http.get('/api/agent/nodeinfo/' + vm.treeid).then(
                    function successCallback(response) {
                        if (response.data.stat){
                            vm.machine_Table = new ngTableParams({count:10}, {counts:[],data:response.data.data.reverse()});
                            vm.loadover = true
                        }else {
                            toastr.error( "获取机器列表失败："+response.data.info)
                        }
                    },
                    function errorCallback (response ){
                        toastr.error( "获取机器列表失败："+response.status)
                    });
            }
        };

        vm.reload();

        vm.openOne = function (name) {
            vm.filepath = name;
            vm.reload();
        };

        vm.intodir = function (name) {
            vm.filepath = vm.filepath + "/" + name;
            vm.reload();
        };

        vm.backdir = function () {
            var temppath = vm.filepath.split("/");
            temppath.pop();
            vm.filepath = temppath.join("/");
            vm.reload();
        };

        vm.reset = function () {
            vm.filepath = '';
            vm.reload();
        };

        vm.startUoloadTask = function ( filename ) {
            var temppath = vm.filepath.split("/");
            var temphost = temppath.shift();
            var filepath = temppath.join("/");
 
            var post_data = { "chmod": "644", "chown" : $scope.selectedUser, "dp": "/" + filepath + "/", "dst": temphost, "dst_type" : "builtin", "name": "sendfile_upload_" + vm.filepath + "/" + filename, "sp": filename, "src": "","src_type": "fileserver", "timeout" : 300, "user": $scope.selectedUser };
            resoureceService.work.scp(vm.treeid, post_data, null)
                .then(function (repo) {
                    if (repo.stat){
                    }else{
                        toastr.error( "提交任务失败:" + repo.info )
                    }
                }, function (repo) {
                    toastr.error( "提交任务失败:" + repo )

                })
        };

        vm.startDownloadTask = function ( filename ) {
            var temppath = vm.filepath.split("/");
            var temphost = temppath.shift();
            var filepath = temppath.join("/");
 
            var post_data = { "chmod": "644", "chown" : $scope.selectedUser, "dp": "/tmp/abc/", "dst": temphost, "dst_type" : "fileserver", "name": "sendfile_download_" + vm.filepath + "/" + filename, "sp": "/" + filepath + "/" + filename, "src": temphost,"src_type": "builtin", "timeout" : 300, "user": $scope.selectedUser };
            resoureceService.work.scp(vm.treeid, post_data, null)
                .then(function (repo) {
                    if (repo.stat){
                    }else{
                        toastr.error( "提交任务失败:" + repo.info )
                    }
                }, function (repo) {
                    toastr.error( "提交任务失败:" + repo )

                })
        };

        vm.downloadfile = function (name) {
            $http.get('/api/job/fileserver/' + vm.treeid + '/download?name=' + name).then(
                function successCallback(response) {
                    if (response.data.stat){
                        var downloadAddr = window.location.protocol + "//"+window.location.host+"/api/job/download/";
                         window.open(downloadAddr+response.data.data, '_blank')
                    }else {
                        toastr.error( "获取下载地址失败："+response.data.info)
                    }
                },
                function errorCallback (response ){
                    toastr.error( "获取下载地址失败："+response.status)
                });
 
        };

        vm.unlinkfile = function( filename )
        {
            $http.post('/api/job/sendfile/unlink/' + vm.treeid + '?sudo=' + $scope.selectedUser + '&path=' + vm.filepath + '/' + filename  ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.reload()
                    }else {
                        toastr.error( "删除文件失败："+response.data.info)
                    }
                },
                function errorCallback (response ){
                    toastr.error( "删除文件失败："+response.status)
                });
         }

        vm.deleteFile = function (idx) {
            resoureceService.file.delete([vm.treeid, idx], null, null)
                .then(function (repo) {
                    if (repo.stat){
                        vm.reloadfileserver();
                    }
                    else
                    {
                        toastr.error("删除失败:" + repo.info)
                    }
                })

        };

        vm.bytesToSize = function(bytes) {
            if (bytes === 0) return '0 B';
            var k = 1000, // or 1024
                sizes = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'],
                i = Math.floor(Math.log(bytes) / Math.log(k));

           return (bytes / Math.pow(k, i)).toPrecision(3) + ' ' + sizes[i];
        }

        vm.clickImport = function () {
            document.getElementById("choicefiles").click();
        };

        $scope.upForm = function () {
            var form = new FormData();
            var file = document.getElementById("choicefiles").files[0];
            form.append('file', file);
            $http({
                method: 'POST',
                url: '/api/job/fileserver/'+ vm.treeid,
                data: form,
                headers: {'Content-Type': undefined},
                transformRequest: angular.identity
            }).success(function (data) {
                if (data.stat){
                    vm.reload()
                }
                else
                {
                    toastr.error("上传失败:" + data.info)
                }
            }).error(function (data) {
                toastr.error("上传失败:" + data)
            })
        };

        vm.openOneTab = function () {
            var temppath = vm.filepath.split("/");
            var name = temppath.shift();
            var terminalAddr = window.location.protocol + "//" + window.location.host + "/api/job/cmd/";
            var s = vm.treeid+"?node=" + name + '&bash=1' +'&sudo=' + $scope.selectedUser + '&siteaddr=' + window.location.protocol + "//" + window.location.host;
            window.open(terminalAddr+s, '_blank')
        };
    }
})();

(function() {
    'use strict';

DistributeController.$inject = ["$scope", "$filter", "$state", "$http", "$window", "$uibModal", "$timeout", "treeService", "resoureceService", "scriptId", "$injector"];
    angular
        .module('openc3')
        .controller('DistributeController', DistributeController);

    function DistributeController($scope,$filter, $state, $http,$window,$uibModal, $timeout,treeService,resoureceService, scriptId, $injector) {

        var vm = this;
        $scope.dataready = true;
        var toastr = toastr || $injector.get('toastr');
        vm.choiceNode = [];
        vm.choiceAllFiles = [];
        vm.scriptid = scriptId.getter();
        scriptId.del();
        vm.treeid = $state.params.treeid;
        vm.scriptHide = true;
        $scope.srcShow = false;
        $scope.choiceShow = false;

        vm.postdata = { deployenv: 'always', action: 'always', batches: 'always' };

        $scope.userShow = false;
        $scope.dstServerShow = false;
        $scope.srcServerShow = false;
        $scope.scp_dir = true;
        $scope.title = "目标路径以'/'结尾代表一个目录，不以‘/’结尾表示一个文件。如：/tmp/表示将文件保存到此目录下，/tmp/test.txt表示将文件保存到此目录下，文件名为test.txt";
        $scope.srcDate = {
            'sp':'',
            'src_type':'',
            'src':'',
        };
        $scope.dstDate = {
            'name':'',
            'user':'',
            'dst_type':'',
            'dst':'',
            'dp':'',
            'chown':null,
            'chmod':null,
            'timeout':'60',
        };
        $scope.copySrcdata = angular.copy($scope.srcDate);
        var ssss = $filter('date')(new Date, "yyyyMMddHHmmss") + $filter('date')(new Date, "sss");
        vm.s_name = "快速分发文件-" + ssss;
        $scope.dstDate.name = vm.s_name;
        treeService.sync.then(function(){      // when the tree was success.
            vm.nodeStr = treeService.selectname();  // get tree name
        });

        vm.getProUser = function () {
            if (vm.treeid){
                $http.get('/api/job/userlist/' + vm.treeid).then(

                    function successCallback (response) {
                        if (response.data.stat){
                            $scope.allProUsers= response.data.data;
                        }else {
                            toastr.error( "获取执行账户列表失败："+response.data.info )
                        }
                    },
                    function errorCallback () {
                        toastr.error( "获取执行账户列表失败："+response.status )
                    }
                );
            }
        };
        vm.addProUser = function () {
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/addUser.html',
                controller: 'AddUserController',
                controllerAs: 'addUser',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    reloadUser : function () { return vm.getProUser}
                }
            });
        };

        // vm.check_dir = function () {
        //     if ($scope.dstDate.dp.endsWith("/")) {
        //         $scope.scp_dir = true;
        //     }else{
        //         $scope.scp_dir = false;
        //     };
        // };
        
        vm.delChoice = function (id, name) {
            if (id >=0){
                $scope.choiceResult.splice(id, 1);
                angular.forEach(vm.choiceNode, function (data, index) {
                    if (data == name){
                        vm.choiceNode.splice(index, 1);
                    }
                });
                $scope.dstDate.dst = vm.choiceNode.join(",")
            }
        };

        // 选择源地址
        vm.choiceSourceServer = function () {
            var openChoice = $uibModal.open({
                templateUrl: 'app/components/machine/choiceMachine.html',
                controller: 'ChoiceController',
                controllerAs: 'choice',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},

                }
            });
            openChoice.result.then(
                function (result) {
                    if (result.length != 0){
                        if (result.length >0){
                            if (result[0].plugin){
                                $scope.copySrcdata.src_type = "group";
                                $scope.copySrcdata.src = result[0].id;
                                $scope.srouceServerResult ="组： "+result[0].name
                            }else{
                                $scope.copySrcdata.src_type = "builtin";
                                $scope.srouceServerResult = "节点： ";
                                vm.choiceNode.splice(0, vm.choiceNode.length);
                                angular.forEach(result, function (data) {
                                    vm.choiceNode.push(data);
                                    $scope.srouceServerResult += data +","
                                });
                                $scope.copySrcdata.src = vm.choiceNode.join(",")
                            }
                        }
                    }
                },function (reason) {
                    console.log("error reason", reason)
                }
            );

        };
        // 选择目标地址
        vm.choiceServer = function () {
            var openChoice = $uibModal.open({
                templateUrl: 'app/components/machine/choiceMachine.html',
                controller: 'ChoiceController',
                controllerAs: 'choice',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},

                }
            });
            openChoice.result.then(
                function (result) {
                    if (result.length != 0){
                        $scope.choiceShow = true;
                        $scope.choiceResult = result;
                        if (result.length >0){
                            if (result[0].plugin){
                                $scope.choiceType = "分组类型";
                                $scope.dstDate.dst_type = "group";
                                $scope.dstDate.dst = result[0].id;
                                vm.choiceNode.splice(0, vm.choiceNode.length);
                                // angular.forEach(result, function (data) {
                                //     vm.choiceNode.push(data.id);
                                // });
                            }else{
                                $scope.choiceType = "节点类型";
                                $scope.dstDate.dst_type = "builtin";
                                vm.choiceNode.splice(0, vm.choiceNode.length);
                                angular.forEach(result, function (data, index) {
                                    vm.choiceNode.push(data);
                                });
                                $scope.dstDate.dst = vm.choiceNode.join(",")
                            }
                        }
                    }
                },function (reason) {
                    console.log("error reason", reason)
                }
            );
        };

        vm.choiceSourceFile = function () {
            vm.choiceSourceServer();
            $scope.srcShow = true;
            $scope.varShow = false;
            $scope.varData = null;
            $scope.shareResult = [];
            // $scope.copySrcdata = angular.copy($scope.srcDate);
        };

        vm.choiceVariable = function () {
            var openChoice = $uibModal.open({
                templateUrl: 'app/components/variable/choiceVar.html',
                controller: 'ChoiceVarController',
                controllerAs: 'choicevar',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {}
            });
            openChoice.result.then(
                function (result) {
                    $scope.srcShow = false;
                    $scope.shareResult = [];
                    $scope.varShow = true;
                    $scope.varData = result;
                    $scope.copySrcdata.src_type = "ci";
                    $scope.copySrcdata.sp = result.version;
                    $scope.copySrcdata.src = result.ci;
                },function (reason) {
                    console.log("error reason", reason)
                }
            ); 
        };

        vm.choiceShareFiles = function () {
            var openChoice = $uibModal.open({
                templateUrl: 'app/pages/business/file/choiceFile.html',
                controller: 'ChoiceFileController',
                controllerAs: 'choicefile',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {}
            });
            openChoice.result.then(
                function (result) {
                    if (result.length != 0){
                        $scope.varShow = false;
                        $scope.srcShow = false;
                        $scope.shareResult = result;
                        // $scope.copySrcdata = angular.copy($scope.srcDate);
                        $scope.copySrcdata.sp = result[0].name;
                        $scope.copySrcdata.src_type = "fileserver";
                    }
                },function (reason) {
                    console.log("error reason", reason)
                }
            );
        };

        vm.runLog = function(d){
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/taskDetail.html',
                controller: 'JobDetailController',
                controllerAs: 'jobDetail',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    repoData : function () { return d}
                }
            });
        };

        vm.postData = function () {
            if($scope.copySrcdata.src_type){
                if($scope.copySrcdata.src_type != "fileserver" && !$scope.copySrcdata.src){
                    swal({
                        title:"请选择源服务器",
                        type:'error'
                    });
                    $scope.srcServerShow = true;
                }else {
                    $scope.srcServerShow = false;
                }
            }else {
                // if (){}
                $scope.srcServerShow = true;
                // alert("请选择源服务器");
                swal({
                    title:"请选择源服务器",
                    type:'error'
                });
                return
            }

            if ($scope.dstUser){
                $scope.dstDate.user = $scope.dstUser.username;
                $scope.userShow = false;
            }else {
                $scope.userShow = true;
            }

            if($scope.dstDate.dst){
                $scope.dstServerShow = false;
            }else {
                $scope.dstServerShow = true;
                swal({
                    title:"请选择目标服务器",
                    type:'error'
                });
                return
            }
            $scope.dstDate.timeout = parseInt($scope.dstDate.timeout);
            var post_data = $.extend($scope.dstDate, $scope.copySrcdata);

            post_data.deployenv = vm.postdata.deployenv
            post_data.action = vm.postdata.action
            post_data.batches = vm.postdata.batches

            resoureceService.work.scp(vm.treeid, post_data, null)
                .then(function (repo) {
                    if (repo.stat){
                        vm.runLog(repo.data);
                        // vm.reloadPage();
                        $scope.shareResult = [];
                        $scope.varData = null;
                        $scope.srcDate = {
                            'sp':'',
                            'src_type':'',
                            'src':'',
                        };
                        $scope.dstDate = {
                            'name':'',
                            'user':'',
                            'dst_type':'',
                            'dst':'',
                            'dp':'',
                            'chown':null,
                            'chmod':null,
                            'timeout':'60',
                        };
                        $scope.copySrcdata = angular.copy($scope.srcDate);
                        $scope.dstUser = "";
                        $scope.fileChown = "";
                    }else{
                        toastr.error( "提交任务失败:" + repo.info )
                    }
                }, function (repo) {
                    toastr.error( "提交任务失败:" + repo )

                })


        };

        vm.openDetail = function(d){
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/taskDetail.html',
                controller: 'JobDetailController',
                controllerAs: 'jobDetail',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    repoData : function () { return d}
                }
            });
        };
        vm.getProUser();

}})();

(function () {
    'use strict';
    RunTaskController.$inject = ["$state", "$uibModal", "$http", "$scope", "ngTableParams", "resoureceService", "$injector"];
    angular
        .module('openc3')
        .controller('RunTaskController', RunTaskController);

    function RunTaskController($state, $uibModal,$http, $scope, ngTableParams,resoureceService, $injector) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        vm.jobid = $state.params.jobid;

        var toastr = toastr || $injector.get('toastr');

        $scope.allJobs = [];        // 保存所有项目下的作业
        $scope.jobVar = [];         // 保存作业中需要填写的变量
        $scope.choiceJob = null;    // 已选择的作业数据
        $scope.taskData = {
            'jobname':null,
            'group':null,
            'variable':{},
            'uuid':null,
        };

        vm.getAllJob = function () {
            vm.ciinfo = {}

            $http.get('/api/ci/group/' + vm.treeid).success(function(data){
                if(data.stat)
                {
                    angular.forEach(data.data, function (value, key) {
                        vm.ciinfo['_ci_'+value.id+'_'] = value.name
                        vm.ciinfo['_ci_test_'+value.id+'_'] = value.name + ':测试'
                        vm.ciinfo['_ci_online_'+value.id+'_'] = value.name + ':线上'
                    });

                    $http.get('/api/job/jobs/' + vm.treeid).then(
                        function successCallback(response) {
                            if (response.data.stat){
                                if( vm.jobid )
                                {
                                    angular.forEach(response.data.data, function (value, key) {
                                        if( value.id == vm.jobid )
                                        {
                                            $scope.allJobs = [ value ];
                                            $scope.choiceJob = value
                                        }
                                    });
                                }
                                else
                                {
                                    $scope.allJobs = response.data.data
                                }
                                angular.forEach($scope.allJobs, function (value, key) {
                                    if(vm.ciinfo[value.name])
                                    {
                                        value.alias = '(流水线:' + vm.ciinfo[value.name] +')'
                                    }else{
                                        value.alias = value.name
                                    }
                                });
                            }else {
                                toastr.error( "获取项目机器信息失败："+response.data.info )
                            }
                        },
                        function errorCallback (response ){
                            toastr.error( "获取项目机器信息失败："+response.status )
                        });


                    $http.get('/api/jobx/group/' + vm.treeid).then(
                        function successCallback(response) {
                            if (response.data.stat){
                                $scope.allGroups = response.data.data
                                angular.forEach($scope.allGroups, function (value, key) {
                                    if(vm.ciinfo[value.name])
                                    {
                                        value.alias = '(流水线:' + vm.ciinfo[value.name] +')'
                                    }else{
                                        value.alias = value.name
                                    }
                                });
 
                            }else {
                                toastr.error( "获取分组机器信息失败："+response.data.info )
                            }
                        },
                        function errorCallback (response){
                            toastr.error( "获取分组机器信息失败："+response.status )
                        });
                }
                else
                {
                    toastr.error( "加载流水线名称失败:" + data.info )
                }
            });


        };

        vm._rollbackVersion_ = '';
        vm.deployversion = '';

        vm.iamtask4jobx = 0;
        vm.showjobxgroup = 0;

        vm.runTask = function(){
            var varDict = {};
            angular.forEach($scope.jobVar, function (data, index) {
                varDict[data.name] = data.value;
            });
            if( vm._rollbackVersion_ != "" )
            {
                varDict._rollbackVersion_ = vm._rollbackVersion_;
            }
            if( vm.deployversion != "" )
            {
                varDict.version = vm.deployversion
            }
            $scope.taskData.variable = varDict;

            if( vm.iamtask4jobx )
            {
                resoureceService.task.createtask(vm.treeid, $scope.taskData, null)
                    .then(function (repo) {
                        if (repo.stat){
                            $state.go('home.history.jobxdetail', {treeid:vm.treeid, taskuuid:repo.uuid, accesspage:true});
                        }
                }).finally(function(){ });
            }
            else
            {
                resoureceService.work.runJob(vm.treeid, {"jobuuid":$scope.choiceJob.uuid, "variable": $scope.taskData.variable})
                    .then(function (repo) {
                        if (repo.stat){
                            $state.go('home.history.jobdetail', {treeid:vm.treeid,taskuuid:repo.uuid});
                        }

                     }, function (repo) { });
            }
        };

        $scope.$watch('choiceJob', function () {
            if($scope.choiceJob){
                $scope.taskData.jobname = $scope.choiceJob.name;
                vm._rollbackVersion_ = ''
                vm.deployversion = ''
                vm.iamtask4jobx = 0;
                vm.showjobxgroup = 0;
                $scope.taskData.group = null

                $http.get('/api/job/variable/' + vm.treeid + '/' + $scope.choiceJob.uuid + "?empty=0").then(
                    function successCallback(response) {

                        if (response.data.stat){
                            vm.vartemp = [];
                            angular.forEach(response.data.data, function (value, key) {

                                if( value.value == "" )
                                {
                                    if( value.name == "ip" )
                                    {
                                        if( value.describe != "" )
                                        {
                                            vm.groupstr = value.describe.split(":");
                                            
                                            if( vm.groupstr[0] == 'group' )
                                            {
                                                if( value.describe == 'group' )
                                                {
                                                    vm.iamtask4jobx = 1;
                                                    vm.showjobxgroup = 1;
                                                }
                                                else
                                                {
                                                    $scope.taskData.group = vm.groupstr[1];
                                                    vm.iamtask4jobx = 1;
                                                    vm.showjobxgroup = 0;
                                                }
                                            }
                                            else
                                            {
                                                vm.vartemp.push( value )
                                            }
                                        }
                                        else
                                        {
                                            vm.vartemp.push( value )
                                        }
                                    }
                                    else
                                    {
                                        vm.vartemp.push( value )
                                    }
                                }
                                else
                                {
                                    if( value.name == "_rollbackVersion_" )
                                    {
                                        vm._rollbackVersion_ = value.value
                                    }
                                    if( value.name == "version" )
                                    {
                                        vm.deployversion = value.value
                                    }
                                }

                            });

                            if (vm.vartemp.length == 0){
                                $scope.jobVar = [];
                                $scope.taskData.variable = {};
                            }else {
                                $scope.jobVar = vm.vartemp;

                            }
                        }else {
                            toastr.error( "获取变量信息失败："+response.data.info )
                        }
                    },
                    function errorCallback (response){
                        toastr.error( "获取变量信息失败："+response.status )
                    });

            }

        }, true);
        vm.getAllJob();
    }
})();


(function () {
    // 'use strict';
     CiShowLogController.$inject = ["$uibModalInstance", "$http", "$state", "nodeStr", "ngTableParams", "reloadhome", "versionuuid", "slave", "$websocket", "$injector", "$scope", "$sce", "$timeout"];
    angular
        .module('openc3')
        .controller('CiShowLogController', CiShowLogController);

    function CiShowLogController($uibModalInstance, $http, $state, nodeStr, ngTableParams, reloadhome, versionuuid, slave, $websocket, $injector, $scope, $sce, $timeout ) {

        var vm = this;
        vm.nodeStr = nodeStr;
        $scope.uCanTrust = function(string){
            return $sce.trustAsHtml(string);
        }
        vm.cancel = function(){ $uibModalInstance.dismiss(); };
        var toastr = toastr || $injector.get('toastr');
        vm.treeid = $state.params.treeid;

        vm.openws = function()
        {
            var ansi_up = new AnsiUp;
            vm.siteaddr = window.location.host;

            var wsH = "ws://"
            if ( window.location.protocol == 'https:' )
            {
                wsH = "wss://"
            }
            var urlMySocket = wsH + vm.siteaddr + "/api/ci/slave/"+ slave +"/ws?uuid="+ versionuuid;
 
             vm.ws = $websocket(urlMySocket);
             vm.logDetail = '';
             
             vm.ws.onOpen(function (){
                console.log("opening ws");
             });

             vm.ws.onMessage(function (message) {
                 if(  message.data == 'wsresetws' )
                 {
                     vm.logDetail = '';
                 }
                 else
                 {
                    vm.logDetail = vm.logDetail + ansi_up.ansi_to_html(message.data)
                    $timeout(function () {
                        var dom = document.getElementById('logDetail')
                        dom.scrollTop = dom.scrollHeight
                    }, 0)
                 }
             });
             vm.ws.onError(function (message) {
                 toastr.error('打开日志失败')
             });

        }

        vm.openws();
 
     }
})();

(function () {
    'use strict';
    RunTask2CiController.$inject = ["$state", "$uibModalInstance", "$uibModal", "$http", "$scope", "ngTableParams", "resoureceService", "name", "version", "groupname", "jobtype", "showIPstr", "jobStep", "projectname", "$timeout", "projectid"];
    angular
        .module('openc3')
        .controller('RunTask2CiController', RunTask2CiController);

    function RunTask2CiController($state, $uibModalInstance, $uibModal,$http, $scope, ngTableParams,resoureceService, name, version, groupname, jobtype, showIPstr, jobStep, projectname, $timeout, projectid ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        vm.version = version

        vm.projectname = projectname
        vm.showIPstr = showIPstr
        vm.jobStep = jobStep
        vm.jobtype = jobtype
        $scope.taskData = {
            'jobname':null,
            'group':groupname,
            'variable':{},
            'uuid':null,
        };
        vm.rollbacknoneeded = false


        vm.jobinfo;
        vm.getAllJob = function () {
            $http.get('/api/job/jobs/' + vm.treeid).then(
                function successCallback(response) {
                    if (response.data.stat){
                        angular.forEach(response.data.data, function (data, index) {
                            if( data.name == name )
                            {
                                vm.jobinfo = data
                            }
                        });
 
                        if( vm.jobinfo )
                        {
                            $scope.taskData.jobname = vm.jobinfo.name;

                            $http.get('/api/job/variable/' + vm.treeid + '/' + vm.jobinfo.uuid + "?empty=1").then(
                               function successCallback(response) {
                                   if (response.data.stat){
                               //        if (response.data.data.length == 0){
                               //            $scope.jobVar = [];
                               //            $scope.taskData.variable = { '_jobtype_': jobtype };
                               //        }else {
                                           $scope.jobVar = response.data.data;

                                           if( jobtype == 'test' )
                                           {
                                               $scope.taskData.variable = {version: version, '_jobtype_': jobtype, '_exit_': 1 };
                                           }
                                           else
                                           {
                                               $scope.taskData.variable = {version: version, '_jobtype_': jobtype, '_appname_': $scope.taskData.jobname, '_skipSameVersion_': 0 };
                                           }
                               //        }
                                  }else {
                                      alert("获取作业变量失败："+response.data.info)
                                  }
                              },
                              function errorCallback (response ){ });
                        }else {
                            alert("作业没有进行配置："+response.data.info)
                        }
                    }else {
                        alert("获取作业列表失败："+response.data.info)
                    }
                },
                function errorCallback (response ){
                });
        };




        vm.getAllGroup = function () {
            $http.get('/api/jobx/group/' + vm.treeid).then(
                function successCallback(response) {
                    if (response.data.stat){
                        $scope.allGroups = response.data.data
                    }else {
                        // alert("获取分组信息失败："+response.data.info)
                    }
                },
                function errorCallback (response){
                    $scope.dataready = false;
                    $scope.dataerror = "获取分组信息失败";
                });
        };

        vm.runTask = function(){
            if ( vm.rollbacknoneeded )
            {
                delete $scope.taskData.variable._rollbackVersion_;
            }
            resoureceService.task.createtask(vm.treeid, $scope.taskData, null)
                .then(function (repo) {
                    if (repo.stat){
                        $state.go('home.history.jobxdetail', {treeid:vm.treeid, taskuuid:repo.uuid, accesspage:true});
                        vm.cancel()
                    }
            }).finally(function(){ });
        };
        vm.getAllJob();
        vm.getAllGroup();
        vm.cancel = function(){ $uibModalInstance.dismiss()};

        vm.setRollbackVersion = function ( version )
        {
            $scope.taskData.variable._rollbackVersion_ = version
        }

        vm.lastversion = {};
        vm.getLastVersion = function () {
            $http.get('/api/jobx/flowline_version/' + projectid ).then(
                function successCallback(response) {
                    if (response.data.stat) {
                        vm.lastversion = response.data.data;
                    }else{
                        toastr.error( "获取作业信息失败：" + response.data.info )
                    };
                });
                function errorCallback(response) {
                    toastr.error( "获取作业信息失败：" + response.status )
                }
        };


        vm.getLastVersion();

        vm.showVersions = function (data) {
            var data_info = JSON.stringify(data);
            angular.forEach(data, function (value, key) {
                var container = '#task' + key;
                $(container).highcharts({
                    chart: {
                        plotBackgroundColor: null,
                        plotBorderWidth: null,
                        plotShadow: false
                    },
                    title: {
                        text: ''
                    },
                    tooltip: {
                        headerFormat: '{series.name}<br>',
                        pointFormat: '{point.name}: <b>{point.percentage:.1f}%</b>'
                    },
                    plotOptions: {
                        pie: {
                            allowPointSelect: true,
                            cursor: 'pointer',
                            dataLabels: {
                                enabled: true,
                                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                                style: {
                                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                                }
                            }
                        }
                    },
                    series: [{
                        type: 'pie',
                        name: '',
                        data: value
                    }]
                });
            });

        };

        vm.cleanRollbackVersion = function () {
            if (vm.rollbacknoneeded){
                $scope.taskData.variable._rollbackVersion_ = "";
            }
        };

    }
})();


(function() {
    'use strict';

    CiGroupController.$inject = ["$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$websocket", "genericService", "$scope", "$injector"];
    angular
        .module('openc3')
        .controller('CiGroupController', CiGroupController);

    function CiGroupController($location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $websocket, genericService, $scope, $injector) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        vm.time2date = genericService.time2date
        var toastr = toastr || $injector.get('toastr');

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        $scope.panelcolor = { "success": "green", "fail": "red", "refuse": "orange",  "running": "#98b2bc", "decision": "#aaa", "ignore": "#aaa" }

        vm.versiondetail = function (id) {
            $state.go('home.quickentry.flowlinedetail', {treeid:vm.treeid, projectid: id});
        };

        vm.editconfig = function (id,name) {
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/flowline/detail/config.html',
                controller: 'ConfigController',
                controllerAs: 'config',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    getGroup: function () {return vm.getGroupInfo},
                    projectid: function () {return id},
                    treeid: function () {return vm.treeid},
                    name: function () {return name},
                    groupid: function () {},
                }
            });
        };

        vm.flowlinecount = 0;
        vm.reload = function(){
            vm.loadover = false;
            $http.get('/api/ci/group/' + vm.treeid ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.activeRegionTable = new ngTableParams({count:20}, {counts:[],data:data.data.reverse()});
                    vm.flowlinecount = data.data.length
                    vm.loadover = true;
                } else { 
                    toastr.error( "加载版本失败:" + data.info )
                }
            });
        };

        vm.reload();

        vm.showlog = function(versionuuid,slave){
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/flowline/showlog.html',
                controller: 'CiShowLogController',
                controllerAs: 'showlog', 
                backdrop: 'static', 
                size: 'lg', 
                keyboard: false,
                windowClass:'modal-class',
                bindToController: true,
                resolve: {
                    nodeStr: function () { return vm.nodeStr },
                    reloadhome: function () { return vm.reload },
                    versionuuid: function () { return versionuuid },
                    slave: function () { return slave }
                }
            });
        };

        vm.deployDetail = function(uuid){
            $state.go('home.history.jobxdetail', {treeid:vm.treeid, taskuuid:uuid, accesspage:true});
        };


        vm.addToFavorites = function (id, name) {
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/flowline/addToFavorites.html',
                controller: 'AddToFavoritesController',
                controllerAs: 'addToFavorites',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () { return vm.treeid},
                    sourceid: function () { return id},
                    sourcename: function () { return name},
                    reload : function () { return vm.reload}
                }
            });
        };


        vm.delToFavorites = function(id) {
          swal({
            title: "取消收藏",
            text: "取消",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){
            $http.delete('/api/ci/favorites/' + vm.treeid + '?ciid=' + id ).success(function(data){
                if(data.stat)
                {
                    vm.reload();
                }
                else
                {
                    toastr.error( "取消收藏失败:" + data.info )
                }
            });
          });
        }

        vm.copyProject = function (id, name) {
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/flowline/copyProject.html',
                controller: 'CopyProjectController',
                controllerAs: 'copyProject',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () { return vm.treeid},
                    sourceid: function () { return id},
                    sourcename: function () { return name+ '_copy'},
                    reload : function () { return vm.reload}
                }
            });
        };

        vm.copyProjectToTemplate = function (id, name) {
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/flowline/copyProjectToTemplate.html',
                controller: 'CopyProjectToTemplateController',
                controllerAs: 'copyProjectToTemplate',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () { return vm.treeid},
                    sourceid: function () { return id},
                    sourcename: function () { return name},
                    reload : function () { return vm.reload}
                }
            });
        };

        vm.createProject = function () {
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/flowline/create/blank.html',
                controller: 'CreateProjectController',
                controllerAs: 'createProject',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () { return vm.treeid},
                    reload : function () { return vm.reload}
                }
            });
        };

        vm.createProjectByTemplate = function () {
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/flowline/create/bytemplate.html',
                controller: 'CreateProjectByTemplateController',
                controllerAs: 'createProjectByTemplate',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () { return vm.treeid},
                    reload : function () { return vm.reload}
                }
            });
        };


        vm.deleteProject = function(id) {
          swal({
            title: "是否要删除该流水线",
            text: "删除后不能恢复",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){
            $http.delete('/api/job/jobs/' + vm.treeid + '/_ci_' + id +'_/byname' ).success(function(data){
                if( ! data.stat ){ toastr.error("删除作业配置失败:" + date.info)}
                $http.delete( '/api/ci/project/' + vm.treeid+'/'+ id ).success(function(data){
                    if( ! data.stat ){ toastr.error("删除持续构建配置失败:" + date.info)}
                    $http.delete( '/api/jobx/group/' + vm.treeid + '/_ci_test_' + id +'_/byname'  ).success(function(data){
                        if( ! data.stat ){ toastr.error("删除测试分批组失败:" + date.info)}
                        $http.delete( '/api/jobx/group/' + vm.treeid + '/_ci_online_' + id +'_/byname'  ).success(function(data){
                            if( ! data.stat ){ toastr.error("删除线上分批组失败:" + date.info)}
                            vm.reload();
                        });
                    });
                });
            });
          });
        }

        vm.taskInfoTest = {}
        vm.taskInfoOnline = {}

        vm.taskInfoTestRunning = {}
        vm.taskInfoOnlineRunning = {}

        vm.getTaskInfo = function (treeId) {
            $http.get('/api/jobx/task/' + treeId + '?allowslavenull=1&name=_ci_' ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        angular.forEach(response.data.data, function (value, key) {

                        var projectid = vm.cprojectid( value.name );
                        var version = vm.cversion( value.variable );
                        var jobtype = vm.cjobtype( value.variable );
                        value.version = version

                        if( value.slave != '_null_' && jobtype == 'test' )
                        {
                            vm.taskInfoTest[projectid] = value
                            if( value.status == 'running' )
                            {
                                vm.taskInfoTestRunning[projectid] = 1
                            }
                        }

                        if( value.slave != '_null_' && jobtype == 'online' )
                        {
                            vm.taskInfoOnline[projectid] = value
                            if( value.status == 'running' )
                            {
                                vm.taskInfoOnlineRunning[projectid] = 1
                            }
                        }

                        });
                    }else {
                    }
                },
                function errorCallback (response){
                });
        };
        vm.getTaskInfo(vm.treeid);

        vm.cprojectid = function(text) {
            var w = text.split("_");
            if(w[1] == 'ci' && w[0] == '' && w[3] == '' )
            {
                return w[2]
            }
            else
            {
                return ''
            }
        }

        vm.cversion = function(text) {
            var w = '';
            var re=/\bversion:.*/;
            if (re.test(text)){
                var reStr = re.exec(text)[0];
                w = reStr.split(" ")[1]
                var xx = /'/;
                if( xx.test(w) )
                {
                    w = w.split("'")[1]
                }
            }
            return w
        }

        vm.cjobtype = function(text) {
            var w = '';
            var re=/\b_jobtype_:.*/;
            if (re.test(text)){
                var reStr = re.exec(text)[0];
                w = reStr.split(" ")[1]
                var xx = /'/;
                if( xx.test(w) )
                {
                    w = w.split("'")[1]
                }
            }
            return w
        }

        vm.deployType = function (uuid){
            uuid = uuid.slice(uuid.length - 1);
            if (64 < uuid.charCodeAt(0) && uuid.charCodeAt(0) < 91) {
                return '回滚'
            } else {
                return '发布'
            }
        };

        vm.describedeployment = function (ticketid,type,name,namespace) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/describedeployment.html',
                controller: 'KubernetesDescribeDeploymentController',
                controllerAs: 'kubernetesdescribedeployment',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return ticketid},
                }
            });
        };

    }
})();

(function () {
    'use strict';
    CopyProjectToTemplateController.$inject = ["$http", "$uibModalInstance", "$scope", "resoureceService", "treeid", "reload", "sourceid", "sourcename", "$injector"];
    angular
        .module('openc3')
        .controller('CopyProjectToTemplateController', CopyProjectToTemplateController);

    function CopyProjectToTemplateController($http, $uibModalInstance, $scope, resoureceService, treeid, reload, sourceid, sourcename, $injector ) {

        var vm = this;
        vm.status = 0
        $scope.projectname = sourcename

        vm.cancel = function(){ $uibModalInstance.dismiss()};
        var toastr = toastr || $injector.get('toastr');
        vm.add = function(){
            var s = 0
            if ( vm.status )
            {
                s = 1
            }
            $http.post('/api/ci/group/' + 0 , { name: $scope.projectname, sourceid: sourceid, status: s } ).success(function(data){
                vm.install = { username: 'root' };
                    if(data.stat == true) {
                        var toid = data.id

                        $http.post('/api/job/jobs/' + treeid  + '/copy/byname', { fromname: '_ci_' + sourceid+'_', toname: '_ci_' + toid + '_', toprojectid: 0 } ).success(function(data){
                            vm.install = { username: 'root' };
                                if(data.stat == true) {
                                    $http.post('/api/jobx/group/' + treeid  + '/copy/byname', { fromname: '_ci_test_' + sourceid+'_', toname: '_ci_test_' + toid + '_', toprojectid: 0 } ).success(function(data){
                                        vm.install = { username: 'root' };
                                            if(data.stat == true) {
                                                $http.post('/api/jobx/group/' + treeid  + '/copy/byname', { fromname: '_ci_online_' + sourceid+'_', toname: '_ci_online_' + toid + '_', toprojectid: 0 } ).success(function(data){
                                                    vm.install = { username: 'root' };
                                                        if(data.stat == true) {
                                                            vm.cancel();
                                                            reload();
                                                        } else { toastr.error("提交失败:" + data.info ); }
                                                });
                                            } else { toastr.error( "提交失败:" + data.info ); }
                                    });
                                } else { toastr.error( "提交失败:" + data.info ); }
                        });
                    } else { toastr.error( "提交失败:" + data.info ); }
            });
        };
    }
})();


(function () {
    'use strict';
    CopyProjectByTemplateController.$inject = ["$http", "$uibModalInstance", "$scope", "resoureceService", "treeid", "reload", "sourceid", "sourcename", "cancel", "$injector"];
    angular
        .module('openc3')
        .controller('CopyProjectByTemplateController', CopyProjectByTemplateController);

    function CopyProjectByTemplateController($http, $uibModalInstance, $scope, resoureceService, treeid, reload, sourceid, sourcename, cancel, $injector ) {

        var vm = this;
        vm.status = 0
        $scope.projectname = sourcename
        var toastr = toastr || $injector.get('toastr');

        vm.cancel = function(){ $uibModalInstance.dismiss(); };
        vm.add = function(){
            var s = 0
            if ( vm.status )
            {
                s = 1
            }
            $http.post('/api/ci/group/' + treeid , { name: $scope.projectname, sourceid: sourceid, status: s } ).success(function(data){
                vm.install = { username: 'root' };
                    if(data.stat == true) {
                        var toid = data.id

                        $http.post('/api/job/jobs/' + treeid  + '/copy/byname', { fromname: '_ci_' + sourceid+'_', toname: '_ci_' + toid + '_', fromprojectid: 0 } ).success(function(data){
                            vm.install = { username: 'root' };
                                if(data.stat == true) {
                                    $http.post('/api/jobx/group/' + treeid  + '/copy/byname', { fromname: '_ci_test_' + sourceid+'_', toname: '_ci_test_' + toid + '_', fromprojectid: 0 } ).success(function(data){
                                        vm.install = { username: 'root' };
                                            if(data.stat == true) {
                                                $http.post('/api/jobx/group/' + treeid  + '/copy/byname', { fromname: '_ci_online_' + sourceid+'_', toname: '_ci_online_' + toid + '_', fromprojectid: 0 } ).success(function(data){
                                                    vm.install = { username: 'root' };
                                                        if(data.stat == true) {
                                                            vm.cancel();
                                                            cancel();
                                                            reload();
                                                        } else { toastr.error( "提交失败:" + data.info ); }
                                                });
                                            } else { toastr.error( "提交失败:" +data.info ); }
                                    });
                                } else { toastr.error( "提交失败:" + data.info ); }
                        });
                    } else { toastr.error("提交失败:" + data.info ); }
            });
        };
    }
})();


(function () {
    'use strict';
    CopyProjectController.$inject = ["$http", "$uibModalInstance", "$scope", "resoureceService", "treeid", "reload", "sourceid", "sourcename", "$injector"];
    angular
        .module('openc3')
        .controller('CopyProjectController', CopyProjectController);

    function CopyProjectController($http, $uibModalInstance, $scope, resoureceService, treeid, reload, sourceid, sourcename, $injector ) {

        var vm = this;
        vm.status = 0
        $scope.projectname = sourcename
        var toastr = toastr || $injector.get('toastr');

        vm.cancel = function(){ $uibModalInstance.dismiss()};
        vm.add = function(){
            var s = 0
            if ( vm.status )
            {
                s = 1
            }
            $http.post('/api/ci/group/' + treeid , { name: $scope.projectname, sourceid: sourceid, status: s } ).success(function(data){
                vm.install = { username: 'root' };
                    if(data.stat == true) {
                        var toid = data.id

                        $http.post('/api/job/jobs/' + treeid  + '/copy/byname', { fromname: '_ci_' + sourceid+'_', toname: '_ci_' + toid + '_' } ).success(function(data){
                            vm.install = { username: 'root' };
                                if(data.stat == true) {
                                    $http.post('/api/jobx/group/' + treeid  + '/copy/byname', { fromname: '_ci_test_' + sourceid+'_', toname: '_ci_test_' + toid + '_' } ).success(function(data){
                                        vm.install = { username: 'root' };
                                            if(data.stat == true) {
                                                $http.post('/api/jobx/group/' + treeid  + '/copy/byname', { fromname: '_ci_online_' + sourceid+'_', toname: '_ci_online_' + toid + '_' } ).success(function(data){
                                                    vm.install = { username: 'root' };
                                                        if(data.stat == true) {
                                                            vm.cancel();
                                                            reload();
                                                        } else { toastr.error( "提交失败:" + data.info ); }
                                                });
                                            } else { toastr.error( "提交失败:" + data.info ); }
                                    });
                                } else { toastr.error("提交失败:" + data.info); }
                        });
                    } else { toastr.error("提交失败:" + data.info); }
            });
        };
    }
})();


(function () {
    'use strict';
    AddToFavoritesController.$inject = ["$http", "$uibModalInstance", "$scope", "resoureceService", "treeid", "reload", "sourceid", "sourcename", "$injector"];
    angular
        .module('openc3')
        .controller('AddToFavoritesController', AddToFavoritesController);

    function AddToFavoritesController($http, $uibModalInstance, $scope, resoureceService, treeid, reload, sourceid, sourcename, $injector ) {

        var vm = this;
        $scope.projectname = sourcename
        var toastr = toastr || $injector.get('toastr');

        vm.cancel = function(){ $uibModalInstance.dismiss()};
        vm.add = function(){
            $http.post('/api/ci/favorites/' + treeid , { name: $scope.projectname, ciid: sourceid } ).success(function(data){
                vm.install = { username: 'root' };
                    if(data.stat == true) {
                        vm.cancel();
                        reload();
                        toastr.success( "收藏成功" )
                    }
                    else
                    {
                        toastr.error( "收藏失败:" + data.info )
                    }
            });
        };
    }
})();


(function() {
    'use strict';

QuickController.$inject = ["$scope", "$filter", "$state", "$http", "$window", "$uibModal", "$timeout", "treeService", "resoureceService", "scriptId", "$injector"];
    angular
        .module('openc3')
        .controller('QuickController', QuickController);

    function QuickController($scope,$filter, $state, $http,$window,$uibModal, $timeout,treeService,resoureceService, scriptId, $injector) {

        var vm = this;
        $scope.dataready = true;
        var toastr = toastr || $injector.get('toastr');
        vm.choiceNode = [];
        vm.scriptid = scriptId.getter();
        scriptId.del();
        vm.treeid = $state.params.treeid;
        vm.scriptHide = true;
        $scope.choiceShow = false;
        $scope.s_argv = "";
        $scope.s_timeout = '60';
        vm.s_name = "快速执行脚本-" + $filter('date')(new Date, "yyyyMMddHHmmss") + $filter('date')(new Date, "sss");

        vm.postdata = { deployenv: 'always', action: 'always', batches: 'always' };

        treeService.sync.then(function(){      // when the tree was success.
            vm.nodeStr = treeService.selectname();  // get tree name

        });

        vm.getAllScript = function () {
            vm.scriptHide = true;
            if (vm.treeid){
                $http.get('/api/job/scripts/' + vm.treeid).success(function(data){
                    vm.scriptHide = true;
                    if (data.stat){
                        $scope.allScript = data.data;
                    }
                });
            }
        };

        vm.getProUser = function () {
            if (vm.treeid){
                $http.get('/api/job/userlist/' + vm.treeid).then(

                    function successCallback (response) {
                        if (response.data.stat){
                            $scope.allProUsers= response.data.data;
                        }else {
                            toastr.error( "获取执行账户列表失败："+response.data.info )
                        }
                    },
                    function errorCallback () {
                        toastr.error( "获取执行账户列表失败："+response.status )
                    }
                );
            }
        };

        vm.addProUser = function () {
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/addUser.html',
                controller: 'AddUserController',
                controllerAs: 'addUser',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    reloadUser : function () { return vm.getProUser}
                }
            });
        };

        vm.delChoice = function (id, name) {
            if (id >=0){
                $scope.choiceResult.splice(id, 1);
                angular.forEach(vm.choiceNode, function (data, index) {
                    if (data == name){
                        vm.choiceNode.splice(index, 1);
                    }
                });

            }
        };

        vm.choiceServer = function () {
            var openChoice = $uibModal.open({
                templateUrl: 'app/components/machine/choiceMachine.html',
                controller: 'ChoiceController',
                controllerAs: 'choice',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},

                }
            });
            openChoice.result.then(
                function (result) {
                    if (result.length != 0){
                        $scope.choiceShow = true;
                        $scope.choiceResult = result;
                        if (result.length >0){
                            if (result[0].plugin){
                                $scope.choiceType = "分组类型";
                                $scope.nodeType = "group";
                                vm.choiceNode.splice(0, vm.choiceNode.length);
                                angular.forEach(result, function (data) {
                                    vm.choiceNode.push(data.id);
                                });
                            }else {
                                $scope.choiceType = "节点类型";
                                $scope.nodeType = "builtin";
                                vm.choiceNode.splice(0, vm.choiceNode.length);
                                angular.forEach(result, function (data) {
                                    vm.choiceNode.push(data);
                                });
                            }
                        }
                    }
                },function (reason) {
                    console.log("error reason", reason)
                }
            );
        };

        vm.editorSh = function (data, re) {
            vm.shEditor = ace.edit("editor");
            var sheditor  = vm.shEditor;
            sheditor.setTheme("ace/theme/dracula");
            sheditor.session.setMode("ace/mode/sh");
            document.getElementById('editor').style.fontSize='14px';
            sheditor.setShowPrintMargin(false);
            sheditor.setHighlightActiveLine(false);
            if (data){
                sheditor.setValue(data);
            }
            if (re){
                sheditor.setReadOnly(true)
            }
            vm.leaveeditor();
        };

        vm.editorPy = function (data, re) {
            vm.pyEditor = ace.edit("editor");
            var pyeditor = vm.pyEditor;
            pyeditor.setTheme("ace/theme/dracula");
            pyeditor.session.setMode("ace/mode/python");
            document.getElementById('editor').style.fontSize='14px';
            document.getElementById('editor').style.font='14px';
            pyeditor.setShowPrintMargin(false);
            pyeditor.setHighlightActiveLine(false);
            if (data){
                pyeditor.setValue(data);
            }
            if (re){
                pyeditor.setReadOnly(true)
            }
            vm.leaveeditor();
        };

        vm.editorPerl = function (data, re) {
            vm.perlEditor = ace.edit("editor");
            var perleditor = vm.perlEditor;
            perleditor.setTheme("ace/theme/dracula");
            perleditor.session.setMode("ace/mode/perl");
            document.getElementById('editor').style.fontSize='14px';
            document.getElementById('editor').style.font='14px';
            perleditor.setShowPrintMargin(false);
            perleditor.setHighlightActiveLine(false);
            if (data){
                perleditor.setValue(data);
            }
            if (re){
                perleditor.setReadOnly(true)
            }
            vm.leaveeditor();
        };

        vm.editorPhp = function (data, re) {
            vm.phpEditor = ace.edit("editor");
            var phpeditor = vm.phpEditor;
            phpeditor.setTheme("ace/theme/dracula");
            phpeditor.session.setMode("ace/mode/perl");
            document.getElementById('editor').style.fontSize='14px';
            document.getElementById('editor').style.font='14px';
            phpeditor.setShowPrintMargin(false);
            phpeditor.setHighlightActiveLine(false);
            if (data){
                phpeditor.setValue(data);
            }
            if (re){
                phpeditor.setReadOnly(true)
            }
            vm.leaveeditor();
        };

        vm.editorBuildin = function (data, re) {
            vm.buildinEditor = ace.edit("editor");
            var buildineditor = vm.buildinEditor;
            buildineditor.setTheme("ace/theme/dracula");
            buildineditor.session.setMode("ace/mode/sh");
            document.getElementById('editor').style.fontSize='14px';
            document.getElementById('editor').style.font='14px';
            buildineditor.setShowPrintMargin(false);
            buildineditor.setHighlightActiveLine(false);
            if (data){
                buildineditor.setValue(data);
            }
            if (re){
                buildineditor.setReadOnly(true)
            }
            vm.leaveeditor();
        };

        vm.editorAuto = function (data, re) {
            vm.autoEditor = ace.edit("editor");
            var autoeditor  = vm.autoEditor;
            autoeditor.setTheme("ace/theme/dracula");
            autoeditor.session.setMode("ace/mode/sh");
            document.getElementById('editor').style.fontSize='14px';
            autoeditor.setShowPrintMargin(false);
            autoeditor.setHighlightActiveLine(false);
            if (data){
                autoeditor.setValue(data);
            }
            if (re){
                autoeditor.setReadOnly(true)
            }
            vm.leaveeditor();
        };

        vm.showmachinelist = 1;

        vm.leaveeditor = function() {
            vm.showmachinelist = 1;
            if($scope.scriptType == "buildin"){
                var cont = vm.buildinEditor.getValue();
                if( cont.search(/^#!kubectl\b/) == 0 )
                {
                    vm.showmachinelist = 0;
                }
                if( cont.search(/^#!terraform\b/) == 0 )
                {
                    vm.showmachinelist = 0;
                }
                if( cont.search(/^#!kubestar\b/) == 0 )
                {
                    vm.showmachinelist = 0;
                }
                if( cont.search(/^#!awsecs\b/) == 0 )
                {
                    vm.showmachinelist = 0;
                }
                if( cont.search(/^#!sendemail\b/) == 0 )
                {
                    vm.showmachinelist = 0;
                }
                if( cont.search(/^#!sendmesg\b/) == 0 )
                {
                    vm.showmachinelist = 0;
                }
                if( cont.search(/^#!flowcaller\b/) == 0 )
                {
                    vm.showmachinelist = 0;
                }
                if( cont.search(/^#!cdnrefresh\b/) == 0 )
                {
                    vm.showmachinelist = 0;
                }
                if( cont.search(/^#!kubernetes\b/) == 0 )
                {
                    vm.showmachinelist = 0;
                }
            }
        }

        vm.buildinSet = function( name ) {
            vm.editorBuildin( '#!' + name, false );
        }

        vm.scriptTypeEditor = {
            "shell": vm.editorSh,
            "python": vm.editorPy,
            "perl": vm.editorPerl,
            "php": vm.editorPhp,
            "buildin": vm.editorBuildin,
            "auto": vm.editorAuto
        };
        vm.click = '';
        vm.scriptManual =function () {
            if (vm.click != "manual"){
                ace.edit("editor").setValue('');
                ace.edit("editor").setReadOnly(false);
                $scope.unClick = false;
                vm.editorSh(null, false);
                $scope.scriptType = "shell";
            }
            vm.scriptHide = true;
            vm.click = "manual";
        };
        vm.scriptManual();
        vm.from = 'manual';
        vm.scriptClone =function () {
            if (vm.click != "clone"){
                vm.scriptHide = false;
                $scope.selectedScript = '';
                ace.edit("editor").setValue('');
                ace.edit("editor").setReadOnly(false);
                $scope.scriptType = "";
            }
            vm.click = "clone";

        };

        vm.scriptLocal =function () {
            if (vm.click != "local"){
                vm.scriptHide = false;
                $scope.selectedScript = '';
                ace.edit("editor").setValue('');
                ace.edit("editor").setReadOnly(true);
                $scope.scriptType = "";
            }
            vm.click = "local";

        };

        vm.run = function (scriptForm) {
            var cont = '';
            if ($scope.scriptType == "shell"){
                cont = vm.shEditor.getValue();
            }else if($scope.scriptType == "python"){
                cont = vm.pyEditor.getValue();
            }else if($scope.scriptType == "perl"){
                cont = vm.perlEditor.getValue();
            }else if($scope.scriptType == "php"){
                cont = vm.phpEditor.getValue();
            }else if($scope.scriptType == "buildin"){
                cont = vm.buildinEditor.getValue();
                if( vm.showmachinelist == 0  )
                {
                    $scope.nodeType = 'builtin';
                    vm.choiceNode = [ 'openc3skipnode' ]
                }
            }else if($scope.scriptType == "auto"){
                cont = vm.autoEditor.getValue();
            }

            if (!vm.from){
                swal({
                    title:"脚本来源不能为空",
                    type:'error'
                });
                return
            }else if (vm.choiceNode.length == 0){
                swal({
                    title:"所选机器不能为空",
                    type:'error'
                });
                return
            }else if(!$scope.scriptType){
                swal({
                    title:"脚本类型不能为空",
                    type:'error'
                });
                return
            }else if(!cont){
                swal({
                    title:"脚本内容为空",
                    type:'error'
                });
                return
            }else if(!$scope.selectedUser){
                swal({
                    title:"用户不能为空",
                    type:'error'
                });
                return
            }

            cont = cont.replace(/\r\n/g, "\n");
            var post_data ={
                'name': vm.s_name,
                'user': $scope.selectedUser,
                'node_type':$scope.nodeType,
                'node_cont':vm.choiceNode.join(","),
                'scripts_type':$scope.scriptType,
                'scripts_cont': cont,
                'scripts_argv': $scope.s_argv,
                'timeout': parseInt($scope.s_timeout),
                'deployenv' : vm.postdata.deployenv,
                'action' : vm.postdata.action,
                'batches' : vm.postdata.batches
            };
            resoureceService.work.runScript(vm.treeid, post_data, null)
                .then(function (repo) {
                    // success
                    scriptForm.$setPristine();
                    scriptForm.$setUntouched();

                    vm.s_name = "快速执行脚本-" + $filter('date')(new Date, "yyyyMMddHHmmss") + $filter('date')(new Date, "sss");
                    vm.from = '';
                    vm.click = '';
                    $scope.choiceResult = [];
                    $scope.selectedUser = '';
                    $scope.scriptType = '';
                    $scope.s_timeout = '60';
                    $scope.s_argv = '';
                    $scope.choiceShow = false;
                    ace.edit("editor").setValue('');
                    ace.edit("editor").setReadOnly(false);
                    vm.scriptManual();
                    vm.from = 'manual';
                    vm.getAllScript();
                    if (repo.stat){
                        vm.openDetail(repo.data);
                    }
                    else
                    {
                        toastr.error("提交执行失败:" + repo.info)
                    }

                },function (repo) {
                    toastr.error("提交执行失败:" + repo)
                })

        };

        vm.openDetail = function(d){
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/taskDetail.html',
                controller: 'JobDetailController',
                controllerAs: 'jobDetail',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    repoData : function () { return d}
                }
            });
        };

        vm.inputScript = function () {
            vm.selected_id = $scope.selectedScript.id;
            $http.get('/api/job/scripts/' + vm.treeid + "/" + vm.selected_id).success(function(data){
                if (data.stat){
                    var inputEdit = vm.scriptTypeEditor[data.data.type];
                    var scriptData = data.data;
                    if (vm.from == "clone"){
                        inputEdit(data.data.cont, false);

                    }else if (vm.from == "local"){
                        inputEdit(data.data.cont, true);
                    }
                    $scope.scriptType = data.data.type;
                }
            });
        };


        if (vm.scriptid){
            $http.get('/api/job/scripts/' + vm.treeid + "/" + vm.scriptid).success(function(data){

                var scriptDict = data.data;
                vm.s_name = scriptDict.name;
                vm.s_cont = scriptDict.cont;
                $scope.scriptType = scriptDict.type;
                $scope.unClick = "true";
                vm.from = "local";
                if (scriptDict.type == "shell"){
                    vm.editorSh(vm.s_cont, true);
                }else if (scriptDict.type == "python"){
                    vm.editorPy(vm.s_cont, true);
                }else if (scriptDict.type == "perl"){
                    vm.editorPerl(vm.s_cont, true);
                }else if (scriptDict.type == "php"){
                    vm.editorPhp(vm.s_cont, true);
                }else if (scriptDict.type == "buildin"){
                    vm.editorBuildin(vm.s_cont, true);
                }else if (scriptDict.type == "auto"){
                    vm.editorAuto(vm.s_cont, true);
                }
                // editor.setReadOnly(false);
                // $("#editor").find("textarea").attr('readonly', 'readonly')
            });

        }else {
            vm.getAllScript();

        }
        vm.getProUser();

        vm.reloadticket = function(){
            $http.get('/api/ci/ticket?type=JobBuildin').success(function(data){
                if( data.stat)
                {
                    vm.ticketinfo = data.data;
                    vm.ticketinfo.unshift({ id: '0', name: 'null' })
                }
                else
                {
                    toastr.error( "加载凭据列表失败:" + data.info )
                }
            });
        };

        vm.reloadticket();

}})();

(function() {
    'use strict';

QuickentryApprovalController.$inject = ["$scope", "$filter", "$state", "$http", "$window", "$uibModal", "$timeout", "treeService", "resoureceService", "scriptId"];
    angular
        .module('openc3')
        .controller('QuickentryApprovalController', QuickentryApprovalController);

    function QuickentryApprovalController($scope,$filter, $state, $http,$window,$uibModal, $timeout, treeService, resoureceService, scriptId) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        vm.postdata = { timeout: '86400', approver: '', cont: '审批一下吧', name: '', deployenv: 'always', action: 'always', batches: 'always', everyone: 'on'  };
        vm.postdata.name = "快速审批插件-" + $filter('date')(new Date, "yyyyMMddHHmmss") + $filter('date')(new Date, "sss");
        treeService.sync.then(function(){ 
            vm.nodeStr = treeService.selectname();

        });

        vm.openDetail = function(d){
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/taskDetail.html',
                controller: 'JobDetailController',
                controllerAs: 'jobDetail',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    repoData : function () { return d}
                }
            });
        };

        vm.runapproval = function(){
            $http.post('/api/job/task/' + vm.treeid + "/plugin_approval", vm.postdata ).success(function(data){
                if(data.stat) {
                    vm.openDetail(data.data);
                } else {
                    swal({ title: "提交失败!", text: data.info, type:'error' });
                }

            });
        };

}})();

(function() {
    'use strict';

    HistoryTerminalController.$inject = ["$filter", "$state", "$http", "$uibModal", "$scope", "ngTableParams"];
    angular
        .module('openc3')
        .controller('HistoryTerminalController', HistoryTerminalController);

    function HistoryTerminalController($filter, $state, $http, $uibModal, $scope, ngTableParams) {

        var vm = this;
        $scope.searchStatus = "";
        vm.treeid = $state.params.treeid;
        $scope.nowTime = $filter('date')(new Date, "yyyy-MM-dd");
        vm.timeStart = $scope.nowTime;

        $('#time_start').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.timeStart = result;
            $scope.$apply();
        });

        $('#time_end').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.timeEnd= result;
            $scope.$apply();
        });

        vm.getMe = function () {
            $http.get('/api/connector/connectorx/sso/userinfo').success(function(data){
                vm.startuser = data.email;
            });
        };

        vm.Reset = function () {
            vm.startuser = "";
            vm.runnode = "";
            vm.runusr = "";
            vm.runcmd = "";
            vm.timeStart = $scope.nowTime;
            vm.timeEnd = "";
            vm.reload()
        };

        vm.reload = function () {
            vm.loadover = false
            var get_data = {};

            if(vm.startuser){
                get_data.user=vm.startuser
            }
            if(vm.runnode){
                get_data.node=vm.runnode
            }
            if(vm.runusr){
                get_data.usr=vm.runusr
            }
            if(vm.runcmd){
                get_data.cmd=vm.runcmd
            }
            if(vm.timeStart){
                get_data.time_start=vm.timeStart
            }
            if(vm.timeEnd){
                get_data.time_end=vm.timeEnd
            }
                $http({
                    method:'GET',
                    url:'/api/job/cmd/' + vm.treeid + '/log',
                    params:get_data
                }).then(
                    function successCallback(response) {
                        vm.loadover = true
                        if (response.data.stat){
                            vm.data_Table = new ngTableParams({count:10}, {counts:[],data:response.data.data.reverse()});
                        }else {
                            swal('获取列表失败', response.data.info, 'error');
                        }
                    },
                    function errorCallback(response) {
                        swal('获取列表失败', response.status, 'error');
                    }
                );
        };
        vm.reload();
    }

})();

(function() {
    'use strict';

    HistoryJobxController.$inject = ["$state", "$http", "$uibModal", "$scope", "ngTableParams", "$filter", "genericService", "$injector"];
    angular
        .module('openc3')
        .controller('HistoryJobxController', HistoryJobxController)
        .filter('showversion', function () {
            return function (text) {
                var w = '';
                var re=/\bversion:.*/;
                if (re.test(text)){
                    var reStr = re.exec(text)[0];
                    w = reStr.split(":")[1]
                }
             
                return w

            }
        });

    function HistoryJobxController($state, $http, $uibModal, $scope, ngTableParams, $filter, genericService, $injector) {
        var vm = this;
        var nowTime = $filter('date')(new Date, "yyyy-MM-dd");

        vm.seftime = genericService.seftime
        vm.statuszh = { "": "等待执行", "success": "执行成功", "fail": "执行失败", "decision": "执行失败", "running": "执行中", "ignore": "忽略", "waiting": "等待中" }

        var toastr = toastr || $injector.get('toastr');
        $scope.searchData = {
            'name':null,
            'user':null,
            'status':null,
            'time_start': nowTime,
            'time_end':null,
            'taskuuid':null
        };
        vm.treeid = $state.params.treeid;

        vm.getMe = function () {
            $http.get('/api/connector/connectorx/sso/userinfo').success(function(data){
                $scope.searchData.user = data.email;
            });
        };

        $('#createstart').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            $scope.searchData.time_start = result;
            $scope.$apply();
        });

        $('#createend').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            $scope.searchData.time_end= result;
            $scope.$apply();
        });

        vm.Reset = function () {
            angular.forEach($scope.searchData, function (value, key) {
                $scope.searchData[key] = null;
            });
            vm.reload();
        };

        vm.ciinfo = {}
        vm.reload = function () {
            vm.loadover = false
            var get_data = {};
            angular.forEach($scope.searchData, function (value, key) {
                if (value){
                    get_data[key] = value;
                }
            });
            $http({
                method:'GET',
                url:'/api/jobx/task/' + vm.treeid,
                params:get_data
            }).then(
                function successCallback(response) {
                    vm.loadover = true
                    if (response.data.stat){
                        vm.task_Table = new ngTableParams({count:10}, {counts:[],data:response.data.data.reverse()});
                    }else {
                        swal('获取列表失败', response.data.info, 'error');
                    }
                },
                function errorCallback(response) {
                    swal('获取列表失败', response.status, 'error');
                }
            );

            $http.get('/api/ci/group/' + vm.treeid).success(function(data){
                if(data.stat)
                {
                    angular.forEach(data.data, function (value, key) {
                        vm.ciinfo['_ci_'+value.id+'_'] = value.name
                    });
                }
                else
                {
                    toastr.error( "加载流水线名称失败:" + data.info )
                }
            });
        };

        vm.showRollback = function (info){
            var uuid = info.uuid;
            uuid = uuid.slice(uuid.length - 1);
            if (64 < uuid.charCodeAt(0) && uuid.charCodeAt(0) < 91) {
                return '是'
            } else {
                return ''
            }
        };

        vm.taskDetail = function(uuid){
            $state.go('home.history.jobxdetail', {treeid:vm.treeid, taskuuid:uuid, accesspage:true});

        };

        vm.reload();
    }

})();

(function() {
    'use strict';

    HistoryJobController.$inject = ["$filter", "$timeout", "$state", "$http", "$scope", "ngTableParams", "genericService"];
    angular
        .module('openc3')
        .controller('HistoryJobController', HistoryJobController);
    function HistoryJobController($filter, $timeout, $state, $http, $scope, ngTableParams, genericService) {

        var vm = this;

        vm.seftime = genericService.seftime

        vm.statuszh = { "": "等待执行", "success": "执行成功", "fail": "执行失败", "refuse": "审批拒绝", "decision": "执行失败", "running": "执行中", "ignore": "忽略", "waiting": "等待中" }

        var nowTime = $filter('date')(new Date, "yyyy-MM-dd");
        vm.starttime = nowTime;
        vm.treeid = $state.params.treeid;
        $scope.searchStatus = "";

        $('#starttime').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.starttime = result;
            $scope.$apply();
        });

        $('#finishtime').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.finishtime= result;
            $scope.$apply();
        });

        vm.taskDetail = function(taskuuid){
            $state.go('home.history.jobdetail', {treeid:vm.treeid,taskuuid:taskuuid});
        };
        vm.quickTaskDetail = function(jobuuid, taskuuid,type){
            $state.go('home.history.jobdetail', {treeid:vm.treeid,taskuuid:taskuuid,jobuuid:jobuuid, jobtype:type});
        };
        vm.redo = function(uuid) {
            swal({
                title: "重做任务",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                cancelButtonText: "取消",
                confirmButtonText: "确定",
                closeOnConfirm: true
            }, function(){
                $http.post('/api/job/task/' + vm.treeid + "/redo", {"taskuuid":uuid} ).success(function(data){
                    if (data.stat){
                       swal({ title: '成功', type:'success' });
                       var reRun = $timeout(function () { vm.reload(); }, 2000);
                    }else {
                        swal({ title: '失败', text: data.info, type:'error' });
                    }
                });
            });
        };

        vm.getMe = function () {
            $http.get('/api/connector/connectorx/sso/userinfo').success(function(data){
                vm.startuser = data.email;
            });
        };

        vm.Reset = function () {
            vm.taskname = "";
            vm.startuser = "";
            vm.starttime = nowTime;
            vm.finishtime = "";
            vm.searchStatus = "";
            vm.taskuuid = "";
            vm.reload()
        };

        vm.ciinfo = {}
        vm.reload = function () {
            var get_data = {};
            if (vm.taskname){
                get_data.name=vm.taskname
            }
            if(vm.startuser){
                get_data.user=vm.startuser
            }
            if(vm.starttime){
                get_data.time_start=vm.starttime
            }
            if(vm.finishtime){
                get_data.time_end=vm.finishtime
            }
            if(vm.searchStatus){
                get_data.status=vm.searchStatus
            }
            if(vm.taskuuid){
                get_data.taskuuid=vm.taskuuid
            }
            vm.loadover = false;
            if (Object.keys(get_data).length != 0){
                $http({
                    method:'GET',
                    url:'/api/job/task/' + vm.treeid,
                    params:get_data
                }).then(
                    function successCallback(response) {
                        vm.loadover = true;
                        if (response.data.stat){
                            vm.data_Table = new ngTableParams({count:10}, {counts:[],data:response.data.data.reverse()});
                        }else {
                            swal('获取列表失败', response.data.info, 'error');
                        }
                    },
                    function errorCallback(response) {
                        swal('获取列表失败', response.status, 'error');
                    }
                );}

            $http.get('/api/ci/group/' + vm.treeid).success(function(data){
                if(data.stat)
                {
                    angular.forEach(data.data, function (value, key) {
                        vm.ciinfo['_ci_'+value.id+'_'] = value.name
                    });
                }
                else
                {
                    toastr.error( "加载流水线名称失败:" + data.info )
                }
            });
        };

        vm.reload();
    }
})();

(function() {
    'use strict';

    VersionLogController.$inject = ["$state", "$http", "$scope", "ngTableParams"];
    angular
        .module('openc3')
        .controller('VersionLogController', VersionLogController);

    /** @ngInject */
    function VersionLogController( $state, $http, $scope, ngTableParams ) {

        var vm = this;
        vm.versionname = 'null'
        vm.reload = function () {
            vm.loadover = false;
            $http.get('/api/connector/version/log').success(function(data){
                if (data.stat){
                    vm.versionlogTable = new ngTableParams({count:100}, {counts:[],data:data.data});
                    vm.loadover = true;
                }else {
                    swal({ title:'获取数据失败', text: data.info, type:'error' });
                }
            });
            $http.get('/api/connector/version/name').success(function(data){
                if (data.stat){
                    vm.versionname = data.data
                }else {
                    swal({ title:'获取数据失败', text: data.info, type:'error' });
                }
            });
        };
        vm.reload();
    }

})();

(function() {
    'use strict';

    UseraddrController.$inject = ["$state", "$http", "$scope", "$uibModal", "ngTableParams"];
    angular
        .module('openc3')
        .controller('UseraddrController', UseraddrController);

    /** @ngInject */
    function UseraddrController( $state, $http, $scope, $uibModal, ngTableParams ) {

        var vm = this;
        vm.treeid = $state.params.treeid;

        vm.reload = function () {
            vm.loadover = false
            $http.get('/api/connector/useraddr').then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.dataTable = new ngTableParams({count:100}, {counts:[],data:response.data.data});
                        vm.loadover = true
                    }else {
                        swal('获取信息失败', response.data.info, 'error' );
                    }
                },
                function errorCallback (response ){
                    swal('获取信息失败', response.status, 'error' );
                });
        };

        vm.reload()

        vm.createUseraddr = function () {
            $uibModal.open({
                templateUrl: 'app/pages/global/useraddr/create.html',
                controller: 'UseraddrCreateController',
                controllerAs: 'useraddrcreate',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () { return vm.treeid},
                    reload : function () { return vm.reload}
                }
            });
        };

       vm.deleteUseraddr = function(id) {
          swal({
            title: "删除用户地址簿",
            text: "删除",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){
            $http.delete('/api/connector/useraddr/' + id ).success(function(data){
                if(data.stat == true) {
                    swal({ title: "删除成功!", type:'success' });
                    vm.reload();
                } else {
                    swal({ title: "删除失败!", text: data.info, type:'error' });
                }
            });
          });
        }

    }

})();

(function () {
    'use strict';
    UseraddrCreateController.$inject = ["$state", "$http", "ngTableParams", "$uibModalInstance", "$scope", "resoureceService", "$injector", "treeid", "reload"];
    angular
        .module('openc3')
        .controller('UseraddrCreateController', UseraddrCreateController);

    function UseraddrCreateController( $state, $http, ngTableParams, $uibModalInstance, $scope, resoureceService, $injector, treeid, reload ) {

        var vm = this;

        var toastr = toastr || $injector.get('toastr');

        vm.postdata = {};

        vm.cancel = function(){ $uibModalInstance.dismiss()};

        vm.add = function(){
            $http.post('/api/connector/useraddr', vm.postdata ).success(function(data){
                    if(data.stat == true) {
                        vm.cancel();
                        reload();
                    } else { swal({ title: "添加失败!", text: data.info, type:'error' }); }

            });
        };

    }
})();


(function() {
    'use strict';

    TicketController.$inject = ["$state", "$http", "$uibModal", "$scope", "ngTableParams"];
    angular
        .module('openc3')
        .controller('TicketController', TicketController);

    function TicketController($state, $http, $uibModal, $scope, ngTableParams) {

        var vm = this;
        vm.createTicket = function () {
            $uibModal.open({
                templateUrl: 'app/pages/global/ticket/createTicket.html',
                controller: 'CreateTicketController',
                controllerAs: 'createticket',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    ticketid: function () {},
                    homereload: function () { return vm.reload },
                    type: function () { return 'create' },
                    title: function () { return '新建凭据' },
                    point: function () { return '' },
                }
            });

        };

        vm.deleteTicket = function(id){
          swal({
            title: "删除凭据",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){

            $http.delete( '/api/ci/ticket/' + id ).success(function(data){
                if (data.stat){
                    vm.reload();
                }else {
                    swal({ title:'删除凭据列表失败', text: data.info, type:'error' });
                }
            });

          });
        };

        vm.showTicket = function(id){
            $uibModal.open({
                templateUrl: 'app/pages/global/ticket/createTicket.html',
                controller: 'CreateTicketController',
                controllerAs: 'createticket',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    ticketid: function () { return id},
                    homereload: function () { return vm.reload },
                    type: function () { return 'show' },
                    title: function () { return '查看凭据' },
                    point: function () { return '' },
                }
            });
        };

        vm.editTicket = function(id){
            $uibModal.open({
                templateUrl: 'app/pages/global/ticket/createTicket.html',
                controller: 'CreateTicketController',
                controllerAs: 'createticket',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    ticketid: function () { return id},
                    homereload: function () { return vm.reload },
                    type: function () { return 'edit' },
                    title: function () { return '编辑凭据' },
                    point: function () { return '' },
                }
            });
        };

        vm.reload = function () {
            vm.loadover = false;
            $http.get('/api/ci/ticket').success(function(data){
                if (data.stat){
                    vm.group_Table = new ngTableParams({count:25}, {counts:[],data:data.data.reverse()});
                    vm.loadover = true;
                }else {
                    swal({ title:'获取凭据列表失败', text: data.info, type:'error' });
                }
            });
        };
        vm.reload();

    }

})();

(function() {
    'use strict';

    CreateTicketController.$inject = ["$uibModalInstance", "$state", "$http", "$scope", "homereload", "ticketid", "title", "type", "point"];
    angular
        .module('openc3')
        .controller('CreateTicketController', CreateTicketController);

    function CreateTicketController($uibModalInstance, $state, $http, $scope, homereload, ticketid, title, type, point ) {

        var vm = this;
        vm.title = title
        vm.type = type
        vm.cancel = function(){ $uibModalInstance.dismiss()};
        vm.postData = { type: 'SSHKey', share: 'P' };
        vm.kubectlVersion = [];
        vm.point = point;

        if( point !== '' )
        {
            vm.postData.type = point;
        }

        if( ticketid )
        {
            var detail = '';
            if( type == 'edit' )
            {
                detail = '?detail=1'
            }
            $http.get('/api/ci/ticket/' + ticketid + detail ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.postData = response.data.data
                    }else {
                        swal({ title:'获取凭据详情失败', text: response.data.info, type:'error' });
                    }
                },
                function errorCallback (response){
                    swal({ title:'获取凭据详情失败', text: response.status, type:'error' });
                });
        }

        vm.saveTicket = function(){
            var uri = '/api/ci/ticket';
            if( ticketid )
            {
                uri = '/api/ci/ticket/' + ticketid;
            }
            $http.post(uri, vm.postData ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        homereload();
                        vm.cancel();
                    }else {
                        swal({ title:'保存凭据失败', text: response.data.info, type:'error' });
                    }
                }
            );
        };

        vm.connectiontest = function(){
            var d = {
                kubectlVersion: vm.postData.ticket.kubectlVersion,
                kubeconfig: vm.postData.ticket.KubeConfig,
            };
            vm.loading = true
            $http.post('/api/ci/v2/kubernetes/cluster/connectiontest', d, { timeout: 120000 } ).then(
                function successCallback(response) {
                    vm.loading = false
                    if (response.data.stat){
                        swal({ title:'连接成功', text: response.data.info, type:'success' });
                    }else {
                        swal({ title:'连接失败', text: response.data.info, type:'error' });
                    }
                },

                function errorCallback (response){
                    vm.loading = false
                }
            );
        };
    }
})();

(function() {
    'use strict';

    TemplateController.$inject = ["$state", "$http", "$scope"];
    angular
        .module('openc3')
        .controller('TemplateController', TemplateController);

    function TemplateController( $state, $http, $scope ) {

        var vm = this;

        vm.environment = {};
        vm.reload = function () {
            vm.loadover = false
            $http.get('/api/job/environment').then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.loadover = true
                        vm.environment = response.data.data;
                    }else {
                        swal('获取信息失败', response.data.info, 'error' );
                    }
                },
                function errorCallback (response ){
                    swal('获取信息失败', response.status, 'error' );
                });
        };

        vm.checkAllEmail = function () {
            if ($scope.emailall){
                $(":checkbox").each(function () {
                    if($(this).attr("check-class") == "email"){
                        $(this).prop("checked", true);
                    }
                });
            }else {
                $(":checkbox").each(function () {
                    if($(this).attr("check-class") == "email"){
                        $(this).prop("checked", false);
                    }
                });
            }

        };
        vm.checkAllSms = function () {
            if ($scope.smsall){
                $(":checkbox").each(function () {
                    if($(this).attr("check-class") == "sms"){
                        $(this).prop("checked", true);
                    }
                });
            }else {
                $(":checkbox").each(function () {
                    if($(this).attr("check-class") == "sms"){
                        $(this).prop("checked", false);
                    }
                });
            }


        };

        vm.emailSet = function () {
            vm.environment.notifyTemplateEmailTitle = "作业:${name} 状态:${status}";
            vm.environment.notifyTemplateEmailContent = "服务树:${projectname}\n作业名称:${name}\n任务编号:${uuid}\n任务状态:${status}\n\n详情：" + window.location.protocol + '//' + window.location.host + "/#/history/jobdetail/${projectid}/${uuid}";
        };

        vm.emailSave = function () {
            var emailDetail = {};
            emailDetail['notifyTemplateEmailTitle'] = vm.environment.notifyTemplateEmailTitle;
            emailDetail['notifyTemplateEmailContent'] = vm.environment.notifyTemplateEmailContent;
            vm.save( emailDetail )
        };
        vm.smsSet = function () {
            vm.environment.notifyTemplateSmsContent = "服务树:${projectname}\n作业名称:${name}\n任务编号:${uuid}\n任务状态:${status}\n\n详情：" + window.location.protocol + '//' + window.location.host + "/#/history/jobdetail/${projectid}/${uuid}";
        };
        vm.smsSave = function () {
            var msmDetail = {};
            msmDetail['notifyTemplateSmsContent'] = vm.environment.notifyTemplateSmsContent;
            vm.save( msmDetail )
        };

        vm.emailCiSet = function () {
            vm.environment.ciTemplateEmailTitle = "Open-C3构建消息 项目: ${projectname} 版本:${version}";
            vm.environment.ciTemplateEmailContent = "状态: ${status}\n服务树:${treename}\n项目名称: ${projectname}\n代码仓库地址: ${addr}\n版本: ${version}\n触发测试环境发布: ${calltestenv}\n触发线上环境发布: ${callonlineenv}\n错误信息: ${errormsg}\n构建日志:\n${buildlog}\n\n详情:" + window.location.protocol + '//' + window.location.host + "/#/quickentry/flowlinedetail/${treeid}/${projectid}";
        };
 
        vm.emailCiSave = function () {
            var emailDetail = {};
            emailDetail['ciTemplateEmailTitle'] = vm.environment.ciTemplateEmailTitle;
            emailDetail['ciTemplateEmailContent'] = vm.environment.ciTemplateEmailContent;
            vm.save( emailDetail )
        };

        vm.smsCiSet = function () {
            vm.environment.ciTemplateSmsContent = "Open-C3构建消息\n服务树:${treename}\n项目:${projectname}\n版本:${version}\n状态:${status}\n\n详情:" + window.location.protocol + '//' + window.location.host + "/#/quickentry/flowlinedetail/${treeid}/${projectid}";
        };
 
        vm.smsCiSave = function () {
            var msmDetail = {};
            msmDetail['ciTemplateSmsContent'] = vm.environment.ciTemplateSmsContent;
            vm.save( msmDetail )
        };
 
        vm.emailApprovalSet = function () {
            vm.environment.approvalTemplateEmailTitle = "发布审批: ${cont}";
            vm.environment.approvalTemplateEmailContent = "审批内容: ${cont}\n\n详情:" + window.location.protocol + '//' + window.location.host + "/#/quickapproval/${uuid}";
        };

        vm.emailApprovalSave = function () {
            var emailDetail = {};
            emailDetail['approvalTemplateEmailTitle'] = vm.environment.approvalTemplateEmailTitle;
            emailDetail['approvalTemplateEmailContent'] = vm.environment.approvalTemplateEmailContent;
            vm.save( emailDetail )
        };
        vm.smsApprovalSet = function () {
            vm.environment.approvalTemplateSmsContent = "审批内容: ${cont}\n\n详情:" + window.location.protocol + '//' + window.location.host + "/#/quickapproval/${uuid}";
        };
        vm.smsApprovalSave = function () {
            var msmDetail = {};
            msmDetail['approvalTemplateSmsContent'] = vm.environment.approvalTemplateSmsContent;
            vm.save( msmDetail )
        };
        vm.save = function (data) {
            $http.post('/api/job/environment',data).success(function(data){
                if (data.stat){
                    swal({ title: '保存成功', type:'success' });
                    vm.reload();
                }else {
                    swal({ title: '保存失败', text: data.info, type:'error' });
                }
            });
        };


        vm.reload()
    }

})();

(function() {
    'use strict';

    PrivateController.$inject = ["$state", "$http", "$scope", "$uibModal", "ngTableParams"];
    angular
        .module('openc3')
        .controller('PrivateController', PrivateController);

    /** @ngInject */
    function PrivateController( $state, $http, $scope, $uibModal, ngTableParams ) {

        var vm = this;
        vm.treeid = $state.params.treeid;

        vm.reload = function () {
            vm.loadover = false
            $http.get('/api/connector/private').then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.dataTable = new ngTableParams({count:100}, {counts:[],data:response.data.data});
                        vm.loadover = true
                    }else {
                        swal('获取信息失败', response.data.info, 'error' );
                    }
                },
                function errorCallback (response ){
                    swal('获取信息失败', response.status, 'error' );
                });
        };

        vm.reload()

        vm.createPrivate = function () {
            $uibModal.open({
                templateUrl: 'app/pages/global/private/create.html',
                controller: 'PrivateCreateController',
                controllerAs: 'privatecreate',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () { return vm.treeid},
                    reload : function () { return vm.reload}
                }
            });
        };

    }

})();

(function () {
    'use strict';
    PrivateCreateController.$inject = ["$state", "$http", "ngTableParams", "$uibModalInstance", "$scope", "resoureceService", "$injector", "treeid", "reload"];
    angular
        .module('openc3')
        .controller('PrivateCreateController', PrivateCreateController);

    function PrivateCreateController( $state, $http, ngTableParams, $uibModalInstance, $scope, resoureceService, $injector, treeid, reload ) {

        var vm = this;

        var toastr = toastr || $injector.get('toastr');

        vm.postdata = {};

        vm.cancel = function(){ $uibModalInstance.dismiss()};

        vm.add = function(){
            $http.post('/api/connector/private', vm.postdata ).success(function(data){
                    if(data.stat == true) {
                        vm.cancel();
                        reload();
                    } else { swal({ title: "添加失败!", text: data.info, type:'error' }); }

            });
        };

    }
})();


(function() {
    'use strict';

    NotifyController.$inject = ["$state", "$http", "$scope"];
    angular
        .module('openc3')
        .controller('NotifyController', NotifyController);

    /** @ngInject */
    function NotifyController( $state, $http, $scope ) {

        var vm = this;

        vm.reload = function () {
            vm.loadover = false
            $http.get('/api/job/environment').then(
                function successCallback(response) {
                    if (response.data.stat){
                        var data_dict = response.data.data;
                         vm.loadover = true

                        angular.forEach(data_dict, function (v, k) {
                            if (v == "true"){
                                v =true
                            }else {
                                v = false;
                            }
                            $scope[k] = Boolean(v);
                        });
                    }else {
                        swal('获取信息失败', response.data.info, 'error' );
                    }
                },
                function errorCallback (response ){
                    swal('获取信息失败', response.status, 'error' );
                });
        };

        vm.checkAllEmail = function () {
            if ($scope.emailall){
                $(":checkbox").each(function () {
                    if($(this).attr("check-class") == "email"){
                        $(this).prop("checked", true);
                    }
                });
            }else {
                $(":checkbox").each(function () {
                    if($(this).attr("check-class") == "email"){
                        $(this).prop("checked", false);
                    }
                });
            }
        };

        vm.checkAllSms = function () {
            if ($scope.smsall){
                $(":checkbox").each(function () {
                    if($(this).attr("check-class") == "sms"){
                        $(this).prop("checked", true);
                    }
                });
            }else {
                $(":checkbox").each(function () {
                    if($(this).attr("check-class") == "sms"){
                        $(this).prop("checked", false);
                    }
                });
            }
        };

        vm.save = function () {
            var checked = {};
            $(":checkbox").each(function () {
                if ($(this).prop("checked")){
                    checked[$(this).attr("name")] = "true";
                }else {
                    checked[$(this).attr("name")] = "false";
                }

            });
            $http.post('/api/job/environment',checked).success(function(data){
                if (data.stat){
                    swal({ title: '保存成功', type:'success' });
                    vm.reload();
                }else {
                    swal({ title: '保存失败', text: data.info, type:'error' });
                }
            });

        };
        vm.reload()
    }

})();

(function() {
    'use strict';

    MonitorController.$inject = ["$state", "$http", "$scope", "ngTableParams"];
    angular
        .module('openc3')
        .controller('MonitorController', MonitorController);

    /** @ngInject */
    function MonitorController( $state, $http, $scope, ngTableParams ) {

        var vm = this;
        vm.reload = function () {
            vm.loadover = false;
            $http.get('/api/jobx/monitor/metrics?json=1').success(function(data){
                if (data.stat){
                    vm.monitorTable = new ngTableParams({count:100}, {counts:[],data:data.data});
                    vm.loadover = true;
                }else {
                    swal({ title:'获取监控数据失败', text: data.info, type:'error' });
                }
            });
        };
        vm.reload();
    }

})();

(function() {
    'use strict';

    ImagesController.$inject = ["$state", "$http", "$uibModal", "$scope", "ngTableParams"];
    angular
        .module('openc3')
        .controller('ImagesController', ImagesController);

    function ImagesController($state, $http, $uibModal, $scope, ngTableParams) {

        var vm = this;
        vm.createImages = function () {
            $uibModal.open({
                templateUrl: 'app/pages/global/images/createImages.html',
                controller: 'CreateImagesController',
                controllerAs: 'createimages',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    imagesid: function () {},
                    homereload: function () { return vm.reload },
                    title: function () { return '新建镜像' },
                }
            });

        };

        vm.deleteImages = function(id){
          swal({
            title: "删除镜像",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){

            $http.delete( '/api/ci/images/' + id ).success(function(data){
                if (data.stat){
                    vm.reload();
                }else {
                    swal({ title:'删除镜像列表失败', text: data.info, type:'error' });
                }
            });

          });
        };

        vm.editImages = function(id){
            $uibModal.open({
                templateUrl: 'app/pages/global/images/createImages.html',
                controller: 'CreateImagesController',
                controllerAs: 'createimages',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    imagesid: function () { return id},
                    homereload: function () { return vm.reload },
                    title: function () { return '编辑镜像' },
                }
            });
        };

        vm.reload = function () {
            vm.loadover = false;
            $http.get('/api/ci/images').success(function(data){
                if (data.stat){
                    vm.group_Table = new ngTableParams({count:25}, {counts:[],data:data.data.reverse()});
                    vm.loadover = true;
                }else {
                    swal({ title:'获取镜像列表失败', text: data.info, type:'error' });
                }
            });
        };
        vm.reload();

    }

})();

(function() {
    'use strict';

    CreateImagesController.$inject = ["$uibModalInstance", "$state", "$http", "$scope", "homereload", "imagesid", "title", "$injector"];
    angular
        .module('openc3')
        .controller('CreateImagesController', CreateImagesController);

    function CreateImagesController($uibModalInstance, $state, $http, $scope, homereload, imagesid, title, $injector ) {

        var vm = this;
        vm.title = title
        vm.cancel = function(){ $uibModalInstance.dismiss()};
        vm.postData = { share: 'false' };
        vm.uploadstatus = 0;
        vm.imagesid = imagesid

        var toastr = toastr || $injector.get('toastr');

        vm.siteaddr = window.location.protocol + '//' + window.location.host;

        vm.bytesToSize = function(bytes) {
            if (bytes === 0) return '0 B';
            var k = 1000, // or 1024
                sizes = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'],
                i = Math.floor(Math.log(bytes) / Math.log(k));

           return (bytes / Math.pow(k, i)).toPrecision(3) + ' ' + sizes[i];
        }


        vm.loadimagesinfo = function( imagesid )
        {
            $http.get('/api/ci/images/' + imagesid + '/upload' ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.uploadstatus = response.data.data
                    }else {
                        swal({ title:'检测镜像失败', text: response.data.info, type:'error' });
                    }
                },
                function errorCallback (response){
                    swal({ title:'检查镜像失败', text: response.status, type:'error' });
                });

        }
        if( imagesid )
        {
            $http.get('/api/ci/images/' + imagesid ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.postData = response.data.data
                    }else {
                        swal({ title:'获取镜像详情失败', text: response.data.info, type:'error' });
                    }
                },
                function errorCallback (response){
                    swal({ title:'获取镜像详情失败', text: response.status, type:'error' });
                });

                vm.loadimagesinfo( imagesid )
        }

        vm.saveImages = function(){
            var uri = '/api/ci/images';
            if( imagesid )
            {
                uri = '/api/ci/images/' + imagesid;
            }
            $http.post(uri, vm.postData ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        homereload();
                        vm.cancel();
                    }else {
                        swal({ title:'保存镜像失败', text: response.data.info, type:'error' });
                    }
                }
            );
        };

        $scope.upForm = function () {
            $("#upload_progressBar_Module").css("display","block");
            var file = document.getElementById("choicefilesx").files[0];
            var name = document.getElementById("choicefilesx").files[0].name;
            $(".newFile").parents("div.col-sm-10").find("input[name='newFileMsg']").attr("data-name",name);
            var url = '/api/ci/images/' + imagesid + '/upload';

            var piece = 1024 * 1024 * 24;
            var len = Math.ceil(file.size/piece);
            var start = 0;
            var end = start + piece;
            var start_time = new Date().getTime();

            var seq = 0;
            function upload(){
                if (seq<len){
                    var chunk = file.slice(start, end);
                    var form = new FormData();
                    var xhr = new XMLHttpRequest();

                    form.append("filesize", file.size);
                    form.append("file", chunk);
                    form.append("len", len);
                    form.append("seq", seq);
                    xhr.open("post", url, true);
                    xhr.upload.onprogress=function(e){
                        var loaded = e.loaded+seq*piece;
                        if (e.lengthComputable){
                            $("#upload_progressBar").css("width",Math.round(loaded / file.size * 100) + "%");
                            $("#upload_progressBar").html(Math.round(loaded / file.size * 100) + "%");
                            $("#percentage").html("已上传"+ Math.round(loaded / file.size * 100) + "%");
                        }
                        //速度
                        var now = new Date().getTime();
                        var time = (now-start_time)/1000; //单位为s
                        var speed = loaded/time;
                        var bspeed = speed;
                        var units = 'b/s';
                        if(speed/1024>1){
                            speed = speed/1024;
                            units = 'k/s';
                        }
                        if(speed/1024>1){
                            speed = speed/1024;
                            units = 'M/s';
                        }
                        speed = speed.toFixed(1);
                        //剩余时间
                        var resttime = ((file.size-loaded)/bspeed).toFixed(1);
                        $("#time").html('，速度：' + speed + units + '，剩余时间：' + Math.abs(resttime) + 's');
                    };
                    xhr.onload=function(){
                        if (xhr.status == 200) {
                            var res = JSON.parse(xhr.responseText);
                            if (res.stat){
                                if (res.data.done){
                                    vm.loadimagesinfo( imagesid );
                                    seq = len;
                                    return;
                                }
                                //执行下一次请求
                                start = end;
                                end = start + piece;
                                seq++;
                                upload();
                            }else{
                                toastr.error("上传失败:" + xhr.responseText);
                                seq = len;
                                return;
                            }
                        }else{
                            toastr.error("上传失败:" + xhr.responseText);
                            seq = len;
                            return;
                        }
                    };
                    xhr.send(form);
                }
            }
            upload();
        };

        vm.clickImport = function () {
            document.getElementById("choicefilesx").click();
        };
    }
})();

(function() {
    'use strict';

    AuditLogController.$inject = ["$state", "$http", "$scope", "ngTableParams"];
    angular
        .module('openc3')
        .controller('AuditLogController', AuditLogController);

    /** @ngInject */
    function AuditLogController( $state, $http, $scope, ngTableParams ) {

        var vm = this;

        vm.Reset = function () {
            vm.time = "";
            vm.user = "";
            vm.title = "";
            vm.content = "";
            vm.reload()
        };

 
        vm.reload = function () {
            var get_data = {};
            if( vm.time )
            {
                get_data.time = vm.time
            }
            if( vm.user )
            {
                get_data.user = vm.user
            }

            if( vm.title )
            {
                get_data.title = vm.title
            }

            if( vm.content )
            {
                get_data.content = vm.content
            }

            vm.loadover = false;
            $http({
                method:'GET',
                url: '/api/connector/connectorx/auditlog',
                params:get_data
            }).then(
                function successCallback(response) {
                    vm.loadover = true;
                    if (response.data.stat){
                        vm.auditlogTable = new ngTableParams({count:100}, {counts:[],data:response.data.data});
                    }else {
                        swal('获取列表失败', response.data.info, 'error');
                    }
                },
                function errorCallback(response) {
                    swal('获取列表失败', response.status, 'error');
                }
            );
        };
        vm.reload();
    }

})();

(function() {
    'use strict';

    ConnectorUserinfoController.$inject = ["$http", "ngTableParams"];
    angular
        .module('openc3')
        .controller('ConnectorUserinfoController', ConnectorUserinfoController);

    function ConnectorUserinfoController($http, ngTableParams) {
        var vm = this;
        vm.addUser = function (usr, title ) {
            $http.post('/api/connector/default/user/adduser', {'user': usr} ).success(function(data){
                if (data.stat){
                    swal({ title: title + '成功', type:'success' });
                    vm.reload();
                }else {
                    swal({ title: title + '用户失败', text: data.info, type:'error' });
                }
            });
        };

        vm.delete = function(name){
            swal({
                title: "删除用户",
                text: "删除后用户不能再登录",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                cancelButtonText: "取消",
                confirmButtonText: "确定",
                closeOnConfirm: true
            }, function(){
                $http.delete('/api/connector/default/user/deluser?user=' + name ).success(function(data){
                    if (data.stat){
                        vm.reload();
                    }else {
                        swal({ title:'删除用户失败', text: data.info, type:'error' });
                    }
                });
            });
        };

        vm.reload = function () {
            vm.loadover = false;
            $http.get('/api/connector/default/user/userlist').success(function(data){
                if (data.stat){
                    vm.userTable = new ngTableParams({count:10}, {counts:[],data:data.data.reverse()});
                    vm.loadover = true;
                }else {
                    swal({ title:'获取用户列表失败', text: data.info, type:'error' });
                }
            });
        };
        vm.reload();
    }
})();

(function() {
    'use strict';
    ConnectorUserauthController.$inject = ["$http", "$scope", "ngTableParams"];
    angular
        .module('openc3')
        .controller('ConnectorUserauthController', ConnectorUserauthController);

    function ConnectorUserauthController($http, $scope, ngTableParams) {

       var vm = this;
       vm.role = 1;

       vm.addAuth = function () {
            $http.post( '/api/connector/default/auth/addauth', {'user': $scope.username, level: vm.role} ).success(function(data){
                if (data.stat){
                    swal({ title: '添加权限成功', type:'success' });
                    $scope.username = ''
                    vm.reload();
                }else {
                    swal({ title: '添加权限失败', text: data.info, type:'error' });
                }
            });
        };

        vm.delete = function(name){
            swal({
                title: "删除用户权限",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                cancelButtonText: "取消",
                confirmButtonText: "确定",
                closeOnConfirm: true
            }, function(){
                $http.delete('/api/connector/default/auth/delauth?user=' + name ).success(function(data){
                    if (data.stat){
                        vm.reload();
                    }else {
                        swal({ title:'删除用户权限失败', text: data.info, type:'error' });
                    }
 
                });
              });
        };

        vm.reload = function () {
            vm.loadover = false;
            $http.get('/api/connector/default/auth/userauth').success(function(data){
                if (data.stat){
                    vm.userTable = new ngTableParams({count:10}, {counts:[],data:data.data.reverse()});
                    vm.loadover = true;
                }else {
                    swal({ title:'获取用户权限列表失败', text: data.info, type:'error' });
                }
            });
        };
        vm.reload();
    }
})();

(function(){
    'use strict';

        ConnectorTreeController.$inject = ["$rootScope", "$scope", "$injector", "$window", "$http", "$state"];
    angular
        .module('openc3')
        .controller('ConnectorTreeController', ConnectorTreeController);

        function ConnectorTreeController($rootScope, $scope,$injector, $window, $http, $state) {

            var vm = this;
            vm.zTree = '';
            var toastr = toastr || $injector.get('toastr');
            vm.hideMenu = true;  //是否显示右键菜单

            // tree height auto
            angular.element('.scroller').css('height', $window.innerHeight-95);
            angular.element($window).bind('resize', function(){
                angular.element('.scroller').css('height', $window.innerHeight-95);
            });
            var setting = {
                view: {
                    dblClickExpand: false,
                    showTitle:false
                }
            };

            vm.sync = $http.get('/api/connector/connectorx/usertree').success(function(nodes) {
                var treedata = [ { id: 0, name: 'ROOT', children: nodes.data } ]
                $.fn.zTree.init(angular.element('#openc3treeclone'), setting, treedata);
                vm.zTree = $.fn.zTree.getZTreeObj('openc3treeclone');
                vm.zTree.expandAll(true);
                return vm.zTree;
            });


            angular.element('body').bind('mousedown',function(event){
                if (!(event.target.className == "tree-menu" || angular.element(event.target).parents(".tree-menu").length>0)) {
                    $scope.$apply(function(){
                        vm.hideMenu = true;
                    });
                }
            });

            vm.sync.then(function(){
                vm.zTree = $.fn.zTree.getZTreeObj('openc3treeclone');
                vm.focusCurrent();
                vm.zTree.setting.callback.onClick = vm.zTree.setting.callback.onRightClick = function(event, treeId, treeNode){
                    if (treeNode){
                        // 生成 xx.xx.xxx 服务树串
                        var currentN = treeNode;
                        var nodesStr = treeNode.name;
                        while(currentN.level != 0){
                            currentN = currentN.getParentNode();
                            nodesStr = currentN.name + '.' + nodesStr;
                        }
                        vm.menuTags = nodesStr;
                        vm.currentNode = treeNode;
                        vm.nodeId = treeNode.id;
                        $scope.$apply(function(){
                            // 显示菜单
                            vm.hideMenu = false;
                            // 判断是否可以 添加/删除
                            vm.canAddNode = false;
                            vm.canDelNode = false;
                            vm.canEditNode = false;
                            if (vm.currentNode.level < 5){
                                vm.canAddNode = true;
                            }
                            if (!vm.currentNode.isParent){
                                vm.canDelNode = true;
                            }
                            if (vm.nodeId < 4000000000 ){
                                vm.canEditNode = true;
                            }
 
                            //vm.canAddNode = true ? vm.currentNode.level < 2 : false;
                            //vm.canDelNode = true ? vm.currentNode.isParent == false : false;
                        });
                        // 菜单位置
                        var cx = event.clientX - 250
                        var cy = event.clientY - 50
                        angular.element('.tree-menu').css({"top":cy +'px', "left":cx+'px'});
                    }
                };
            });

            // focus current node
            vm.focusCurrent = function(){
                var cNode = vm.zTree.getNodeByParam('id', $state.params.treeid);
                vm.zTree.selectNode(cNode);
                vm.zTree.expandNode(cNode);
            };

            // expand/collapse tree
            vm.expandAll = function(flag){
                vm.zTree.expandAll(flag);
            };

            // tree reload
            vm.reload = function(){
                angular.element('.treeFresh').addClass('fa-spin');
                $http.get('/api/connector/connectorx/usertree').success(function(nodes) {
                    var treedata = [ { id: 0, name: 'ROOT', children: nodes.data } ]
                    $.fn.zTree.init(angular.element('#openc3treeclone'), vm.zTree.setting, treedata);
                    angular.element('.treeFresh').removeClass('fa-spin');
                    vm.expandAll(true)
                });
            };

            // add node
            vm.addNode = function(){
                // 判断节点级别
                if (vm.currentNode.level == 5){
                    return false;
                }
                swal({
                    title: "输入节点名称",
                    text: '在 ' + vm.menuTags + ' 下添加',
                    type: "input",
                    showCancelButton: true,
                    closeOnConfirm: false,
                    animation: "slide-from-top",
                    inputPlaceholder: "new node name",
                    showLoaderOnConfirm: true
                }, function(inputValue){
                    if (inputValue === false) return false;
                    if (inputValue === "") {
                        swal.showInputError("Null!");
                        return false;
                    }
                    var newTag = vm.menuTags+'.'+inputValue;
                        var suburi = '';
                        if(vm.nodeId > 0)
                        {
                            suburi = '/' + vm.nodeId
                        }
                        $http.post('/api/connector/default/tree'+ suburi, {'name': inputValue} ).success(function(data){
                            if (data.stat){
                                swal('添加成功', '', 'success');
                                var newNode = {id:data.data, name:inputValue};
                                vm.zTree.addNodes(vm.currentNode, newNode, -1);
                            }else {
                                swal('添加失败', data.info, 'error');
                            }
                        });

                });
            };

            // del node
            vm.delNode = function(){
                swal({
                    title: "确认删除?",
                    text: '删除节点 ' + vm.menuTags,
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: 'Delete',
                    closeOnConfirm: false,
                    showLoaderOnConfirm: true
                }, function(){

                    $http.get('/api/connector/release?id='+ vm.nodeId ).success(function(data){
                        if (data == 'true'){
                            $http.delete('/api/connector/default/tree/' + vm.nodeId ).then(function(data){
                                if (data.data.stat){
                                    swal("删除成功!", vm.menuTags, "success");
                                    vm.zTree.removeNode(vm.currentNode);
                                }else{
                                    swal("删除失败!", data.data.msg, "error");
                                }
                            },function(){
                                swal("删除失败!", vm.menuTags, "error");
                            });
                        }else {
                            swal('不允许删除', '该节点上存在资源或者配置', 'error');
                        }
                    });


                });
            };

            // rename node # TODO
            vm.renameNode = function(){
                // 判断节点级别
                if (vm.currentNode.level == 0){
                    swal("失败", "该节点不可重命名!", "error");
                    return;
                }
                var tagArr = vm.menuTags.split('.');
                swal({
                    title: "输入新名称",
                    text: tagArr[tagArr.length-1],
                    type: "input",
                    showCancelButton: true,
                    closeOnConfirm: false,
                    animation: "slide-from-top",
                    inputPlaceholder: "new node name",
                    showLoaderOnConfirm: true
                }, function(inputValue){
                    if (inputValue === false) return false;
                    if (inputValue === "") {
                        swal.showInputError("Null!");
                        return false;
                    }
                    tagArr.pop();
                    tagArr.push(inputValue);
                    var newTag = tagArr.join('.');
                    $http.post('/api/pms/api/v1/node/'+vm.currentNode.id+'/rename?name='+newTag).then(function(data){
                        if (data.data.code == 200){
                            swal("修改成功!", newTag, "success");
                            vm.currentNode.name = inputValue;
                            vm.zTree.updateNode(vm.currentNode);
                        }else{
                            swal("修改失败!", data.data.msg, "error");
                        }
                    },function(){
                        swal("修改失败!", newTag, "error");
                    });
                });
            };
        }
})();

(function() {
    'use strict';

    ConnectorNodeController.$inject = ["$state", "$http", "$scope", "ngTableParams"];
    angular
        .module('openc3')
        .controller('ConnectorNodeController', ConnectorNodeController);

    function ConnectorNodeController($state, $http, $scope, ngTableParams) {
        var vm = this;
        vm.treeid = $state.params.treeid;

        vm.addNode = function () {
            $http.post('/api/connector/default/node/'+ vm.treeid, {'name': $scope.nodename}).success(function(data){
                if (data.stat){
                    swal({ title: '添加成功', type:'success' });
                    vm.reload();
                }else {
                    swal({ title: '添加失败', text: data.info, type:'error' });
                }
            });
        };
 
        vm.delete = function(id){
            swal({
                title: "删除资源",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                cancelButtonText: "取消",
                confirmButtonText: "确定",
                closeOnConfirm: true
            }, function(){
                $http.delete('/api/connector/default/node/' + vm.treeid + '/' + id  ).success(function(data){
                    if (data.stat){
                        vm.reload();
                    }else {
                        swal({ title:'删除用户失败', text: data.info, type:'error' });
                    }
                });
            });
        };

        vm.reload = function () {
            vm.loadover = false;
            $http.get('/api/connector/default/node/' + vm.treeid).success(function(data){
                if (data.stat){
                    vm.nodeTable = new ngTableParams({count:10}, {counts:[],data:data.data.reverse()});
                    vm.loadover = true;
                }else {
                    swal({ title:'获取用户列表失败', text: data.info, type:'error' });
                }
            });
        };
        vm.reload();

    }
})();

(function() {
    'use strict';

    ConnectorMesgController.$inject = ["$state", "$http", "$scope", "ngTableParams"];
    angular
        .module('openc3')
        .controller('ConnectorMesgController', ConnectorMesgController);

    function ConnectorMesgController($state, $http, $scope, ngTableParams) {
        var vm = this;
        vm.treeid = $state.params.treeid;

        vm.reload = function () {
            vm.loadover = false;
            $http.get('/api/connector/default/mesg').success(function(data){
                if (data.stat){
                    vm.mesgTable = new ngTableParams({count:25}, {counts:[],data:data.data});
                    vm.loadover = true;
                }else {
                    swal({ title:'获取用户列表失败', text: data.info, type:'error' });
                }
            });
        };
        vm.reload();

    }
})();

(function() {
    'use strict';

    ConnectorMailController.$inject = ["$state", "$http", "$scope", "ngTableParams"];
    angular
        .module('openc3')
        .controller('ConnectorMailController', ConnectorMailController);

    function ConnectorMailController($state, $http, $scope, ngTableParams) {
        var vm = this;

        vm.reload = function () {
            vm.loadover = false;
            $http.get('/api/connector/default/mail').success(function(data){
                if (data.stat){
                    vm.mailTable = new ngTableParams({count:10}, {counts:[],data:data.data});
                    vm.loadover = true;
                }else {
                    swal({ title:'获取用户列表失败', text: data.info, type:'error' });
                }
            });
        };
        vm.reload();

    }
})();

(function() {
    'use strict';

    ConnectorConfigController.$inject = ["$http"];
    angular
        .module('openc3')
        .controller('ConnectorConfigController', ConnectorConfigController);

    /** @ngInject */
    function ConnectorConfigController($http) {

        var vm = this;

        vm.config = {};
        vm.configlist = [];
        vm.name = 'current'

        vm.reload = function(){
            vm.loadover = false;
            $http.get('/api/connector/config?name=' + vm.name ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.config = data.data
                    $http.get('/api/connector/config/list' ).success(function(data){
                        if(data.stat == true) 
                        { 
                            vm.configlist = data.data
                            vm.loadover = true;
                        } else { 
                            swal({ title: "加载连接器列表失败!", text: data.info, type:'error' });
                        }
                    });
                } else { 
                    swal({ title: "加载连接器配置失败!", text: data.info, type:'error' });
                }
            });
        };

        vm.save = function () {

          swal({
            title: "保存连接器配置",
            text: "保存后服务会自动重启",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){
            $http.post('/api/connector/config', { config: vm.config } ).success(function(data){
                if(data.stat == true) 
                { 
                    swal({ title: "保存成功!", text: '系统正在重启，20秒后刷新页面', type:'success' });
                    
                } else { 
                    swal({ title: "保存失败!", text: data.info, type:'error' });
                }
            });
          });
        };
        vm.reload()

    }
})();


(function() {
    'use strict';

    ConnectorChpasswdController.$inject = ["$http", "$scope"];
    angular
        .module('openc3')
        .controller('ConnectorChpasswdController', ConnectorChpasswdController);

    /** @ngInject */
    function ConnectorChpasswdController($http, $scope) {

        var vm = this;

        vm.chpasswd = {};
        vm.new2err = 0;
        vm.change = function()
        {
            if( vm.chpasswd.new1 && vm.chpasswd.new2 && vm.chpasswd.new1 != vm.chpasswd.new2 )
            {
                vm.new2err = 1;
            }
            else
            {
                vm.new2err = 0;
            }
        }
        vm.changepasswd = function () {
                $http.post('/api/connector/default/user/chpasswd', vm.chpasswd).then(
                    function successCallback(response) {
                        if (response.data.stat){
                            document.getElementById("createok").style.display = 'block';
                            $scope.okmsg = "修改密码成功!";
                            setTimeout(function () {
                                document.getElementById("createok").style.display = 'none';
                            }, 2000);
                        }else {
                            document.getElementById("createerr").style.display = 'block';
                            $scope.errmsg = "修改密码失败!" + response.data.info;
                            setTimeout(function () {
                                document.getElementById("createerr").style.display = 'none';
                            }, 2000);
                        }
                    }
                );
        };
    }

})();

(function() {
    'use strict';

    variateQueryController.$inject = ["$timeout", "$filter", "$state", "$http", "$uibModal", "$scope", "treeService", "ngTableParams", "resoureceService"];
    angular
        .module('openc3')
        .controller('variateQueryController', variateQueryController);

    /** @ngInject */
    function variateQueryController($timeout,$filter, $state, $http, $uibModal, $scope, treeService, ngTableParams, resoureceService) {

        var vm = this;
        $scope.dataready = true;
        $scope.heads = [];
        vm.treeid = $state.params.treeid;
        vm.getVariateData = function () {
            $http.get('/api/job/vv/' + vm.treeid + '/table').then(
                function successCallback(response) {
                    console.log(JSON.stringify(response.data.data[0]));
                    if (response.data.stat) {
                        if (response.data.data) {
                            $scope.heads = response.data.data.shift();
                        };
                        vm.data_Table = new ngTableParams({count:10}, {count:[], data:response.data.data});
                    } else {
                        $scope.dataready = false;
                        $scope.dataerror = "获取变量信息失败：" + response.data.info;
                    }
                },
                function errorCallback (response){
                    $scope.dataready = false;
                    $scope.dataerror =  "获取变量信息失败： " + response.status
                });
        };
        treeService.sync.then(function(){      // when the tree was success.

            vm.nodeStr = treeService.selectname();  // get tree name
            vm.getVariateData();
        });
        vm.delete = function (info) {
            resoureceService.variate.delVV([vm.treeid,info[0]],null, null).finally(function(){
                vm.getVariateData();
            });
        }
        vm.getMe = function () {
            $http.get('/api/connector/connectorx/sso/userinfo').success(function(data){
                vm.startuser = data.email;
            });
        };

    }

})();

(function() {
    'use strict';

    UsersController.$inject = ["$timeout", "$state", "$http", "$uibModal", "$scope", "treeService", "ngTableParams", "resoureceService"];
    angular
        .module('openc3')
        .controller('UserController', UsersController);

    function UsersController($timeout, $state, $http, $uibModal, $scope, treeService, ngTableParams, resoureceService) {

        var vm = this;

        vm.treeid = $state.params.treeid;

        vm.getMe = function () {
            $http.get('/api/connector/connectorx/sso/userinfo').success(function(data){
                vm.createuser = data.email;
            });
        };

        $('#createstart').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.createStart = result;
            $scope.$apply();
        });

        vm.Reset = function () {
            vm.username = "";
            vm.createuser = "";
            vm.createStart = "";
            vm.createEnd = "";
            vm.reload();
        };

        $('#createend').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.createEnd= result;
            $scope.$apply();
        });

        vm.reload = function () {
            vm.loadover = false
            var get_data = {};
            if (vm.username){
                get_data.name=vm.username
            }
            if(vm.createuser){
                get_data.create_user=vm.createuser
            }
            if(vm.createStart){
                get_data.create_time_start=vm.createStart
            }
            if(vm.createEnd){
                get_data.create_time_end=vm.createEnd
            }

            $http({
                method:'GET',
                url:'/api/job/userlist/' + vm.treeid,
                params:get_data
            }).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.loadover = true
                        vm.user_Table = new ngTableParams({count:10}, {counts:[],data:response.data.data.reverse()});
                    }else {
                        swal({ title:'获取用户列表失败', text: response.data.info, type:'error' });
                    }
                },
                function errorCallback(response) {
                    swal({ title:'获取用户列表失败', text: response.status, type:'error' });
                }
            );


        };

        vm.createUser = function () {
            $http.post('/api/job/userlist/'+ vm.treeid, {'username': $scope.newUser}).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.reload();
                        $scope.newUser = '';
                    }else {
                        swal({ title:'创建用户失败', text: response.data.info, type:'error' });
                    }
                },
                function errorCallback (response ){
                    swal({ title:'创建用户失败', text: response.status, type:'error' });
                }
            );
        };

        vm.delete = function(id){
            swal({
                title: "删除用户",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                cancelButtonText: "取消",
                confirmButtonText: "确定",
                closeOnConfirm: true
            }, function(){
                $http.delete('/api/job/userlist/' + vm.treeid + '/' + id ).success(function(data){
                    if (data.stat){
                        vm.reload();
                    }else {
                        swal({ title:'删除用户失败', text: data.info, type:'error' });
                    }
                });
            });
        };

        vm.reload();
    }

})();

(function() {
    'use strict';

    ScriptsController.$inject = ["$timeout", "$state", "$http", "$uibModal", "$scope", "treeService", "ngTableParams", "resoureceService", "scriptId", "$injector"];
    angular
        .module('openc3')
        .controller('ScriptsController', ScriptsController);

    function ScriptsController($timeout, $state, $http, $uibModal, $scope, treeService, ngTableParams, resoureceService, scriptId, $injector) {

        var vm = this;
        var toastr = toastr || $injector.get('toastr');
        vm.treeid = $state.params.treeid;
        $('#createstart').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.createStart = result;
            $scope.$apply();
        });

        $('#createend').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.createEnd= result;
            $scope.$apply();
        });

        $('#editstart').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.editStart = result;
            $scope.$apply();
        });

        $('#editend').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.editEnd= result;
            $scope.$apply();
        });

        vm.delete = function(id, jobnames){
            if(jobnames){
                var msg = {"warning":"已被"+ jobnames +"作业调用"};
            }else {
                var msg = null;
            }

            resoureceService.script.delete([vm.treeid,id],null, msg).finally(function(){
                vm.reload(vm.treeid);

            });
        };

        vm.editScript = function(id){
            $http.get('/api/job/scripts/' + vm.treeid+"/"+ id).success(function(data){
                if (data.stat){
                    vm.scriptHtml(data.data, "true")
                }
            });
        };

        vm.runScript = function(id){
            scriptId.setter(id);
            $state.go('home.quickentry.cmd', {treeid:vm.treeid});

        };

        vm.createScript = function(){
            vm.scriptHtml(null, "false")

        };

        vm.scriptHtml = function(data, edit){
            $uibModal.open({
                templateUrl: 'app/components/scripts/createScript.html',
                controller: 'CreateScript',
                controllerAs: 'createS',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    reloadindex: function () { return vm.reload },
                    msg : function () {return data},
                    edit : function () {return edit},
                }
            });
        };

        vm.getMe = function () {
            $http.get('/api/connector/connectorx/sso/userinfo').success(function(data){
                vm.createuser = data.email;
            });
        };

        vm.Reset = function () {
            vm.createuser = "";
            vm.edituser = "";
            vm.scriptname = "";
            vm.createStart = "";
            vm.createEnd = null;
            vm.editStart = "";
            vm.editEnd = null;
            vm.reload()
        };

        vm.reload = function () {
            vm.loadover = false
            var get_data = {};
            if (vm.scriptname){
                get_data.name=vm.scriptname
            }
            if(vm.createuser){
                get_data.create_user=vm.createuser
            }
            if(vm.edituser){
                get_data.edit_user=vm.edituser
            }
            if(vm.createStart){
                get_data.create_time_start=vm.createStart
            }
            if(vm.createEnd){
                get_data.create_time_end=vm.createEnd
            }
            if(vm.editStart){
                get_data.edit_time_start=vm.editStart
            }
            if(vm.editEnd){
                get_data.edit_time_end=vm.editEnd
            }
            $http({
                method:'GET',
                url:'/api/job/scripts/' + vm.treeid,
                params:get_data
            }).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.loadover = true
                        vm.data_Table = new ngTableParams({count:10}, {counts:[],data:response.data.data.reverse()});
                    }else {
                        toastr.error( "获取脚本信息失败："+response.data.info )
                    }
                },
                function errorCallback(response) {
                    toastr.error( "获取脚本信息失败："+response.status )
                }
            );
        };

        vm.reload();
    }

})();

(function() {
    'use strict';

    AlarmNotifyController.$inject = ["$state", "$http", "$uibModal", "$scope", "treeService", "ngTableParams", "resoureceService", "$injector"];
    angular
        .module('openc3')
        .controller('AlarmNotifyController', AlarmNotifyController);

    function AlarmNotifyController($state, $http, $uibModal, $scope, treeService, ngTableParams, resoureceService, $injector) {

        var vm = this;

        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.getMe = function () {
            $http.get('/api/connector/connectorx/sso/userinfo').success(function(data){
                vm.username = data.email;
            });
        };

        vm.Reset = function () {
            vm.username = "";
            vm.reload();
        };

        vm.reload = function () {
            vm.loadover = false
            var get_data = {};
            if (vm.username){
                get_data.name=vm.username
            }

            $http({
                method:'GET',
                url:'/api/job/notify/' + vm.treeid,
                params:get_data
            }).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.loadover = true
                        vm.notify_Table = new ngTableParams({count:10}, {counts:[],data:response.data.data.reverse()});
                    }else {
                        $scope.searchShow = false;
                        toastr.error( "获取列表失败：" + response.data.info );
                    }
                },
                function errorCallback(response) {
                    toastr.error( "获取列表失败：" + response.status );
                }
            );
        };

        vm.createUser = function () {
            vm.newuser = $scope.newUser;
            if (vm.newuser.length > 0){
                $http.post('/api/job/notify/'+ vm.treeid, {'user': vm.newuser}).then(
                    function successCallback(response) {
                        if (response.data.stat){
                            vm.reload();
                            $scope.newUser = '';
                        }else {
                            toastr.error( "添加失败：" + response.data.info );
                        }
                    },
                    function errorCallback (response ){
                        toastr.error( "添加失败：" + response.status );
                    }
                );
            }
        };

        vm.delete = function(id){
            resoureceService.notify.deluser([vm.treeid,id],null, null).finally(function(){
                vm.reload();
            });
        };

        vm.reload();
    }

})();

(function() {
    'use strict';

    NodeGroupController.$inject = ["$timeout", "$state", "$http", "$uibModal", "$scope", "treeService", "ngTableParams", "resoureceService", "$injector"];
    angular
        .module('openc3')
        .controller('NodeGroupController', NodeGroupController);

    function NodeGroupController($timeout, $state, $http, $uibModal, $scope, treeService, ngTableParams, resoureceService, $injector) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.getMe = function () {
            $http.get('/api/connector/connectorx/sso/userinfo').success(function(data){
                vm.createuser = data.email;
            });
        };

        vm.getMe2 = function () {
            $http.get('/api/connector/connectorx/sso/userinfo').success(function(data){
                vm.edituser = data.email;
            });
        };
        $('#createstart').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.createStart = result;
            $scope.$apply();
        });

        $('#createend').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.createEnd= result;
            $scope.$apply();
        });

        $('#editstart').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.editStart = result;
            $scope.$apply();
        });

        $('#editend').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.editEnd= result;
            $scope.$apply();
        });

        vm.Reset = function () {
            vm.groupname = "";
            vm.pluginname = "";
            vm.jobname = "";
            vm.createuser = "";
            vm.edituser = "";
            vm.createStart = "";
            vm.createEnd = "";
            vm.editStart = "";
            vm.editEnd = "";
            vm.reload();
        };

        vm.reload = function () {
            vm.loadover = false
            var get_data = {};
            if (vm.groupname){
                get_data.name=vm.groupname
            }
            if (vm.pluginname){
                get_data.plugin=vm.pluginname
            }
            if (vm.jobname){
                get_data.jobname=vm.jobname
            }
            if(vm.createuser){
                get_data.create_user=vm.createuser
            }
            if(vm.edituser){
                get_data.edit_user=vm.edituser
            }
            if(vm.createStart){
                get_data.create_time_start=vm.createStart
            }
            if(vm.createEnd){
                get_data.create_time_end=vm.createEnd
            }
            if(vm.editStart){
                get_data.edit_time_start=vm.editStart
            }
            if(vm.editEnd){
                get_data.edit_time_end=vm.editEnd
            }

            $http({
                method:'GET',
                url:'/api/job/nodegroup/' + vm.treeid,
                params:get_data
            }).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.group_Table = new ngTableParams({count:10}, {counts:[],data:response.data.data.reverse()});
                        vm.loadover = true
                    }else {
                        toastr.error( "获取列表失败:" + response.data.info )
                    }
                },
                function errorCallback(response) {
                    toastr.error( "获取列表失败:" + response.status )
                }
            );

        };

        vm.createGroup = function () {
            $uibModal.open({
                templateUrl: 'app/pages/business/nodegroup/createGroup.html',
                controller: 'CreateGroupController',
                controllerAs: 'createGroup',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    homereload : function () { return vm.reload}
                }
            });

        };

        vm.delete = function(id){
            resoureceService.group.delete([vm.treeid,id],null, null).finally(function(){
                vm.reload();

            });
        };
        vm.edit = function(id){
            $uibModal.open({
                templateUrl: 'app/pages/business/nodegroup/editGroup.html',
                controller: 'EditGroup',
                controllerAs: 'edit',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    groupId: function () { return id},
                    homereload: function () { return vm.reload}
                }
            });
        };

        vm.reload();
    }

})();

(function () {
    'use strict';
    EditGroup.$inject = ["$uibModalInstance", "$uibModal", "$http", "$scope", "ngTableParams", "resoureceService", "treeId", "groupId", "homereload", "$injector"];
    angular
        .module('openc3')
        .controller('EditGroup', EditGroup);

    function EditGroup($uibModalInstance,$uibModal, $http, $scope, ngTableParams,resoureceService, treeId, groupId, homereload, $injector ) {

        var vm = this;
        $scope.selected = [];
        $scope.selectedData = [];
        $scope.allData = [];
        $scope.allType = [];
        $scope.selectType = [];
        $scope.unClick = "true";
        var toastr = toastr || $injector.get('toastr');
        vm.cancel = function(){ $uibModalInstance.dismiss()};
        vm.getMachine = function () {
            $http.get('/api/agent/nodeinfo/' + treeId).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.machine_Table = new ngTableParams({count:10}, {counts:[],data:response.data.data.reverse()});
                        vm.machineData = response.data;
                    }else {
                        toastr.error("获取项目下所有机器信息失败："+response.data.info)
                        
                    }
                },
                function errorCallback (response ){
                    toastr.error("获取项目下所有机器信息失败："+response.status)
                });
        };
        vm.getGroupData = function () {
            $http.get('/api/job/nodegroup/' + treeId+"/"+ groupId).then(
                function successCallback(response) {
                    if (response.data.stat){

                        vm.editGroupdata = response.data.data;
                        vm.showEditGroup(vm.editGroupdata)

                    }else {
                        toastr.error("获取指定分组信息失败："+response.data.info)
                    }
                },
                function errorCallback (response ){
                    toastr.error("获取指定分组信息失败："+response.status)
                });
        };
        vm.showEditGroup = function (editData) {
            $scope.groupName = editData.name;
            if (editData.plugin == "node"){
                $scope.oldselect = "machineName";
                $scope.selectedType = "machineName"
            }else if(editData.plugin == "type"){
                $scope.oldselect = "machineType";
                $scope.selectedType = "machineType"
            }
            $scope.editTable = editData.params.split(",");
        };


        vm.choiceInfo = function () {
            var choiceMachie = $uibModal.open({
                templateUrl: 'app/pages/business/nodegroup/choiceInfo/machineGroup.html',
                controller: 'GroupInfoController',
                controllerAs: 'groupInfo',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    selectedType: function () { return $scope.selectedType},
                    allmachineInfo : function () { return vm.machineData }
                }
            });

            choiceMachie.result.then(
                function (result) {

                    if (result.length != 0){
                        $scope.choiceShow = true;
                        $scope.editTable = result;
                        $scope.oldselect = $scope.selectedType;
                    }else {

                        $scope.selectedType = $scope.oldselect;
                    }

                },function (reason) {}
            );
        };

        vm.delChoice = function (id) {
            if (id >=0){
                $scope.editTable.splice(id, 1);
            }
        };


        vm.save = function(){
            var plugin = '';
            if (!$scope.selectedType){
                alert("分组类型必选！");
                return
            }
            if ($scope.selectedType == "machineName" && $scope.editTable.length != 0){
                plugin = 'node';
                var postdata = $scope.editTable.join(",");
            }else if ($scope.selectedType == "machineType" && $scope.editTable.length != 0){
                plugin = 'type';
                var postdata = $scope.editTable.join(",");
            }

            var d = {
                "name":$scope.groupName,
                "plugin":plugin,
                "params":postdata
            };

            resoureceService.group.change([treeId,groupId], d, null)
                .then(function () {

                    vm.cancel();
                    homereload();
                })
                .finally(function(){

                });
        };

        vm.cleanSelected = function () {
            $scope.selected = [];
            var from = $scope.formType;

            if (from == "ip"){
                $scope.allData = vm.machineData;
            }else if(from == "group"){
                $scope.allData = vm.groupData;
            }
        };

        vm.ok = function(){
            if (selectedType == "machineName"){
                $uibModalInstance.close(
                    $scope.selectedData
                )

            }else if (selectedType =="machineType" ){
                $uibModalInstance.close(
                    $scope.selectType
                )
            }

        };


        var updateSelected = function (action, id, data) {
            if (action == 'add' & $scope.selected.indexOf(id) == -1) {
                $scope.selected.push(id);
                $scope.selectedData.push(data.name);
            }
            if (action == 'remove' && $scope.selected.indexOf(id) != -1){
                $scope.selected.splice($scope.selected.indexOf(id), 1);
                $scope.selectedData.splice($scope.selectedData.indexOf(data.name), 1)
            }
        };
        var updateTypeSelected = function (action, data) {
            if (action == 'add' & $scope.selectType.indexOf(data) == -1) {
                $scope.selectType.push(data);
            }
            if (action == 'remove' && $scope.selected.indexOf(data) != -1){
                $scope.selectType.splice($scope.selectType.indexOf(data), 1);
            }
        };
        $scope.updateSelection = function ($event, id, data) {
            var checkbox = $event.target;
            var action = (checkbox.checked ? 'add' : 'remove');
            updateSelected(action, id, data);
        };
        $scope.updateTypeSelection = function ($event, data) {
            var checkbox = $event.target;
            var action = (checkbox.checked ? 'add' : 'remove');
            updateTypeSelected(action, data);
        };
        $scope.selectAll = function ($event) {
            var checkbox = $event.target;
            var action = (checkbox.checked ? 'add' : 'remove');
            for (var i = 0; i < $scope.allData.length; i++) {
                var entity = $scope.allData[i];
                updateSelected(action, entity.id, entity);
            }
        };
        // $scope.getSelectedClass = function (entity) {
        //     return $scope.isSelected(entity.id) ? 'selected' : '';
        // };
        $scope.isSelected = function (id) {
            return $scope.selected.indexOf(id) >= 0;
        };
        $scope.isTypeSelected = function (data) {
            return $scope.selectType.indexOf(data) >= 0;
        };
        $scope.isSelectedAll = function () {
            return $scope.selected.length === $scope.allData.length;
        };
        vm.getMachine();
        vm.getGroupData();

    }
})();


(function () {
    'use strict';
    CreateGroupController.$inject = ["$uibModal", "$uibModalInstance", "$http", "$scope", "resoureceService", "treeId", "homereload", "$injector"];
    angular
        .module('openc3')
        .controller('CreateGroupController', CreateGroupController);

    function CreateGroupController($uibModal, $uibModalInstance,$http, $scope, resoureceService, treeId, homereload, $injector) {

        var vm = this;
        $scope.choiceShow = false;
        $scope.choiceResult = [];
        $scope.oldselect = '';
        $scope.dataready = true;
        vm.cancel = function(){ $uibModalInstance.dismiss()};
        var toastr = toastr || $injector.get('toastr');

        vm.save = function(){
            var plugin = '';
            if (!$scope.selectedType){
                toastr.error( "分组类型必选！" )
                return
            }
            if ($scope.selectedType == "machineName" && $scope.choiceResult.length != 0){
                plugin = 'node';
                var postdata = $scope.choiceResult.join(",");
            }else if ($scope.selectedType == "machineType" && $scope.choiceResult.length != 0){
                plugin = 'type';
                var postdata = $scope.choiceResult.join(",");
            }

            var d = {
                "name":$scope.groupName,
                "plugin":plugin,
                "params":postdata
            };

            resoureceService.group.create(treeId, d, null)
                .then(function () {
                    vm.cancel();
                    homereload();
                })
                .finally(function(){

                });
        };

        vm.getProMachine = function () {
            $http.get('/api/agent/nodeinfo/' + treeId).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.machineData = response.data;
                    }else {
                        toastr.error( "获取项目机器信息失败" + response.data.info )
                    }
                },
                function errorCallback (response ){
                    toastr.error( "获取项目机器信息失败" + response.status )
                });
        };

        vm.delChoice = function (id) {
            if (id >=0){
                $scope.choiceResult.splice(id, 1);
            }
        };

        vm.groupInfo = function () {

            var choiceMachie = $uibModal.open({
                templateUrl: 'app/pages/business/nodegroup/choiceInfo/machineGroup.html',
                controller: 'GroupInfoController',
                controllerAs: 'groupInfo',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    selectedType: function () { return $scope.selectedType},
                    allmachineInfo : function () { return vm.machineData }
                }
            });

            choiceMachie.result.then(
                function (result) {
                    if (result.length != 0){
                        $scope.choiceShow = true;
                        $scope.choiceResult = result;
                        $scope.oldselect = $scope.selectedType;
                    }else {
                        // $scope.selectedType = '';
                        $scope.selectedType = $scope.oldselect;
                    }
                },function (reason) {}
            );
        };


        vm.getProMachine();
    }
})();


(function () {
    'use strict';
    ShowIplistController.$inject = ["$state", "$uibModal", "$uibModalInstance", "$http", "$scope", "resoureceService", "groupid", "$injector"];
    angular
        .module('openc3')
        .controller('ShowIplistController', ShowIplistController);

    function ShowIplistController($state, $uibModal, $uibModalInstance,$http, $scope, resoureceService, groupid, $injector) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        vm.cancel = function(){ $uibModalInstance.dismiss()};
        var toastr = toastr || $injector.get('toastr');

        $scope.showIPstr = [];
        if(groupid){
            $http.get('/api/jobx/group/' + vm.treeid+"/"+groupid+"/node").then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.groupData = response.data.data;
                        angular.forEach(vm.groupData, function (subip, i) {
                            var suball = [];
                            var onelen = subip.length;
                            if (onelen >0){
                                var ss = 0;
                                var group_num = 0;
                                var ipstr = [];
                                angular.forEach(subip, function (ip, n) {
                                    if (ss === 8){
                                        suball.push(ipstr.join());
                                        ss = 0;
                                        ipstr = []
                                    }
                                    ipstr.push(ip);
                                    if(onelen === n+1){
                                        suball.push(ipstr.join());
                                    }
                                    ss +=1;
                                    group_num += 1;
                                });
                                var infos = {"num": group_num, "infos": suball};
                                $scope.showIPstr.push(infos);
                            }
                        })
                    }else {
                        toastr.error( "获取项目机器信息失败:" + response.data.info )
                    }
                },
                function errorCallback (response ){
                    toastr.error( "获取项目机器信息失败:" + response.status )
                });
        }

    }
})();


(function() {
    'use strict';

    GroupIndexController.$inject = ["$timeout", "$state", "$http", "$uibModal", "$scope", "treeService", "ngTableParams", "resoureceService", "$injector"];
    angular
        .module('openc3')
        .controller('GroupIndexController', GroupIndexController);

    function GroupIndexController($timeout, $state, $http, $uibModal, $scope, treeService, ngTableParams, resoureceService, $injector) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');
        vm.showEditLog = function () {
            $uibModal.open({
                templateUrl: 'app/pages/business/nodebatch/log.html',
                controller: 'OperationLogController',
                controllerAs: 'operation',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    groupid: function () {},
                }
            });

        };

        vm.createJobGroup = function () {
            $uibModal.open({
                templateUrl: 'app/pages/business/nodebatch/create.html',
                controller: 'CreateJobGroupController',
                controllerAs: 'createjobgroup',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    groupid: function () {},
                    ciid: function () {},
                    grouptype: function () {},
                    reloadhome: function () { return vm.reload },
                }
            });

        };

        vm.deleteGroup = function(id){
            resoureceService.group.deletegroup([vm.treeid,id],null, null).finally(function(){
                vm.reload();
            });
        };

        vm.editGroup = function(id){

            $uibModal.open({
                templateUrl: 'app/pages/business/nodebatch/create.html',
                controller: 'CreateJobGroupController',
                controllerAs: 'createjobgroup',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    groupid: function () { return id},
                    ciid: function () { return 0},
                    grouptype: function () { return 0},
                    reloadhome: function () { return vm.reload },
                }
            });
        };

        vm.showIPlist = function (idx) {
            $uibModal.open({
                templateUrl: 'app/pages/business/nodebatch/shownode.html',
                controller: 'ShowIplistController',
                controllerAs: 'showip',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    groupid: function () { return idx},
                }
            });
        };

        vm.ciinfo = {}
        vm.reload = function () {
            vm.loadover = false
            $http.get('/api/jobx/group/' + vm.treeid).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.loadover = true
                        vm.group_Table = new ngTableParams({count:10}, {counts:[],data:response.data.data});
                    }else {
                        toastr.error( "获取分组信息失败："+response.data.info)
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取分组信息失败："+response.status)
                });

            $http.get('/api/ci/group/' + vm.treeid).success(function(data){
                if(data.stat)
                {
                    angular.forEach(data.data, function (value, key) {
                        vm.ciinfo['_ci_test_'+value.id+'_'] = value.name
                        vm.ciinfo['_ci_online_'+value.id+'_'] = value.name
                    });
                }
                else
                {
                    toastr.error( "加载流水线名称失败:" + data.info )
                }
            });
 
        };
        vm.reload();
    }

})();

(function() {
    'use strict';

    OperationLogController.$inject = ["$uibModalInstance", "$state", "$http", "ngTableParams", "$injector"];
    angular
        .module('openc3')
        .controller('OperationLogController', OperationLogController);

    function OperationLogController($uibModalInstance, $state, $http, ngTableParams, $injector) {

        var vm = this;

        vm.cancel = function(){ $uibModalInstance.dismiss(); };
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.reload = function () {
            $http({
                method:'GET',
                url:'/api/jobx/log/' + vm.treeid,
                // params:{"create_time":'2018-04-22'}
            }).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.log_Table = new ngTableParams({count:10}, {counts:[],data:response.data.data.reverse()});

                    }else {
                        toastr.error("获取jobx操作日志失败:" + response.data.info)
                    }
                },
                function errorCallback(response) {
                    toastr.error("获取jobx操作日志失败:" + response.status)
                }
            );
        };
        vm.reload()


    }

})();

(function () {
    'use strict';
    CreateJobGroupController.$inject = ["$state", "$uibModal", "$uibModalInstance", "$http", "$scope", "ngTableParams", "resoureceService", "groupid", "ciid", "grouptype", "reloadhome", "$injector"];
    angular
        .module('openc3')
        .controller('CreateJobGroupController', CreateJobGroupController);

    function CreateJobGroupController($state, $uibModal, $uibModalInstance,$http, $scope, ngTableParams, resoureceService, groupid, ciid, grouptype, reloadhome, $injector) {

        var vm = this;
        $scope.machineType = 'list';
        $scope.choiceServerNum = 1;
        vm.machineList = null;
        vm.machinePercent = null;
        var toastr = toastr || $injector.get('toastr');
        vm.postData = {
            'name':'',
            'note':'',
        };
        vm.ciid = ciid
        if( ciid )
        {
            vm.postData.name = '_ci_' + ciid + '_';
            if( grouptype )
            {
                vm.postData.name = '_ci_' + grouptype + '_' + ciid + '_';
            }
            
            vm.postData.note = 'ci';
        }

        vm.treeid = $state.params.treeid;
        vm.cancel = function(){ $uibModalInstance.dismiss(); reloadhome( grouptype )};

        vm.saveGroup = function(){
            vm.postData.group_type = $scope.machineType;
            if ($scope.machineType == 'list'){
                vm.postData['node'] = vm.machineList;
            }else if($scope.machineType == 'percent'){
                vm.postData['percent'] = vm.machinePercent;
            }
            // 编辑分组
            if(groupid){
                resoureceService.group.updategroup([vm.treeid, groupid],vm.postData, null).then(function () {
                    vm.cancel();
                }).finally(function(){

                });
            }
            // 创建分组
            else {
                resoureceService.group.creategroup(vm.treeid,vm.postData, null).then(function () {
                    vm.cancel();
                }).finally(function(){

                });
            }

        };

        vm.choiceServer = function () {
                var openChoice = $uibModal.open({
                templateUrl: 'app/components/machine/choiceMachine.html',
                controller: 'ChoiceController',
                controllerAs: 'choice',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},

                }
            });
            openChoice.result.then(
                function (result) {
                    if (result.length != 0){
                        $scope.choiceShow = true;
                        var machineInfoNew = "";
                        machineInfoNew = result.join(',');
                        if (vm.machineList) {
                            vm.machineList = vm.machineList + ";" + machineInfoNew;
                        } else {
                            vm.machineList = machineInfoNew;
                        };
                        $scope.choiceServerNum = vm.machineList.split(';').length + 1;
                    }
                },function (reason) {
                    console.log("error reason", reason)
                }
            );
        };
        vm.getMachine = function () {
            $http.get('/api/agent/nodeinfo/' + vm.treeid).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.macheinInfoTable = new ngTableParams({count:20}, {counts:[],data:response.data.data});
                    }else {
                        toastr.error( "获取机器信息失败" + response.data.info )
                    }
                },
                function errorCallback (response ){
                    toastr.error( "获取机器信息失败" + response.status )
                });
        };
        vm.getMachine();
        vm.saveGroup = function(){
            vm.postData.group_type = $scope.machineType;
            if ($scope.machineType == 'list'){
                vm.postData['node'] = vm.machineList;
            }else if($scope.machineType == 'percent'){
                vm.postData['percent'] = vm.machinePercent;
            }
            // 编辑分组
            if(groupid){
                resoureceService.group.updategroup([vm.treeid, groupid],vm.postData, null).then(function () {
                    vm.cancel();
                }).finally(function(){

                });
            }
            // 创建分组
            else {
                resoureceService.group.creategroup(vm.treeid,vm.postData, null).then(function () {
                    vm.cancel();
                }).finally(function(){

                });
            }

        };
        vm.deleteGroup = function(){
            if(groupid){
                resoureceService.group.deletegroup([vm.treeid,groupid],null, null).finally(function(){
                    vm.cancel();
                });
            }
            else
            {
                vm.cancel();
            }
        };

        if(groupid){
            $http.get('/api/jobx/group/' + vm.treeid+"/"+groupid).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.groupData = response.data.data;
                        vm.postData.name = vm.groupData.name;
                        vm.postData.note = vm.groupData.note;
                        $scope.machineType = vm.groupData.group_type;
                        if(vm.groupData.group_type == 'list'){
                            vm.machineList = vm.groupData.node
                        }else if(vm.groupData.group_type == 'percent'){
                            vm.machinePercent = vm.groupData.percent
                        }

                    }else {
                        toastr.error( "获取信息失败" + response.data.info )
                    }
                },
                function errorCallback (response ){
                    toastr.error( "获取信息失败" + response.status )
                });
        }

    }
})();


(function() {
    'use strict';

    MachineController.$inject = ["$state", "$http", "$uibModal", "$scope", "ngTableParams", "resoureceService", "$injector"];
    angular
        .module('openc3')
        .controller('MachineController', MachineController);

    function MachineController($state, $http, $uibModal, $scope, ngTableParams, resoureceService, $injector) {

        var vm = this;

        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.getMe = function () {
            $http.get('/api/connector/connectorx/sso/userinfo').success(function(data){
                vm.createuser = data.email;
            });
        };

        $('#createstart').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.createStart = result;
            $scope.$apply();
        });

        vm.Reset = function () {
            vm.name = "";
            vm.createuser = "";
            vm.createStart = "";
            vm.createEnd = "";
            vm.inip = "";
            vm.exip = "";
            vm.reload();
        };

        $('#createend').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.createEnd= result;
            $scope.$apply();
        });

        vm.reload = function () {
            vm.loadover = false
            var get_data = {};
            if (vm.name){
                get_data.name=vm.name
            }
            if(vm.createuser){
                get_data.create_user=vm.createuser
            }
            if(vm.createStart){
                get_data.create_time_start=vm.createStart
            }
            if(vm.createEnd){
                get_data.create_time_end=vm.createEnd
            }
            if(vm.inip){
                get_data.inip = vm.inip
            }
            if(vm.exip){
                get_data.exip = vm.exip
            }

            $http({
                method:'GET',
                url:'/api/job/nodelist/' + vm.treeid,
                params:get_data
            }).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.loadover = true
                        vm.user_Table = new ngTableParams({count:10}, {counts:[],data:response.data.data.reverse()});
                    }else {
                        toastr.error( "获取搜索信息失败:" + response.data.info )
                    }
                },
                function errorCallback(response) {
                    toastr.error( "获取搜索信息失败:" + response.status )
                }
            );

        };

        vm.createMachine = function () {
            $http.post('/api/job/nodelist/'+ vm.treeid, {'name': $scope.newMachine}).then(
                function successCallback(response) {
                    if (response.data.stat){
                        $scope.newMachine = '';
                        vm.reload();
                    }else {
                        toastr.error( "添加失败:" + response.data.info )
                    }
                },
                function errorCallback (response ){
                    toastr.error( "添加失败:" + response.status )
                }
            );
        };

        vm.delete = function(id){
            resoureceService.machine.delMachine([vm.treeid,id],null, null).finally(function(){
                vm.reload();
            });
        };

        vm.reload();
    }

})();

(function() {
    'use strict';

    BusinessJobController.$inject = ["$timeout", "$state", "$http", "$uibModal", "$scope", "treeService", "ngTableParams", "resoureceService", "scriptId", "$injector"];
    angular
        .module('openc3')
        .controller('BusinessJobController', BusinessJobController);

    function BusinessJobController($timeout, $state, $http, $uibModal, $scope, treeService, ngTableParams, resoureceService, scriptId, $injector) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        $('#createstart').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.createStart = result;
            $scope.$apply();
        });

        $('#createend').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.createEnd= result;
            $scope.$apply();
        });

        $('#editstart').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.editStart = result;
            $scope.$apply();
        });

        $('#editend').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.editEnd= result;
            $scope.$apply();
        });

        vm.addJob = function(){
            $state.go('home.business.jobcreate', { treeid: vm.treeid } );
        }

        vm.deleteJob = function(uuid){
            swal({
                title: "删除作业",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                cancelButtonText: "取消",
                confirmButtonText: "确定",
                closeOnConfirm: true
            }, function(){
                $http.delete( '/api/job/jobs/' + vm.treeid + "/" + uuid  ).success(function(data){
                    if (data.stat){
                        vm.reload();
                    }else {
                        swal({ title:'删除作业失败', text: data.info, type:'error' });
                    }
 
                });
              });
        };

        vm.copyJob = function (jobuuid) {
            $http.get('/api/job/jobs/'  + vm.treeid + "/" + jobuuid ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.jobDetail = response.data.data;
                        vm.copyJobDatas = vm.jobDetail.data;
                        vm.jobTypes = vm.jobDetail.uuids;

                        if (vm.copyJobDatas){
                            $state.go('home.business.jobedit', {
                                treeid:vm.treeid,
                                editjobuuid:vm.jobDetail.uuid,
                                editdata:vm.copyJobDatas,
                                jobtypes:vm.jobTypes,
                                copyjob:true,
                            });
                        }else {
                            swal({ title:'出错啦', text: "获取作业请求成功，但获取作业详细信息失败。请检查！", type:'error' });
                        }

                    }else {
                        swal({ title:'获取作业详细信息失败', text: response.data.info, type:'error' });
                    }
                },
                function errorCallback (response){
                    swal({ title:'获取作业详细信息失败', text: response.status, type:'error' });
                });

        };
        vm.editJob = function(jobuuid){
            $http.get('/api/job/jobs/' + vm.treeid+ "/"+ jobuuid ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.jobDetail = response.data.data;
                        vm.editjobuuid = vm.jobDetail.uuid;
                        vm.editJobDatas = vm.jobDetail.data;
                        vm.editJobName = vm.jobDetail.name;
                        vm.mon_ids = vm.jobDetail.mon_ids;
                        vm.mon_status = vm.jobDetail.mon_status;
                        vm.jobTypes = vm.jobDetail.uuids;
                        if (vm.editjobuuid){
                            $state.go('home.business.jobedit', {
                                treeid:vm.treeid,
                                editjobuuid:vm.editjobuuid,
                                editdata:vm.editJobDatas,
                                jobtypes:vm.jobTypes,
                                mon_ids:vm.mon_ids,
                                mon_status:vm.mon_status,
                                editjobname:vm.editJobName,
                            });
                        }else {
                            swal({ title:'出错啦', text: "获取作业请求成功，但获取作业详细信息失败。请检查！", type:'error' });
                        }

                    }else {
                        swal({ title:'获取作业详细信息失败', text: response.data.info, type:'error' });
                    }
                },
                function errorCallback (response){
                    swal({ title:'获取作业详细信息失败', text: response.status, type:'error' });
                });
        };

        vm.saveCron = function(jobdata){
            $uibModal.open({
                templateUrl: 'app/pages/business/crontab/create.html',
                controller: 'BusinessCrontabCreateController',
                controllerAs: 'businesscrontabcreate',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    reloadhome: function () {return null},
                    cronData : function () {return null},
                    edit : function () {return null},
                    jobData : function () {return jobdata},
                }
            });
        };

        vm.runJob = function(jobuuid){
            $http.get('/api/job/variable/' + vm.treeid +"/"+jobuuid + "?empty=1").then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.emptyVar = response.data.data;
                        if (vm.emptyVar.length >0){
                            var emptyVartab = $uibModal.open({
                                templateUrl: 'app/components/emptyvar/emptyVar.html',
                                controller: 'EmptyVarController',
                                controllerAs: 'emptyvars',
                                backdrop: 'static',
                                size: 'lg',
                                keyboard: false,
                                bindToController: true,
                                resolve: {
                                    emptyData : function () { return vm.emptyVar }
                                }
                            }); 
                            emptyVartab.result.then(
                                function (result) {
                                    var variableDict = {};
                                    angular.forEach(result, function (data, index) {
                                        variableDict[data.name] = data.value;
                                    });
                                    resoureceService.work.runJob(vm.treeid, {"jobuuid":jobuuid,"variable":variableDict})
                                        .then(function (repo) {
                                            if (repo.stat){
                                                $state.go('home.history.jobdetail', {treeid:vm.treeid,taskuuid:repo.uuid});
                                            }
                                            else
                                            {
                                                toastr.error("出错啦" + repo.info );
                                            }

                                        }, function (repo) {
                                            toastr.error("出错啦" + repo );
                                        });
                                },function (reason) {
                                }
                            );
                        }else {
                            resoureceService.work.runJob(vm.treeid, {"jobuuid":jobuuid})
                                .then(function (repo) {
                                    if (repo.stat){
                                        $state.go('home.history.jobdetail', {treeid:vm.treeid,taskuuid:repo.uuid});
                                    }
                                    else
                                    {
                                        toastr.error("出错啦" + repo.info );
                                    }

                                }, function (repo) {
                                    toastr.error("出错啦" + repo);
                                });
                        }
                    }else {
                        swal({ title:"检测变量失败", type:'error', text:response.data.info });
                    }
                },
                function errorCallback (response){
                    swal({ title:"检测变量失败", type:'error', text:response.status });
                });
        };

        vm.getMe = function (type) {
            $http.get('/api/connector/connectorx/sso/userinfo').success(function(data){
                if(type == 'create'){
                    vm.createuser = data.email;
                }else if(type == 'edit'){
                    vm.edituser = data.email;
                }
            });
        };

        vm.Reset = function () {
            $scope.searchShow = true;
            $scope.nosearch = true;
            vm.createuser = "";
            vm.edituser = "";
            vm.jobname = "";
            vm.createStart = "";
            vm.createEnd = "";
            vm.editStart = "";
            vm.editEnd = "";
            vm.reload()
        };

        vm.ciinfo = {}
        vm.reload = function () {
            vm.loadover = false
            var get_data = {};
            if (vm.jobname){
                get_data.name=vm.jobname
            }
            if(vm.createuser){
                get_data.create_user=vm.createuser
            }
            if(vm.edituser){
                get_data.edit_user=vm.edituser
            }
            if(vm.createStart){
                get_data.create_time_start=vm.createStart
            }
            if(vm.createEnd){
                get_data.create_time_end=vm.createEnd
            }
            if(vm.editStart){
                get_data.edit_time_start=vm.editStart
            }
            if(vm.editEnd){
                get_data.edit_time_end=vm.editEnd
            }
            $http({
                method:'GET',
                url:'/api/job/jobs/' + vm.treeid,
                params:get_data
            }).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.loadover = true
                        vm.dataTable = new ngTableParams({count:10}, {counts:[],data:response.data.data});
                    }else {
                        swal('获取列表失败', response.data.info, 'error');
                    }
                },
                function errorCallback(response) {
                    swal('获取列表失败', response.status, 'error');
                }
            );

            $http.get('/api/ci/group/' + vm.treeid).success(function(data){
                if(data.stat)
                {
                    angular.forEach(data.data, function (value, key) {
                        vm.ciinfo['_ci_'+value.id+'_'] = value.name
                    });
                }
                else
                {
                    toastr.error( "加载流水线名称失败:" + data.info )
                }
            });
 
        };

        vm.reload();

    }

})();

(function() {
    'use strict';

    BusinessJobEditController.$inject = ["$timeout", "$state", "$http", "$stateParams", "$uibModal", "$scope", "treeService", "resoureceService"];
    angular
        .module('openc3')
        .controller('BusinessJobEditController', BusinessJobEditController);

    function BusinessJobEditController($timeout, $state, $http,$stateParams, $uibModal, $scope, treeService,resoureceService) {
        var vm = this;
        $scope.saveHide = false;
        $scope.saveOK = true;
        $scope.editState = false;
        vm.allNewJob = [];
        vm.treeid = $state.params.treeid;
        vm.editJobData = $stateParams.editdata;
        vm.editjobuuid = $stateParams.editjobuuid;
        vm.editjobtypes = $stateParams.jobtypes;
        vm.editjobname = $stateParams.editjobname;
        vm.mon_ids = $stateParams.mon_ids;
        vm.mon_status = $stateParams.mon_status;
        vm.copyjob = $stateParams.copyjob;
        vm.cloneNodes = [];
        $scope.globalVar = true;
        $scope.monVar = true;
        vm.allVar = [];
        $scope.var = {
            "jobuuid":"",
            "name":"",
            "value":"",
            "describe":" "
        };
        if (!vm.editJobData){
            $state.go('home.business.job', {
                treeid:vm.treeid,
            });
        }
        treeService.sync.then(function(){           // when the tree was success.
            vm.nodeStr = treeService.selectname();  // get tree name
        });
        vm.hideGlobalVar = function () {
            $scope.globalVar = !$scope.globalVar;
        };
        vm.hideMonVar = function () {
            $scope.monVar = !$scope.monVar;
        };
        vm.delVar = function (idx, item) {
            vm.allVar.splice(idx,1)
        };
        vm.addVar = function () {
            vm.allVar.push(angular.copy($scope.var));
        };
        vm.getVar = function () {
            $http.get('/api/job/variable/' + vm.treeid + "/" +vm.editjobuuid).then(
                function successCallback (response) {
                    if (response.data.stat){
                        vm.allVar = response.data.data;

                    }else {
                        swal({
                            title:"获取变量失败",
                            type:'error',
                            text:response.data.message
                        });
                    }
                },
                function errorCallback (response) {
                    swal({
                        title:"获取变量失败",
                        type:'error',
                        text:response.message
                    });
                }
            );
        };
        if(vm.editjobuuid){
            vm.getVar();
        }
        vm.cloneToNode = function () {
            var openClone = $uibModal.open({
                templateUrl: 'app/pages/business/job/edit/cloneJob.html',
                controller: 'cloneJobController',
                controllerAs: 'clonejob',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,

            });

            openClone.result.then(
                function (result) {
                   if (JSON.stringify(result) != '{}'){
                       vm.hashCloneNodes = result;
                       angular.forEach(result, function (node, i) {
                           vm.cloneNodes.push(i)
                       })
                   }

                },function (reason) {
                    console.log("cloneToNode error reason", reason)
                }
            );

        };

        vm.saveMonVar = function () {
            var Var = {};
            Var.jobuuid = vm.editjobuuid;
            Var.status = vm.monStatus;
            Var.mon_ids = vm.monIds;
            $http.post('/api/job/variable/'+ vm.treeid+'/update_mon', Var).then(
                function successCallback(response) {
                    if (response.data.stat){
                    }else {
                        swal({
                            title:"保存监控节点数据失败",
                            type:'error',
                            text:response.data.message
                        });
                    }
                },
                function errorCallback (response ){
                }
            );

        };
        vm.saveVar = function () {
            var Var = {};
            Var.jobuuid = vm.editjobuuid;
            Var.data = vm.allVar;
            $http.post('/api/job/variable/'+ vm.treeid+'/update', Var).then(
                function successCallback(response) {
                    if (response.data.stat){
                    }else {
                        swal({
                            title:"保存变量失败",
                            type:'error',
                            text:response.data.message
                        });
                    }
                },
                function errorCallback (response ){
                }
            );

        };

        vm.count = function(pluginType){
            var count = 0;
            for(var i = 0; i < vm.allNewJob.length; i++) {
                if (vm.allNewJob[i].plugin_type == pluginType){
                    count = count + 1;
                }
            }
            return count;
        };

        vm.createScriptJob = function (idx) {
            var count = vm.count("cmd");
            var seq = count + 1;
            var openChoice = $uibModal.open({
                templateUrl: 'app/pages/business/job/plugin/cmd.html',
                controller: 'scriptJobController',
                controllerAs: 'scriptjob',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    editData : function () {return ""},
                    seq : function () {return seq}
                }
            });

            openChoice.result.then(
                function (result) {
                    if (idx >= 0){
                        vm.allNewJob.splice(idx, 0, result);
                    }else {
                        vm.allNewJob.push(result)
                    }

                },function (reason) {
                    console.log("createScriptJob error reason", reason)
                }
            );
        };

        vm.createScpJob = function (idx) {
            var count = vm.count("scp");
            var seq = count + 1;
            var openChoice = $uibModal.open({
                templateUrl: 'app/pages/business/job/plugin/scp.html',
                controller: 'scpJobController',
                controllerAs: 'scpjob',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    editData : function () {return ""},
                    seq : function () {return seq}
                }
            });

            openChoice.result.then(
                function (result) {
                    if (idx >= 0){
                        vm.allNewJob.splice(idx, 0, result);
                    }else {
                        vm.allNewJob.push(result)
                    }

                },function (reason) {
                    console.log("createScpJob error reason", reason)
                }
            );
        };


        vm.createApprovalJob = function (idx) {
            var count = vm.count("approval");
            var seq = count + 1;
            var openChoice = $uibModal.open({
                templateUrl: 'app/pages/business/job/plugin/approval.html',
                controller: 'approvalJobController',
                controllerAs: 'approvaljob',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    editData : function () {return ""},
                    seq : function () {return seq}
                }
            }); 

            openChoice.result.then(
                function (result) {
                    if (idx >= 0){
                        vm.allNewJob.splice(idx, 0, result);
                    }else {
                        vm.allNewJob.push(result)
                    }

                },function (reason) {
                    console.log("createScpJob error reason", reason)
                }
            );
        };

        vm.copyScp = function (id) {
            var d = vm.allNewJob[id]
            var tempdata = {
                'chmod': d.chmod,
                'chown': d.chown,
                'dp': d.dp,
                'dst': d.dst,
                'dst_type': d.dst_type,
                'scp_delete': d.scp_delete,
                'sp': d.sp,
                'src': d.src,
                'src_type':d.src_type,
                'plugin_type':'scp',
                'name': d.name + '_copy',
                'user': d.user,
                'timeout': d.timeout,
                'pause': d.pause,
                'deployenv' : d.deployenv,
                'action' : d.action,
                'batches' : d.batches
            }
            vm.allNewJob.splice(id + 1, 0, tempdata);
        };

        vm.editScp = function (id) {
            var editData = vm.allNewJob[id];
            var openEdit= $uibModal.open({
                templateUrl: 'app/pages/business/job/plugin/scp.html',
                controller: 'scpJobController',
                controllerAs: 'scpjob',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    editData : function () {return editData},
                    seq : function () {return 0}
                }
            }); 

            openEdit.result.then(
                function (result) {
                    vm.allNewJob.splice(id, 1, result);
                },function (reason) {
                    console.log("editScp error reason", reason)
                }
            );
        };

        vm.copyApproval = function (id) {
            var d = vm.allNewJob[id]
            var tempdata = {
                'plugin_type':'approval',
                'name': d.name + '_copy',
                'approver': d.approver,
                'cont': d.cont,
                'everyone': d.everyone,
                'timeout': d.timeout,
                'deployenv' : d.deployenv,
                'action' : d.action,
                'batches' : d.batches
            }
            vm.allNewJob.splice(id + 1, 0, tempdata);
        };

        vm.editApproval = function (id) {
            var editData = vm.allNewJob[id];
            var openEdit= $uibModal.open({
                templateUrl: 'app/pages/business/job/plugin/approval.html',
                controller: 'approvalJobController',
                controllerAs: 'approvaljob',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    editData : function () {return editData},
                    seq : function () {return 0}
                }
            }); 

            openEdit.result.then(
                function (result) {
                    vm.allNewJob.splice(id, 1, result);
                },function (reason) {
                    console.log("editApproval error reason", reason)
                }
            );
        };

        vm.copyScript = function (id) {
            var d = vm.allNewJob[id]
            var tempdata = {
                'plugin_type':'cmd',
                'name': d.name + '_copy',
                'user': d.user,
                'node_type':d.node_type,
                'node_cont':d.node_cont,
                'scripts_type':d.scripts_type,
                'scripts_cont': d.scripts_cont,
                'scripts_argv': d.scripts_argv,
                'timeout': d.timeout,
                'pause': d.pause,
                'deployenv' : d.deployenv,
                'action' : d.action,
                'batches' : d.batches
            }
            vm.allNewJob.splice(id + 1, 0, tempdata);
        };

        vm.editScript = function (id) {
            var editData = vm.allNewJob[id];
            var openChoice = $uibModal.open({
                templateUrl: 'app/pages/business/job/plugin/cmd.html',
                controller: 'scriptJobController',
                controllerAs: 'scriptjob',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () {return vm.treeid},
                    editData : function () {return editData},
                    seq : function () {return 0}
                }
            });

            openChoice.result.then(
                function (result) {
                    vm.allNewJob.splice(id, 1, result);
                },function (reason) {
                    console.log("editScript error reason", reason)
                }
            );
        };

        vm.deljobdata = function (id) {
            vm.allNewJob.splice(id, 1);
        };
        vm.saveCloneData = function () {
            if(vm.cloneNodes.length <1){
                swal({
                    title:"克隆目标节点不能为空",
                    type:'error'
                });
                return
            }
            if (vm.allNewJob.length >0){
                if (!$scope.newjobname){
                    swal({
                        title:"作业名称为空",
                        type:'error'
                    });
                }
                else {
                    var post_data = {
                        "name":$scope.newjobname,
                        "mon_ids":$scope.mon_ids,
                        "mon_status":$scope.mon_status,
                        "data":vm.allNewJob,
                        "permanent":"permanent",
                    };
                    swal({
                        title: "确定克隆作业?",
                        type: "warning", showCancelButton: true,
                        confirmButtonColor: "#DD6B55",
                        closeOnConfirm: true,
                        showLoaderOnConfirm: true

                    }, function () {
                        var openResult = $uibModal.open({
                            templateUrl: 'app/pages/business/job/edit/postClone.html',
                            controller: 'postCloneController',
                            controllerAs: 'postclone',
                            backdrop: 'static',
                            size: 'lg',
                            keyboard: false,
                            bindToController: true,
                            resolve: {
                                cloneNodes: function () { return vm.hashCloneNodes},
                                jobInfo: function () { return post_data},
                            }

                        });
                        openResult.result.then(
                            function (result) {
                                if (result){
                                    $scope.newjobname = "";
                                    $scope.saveHide = true;
                                    $scope.saveOK = false;
                                    $scope.jobuuid = result;
                                    vm.editjobuuid = result;
                                    vm.saveVar()
                                    $state.go('home.business.job',{treeid:vm.treeid})
                                }

                            },function (reason) {
                                console.log("saveCloneData error reason", reason)
                            }
                        );

                    });
                }
            }else {
                swal({
                    title:"数据不全",
                    type:'error',
                });
            }
        };
        vm.saveCreateData = function () {
            if (vm.allNewJob.length >0){
                if (!$scope.newjobname){
                    swal({
                        title:"作业名称为空",
                        type:'error'
                    });
                }
                else {
                    var post_data = {
                        "name":$scope.newjobname,
                        "mon_ids":$scope.mon_ids,
                        "mon_status":$scope.mon_status,
                        "data":vm.allNewJob,
                        "permanent":"permanent",
                    };
                    // {stat: true, uuid: "PAApw1VP7LhK", data: true}
                    if ($scope.editState){

                        resoureceService.job.updateJob([vm.treeid,vm.editjobuuid], post_data, null)
                            .then(function (repo) {
                                if (repo.stat){
                                    // vm.allNewJob.splice(0, vm.allNewJob.length);
                                    $scope.newjobname = "";
                                    $scope.saveHide = true;
                                    $scope.saveOK = false;
                                    $scope.jobuuid = $scope.editjobuuid;
                                    vm.saveVar();
                                }

                            }, function (repo) {
                                console.log("update job error:", repo);
                            })
                    }else {
                        resoureceService.job.createJob(vm.treeid, post_data, null)
                            .then(function (repo) {
                                if (repo.stat){
                                    // vm.allNewJob.splice(0, vm.allNewJob.length);
                                    $scope.newjobname = "";
                                    $scope.saveHide = true;
                                    $scope.saveOK = false;
                                    $scope.jobuuid = repo.uuid;
                                }

                            }, function (repo) {
                                console.log("post error result", repo);
                            })
                    }
                }
            }else {
                swal({
                    title:"数据不全",
                    type:'error',
                });
            }
        };

        vm.runJob = function () {
            $http.get('/api/job/variable/' + vm.treeid +"/"+vm.editjobuuid + "?empty=1").then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.emptyVar = response.data.data;
                        if (vm.emptyVar.length >0){
                            var emptyVartab = $uibModal.open({
                                templateUrl: 'app/components/emptyvar/emptyVar.html',
                                controller: 'EmptyVarController',
                                controllerAs: 'emptyvars',
                                backdrop: 'static',
                                size: 'lg',
                                keyboard: false,
                                bindToController: true,
                                resolve: {
                                    emptyData : function () { return vm.emptyVar}
                                }
                            });
                            emptyVartab.result.then(
                                function (result) {
                                    var variableDict = {};
                                    angular.forEach(result, function (data, index) {
                                        variableDict[data.name] = data.value;
                                    });
                                    resoureceService.work.runJob(vm.treeid, {"jobuuid":vm.editjobuuid ,"variable":variableDict})
                                        .then(function (repo) {
                                            if (repo.stat){
                                                $state.go('home.history.jobdetail', {treeid:vm.treeid,taskuuid:repo.uuid});
                                            }

                                        }, function (repo) {
                                            console.log("run job error", repo);
                                        });
                                },function (reason) {
                                    console.log("runjob error reason", reason)
                                }
                            );
                        }else {
                            resoureceService.work.runJob(vm.treeid, {"jobuuid":vm.editjobuuid })
                                .then(function (repo) {
                                    if (repo.stat){
                                        $state.go('home.history.jobdetail', {treeid:vm.treeid,taskuuid:repo.uuid});
                                    }

                                }, function (repo) {
                                    console.log("run job error", repo);
                                });
                        }
                    }else {
                    }
                },
                function errorCallback (response){
                    swal({
                        title:"检测变量失败",
                        type:'error',
                        text:response.message
                    });
                });
        };

        vm.up = function (idx){
            if (idx>0){
                [vm.allNewJob[idx-1], vm.allNewJob[idx]] = [vm.allNewJob[idx], vm.allNewJob[idx-1]]
            }
        };

        vm.down = function (idx){
            if (idx<vm.allNewJob.length-1){
                [vm.allNewJob[idx+1], vm.allNewJob[idx]] = [vm.allNewJob[idx], vm.allNewJob[idx+1]]
            }
        };

        if (vm.editjobuuid && vm.editJobData){
            $scope.newjobname = vm.editjobname;
            if (vm.mon_status) {
                $scope.mon_status=true;
            }else{
                $scope.mon_status=false;
            }
            $scope.mon_ids = vm.mon_ids;
            var jobTypesList = [];
            angular.forEach(vm.editjobtypes.split(","), function (jtype, i) {
                jobTypesList.push(jtype.split("_")[0])
            });
            angular.forEach(vm.editJobData, function (data, index) {
                data.plugin_type = jobTypesList[index];
                vm.allNewJob.push(data);
            });
            $scope.editState = true;
        }else if(vm.copyjob){
            var jobTypesList = [];
            angular.forEach(vm.editjobtypes.split(","), function (jtype, i) {
                jobTypesList.push(jtype.split("_")[0])
            });
            angular.forEach(vm.editJobData, function (data, index) {
                data.plugin_type = jobTypesList[index];
                vm.allNewJob.push(data);
            });
        }

    }

})();

(function() {
    'use strict';

    BusinessJobCreateController.$inject = ["$timeout", "$state", "$http", "$stateParams", "$uibModal", "$scope", "treeService", "resoureceService", "$injector"];
    angular
        .module('openc3')
        .controller('BusinessJobCreateController', BusinessJobCreateController);

    function BusinessJobCreateController($timeout, $state, $http,$stateParams, $uibModal, $scope, treeService,resoureceService, $injector) {
        var vm = this;
        var toastr = toastr || $injector.get('toastr');
        $scope.saveHide = false;
        $scope.saveOK = true;
        $scope.globalVar = true;
        $scope.mon_status = false;
        $scope.monVar = true;
        vm.newJobuuid = null;
        vm.allNewJob = [];
        vm.allVar = [];
        $scope.var = {
            "jobuuid":"",
            "name":"",
            "value":"",
            "describe":" "
        };
        vm.treeid = $state.params.treeid;

        treeService.sync.then(function(){           // when the tree was success.
            vm.nodeStr = treeService.selectname();  // get tree name
        });
        vm.hideGlobalVar = function () {
            $scope.globalVar = !$scope.globalVar;
        };
        vm.hideMonVar = function () {
            $scope.monVar = !$scope.monVar;
        };
        vm.delVar = function (idx) {
            vm.allVar.splice(idx,1)
        };
        vm.addVar = function () {
            vm.allVar.push(angular.copy($scope.var));
        };

        vm.count = function(pluginType){
            var count = 0;
            for(var i = 0; i < vm.allNewJob.length; i++) {
                if (vm.allNewJob[i].plugin_type == pluginType){
                    count = count + 1;
                }
            }
            return count;
        };

        vm.createScriptJob = function (idx) {
            var count = vm.count("cmd");
            var seq = count + 1;
            var openChoice = $uibModal.open({
                templateUrl: 'app/pages/business/job/plugin/cmd.html',
                controller: 'scriptJobController',
                controllerAs: 'scriptjob',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    editData : function () {return ""},
                    seq : function () {return seq}
                }
            });

            openChoice.result.then(
                function (result) {
                    if (idx >= 0){
                        vm.allNewJob.splice(idx, 0, result);
                    }else {
                        vm.allNewJob.push(result)
                    }
                },function (reason) {
                }
            );

        };

        vm.createApprovalJob = function (idx) {
            var count = vm.count("approval");
            var seq = count + 1;
            var openChoice = $uibModal.open({
                templateUrl: 'app/pages/business/job/plugin/approval.html',
                controller: 'approvalJobController',
                controllerAs: 'approvaljob',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    editData : function () {return ""},
                    seq : function () {return seq}
                }
            });

            openChoice.result.then(
                function (result) {
                    if (idx >= 0){
                        vm.allNewJob.splice(idx, 0, result);
                    }else {
                        vm.allNewJob.push(result)
                    }

                },function (reason) {
                }
            ); 
        };

         vm.copyApproval = function (id) {
            var d = vm.allNewJob[id]
            var tempdata = {
                'plugin_type':'approval',
                'name': d.name + '_copy',
                'approver': d.approver,
                'cont': d.cont,
                'everyone': d.everyone,
                'timeout': d.timeout,
                'deployenv' : d.deployenv,
                'action' : d.action,
                'batches' : d.batches
            }
            vm.allNewJob.splice(id + 1, 0, tempdata);
        };

        vm.editApproval = function (id) {
            var editData = vm.allNewJob[id];
            var openEdit= $uibModal.open({
                templateUrl: 'app/pages/business/job/plugin/approval.html',
                controller: 'approvalJobController',
                controllerAs: 'approvaljob',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    editData : function () {return editData},
                    seq : function () {return 0}
                }
            });

            openEdit.result.then(
                function (result) {
                    vm.allNewJob.splice(id, 1, result);
                },function (reason) {
                }
            );
        };


        vm.createScpJob = function (idx) {
            var count = vm.count("scp");
            var seq = count + 1;
            var openChoice = $uibModal.open({
                templateUrl: 'app/pages/business/job/plugin/scp.html',
                controller: 'scpJobController',
                controllerAs: 'scpjob',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    editData : function () {return ""},
                    seq : function () {return seq}
                }
            });

            openChoice.result.then(
                function (result) {
                    if (idx >= 0){
                        vm.allNewJob.splice(idx, 0, result);
                    }else {
                        vm.allNewJob.push(result)
                    }

                },function (reason) {
                }
            );
        };

        vm.copyScp = function (id) {
            var d = vm.allNewJob[id]
            var tempdata = {
                'chmod': d.chmod,
                'chown': d.chown,
                'dp': d.dp,
                'dst': d.dst,
                'dst_type': d.dst_type,
                'scp_delete': d.scp_delete,
                'sp': d.sp,
                'src': d.src,
                'src_type':d.src_type,
                'plugin_type':'scp',
                'name': d.name + '_copy',
                'user': d.user,
                'timeout': d.timeout,
                'pause': d.pause,
                'deployenv' : d.deployenv,
                'action' : d.action,
                'batches' : d.batches
            }
            vm.allNewJob.splice(id + 1, 0, tempdata);
        };

        vm.editScp = function (id) {
            var editData = vm.allNewJob[id];
            var openEdit= $uibModal.open({
                templateUrl: 'app/pages/business/job/plugin/scp.html',
                controller: 'scpJobController',
                controllerAs: 'scpjob',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () { return vm.treeid},
                    editData : function () {return editData},
                    seq : function () {return 0}
                }
            });

            openEdit.result.then(
                function (result) {
                    vm.allNewJob.splice(id, 1, result);
                },function (reason) {
                }
            );
        };

        vm.copyScript = function (id) {
            var d = vm.allNewJob[id]
            var tempdata = {
                'plugin_type':'cmd',
                'name': d.name + '_copy',
                'user': d.user,
                'node_type':d.node_type,
                'node_cont':d.node_cont,
                'scripts_type':d.scripts_type,
                'scripts_cont': d.scripts_cont,
                'scripts_argv': d.scripts_argv,
                'timeout': d.timeout,
                'pause': d.pause,
                'deployenv' : d.deployenv,
                'action' : d.action,
                'batches' : d.batches
            }
            vm.allNewJob.splice(id + 1, 0, tempdata);
        };

        vm.editScript = function (id) {
            var editData = vm.allNewJob[id];
            var openChoice = $uibModal.open({
                templateUrl: 'app/pages/business/job/plugin/cmd.html',
                controller: 'scriptJobController',
                controllerAs: 'scriptjob',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeId: function () {return vm.treeid},
                    editData : function () {return editData},
                    seq : function () {return 0}
                }
            });

            openChoice.result.then(
                function (result) {
                    vm.allNewJob.splice(id, 1, result);
                },function (reason) {
                }
            ); 
        };

        vm.deljobdata = function (id) {
            vm.allNewJob.splice(id, 1);
        };

        vm.saveCreateData = function () {
            if (vm.allNewJob.length >0){
                if (!$scope.newjobname){
                    swal({
                        title:"作业名称为空",
                        type:'error'
                    });
                }
                else {
                    var post_data = {
                        "name":$scope.newjobname,
                        "mon_status":$scope.mon_status,
                        "mon_ids":$scope.mon_ids,
                        "data":vm.allNewJob,
                        "permanent":"permanent",
                    };
                    resoureceService.job.createJob(vm.treeid, post_data, null)
                        .then(function (repo) {
                            if (repo.stat){
                                $scope.newjobname = "";
                                $scope.saveHide = true;
                                $scope.saveOK = false;
                                $scope.jobuuid = repo.uuid;

                                var saveVar = {};
                                saveVar.jobuuid = $scope.jobuuid;
                                saveVar.data = vm.allVar;
                                $http.post('/api/job/variable/'+ vm.treeid+'/update', saveVar).then(
                                    function successCallback(response) {
                                        if (response.data.stat){
                                        }else {
                                            swal("加载数据失败", response.data.info, 'error');
                                        }
                                    },
                                    function errorCallback (response ){
                                        swal("加载数据失败", response.status, 'error');
                                    }
                                );
                            }
                            else
                            {
                                toastr.error("出错啦" + repo.info );
                            }

                        }, function (repo) {
                            toastr.error("出错啦" + repo);
                        })

                }
            }else {
                swal({ title:"数据不全", type:'error' });
            }
        };

        vm.runJob = function () {
            $http.get('/api/job/variable/' + vm.treeid +"/"+$scope.jobuuid + "?empty=1").then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.emptyVar = response.data.data;
                        if (vm.emptyVar.length >0){
                            var emptyVartab = $uibModal.open({
                                templateUrl: 'app/components/emptyvar/emptyVar.html',
                                controller: 'EmptyVarController',
                                controllerAs: 'emptyvars',
                                backdrop: 'static',
                                size: 'lg',
                                keyboard: false,
                                bindToController: true,
                                resolve: {
                                    emptyData : function () { return vm.emptyVar}
                                }
                            });
                            emptyVartab.result.then(
                                function (result) {
                                    var variableDict = {};
                                    angular.forEach(result, function (data, index) {
                                        variableDict[data.name] = data.value;
                                    });
                                    resoureceService.work.runJob(vm.treeid, {"jobuuid":$scope.jobuuid,"variable":variableDict})
                                        .then(function (repo) {
                                            if (repo.stat){
                                                $state.go('home.history.jobdetail', {treeid:vm.treeid,taskuuid:repo.uuid});
                                            }
                                            else
                                            {
                                                toastr.error("出错啦" + repo.info );
                                            }

                                        }, function (repo) {
                                            toastr.error("出错啦" + repo );
                                        });
                                },function (reason) {
                                }
                            ); 
                        }else {
                            resoureceService.work.runJob(vm.treeid, {"jobuuid":$scope.jobuuid})
                                .then(function (repo) {
                                    if (repo.stat){
                                        $state.go('home.history.jobdetail', {treeid:vm.treeid,taskuuid:repo.uuid});
                                    }
                                    else
                                    {
                                        toastr.error("出错啦" + repo.info );
                                    }

                                }, function (repo) {
                                    toastr.error("出错啦" + repo);
                                });
                        }
                    }else {
                        swal({ title:"检测变量失败", type:'error', text:response.data.info });
                    }
                },
                function errorCallback (response){
                    swal({ title:"检测变量失败", type:'error', text:response.message });
                });
        };

        vm.up = function (idx){
            if (idx>0){
                [vm.allNewJob[idx-1], vm.allNewJob[idx]] = [vm.allNewJob[idx], vm.allNewJob[idx-1]]
            }
        };

        vm.down = function (idx){
            if (idx<vm.allNewJob.length-1){
                [vm.allNewJob[idx+1], vm.allNewJob[idx]] = [vm.allNewJob[idx], vm.allNewJob[idx+1]]
            }
        };
    }

})();

(function(){
    'use strict';

        tokenController.$inject = ["$rootScope", "$scope", "$injector", "$uibModalInstance", "$http", "$state", "md5", "resoureceService"];
    angular
        .module('openc3')
        .controller('tokenController', tokenController);

        function tokenController($rootScope, $scope,$injector,$uibModalInstance, $http, $state, md5,resoureceService) {

            var vm = this;
            vm.allToken = [];
            vm.cancel = function(){ $uibModalInstance.dismiss()};

            vm.hosturl = window.location.protocol + '//' + window.location.host;
            vm.treeid = $state.params.treeid;
            vm.newToken = "";
            vm.tokenDis = "";
            vm.jobname = "";
            vm.isjob = false;
            var toastr = toastr || $injector.get('toastr');
            vm.getToken = function () {
                $http.post('/api/job/token/'+vm.treeid+'/info').then(
                    function successCallback (response) {
                        if (response.data.stat){
                            vm.allToken = response.data.data;
                        }else {
                            toastr.error( "获取token信息失败:" + response.data.info )
                        }
                    },
                    function errorCallback () {
                        toastr.error( "获取token信息失败:" + response.status )
                    }
                );
            };

            vm.getJObs = function () {
                $http.post('/api/job/third/option/jobname', {"project_id": vm.treeid}).then(
                    function successCallback (response) {
                        if (response.data.stat){
                            vm.allJobs = response.data.data;
                        }else {
                            toastr.error( "获取作业列表失败:" + response.data.info )
                        }
                    },
                    function errorCallback () {
                        toastr.error( "获取作业列表失败:" + response.status )
                    }
                );
            };

            vm.delToken = function (idx) {
                resoureceService.token.delete([vm.treeid, idx], null,  null)
                    .then(function (repo) {
                        if (repo.stat){
                            vm.getToken();
                        }else {
                            toastr.error( "删除token失败:" + repo.info )
                        }
                    })
            };
            vm.randomString = function () {
                return md5.createHash(String(new Date().getTime()))
            };
            vm.initToken = function () {
                vm.getToken();
                vm.newToken = vm.randomString();
                vm.tokenDis = "";
            };
            vm.initJOB = function () {
                vm.isjob = false;
                vm.jobname = "";
            };
            vm.showJob = function (isjob, jobname) {
                if (isjob == '1') {
                    return jobname;
                } else {
                    return "否";
                }
            };
            vm.addToken = function () {
                if (vm.newToken.length != 32){
                    swal({
                        title:"token长度不等于32字符",
                        type:'error'
                    });
                    return
                }
                if(!vm.tokenDis){
                    swal({
                        title:"token描述不能为空",
                        type:'error'
                    });
                    return
                }
                if(vm.isjob && !vm.jobname){
                    swal({
                        title:"请选择常用作业，或关闭调用job按钮",
                        type:'error'
                    });
                    return
                }
                $http.post('/api/job/token/'+vm.treeid, {"token":vm.newToken, "describe":vm.tokenDis, "isjob": vm.isjob, "jobname": vm.jobname}).then(
                    function successCallback (response) {
                        if (response.data.stat){
                            vm.initToken();
                            vm.initJOB();
                        }else {
                            vm.initToken();
                            vm.initJOB();
                        }
                    },
                    function errorCallback () {
                        vm.initToken();
                        vm.initJOB();
                    }
                );
            };

            vm.getToken();
            vm.getJObs();
            vm.newToken = vm.randomString();
        }

})();

(function() {
    'use strict';

    FileController.$inject = ["$timeout", "$state", "$http", "$uibModal", "$scope", "treeService", "ngTableParams", "resoureceService", "$injector"];
    angular
        .module('openc3')
        .controller('FileController', FileController);

    function FileController($timeout, $state, $http, $uibModal, $scope, treeService, ngTableParams, resoureceService, $injector) {

        var vm = this;

        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.getMe = function () {
            $http.get('/api/connector/connectorx/sso/userinfo').success(function(data){
                vm.createuser = data.email;
            });
        };

        $('#createstart').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.createStart = result;
            $scope.$apply();
        });

        vm.Reset = function () {
            vm.filename = "";
            vm.createuser = "";
            vm.createStart = "";
            vm.createEnd = "";
            vm.reload()
        };

        $('#createend').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.createEnd= result;
            $scope.$apply();
        });


        vm.bytesToSize = function(bytes) {
            if (bytes === 0) return '0 B';
            var k = 1000, // or 1024
                sizes = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'],
                i = Math.floor(Math.log(bytes) / Math.log(k));

           return (bytes / Math.pow(k, i)).toPrecision(3) + ' ' + sizes[i];
        }

        vm.reload = function(){
            vm.loadover = false
            $http.get('/api/job/fileserver/' + vm.treeid).then(
                function successCallback(response) {
                    if (response.data.stat){
                        var result = [];
                        angular.forEach( response.data.data.reverse(), function (value, key) {
                            if(vm.createuser && value["create_user"] != vm.createuser){
                                return true;
                            }
                            if(vm.filename && value["name"].indexOf(vm.filename) < 0 ){
                                return true;
                            }
                            if(vm.createStart){
                                var start_time = new Date(vm.createStart).getTime();
                                var create_time = new Date(value["create_time"]).getTime();
                                if (create_time <= start_time) {
                                    return true;
                                }
                            }
                            if(vm.createEnd){
                                var finish_time = new Date(vm.createEnd).getTime();
                                var create_time = new Date(value["create_time"]).getTime();
                                if (finish_time <= create_time) {
                                    return true;
                                }
                            }
                            result.push(value);
                        });
                        vm.loadover = true
                        vm.file_Table = new ngTableParams({count:10}, {counts:[],data:result});
                    }else {
                        swal({ title:'获取文件列表失败', text: response.data.info, type:'error' });
                    }
                },
                function errorCallback (response ){
                    swal({ title:'获取文件列表失败', text: response.status, type:'error' });
                });


        };

        vm.deleteFile = function (idx) {
            resoureceService.file.delete([vm.treeid, idx], null, null)
                .then(function (repo) {
                    if (repo.stat){
                        vm.reload();
                    }
                    else
                    {
                        toastr.error("删除失败:" + repo.info)
                    }
                })

        };

        vm.downloadFile = function (name) {
            $http.get('/api/job/fileserver/' + vm.treeid + '/download?name=' + name).then(
                function successCallback(response) {
                    if (response.data.stat){
                        var downloadAddr = window.location.protocol + "//" + window.location.host + "/api/job/download/";
                         window.open(downloadAddr+response.data.data, '_blank')
                    }else {
                        toastr.error( "获取下载地址失败："+response.data.info)
                    }
                },
                function errorCallback (response ){
                    toastr.error( "获取下载地址失败："+response.status)
                });
        };

        $scope.upForm = function () {
            var form = new FormData();
            var file = document.getElementById("choicefiles").files[0];
            form.append('file', file);
            $http({
                method: 'POST',
                url: '/api/job/fileserver/'+ vm.treeid,
                data: form,
                headers: {'Content-Type': undefined},
                transformRequest: angular.identity
            }).success(function (data) {
                if (data.stat){
                    vm.reload()
                }
                else
                {
                    toastr.error("上传失败:" + data.info)
                }
            }).error(function (data) {
                toastr.error("上传失败:" + data)
            })
        };
        vm.clickImport = function () {
            document.getElementById("choicefiles").click();
        };

 

        vm.manageToken = function () {
            $uibModal.open({
                templateUrl: 'app/pages/business/file/token.html',
                controller: 'tokenController',
                controllerAs: 'token',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {}
            });
        };
        vm.reload();
    }

})();

(function () {
    'use strict';
    ChoiceFileController.$inject = ["$uibModalInstance", "$uibModal", "$timeout", "$state", "$http", "$scope", "ngTableParams", "resoureceService", "$injector"];
    angular
        .module('openc3')
        .controller('ChoiceFileController', ChoiceFileController);

    function ChoiceFileController($uibModalInstance,$uibModal,$timeout,$state, $http, $scope, ngTableParams, resoureceService, $injector) {

        var vm = this;
        var toastr = toastr || $injector.get('toastr');
        $scope.choiceType = 'choice';      
        $scope.selected = [];
        $scope.radioselected = {};
        $scope.selectedData = [];
        $scope.allData = [];
        $scope.s_file = '';
        $scope.inputFileName = '';
        vm.inputFileName = $scope.inputFileName;
        vm.treeid = $state.params.treeid;
        vm.cancel = function(){ $uibModalInstance.dismiss()};
        vm.getFiles = function () {
            $http.get('/api/job/fileserver/'+ vm.treeid).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.files_Table = new ngTableParams({count:15}, {counts:[],data:response.data.data.reverse()});
                    }else {
                        toastr.error( "获取文件信息失败："+response.data.info )
                    }
                },
                function errorCallback (response ){
                    toastr.error( "获取文件信息失败："+response.status )
                });
        };

        vm.deleteFile = function (idx) {
            resoureceService.file.delete([vm.treeid, idx], null, null)
                .then(function (repo) {
                    if (repo.stat){
                        vm.getFiles();
                    }
                    else
                    {
                        toastr.error( "删除失败："+repo.info )
                    }
                })

        };
        $scope.upForm = function () {
            var form = new FormData();
            var file = document.getElementById("choicefiles").files[0];
            form.append('file', file);
            $http({
                method: 'POST',
                url: '/api/job/fileserver/'+ vm.treeid,
                data: form,
                headers: {'Content-Type': undefined},
                transformRequest: angular.identity
            }).success(function (data) {
                if (data.stat){
                    vm.up_re = "上传成功";
                    setTimeout(function () {
                        document.getElementById("upresult123").style.display = 'none';
                    }, 2000);
                }
                vm.getFiles();
            }).error(function (data) {
                vm.up_re = "上传失败";
                document.getElementById("upresult").style.color = 'red';
                document.getElementById("upresult").style.display = 'none';
            })
        };
        vm.clickImport = function () {
            document.getElementById("choicefiles").click();
        };

        vm.cleanSelected = function () {
            $scope.selected = [];
            var from = $scope.formType;

            if (from == "ip"){
                $scope.allData = vm.machineData;
            }else if(from == "group"){
                $scope.allData = vm.groupData;
            }
        };

        vm.manageToken = function () {
            $uibModal.open({
                templateUrl: 'app/pages/business/file/token.html',
                controller: 'tokenController',
                controllerAs: 'token',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {}
            });
        };

        vm.chioceover = function(){
            var choiceType = $scope.choiceType;
            if (choiceType == "choice") {
                $scope.selectedData.push($scope.s_file);
            } else {
                var filename = {'name': vm.inputFileName};
                $scope.selectedData.push(filename);
            }
            $uibModalInstance.close(
                $scope.selectedData
            );
        };

        $scope.updateSelectFile = function ($event, id, data) {
            $scope.s_file = data;
        };
        $scope.updateRadio = function ($event, id, data) {
            // var checkbox = $event.target;
            // var action = (checkbox.checked ? 'add' : 'remove');
            // updateSelected(action, id, data);
            $scope.radioselected['group'] = data
        };
        $scope.selectAll = function ($event) {
            var checkbox = $event.target;
            var action = (checkbox.checked ? 'add' : 'remove');
            for (var i = 0; i < $scope.allData.length; i++) {
                var entity = $scope.allData[i];
                updateSelected(action, entity.id, entity);
            }
        };
        // $scope.getSelectedClass = function (entity) {
        //     return $scope.isSelected(entity.id) ? 'selected' : '';
        // };
        $scope.isSelected = function (id) {
            return $scope.selected.indexOf(id) >= 0;
        };
        $scope.isSelectedAll = function () {
            if ($scope.selected.length){
                return $scope.selected.length === $scope.allData.length;
            }

        };
        vm.getFiles();


    }
})();


(function() {
    'use strict';

    BusinessCrontabController.$inject = ["$timeout", "$state", "$http", "$uibModal", "$scope", "treeService", "ngTableParams", "resoureceService", "scriptId", "$injector"];
    angular
        .module('openc3')
        .controller('BusinessCrontabController', BusinessCrontabController);

    function BusinessCrontabController($timeout, $state, $http, $uibModal, $scope, treeService, ngTableParams, resoureceService, scriptId, $injector) {

        var vm = this;
        $scope.searchStatus = "";
        var toastr = toastr || $injector.get('toastr');
        vm.treeid = $state.params.treeid;

        $('#createstart').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.createStart = result;
            $scope.$apply();
        });

        $('#createend').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.createEnd= result;
            $scope.$apply();
        });

        $('#editstart').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.editStart = result;
            $scope.$apply();
        });

        $('#editend').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        }).on('dp.change', function (e) {
            var result = new moment(e.date).format('YYYY-MM-DD');
            vm.editEnd= result;
            $scope.$apply();
        });

        vm.deleteCronJob = function(cronid){

            resoureceService.work.delCron([vm.treeid,cronid],null, null).finally(function(){
                vm.reload();
            });
        };

        vm.editCronJob = function(cronid){
            $http.get('/api/job/crontab/'  + vm.treeid+"/"+ cronid ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.cronDetail = response.data.data;
                        vm.openCronHtml(vm.cronDetail, true);
                    }else {
                        $scope.dataready = false;
                        toastr.error( "获取信息失败："+response.data.info );
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取信息失败: " + response.status )
                });

        };

        vm.runCronJob = function(cronid){
            resoureceService.work.runCron([vm.treeid, cronid], {"status":"available"})
                .then(function (repo) {
                    if (repo.stat){
                        vm.reload();
                    }
                    else
                    {
                        toastr.error( "操作失败:" + repo.info );
                    }
                }, function (repo) {
                    toastr.error( "操作失败:" + repo );
                });

        };

        vm.stopCronJob = function(cronid){
            resoureceService.work.stopCron([vm.treeid, cronid], {"status":"unavailable"})
                .then(function (repo) {
                    if (repo.stat){
                        vm.reload();
                    }
                    else
                    {
                        toastr.error( "操作失败:" + repo.info );
                    }
                }, function (repo) {
                    toastr.error( "操作失败:" + repo );
                });

        };

        vm.createCron = function(){
            vm.openCronHtml(null, false)

        };

        vm.openCronHtml = function(data, edit){
            $uibModal.open({
                templateUrl: 'app/pages/business/crontab/create.html',
                controller: 'BusinessCrontabCreateController',
                controllerAs: 'businesscrontabcreate',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    reloadhome: function () {return vm.reload},
                    cronData : function () {return data},
                    edit : function () {return edit},
                    jobData : function () {return null},
                }
            });
            vm.reload();
        };

        vm.getMe = function () {
            $http.get('/api/connector/connectorx/sso/userinfo').success(function(data){
                vm.createuser = data.email;
            });
        };

        vm.Reset = function () {
            vm.createuser = "";
            vm.edituser = "";
            vm.cronname = "";
            vm.createStart = "";
            vm.createEnd = "";
            vm.editStart = "";
            vm.editEnd = "";
            vm.reload()
        };

        vm.reload = function () {
            vm.loadover = false
            var get_data = {};
            if (vm.cronname){
                get_data.name=vm.cronname
            }
            if(vm.createuser){
                get_data.create_user=vm.createuser
            }
            if(vm.edituser){
                get_data.edit_user=vm.edituser
            }
            if(vm.createStart){
                get_data.create_time_start=vm.createStart
            }
            if(vm.createEnd){
                get_data.create_time_end=vm.createEnd
            }
            if(vm.editStart){
                get_data.edit_time_start=vm.editStart
            }
            if(vm.editEnd){
                get_data.edit_time_end=vm.editEnd
            }
            $http({
                method:'GET',
                url:'/api/job/crontab/' + vm.treeid,
                params:get_data
            }).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.data_Table = new ngTableParams({count:10}, {counts:[],data:response.data.data.reverse()});
                        vm.loadover = true
                    }else {
                        toastr.error( "搜索失败:" + response.data.info );
                    }
                },
                function errorCallback(response) {
                    toastr.error( "搜索失败:" + response.status );
                }
            );
        };

        vm.reload();

    }

})();

(function () {
    'use strict';
    BusinessCrontabCreateController.$inject = ["$uibModalInstance", "$scope", "$state", "$http", "resoureceService", "reloadhome", "cronData", "edit", "jobData", "$injector"];
    angular
        .module('openc3')
        .controller('BusinessCrontabCreateController', BusinessCrontabCreateController);

    function BusinessCrontabCreateController($uibModalInstance,$scope,$state,$http, resoureceService,reloadhome, cronData, edit, jobData, $injector) {

        var vm = this;
        var toastr = toastr || $injector.get('toastr');
        vm.cancel = function(){ $uibModalInstance.dismiss()};

        vm.treeid = $state.params.treeid;
        vm.edit = edit
        $scope.selectedjob = "";
        $scope.mutex = '';
        vm.cronlockstr = '';   
        vm.postcronData = {
            "name": "",
            "jobuuid": "",
            "cron":"",
            "mutex": "",
        };

        vm.createCron = function(){

            if(!$scope.cronTabname){
                toastr.error( '任务名称不能为空' )
                return
            }else if(!$scope.selectedjob){
                toastr.error( '指定作业不能为空' )
                return
            }

            if ($scope.cronlock){
                $scope.mutex = vm.cronlockstr
            }
            vm.postcronData = {
                "name": $scope.cronTabname,
                "jobuuid": $scope.selectedjob,
                "cron":$scope.cronrule,
                "mutex": $scope.mutex,
            };
            if (edit){
                resoureceService.work.changeCron([vm.treeid, cronData.id],vm.postcronData, null).finally(function(){
                    vm.cancel();
                    reloadhome();
                });
            }else {
                resoureceService.work.createCron([vm.treeid],vm.postcronData, null).finally(function(){
                    vm.cancel();
                    reloadhome();
                });
            }
        };

        vm.makeStr = function () {
             var text = "";
                var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

                for( var i=0; i < 5; i++ )
                    text += possible.charAt(Math.floor(Math.random() * possible.length));
                return text;
        };

        vm.getAllJobs = function () {
            $http.get('/api/job/jobs/'  + vm.treeid).then(
                function successCallback(response) {
                    if (response.data.stat){
                        $scope.allJobs = []
                        angular.forEach(response.data.data, function (d, index) {
                            if( d.hasvariable == 0 )
                            {
                                $scope.allJobs.push(d)
                            }
                        });
                    }else {
                        $scope.dataready = false;
                        toastr.error( "获取作业信息失败："+response.data.info );
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取作业信息失败: " + response.status )
                });
        };

        vm.getAllJobs();

        vm.cronlockstr = vm.makeStr(); 
        if (edit){
            $scope.cronTabname = cronData.name;
            $scope.cronrule  = cronData.cron;
            if (cronData.mutex){
                $scope.cronlock = true;
                vm.cronlockstr = cronData.mutex;
            }
            $scope.selectedjob = cronData.jobuuid;

        }
        if (jobData){
            $scope.cronTabname = jobData.name;
            $scope.selectedjob = jobData.uuid;
        }
    }
})();


(function() {
    'use strict';

    AgentController.$inject = ["$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService"];
    angular
        .module('openc3')
        .controller('AgentController', AgentController);

    function AgentController($location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService) {

        var vm = this;
        vm.treeid = $state.params.treeid;

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });
        vm.siteaddr = window.location.protocol + '//' + window.location.host;
        vm.checkoldstatus=false;
        vm.checknewstatus=false;
        vm.reloadcheck = function(){
            $http.get('/api/agent/check/' + vm.treeid ).success(function(data){
                vm.checkstatusloadover = true;
                vm.checkstatusdata = data.data;
                if(  data.data.status == 'off' )
                {
                    vm.checkoldstatus=false;
                    vm.checknewstatus=false;
                }
                else
                {
                    vm.checkoldstatus=true;
                    vm.checknewstatus=true;
                }
            });
        };

        vm.reload = function(){
            vm.loadover = false;
            $http.get('/api/agent/region/' + vm.treeid+'/active').success(function(data){
                vm.activeRegionTable = new ngTableParams({count:20}, {counts:[],data:data.data});
                vm.loadover = true;
            });
            vm.reloadcheck();
        };

        vm.reload();


        vm.savecheckstatus = function(){
          swal({
            title: "保存新状态",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){
            vm.checkstatus = 'off';
            if( vm.checknewstatus == true)
            {
                vm.checkstatus = 'on';
            }
            $http.post('/api/agent/check/' + vm.treeid, { status: vm.checkstatus} ).success(function(data){
				if(data.stat == true) 
                { 
                    swal({ title: "修改成功!", type:'success' }); 
                    vm.checkoldstatus= vm.checknewstatus;
                } else { 
                    swal({ title: "修改失败!", text: data.info, type:'error' });
                }
            })

          })
        }

        vm.showctrlLog = function(t){
            $uibModal.open({
                templateUrl: 'app/pages/business/agent/detail/log.html',
                controller: 'AgentCtrlLogController',
                controllerAs: 'agentctrlLog', 
                backdrop: 'static', 
                size: 'lg', 
                keyboard: false,
                bindToController: true,
                resolve: {
                    nodeStr: function () { return vm.nodeStr },
                }
            });
        };

 
        vm.addregion = function(t){
            $uibModal.open({
                templateUrl: 'app/pages/business/agent/detail/region.html',
                controller: 'AgentRegionController',
                controllerAs: 'region', 
                backdrop: 'static', 
                size: 'lg', 
                keyboard: false,
                bindToController: true,
                resolve: {
                    nodeStr: function () { return vm.nodeStr },
                    reloadhome: function () { return vm.reload },
                    reloadhome: function () { return vm.reload }
                }
            });
        };

        vm.addproxy = function(regionid,regionname){
            $uibModal.open({
                templateUrl: 'app/pages/business/agent/detail/proxy.html',
                controller: 'AgentProxyController',
                controllerAs: 'proxy', 
                backdrop: 'static', 
                size: 'lg', 
                keyboard: false,
                bindToController: true,
                resolve: {
                    nodeStr: function () { return vm.nodeStr },
                    regionid: function () { return regionid },
                    regionname: function () { return regionname },
                    reloadhome: function () { return vm.reload }
                }
            });
        };

        vm.addagent = function(regionid,regionname){
            $uibModal.open({
                templateUrl: 'app/pages/business/agent/detail/agent.html',
                controller: 'AgentAgentController',
                controllerAs: 'agent', 
                backdrop: 'static', 
                size: 'lg', 
                keyboard: false,
                bindToController: true,
                resolve: {
                    nodeStr: function () { return vm.nodeStr },
                    regionid: function () { return regionid },
                    regionname: function () { return regionname },
                    reloadhome: function () { return vm.reload }
                }
            });
        };

        vm.showLog = function(slave,uuid,status){
            $uibModal.open({
                templateUrl: 'app/pages/installLog/detail/log.html',
                controller: 'InstallLogLogController',
                controllerAs: 'log',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    nodeStr: function () { return vm.nodeStr },
                    uuid: function () { return uuid },
                    slave: function () { return slave },
                    status: function () { return status }
                }
            });
        };
    }
})();

(function() {
    'use strict';

AssignmentEditController.$inject = ["$uibModalInstance", "$http", "uuid", "genericService", "$injector", "ngTableParams", "homereload", "show", "id"];
    angular
        .module('openc3')
        .controller('AssignmentEditController', AssignmentEditController);

    function AssignmentEditController($uibModalInstance, $http, uuid, genericService, $injector,ngTableParams,homereload,show,id) {

        var vm = this;
        vm.show = show
        vm.cancel = function(){ $uibModalInstance.dismiss()};
        vm.seftime = genericService.seftime
        vm.loadover = false;
        vm.data = {}
        var toastr = toastr || $injector.get('toastr');
        vm.reload = function () {
            $http.get('/api/ci/assignment/' + id).then(
                function successCallback(response){
                    if (response.data.stat){
                        vm.data = response.data.data
                        vm.loadover = true
                    }else{
                        toastr.error("获取信息失败:"+response.data.info)
                    }

                },
                function errorCallback (response){
                    toastr.error("获取信息失败:"+response.status)

                });
        };

        vm.reload();

        vm.commit = function () {
            $http.get('/api/ci/assignment/' + vm.data.id ).success(function(data){
                if (data.stat){
                    if(  data.data.status === 'todo' )
                    {
                        $http.post(vm.data.url, vm.data.data ).success(function(data){
                            if (data.stat){
                                vm.updateStatus('success');
                            }else {
                                vm.updateStatus('fail');
                                swal({ title:'提交失败', text: data.info, type:'error' });
                            }
                        });
                    }
                    else
                    {
                        swal({ title:'数据已经变更', text: "数据在您提交之前状态已经改变，请刷新确认。", type:'error' });
                    }
                }else {
                    swal({ title:'获取协助详情失败', text: data.info, type:'error' });
                }
            });
        };


        vm.updateStatus = function (stat) {
            $http.post('/api/ci/assignment/' + id, { "status": stat, "handle_reason": vm.data.handle_reason } ).success(function(data){
                if (data.stat){
                    homereload();
                    vm.cancel()
                }else {
                    swal({ title:'获取列表失败', text: data.info, type:'error' });
                }
            });

        };




}})();

(function() {
    'use strict';

ApprovalEditController.$inject = ["$uibModalInstance", "$http", "uuid", "genericService", "$injector", "ngTableParams", "homereload", "show"];
    angular
        .module('openc3')
        .controller('ApprovalEditController', ApprovalEditController);

    function ApprovalEditController($uibModalInstance, $http, uuid, genericService, $injector,ngTableParams,homereload,show) {

        var vm = this;
        vm.show = show
        vm.cancel = function(){ $uibModalInstance.dismiss()};
        vm.seftime = genericService.seftime
        vm.loadover = false;
        vm.data = {}
        var toastr = toastr || $injector.get('toastr');
        vm.reload = function () {
            $http.get('/api/job/approval/' + uuid).then(
                function successCallback(response){
                    if (response.data.stat){
                        vm.dataTable = new ngTableParams({count:25}, {counts:[],data:response.data.data});
                        vm.data = response.data.data[0]
                        vm.loadover = true
                    }else{
                        toastr.error("获取信息失败:"+response.data.info)
                    }

                },
                function errorCallback (response){
                    toastr.error("获取信息失败:"+response.status)

                });
        };

        vm.edit = function (opinion) {
            $http.post( '/api/job/approval', { uuid: uuid, opinion: opinion} ).success(function(data){
                if (data.stat){
                    homereload();
                    vm.cancel()
                }else {
                    swal({ title: '操作失败', text: data.info, type:'error' });
                }
            });
        };

        vm.reload();

}})();

(function() {
    'use strict';

JobDetailController.$inject = ["$uibModalInstance", "$scope", "$timeout", "$state", "$http", "$window", "$uibModal", "repoData", "genericService", "$interval", "$injector"];
    angular
        .module('openc3')
        .controller('JobDetailController', JobDetailController);

    function JobDetailController($uibModalInstance,$scope,$timeout, $state, $http,$window,$uibModal, repoData, genericService, $interval, $injector) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        vm.cancel = function(){ $uibModalInstance.dismiss()};
        vm.loguuid = repoData.loguuid;      // 日志的uuid
        vm.jobuuid = repoData.uuid;         // 当前执行任务的uuid
        vm.jobaddr = repoData.slave;
        vm.seftime = genericService.seftime
        vm.loadover = false;
        vm.pluginname = { "plugin_approval": "审批", "plugin_cmd": "远程命令", "plugin_scp": "同步文件" }
        var toastr = toastr || $injector.get('toastr');
        vm.reload = function () {
            $http.get('/api/job/task/' + vm.treeid + "/" + vm.jobuuid).then(
                function successCallback(response){
                    if (response.data.stat){
                        vm.taskInfo = response.data.data;
                        if (vm.taskInfo.status == "fail" ){
                            vm.jobState = "执行失败";
                            $scope.statucolor = {
                                "color": "red",
                                "font-weight": "bold"
                            };
                        }else if(vm.taskInfo.status == "success" ){
                            vm.jobState = "执行成功";
                            $scope.statucolor = {
                                "color": "green",
                                "font-weight": "bold"
                            };
                        }
                        if (vm.taskInfo.status == "fail" || vm.taskInfo.status ==  "success"){

                            vm.loadover = true;
                            $interval.cancel(reRun);
                        }else {
                            vm.jobState = "执行中";
                            $scope.statucolor = {
                                "color": "#f19301",
                                "font-weight": "bold"
                            };
                        }
                    }else{
                        toastr.error("获取任务状态信息失败:"+response.data.info)
                    }

                },
                function errorCallback (response){
                    toastr.error("获取任务状态信息失败:"+response.status)

                });
        };

        vm.reload();

        var reRun = $interval(function () {
            vm.reload();
        }, 2000);

        $scope.$on('$destroy', function(){
            $interval.cancel(reRun);
        });
}})();

(function() {
    'use strict';

    QuickentryController.$inject = ["$rootScope", "$state", "treeService"];
    angular
        .module('openc3')
        .controller('QuickentryController', QuickentryController);

    function QuickentryController($rootScope, $state, treeService) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        vm.state = $state;

        treeService.sync.then(function(){

            var zTree = $.fn.zTree.getZTreeObj('openc3tree');
            var treeNode = zTree.getNodeByParam('id', $state.params.treeid);
            if(treeNode == null){
                //$state.go('home.e401');
                return;
            }

        });

        $rootScope.$on('$stateChangeSuccess', function(){

            vm.treeid = $state.params.treeid;
            vm.state = $state;
        });
    }

})();

(function () {
    'use strict';
    AddUserController.$inject = ["$uibModalInstance", "$scope", "resoureceService", "treeId", "reloadUser"];
    angular
        .module('openc3')
        .controller('AddUserController', AddUserController);

    function AddUserController($uibModalInstance, $scope, resoureceService, treeId, reloadUser) {

        var vm = this;

        vm.cancel = function(){ $uibModalInstance.dismiss()};
        vm.add = function(){
            var d = {
                'username': $scope.username
            };
            resoureceService.user.addUser(treeId,  d, null)
                .then(function () {
                    vm.cancel();
                    reloadUser();
                })
                .finally(function(){

            });
        };
    }
})();


(function() {
    'use strict';

    QuickApprovalController.$inject = ["$state", "$http", "$injector", "ngTableParams", "genericService"];
    angular
        .module('openc3')
        .controller('QuickApprovalController', QuickApprovalController);

    function QuickApprovalController($state, $http, $injector, ngTableParams, genericService ) {
        var vm = this;
        var toastr = toastr || $injector.get('toastr');
        var uuid = $state.params.uuid;

        vm.seftime = genericService.seftime
        vm.show = false
        vm.stat = {}
        vm.reload = function () {
            $http.get('/api/job/approval/control/' + uuid).then(
                function successCallback(response){
                    if (response.data.stat){
                        vm.dataTable = new ngTableParams({count:25}, {counts:[],data:response.data.data});
                        vm.data = response.data.data[0]
                    }else{
                        toastr.error("获取信息失败:"+response.data.info)
                    }

                },
                function errorCallback (response){
                    toastr.error("获取信息失败:"+response.status)

                });

            $http.get('/api/job/approval/control/status/' + uuid).then(
                function successCallback(response){
                    if (response.data.stat){
                        vm.stat = response.data.data
                    }else{
                        toastr.error("获取信息失败:"+response.data.info)
                    }

                },
                function errorCallback (response){
                    toastr.error("获取信息失败:"+response.status)

                });
 
        };

        vm.edit = function (opinion) {
            $http.post( '/api/job/approval/control', { uuid: uuid, opinion: opinion} ).success(function(data){
                if (data.stat){
                    vm.reload();
                }else {
                    swal({ title: '操作失败', text: data.info, type:'error' });
                }
            });
        };

        vm.reload();

    }
})();

(function() {
    'use strict';

    KubernetesSetReplicasController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "type", "name", "namespace", "replicas", "clusterinfo"];
    angular
        .module('openc3')
        .controller('KubernetesSetReplicasController', KubernetesSetReplicasController);

    function KubernetesSetReplicasController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, type, name, namespace, replicas, clusterinfo ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.replicas = replicas;

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.setreplicas = function(){
            vm.loadover = false;
            var d = {
                "ticketid": ticketid,
                "type": type,
                "name": name,
                "namespace": namespace,
                "replicas": vm.replicas,
            };
            $http.post("/api/ci/v2/kubernetes/app/set/replicas", d  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.cancel();
                } else { 
                   swal({ title:'操作失败', text: data.info, type:'error' });
                }
            });
        };

        vm.assignment = function () {
            var postData = {
                "type": "kubernetes",
                "name": "修改Deployment副本数",
                "handler": clusterinfo.create_user,
                "url": "/api/ci/v2/kubernetes/app/set/replicas",
                "method": "POST",
                "submit_reason": "",
                "remarks": "\n集群ID:" + ticketid + ";\n集群名称:" + clusterinfo.name + ";\n命名空间:"+ namespace + ";\n类型:" + type + ";\n名称:" + name +";\n原副本数:" + replicas + "=> 新副本数:" + vm.replicas,
                "data": {
                    "ticketid": ticketid,
                    "type": type,
                    "name": name,
                    "namespace": namespace,
                    "replicas": vm.replicas,
                },
            };

            $uibModal.open({
                templateUrl: 'app/pages/assignment/assignmentcommit.html',
                controller: 'AssignmentCommitController',
                controllerAs: 'assignmentcommit',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    postData: function () {return postData},
                    homecancel: function () {return vm.cancel},
                }
            });
        };
    }
})();

(function() {
    'use strict';

    KubernetesSetImageController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "type", "name", "namespace", "image", "container", "clusterinfo"];
    angular
        .module('openc3')
        .controller('KubernetesSetImageController', KubernetesSetImageController);

    function KubernetesSetImageController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, type, name, namespace,image, container, clusterinfo ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.image = image;

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.setimage = function(){
            vm.loadover = false;
            var d = {
                "ticketid": ticketid,
                "type": type,
                "name": name,
                "namespace": namespace,
                "image": vm.image,
                "container": container,
            };
            $http.post("/api/ci/v2/kubernetes/app/set/image", d  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.cancel();
                } else { 
                    toastr.error("升级应用失败:" + data.info)
                }
            });
        };

        vm.assignment = function () {
            var postData = {
                "type": "kubernetes",
                "name": "修改Deployment镜像",
                "handler": clusterinfo.create_user,
                "url": "/api/ci/v2/kubernetes/app/set/image",
                "method": "POST",
                "submit_reason": "",
                "remarks": "\n集群ID:" + ticketid + ";\n集群名称:" + clusterinfo.name + ";\n命名空间:"+ namespace + ";\n类型:" + type + ";\n名称:" + name +";\n原镜像地址:" + image + ";\n新镜像地址:" + vm.image,
                "data": {
                    "ticketid": ticketid,
                    "type": type,
                    "name": name,
                    "namespace": namespace,
                    "image": vm.image,
                    "container": container,
                },
            };

            $uibModal.open({
                templateUrl: 'app/pages/assignment/assignmentcommit.html',
                controller: 'AssignmentCommitController',
                controllerAs: 'assignmentcommit',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    postData: function () {return postData},
                    homecancel: function () {return vm.cancel},
                }
            });
        };
    }
})();

(function() {
    'use strict';

    KubernetesSecretController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "clusterinfo", "namespace"];
    angular
        .module('openc3')
        .controller('KubernetesSecretController', KubernetesSecretController);

    function KubernetesSecretController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, clusterinfo, namespace ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.namespace = namespace;
        vm.clusterinfo = clusterinfo;

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.reload = function(){
            vm.loadover = false;
            $http.get("/api/ci/v2/kubernetes/secret?ticketid=" + ticketid + "&namespace=" + namespace ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.nodeTable = new ngTableParams({count:25}, {counts:[],data:data.data});
                } else { 
                    toastr.error("加载secret失败:" + data.info)
                }
            });
        };
        vm.reload();
 
        vm.deleteApp = function (type,name,namespace) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/deleteapp.html',
                controller: 'KubernetesDeleteAppController',
                controllerAs: 'kubernetesdeleteapp',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return ticketid},
                    clusterinfo: function () {return clusterinfo},
                }
            });
        };


        vm.describe = function (type,name,namespace) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/describe.html',
                controller: 'KubernetesDescribeController',
                controllerAs: 'kubernetesdescribe',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return clusterinfo.id},
                }
            });
        };

         vm.edityaml = function (type,name,namespace) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/edityaml.html',
                controller: 'KubernetesEditYamlController',
                controllerAs: 'kubernetesedityaml',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return clusterinfo.id},
                    clusterinfo: function () {return clusterinfo},
                }
            });
        };

        vm.createSecret = function (type,name,namespace) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/createsecret.html',
                controller: 'KubernetesCreateSecretController',
                controllerAs: 'kubernetescreatesecret',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return clusterinfo.id},
                    clusterinfo: function () {return clusterinfo},
                    reload: function () {return vm.reload},
                }
            });
        };

        vm.createSecretOpaque = function (namespace,name,type) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/createsecretopaque.html',
                controller: 'KubernetesCreateSecretOpaqueController',
                controllerAs: 'kubernetescreatesecretopaque',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    ticketid: function () {return clusterinfo.id},
                    clusterinfo: function () {return clusterinfo},
                    namespace: function () {return namespace},
                    name: function () {return name},
                    type: function () {return type},
                }
            });
        };

    }
})();

(function() {
    'use strict';

    KubernetesSearchIngressController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "clusterinfo"];
    angular
        .module('openc3')
        .controller('KubernetesSearchIngressController', KubernetesSearchIngressController);

    function KubernetesSearchIngressController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, clusterinfo ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.reload = function(){
            vm.loadover = false;
            $http.get("/api/ci/v2/kubernetes/app/ingress/dump" ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.nodeTable = new ngTableParams({count:25}, {counts:[],data:data.data});
                } else { 
                    toastr.error("加载ingress失败:" + data.info)
                }
            });
        };
        vm.reload();
 
        vm.describeingress = function (ticketid, type,name,namespace) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/describeingress.html',
                controller: 'KubernetesDescribeIngressController',
                controllerAs: 'kubernetesdescribeingress',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return ticketid},
                }
            });
        };

    }
})();

(function() {
    'use strict';

    KubernetesRollbackController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "type", "name", "namespace", "clusterinfo"];
    angular
        .module('openc3')
        .controller('KubernetesRollbackController', KubernetesRollbackController);

    function KubernetesRollbackController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, type, name, namespace, clusterinfo ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.version = '';

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });


        vm.rollback = function(version){
            vm.loadover = false;
            var d = {
                "ticketid": ticketid,
                "type": type,
                "name": name,
                "namespace": namespace,
                "version": version,
            };
            $http.post("/api/ci/v2/kubernetes/app/rollback", d  ).success(function(data){
                if(data.stat == true) 
                {
                    vm.loadover = true;
                    vm.cancel();
                } else {
                    toastr.error("回滚操作失败:" + data.info)
                }
            });
        };

        vm.reload = function(){
            vm.loadover = false;
            $http.get("/api/ci/v2/kubernetes/app/rollback?type=" + type + '&namespace=' + namespace + '&name=' + name +'&ticketid=' + ticketid ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.versionTable = new ngTableParams({count:10}, {counts:[],data:data.data});
                } else { 
                    toastr.error("加载回滚版本信息失败:" + data.info)
                }
            });
        };
        vm.reload();

        vm.assignment = function (version,image) {
            var postData = {
                "type": "kubernetes",
                "name": "修改Deployment镜像",
                "handler": clusterinfo.create_user,
                "url": "/api/ci/v2/kubernetes/app/rollback",
                "method": "POST",
                "submit_reason": "",
                "remarks": "\n集群ID:" + ticketid + ";\n集群名称:" + clusterinfo.name + ";\n命名空间:"+ namespace + ";\n类型:" + type + ";\n名称:" + name +";\n镜像地址:" + image + ";\n版本编号:" + version,
                "data": {
                    "ticketid": ticketid,
                    "type": type,
                    "name": name,
                    "namespace": namespace,
                    "version": version,
                },
            };

            $uibModal.open({
                templateUrl: 'app/pages/assignment/assignmentcommit.html',
                controller: 'AssignmentCommitController',
                controllerAs: 'assignmentcommit',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    postData: function () {return postData},
                    homecancel: function () {return vm.cancel},
                }
            });
        };
 
    }
})();

(function() {
    'use strict';

    KubernetesNodeController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "clusterinfo"];
    angular
        .module('openc3')
        .controller('KubernetesNodeController', KubernetesNodeController);

    function KubernetesNodeController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, clusterinfo ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.cordon = function(node,cordon){
            vm.loadover = false;
            var d = {
                "ticketid": ticketid,
                "cordon": cordon,
                "node": node,
            };
            $http.post("/api/ci/v2/kubernetes/node/cordon", d  ).success(function(data){
                if(data.stat == true) 
                {
                    vm.loadover = true;
                    vm.reload();
                } else {
                    toastr.error("操作失败:" + data.info)
                }
            });
        };

        vm.reload = function(){
            vm.loadover = false;
            $http.get("/api/ci/v2/kubernetes/node?ticketid=" + ticketid ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.nodeTable = new ngTableParams({count:10}, {counts:[],data:data.data});
                } else { 
                    toastr.error("加载集群节点信息失败:" + data.info)
                }
            });
        };
        vm.reload();
 
    }
})();

(function() {
    'use strict';

    KubernetesmanageController.$inject = ["$scope", "$state", "$http", "treeService", "ngTableParams", "$injector", "$timeout", "genericService", "$uibModal"];
    angular
        .module('openc3')
        .controller('KubernetesmanageController', KubernetesmanageController);

    function KubernetesmanageController($scope, $state, $http, treeService, ngTableParams, $injector, $timeout, genericService, $uibModal ) {

        var vm = this;
        var toastr = toastr || $injector.get('toastr');
        vm.treeid = $state.params.treeid;

        vm.selecteClusterId = $state.params.clusterid;
        vm.selecteCluster = {};
        if( vm.selecteClusterId == undefined )
        {
            vm.selecteClusterId = '0'
        }

        vm.selectednamespace = $state.params.namespace;
        if( vm.selectednamespace == undefined )
        {
            vm.selectednamespace = ''
        }

        vm.selectedStat = $state.params.stat;
        if( vm.selectedStat == undefined )
        {
            vm.selectedStat = ''
        }

        vm.namespace = [];

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.refreshPage = function (namespace, clusterid, stat ) {
            $state.go('home.kubernetesmanage', {treeid:vm.treeid, namespace: namespace, stat: stat, clusterid: clusterid});
        }

        $scope.choiceNamespace = vm.selectednamespace;
        $scope.choiceStat = vm.selectedStat;
        $scope.choiceClusterId = vm.selecteClusterId;

        $scope.$watch('choiceNamespace', function () {
                vm.refreshPage( $scope.choiceNamespace, $scope.choiceClusterId, $scope.choiceStat )
        });

        $scope.$watch('choiceStat', function () {
                vm.refreshPage( $scope.choiceNamespace, $scope.choiceClusterId, $scope.choiceStat )
        });

        $scope.$watch('choiceClusterId', function () {
                vm.refreshPage( $scope.choiceNamespace, $scope.choiceClusterId, $scope.choiceStat )
        });

        vm.deploymentCount = 0;
        vm.deploymentReady = 0;
        vm.daemonsetCount = 0;
        vm.serviceCount = 0;
        vm.podCount = 0;
        vm.replicasetCount = 0;
        vm.flowlineinfo = {};
 
        vm.loadoverA = false;
        vm.loadoverB = false;
        vm.loadoverC = false;
        vm.loadoverD = false;

        vm.reload = function () {

            vm.loadoverA = false;
            vm.loadoverB = false;
            vm.loadoverC = false;
            vm.loadoverD = false;
            $http.get('/api/ci/ticket/KubeConfig' ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.clusterlist = response.data.data; 
                        $scope.clusterCount = vm.clusterlist.length;

                        if( vm.selecteClusterId > 0 ){
                            angular.forEach(vm.clusterlist, function (value, key) {
                                if( value.id ==  vm.selecteClusterId )
                                {
                                    vm.selecteCluster = value;
                                }
                            });
                        }

                        vm.loadoverA = true;
                    }else {
                        toastr.error( "获取集群列表失败："+response.data.info );
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取集群列表失败: " + response.status )
                });

            if( vm.selecteClusterId <= 0 )
            {
                vm.loadoverB = true;
                vm.loadoverC = true;
                vm.loadoverD = true;
                return;
            }

            $http.get("/api/ci/v2/kubernetes/namespace?ticketid=" + vm.selecteClusterId ).then(
                function successCallback(response) {
                    if (response.data.stat){

                        vm.namespace = response.data.data; 
//TODO 需要更换loadoverC
                        vm.loadoverC = true;
                    }else {
                        toastr.error( "获取集群NAMESPACE数据失败："+response.data.info );
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取集群NAMESPACE数据失败: " + response.status )
                });
 

            $http.get("/api/ci/v2/kubernetes/hpa?ticketid=" + vm.selecteClusterId ).then(
                function successCallback(response) {
                    if (response.data.stat){

                        vm.hpa = response.data.data; 
                        vm.loadoverC = true;
                    }else {
                        toastr.error( "获取集群HPA数据失败："+response.data.info );
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取集群HPA数据失败: " + response.status )
                });
 
            $http.get("/api/ci/project/kubernetes/" + vm.selecteClusterId ).then(
                function successCallback(response) {
                    if (response.data.stat){

                        vm.flowlineinfo = response.data.data; 
                        vm.loadoverD = true;
                    }else {
                        toastr.error( "获取流水线数据失败："+response.data.info );
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取流水线数据失败: " + response.status )
                });
 
 

            $http.get("/api/ci/v2/kubernetes/app?ticketid=" + vm.selecteClusterId + "&namespace=" + vm.selectednamespace + "&status=" + vm.selectedStat ).then(
                function successCallback(response) {
                    if (response.data.stat){

                        vm.deploymentTable = new ngTableParams({count:10}, {counts:[],data:response.data.data.deployment});
                        vm.deploymentCount = response.data.data.deployment.length;
                        vm.deploymentReady = response.data.deploymentready;

                        vm.daemonsetTable = new ngTableParams({count:10}, {counts:[],data:response.data.data.daemonset});
                        vm.daemonsetReady = response.data.daemonsetready;
                        vm.daemonsetCount = response.data.data.daemonset.length;

                        vm.serviceTable = new ngTableParams({count:10}, {counts:[],data:response.data.data.service});
                        vm.serviceCount = response.data.data.service.length; 

                        vm.podTable = new ngTableParams({count:10}, {counts:[],data:response.data.data.pod});
                        vm.podReady = response.data.podready;
                        vm.podRunning = response.data.podrunning;
                        vm.podCount = response.data.data.pod.length;


                        vm.hpaTable = new ngTableParams({count:10}, {counts:[],data:response.data.data.hpa});
                        vm.hpaCount = response.data.data.hpa.length;

                        vm.replicasetTable = new ngTableParams({count:10}, {counts:[],data:response.data.data.replicaset});
                        vm.replicasetReady = response.data.replicasetready;
                        vm.replicasetCount = response.data.data.replicaset.length;


                        vm.jobbatchTable = new ngTableParams({count:10}, {counts:[],data:response.data.data['job.batch']});
                        if( response.data.data['job.batch'] )
                        {
                            vm.jobbatchCount = response.data.data['job.batch'].length;
                        }

                        vm.statefulsetTable = new ngTableParams({count:10}, {counts:[],data:response.data.data.statefulset});
                        if( response.data.data.statefulset )
                        {
                            vm.statefulsetCount = response.data.data.statefulset.length;
                        }

                        vm.loadoverB = true;
                    }else {
                        toastr.error( "获取集群中应用数据失败："+response.data.info );
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取集群中应用数据失败: " + response.status )
                });

            $http.get("/api/ci/v2/kubernetes/endpoint?ticketid=" + vm.selecteClusterId + "&namespace=" + vm.selectednamespace + "&status=" + vm.selectedStat ).then(
                function successCallback(response) {
                    if (response.data.stat){


                        vm.endpointTable = new ngTableParams({count:10}, {counts:[],data:response.data.data});
                        vm.endpointCount = response.data.data.length;
//TODO  添加新的loadoverX
                        vm.loadoverB = true;
                    }else {
                        toastr.error( "获取集群endpoint失败："+response.data.info );
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取集群endpoint失败: " + response.status )
                });


            $http.get("/api/ci/v2/kubernetes/ingress?ticketid=" + vm.selecteClusterId + "&namespace=" + vm.selectednamespace + "&status=" + vm.selectedStat ).then(
                function successCallback(response) {
                    if (response.data.stat){


                        vm.ingressTable = new ngTableParams({count:10}, {counts:[],data:response.data.data});
                        vm.ingressCount = response.data.data.length;
//TODO  添加新的loadoverX
                        vm.loadoverB = true;
                    }else {
                        toastr.error( "获取集群ingress失败："+response.data.info );
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取集群ingress失败: " + response.status )
                });


        };

        vm.reload();

        vm.edityaml = function (type,name,namespace) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/edityaml.html',
                controller: 'KubernetesEditYamlController',
                controllerAs: 'kubernetesedityaml',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return vm.selecteClusterId},
                    clusterinfo: function () {return vm.selecteCluster},
                }
            });
        };

        vm.apply = function () {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/apply.html',
                controller: 'KubernetesApplyController',
                controllerAs: 'kubernetesapply',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    ticketid: function () {return vm.selecteClusterId},
                    clusterinfo: function () {return vm.selecteCluster},
                }
            });
        };

        vm.createDeployment = function (namespace,name) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/createdeployment.html',
                controller: 'KubernetesCreateDeploymentController',
                controllerAs: 'kubernetescreatedeployment',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    ticketid: function () {return vm.selecteClusterId},
                    clusterinfo: function () {return vm.selecteCluster},
                    namespace: function () {return namespace},
                    name: function () {return name},
                    homereload: function () {return vm.reload},
                }
            });
        };

        vm.createIngress = function (namespace,name) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/createingress.html',
                controller: 'KubernetesCreateIngressController',
                controllerAs: 'kubernetescreateingress',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    ticketid: function () {return vm.selecteClusterId},
                    clusterinfo: function () {return vm.selecteCluster},
                    namespace: function () {return namespace},
                    name: function () {return name},
                }
            });
        };

        vm.createService = function (namespace,name) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/createservice.html',
                controller: 'KubernetesCreateServiceController',
                controllerAs: 'kubernetescreateservice',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    ticketid: function () {return vm.selecteClusterId},
                    clusterinfo: function () {return vm.selecteCluster},
                    namespace: function () {return namespace},
                    name: function () {return name},
                }
            });
        };

        vm.createConfigMap = function (namespace,name) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/createconfigmap.html',
                controller: 'KubernetesCreateConfigMapController',
                controllerAs: 'kubernetescreateconfigmap',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    ticketid: function () {return vm.selecteClusterId},
                    clusterinfo: function () {return vm.selecteCluster},
                    namespace: function () {return namespace},
                    name: function () {return name},
                }
            });
        };

 
        vm.createDaemonSet = function (namespace,name) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/createdaemonset.html',
                controller: 'KubernetesCreateDaemonSetController',
                controllerAs: 'kubernetescreatedaemonset',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    ticketid: function () {return vm.selecteClusterId},
                    clusterinfo: function () {return vm.selecteCluster},
                    namespace: function () {return namespace},
                    name: function () {return name},
                }
            });
        };


        vm.describe = function (type,name,namespace) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/describe.html',
                controller: 'KubernetesDescribeController',
                controllerAs: 'kubernetesdescribe',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return vm.selecteClusterId},
                }
            });
        };

        vm.describedeployment = function (type,name,namespace) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/describedeployment.html',
                controller: 'KubernetesDescribeDeploymentController',
                controllerAs: 'kubernetesdescribedeployment',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return vm.selecteClusterId},
                }
            });
        };

        vm.describeingress = function (type,name,namespace) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/describeingress.html',
                controller: 'KubernetesDescribeIngressController',
                controllerAs: 'kubernetesdescribeingress',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return vm.selecteClusterId},
                }
            });
        };

        vm.describeservice = function (type,name,namespace) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/describeservice.html',
                controller: 'KubernetesDescribeServiceController',
                controllerAs: 'kubernetesdescribeservice',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return vm.selecteClusterId},
                }
            });
        };

        vm.setimage = function (type,name,namespace,image,container) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/setimage.html',
                controller: 'KubernetesSetImageController',
                controllerAs: 'kubernetessetimage',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    image: function () {return image},
                    container: function () {return container},
                    namespace: function () {return namespace},
                    ticketid: function () {return vm.selecteClusterId},
                    clusterinfo: function () {return vm.selecteCluster},
                }
            });
        };

        vm.rollback = function (type,name,namespace,image,container) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/rollback.html',
                controller: 'KubernetesRollbackController',
                controllerAs: 'kubernetesrollback',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return vm.selecteClusterId},
                    clusterinfo: function () {return vm.selecteCluster},
                }
            });
        };

        vm.setreplicas = function (type,name,namespace,replicas) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/setreplicas.html',
                controller: 'KubernetesSetReplicasController',
                controllerAs: 'kubernetessetreplicas',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    replicas: function () {return replicas},
                    namespace: function () {return namespace},
                    ticketid: function () {return vm.selecteClusterId},
                    clusterinfo: function () {return vm.selecteCluster},
                }
            });
        };

        vm.deleteApp = function (type,name,namespace) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/deleteapp.html',
                controller: 'KubernetesDeleteAppController',
                controllerAs: 'kubernetesdeleteapp',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return vm.selecteClusterId},
                    clusterinfo: function () {return vm.selecteCluster},
                }
            });
        };

        vm.createHpa = function (type,name,namespace) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/createhpa.html',
                controller: 'KubernetesCreateHpaController',
                controllerAs: 'kubernetescreatehpa',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return vm.selecteClusterId},
                    clusterinfo: function () {return vm.selecteCluster},
                }
            });
        };

        vm.createSecret = function (type,name,namespace) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/createsecret.html',
                controller: 'KubernetesCreateSecretController',
                controllerAs: 'kubernetescreatesecret',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return vm.selecteClusterId},
                    clusterinfo: function () {return vm.selecteCluster},
                }
            });
        };

        vm.addCluster = function () {
            $uibModal.open({
                templateUrl: 'app/pages/global/ticket/createTicket.html',
                controller: 'CreateTicketController',
                controllerAs: 'createticket',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    ticketid: function () {},
                    homereload: function () { return vm.reload },
                    type: function () { return 'create' },
                    title: function () { return '添加kubernetes集群' },
                    point: function () { return 'KubeConfig' },
                }
            });

        };

        vm.editCluster = function () {
            if( vm.selecteCluster.auth !== 'X' )
            {
                swal({ title:'没有权限', text: "您没有权限编辑该集群配置", type:'error' });
                return;
            }
            $uibModal.open({
                templateUrl: 'app/pages/global/ticket/createTicket.html',
                controller: 'CreateTicketController',
                controllerAs: 'createticket',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    ticketid: function () { return vm.selecteClusterId },
                    homereload: function () { return vm.reload },
                    type: function () { return 'edit' },
                    title: function () { return '编辑kubernetes集群' },
                    point: function () { return 'KubeConfig' },
                }
            });

        };


        vm.connectiontest = function(){
//TODO 处理loading
            vm.loading = true
            $http.post('/api/ci/v2/kubernetes/cluster/connectiontest/' + vm.selecteClusterId , {}, { timeout: 120000 } ).then(
                function successCallback(response) {
                    vm.loading = false
                    if (response.data.stat){
                        swal({ title:'连接成功', text: response.data.info, type:'success' });
                    }else {
                        swal({ title:'连接失败', text: response.data.info, type:'error' });
                    }
                },

                function errorCallback (response){
                    vm.loading = false
                }
            );
        };

        vm.node = function () {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/node.html',
                controller: 'KubernetesNodeController',
                controllerAs: 'kubernetesnode',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    ticketid: function () {return vm.selecteClusterId},
                    clusterinfo: function () {return vm.selecteCluster},
                }
            });
        };

 
        vm.secret = function () {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/secret.html',
                controller: 'KubernetesSecretController',
                controllerAs: 'kubernetessecret',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    ticketid: function () {return vm.selecteClusterId},
                    clusterinfo: function () {return vm.selecteCluster},
                    namespace: function () { return vm.selectednamespace},
                }
            });
        };

        vm.searchingress = function () {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/searchingress.html',
                controller: 'KubernetesSearchIngressController',
                controllerAs: 'kubernetessearchingress',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    ticketid: function () {return vm.selecteClusterId},
                    clusterinfo: function () {return vm.selecteCluster},
                }
            });
        };

 
        vm.configMap = function () {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/configmap.html',
                controller: 'KubernetesConfigMapController',
                controllerAs: 'kubernetesconfigmap',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    ticketid: function () {return vm.selecteClusterId},
                    clusterinfo: function () {return vm.selecteCluster},
                    namespace: function () { return vm.selectednamespace},
                }
            });
        };

 
//TODO 清理vm.skip
//TODO 处理CopyProjectByTemplateXXController，和CopyProjectByTemplateController同名引起流水线中通过模版创建报错
        vm.skip = function() {};
        vm.copyProjectByTemplate = function (sourcename, type, name, namespace ) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/copyProjectByTemplate.html',
                controller: 'CopyProjectByTemplateXXController',
                controllerAs: 'copyProjectByTemplate',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () { return vm.treeid},
                    sourcename: function () { return sourcename},
                    reload : function () { return vm.reload},
                    cancel : function () { return vm.skip},
                    clusterinfo: function () {return vm.selecteCluster},
                    type: function () { return type},
                    name: function () { return name},
                    namespace: function () { return namespace},
                }
            });
        };

        vm.editconfig = function (treeid, id, name) {
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/flowline/detail/config.html',
                controller: 'ConfigController',
                controllerAs: 'config',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    getGroup: function () {return vm.getGroupInfo},
                    projectid: function () {return id},
                    treeid: function () {return treeid},
                    name: function () {return name},
                    groupid: function () {},
                }
            });
        };


        vm.deleteProject = function(treeid,id) {
          swal({
            title: "是否要删除该流水线",
            text: "删除后不能恢复",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){
            $http.delete('/api/job/jobs/' + treeid + '/_ci_' + id +'_/byname' ).success(function(data){
                if( ! data.stat ){ toastr.error("删除作业配置失败:" + date.info)}
                $http.delete( '/api/ci/project/' + treeid+'/'+ id ).success(function(data){
                    if( ! data.stat ){ toastr.error("删除持续构建配置失败:" + date.info)}
                    $http.delete( '/api/jobx/group/' + treeid + '/_ci_test_' + id +'_/byname'  ).success(function(data){
                        if( ! data.stat ){ toastr.error("删除测试分批组失败:" + date.info)}
                        $http.delete( '/api/jobx/group/' + treeid + '/_ci_online_' + id +'_/byname'  ).success(function(data){
                            if( ! data.stat ){ toastr.error("删除线上分批组失败:" + date.info)}
                            vm.reload();
                        });
                    });
                });
            });
          });
        }

        vm.addNamespace = function () {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/createnamespace.html',
                controller: 'KubernetesCreateNamespaceController',
                controllerAs: 'kubernetescreatenamespace',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    ticketid: function () {return vm.selecteClusterId},
                    clusterinfo: function () {return vm.selecteCluster},
                    homereload: function () {return vm.reload},
                }
            });
        };

        vm.openOneTab = function (pod, type) {
            var terminalAddr = window.location.protocol + "//" + window.location.host+"/api/ci/kubernetes/pod/shell";
            var s = "?namespace=" + pod.NAMESPACE + '&name=' + pod.NAME + '&clusterid=' + vm.selecteClusterId + '&type=' + type + '&siteaddr=' + window.location.protocol + "//" + window.location.host;
            window.open(terminalAddr+s, '_blank')
        };

        vm.gotoflowline = function (treeid, projectid) {
            $state.go('home.quickentry.flowlinedetail', {treeid:treeid, projectid: projectid});
        };

    }

})();

(function() {
    'use strict';

    KubernetesHarborImageController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "homereload"];
    angular
        .module('openc3')
        .controller('KubernetesHarborImageController', KubernetesHarborImageController);

    function KubernetesHarborImageController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, homereload ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.tickethas = ticketid;
        vm.ticketid = ticketid;
        vm.tickets = [];
        vm.reload = function(){
            if( vm.ticketid !== "" )
            {
                vm.loadover = false;
                $http.get("/api/ci/v2/kubernetes/harbor/repository?ticketid=" + vm.ticketid ).success(function(data){
                    if(data.stat == true) 
                    { 
                        vm.loadover = true;
                        vm.nodeTable = new ngTableParams({count:25}, {counts:[],data:data.data});
                    } else { 
                        toastr.error("加载secret信息失败:" + data.info)
                    }
               });
            }else
            {
                vm.loadover = false;
                $http.get("/api/ci/ticket?type=Harbor" ).success(function(data){
                    if(data.stat == true) 
                    { 
                        vm.loadover = true;
                        vm.tickets = data.data;
                    } else { 
                        toastr.error("加载ticket信息失败:" + data.info)
                    }
               });
            }
        };
        vm.reload();
 
        vm.selectRepo = function (repo) {
            homereload(repo);
            vm.cancel();
        };

    }
})();

(function() {
    'use strict';

    KubernetesEditYamlController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "type", "name", "namespace", "clusterinfo"];
    angular
        .module('openc3')
        .controller('KubernetesEditYamlController', KubernetesEditYamlController);

    function KubernetesEditYamlController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, type, name, namespace,clusterinfo ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.reload = function(){
            vm.loadover = false;
            $http.get("/api/ci/v2/kubernetes/app/yaml?ticketid=" + ticketid + '&type=' + type + '&name=' + name + '&namespace=' + namespace  ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.oldyaml = data.data;
                    vm.newyaml = data.data;
                    vm.diff();

                   vm.loadover = true;
                } else { 
                    toastr.error("加载配置失败:" + data.info)
                }
            });
        };

        vm.reload();

        vm.apply = function(){
            vm.loadover = false;
            var d = {
                "ticketid": ticketid,
                "type": type,
                "name": name,
                "namespace": namespace,
                "yaml": vm.newyaml,
            };
            $http.post("/api/ci/v2/kubernetes/app/apply", d  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.cancel();
                } else { 
                    toastr.error("更新配置失败:" + data.info)
                }
            });
        };

        vm.assignment = function () {
            var postData = {
                "type": "kubernetes",
                "name": "修改Deployment配置",
                "handler": clusterinfo.create_user,
                "url": "/api/ci/v2/kubernetes/app/apply",
                "method": "POST",
                "submit_reason": "",
                "remarks": "\n集群ID:" + ticketid + ";\n集群名称:" + clusterinfo.name + ";\n命名空间:"+ namespace + ";\n类型:" + type + ";\n名称:" + name +";\n新配置:\n" + vm.newyaml,
                "data": {
                    "ticketid": ticketid,
                    "type": type,
                    "name": name,
                    "namespace": namespace,
                    "yaml": vm.newyaml,
                },
            };

            $uibModal.open({
                templateUrl: 'app/pages/assignment/assignmentcommit.html',
                controller: 'AssignmentCommitController',
                controllerAs: 'assignmentcommit',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    postData: function () {return postData},
                    homecancel: function () {return vm.cancel},
                }
            });
        };

        vm.oldyaml = "";
        vm.newyaml = "";

        vm.diffresultstring = "";
        vm.diff = function()
        {
            var diffresultstring = document.getElementById('diffresultstring');
            //三种diff类型，字符、单词、行 ，分别对应下面参数：diffChars  diffWords diffLines
            var diff = JsDiff["diffLines"](vm.oldyaml, vm.newyaml);

            var fragment = document.createDocumentFragment();
            for (var i=0; i < diff.length; i++) {

                if (diff[i].added && diff[i + 1] && diff[i + 1].removed) {
                    var swap = diff[i];
                    diff[i] = diff[i + 1];
                    diff[i + 1] = swap;
                }

                var node;
                if (diff[i].removed) {
                    node = document.createElement('del');
                    node.appendChild(document.createTextNode(diff[i].value));
                } else if (diff[i].added) {
                    node = document.createElement('ins');
                    node.appendChild(document.createTextNode(diff[i].value));
                } else {
                    node = document.createTextNode(diff[i].value);
                }
                fragment.appendChild(node);
            }

            diffresultstring.textContent = '';
            diffresultstring.appendChild(fragment);
        };
    }
})();

(function() {
    'use strict';

    KubernetesDescribeServiceController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "type", "name", "namespace"];
    angular
        .module('openc3')
        .controller('KubernetesDescribeServiceController', KubernetesDescribeServiceController);

    function KubernetesDescribeServiceController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, type, name, namespace ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.reload = function(){
            vm.loadover = false;
            $http.get("/api/ci/v2/kubernetes/app/describe/service?ticketid=" + ticketid + '&type=' + type + '&name=' + name + '&namespace=' + namespace  ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.describe = data.data.describe;
                    vm.deploymentTable = new ngTableParams({count:10}, {counts:[],data:data.data.table.deployment});
                    vm.replicasetTable = new ngTableParams({count:10}, {counts:[],data:data.data.table.replicaset});
                    vm.podTable = new ngTableParams({count:10}, {counts:[],data:data.data.table.pod});
                    vm.loadover = true;
                } else { 
                    toastr.error("加载失败:" + data.info)
                }
            });
        };

        vm.reload();
        vm.describexx = function (type,name) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/describe.html',
                controller: 'KubernetesDescribeController',
                controllerAs: 'kubernetesdescribe',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return ticketid},
                }
            });
        };

        vm.describexxdeployment = function (type,name) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/describedeployment.html',
                controller: 'KubernetesDescribeDeploymentController',
                controllerAs: 'kubernetesdescribedeployment',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return ticketid},
                }
            });
        };

        vm.openOneTab = function (pod, type) {
            var terminalAddr = window.location.protocol + "//" + window.location.host+"/api/ci/kubernetes/pod/shell";
            var s = "?namespace=" + namespace + '&name=' + pod.NAME + '&clusterid=' + ticketid + '&type=' + type + '&siteaddr=' + window.location.protocol + "//" + window.location.host;
            window.open(terminalAddr+s, '_blank')
        };

    }
})();

(function() {
    'use strict';

    KubernetesDescribeIngressController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "type", "name", "namespace"];
    angular
        .module('openc3')
        .controller('KubernetesDescribeIngressController', KubernetesDescribeIngressController);

    function KubernetesDescribeIngressController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, type, name, namespace ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.reload = function(){
            vm.loadover = false;
            $http.get("/api/ci/v2/kubernetes/app/describe/ingress?ticketid=" + ticketid + '&type=' + type + '&name=' + name + '&namespace=' + namespace  ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.describe = data.data.describe;
                    vm.serviceTable = new ngTableParams({count:10}, {counts:[],data:data.data.service});
                    vm.loadover = true;
                } else { 
                    toastr.error("加载失败:" + data.info)
                }
            });
        };

        vm.reload();
        vm.describexx = function (type,name) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/describe.html',
                controller: 'KubernetesDescribeController',
                controllerAs: 'kubernetesdescribe',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return ticketid},
                }
            });
        };

        vm.describexxservice = function (type,name) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/describeservice.html',
                controller: 'KubernetesDescribeServiceController',
                controllerAs: 'kubernetesdescribeservice',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return ticketid},
                }
            });
        };

        vm.openOneTab = function (pod, type) {
            var terminalAddr = window.location.protocol + "//" + window.location.host+"/api/ci/kubernetes/pod/shell";
            var s = "?namespace=" + namespace + '&name=' + pod.NAME + '&clusterid=' + ticketid + '&type=' + type + '&siteaddr=' + window.location.protocol + "//" + window.location.host;
            window.open(terminalAddr+s, '_blank')
        };
    }
})();

(function() {
    'use strict';

    KubernetesDescribeDeploymentController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "type", "name", "namespace"];
    angular
        .module('openc3')
        .controller('KubernetesDescribeDeploymentController', KubernetesDescribeDeploymentController);

    function KubernetesDescribeDeploymentController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, type, name, namespace ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.reload = function(){
            vm.loadover = false;
            $http.get("/api/ci/v2/kubernetes/app/describe/deployment?ticketid=" + ticketid + '&type=' + type + '&name=' + name + '&namespace=' + namespace  ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.describe = data.data.describe;
                    vm.oldpodTable = new ngTableParams({count:10}, {counts:[],data:data.data.oldpod});
                    vm.newpodTable = new ngTableParams({count:10}, {counts:[],data:data.data.newpod});
                    vm.loadover = true;
                } else { 
                    toastr.error("加载失败:" + data.info)
                }
            });
        };

        vm.reload();
        vm.describexx = function (type,name) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/describe.html',
                controller: 'KubernetesDescribeController',
                controllerAs: 'kubernetesdescribe',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return ticketid},
                }
            });
        };

        vm.openOneTab = function (pod, type) {
            var terminalAddr = window.location.protocol + "//" + window.location.host+"/api/ci/kubernetes/pod/shell";
            var s = "?namespace=" + namespace + '&name=' + pod.NAME + '&clusterid=' + ticketid + '&type=' + type + '&siteaddr=' + window.location.protocol + "//" + window.location.host;
            window.open(terminalAddr+s, '_blank')
        };
    }
})();

(function() {
    'use strict';

    KubernetesDescribeController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "type", "name", "namespace"];
    angular
        .module('openc3')
        .controller('KubernetesDescribeController', KubernetesDescribeController);

    function KubernetesDescribeController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, type, name, namespace ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.reload = function(){
            vm.loadover = false;
            $http.get("/api/ci/v2/kubernetes/app/describe?ticketid=" + ticketid + '&type=' + type + '&name=' + name + '&namespace=' + namespace  ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.describe = data.data;
                    vm.loadover = true;
                } else { 
                    toastr.error("加载失败:" + data.info)
                }
            });
        };

        vm.reload();

     
    }
})();

(function() {
    'use strict';

    KubernetesDeleteAppController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "type", "name", "namespace", "clusterinfo"];
    angular
        .module('openc3')
        .controller('KubernetesDeleteAppController', KubernetesDeleteAppController);

    function KubernetesDeleteAppController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, type, name, namespace, clusterinfo ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.deletename = '';
        vm.name = name;
        vm.type = type;

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.deleteapp = function(){
            vm.loadover = false;
            var d = {
                "ticketid": ticketid,
                "type": type,
                "name": name,
                "namespace": namespace,
            };

            if( vm.deletename !== name )
            {
                swal({ title:'操作失败', text: "输入的名称不匹配", type:'error' });
                return;
            }

            $http.post("/api/ci/v2/kubernetes/app/delete", d  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.cancel();
                } else { 
                   swal({ title:'操作失败', text: data.info, type:'error' });
                }
            });
        };

        vm.assignment = function () {
            var postData = {
                "type": "kubernetes",
                "name": "删除Deployment",
                "handler": clusterinfo.create_user,
                "url": "/api/ci/v2/kubernetes/app/delete",
                "method": "POST",
                "submit_reason": "",
                "remarks": "\n集群ID:" + ticketid + ";\n集群名称:" + clusterinfo.name + ";\n命名空间:"+ namespace + ";\n类型:" + type + ";\n名称:" + name,
                "data": {
                    "ticketid": ticketid,
                    "type": type,
                    "name": name,
                    "namespace": namespace,
                },
            };

            $uibModal.open({
                templateUrl: 'app/pages/assignment/assignmentcommit.html',
                controller: 'AssignmentCommitController',
                controllerAs: 'assignmentcommit',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    postData: function () {return postData},
                    homecancel: function () {return vm.cancel},
                }
            });
        };

    }
})();

(function() {
    'use strict';

    KubernetesCreateServiceController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "clusterinfo", "namespace", "name"];
    angular
        .module('openc3')
        .controller('KubernetesCreateServiceController', KubernetesCreateServiceController);

    function KubernetesCreateServiceController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, clusterinfo, namespace, name ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        $scope.editstep = 1;

        vm.tasktype = 'create';
        if( namespace && name )
        {
            vm.tasktype = 'apply';
        }

        vm.reload = function(){
            vm.loadover = false;

            var url = "/api/ci/kubernetes/data/template/service";

            if( vm.tasktype == 'apply' )
            {
                url = "/api/ci/v2/kubernetes/app/json?ticketid=" + ticketid + "&type=service&name=" + name + "&namespace=" + namespace;
            }

            $http.get(url).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.editData = data.data;

                   $scope.labels = [];
                   if( vm.editData.metadata.labels )
                   {
                       angular.forEach(vm.editData.metadata.labels, function (v, k) {
                           $scope.labels.push( { "K": k, "V": v })
                       });
                   }

                   $scope.annotations = [];
                   if( vm.editData.metadata.annotations )
                   {
                       angular.forEach(vm.editData.metadata.annotations, function (v, k) {
                           $scope.annotations.push( { "K": k, "V": v })
                       });
                   }

                   $scope.selector = [];
                   if( vm.editData.spec.selector )
                   {
                       angular.forEach(vm.editData.spec.selector, function (v, k) {
                           $scope.selector.push( { "K": k, "V": v })
                       });
                   }
 
                } else { 
                    toastr.error("加载模版信息失败:" + data.info)
                }
            });

            $http.get("/api/ci/kubernetes/data/template/service_lb_annotations" ).success(function(data){
                if(data.stat == true) 
                { 
                     vm.service_lb_annotations = data.data;
                } else { 
                    toastr.error("加载service_lb_annotations模版信息失败:" + data.info)
                }
            });

            if( vm.tasktype == 'create' )
            {
                $http.get("/api/ci/v2/kubernetes/namespace?ticketid=" + ticketid ).then(
                    function successCallback(response) {
                        if (response.data.stat){
                            vm.namespaces = response.data.data; 
                        }else {
                            toastr.error( "获取集群NAMESPACE数据失败："+response.data.info );
                        }
                    },
                    function errorCallback (response){
                        toastr.error( "获取集群NAMESPACE数据失败: " + response.status )
                    });
            }
 
        };
        vm.reload();

        vm.gotostep0 = function(){
            $scope.editstep = 0; 
        };

        vm.gotostep1 = function(){
            vm.loadover = false;

            var d = {
                "data": vm.newyaml,
            };
            $http.post("/api/ci/kubernetes/data/yaml2json", d  ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.editData = data.data

                    $scope.labels = [];
                    if( vm.editData.metadata.labels )
                    {
                        angular.forEach(vm.editData.metadata.labels, function (v, k) {
                            $scope.labels.push( { "K": k, "V": v })
                        });
                    }

                    $scope.annotations = [];
                    if( vm.editData.metadata.annotations )
                    {
                        angular.forEach(vm.editData.metadata.annotations, function (v, k) {
                            $scope.annotations.push( { "K": k, "V": v })
                        });
                    }

                    $scope.selector = [];
                    if( vm.editData.spec.selector )
                    {
                        angular.forEach(vm.editData.spec.selector, function (v, k) {
                            $scope.selector.push( { "K": k, "V": v })
                        });
                    }

                     vm.loadover = true;
                     $scope.editstep = 1; 
                } else { 
                    swal({ title:'YAML格式转换失败', text: data.info, type:'error' });
                }
            });

        };

        vm.gotostep2 = function(){
//labels
            var labels = {};
            angular.forEach($scope.labels, function (v, k) {
                var key = v["K"]
                labels[key] = v["V"];
            });

            if( Object.keys(labels).length > 0 )
            {
                vm.editData.metadata.labels = labels;
            }
            else
            {
                delete vm.editData.metadata.labels;
            }

//annotations
            var annotations = {};
            angular.forEach($scope.annotations, function (v, k) {
                var key = v["K"]
                annotations[key] = v["V"];
            });

            if( Object.keys(annotations).length > 0 )
            {
                vm.editData.metadata.annotations = annotations;
            }
            else
            {
                delete vm.editData.metadata.annotations;
            }

//selector
            var selector = {};
            angular.forEach($scope.selector, function (v, k) {
                var key = v["K"]
                selector[key] = v["V"];
            });


            if( Object.keys(selector).length > 0 )
            {
                vm.editData.spec.selector = selector;
            }
            else
            {
                swal({ title:'错误', text: "selector不允许空", type:'error' });
                return;
            }

            if( !( vm.editData.metadata.namespace && vm.editData.metadata.name ) )
            {

                swal({ title:'错误', text: "Namespace和Name不齐全", type:'error' });
                return;
            }

            if( vm.editData.kind !== 'Service' )
            {

                swal({ title:'错误', text: "kind不正确，必须为Service", type:'error' });
                return;
            }

            $scope.editstep = 2; 

            vm.loadover = false;
            var d = {
                "data": vm.editData,
            };
            $http.post("/api/ci/kubernetes/data/json2yaml", d  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.newyaml = data.data

                   $http.get("/api/ci/v2/kubernetes/app/yaml/always?ticketid=" + ticketid + "&type=" + vm.editData.kind + "&name=" + vm.editData.metadata.name + "&namespace=" + vm.editData.metadata.namespace ).success(function(data){
                        if(data.stat == true) 
                        { 
                           vm.oldyaml = data.data;
                           vm.diff();
                           vm.loadover = true;
                        } else { 
                            toastr.error("获取最新的配置信息失败:" + data.info)
                        }
                    });

                } else { 
                   swal({ title:'提交失败', text: data.info, type:'error' });
                }
            });

        };


        $scope.labels = [];

        vm.addLabel = function()
        {
            $scope.labels.push({ "K": "", "V": ""});
        }
        vm.delLabel = function(id)
        {
            $scope.labels.splice(id, 1);
        }


        $scope.annotations = [];

        vm.addAnnotations = function()
        {
            $scope.annotations.push({ "K": "", "V": ""});
        }
        vm.delAnnotations = function(id)
        {
            $scope.annotations.splice(id, 1);
        }


        $scope.selector = [];

        vm.addSelector = function()
        {
            $scope.selector.push({ "K": "", "V": ""});
        }
        vm.delSelector = function(id)
        {
            $scope.selector.splice(id, 1);
        }

//
        vm.addAnnotationsByType = function(type)
        {
            var all_service_lb_annotations_key = {};
            angular.forEach(vm.service_lb_annotations, function (v, k) {

                angular.forEach(v, function (v, k) {
                    all_service_lb_annotations_key[k] = 1
                });
 
            });
 

            var annotations_temp = [];
            angular.forEach($scope.annotations, function (v, k) {
                if( ! all_service_lb_annotations_key[v.K] )
                {
                    annotations_temp.push(v)
                }
            });
 
            $scope.annotations = annotations_temp;
 
            angular.forEach(vm.service_lb_annotations[type], function (v, k) {
                $scope.annotations.push({"K": k,"V":v})
            });
        }
//

        vm.addPorts = function()
        {
            vm.editData.spec.ports.push( angular.copy({"name": "", "port": 80, "targetPort":80, "protocol":"TCP"}));
        }
 
        vm.delPorts = function(id)
        {
            vm.editData.spec.ports.splice(id, 1);
        }


        vm.apply = function(){
            vm.loadover = false;
            var d = {
                "ticketid": ticketid,
                "yaml": vm.newyaml,
            };
            $http.post("/api/ci/v2/kubernetes/app/" + vm.tasktype, d  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.cancel();
                   swal({ title:'提交成功', text: data.info, type:'success' });
                } else { 
                   swal({ title:'提交失败', text: data.info, type:'error' });
                }
            });
        };

        vm.assignment = function () {
            var postData = {
                "type": "kubernetes",
                "name": "kubernetes service " + vm.tasktype,
                "handler": clusterinfo.create_user,
                "url": "/api/ci/v2/kubernetes/app/" + vm.tasktype,
                "method": "POST",
                "submit_reason": "",
                "remarks": "\n集群ID:" + ticketid + ";\n集群名称:" + clusterinfo.name +";\n配置:\n" + vm.newyaml,
                "data": {
                    "ticketid": ticketid,
                    "yaml": vm.newyaml,
                },
            };

            $uibModal.open({
                templateUrl: 'app/pages/assignment/assignmentcommit.html',
                controller: 'AssignmentCommitController',
                controllerAs: 'assignmentcommit',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    postData: function () {return postData},
                    homecancel: function () {return vm.cancel},
                }
            });
        };

        vm.oldyaml = "";
        vm.newyaml = "";

        vm.diffresultstring = "";
        vm.diff = function()
        {
            var diffresultstring = document.getElementById('diffresultstring');
            //三种diff类型，字符、单词、行 ，分别对应下面参数：diffChars  diffWords diffLines
            var diff = JsDiff["diffLines"](vm.oldyaml, vm.newyaml);

            var fragment = document.createDocumentFragment();
            for (var i=0; i < diff.length; i++) {

                if (diff[i].added && diff[i + 1] && diff[i + 1].removed) {
                    var swap = diff[i];
                    diff[i] = diff[i + 1];
                    diff[i + 1] = swap;
                }

                var node;
                if (diff[i].removed) {
                    node = document.createElement('del');
                    node.appendChild(document.createTextNode(diff[i].value));
                } else if (diff[i].added) {
                    node = document.createElement('ins');
                    node.appendChild(document.createTextNode(diff[i].value));
                } else {
                    node = document.createTextNode(diff[i].value);
                }
                fragment.appendChild(node);
            }

            diffresultstring.textContent = '';
            diffresultstring.appendChild(fragment);
        };

    }
})();

(function() {
    'use strict';

    KubernetesCreateSecretOpaqueController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "clusterinfo", "namespace", "name", "type"];
    angular
        .module('openc3')
        .controller('KubernetesCreateSecretOpaqueController', KubernetesCreateSecretOpaqueController);

    function KubernetesCreateSecretOpaqueController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, clusterinfo, namespace, name, type ) {

        var vm = this;
        vm.type = type;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        $scope.editstep = 1;
       
        vm.tasktype = 'create';
        if( namespace && name )
        {
            vm.tasktype = 'apply';
        }

        vm.reload = function(){
            vm.loadover = false;

            var templatetype = "null";

            if( type == 'kubernetes.io/service-account-token' )
            {
                templatetype = 'secrettoken';
            }

            if( type == 'Opaque' )
            {
                templatetype = 'secretopaque';
            }

            if( type == 'IngressTLS' )
            {
                templatetype = 'secretingresstls';
            }

            var url = "/api/ci/kubernetes/data/template/" + templatetype;

            if( vm.tasktype == 'apply' )
            {
                url = "/api/ci/v2/kubernetes/app/json?ticketid=" + ticketid + "&type=secret&name=" + name + "&namespace=" + namespace;
            }

            $http.get(url).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.editData = data.data;

                   $scope.labels = [];
                   if( vm.editData.metadata.labels )
                   {
                       angular.forEach(vm.editData.metadata.labels, function (v, k) {
                           $scope.labels.push( { "K": k, "V": v })
                       });
                   }


                   $scope.annotations = [];
                   if( vm.editData.metadata.annotations )
                   {
                       angular.forEach(vm.editData.metadata.annotations, function (v, k) {
                           $scope.annotations.push( { "K": k, "V": v })
                       });
                   }

                   $scope.database64 = [];
                   if( vm.editData.data )
                   {
                       angular.forEach(vm.editData.data, function (v, k) {
                           $scope.database64.push( { "K": k, "V": window.atob(v) })
                       });
                   }
 
                } else { 
                    swal({ title:'加载模版信息失败', text: data.info, type:'error' });
                    vm.cancel();
                }
            });

            if( vm.tasktype == 'create' )
            {
                $http.get("/api/ci/v2/kubernetes/namespace?ticketid=" + ticketid ).then(
                    function successCallback(response) {
                        if (response.data.stat){
                            vm.namespaces = response.data.data; 
                        }else {
                            toastr.error( "获取集群NAMESPACE数据失败："+response.data.info );
                        }
                    },
                    function errorCallback (response){
                        toastr.error( "获取集群NAMESPACE数据失败: " + response.status )
                    });
 
            }
        };
        vm.reload();

        vm.gotostep0 = function(){
            $scope.editstep = 0; 
        };

        vm.gotostep1 = function(){
            vm.loadover = false;

            var d = {
                "data": vm.newyaml,
            };
            $http.post("/api/ci/kubernetes/data/yaml2json", d  ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.editData = data.data

                    $scope.labels = [];
                    if( vm.editData.metadata.labels )
                    {
                        angular.forEach(vm.editData.metadata.labels, function (v, k) {
                            $scope.labels.push( { "K": k, "V": v })
                        });
                    }

                    $scope.annotations = [];
                    if( vm.editData.metadata.annotations )
                    {
                        angular.forEach(vm.editData.metadata.annotations, function (v, k) {
                            $scope.annotations.push( { "K": k, "V": v })
                        });
                    }

                    $scope.database64 = [];
                    if( vm.editData.data )
                    {
                        angular.forEach(vm.editData.data, function (v, k) {
                            $scope.database64.push( { "K": k, "V": window.atob(v) })
                        });
                    }

                    vm.loadover = true;
                    $scope.editstep = 1; 
                } else { 
                   swal({ title:'YAML格式转换失败', text: data.info, type:'error' });
                }
            });
        };

        vm.gotostep2 = function(){
//labels
            var labels = {};
            angular.forEach($scope.labels, function (v, k) {
                var key = v["K"]
                labels[key] = v["V"];
            });

            if( Object.keys(labels).length > 0 )
            {
                vm.editData.metadata.labels = labels;
            }
            else
            {
                delete vm.editData.metadata.labels;
            }

//annotations
            var annotations = {};
            angular.forEach($scope.annotations, function (v, k) {
                var key = v["K"]
                annotations[key] = v["V"];
            });

            if( Object.keys(annotations).length > 0 )
            {
                vm.editData.metadata.annotations = annotations;
            }
            else
            {
                delete vm.editData.metadata.annotations;
            }

//database64
            var database64 = {};
            angular.forEach($scope.database64, function (v, k) {
                var key = v["K"]
                database64[key] = window.btoa(v["V"]);
            });

            if( Object.keys(database64).length > 0 )
            {
                vm.editData.data = database64;
            }
            else
            {
                delete vm.editData.data;
            }

            if( !( vm.editData.metadata.namespace && vm.editData.metadata.name ) )
            {
                swal({ title:'错误', text: "Namespace和Name不齐全", type:'error' });
                return;
            }

            if( vm.editData.kind !== 'Secret' )
            {
                swal({ title:'错误', text: "kind不正确，必须为Secret", type:'error' });
                return;
            }

 
          
            $scope.editstep = 2; 
            vm.loadover = false;

            var d = {
                "data": vm.editData,
            };
            $http.post("/api/ci/kubernetes/data/json2yaml", d  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.newyaml = data.data

                   $http.get("/api/ci/v2/kubernetes/app/yaml/always?ticketid=" + ticketid + "&type=" + vm.editData.kind + "&name=" + vm.editData.metadata.name + "&namespace=" + vm.editData.metadata.namespace ).success(function(data){
                        if(data.stat == true) 
                        { 
                            vm.oldyaml = data.data;
                            vm.diff();
                            vm.loadover = true;
                        } else { 
                            toastr.error("获取最新的配置信息失败:" + data.info)
                        }
                    });

                } else { 
                   swal({ title:'提交失败', text: data.info, type:'error' });
                }
            });
        };


//labels
        $scope.labels = [];

        vm.addLabel = function()
        {
            $scope.labels.push({ "K": "", "V": ""});
        }
        vm.delLabel = function(id)
        {
            $scope.labels.splice(id, 1);
        }

//annotations
        $scope.annotations = [];

        vm.addAnnotations = function()
        {
            $scope.annotations.push({ "K": "", "V": ""});
        }
        vm.delAnnotations = function(id)
        {
            $scope.annotations.splice(id, 1);
        }

//database64
        $scope.database64 = [];

        vm.addDatabase64 = function()
        {
            $scope.database64.push({ "K": "", "V": ""});
        }
        vm.delDatabase64 = function(id)
        {
            $scope.database64.splice(id, 1);
        }

        vm.apply = function(){
            vm.loadover = false;
            var d = {
                "ticketid": ticketid,
                "yaml": vm.newyaml,
            };
            $http.post("/api/ci/v2/kubernetes/app/" + vm.tasktype, d  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.cancel();
                   swal({ title:'提交成功', text: data.info, type:'success' });
                } else { 
                   swal({ title:'提交失败', text: data.info, type:'error' });
                }
            });
        };

        vm.assignment = function () {
            var postData = {
                "type": "kubernetes",
                "name": "kubernetes secret " + vm.tasktype,
                "handler": clusterinfo.create_user,
                "url": "/api/ci/v2/kubernetes/app/" + vm.tasktype,
                "method": "POST",
                "submit_reason": "",
                "remarks": "\n集群ID:" + ticketid + ";\n集群名称:" + clusterinfo.name +";\n配置:\n" + vm.newyaml,
                "data": {
                    "ticketid": ticketid,
                    "yaml": vm.newyaml,
                },
            };

            $uibModal.open({
                templateUrl: 'app/pages/assignment/assignmentcommit.html',
                controller: 'AssignmentCommitController',
                controllerAs: 'assignmentcommit',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    postData: function () {return postData},
                    homecancel: function () {return vm.cancel},
                }
            });
        };

        vm.oldyaml = "";
        vm.newyaml = "";

        vm.diffresultstring = "";
        vm.diff = function()
        {
            var diffresultstring = document.getElementById('diffresultstring');
            //三种diff类型，字符、单词、行 ，分别对应下面参数：diffChars  diffWords diffLines
            var diff = JsDiff["diffLines"](vm.oldyaml, vm.newyaml);

            var fragment = document.createDocumentFragment();
            for (var i=0; i < diff.length; i++) {

                if (diff[i].added && diff[i + 1] && diff[i + 1].removed) {
                    var swap = diff[i];
                    diff[i] = diff[i + 1];
                    diff[i + 1] = swap;
                }

                var node;
                if (diff[i].removed) {
                    node = document.createElement('del');
                    node.appendChild(document.createTextNode(diff[i].value));
                } else if (diff[i].added) {
                    node = document.createElement('ins');
                    node.appendChild(document.createTextNode(diff[i].value));
                } else {
                    node = document.createTextNode(diff[i].value);
                }
                fragment.appendChild(node);
            }

            diffresultstring.textContent = '';
            diffresultstring.appendChild(fragment);
        };

    }
})();

(function() {
    'use strict';

    KubernetesCreateSecretController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "type", "name", "namespace", "clusterinfo", "reload"];
    angular
        .module('openc3')
        .controller('KubernetesCreateSecretController', KubernetesCreateSecretController);

    function KubernetesCreateSecretController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, type, name, namespace, clusterinfo, reload ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.namespacetemp = namespace;
        vm.namespace = namespace;
        vm.name;
        vm.server;
        vm.username;
        vm.password;
        vm.email;

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.deleteapp = function(){
            vm.loadover = false;
            var d = {
                "ticketid": ticketid,
                "namespace": vm.namespace,
                "name": vm.name,
                "server": vm.server,
                "username": vm.username,
                "password": vm.password,
                "email": vm.email,
            };

            $http.post("/api/ci/v2/kubernetes/secret/dockerconfigjson", d  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   reload( vm.name );
                   vm.cancel();
                } else { 
                   swal({ title:'操作失败', text: data.info, type:'error' });
                }
            });
        };

        vm.reload = function() {
            $http.get("/api/ci/v2/kubernetes/namespace?ticketid=" + ticketid ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.namespaces = response.data.data; 
                    }else {
                        toastr.error( "获取集群NAMESPACE数据失败："+response.data.info );
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取集群NAMESPACE数据失败: " + response.status )
                });
        };
        vm.reload();

        vm.tickets = [];
        vm.loadTicketData = function() {
            vm.ticketData = 1;
            $http.get("/api/ci/ticket?type=Harbor" ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.tickets = response.data.data; 
                    }else {
                        toastr.error( "获取TICKET数据失败："+response.data.info );
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取TICKET数据失败: " + response.status )
                });
        };

         vm.setData = function(ticketid) {
            $http.get("/api/ci/ticket/" + ticketid+ "?detail=1" ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.name = response.data.data.name;
                        vm.username = response.data.data.ticket.Username;
                        vm.password = response.data.data.ticket.Password;
                        vm.server = response.data.data.ticket.Server.split("/")[2];

                    }else {
                        toastr.error( "获取TICKET数据失败："+response.data.info );
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取TICKET数据失败: " + response.status )
                });
        };

 
        vm.assignment = function () {
            var postData = {
                "type": "kubernetes",
                "name": "kubernetes secret create",
                "handler": clusterinfo.create_user,
                "url": "/api/ci/v2/kubernetes/secret/dockerconfigjson",
                "method": "POST",
                "submit_reason": "",
                "remarks": "\n集群ID:" + ticketid + ";\n集群名称:" + clusterinfo.name + ";\n命名空间:" + vm.namespace + ";\nsecret名称:"+ vm.name,
                "data": {
                    "ticketid": ticketid,
                    "namespace": vm.namespace,
                    "name": vm.name,
                    "server": vm.server,
                    "username": vm.username,
                    "password": vm.password,
                    "email": vm.email,
                },
            };

            $uibModal.open({
                templateUrl: 'app/pages/assignment/assignmentcommit.html',
                controller: 'AssignmentCommitController',
                controllerAs: 'assignmentcommit',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    postData: function () {return postData},
                    homecancel: function () {return vm.cancel},
                }
            });
        };

    }
})();

(function() {
    'use strict';

    KubernetesCreateNamespaceController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "clusterinfo", "homereload"];
    angular
        .module('openc3')
        .controller('KubernetesCreateNamespaceController', KubernetesCreateNamespaceController);

    function KubernetesCreateNamespaceController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, clusterinfo, homereload ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.namespace;

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.create = function(){
            vm.loadover = false;
            var d = {
                "ticketid": ticketid,
                "namespace": vm.namespace,
            };

            $http.post("/api/ci/v2/kubernetes/namespace", d  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.cancel();
                   homereload();
                } else { 
                   swal({ title:'操作失败', text: data.info, type:'error' });
                }
            });
        };

        vm.assignment = function () {
            var postData = {
                "type": "kubernetes",
                "name": "创建NAMESPACE",
                "handler": clusterinfo.create_user,
                "url": "/api/ci/v2/kubernetes/namespace",
                "method": "POST",
                "submit_reason": "",
                "remarks": "\n集群ID:" + ticketid + ";\n集群名称:" + clusterinfo.name + ";\n命名空间:" + vm.namespace,
                "data": {
                    "ticketid": ticketid,
                    "namespace": vm.namespace,
                },
            };

            $uibModal.open({
                templateUrl: 'app/pages/assignment/assignmentcommit.html',
                controller: 'AssignmentCommitController',
                controllerAs: 'assignmentcommit',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    postData: function () {return postData},
                    homecancel: function () {return vm.cancel},
                }
            });
        };

    }
})();

(function() {
    'use strict';

    KubernetesCreateIngressController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "clusterinfo", "namespace", "name"];
    angular
        .module('openc3')
        .controller('KubernetesCreateIngressController', KubernetesCreateIngressController);

    function KubernetesCreateIngressController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, clusterinfo, namespace, name ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        $scope.editstep = 1;

        vm.tasktype = 'create';
        if( namespace && name )
        {
            vm.tasktype = 'apply';
        }

        vm.loadsecrets = function( ns )
        {
            $http.get("/api/ci/v2/kubernetes/secret?ticketid=" + ticketid + "&namespace=" + ns ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.secrets = data.data
                } else { 
                    toastr.error("加载secret信息失败:" + data.info)
                }
            });
        };

        vm.loadservices = function( ns )
        {
            $http.get("/api/ci/v2/kubernetes/service?ticketid=" + ticketid + "&namespace=" + ns ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.services = data.data
                } else { 
                    toastr.error("加载service信息失败:" + data.info)
                }
            });
        };

        vm.namespacechange = function(ns)
        {
            vm.loadsecrets(ns);
            vm.loadservices(ns);
        }

        vm.reload = function(){
            vm.loadover = false;

            var url = "/api/ci/kubernetes/data/template/ingress";

            if( vm.tasktype == 'apply' )
            {
                url = "/api/ci/v2/kubernetes/app/json?ticketid=" + ticketid + "&type=ingress&name=" + name + "&namespace=" + namespace;
            }

            $http.get(url).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.editData = data.data;

                   $scope.labels = [];
                   if( vm.editData.metadata.labels )
                   {
                       angular.forEach(vm.editData.metadata.labels, function (v, k) {
                           $scope.labels.push( { "K": k, "V": v })
                       });
                   }


                   $scope.annotations = [];
                   if( vm.editData.metadata.annotations )
                   {
                       angular.forEach(vm.editData.metadata.annotations, function (v, k) {
                           $scope.annotations.push( { "K": k, "V": v })
                       });
                   }


                   var tlshash = {};
                   if( vm.editData.spec.tls && vm.editData.spec.tls.length > 0 )
                   {
                        angular.forEach(vm.editData.spec.tls, function (tmp, k) {
                            tlshash[tmp.hosts[0]] = tmp.secretName
                        });
                   }

                   angular.forEach(vm.editData.spec.rules, function (rule, k) {
                      if( tlshash[rule.host] )
                      {
                          rule.https_tls_temp = tlshash[rule.host]
                      }
                   });

 
                } else { 
                    toastr.error("加载信息失败:" + data.info)
                }
            });
            $http.get("/api/ci/kubernetes/data/template/ingress_lb_annotations" ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.ingress_lb_annotations = data.data;
                } else { 
                    toastr.error("加载ingress_lb_annotations模版信息失败:" + data.info)
                }
            });

            if( vm.tasktype == 'create' )
            {
                $http.get("/api/ci/v2/kubernetes/namespace?ticketid=" + ticketid ).then(
                    function successCallback(response) {
                        if (response.data.stat){
                            vm.namespaces = response.data.data; 
                        }else {
                            toastr.error( "获取集群NAMESPACE数据失败："+response.data.info );
                        }
                    },
                    function errorCallback (response){
                        toastr.error( "获取集群NAMESPACE数据失败: " + response.status )
                    });
            }

            vm.namespacechange( namespace );
        };
        vm.reload();

        vm.gotostep0 = function(){
            $scope.editstep = 0; 
        };

        vm.gotostep1 = function(){
            vm.loadover = false;

            var d = {
                "data": vm.newyaml,
            };
            $http.post("/api/ci/kubernetes/data/yaml2json", d  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.editData = data.data

                   $scope.labels = [];
                   if( vm.editData.metadata.labels )
                   {
                       angular.forEach(vm.editData.metadata.labels, function (v, k) {
                           $scope.labels.push( { "K": k, "V": v })
                       });
                   }


                   $scope.annotations = [];
                   if( vm.editData.metadata.annotations )
                   {
                       angular.forEach(vm.editData.metadata.annotations, function (v, k) {
                           $scope.annotations.push( { "K": k, "V": v })
                       });
                   }

                   var tlshash = {};
                   if( vm.editData.spec.tls && vm.editData.spec.tls.length > 0 )
                   {
                        angular.forEach(vm.editData.spec.tls, function (tmp, k) {
                            tlshash[tmp.hosts[0]] = tmp.secretName
                        });
                   }

                   angular.forEach(vm.editData.spec.rules, function (rule, k) {
                      if( tlshash[rule.host] )
                      {
                          rule.https_tls_temp = tlshash[rule.host]
                      }
                   });

                    vm.loadover = true;
                    $scope.editstep = 1; 
                } else { 
                   swal({ title:'YAML格式转换失败', text: data.info, type:'error' });
                }
            });

        };

        vm.gotostep2 = function(){
//labels
            var labels = {};
            angular.forEach($scope.labels, function (v, k) {
                var key = v["K"]
                labels[key] = v["V"];
            });

            if( Object.keys(labels).length > 0 )
            {
                vm.editData.metadata.labels = labels;
            }
            else
            {
                delete vm.editData.metadata.labels;
            }

//annotations
            var annotations = {};
            angular.forEach($scope.annotations, function (v, k) {
                var key = v["K"]
                annotations[key] = v["V"];
            });

            if( Object.keys(annotations).length > 0 )
            {
                vm.editData.metadata.annotations = annotations;
            }
            else
            {
                delete vm.editData.metadata.annotations;
            }
//tls
            var tls = [];
            angular.forEach(vm.editData.spec.rules, function (rule, k) {
                if( rule.https_tls_temp )
                {
                    tls.push( { "hosts": [  rule.host ], "secretName": rule.https_tls_temp } )
                }
                delete rule.https_tls_temp;
            });

            if( tls.length > 0 )
            {
                vm.editData.spec.tls = tls;
            }
            else
            {
                delete vm.editData.spec.tls;
            }

            if( !( vm.editData.metadata.namespace && vm.editData.metadata.name ) )
            {

                swal({ title:'错误', text: "Namespace和Name不齐全", type:'error' });
                return;
            }

            if( vm.editData.kind !== 'Ingress' )
            {

                swal({ title:'错误', text: "kind不正确，必须为Ingress", type:'error' });
                return;
            }

            $scope.editstep = 2; 


            vm.loadover = false;
            var d = {
                "data": vm.editData,
            };
            $http.post("/api/ci/kubernetes/data/json2yaml", d  ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.newyaml = data.data


                    $http.get("/api/ci/v2/kubernetes/app/yaml/always?ticketid=" + ticketid + "&type=" + vm.editData.kind + "&name=" + vm.editData.metadata.name + "&namespace=" + vm.editData.metadata.namespace ).success(function(data){
                         if(data.stat == true) 
                         { 
                            vm.oldyaml = data.data;
                            vm.diff();
                            vm.loadover = true;
                         } else { 
                             toastr.error("获取最新的配置信息失败:" + data.info)
                         }
                     });
 

                } else { 
                   swal({ title:'提交失败', text: data.info, type:'error' });
                }
            });
        };


        $scope.labels = [];

        vm.addLabel = function()
        {
            $scope.labels.push({ "K": "", "V": ""});
        }
        vm.delLabel = function(id)
        {
            $scope.labels.splice(id, 1);
        }


        $scope.annotations = [];

        vm.addAnnotations = function()
        {
            $scope.annotations.push({ "K": "", "V": ""});
        }
        vm.delAnnotations = function(id)
        {
            $scope.annotations.splice(id, 1);
        }

//添加Rule的路径

        vm.addPaths = function(x)
        {
            if( ! x.http.paths )
            {
                x.http.paths = []
            }
            x.http.paths.push(angular.copy( {"pathType":"ImplementationSpecific","path":"", "backend": { "serviceName":"","servicePort": 80}}));
        }
 
        vm.delPaths = function(x,id)
        {
            x.http.paths.splice(id, 1);
        }

//
        vm.addAnnotationsByType = function(type)
        {
            var all_ingress_lb_annotations_key = {};
            angular.forEach(vm.ingress_lb_annotations, function (v, k) {

                angular.forEach(v, function (v, k) {
                    all_ingress_lb_annotations_key[k] = 1
                });
 
            });
 

            var annotations_temp = [];
            angular.forEach($scope.annotations, function (v, k) {
                if( ! all_ingress_lb_annotations_key[v.K] )
                {
                    annotations_temp.push(v)
                }
            });
 
            $scope.annotations = annotations_temp;
 
            angular.forEach(vm.ingress_lb_annotations[type], function (v, k) {
                $scope.annotations.push({"K": k,"V":v})
            });
        }
//
        vm.switchApiVersion = function( versionName ){
            vm.editData.apiVersion = versionName

            //换成新版格式
            if( versionName === 'networking.k8s.io/v1' )
            {
                if( vm.editData.spec.rules && vm.editData.spec.rules.length > 0 )
                {
                    angular.forEach(vm.editData.spec.rules, function (rule, k) {

                        if( rule.http.paths.length > 0)
                        {
                            angular.forEach(rule.http.paths, function (path, k) {
                                if( path.backend.serviceName )
                                {
                                    path.backend = { "service": { "name": path.backend.serviceName, "port": { "number": path.backend.servicePort } } };
                                }
                                else
                                {
                                    path.backend = { "service": { "name": "", "port": { "number": "" } } };
                                }
                            });
                        }
                    });
                }
            }
            //切换成旧版格式
            if( versionName === 'extensions/v1beta1' )
            {
                if( vm.editData.spec.rules && vm.editData.spec.rules.length > 0 )
                {
                    angular.forEach(vm.editData.spec.rules, function (rule, k) {

                        if( rule.http.paths.length > 0)
                        {
                            angular.forEach(rule.http.paths, function (path, k) {
                                if( path.backend.service.name )
                                {
                                    path.backend = { "serviceName": path.backend.service.name, "servicePort": path.backend.service.port.number };
                                }
                                else
                                {
                                    path.backend = { "serviceName": "", "servicePort": 80 };
                                }
                            });
                        }
                    });
                }
            }
 
        };
//

        vm.addRules = function()
        {
            vm.editData.spec.rules.push( angular.copy({"host": "", "http": { "paths": [] }}));
        }
 
        vm.delRules = function(id)
        {
            vm.editData.spec.rules.splice(id, 1);
        }

        vm.apply = function(){
            vm.loadover = false;
            var d = {
                "ticketid": ticketid,
                "yaml": vm.newyaml,
            };
            $http.post("/api/ci/v2/kubernetes/app/" + vm.tasktype, d  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.cancel();
                   swal({ title:'提交成功', text: data.info, type:'success' });
                } else { 
                   swal({ title:'提交失败', text: data.info, type:'error' });
                }
            });
        };

        vm.assignment = function () {
            var postData = {
                "type": "kubernetes",
                "name": "kubernetes ingress" + vm.tasktype,
                "handler": clusterinfo.create_user,
                "url": "/api/ci/v2/kubernetes/app/" + vm.tasktype,
                "method": "POST",
                "submit_reason": "",
                "remarks": "\n集群ID:" + ticketid + ";\n集群名称:" + clusterinfo.name +";\n配置:\n" + vm.newyaml,
                "data": {
                    "ticketid": ticketid,
                    "yaml": vm.newyaml,
                },
            };

            $uibModal.open({
                templateUrl: 'app/pages/assignment/assignmentcommit.html',
                controller: 'AssignmentCommitController',
                controllerAs: 'assignmentcommit',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    postData: function () {return postData},
                    homecancel: function () {return vm.cancel},
                }
            });
        };

        vm.oldyaml = "";
        vm.newyaml = "";

        vm.diffresultstring = "";
        vm.diff = function()
        {
            var diffresultstring = document.getElementById('diffresultstring');
            //三种diff类型，字符、单词、行 ，分别对应下面参数：diffChars  diffWords diffLines
            var diff = JsDiff["diffLines"](vm.oldyaml, vm.newyaml);

            var fragment = document.createDocumentFragment();
            for (var i=0; i < diff.length; i++) {

                if (diff[i].added && diff[i + 1] && diff[i + 1].removed) {
                    var swap = diff[i];
                    diff[i] = diff[i + 1];
                    diff[i + 1] = swap;
                }

                var node;
                if (diff[i].removed) {
                    node = document.createElement('del');
                    node.appendChild(document.createTextNode(diff[i].value));
                } else if (diff[i].added) {
                    node = document.createElement('ins');
                    node.appendChild(document.createTextNode(diff[i].value));
                } else {
                    node = document.createTextNode(diff[i].value);
                }
                fragment.appendChild(node);
            }

            diffresultstring.textContent = '';
            diffresultstring.appendChild(fragment);
        };

    }
})();

(function() {
    'use strict';

    KubernetesCreateHpaController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "type", "name", "namespace", "clusterinfo"];
    angular
        .module('openc3')
        .controller('KubernetesCreateHpaController', KubernetesCreateHpaController);

    function KubernetesCreateHpaController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, type, name, namespace, clusterinfo ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.name = name;
        vm.type = type;

        vm.min = 1;
        vm.max = 3;
        vm.cpu = 60;

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.add = function(){
            vm.loadover = false;
            var d = {
                "ticketid": ticketid,
                "type": type,
                "name": name,
                "namespace": namespace,
                "cpu": vm.cpu,
                "min": vm.min,
                "max": vm.max,
            };

            $http.post("/api/ci/v2/kubernetes/hpa/create", d  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.cancel();
                } else { 
                   swal({ title:'操作失败', text: data.info, type:'error' });
                }
            });
        };

        vm.assignment = function () {
            var postData = {
                "type": "kubernetes",
                "name": "创建HPA",
                "handler": clusterinfo.create_user,
                "url": "/api/ci/v2/kubernetes/hpa/create",
                "method": "POST",
                "submit_reason": "",
                "remarks": "\n集群ID:" + ticketid + ";\n集群名称:" + clusterinfo.name + ";\n命名空间:"+ namespace + ";\n类型:" + type + ";\n名称:" + name + ";\ncpu百分比:" + vm.cpu + ";\n最小副本数:" + vm.min + ";\n最大副本数:" + vm.max,
                "data": {
                    "ticketid": ticketid,
                    "type": type,
                    "name": name,
                    "namespace": namespace,
                    "cpu": vm.cpu,
                    "min": vm.min,
                    "max": vm.max,
                },
            };

            $uibModal.open({
                templateUrl: 'app/pages/assignment/assignmentcommit.html',
                controller: 'AssignmentCommitController',
                controllerAs: 'assignmentcommit',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    postData: function () {return postData},
                    homecancel: function () {return vm.cancel},
                }
            });
        };
    }
})();

(function() {
    'use strict';

    KubernetesCreateDeploymentController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "clusterinfo", "namespace", "name", "homereload"];
    angular
        .module('openc3')
        .controller('KubernetesCreateDeploymentController', KubernetesCreateDeploymentController);

    function KubernetesCreateDeploymentController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, clusterinfo, namespace, name, homereload ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.namespace = namespace;
        $scope.editstep = 1;
      
        vm.tasktype = 'create';
        if( namespace && name )
        {
            vm.tasktype = 'apply';
        }

        vm.reload = function(){
            vm.loadover = false;

            var url = "/api/ci/kubernetes/data/template/deployment";

            if( vm.tasktype == 'apply' )
            {
                url = "/api/ci/v2/kubernetes/app/json?ticketid=" + ticketid + "&type=deployment&name=" + name + "&namespace=" + namespace;
            }

            $http.get(url).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.editData = data.data;

                   if( namespace )
                   {
                      vm.editData.metadata.namespace = namespace;
                   }

                   $scope.labels = [];
                   if( vm.editData.metadata.labels )
                   {
                       angular.forEach(vm.editData.metadata.labels, function (v, k) {
                           $scope.labels.push( { "K": k, "V": v })
                       });
                   }
                } else { 
                    toastr.error("加载模版信息失败:" + data.info)
                }
            });
            $http.get("/api/ci/kubernetes/data/template/container" ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.containerData = data.data;
                } else { 
                    toastr.error("加载container模版信息失败:" + data.info)
                }
            });
//亲和性用到namespace,不管什么情况下都先加载这个列表
//            if( vm.namespace === "" )
//            {
                $http.get("/api/ci/v2/kubernetes/namespace?ticketid=" + ticketid ).then(
                    function successCallback(response) {
                        if (response.data.stat){
                            vm.namespaces = response.data.data; 
                        }else {
                            toastr.error( "获取集群NAMESPACE数据失败："+response.data.info );
                        }
                    },
                    function errorCallback (response){
                        toastr.error( "获取集群NAMESPACE数据失败: " + response.status )
                    });
//            }

            $http.get("/api/ci/v2/kubernetes/util/labels/node?ticketid=" + ticketid ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.nodelabel = data.data;
                } else { 
                    toastr.error("加载node的label失败:" + data.info)
                }
            });
 
            $http.get("/api/ci/v2/kubernetes/util/labels/node_pod?ticketid=" + ticketid ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.nodepodlabel = data.data;
                } else { 
                    toastr.error("加载node和pod的label失败:" + data.info)
                }
            });
 
 
        };
        vm.reload();

        vm.gotostep0 = function(){
            $scope.editstep = 0; 
        };

        vm.gotostep1 = function(){
            vm.loadover = false;

            var d = {
                "data": vm.newyaml,
            };
            $http.post("/api/ci/kubernetes/data/yaml2json", d  ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.editData = data.data

                    $scope.labels = [];
                    if( vm.editData.metadata.labels )
                    {
                        angular.forEach(vm.editData.metadata.labels, function (v, k) {
                            $scope.labels.push( { "K": k, "V": v })
                        });
                    }
 
                    vm.loadover = true;
                    $scope.editstep = 1; 
                } else { 
                   swal({ title:'YAML格式转换失败', text: data.info, type:'error' });
                }
            });

        };

        vm.switchtointmaby =  function( str )
        {
            var isnum = /^\d+$/.test(str)
            if( isnum )
            {
                return Number(str);
            }
            else
            {
                return str;
            }
        }

        vm.gotostep2 = function(){
//labels
            var labels = {};
            angular.forEach($scope.labels, function (v, k) {
                var key = v["K"]
                labels[key] = v["V"];
            });

            if( Object.keys(labels).length > 0 )
            {
                vm.editData.metadata.labels = labels;
            }
            else
            {
                delete vm.editData.metadata.labels;
            }

//clean temp data
            angular.forEach(vm.editData.spec.template.spec.containers, function (v, k) {
                 delete v.tempcommandstring;
                 delete v.tempargsstring;
            });


            if( vm.tasktype == 'create' )
            {
                vm.editData.spec.selector.matchLabels.app = vm.editData.metadata.name;
                vm.editData.spec.template.metadata.labels.app = vm.editData.metadata.name;
            }
            
            if( vm.editData.spec.strategy.type === 'RollingUpdate' )
            {
                vm.editData.spec.strategy.rollingUpdate.maxUnavailable = vm.switchtointmaby( vm.editData.spec.strategy.rollingUpdate.maxUnavailable );
                vm.editData.spec.strategy.rollingUpdate.maxSurge = vm.switchtointmaby( vm.editData.spec.strategy.rollingUpdate.maxSurge );
            }

            if( !( vm.editData.metadata.namespace && vm.editData.metadata.name ) )
            {
                swal({ title:'错误', text: "Namespace和Name不齐全", type:'error' });
                return;
            }

            if( vm.editData.kind !== 'Deployment' )
            {
                swal({ title:'错误', text: "kind不正确，必须为Deployment", type:'error' });
                return;
            }

            vm.loadover = false;
            $scope.editstep = 2; 

            var d = {
                "data": vm.editData,
            };
            $http.post("/api/ci/kubernetes/data/json2yaml", d  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.newyaml = data.data

                   $http.get("/api/ci/v2/kubernetes/app/yaml/always?ticketid=" + ticketid + "&type=" + vm.editData.kind + "&name=" + vm.editData.metadata.name + "&namespace=" + vm.editData.metadata.namespace ).success(function(data){
                        if(data.stat == true) 
                        { 
                           vm.oldyaml = data.data;
                           vm.diff();
                           vm.loadover = true;
                        } else { 
                            toastr.error("获取最新的配置信息失败:" + data.info)
                        }
                    });
 

                } else { 
                    swal({ title:'提交失败', text: data.info, type:'error' });
                }
            });
        };

        $scope.labels = [];
        vm.addLabel = function()
        {
            $scope.labels.push({ "K": "", "V": ""});
        }
        vm.delLabel = function(id)
        {
            $scope.labels.splice(id, 1);
        }

//Secret
        vm.autoGetSecret = function()
        {
            $http.get("/api/ci/v2/kubernetes/secret?ticketid=" + ticketid + "&namespace=" + vm.editData.metadata.namespace ).success(function(data){
                if(data.stat == true) 
                { 
                    if( data.data.length > 0 && ! vm.editData.spec.template.spec.imagePullSecrets )
                    {
                        vm.editData.spec.template.spec.imagePullSecrets = [];
                    }
 
                    angular.forEach(data.data, function (v, k) {
                        if( v.TYPE === "kubernetes.io/dockerconfigjson" )
                        {
                            vm.editData.spec.template.spec.imagePullSecrets.push({ "name": v.NAME });
                        }
                    });

                } else { 
                    toastr.error("加载secret信息失败:" + data.info)
                }
            });
        }
        vm.addSecret = function(name)
        {
            if( ! vm.editData.spec.template.spec.imagePullSecrets )
            {
                vm.editData.spec.template.spec.imagePullSecrets = [];
            }
            vm.editData.spec.template.spec.imagePullSecrets.push({ "name": name });
        }

        vm.delSecret = function(id)
        {
            vm.editData.spec.template.spec.imagePullSecrets.splice(id, 1);
        }
        vm.cleanSecret = function()
        {
            delete vm.editData.spec.template.spec.imagePullSecrets;
        }

        vm.createSecret = function (type,name,namespace) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/createsecret.html',
                controller: 'KubernetesCreateSecretController',
                controllerAs: 'kubernetescreatesecret',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return vm.editData.metadata.namespace},
                    ticketid: function () {return clusterinfo.id},
                    clusterinfo: function () {return clusterinfo},
                    reload: function () {return vm.addSecret },
                }
            });
        };

//NodeAffinity 节点亲和性调度
        vm.addNodeAffinity = function()
        {
            if( vm.editData.spec.template.spec.affinity === undefined || Object.keys(vm.editData.spec.template.spec.affinity).length == 0 )
            {
                vm.editData.spec.template.spec.affinity = {};
            }
            if( vm.editData.spec.template.spec.affinity.nodeAffinity === undefined || Object.keys(vm.editData.spec.template.spec.affinity.nodeAffinity).length == 0 )
            {
                vm.editData.spec.template.spec.affinity.nodeAffinity = {};
            }

            if( vm.editData.spec.template.spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution === undefined || Object.keys(vm.editData.spec.template.spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution).length == 0 )
            {
                vm.editData.spec.template.spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution = {};
            }

            if( vm.editData.spec.template.spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms === undefined || vm.editData.spec.template.spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms.length == 0 )
            {
                vm.editData.spec.template.spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms = [ { "matchExpressions": [ { "key": "", "operator": "In", "values": []}]} ];
            }
            else
            {
                vm.editData.spec.template.spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms[0].matchExpressions.push( { "key": "", "operator": "In", "values": [] } );
            }

        }

        vm.delNodeAffinity = function(id)
        {
            vm.editData.spec.template.spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms[0].matchExpressions.splice(id, 1);
        }

//PodAffinity。POD亲和性调度
        vm.addPodAffinity = function()
        {
            if( vm.editData.spec.template.spec.affinity === undefined || Object.keys(vm.editData.spec.template.spec.affinity).length == 0 )
            {
                vm.editData.spec.template.spec.affinity = {};
            }
            if( vm.editData.spec.template.spec.affinity.podAffinity === undefined || Object.keys(vm.editData.spec.template.spec.affinity.podAffinity).length == 0 )
            {
                vm.editData.spec.template.spec.affinity.podAffinity = {};
            }

            if( vm.editData.spec.template.spec.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution === undefined || vm.editData.spec.template.spec.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution.length == 0 )
            {
                vm.editData.spec.template.spec.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution = [ { "labelSelector": { "matchExpressions": [ { "key": "", "operator": "In", "values": [] } ] }, "namespaces": [], "topologyKey": ""} ];
            }
            else
            {
                vm.editData.spec.template.spec.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].labelSelector.matchExpressions.push( { "key": "", "operator": "In", "values": [] } );
            }

        }
        vm.delPodAffinity = function(id)
        {
            vm.editData.spec.template.spec.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].labelSelector.matchExpressions.splice(id, 1);
        }

//PodAntiAffinity  POD 反亲和性调度
        vm.addPodAntiAffinity = function()
        {
            if( vm.editData.spec.template.spec.affinity === undefined || Object.keys(vm.editData.spec.template.spec.affinity).length == 0 )
            {
                vm.editData.spec.template.spec.affinity = {};
            }
            if( vm.editData.spec.template.spec.affinity.podAntiAffinity === undefined || Object.keys(vm.editData.spec.template.spec.affinity.podAntiAffinity).length == 0 )
            {
                vm.editData.spec.template.spec.affinity.podAntiAffinity = {};
            }

            if( vm.editData.spec.template.spec.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution === undefined || vm.editData.spec.template.spec.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution.length == 0 )
            {
                vm.editData.spec.template.spec.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution = [ { "labelSelector": { "matchExpressions": [ { "key": "", "operator": "In", "values": [] } ] }, "namespaces": [], "topologyKey": ""} ];
            }
            else
            {
                vm.editData.spec.template.spec.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].labelSelector.matchExpressions.push( { "key": "", "operator": "In", "values": [] } );
            }

        }
        vm.delPodAntiAffinity = function(id)
        {
            vm.editData.spec.template.spec.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].labelSelector.matchExpressions.splice(id, 1);
        }

//tolerations 容忍/调度
        vm.addTolerations = function()
        {

            if( vm.editData.spec.template.spec.tolerations === undefined || vm.editData.spec.template.spec.tolerations.length == 0 )
            {
                vm.editData.spec.template.spec.tolerations = [];
            }
            vm.editData.spec.template.spec.tolerations.push( { "key": "", "operator": "Equal", "value": "", "effect": "NoSchedule" } );

        }
        vm.delTolerations = function(id)
        {
            vm.editData.spec.template.spec.tolerations.splice(id, 1);
        }

//Volume
        vm.addVolume = function( type )
        {
            var data = {}

            if( type === 'emptyDir' )
            {
                data = { "name": "", "emptyDir": {} }
            }

            if( type === 'hostPath' )
            {
                data = { "name": "", "hostPath": { "path": "" } }
            }

            if( type === 'nfs' )
            {
                data = { "name": "", "nfs": { "server":"", "path": "" } }
            }
            if( type === 'secret' )
            {
                data = { "name": "", "secret": { "secretName":"" } }
            }
            if( type === 'persistentVolumeClaim' )
            {
                data = { "name": "", "persistentVolumeClaim": { "claimName":"" } }
            }
            if( type === 'configMap' )
            {
                data = { "name": "", "configMap": { "name":"" } }
                //data = { "name": "", "configMap": { "name":"", "items": [ { "key": "", "path": "" } ] } }
            }

            if( ! vm.editData.spec.template.spec.volumes )
            {
                vm.editData.spec.template.spec.volumes = [];
            }

            vm.editData.spec.template.spec.volumes.push(data);
        }
        vm.delVolume = function(id)
        {
            vm.editData.spec.template.spec.volumes.splice(id, 1);
        }
        vm.cleanVolume = function()
        {
            delete vm.editData.spec.template.spec.volumes;
        }

//Command
        vm.addCommand = function(x, cmd)
        {
            if( ! x.command )
            {
                x.command = []
            }
            x.command.push(cmd)
            x.tempcommandstring = "";
        }

        vm.delCommand = function(x)
        {
            delete x.command;
            x.tempcommandstring = "";
        }
//Args
        vm.addArgs = function(x, args)
        {
            if( ! x.args )
            {
                x.args = []
            }
            x.args.push(args)
            x.tempargsstring = ""
        }

        vm.delArgs = function(x)
        {
            delete x.args;
            x.tempargsstring = ""
        }

//容器环境变量
        vm.addContainerEnv = function(x)
        {
            if( ! x.env )
            {
                x.env = []
            }
            x.env.push({"name":"","value":""})
        }
 
        vm.addContainerEnvConfigMap = function(x)
        {
            if( ! x.env )
            {
                x.env = []
            }
            x.env.push({"name": "", "valueFrom": { "configMapKeyRef": { "name": "", "key": "" } }})
        }
         vm.addContainerEnvSecret = function(x)
        {
            if( ! x.env )
            {
                x.env = []
            }
            x.env.push({"name": "", "valueFrom": { "secretKeyRef": { "name": "", "key": "" } }})
        }
 
        vm.delContainerEnv = function(x,id)
        {
            x.env.splice(id, 1);
        }
        vm.cleanContainerEnv = function(x)
        {
            delete x.env;
        }

//容器端口
        vm.addContainerPorts = function(x,protocol)
        {
            if( ! x.ports )
            {
                x.ports = []
            }
            x.ports.push({"name":"","protocol": protocol, "containerPort":80})
        }
        vm.delContainerPorts = function(x,id)
        {
            x.ports.splice(id, 1);
        }
        vm.cleanContainerPorts = function(x)
        {
            delete x.ports;
        }

//容器应用存活探针
        vm.addContainerlivenessProbeCmd = function(x)
        {
            x.livenessProbe = { "initialDelaySeconds": 30, "periodSeconds": 10, "timeoutSeconds": 5, "exec": { "command": [] }}
        }
        vm.addContainerlivenessProbeHttp = function(x)
        {
            x.livenessProbe = { "initialDelaySeconds": 30, "periodSeconds": 10, "timeoutSeconds": 5, "httpGet": { "path": "", "port": 8080, "scheme": "HTTP" }}
        }
         vm.addContainerlivenessProbePort = function(x)
        {
            x.livenessProbe = { "initialDelaySeconds": 30, "periodSeconds": 10, "timeoutSeconds": 5, "tcpSocket": { "port": 8080 }}
        }
 
        vm.cleanContainerlivenessProbe = function(x)
        {
            delete x.livenessProbe;
        }

//容器应用就绪探针
        vm.addContainerreadinessProbeCmd = function(x)
        {
            x.readinessProbe = { "initialDelaySeconds": 30, "periodSeconds": 10, "timeoutSeconds": 5, "exec": { "command": [] }}
        }
        vm.addContainerreadinessProbeHttp = function(x)
        {
            x.readinessProbe = { "initialDelaySeconds": 30, "periodSeconds": 10, "timeoutSeconds": 5, "httpGet": { "path": "", "port": 8080, "scheme": "HTTP" }}
        }
         vm.addContainerreadinessProbePort = function(x)
        {
            x.readinessProbe = { "initialDelaySeconds": 30, "periodSeconds": 10, "timeoutSeconds": 5, "tcpSocket": { "port": 8080 }}
        }
 
        vm.cleanContainerreadinessProbe = function(x)
        {
            delete x.readinessProbe;
        }

//容器数据卷
        vm.addContainerVolume = function(x)
        {
            if( ! x.volumeMounts )
            {
                x.volumeMounts = []
            }
            x.volumeMounts.push({"name":"","mountPath":""})
        }
 
        vm.addContainerVolumeFile = function(x)
        {
            if( ! x.volumeMounts )
            {
                x.volumeMounts = []
            }
            x.volumeMounts.push({"name":"","mountPath":"", "subPath": ""})
        }
 
        vm.delContainerVolume = function(x,id)
        {
            x.volumeMounts.splice(id, 1);
        }

        vm.cleanContainerVolume = function(x)
        {
            delete x.volumeMounts;
        }
//
        vm.addContainer = function()
        {
            var b = angular.copy(vm.containerData);
            vm.editData.spec.template.spec.containers.push(angular.copy(vm.containerData));
        }
 
        vm.delContainer = function(id)
        {
            vm.editData.spec.template.spec.containers.splice(id, 1);
        }

//
        vm.switchStrategy = function( type ){
            vm.editData.spec.strategy.type = type;
            if( type === 'RollingUpdate' )
            {
                vm.editData.spec.strategy.rollingUpdate = { "maxUnavailable": 0, "maxSurge": 3};
            }
            else
            {
                delete vm.editData.spec.strategy.rollingUpdate;
            }
        };

        vm.switchImagePullPolicy = function( container, type ){
            if( type ==='')
            {
                delete container['imagePullPolicy'];
            }
            else
            {
                container['imagePullPolicy'] = type;
            }
        };

//
        vm.addImageAddrByTicket = function (container) {
            vm.addImageAddrByTicket_set = function(repo) {
                container.name = repo
            }

            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/harborimage.html',
                controller: 'KubernetesHarborImageController',
                controllerAs: 'kubernetesharborimage',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    ticketid: function () {return ''},
                    homereload: function () {return vm.addImageAddrByTicket_set},
                }
            });
        };

        vm.apply = function(){
            vm.loadover = false;
            var d = {
                "ticketid": ticketid,
                "yaml": vm.newyaml,
            };
            $http.post("/api/ci/v2/kubernetes/app/" + vm.tasktype, d  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.cancel();
                   homereload();
                   swal({ title:'提交成功', text: data.info, type:'success' });
                } else { 
                   swal({ title:'提交失败', text: data.info, type:'error' });
                }
            });
        };

        vm.assignment = function () {
            var postData = {
                "type": "kubernetes",
                "name": "kubernetes deployment " + vm.tasktype,
                "handler": clusterinfo.create_user,
                "url": "/api/ci/v2/kubernetes/app/" + vm.tasktype,
                "method": "POST",
                "submit_reason": "",
                "remarks": "\n集群ID:" + ticketid + ";\n集群名称:" + clusterinfo.name +";\n配置:\n" + vm.newyaml,
                "data": {
                    "ticketid": ticketid,
                    "yaml": vm.newyaml,
                },
            };

            $uibModal.open({
                templateUrl: 'app/pages/assignment/assignmentcommit.html',
                controller: 'AssignmentCommitController',
                controllerAs: 'assignmentcommit',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    postData: function () {return postData},
                    homecancel: function () {return vm.cancel},
                }
            });
        };

        vm.oldyaml = "";
        vm.newyaml = "";

        vm.diffresultstring = "";
        vm.diff = function()
        {
            var diffresultstring = document.getElementById('diffresultstring');
            //三种diff类型，字符、单词、行 ，分别对应下面参数：diffChars  diffWords diffLines
            var diff = JsDiff["diffLines"](vm.oldyaml, vm.newyaml);

            var fragment = document.createDocumentFragment();
            for (var i=0; i < diff.length; i++) {

                if (diff[i].added && diff[i + 1] && diff[i + 1].removed) {
                    var swap = diff[i];
                    diff[i] = diff[i + 1];
                    diff[i + 1] = swap;
                }

                var node;
                if (diff[i].removed) {
                    node = document.createElement('del');
                    node.appendChild(document.createTextNode(diff[i].value));
                } else if (diff[i].added) {
                    node = document.createElement('ins');
                    node.appendChild(document.createTextNode(diff[i].value));
                } else {
                    node = document.createTextNode(diff[i].value);
                }
                fragment.appendChild(node);
            }

            diffresultstring.textContent = '';
            diffresultstring.appendChild(fragment);
        };
    }
})();

(function() {
    'use strict';

    KubernetesCreateDaemonSetController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "clusterinfo", "namespace", "name"];
    angular
        .module('openc3')
        .controller('KubernetesCreateDaemonSetController', KubernetesCreateDaemonSetController);

    function KubernetesCreateDaemonSetController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, clusterinfo, namespace, name ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        $scope.editstep = 1;
      
        vm.tasktype = 'create';
        if( namespace && name )
        {
            vm.tasktype = 'apply';
        }

        vm.reload = function(){
            vm.loadover = false;

            var url = "/api/ci/kubernetes/data/template/daemonset";

            if( vm.tasktype == 'apply' )
            {
                url = "/api/ci/v2/kubernetes/app/json?ticketid=" + ticketid + "&type=daemonset&name=" + name + "&namespace=" + namespace;
            }

            $http.get(url).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.editData = data.data;

                   $scope.labels = [];
                   if( vm.editData.metadata.labels )
                   {
                       angular.forEach(vm.editData.metadata.labels, function (v, k) {
                           $scope.labels.push( { "K": k, "V": v })
                       });
                   }

                } else { 
                    toastr.error("加载模版信息失败:" + data.info)
                }
            });
            $http.get("/api/ci/kubernetes/data/template/container" ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.containerData = data.data;
                } else { 
                    toastr.error("加载container模版信息失败:" + data.info)
                }
            });
//亲和性用到namespace,不管什么情况下都先加载这个列表
//            if( vm.namespace === "" )
//            {
                $http.get("/api/ci/v2/kubernetes/namespace?ticketid=" + ticketid ).then(
                    function successCallback(response) {
                        if (response.data.stat){
                            vm.namespaces = response.data.data; 
                        }else {
                            toastr.error( "获取集群NAMESPACE数据失败："+response.data.info );
                        }
                    },
                    function errorCallback (response){
                        toastr.error( "获取集群NAMESPACE数据失败: " + response.status )
                    });
//            }
            $http.get("/api/ci/v2/kubernetes/util/labels/node?ticketid=" + ticketid ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.nodelabel = data.data;
                } else { 
                    toastr.error("加载node的label失败:" + data.info)
                }
            });
 
            $http.get("/api/ci/v2/kubernetes/util/labels/node_pod?ticketid=" + ticketid ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.nodepodlabel = data.data;
                } else { 
                    toastr.error("加载node和pod的label失败:" + data.info)
                }
            });
 
 
        };
        vm.reload();

        vm.gotostep0 = function(){
            $scope.editstep = 0; 
        };

        vm.gotostep1 = function(){
            vm.loadover = false;

            var d = {
                "data": vm.newyaml,
            };
            $http.post("/api/ci/kubernetes/data/yaml2json", d  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.editData = data.data


                   $scope.labels = [];
                   if( vm.editData.metadata.labels )
                   {
                       angular.forEach(vm.editData.metadata.labels, function (v, k) {
                           $scope.labels.push( { "K": k, "V": v })
                       });
                   }

                   vm.loadover = true;
                   $scope.editstep = 1; 
                } else { 
                   swal({ title:'YAML格式转换失败', text: data.info, type:'error' });
                }
            });
        };

        vm.gotostep2 = function(){
//labels
            var labels = {};
            angular.forEach($scope.labels, function (v, k) {
                var key = v["K"]
                labels[key] = v["V"];
            });

            if( Object.keys(labels).length > 0 )
            {
                vm.editData.metadata.labels = labels;
            }
            else
            {
                delete vm.editData.metadata.labels;
            }

            angular.forEach(vm.editData.spec.template.spec.containers, function (v, k) {
                delete v.tempcommandstring;
                delete v.tempargsstring;
            });

            if( vm.tasktype == 'create' )
            {
                vm.editData.spec.selector.matchLabels.app = vm.editData.metadata.name;
                vm.editData.spec.template.metadata.labels.app = vm.editData.metadata.name;
            }

            if( !( vm.editData.metadata.namespace && vm.editData.metadata.name ) )
            {
                swal({ title:'错误', text: "Namespace和Name不齐全", type:'error' });
                return;
            }

            if( vm.editData.kind !== 'DaemonSet' )
            {
                swal({ title:'错误', text: "kind不正确，必须为DaemonSet", type:'error' });
                return;
            }


            vm.loadover = false;
            $scope.editstep = 2; 

            var d = {
                "data": vm.editData,
            };
            $http.post("/api/ci/kubernetes/data/json2yaml", d  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.newyaml = data.data
                   $http.get("/api/ci/v2/kubernetes/app/yaml/always?ticketid=" + ticketid + "&type=" + vm.editData.kind + "&name=" + vm.editData.metadata.name + "&namespace=" + vm.editData.metadata.namespace ).success(function(data){
                        if(data.stat == true) 
                        { 
                            vm.oldyaml = data.data;
                            vm.diff();
                            vm.loadover = true;
                        } else { 
                            toastr.error("获取最新的配置信息失败:" + data.info)
                        }
                    });
 
                } else { 
                   swal({ title:'提交失败', text: data.info, type:'error' });
                }
            });
        };

        $scope.labels = [];

        vm.addLabel = function()
        {
            $scope.labels.push({ "K": "", "V": ""});
        }
        vm.delLabel = function(id)
        {
            $scope.labels.splice(id, 1);
        }
//Secret
        vm.autoGetSecret = function()
        {
            $http.get("/api/ci/v2/kubernetes/secret?ticketid=" + ticketid + "&namespace=" + vm.editData.metadata.namespace ).success(function(data){
                if(data.stat == true) 
                { 
                    if( data.data.length > 0 && ! vm.editData.spec.template.spec.imagePullSecrets )
                    {
                        vm.editData.spec.template.spec.imagePullSecrets = [];
                    }
 
                    angular.forEach(data.data, function (v, k) {
                        if( v.TYPE === "kubernetes.io/dockerconfigjson" )
                        {
                            vm.editData.spec.template.spec.imagePullSecrets.push({ "name": v.NAME });
                        }
                    });

                } else { 
                    toastr.error("加载secret信息失败:" + data.info)
                }
            });
        }
 
        vm.addSecret = function(name)
        {
            if( ! vm.editData.spec.template.spec.imagePullSecrets )
            {
                vm.editData.spec.template.spec.imagePullSecrets = [];
            }
            vm.editData.spec.template.spec.imagePullSecrets.push({ "name": name });
        }
        vm.delSecret = function(id)
        {
            vm.editData.spec.template.spec.imagePullSecrets.splice(id, 1);
        }
        vm.cleanSecret = function()
        {
            delete vm.editData.spec.template.spec.imagePullSecrets;
        }

        vm.createSecret = function (type,name,namespace) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/createsecret.html',
                controller: 'KubernetesCreateSecretController',
                controllerAs: 'kubernetescreatesecret',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return vm.editData.metadata.namespace},
                    ticketid: function () {return clusterinfo.id},
                    clusterinfo: function () {return clusterinfo},
                    reload: function () {return vm.addSecret },
                }
            });
        };

//NodeAffinity 节点亲和性调度
        vm.addNodeAffinity = function()
        {
            if( vm.editData.spec.template.spec.affinity === undefined || Object.keys(vm.editData.spec.template.spec.affinity).length == 0 )
            {
                vm.editData.spec.template.spec.affinity = {};
            }
            if( vm.editData.spec.template.spec.affinity.nodeAffinity === undefined || Object.keys(vm.editData.spec.template.spec.affinity.nodeAffinity).length == 0 )
            {
                vm.editData.spec.template.spec.affinity.nodeAffinity = {};
            }

            if( vm.editData.spec.template.spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution === undefined || Object.keys(vm.editData.spec.template.spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution).length == 0 )
            {
                vm.editData.spec.template.spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution = {};
            }

            if( vm.editData.spec.template.spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms === undefined || vm.editData.spec.template.spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms.length == 0 )
            {
                vm.editData.spec.template.spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms = [ { "matchExpressions": [ { "key": "", "operator": "In", "values": []}]} ];
            }
            else
            {
                vm.editData.spec.template.spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms[0].matchExpressions.push( { "key": "", "operator": "In", "values": [] } );
            }

        }

        vm.delNodeAffinity = function(id)
        {
            vm.editData.spec.template.spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms[0].matchExpressions.splice(id, 1);
        }

//PodAffinity。POD亲和性调度
        vm.addPodAffinity = function()
        {
            if( vm.editData.spec.template.spec.affinity === undefined || Object.keys(vm.editData.spec.template.spec.affinity).length == 0 )
            {
                vm.editData.spec.template.spec.affinity = {};
            }
            if( vm.editData.spec.template.spec.affinity.podAffinity === undefined || Object.keys(vm.editData.spec.template.spec.affinity.podAffinity).length == 0 )
            {
                vm.editData.spec.template.spec.affinity.podAffinity = {};
            }

            if( vm.editData.spec.template.spec.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution === undefined || vm.editData.spec.template.spec.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution.length == 0 )
            {
                vm.editData.spec.template.spec.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution = [ { "labelSelector": { "matchExpressions": [ { "key": "", "operator": "In", "values": [] } ] }, "namespaces": [], "topologyKey": ""} ];
            }
            else
            {
                vm.editData.spec.template.spec.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].labelSelector.matchExpressions.push( { "key": "", "operator": "In", "values": [] } );
            }

        }
        vm.delPodAffinity = function(id)
        {
            vm.editData.spec.template.spec.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].labelSelector.matchExpressions.splice(id, 1);
        }

//PodAntiAffinity  POD 反亲和性调度
        vm.addPodAntiAffinity = function()
        {
            if( vm.editData.spec.template.spec.affinity === undefined || Object.keys(vm.editData.spec.template.spec.affinity).length == 0 )
            {
                vm.editData.spec.template.spec.affinity = {};
            }
            if( vm.editData.spec.template.spec.affinity.podAntiAffinity === undefined || Object.keys(vm.editData.spec.template.spec.affinity.podAntiAffinity).length == 0 )
            {
                vm.editData.spec.template.spec.affinity.podAntiAffinity = {};
            }

            if( vm.editData.spec.template.spec.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution === undefined || vm.editData.spec.template.spec.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution.length == 0 )
            {
                vm.editData.spec.template.spec.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution = [ { "labelSelector": { "matchExpressions": [ { "key": "", "operator": "In", "values": [] } ] }, "namespaces": [], "topologyKey": ""} ];
            }
            else
            {
                vm.editData.spec.template.spec.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].labelSelector.matchExpressions.push( { "key": "", "operator": "In", "values": [] } );
            }

        }
        vm.delPodAntiAffinity = function(id)
        {
            vm.editData.spec.template.spec.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].labelSelector.matchExpressions.splice(id, 1);
        }

//tolerations 容忍/调度
        vm.addTolerations = function()
        {

            if( vm.editData.spec.template.spec.tolerations === undefined || vm.editData.spec.template.spec.tolerations.length == 0 )
            {
                vm.editData.spec.template.spec.tolerations = [];
            }
            vm.editData.spec.template.spec.tolerations.push( { "key": "", "operator": "Equal", "value": "", "effect": "NoSchedule" } );

        }
        vm.delTolerations = function(id)
        {
            vm.editData.spec.template.spec.tolerations.splice(id, 1);
        }

//Volume
        vm.addVolume = function( type )
        {
            var data = {}

            if( type === 'emptyDir' )
            {
                data = { "name": "", "emptyDir": {} }
            }

            if( type === 'hostPath' )
            {
                data = { "name": "", "hostPath": { "path": "" } }
            }

            if( type === 'nfs' )
            {
                data = { "name": "", "nfs": { "server":"", "path": "" } }
            }
            if( type === 'secret' )
            {
                data = { "name": "", "secret": { "secretName":"" } }
            }
            if( type === 'persistentVolumeClaim' )
            {
                data = { "name": "", "persistentVolumeClaim": { "claimName":"" } }
            }
            if( type === 'configMap' )
            {
                data = { "name": "", "configMap": { "name":"" } }
                //data = { "name": "", "configMap": { "name":"", "items": [ { "key": "", "path": "" } ] } }
            }
            if( ! vm.editData.spec.template.spec.volumes )
            {
                vm.editData.spec.template.spec.volumes = [];
            }

            vm.editData.spec.template.spec.volumes.push(data);
        }
        vm.delVolume = function(id)
        {
            vm.editData.spec.template.spec.volumes.splice(id, 1);
        }
        vm.cleanVolume = function()
        {
            delete vm.editData.spec.template.spec.volumes;
        }

//Command
        vm.addCommand = function(x, cmd)
        {
            if( ! x.command )
            {
                x.command = []
            }
            x.command.push(cmd)
            x.tempcommandstring = "";
        }

        vm.delCommand = function(x)
        {
            delete x.command;
            x.tempcommandstring = "";
        }

//Args
        vm.addArgs = function(x, args)
        {
            if( ! x.args )
            {
                x.args = []
            }
            x.args.push(args)
            x.tempargsstring = ""
        }

        vm.delArgs = function(x)
        {
            delete x.args;
            x.tempargsstring = ""
        }


//容器环境变量
        vm.addContainerEnv = function(x)
        {
            if( ! x.env )
            {
                x.env = []
            }
            x.env.push({"name":"","value":""})
        }
 
        vm.addContainerEnvConfigMap = function(x)
        {
            if( ! x.env )
            {
                x.env = []
            }
            x.env.push({"name": "", "valueFrom": { "configMapKeyRef": { "name": "", "key": "" } }})
        }
         vm.addContainerEnvSecret = function(x)
        {
            if( ! x.env )
            {
                x.env = []
            }
            x.env.push({"name": "", "valueFrom": { "secretKeyRef": { "name": "", "key": "" } }})
        }
 
        vm.delContainerEnv = function(x,id)
        {
            x.env.splice(id, 1);
        }
        vm.cleanContainerEnv = function(x)
        {
            delete x.env;
        }

//容器端口
        vm.addContainerPorts = function(x,protocol)
        {
            if( ! x.ports )
            {
                x.ports = []
            }
            x.ports.push({"name":"","protocol": protocol, "containerPort":80})
        }
        vm.delContainerPorts = function(x,id)
        {
            x.ports.splice(id, 1);
        }
        vm.cleanContainerPorts = function(x)
        {
            delete x.ports;
        }

//容器应用存活探针
        vm.addContainerlivenessProbeCmd = function(x)
        {
            x.livenessProbe = { "initialDelaySeconds": 30, "periodSeconds": 10, "timeoutSeconds": 5, "exec": { "command": [] }}
        }
        vm.addContainerlivenessProbeHttp = function(x)
        {
            x.livenessProbe = { "initialDelaySeconds": 30, "periodSeconds": 10, "timeoutSeconds": 5, "httpGet": { "path": "", "port": 8080, "scheme": "HTTP" }}
        }
         vm.addContainerlivenessProbePort = function(x)
        {
            x.livenessProbe = { "initialDelaySeconds": 30, "periodSeconds": 10, "timeoutSeconds": 5, "tcpSocket": { "port": 8080 }}
        }
 
        vm.cleanContainerlivenessProbe = function(x)
        {
            delete x.livenessProbe;
        }

//容器应用就绪探针
        vm.addContainerreadinessProbeCmd = function(x)
        {
            x.readinessProbe = { "initialDelaySeconds": 30, "periodSeconds": 10, "timeoutSeconds": 5, "exec": { "command": [] }}
        }
        vm.addContainerreadinessProbeHttp = function(x)
        {
            x.readinessProbe = { "initialDelaySeconds": 30, "periodSeconds": 10, "timeoutSeconds": 5, "httpGet": { "path": "", "port": 8080, "scheme": "HTTP" }}
        }
         vm.addContainerreadinessProbePort = function(x)
        {
            x.readinessProbe = { "initialDelaySeconds": 30, "periodSeconds": 10, "timeoutSeconds": 5, "tcpSocket": { "port": 8080 }}
        }
 
        vm.cleanContainerreadinessProbe = function(x)
        {
            delete x.readinessProbe;
        }

//容器数据卷
        vm.addContainerVolume = function(x)
        {
            if( ! x.volumeMounts )
            {
                x.volumeMounts = []
            }
            x.volumeMounts.push({"name":"","mountPath":""})
        }
        vm.addContainerVolumeFile = function(x)
        {
            if( ! x.volumeMounts )
            {
                x.volumeMounts = []
            }
            x.volumeMounts.push({"name":"","mountPath":"", "subPath": ""})
        }
        vm.delContainerVolume = function(x,id)
        {
            x.volumeMounts.splice(id, 1);
        }
        vm.cleanContainerVolume = function(x)
        {
            delete x.volumeMounts;
        }
//
        vm.addContainer = function()
        {
            var b = angular.copy(vm.containerData);
            vm.editData.spec.template.spec.containers.push(angular.copy(vm.containerData));
        }
 
        vm.delContainer = function(id)
        {
            vm.editData.spec.template.spec.containers.splice(id, 1);
        }

        vm.switchImagePullPolicy = function( container, type ){
            if( type ==='')
            {
                delete container['imagePullPolicy'];
            }
            else
            {
                container['imagePullPolicy'] = type;
            }
        };

//
        vm.addImageAddrByTicket = function (container) {
            vm.addImageAddrByTicket_set = function(repo) {
                container.name = repo
            }

            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/harborimage.html',
                controller: 'KubernetesHarborImageController',
                controllerAs: 'kubernetesharborimage',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    ticketid: function () {return ''},
                    homereload: function () {return vm.addImageAddrByTicket_set},
                }
            });
        };

        vm.apply = function(){
            vm.loadover = false;
            var d = {
                "ticketid": ticketid,
                "yaml": vm.newyaml,
            };
            $http.post("/api/ci/v2/kubernetes/app/" + vm.tasktype, d  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.cancel();
                   swal({ title:'提交成功', text: data.info, type:'success' });
                } else { 
                   swal({ title:'提交失败', text: data.info, type:'error' });
                }
            });
        };

        vm.assignment = function () {
            var postData = {
                "type": "kubernetes",
                "name": "kubernetes daemonset " + vm.tasktype,
                "handler": clusterinfo.create_user,
                "url": "/api/ci/v2/kubernetes/app/" + vm.tasktype,
                "method": "POST",
                "submit_reason": "",
                "remarks": "\n集群ID:" + ticketid + ";\n集群名称:" + clusterinfo.name +";\n配置:\n" + vm.newyaml,
                "data": {
                    "ticketid": ticketid,
                    "yaml": vm.newyaml,
                },
            };

            $uibModal.open({
                templateUrl: 'app/pages/assignment/assignmentcommit.html',
                controller: 'AssignmentCommitController',
                controllerAs: 'assignmentcommit',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    postData: function () {return postData},
                    homecancel: function () {return vm.cancel},
                }
            });
        };

        vm.oldyaml = "";
        vm.newyaml = "";

        vm.diffresultstring = "";
        vm.diff = function()
        {
            var diffresultstring = document.getElementById('diffresultstring');
            //三种diff类型，字符、单词、行 ，分别对应下面参数：diffChars  diffWords diffLines
            var diff = JsDiff["diffLines"](vm.oldyaml, vm.newyaml);

            var fragment = document.createDocumentFragment();
            for (var i=0; i < diff.length; i++) {

                if (diff[i].added && diff[i + 1] && diff[i + 1].removed) {
                    var swap = diff[i];
                    diff[i] = diff[i + 1];
                    diff[i + 1] = swap;
                }

                var node;
                if (diff[i].removed) {
                    node = document.createElement('del');
                    node.appendChild(document.createTextNode(diff[i].value));
                } else if (diff[i].added) {
                    node = document.createElement('ins');
                    node.appendChild(document.createTextNode(diff[i].value));
                } else {
                    node = document.createTextNode(diff[i].value);
                }
                fragment.appendChild(node);
            }

            diffresultstring.textContent = '';
            diffresultstring.appendChild(fragment);
        };
    }
})();

(function() {
    'use strict';

    KubernetesCreateConfigMapController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "clusterinfo", "namespace", "name"];
    angular
        .module('openc3')
        .controller('KubernetesCreateConfigMapController', KubernetesCreateConfigMapController);

    function KubernetesCreateConfigMapController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, clusterinfo, namespace, name ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        $scope.editstep = 1;

        vm.tasktype = 'create';
        if( namespace && name )
        {
            vm.tasktype = 'apply';
        }

        vm.reload = function(){
            vm.loadover = false;

            var url = "/api/ci/kubernetes/data/template/configmap";

            if( vm.tasktype == 'apply' )
            {
                url = "/api/ci/v2/kubernetes/app/json?ticketid=" + ticketid + "&type=configmap&name=" + name + "&namespace=" + namespace;
            }

            $http.get(url).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.editData = data.data;

                   $scope.labels = [];
                   if( vm.editData.metadata.labels )
                   {
                       angular.forEach(vm.editData.metadata.labels, function (v, k) {
                           $scope.labels.push( { "K": k, "V": v })
                       });
                   }

                   vm.configMapData = [];

                   angular.forEach(vm.editData.data, function (v, k) {
                       vm.configMapData.push({"key": k, "val": v});
                   });


                } else { 
                    swal({ title:'加载模版信息失败', text: data.info, type:'error' });
                    vm.cancel();
                }
            });

            if( vm.tasktype == 'create' )
            {
            $http.get("/api/ci/v2/kubernetes/namespace?ticketid=" + ticketid ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.namespaces = response.data.data; 
                    }else {
                        toastr.error( "获取集群NAMESPACE数据失败："+response.data.info );
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取集群NAMESPACE数据失败: " + response.status )
                });
            }
        };
        vm.reload();

        vm.gotostep0 = function(){
            $scope.editstep = 0; 
        };


        vm.gotostep1 = function(){
            vm.loadover = false;

            var d = {
                "data": vm.newyaml,
            };
            $http.post("/api/ci/kubernetes/data/yaml2json", d  ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.editData = data.data

                    $scope.labels = [];
                    if( vm.editData.metadata.labels )
                    {
                        angular.forEach(vm.editData.metadata.labels, function (v, k) {
                            $scope.labels.push( { "K": k, "V": v })
                        });
                    }

                    vm.configMapData = [];

                    angular.forEach(vm.editData.data, function (v, k) {
                        vm.configMapData.push({"key": k, "val": v});
                    });

                    vm.loadover = true;
                    $scope.editstep = 1; 
                } else { 
                   swal({ title:'YAML格式转换失败', text: data.info, type:'error' });
                }
            });

        };

        vm.gotostep2 = function(){
//labels
            var labels = {};
            angular.forEach($scope.labels, function (v, k) {
                var key = v["K"]
                labels[key] = v["V"];
            });


            if( Object.keys(labels).length > 0 )
            {
                vm.editData.metadata.labels = labels;
            }
            else
            {
                delete vm.editData.metadata.labels;
            }

//datas
            var datas = {};

            angular.forEach(vm.configMapData, function (v, k) {
                var key = v["key"]
                datas[key] = v["val"];
            });

            if( Object.keys(datas).length > 0 )
            {
                vm.editData.data = datas;
            }
            else
            {
                delete vm.editData.data;
            }

            if( !( vm.editData.metadata.namespace && vm.editData.metadata.name ) )
            {
                swal({ title:'错误', text: "Namespace和Name不齐全", type:'error' });
                return;
            }

            if( vm.editData.kind !== 'ConfigMap' )
            {
                swal({ title:'错误', text: "kind不正确，必须为ConfigMap", type:'error' });
                return;
            }

 
            $scope.editstep = 2; 
            vm.loadover = false;

            var d = {
                "data": vm.editData,
            };
            $http.post("/api/ci/kubernetes/data/json2yaml", d  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.newyaml = data.data

                   $http.get("/api/ci/v2/kubernetes/app/yaml/always?ticketid=" + ticketid + "&type=" + vm.editData.kind + "&name=" + vm.editData.metadata.name + "&namespace=" + vm.editData.metadata.namespace ).success(function(data){
                        if(data.stat == true) 
                        { 
                            vm.oldyaml = data.data;
                            vm.diff();
                            vm.loadover = true;
                        } else { 
                            toastr.error("获取最新的配置信息失败:" + data.info)
                        }
                    });

                } else { 
                   swal({ title:'提交失败', text: data.info, type:'error' });
                }
            });
        };


//labels
        $scope.labels = [];

        vm.addLabel = function()
        {
            $scope.labels.push({ "K": "", "V": ""});
        }
        vm.delLabel = function(id)
        {
            $scope.labels.splice(id, 1);
        }

//configMapData
        vm.configMapData = [];
        vm.addData = function()
        {
            vm.configMapData.push({"key": "", "val": ""})
        }
 
        vm.delData = function(id)
        {
            vm.configMapData.splice(id, 1);
        }


        vm.apply = function(){
            vm.loadover = false;
            var d = {
                "ticketid": ticketid,
                "yaml": vm.newyaml,
            };
            $http.post("/api/ci/v2/kubernetes/app/" + vm.tasktype, d  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.cancel();
                   swal({ title:'提交成功', text: data.info, type:'success' });
                } else { 
                   swal({ title:'提交失败', text: data.info, type:'error' });
                }
            });
        };

        vm.assignment = function () {
            var postData = {
                "type": "kubernetes",
                "name": "kubernetes ConfigMap " + vm.tasktype,
                "handler": clusterinfo.create_user,
                "url": "/api/ci/v2/kubernetes/app/" + vm.tasktype,
                "method": "POST",
                "submit_reason": "",
                "remarks": "\n集群ID:" + ticketid + ";\n集群名称:" + clusterinfo.name +";\n配置:\n" + vm.newyaml,
                "data": {
                    "ticketid": ticketid,
                    "yaml": vm.newyaml,
                },
            };

            $uibModal.open({
                templateUrl: 'app/pages/assignment/assignmentcommit.html',
                controller: 'AssignmentCommitController',
                controllerAs: 'assignmentcommit',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    postData: function () {return postData},
                    homecancel: function () {return vm.cancel},
                }
            });
        };


        vm.oldyaml = "";
        vm.newyaml = "";

        vm.diffresultstring = "";
        vm.diff = function()
        {
            var diffresultstring = document.getElementById('diffresultstring');
            //三种diff类型，字符、单词、行 ，分别对应下面参数：diffChars  diffWords diffLines
            var diff = JsDiff["diffLines"](vm.oldyaml, vm.newyaml);

            var fragment = document.createDocumentFragment();
            for (var i=0; i < diff.length; i++) {

                if (diff[i].added && diff[i + 1] && diff[i + 1].removed) {
                    var swap = diff[i];
                    diff[i] = diff[i + 1];
                    diff[i + 1] = swap;
                }

                var node;
                if (diff[i].removed) {
                    node = document.createElement('del');
                    node.appendChild(document.createTextNode(diff[i].value));
                } else if (diff[i].added) {
                    node = document.createElement('ins');
                    node.appendChild(document.createTextNode(diff[i].value));
                } else {
                    node = document.createTextNode(diff[i].value);
                }
                fragment.appendChild(node);
            }

            diffresultstring.textContent = '';
            diffresultstring.appendChild(fragment);
        };

    }
})();

(function () {
    'use strict';
    CopyProjectByTemplateXXController.$inject = ["$http", "$uibModalInstance", "$scope", "resoureceService", "treeid", "reload", "sourcename", "cancel", "$injector", "clusterinfo", "type", "name", "namespace"];
    angular
        .module('openc3')
        .controller('CopyProjectByTemplateXXController', CopyProjectByTemplateXXController);

    function CopyProjectByTemplateXXController($http, $uibModalInstance, $scope, resoureceService, treeid, reload, sourcename, cancel, $injector, clusterinfo, type, name, namespace ) {

        var vm = this;
        vm.status = 0
        $scope.projectname = sourcename
        var toastr = toastr || $injector.get('toastr');

        vm.containerlist = [];
        vm.templatelist = [];
        vm.flowlinelist = [];
        vm.reload = function(){
            vm.loadover = false;
            $http.get("/api/ci/v2/kubernetes/app/flowlineinfo?ticketid=" + clusterinfo.id + "&type=" + type + "&name=" + name + "&namespace=" + namespace  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.containerlist = data.data;
                } else { 
                    toastr.error("加载容器列表失败:" + data.info)
                }
            });
            $http.get("/api/ci/group/0" ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.templatelist = data.data;

                    angular.forEach(vm.templatelist, function (value, key) {
                        if( value.name ==  "kubernetes发布模版" )
                        {
                            vm.templateid = value.id;
                        }
                   });
 
                } else { 
                    toastr.error("加载模版列表失败:" + data.info)
                }
            });
 
            $http.get("/api/ci/group/" + treeid ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.flowlinelist = data.data;
                } else { 
                    toastr.error("加载流水线列表失败:" + data.info)
                }
            });
 
        };
        vm.reload();

        vm.cancel = function(){ $uibModalInstance.dismiss(); };
        vm.add = function(){

            var container = {};
            angular.forEach(vm.containerlist, function (value, key) {
                if( value.id ==  vm.containerid )
                {
                    container = value;
                }
            });
 
            var sourceid = vm.templateid;

//TODO 检查container 和sourceid。数据不全要报错
            var s = 0
            if ( vm.status )
            {
                s = 1
            }

            var postData = {
                "name": $scope.projectname,
                "sourceid": sourceid,
                "status": s,

                "ci_type": "kubernetes",
                "ci_type_ticketid": clusterinfo.id,
                "ci_type_kind": type,
                "ci_type_namespace": namespace,
                "ci_type_name": name,
                "ci_type_container": container.container,
                "ci_type_repository": container.repository,
                "ci_type_dockerfile": "dockerfile",
                "ci_type_dockerfile_content": "",
            };
            $http.post('/api/ci/group/' + treeid , postData ).success(function(data){
                vm.install = { username: 'root' };
                    if(data.stat == true) {
                        var toid = data.id

                        $http.post('/api/job/jobs/' + treeid  + '/copy/byname', { fromname: '_ci_' + sourceid+'_', toname: '_ci_' + toid + '_', fromprojectid: 0 } ).success(function(data){
                            vm.install = { username: 'root' };
                                if(data.stat == true) {
                                    $http.post('/api/jobx/group/' + treeid  + '/copy/byname', { fromname: '_ci_test_' + sourceid+'_', toname: '_ci_test_' + toid + '_', fromprojectid: 0 } ).success(function(data){
                                        vm.install = { username: 'root' };
                                            if(data.stat == true) {
                                                $http.post('/api/jobx/group/' + treeid  + '/copy/byname', { fromname: '_ci_online_' + sourceid+'_', toname: '_ci_online_' + toid + '_', fromprojectid: 0 } ).success(function(data){
                                                    vm.install = { username: 'root' };
                                                        if(data.stat == true) {
                                                            vm.cancel();
                                                            cancel();
                                                            reload();
                                                        } else { toastr.error( "提交失败:" + data.info ); }
                                                });
                                            } else { toastr.error( "提交失败:" +data.info ); }
                                    });
                                } else { toastr.error( "提交失败:" + data.info ); }
                        });
                    } else { toastr.error("提交失败:" + data.info ); }
            });
        };


        vm.connect = function(){

            var container = {};
            angular.forEach(vm.containerlist, function (value, key) {
                if( value.id ==  vm.containerid )
                {
                    container = value;
                }
            });
 
            var postData = {
                "ci_type": "kubernetes",
                "ci_type_ticketid": clusterinfo.id,
                "ci_type_kind": type,
                "ci_type_namespace": namespace,
                "ci_type_name": name,
                "ci_type_container": container.container,
                "ci_type_repository": container.repository,
                "ci_type_dockerfile": "dockerfile",
                "ci_type_dockerfile_content": "",
            };
            $http.post('/api/ci/group/connectk8s/' + treeid + '/' + vm.flowlineid, postData ).success(function(data){
                if(data.stat == true) {
                    vm.cancel(); cancel(); reload();
                } else { toastr.error("关联失败:" + data.info ); }
            });
        };

    }
})();


(function() {
    'use strict';

    KubernetesConfigMapController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "clusterinfo", "namespace"];
    angular
        .module('openc3')
        .controller('KubernetesConfigMapController', KubernetesConfigMapController);

    function KubernetesConfigMapController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, clusterinfo, namespace ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.namespace = namespace;
        vm.clusterinfo = clusterinfo;
        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.reload = function(){
            vm.loadover = false;
            $http.get("/api/ci/v2/kubernetes/configmap?ticketid=" + ticketid + "&namespace=" + namespace ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.nodeTable = new ngTableParams({count:25}, {counts:[],data:data.data});
                } else { 
                    toastr.error("加载secret信息失败:" + data.info)
                }
            });

        };
        vm.reload();
 
        vm.deleteApp = function (type,name,namespace) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/deleteapp.html',
                controller: 'KubernetesDeleteAppController',
                controllerAs: 'kubernetesdeleteapp',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return ticketid},
                    clusterinfo: function () {return clusterinfo},
                }
            });
        };

        vm.describe = function (type,name,namespace) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/describe.html',
                controller: 'KubernetesDescribeController',
                controllerAs: 'kubernetesdescribe',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return clusterinfo.id},
                }
            });
        };

        vm.edityaml = function (type,name,namespace) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/edityaml.html',
                controller: 'KubernetesEditYamlController',
                controllerAs: 'kubernetesedityaml',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    type: function () {return type},
                    name: function () {return name},
                    namespace: function () {return namespace},
                    ticketid: function () {return clusterinfo.id},
                    clusterinfo: function () {return clusterinfo},
                }
            });
        };

        vm.createConfigMap = function (namespace,name) {
            $uibModal.open({
                templateUrl: 'app/pages/kubernetesmanage/createconfigmap.html',
                controller: 'KubernetesCreateConfigMapController',
                controllerAs: 'kubernetescreateconfigmap',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    ticketid: function () {return clusterinfo.id},
                    clusterinfo: function () {return clusterinfo},
                    namespace: function () {return namespace},
                    name: function () {return name},
                }
            });
        };

    }
})();

(function() {
    'use strict';

    KubernetesApplyController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "ticketid", "clusterinfo"];
    angular
        .module('openc3')
        .controller('KubernetesApplyController', KubernetesApplyController);

    function KubernetesApplyController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, ticketid, clusterinfo ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

var demo = {
"cm": `
apiVersion: v1
items:
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: test0
  data:
    key1: apple
- kind: ConfigMap
  apiVersion: v1
  metadata:
    name: test1
  data:
    key2: apple
kind: ConfigMapList
metadata: {}
`,

"deploy_serverside": `
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: "1"
    kubectl.kubernetes.io/last-applied-configuration: '{"kind":"Deployment","apiVersion":"apps/v1","metadata":{"name":"nginx-deployment","creationTimestamp":null,"labels":{"name":"nginx"}},"spec":{"selector":{"matchLabels":{"name":"nginx"}},"template":{"metadata":{"creationTimestamp":null,"labels":{"name":"nginx"}},"spec":{"containers":[{"name":"nginx","image":"nginx","resources":{}}]}},"strategy":{}},"status":{}}'
  creationTimestamp: "2016-10-24T22:15:06Z"
  generation: 6
  labels:
    name: nginx
  name: nginx-deployment
  namespace: test
  resourceVersion: "355959"
  selfLink: /apis/extensions/v1beta1/namespaces/test/deployments/nginx-deployment
  uid: 51ac266e-9a37-11e6-8738-0800270c4edc
spec:
  replicas: 1
  selector:
    matchLabels:
      name: nginx
  strategy:
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 1
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        name: nginx
    spec:
      containers:
      - image: nginx
        imagePullPolicy: Always
        name: nginx
        resources: {}
        terminationMessagePath: /dev/termination-log
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      securityContext: {}
      terminationGracePeriodSeconds: 30
status:
  availableReplicas: 1
  observedGeneration: 6
  replicas: 1
  updatedReplicas: 1
`,
};

      
        vm.demo = function( name ){
            vm.yaml = demo[name];
        };

        vm.apply = function(){
            vm.loadover = false;
            var d = {
                "ticketid": ticketid,
                "yaml": vm.yaml,
            };
            $http.post("/api/ci/v2/kubernetes/app/create", d  ).success(function(data){
                if(data.stat == true) 
                { 
                   vm.loadover = true;
                   vm.cancel();
                   swal({ title:'提交成功', text: data.info, type:'success' });
                } else { 
                   swal({ title:'提交失败', text: data.info, type:'error' });
                }
            });
        };

        vm.assignment = function () {
            var postData = {
                "type": "kubernetes",
                "name": "kubernetes创建应用",
                "handler": clusterinfo.create_user,
                "url": "/api/ci/v2/kubernetes/app/create",
                "method": "POST",
                "submit_reason": "",
                "remarks": "\n集群ID:" + ticketid + ";\n集群名称:" + clusterinfo.name +";\n配置:\n" + vm.yaml,
                "data": {
                    "ticketid": ticketid,
                    "yaml": vm.yaml,
                },
            };

            $uibModal.open({
                templateUrl: 'app/pages/assignment/assignmentcommit.html',
                controller: 'AssignmentCommitController',
                controllerAs: 'assignmentcommit',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () {return vm.treeid},
                    postData: function () {return postData},
                    homecancel: function () {return vm.cancel},
                }
            });
        };


    }
})();

(function() {
    'use strict';

    LoginController.$inject = ["$scope", "$state", "$http", "$injector"];
    angular
        .module('openc3')
        .controller('LoginController', LoginController);

    function LoginController($scope, $state, $http, $injector) {
        var vm = this;
        var toastr = toastr || $injector.get('toastr');

        vm.post
        vm.logining
        vm.login = function()
        {
            vm.logining = 1;
            $http.post('/api/connector/default/user/login', vm.post ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        $state.go('home.dashboard', {treeid:-1});
                    }else {
                        toastr.error('登录失败!');
                    }
                    vm.logining = 0;
                },
                function errorCallback (response){
                    toastr.error('接口错误!');
                    vm.logining = 0;
                }
            );
 
        }
    }
})();

(function() {
    'use strict';

    HistoryController.$inject = ["$http"];
    angular
        .module('openc3')
        .controller('HistoryController', HistoryController);

    /** @ngInject */
    function HistoryController($http) {

        var vm = this;


    }
})();


(function() {
    'use strict';

    GlobalController.$inject = ["$rootScope", "$state"];
    angular
        .module('openc3')
        .controller('GlobalController', GlobalController);

    function GlobalController($rootScope, $state) {

    }
})();

(function() {
    'use strict';

    GitreportController.$inject = ["$scope", "$state", "$http", "treeService", "ngTableParams", "$injector", "$timeout", "genericService"];
    angular
        .module('openc3')
        .controller('GitreportController', GitreportController);

    function GitreportController($scope, $state, $http, treeService, ngTableParams, $injector, $timeout, genericService) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        vm.selecteduser = $state.params.user;
        if( vm.selecteduser == undefined )
        {
            vm.selecteduser = ''
        }

        vm.selectedproject = $state.params.project;
        if( vm.selectedproject == undefined )
        {
            vm.selectedproject = ''
        }

        vm.selecteddata = $state.params.data;
        if( vm.selecteddata == undefined )
        {
            vm.selecteddata = 'current'
        }


        var toastr = toastr || $injector.get('toastr');

        vm.userlist = [];
        vm.taskdatetime = [];
        vm.tasksuccess = [];
        vm.taskall = [];
        vm.treeid = $state.params.treeid;
        vm.state = $state;
        vm.updatetime;

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.filteruser = function (username, datalist, project ) {
            $state.go('home.gitreportfilterdata', {treeid:vm.treeid, user: username, project: project, data: datalist});
        }


        $scope.choiceName = vm.selecteduser;
        $scope.choiceProject = vm.selectedproject;
        $scope.choiceData = vm.selecteddata;
        $scope.$watch('choiceName', function () {
                vm.filteruser( $scope.choiceName, $scope.choiceData, $scope.choiceProject )
        });

        $scope.$watch('choiceProject', function () {
                vm.filteruser( $scope.choiceName, $scope.choiceData, $scope.choiceProject )
        });

        $scope.$watch('choiceData', function () {
                vm.filteruser( $scope.choiceName, $scope.choiceData, $scope.choiceProject )
        });

 
        vm.reload = function () {
            $http.get('/api/ci/gitreport/' + vm.treeid + "/datalist?" ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.datalist = response.data.data; 
                    }else {
                        toastr.error( "获取数据失败："+response.data.info );
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取数据失败: " + response.status )
                });

            $http.get('/api/ci/gitreport/' + vm.treeid + "/report?user=" + vm.selecteduser + "&data=" + vm.selecteddata + "&project=" + vm.selectedproject ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        $scope.userCount = response.data.data.usercount;
                        $scope.codeAddCount = response.data.data.addcount;
                        $scope.codeDelCount = response.data.data.delcount;
                        $scope.commitCount = response.data.data.commitcount;
                        vm.userlist = response.data.data.userlist; 
                        vm.projectlist = response.data.data.projectlist; 

                        vm.showRuntime2(response.data.data.pingtu);
                        vm.showRuntime3(response.data.data.pingtu2);
                        vm.showRuntime6(response.data.data.pingtu3);
                        vm.showRuntime7(response.data.data.pingtu4);
                        vm.data_Table = new ngTableParams({count:1000}, {counts:[],data:response.data.data.detailtable.reverse()});

                        vm.taskdatetime = [];
                        vm.taskall = [];
                        vm.tasksuccess = [];

                        vm.taskdatetime2 = [];
                        vm.taskall2 = [];
                        vm.tasksuccess2 = [];

                        vm.taskdatetime3 = [];
                        vm.taskall3 = [];
                        vm.tasksuccess3 = [];

                        vm.updatetime = response.data.data.updatetime;

                        angular.forEach(response.data.data.change, function (oneday, index) {
                            vm.taskdatetime.push(oneday[0]);
                            vm.taskall.push(oneday[1]);
                            vm.tasksuccess.push(oneday[2]);
                        });

                        angular.forEach(response.data.data.change2, function (oneday, index) {
                            vm.taskdatetime2.push(oneday[0]);
                            vm.taskall2.push(oneday[1]);
                            vm.tasksuccess2.push(oneday[2]);
                        });

                        angular.forEach(response.data.data.change3, function (oneday, index) {
                            vm.taskdatetime3.push(oneday[0]);
                            vm.taskall3.push(oneday[1]);
                            vm.tasksuccess3.push(oneday[2]);
                        });

                        vm.show30Task(vm.taskdatetime, vm.tasksuccess,vm.taskall)
                        vm.show30Task2(vm.taskdatetime2, vm.tasksuccess2,vm.taskall2)
                        vm.show30Task3(vm.taskdatetime3, vm.tasksuccess3,vm.taskall3)
                    }else {
                        toastr.error( "获取数据失败："+response.data.info );
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取数据失败: " + response.status )
                });
        };

        vm.reload();

        vm.show30Task = function (datetimes, okcounts, allcounts) {
            
            var opt =  {
                chart: {
                    type: 'spline'
                },
                title: {
                    text: '日期分布'
                },
                subtitle: {
                    text: ''
                },
                xAxis: {
                    categories: datetimes
                },
                yAxis: {
                    title: {
                        text: ''
                    },
                    labels: {
                        formatter: function () {
                            return this.value ;
                        }
                    }
                },
                tooltip: {
                    crosshairs: true,
                    shared: true
                },
                plotOptions: {
                    spline: {
                        marker: {
                            radius: 4,
                            lineColor: '#666666',
                            lineWidth: 1
                        }
                    }
                },
                series: [{
                    name: '添加(行)',
                    marker: {
                        symbol: 'diamond'
                    },
                    color: 'green',
                    data: allcounts
                }, {
                    name: '删除(行)',
                    marker: {
                        symbol: 'square'
                    },
                    color: 'red',
                    data: okcounts
                }]
            };
            Highcharts.chart('container', opt );
        };

        vm.show30Task2 = function (datetimes, okcounts, allcounts) {
            
            var opt =  {
                chart: {
                    type: 'spline'
                },
                title: {
                    text: '时间点分布'
                },
                subtitle: {
                    text: ''
                },
                xAxis: {
                    categories: datetimes
                },
                yAxis: {
                    title: {
                        text: ''
                    },
                    labels: {
                        formatter: function () {
                            return this.value ;
                        }
                    }
                },
                tooltip: {
                    crosshairs: true,
                    shared: true
                },
                plotOptions: {
                    spline: {
                        marker: {
                            radius: 4,
                            lineColor: '#666666',
                            lineWidth: 1
                        }
                    }
                },
                series: [{
                    name: '添加(行)',
                    marker: {
                        symbol: 'diamond'
                    },
                    color: 'green',
                    data: allcounts
                }, {
                    name: '删除(行)',
                    marker: {
                        symbol: 'square'
                    },
                    color: 'red',
                    data: okcounts
                }]
            };
            Highcharts.chart('container4', opt );
        };



        vm.show30Task3 = function (datetimes, okcounts, allcounts) {
            
            var opt =  {
                chart: {
                    type: 'spline'
                },
                title: {
                    text: '星期分布'
                },
                subtitle: {
                    text: ''
                },
                xAxis: {
                    categories: datetimes
                },
                yAxis: {
                    title: {
                        text: ''
                    },
                    labels: {
                        formatter: function () {
                            return this.value ;
                        }
                    }
                },
                tooltip: {
                    crosshairs: true,
                    shared: true
                },
                plotOptions: {
                    spline: {
                        marker: {
                            radius: 4,
                            lineColor: '#666666',
                            lineWidth: 1
                        }
                    }
                },
                series: [{
                    name: '添加(行)',
                    marker: {
                        symbol: 'diamond'
                    },
                    color: 'green',
                    data: allcounts
                }, {
                    name: '删除(行)',
                    marker: {
                        symbol: 'square'
                    },
                    color: 'red',
                    data: okcounts
                }]
            };
            Highcharts.chart('container5', opt );
        };


        vm.showRuntime2 = function (times) {
            $('#container2').highcharts({
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false
                },
                title: {
                    text: ''
                },
                tooltip: {
                    headerFormat: '{series.name}<br>',
                    pointFormat: '{point.name}: <b>{point.percentage:.1f}%</b>'
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: true,
                            format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                            style: {
                                color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                            }
                        }
                    }
                },
                series: [{
                    type: 'pie',
                    name: '',
                    data: times
                }]
            });
        };

        vm.showRuntime3 = function (times) {
            $('#container3').highcharts({
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false
                },
                title: {
                    text: ''
                },
                tooltip: {
                    headerFormat: '{series.name}<br>',
                    pointFormat: '{point.name}: <b>{point.percentage:.1f}%</b>'
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: true,
                            format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                            style: {
                                color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                            }
                        }
                    }
                },
                series: [{
                    type: 'pie',
                    name: '',
                    data: times
                }]
            });
        };

        vm.showRuntime6 = function (times) {
            $('#container6').highcharts({
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false
                },
                title: {
                    text: ''
                },
                tooltip: {
                    headerFormat: '{series.name}<br>',
                    pointFormat: '{point.name}: <b>{point.percentage:.1f}%</b>'
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: true,
                            format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                            style: {
                                color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                            }
                        }
                    }
                },
                series: [{
                    type: 'pie',
                    name: '',
                    data: times
                }]
            });
        };
        vm.showRuntime7 = function (times) {
            $('#container7').highcharts({
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false
                },
                title: {
                    text: ''
                },
                tooltip: {
                    headerFormat: '{series.name}<br>',
                    pointFormat: '{point.name}: <b>{point.percentage:.1f}%</b>'
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: true,
                            format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                            style: {
                                color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                            }
                        }
                    }
                },
                series: [{
                    type: 'pie',
                    name: '',
                    data: times
                }]
            });
        };



    }

})();

(function() {
    'use strict';

    FlowreportController.$inject = ["$scope", "$state", "$http", "treeService", "ngTableParams", "$injector", "$timeout", "genericService"];
    angular
        .module('openc3')
        .controller('FlowreportController', FlowreportController);

    function FlowreportController($scope, $state, $http, treeService, ngTableParams, $injector, $timeout, genericService) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        vm.selecteduser = $state.params.user;
        if( vm.selecteduser == undefined )
        {
            vm.selecteduser = ''
        }

        vm.selecteddata = $state.params.data;
        if( vm.selecteddata == undefined )
        {
            vm.selecteddata = 'current'
        }


        vm.siteaddr = window.location.protocol + '//' + window.location.host;

        var toastr = toastr || $injector.get('toastr');

        vm.userlist = [];
        vm.taskdatetime = [];
        vm.rollbackcount = [];
        vm.deploycount = [];
        vm.cicount = [];
        vm.testcount = [];
        vm.treeid = $state.params.treeid;
        vm.state = $state;
        vm.updatetime;

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.filteruser = function (username, datalist ) {
            $state.go('home.flowreportfilterdata', {treeid:vm.treeid, user: username, data: datalist});
        }

        $scope.choiceName = vm.selecteduser;
        $scope.choiceData = vm.selecteddata;
        $scope.$watch('choiceName', function () {
                vm.filteruser( $scope.choiceName, $scope.choiceData )
        });


        $scope.$watch('choiceData', function () {
                vm.filteruser( $scope.choiceName, $scope.choiceData )
        });

 
        vm.reload = function () {
            $http.get('/api/ci/flowreport/' + vm.treeid + "/datalist?" ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.datalist = response.data.data; 
                    }else {
                        toastr.error( "获取数据失败："+response.data.info );
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取数据失败: " + response.status )
                });

            $http.get('/api/ci/flowreport/' + vm.treeid + "/report?user=" + vm.selecteduser + "&data=" + vm.selecteddata ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        $scope.ciCount = response.data.data.cicount;
                        $scope.testCount = response.data.data.testcount;
                        $scope.deployCount = response.data.data.deploycount;
                        $scope.rollbackCount = response.data.data.rollbackcount;
                        $scope.commitCount = response.data.data.commitcount;
                        vm.userlist = response.data.data.userlist; 

                        vm.data_Table = new ngTableParams({count:1000}, {counts:[],data:response.data.data.detailtable.reverse()});

                        vm.taskdatetime = [];
                        vm.cicount = [];
                        vm.testcount = [];
                        vm.deploycount = [];
                        vm.rollbackcount = [];

                        vm.updatetime = response.data.data.updatetime;

                        angular.forEach(response.data.data.change, function (oneday, index) {
                            vm.taskdatetime.push(oneday[0]);
                            vm.cicount.push(oneday[1]);
                            vm.testcount.push(oneday[2]);
                            vm.deploycount.push(oneday[3]);
                            vm.rollbackcount.push(oneday[4]);
                        });

                        vm.show30Task(vm.taskdatetime, vm.cicount, vm.testcount, vm.rollbackcount, vm.deploycount )
                    }else {
                        toastr.error( "获取数据失败："+response.data.info );
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取数据失败: " + response.status )
                });
        };

        vm.reload();

        vm.show30Task = function (datetimes, cicounts, testcounts, rollbackcounts, deploycounts) {
            
            var opt =  {
                chart: {
                    type: 'spline'
                },
                title: {
                    text: ''
                },
                subtitle: {
                    text: ''
                },
                xAxis: {
                    categories: datetimes
                },
                yAxis: {
                    title: {
                        text: ''
                    },
                    labels: {
                        formatter: function () {
                            return this.value ;
                        }
                    }
                },
                tooltip: {
                    crosshairs: true,
                    shared: true
                },
                plotOptions: {
                    spline: {
                        marker: {
                            radius: 4,
                            lineColor: '#666666',
                            lineWidth: 1
                        }
                    }
                },
                series: [ {
                    name: '构建',
                    marker: {
                        symbol: 'diamond'
                    },
                    color: 'blue',
                    data: cicounts
                }, {
                    name: '测试',
                    marker: {
                        symbol: 'diamond'
                    },
                    color: 'gray',
                    data: testcounts
                }, {
                    name: '发布',
                    marker: {
                        symbol: 'diamond'
                    },
                    color: 'green',
                    data: deploycounts
                }, {
                    name: '回滚',
                    marker: {
                        symbol: 'square'
                    },
                    color: 'red',
                    data: rollbackcounts
                }]
            };
            Highcharts.chart('container', opt );
        };


    }

})();

(function() {
    'use strict';

    FavoritesController.$inject = ["$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$websocket", "$injector", "genericService", "$scope"];
    angular
        .module('openc3')
        .controller('FavoritesController', FavoritesController);

    function FavoritesController($location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $websocket, $injector,genericService, $scope) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');
        vm.time2date = genericService.time2date
        vm.seftime = genericService.seftime

        $scope.panelcolor = { "success": "green", "fail": "red", "running": "#98b2bc", "decision": "#aaa", "ignore": "#aaa" }

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.openws = function()
        {
            vm.siteaddr = window.location.host;

            var wsH = "ws://"
            if ( window.location.protocol == 'https:' )
            {
                wsH = "wss://"
            }
            var urlMySocket = wsH + vm.siteaddr + "/api/ci/slave/"+ vm.project.slave +"/ws?uuid="+ vm.treeid;
            vm.ws = $websocket(urlMySocket);

            vm.logDetail = '';
            vm.ws.onOpen(function (){
               console.log("opening ws");
            });

             vm.ws.onMessage(function (message) {
                 if(  message.data == 'wsresetws' )
                 {
                     vm.logDetail = '';
                 }
                 else
                 {
                     vm.logDetail = vm.logDetail + message.data
                 }

             });

             vm.ws.onError(function (message) {
                 toastr.error('打开日志失败')
             });

        }

        vm.versiondetail = function (groupid,id) {
            $state.go('home.quickentry.flowlinedetail', {treeid:groupid, projectid: id});
        };

        vm.treedetail = function (id) {
            $state.go('home.quickentry.flowline', {treeid: id});
        };

        vm.editconfig = function (id) {
            $uibModal.open({
                templateUrl: 'app/pages/config/config.html',
                controller: 'ConfigController',
                controllerAs: 'config',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    getGroup: function () {return vm.getGroupInfo},
                    projectid: function () {return id},
                    treeid: function () {return vm.treeid},
                    groupid: function () {},
                }
            });
        };

        vm.reload = function(){
            vm.loadover = false;
            $http.get('/api/ci/group/favorites/' + vm.treeid ).success(function(data){
                if(data.stat == true) 
                { 
                    var mtree = []
                    var htree = {}
                    angular.forEach(data.data, function (value, key) {
                        if( ! htree[value.groupid] )
                        {
                            htree[value.groupid] = 1
                            mtree.push(value.groupid)
                        }
                    });
                    if( mtree.length )
                    {
                        vm.getTaskInfo(mtree.join(","));
                    }

                    vm.activeRegionTable = new ngTableParams({count:20}, {counts:[],data:data.data.reverse()});
                    vm.loadover = true;
                } else { 
                    toastr.error( "加载版本失败:" + data.info )
                }
            });
        };

        vm.reload();

        vm.loadfindtags_at_onceover = true;
        vm.findtags_at_once = function(){
            vm.loadfindtags_at_onceover = false;
            $http.put('/api/ci/project/' + vm.treeid + '/findtags_at_once' ).success(function(data){
                if(data.stat == true) 
                {
                    vm.loadfindtags_at_onceover = true;
                } else { 
                    toastr.error( "触发寻找tag失败:" + data.info );
                }
            });
        };

        vm.showlog = function(versionuuid,slave){
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/flowline/showlog.html',
                controller: 'CiShowLogController',
                controllerAs: 'showlog', 
                backdrop: 'static', 
                size: 'lg', 
                keyboard: false,
                bindToController: true,
                resolve: {
                    nodeStr: function () { return vm.nodeStr },
                    reloadhome: function () { return vm.reload },
                    versionuuid: function () { return versionuuid },
                    slave: function () { return slave }
                }
            });
        };

        vm.deployDetail = function(treeid, uuid){
            $state.go('home.history.jobxdetail', {treeid:treeid, taskuuid:uuid, accesspage:true});
        };

        vm.addToFavorites = function (id, name) {
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/flowline/addToFavorites.html',
                controller: 'AddToFavoritesController',
                controllerAs: 'addToFavorites',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () { return vm.treeid},
                    sourceid: function () { return id},
                    sourcename: function () { return name},
                    reload : function () { return vm.reload}
                }
            });
        };


        vm.delToFavorites = function(id) {
          swal({
            title: "取消收藏",
            text: "取消",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){
            $http.delete('/api/ci/favorites/' + vm.treeid + '?ciid=' + id ).success(function(data){
                if( data.stat)
                {
                    vm.reload();
                }
                else
                {
                    toastr.error("取消收藏失败:" + data.info)
                }
            });
          });
        }

        vm.addFavorites = function () {
            $uibModal.open({
                templateUrl: 'app/pages/favorites/addFavorites.html',
                controller: 'AddFavoritesController',
                controllerAs: 'addfavorites',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () { return vm.treeid},
                    homereload : function () { return vm.reload}
                }
            });
        };


        vm.taskInfoTest = {}
        vm.taskInfoOnline = {}

        vm.taskInfoTestRunning = {}
        vm.taskInfoOnlineRunning = {}

        vm.getTaskInfo = function (treeId) {
            $http.get('/api/jobx/task/' + treeId + '?allowslavenull=1&name=_ci_' ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        angular.forEach(response.data.data, function (value, key) {

                        var projectid = vm.cprojectid( value.name );
                        var version = vm.cversion( value.variable );
                        var jobtype = vm.cjobtype( value.variable );
                        value.version = version

                        if( value.slave != '_null_' && jobtype == 'test' )
                        {
                            vm.taskInfoTest[projectid] = value
                            if( value.status == 'running' )
                            {
                                vm.taskInfoTestRunning[projectid] = 1
                            }
                        }

                        if( value.slave != '_null_' && jobtype == 'online' )
                        {
                            vm.taskInfoOnline[projectid] = value
                            if( value.status == 'running' )
                            {
                                vm.taskInfoOnlineRunning[projectid] = 1
                            }
                        }

                        });
                    }else {
                        toastr.error( "获取数据失败:" + response.data.info )
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取数据失败:" + response.status )
                });
        };

        vm.cprojectid = function(text) {
            var w = text.split("_");
            if(w[1] == 'ci' && w[0] == '' && w[3] == '' )
            {
                return w[2]
            }
            else
            {
                return ''
            }
        }

 
        vm.cversion = function(text) {
            var w = '';
            var re=/\bversion:.*/;
            if (re.test(text)){
                var reStr = re.exec(text)[0];
                w = reStr.split(" ")[1]
                var xx = /'/;
                if( xx.test(w) )
                {
                    w = w.split("'")[1]
                }
            }
            return w
        }

        vm.cjobtype = function(text) {
            var w = '';
            var re=/\b_jobtype_:.*/;
            if (re.test(text)){
                var reStr = re.exec(text)[0];
                w = reStr.split(" ")[1]
                var xx = /'/;
                if( xx.test(w) )
                {
                    w = w.split("'")[1]
                }
            }
            return w
        }

        vm.deployType = function (uuid){
            uuid = uuid.slice(uuid.length - 1);
            if (64 < uuid.charCodeAt(0) && uuid.charCodeAt(0) < 91) {
                return '回滚'
            } else {
                return '发布'
            }
        };

    }
})();

(function() {
    'use strict';

    AddFavoritesController.$inject = ["$uibModalInstance", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "homereload", "$injector"];
    angular
        .module('openc3')
        .controller('AddFavoritesController', AddFavoritesController);

    function AddFavoritesController( $uibModalInstance, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, homereload, $injector ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.cancel = function(){ $uibModalInstance.dismiss(); homereload();};

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });


        vm.reload = function(){
            vm.loadover = false;
            $http.get('/api/ci/group/all/' + vm.treeid ).success(function(data){
                if(data.stat == true) 
                { 
                    vm.activeRegionTable = new ngTableParams({count:20}, {counts:[],data:data.data.reverse()});
                    vm.loadover = true;
                } else { 
                    toastr.error( "加载版本失败:" + data.info );
                }
            });
        };

        vm.reload();

        vm.addToFavorites = function (id, name) {
            $uibModal.open({
                templateUrl: 'app/pages/quickentry/flowline/addToFavorites.html',
                controller: 'AddToFavoritesController',
                controllerAs: 'addToFavorites',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    treeid: function () { return vm.treeid},
                    sourceid: function () { return id},
                    sourcename: function () { return name},
                    reload : function () { return vm.reload}
                }
            });
        };

        vm.delToFavorites = function(id) {
          swal({
            title: "取消收藏",
            text: "取消",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText: "取消",
            confirmButtonText: "确定",
            closeOnConfirm: true
          }, function(){
            $http.delete('/api/ci/favorites/' + vm.treeid + '?ciid=' + id ).success(function(data){
                if(data.stat){
                    vm.reload();
                }else{
                    toastr.error( "取消收藏失败:" + data.info )
                }
            });
          });
        }

    }
})();

(function() {
    'use strict';

    DashboardController.$inject = ["$scope", "$state", "$http", "treeService", "ngTableParams", "$injector", "$timeout", "genericService"];
    angular
        .module('openc3')
        .controller('DashboardController', DashboardController);

    function DashboardController($scope, $state, $http, treeService, ngTableParams, $injector, $timeout, genericService) {

        var vm = this;
        vm.treeid = $state.params.treeid;

        var toastr = toastr || $injector.get('toastr');

        if( vm.treeid < 0 )
        {
            //var defaulttreeid = 0
            //var demotreeid = 0
            $http.get( '/api/connector/connectorx/treemap' ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        //angular.forEach(response.data.data, function (d, index) {
                        //
                        //    var re=/_demo$/;
                        //    if(re.test(d.name))
                        //    {
                        //        if( d.id > demotreeid )
                        //        {
                        //            demotreeid = d.id
                        //        }
                        //    }
                        //    if( d.id > defaulttreeid )
                        //    {
                        //        defaulttreeid = d.id
                        //    }
                        //});

                        //if( demotreeid )
                        //{
                        //    defaulttreeid = demotreeid
                        //}
                        //if( defaulttreeid )
                        //{
                        //    $state.go('home.dashboard', {treeid: defaulttreeid});
                        //}
                        //else
                        //{
                        //    toastr.error( "没找到默认的服务树节点" )
                        //}
                        $state.go('home.dashboard', {treeid: 4000000000});
                    }else {
                        toastr.error( "获取服务树失败:" + response.data.info )
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取服务树失败:" + response.status )
                });
            return;
        }

        vm.taskdatetime = [];
        vm.seftime = genericService.seftime
        vm.statuszh = { "": "等待执行", "success": "执行成功", "fail": "执行失败", "decision": "执行失败", "running": "执行中", "ignore": "忽略", "waiting": "等待中" }
        vm.tasksuccess = [];
        vm.taskall = [];
        vm.runminites = [];
        vm.treeid = $state.params.treeid;
        vm.state = $state;

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.getDetailData = function () {
            $http.get('/api/job/nodeinfo/' + vm.treeid + "/count" ).then(
                function successCallback(response) {

                    if (response.data.stat){
                        $scope.businessCount = response.data.data.node;
                    }else {
                        toastr.error( "获取机器数量失败:" + response.data.info )
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取机器数量失败:" + response.status )
                });
            $http.get('/api/job/jobs/' + vm.treeid + "/count" ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        $scope.commonCount = response.data.data.permanent;
                    }else {
                        toastr.error( "获取作业数量失败:" + response.data.info )
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取作业数量失败:" + response.status )
                });
            $http.get('/api/job/task/' + vm.treeid + "/count" ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        $scope.fail = response.data.data.fail;
                        $scope.success = response.data.data.success;
                        $scope.running = response.data.data.running;
                        $scope.monthTask = $scope.fail+$scope.success+$scope.running
                    }else {
                        toastr.error( "获取作业子任务数量失败:" + response.data.info )
                    }
                },
                function errorCallback (response){
                        toastr.error( "获取作业子任务数量失败:" + response.data.info )
                });
            $http.get('/api/job/crontab/' + vm.treeid + "/count" ).then(
                function successCallback(response) {

                    if (response.data.stat){
                        $scope.unavailable = response.data.data.unavailable;
                        $scope.available = response.data.data.available;
                        $scope.crontCount = $scope.unavailable + $scope.available;
                    }else {
                        toastr.error( "获取定时任务数量失败:" + response.data.info )
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取定时任务数量失败:" + response.status )
                });
        };

        vm.get30Task = function () {
            $http.get('/api/job/task/' + vm.treeid + "/analysis/date" ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.all30task = response.data.data;
                        angular.forEach(vm.all30task, function (oneday, index) {
                            vm.taskdatetime.push(oneday[0]);
                            vm.taskall.push(oneday[1]);
                            vm.tasksuccess.push(oneday[2]);
                        });
                        vm.show30Task(vm.taskdatetime, vm.tasksuccess,vm.taskall)
                    }else {
                        toastr.error( "获取作业信息失败："+response.data.info );
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取作业信息失败: " + response.status )
                });
        };

        vm.getLastTask = function () {
            $http.get('/api/job/task/' + vm.treeid + "/analysis/last" ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.data_Table = new ngTableParams({count:10}, {counts:[],data:response.data.data});
                    }else {
                        toastr.error( "获取作业信息失败："+response.data.info )
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取作业信息失败: " + response.status )
                });
        };

        vm.get30Runtime = function () {
            $http.get('/api/job/task/' + vm.treeid + "/analysis/runtime" ).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.allruntime = response.data.data;
                        angular.forEach(vm.allruntime, function (value, key) {
                            if(key == "0-1"){
                                vm.runminites.push(['0-1分钟', parseFloat(value)])
                            }else if(key == "1-3"){
                                vm.runminites.push(['1-3分钟', parseFloat(value)])
                            }
                            else if(key == "3-5"){
                                vm.runminites.push(['3-5分钟', parseFloat(value)])
                            }
                            else if(key == "5-10"){
                                vm.runminites.push(['5-10分钟', parseFloat(value)])
                            }
                            else if(key == "10-30"){
                                vm.runminites.push(['10-30分钟', parseFloat(value)])
                            }
                            else if(key == "30+"){
                                vm.runminites.push(['30+分钟', parseFloat(value)])
                            }

                        }); 
                            vm.showRuntime(vm.runminites);
                    }else {
                        toastr.error( "获取作业信息失败："+response.data.info )
                    }
                },
                function errorCallback (response){
                    toastr.error( "获取作业信息失败: " + response.status )
                });
        };

        vm.getDetailData();
        vm.get30Runtime();
        vm.get30Task();
        vm.getLastTask();

        vm.ciinfo = {}
        vm.getCiInfo = function () {
            $http.get('/api/ci/group/' + vm.treeid).success(function(data){
                if(data.stat)
                {
                    angular.forEach(data.data, function (value, key) {
                        vm.ciinfo['_ci_'+value.id+'_'] = value.name
                    });
                }
                else
                {
                    toastr.error( "加载流水线名称失败:" + data.info )
                }
            });
        }
        vm.getCiInfo();

        vm.show30Task = function (datetimes, okcounts, allcounts) {
            Highcharts.chart('container', {
                chart: {
                    type: 'spline'
                },
                title: {
                    text: ''
                },
                subtitle: {
                    text: ''
                },
                xAxis: {
                    categories: datetimes
                },
                yAxis: {
                    title: {
                        text: ''
                    },
                    labels: {
                        formatter: function () {
                            return this.value ;
                        }
                    }
                },
                tooltip: {
                    crosshairs: true,
                    shared: true
                },
                plotOptions: {
                    spline: {
                        marker: {
                            radius: 4,
                            lineColor: '#666666',
                            lineWidth: 1
                        }
                    }
                },
                series: [{
                    name: '执行成功（个）',
                    marker: {
                        symbol: 'square'
                    },
                    data: okcounts
                }, {
                    name: '总数',
                    marker: {
                        symbol: 'diamond'
                    },
                    data: allcounts
                }]
            });

        };

        vm.showRuntime = function (times) {
            $('#container2').highcharts({
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false
                },
                title: {
                    text: ''
                },
                tooltip: {
                    headerFormat: '{series.name}<br>',
                    pointFormat: '{point.name}: <b>{point.percentage:.1f}%</b>'
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: true,
                            format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                            style: {
                                color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                            }
                        }
                    }
                },
                series: [{
                    type: 'pie',
                    name: '',
                    data: times
                }]
            });
        };

    }

})();

(function() {
    'use strict';

    ConnectorController.$inject = ["$http"];
    angular
        .module('openc3')
        .controller('ConnectorController', ConnectorController);

    /** @ngInject */
    function ConnectorController($http) {

        var vm = this;


    }
})();


(function() {
    'use strict';

    BusinessController.$inject = ["$rootScope", "$state", "treeService"];
    angular
        .module('openc3')
        .controller('BusinessController', BusinessController);

    /** @ngInject */
    function BusinessController($rootScope, $state, treeService) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        vm.state = $state;

        treeService.sync.then(function(){

            var zTree = $.fn.zTree.getZTreeObj('openc3tree');
            var treeNode = zTree.getNodeByParam('id', $state.params.treeid);
            if(treeNode == null){
                //$state.go('home.e401');
                return;
            }

        });

        $rootScope.$on('$stateChangeSuccess', function(){

            vm.treeid = $state.params.treeid;
            vm.state = $state;
        });
    }

})();

(function() {
    'use strict';

    AssignmentCommitController.$inject = ["$uibModalInstance", "$location", "$anchorScroll", "$state", "$http", "$uibModal", "treeService", "ngTableParams", "resoureceService", "$scope", "$injector", "postData", "homecancel"];
    angular
        .module('openc3')
        .controller('AssignmentCommitController', AssignmentCommitController);

    function AssignmentCommitController( $uibModalInstance, $location, $anchorScroll, $state, $http, $uibModal, treeService, ngTableParams, resoureceService, $scope, $injector, postData, homecancel ) {

        var vm = this;
        vm.treeid = $state.params.treeid;
        var toastr = toastr || $injector.get('toastr');

        vm.postData = postData;

        vm.cancel = function(){ $uibModalInstance.dismiss(); };

        treeService.sync.then(function(){
            vm.nodeStr = treeService.selectname();
        });

        vm.commit = function(){
//            var pd = {
//                "type": "kubernetes",
//                "name": "修改副本数",
//                "handler": "open-c3",
//                "url": "/api/ci/kubernetes/app/setreplicas",
//                "method": "POST",
//                "submit_reason": "balabala...",
//                "remarks": "balabala...",
//                "data": {
//                    "ticketid": 'ticketid',
//                    "type": 'type',
//                    "name": 'name',
//                    "namespace": 'namespace',
//                    "replicas": 'vm.replicas',
//                }
//            };
            $http.post("/api/ci/assignment", postData  ).success(function(data){
                if(data.stat == true)
                {
                    vm.cancel();
                    homecancel();
                    swal({ title:'提交操作协助申请成功', text: '请到个人协助操作页面查看历史', type:'success' });
                } else {
                    swal({ title:'提交失败', text: data.info, type:'success' });
                }
            });
        };

    }
})();

(function() {
    'use strict';

    AssignmentController.$inject = ["$http", "ngTableParams", "$uibModal", "genericService"];
    angular
        .module('openc3')
        .controller('AssignmentController', AssignmentController);

    function AssignmentController($http, ngTableParams, $uibModal, genericService) {
        var vm = this;
        vm.seftime = genericService.seftime
        vm.edit = function(id,show){
            $uibModal.open({
                templateUrl: 'app/pages/assignment/edit/edit.html',
                controller: 'AssignmentEditController',
                controllerAs: 'assignmentedit',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    uuid : function () { return 0},
                    id : function () { return id},
                    show : function () { return show},
                    homereload : function () { return vm.reloadB},
                }
            });
        };

        vm.reloadA = function () {
            vm.loadoverA = false;
            $http.get('/api/ci/assignment/byme').success(function(data){
                if (data.stat){
                    vm.bymeTable = new ngTableParams({count:10}, {counts:[],data:data.data});
                    vm.loadoverA = true;
                }else {
                    swal({ title:'获取列表失败', text: data.info, type:'error' });
                }
            });
        };

        vm.reloadB = function () {
            vm.loadoverB = false;
            $http.get('/api/ci/assignment/tome').success(function(data){
                if (data.stat){
                    vm.tomeTable = new ngTableParams({count:10}, {counts:[],data:data.data});
                    vm.loadoverB = true;
                }else {
                    swal({ title:'获取列表失败', text: data.info, type:'error' });
                }
            });

        };

        vm.reloadA();
        vm.reloadB();

        vm.commit = function (commitdata, oldstatus) {
            $http.get('/api/ci/assignment/' + commitdata.id ).success(function(data){
                if (data.stat){
                    if(  data.data.status === oldstatus )
                    {
                        $http.post(commitdata.url, commitdata.data ).success(function(data){
                            if (data.stat){
                                vm.updateStatus( commitdata.id, 'success');
                            }else {
                                vm.updateStatus( commitdata.id, 'fail');
                                swal({ title:'提交失败', text: data.info, type:'error' });
                            }
                        });
                    }
                    else
                    {
                        swal({ title:'数据已经变更', text: "数据在您提交之前状态已经改变，请刷新确认。", type:'error' });
                    }
                }else {
                    swal({ title:'获取协助详情失败', text: data.info, type:'error' });
                }
            });
        };

        vm.updateStatus = function (id, stat) {
            $http.post('/api/ci/assignment/' + id, { "status": stat} ).success(function(data){
                if (data.stat){
                    if( stat === 'cancel' )
                    {
                        vm.reloadA();
                    }
                    else
                    {
                        vm.reloadB();
                    }
                }else {
                    swal({ title:'获取列表失败', text: data.info, type:'error' });
                }
            });

        };

    }
})();

(function() {
    'use strict';

    ApprovalController.$inject = ["$http", "ngTableParams", "$uibModal", "genericService"];
    angular
        .module('openc3')
        .controller('ApprovalController', ApprovalController);

    function ApprovalController($http, ngTableParams, $uibModal, genericService) {
        var vm = this;
        vm.seftime = genericService.seftime
        vm.edit = function(uuid,show){
            $uibModal.open({
                templateUrl: 'app/pages/approval/edit/edit.html',
                controller: 'ApprovalEditController',
                controllerAs: 'approvaledit',
                backdrop: 'static',
                size: 'lg',
                keyboard: false,
                bindToController: true,
                resolve: {
                    uuid : function () { return uuid},
                    show : function () { return show},
                    homereload : function () { return vm.reload},
                }
            });
        };

        vm.reload = function () {
            vm.loadover = false;
            $http.get('/api/job/approval').success(function(data){
                if (data.stat){
                    vm.dataTable = new ngTableParams({count:25}, {counts:[],data:data.data});
                    vm.loadover = true;
                }else {
                    swal({ title:'获取列表失败', text: data.info, type:'error' });
                }
            });
        };
        vm.reload();
    }
})();

(function () {
    'use strict';
    ChoiceVarController.$inject = ["$uibModalInstance", "$timeout", "$state", "$http", "$scope"];
    angular
        .module('openc3')
        .controller('ChoiceVarController', ChoiceVarController);

    function ChoiceVarController($uibModalInstance,$timeout,$state, $http, $scope) {

        var vm = this;
        var ss = window.location.href;
        if(ss.split("#")[1].indexOf("/distribute/") !=-1){
            $scope.ciData = {
                'ci':"",
                'version':""
            };
        }else {
            $scope.ciData = {
                'ci':"default",
                'version':"$version"
            };
        }


        vm.treeid = $state.params.treeid;
        vm.cancel = function(){ $uibModalInstance.dismiss()};
        vm.chioceover = function(){
            $uibModalInstance.close(
                $scope.ciData
            );
        };



    }
})();


(function() {
    'use strict';

    angular
        .module('openc3')
        .factory('ssoService', ssoService);

    function ssoService() {

        var sso = 
        {
            'main': '/',
            'login': '/api/connector/connectorx/sso/loginredirect',
            'chpasswd': '/api/connector/connectorx/sso/chpasswdredirect',
            'logout': '#'
        };

        return sso;
    }

})();

(function() {
    'use strict';

    angular
        .module('openc3')
        .factory('scriptId', scriptId);

    function scriptId() {
        var scriptID = '';
        var _setter = function (data) {
            scriptID = data;
        };
        var _getter = function () {
            return scriptID;
        };
        var _del = function () {
            scriptID = null;
        };
        return {
            setter: _setter,
            getter: _getter,
            del: _del,
        }

    }
    
    
})();
(function() {
    'use strict';

    angular
        .module('openc3')
        .directive('cmscript', cmscript);

    /** @ngInject */
    function cmscript() {
        CreateS.$inject = ["$rootScope", "treeService", "$uibModal"];
        var directive = {

            restrict: 'E',
            templateUrl: 'app/components/scripts/createButton.html',
            scope: {},
            controller: CreateS,
            controllerAs: 'creat'
        };

        return directive;

        /** @ngInject */
        function CreateS($rootScope, treeService, $uibModal) {

            var vm = this;


            vm.creats = function(){
                $uibModal.open({
                    templateUrl: 'app/components/scripts/createScript.html',
                    controller: 'CreateScript',
                    controllerAs: 'c',
                    backdrop: 'static',
                    size: 'lg',
                    keyboard: false,
                    bindToController: true,
                    resolve: {
                        dst: function () { return vm.tree }
                    }
                });
            }

        }
    }

})();

(function () {
    'use strict';
    CreateScript.$inject = ["$uibModalInstance", "$scope", "$state", "$http", "$timeout", "resoureceService", "reloadindex", "msg", "edit"];
    angular
        .module('openc3')
        .controller('CreateScript', CreateScript);

    /** @ngInject */
    function CreateScript($uibModalInstance,$scope,$state,$http,$timeout, resoureceService, reloadindex, msg, edit) {

        var vm = this;
        $scope.dataready = true;
        vm.cancel = function(){ $uibModalInstance.dismiss()};
        vm.treeid = $state.params.treeid;
        if (edit == "true"){
            $scope.editStatus = true;
        }
        vm.getAllScript = function () {
            vm.scriptHide = true;
            if (vm.treeid){
                $http.get('/api/job/scripts/' + vm.treeid).then(
                    function successCallback(response) {
                        vm.scriptHide = true;
                        if (response.data.stat){
                            $scope.dataready = true;
                            $scope.allScript = response.data.data;
                        }else {
                            $scope.dataready = false;
                            $scope.dataerror = "获取脚本信息失败："+response.data.info;
                        }
                    },
                    function errorCallback (response){
                        $scope.dataready = false;
                        $scope.dataerror =  "获取脚本信息失败: " + response.status
                    });
            }
        };
        vm.save = function(){
            var scriptMsg = vm.inputValue();
            if (edit == "false"){
                if (!vm.from){
                    alert("脚本来源必选！");
                    return
                }
                if(!scriptMsg.type){
                    alert("脚本类型必选");
                    return
                }else if (!scriptMsg.cont){
                    alert("脚本内容不能为空");
                    return
                }
                resoureceService.script.create(vm.treeid,scriptMsg, null).finally(function(){
                    vm.cancel();
                    reloadindex(vm.treeid);

                });
            }else if (edit == "true"){
                vm.scriptid = msg.id;
                resoureceService.script.change([vm.treeid, vm.scriptid],scriptMsg, null).finally(function(){
                    vm.cancel();
                    reloadindex(vm.treeid);
                });
            }

        };

        vm.editorSh = function (data, re) {
            vm.shEditor = ace.edit("editor");
            var sheditor  = vm.shEditor;
            sheditor.setTheme("ace/theme/dracula");
            sheditor.session.setMode("ace/mode/sh");
            document.getElementById('editor').style.fontSize='14px';
            sheditor.setShowPrintMargin(false);
            sheditor.setHighlightActiveLine(false);
            if (data){
                sheditor.setValue(data);
            }
            if (re){
                sheditor.setReadOnly(true)
            }
        };
        vm.editorPy = function (data, re) {
            vm.pyEditor = ace.edit("editor");
            var pyeditor = vm.pyEditor;
            pyeditor.setTheme("ace/theme/dracula");
            pyeditor.session.setMode("ace/mode/python");
            document.getElementById('editor').style.fontSize='14px';
            pyeditor.setShowPrintMargin(false);
            pyeditor.setHighlightActiveLine(false);
            if (data){
                pyeditor.setValue(data);
            }
            if (re){
                pyeditor.setReadOnly(true)
            }
        };
        vm.editorPerl = function (data, re) {
            vm.perlEditor = ace.edit("editor");
            var perleditor = vm.perlEditor;
            perleditor.setTheme("ace/theme/dracula");
            perleditor.session.setMode("ace/mode/perl");
            document.getElementById('editor').style.fontSize='14px';
            document.getElementById('editor').style.font='14px';
            perleditor.setShowPrintMargin(false);
            perleditor.setHighlightActiveLine(false);
            if (data){
                perleditor.setValue(data);
            }
            if (re){
                perleditor.setReadOnly(true)
            }
        };
        vm.editorPhp = function (data, re) {
            vm.phpEditor = ace.edit("editor");
            var phpeditor = vm.phpEditor;
            phpeditor.setTheme("ace/theme/dracula");
            phpeditor.session.setMode("ace/mode/perl");
            document.getElementById('editor').style.fontSize='14px';
            document.getElementById('editor').style.font='14px';
            phpeditor.setShowPrintMargin(false);
            phpeditor.setHighlightActiveLine(false);
            if (data){
                phpeditor.setValue(data);
            }
            if (re){
                phpeditor.setReadOnly(true)
            }
        };
        vm.editorBuildin = function (data, re) {
            vm.buildinEditor = ace.edit("editor");
            var buildineditor = vm.buildinEditor;
            buildineditor.setTheme("ace/theme/dracula");
            buildineditor.session.setMode("ace/mode/sh");
            document.getElementById('editor').style.fontSize='14px';
            document.getElementById('editor').style.font='14px';
            buildineditor.setShowPrintMargin(false);
            buildineditor.setHighlightActiveLine(false);
            if (data){
                buildineditor.setValue(data);
            }
            if (re){
                buildineditor.setReadOnly(true)
            }
        };
 
        vm.editorAuto = function (data, re) {
            vm.autoeditor = ace.edit("editor");
            var autoeditor  = vm.autoeditor;
            autoeditor.setTheme("ace/theme/dracula");
            autoeditor.session.setMode("ace/mode/sh");
            document.getElementById('editor').style.fontSize='14px';
            autoeditor.setShowPrintMargin(false);
            autoeditor.setHighlightActiveLine(false);
            if (data){
                autoeditor.setValue(data);
            }
            if (re){
                autoeditor.setReadOnly(true)
            }
        };
        vm.scriptTypeEditor = {
            "shell": vm.editorSh,
            "python": vm.editorPy,
            "perl": vm.editorPerl,
            "php": vm.editorPhp,
            "buildin": vm.editorBuildin,
            "auto": vm.editorAuto,
        };

        vm.click = '';
        vm.scriptManual =function () {

            if (vm.click != "manual"){
                // if ($scope.scriptType){
                ace.edit("editor").setValue('');
                ace.edit("editor").setReadOnly(false);
                $scope.unClick = false;
                // }
            }
            vm.scriptHide = true;
            vm.click = "manual";
        };
        vm.from = 'manual';

        vm.scriptClone =function () {
            if (vm.click != "clone"){
                vm.scriptHide = false;
                $scope.selectedScript = '';
                ace.edit("editor").setValue('');
                ace.edit("editor").setReadOnly(false);
                $scope.scriptType = "";
            }
            vm.click = "clone";

        };


        vm.inputValue = function() {

            var scriptMsg = {'type':'', 'cont':''};

            if ($scope.scriptType == 'shell'){
                scriptMsg['type'] = 'shell';
                scriptMsg['cont'] = vm.shEditor.getValue();
            }else if($scope.scriptType == 'python'){
                scriptMsg['type'] = 'python';
                scriptMsg['cont'] = vm.pyEditor.getValue();
            }else if($scope.scriptType == 'perl'){
                scriptMsg['type'] = 'perl';
                scriptMsg['cont'] = vm.perlEditor.getValue();
            }else if($scope.scriptType == 'php'){
                scriptMsg['type'] = 'php';
                scriptMsg['cont'] = vm.phpEditor.getValue();
            }else if($scope.scriptType == 'buildin'){
                scriptMsg['type'] = 'buildin';
                scriptMsg['cont'] = vm.buildinEditor.getValue();
            }else if($scope.scriptType == 'auto'){
                scriptMsg['type'] = 'auto';
                scriptMsg['cont'] = vm.autoeditor.getValue();
            }
            scriptMsg['name'] = $scope.scriptName;
            return scriptMsg
        };
        vm.inputScript = function () {
            // get script by id and set selected id.
            vm.selected_id = $scope.selectedScript.id;
            $http.get('/api/job/scripts/' + vm.treeid + "/" + vm.selected_id).success(function(data){
                if (data.stat){

                    var inputEdit = vm.scriptTypeEditor[data.data.type];
                    var scriptData = data.data;
                    if (vm.from == "clone"){
                        inputEdit(data.data.cont, false);

                    }else if (vm.from == "local"){
                        inputEdit(data.data.cont, true);
                        vm.s_name = scriptData.name;
                    }
                    $scope.scriptType = data.data.type;
                }
            });
        };

        vm.getAllScript();

        if (msg){
            $scope.scriptName = msg.name;
            $scope.scriptType = msg.type;
            if(msg.type=="shell"){
                $timeout(vm.editorSh, 500,true,msg.cont, false);
            }else if (msg.type=="python"){
                $timeout(vm.editorPy, 500,true,msg.cont, false);
            }else if (msg.type=="perl"){
                $timeout(vm.editorPerl, 500,true,msg.cont, false);
            }else if (msg.type=="php"){
                $timeout(vm.editorPhp, 500,true,msg.cont, false);
            }else if (msg.type=="buildin"){
                $timeout(vm.editorBuildin, 500,true,msg.cont, false);
            }else if (msg.type=="auto"){
                $timeout(vm.editorAuto, 500,true,msg.cont, false);
            }
            vm.from = "local";
            $scope.unClick = true;

        }
        else {
            $scope.scriptType = "shell";
            $timeout(vm.editorSh, 500,true,"", false);
        }

    }
})();


(function () {
    'use strict';
    angular
        .module('openc3')
        .directive('nodestr', nodeStr);

    function nodeStr() {
        var directive = {

            restrict: 'E',
            templateUrl: 'app/components/nodestr/nodeStr.html',
            scope: {},
            controller: nodeStr,
            controllerAs: 'node'
        };

        return directive;

        function nodeStr(treeService) {

            var vm = this;

            treeService.sync.then(function(){      // when the tree was success.

                vm.nodeStr = treeService.selectname();  // get tree name
            });
        }
    }

})();


(function() {
    'use strict';

    angular
        .module('openc3')
        .directive('cmnavbar', cmnavbar);

    /** @ngInject */
    function cmnavbar() {
        NavbarController.$inject = ["$scope", "$location", "$http", "$state", "treeService", "$window", "ssoService"];
        var directive = {

            restrict: 'E',
            templateUrl: 'app/components/navbar/navbar.html',
            scope: {},
            controller: NavbarController,
            controllerAs: 'nav'
        };

        return directive;

        /** @ngInject */
        function NavbarController($scope, $location, $http, $state, treeService, $window, ssoService) {

            var vm = this;
            vm.zTree = '';
            treeService.sync.then(function(data) {
      
              vm.zTree = $.fn.zTree.getZTreeObj('openc3tree');
            });
              vm.select_map = {};
              vm.search_init = function () {
                vm.names = [];
                $http.get('/api/connector/connectorx/treemap').success(function (data) {
                  vm.name = data.data;
                  angular.forEach(vm.name, function (value) {
                    vm.names.push(value.name);
                    vm.select_map[value.name] = value.id;
                  });
                });
              };
      
            vm.searchNode = function (item, model, label, event){
              var node = vm.zTree.getNodeByParam("id", vm.select_map[item]);
              vm.zTree.selectNode(node);
              vm.zTree.expandNode(node);
              vm.search_init(event)
            };

            $scope.envir = 'test';
            $scope.allUrls = [ ];
            $scope.nextUrls = { };
            $scope.mulUrls = { };
            $scope.ciUrls = { };
            vm.logout = function(){
                var siteaddr = window.location.protocol + '//' + window.location.host;
                $http.get('/api/connector/connectorx/ssologout?siteaddr=' + siteaddr ).success(function(data){
                    if(data.data)
                    {
                        $window.location.href=data.data
                    }
                    else
                    {
                        $window.location.reload();
                    }
                });
            };

            vm.chpasswd = function(){
                var siteaddr = window.location.protocol + '//' + window.location.host;
                $window.location.href=ssoService.chpasswd + '?siteaddr=' + siteaddr ;
            };

            vm.state = $state;
            vm.state.params.treeid = vm.state.params.treeid ? vm.state.params.treeid : -1;

            // get user
            $http.get('/api/connector/connectorx/sso/userinfo').success(function(data){
                vm.user = data;
            });

            var hash = $location.host();
            var envir = hash.split(".")[0];
            var envir_name = hash.split(".")[1];

            if (envir == 'dev' || envir == 'test'){
                $scope.envir = 'test';
            }else if(envir == "orionstar"){
                $scope.envir = "orionstar";
            }else if(envir == "htorionstar"){
                $scope.envir = "htorionstar";
            }else{
                $scope.envir = 'online';
            }


            // if (hash.indexOf("ci") != -1 && hash.indexOf("liveme") != -1){
            //     $scope.allUrls = [];
            // }

            vm.openCI = function (idx, next_name) {
                var ciurl = $scope.ciUrls[$scope.envir][idx].url + "/#/dashboard/" + vm.state.params.treeid;
                if ($scope.envir == "test"){
                    window.open(ciurl, '_blank');
                    return
                }
                if (envir != next_name){
                    window.open(ciurl, '_blank')
                }else {
                    return
                }

            };
            vm.openMul = function (idx, next_name) {
                var ciurl = $scope.mulUrls[$scope.envir][idx].url + vm.state.params.treeid;
                if ($scope.envir == "test"){
                    window.open(ciurl, '_blank');
                    return
                }
                if (envir != next_name){
                    window.open(ciurl, '_blank')
                }else {
                    return
                }
            };
            vm.openUrl = function (idx, next_name) {
                var nextUrl = '';
                if ($scope.envir == "online"){
                    if (hash.indexOf("txy") != -1 || hash.indexOf("liveme") != -1){
                        var envir_name = hash.split(".")[1];
                        if (hash.indexOf("txy") != -1){
                            next_name = next_name +"txy"
                        }
                    }else {
                        var envir_name = hash.split(".")[0];
                    }
                    if (envir_name != next_name){
                        // var replaceUrl = hash.replace(envir_name, next_name);
                        nextUrl = $scope.nextUrls[next_name] + vm.state.params.treeid;
                    }else {
                        return
                    }
                }else if ($scope.envir == "htorionstar") {
                    if (hash.indexOf("htorionstar") != -1){
                        var envir_name = hash.split(".")[1];
                        if (hash.indexOf("htorionstar") != -1){
                            next_name = next_name +"htorionstar"
                        }
                    }else {
                        var envir_name = hash.split(".")[0];
                    }
                    if (envir_name != next_name){
                        // var replaceUrl = hash.replace(envir_name, next_name);
                        nextUrl = $scope.nextUrls[next_name] + vm.state.params.treeid;
                    }else {
                        return
                    }
                }else if ($scope.envir == "orionstar") {
                    if (hash.indexOf("orionstar") != -1 ){
                        var envir_name = hash.split(".")[1];
                        if (hash.indexOf("orionstar") != -1){
                            next_name = next_name +"orionstar"
                        }
                    }else {
                        var envir_name = hash.split(".")[0];
                    }
                    if (envir_name != next_name){
                        // var replaceUrl = hash.replace(envir_name, next_name);
                        nextUrl = $scope.nextUrls[next_name] + vm.state.params.treeid;
                    }else {
                        return
                    }
                }else if ($scope.envir == "test"){
                    var envir_name = hash.split(".")[1];
                    if (envir_name != next_name){
                        // var replaceUrl = hash.replace(envir_name, next_name);
                        nextUrl = $scope.nextUrls[next_name + "test"] + vm.state.params.treeid;
                    }else {
                        return
                    }
                }
                window.open(nextUrl, '_blank')
            }
        }
    }

})();

(function() {

    'use strict';
    treeService.$inject = ["$http", "$state"];
    angular
        .module('openc3')
        .factory('treeService', treeService);

    function treeService($http, $state){

        var vm = {};
        var setting = {
            view: {
                dblClickExpand: false,
                showTitle:false
            }
        };

        vm.sync = $http.get('/api/connector/connectorx/usertree').success(function(nodes) {
            $.fn.zTree.init(angular.element('#openc3tree'), setting, nodes.data);
            vm.zTree = $.fn.zTree.getZTreeObj('openc3tree');
            if (vm.zTree){
                var treeNode = vm.zTree.getNodeByParam('id', $state.params.treeid);
                var proName = $state.current.name;
                if (proName.indexOf('home.global') == 0 ){
                    return
                }
                if(treeNode == null){
                    // $state.go('home.e401');
                    return;
                }

                // var demo = vm.zTree.getNodeByParam("id", demoId, 0);
                // vm.zTree.addNodes(null,0, demo);
            }

            return vm.zTree;
        });

        vm.selectname = function(){
            var treeNode = vm.zTree.getNodesByParam('id', $state.params.treeid);
            var currentNode = treeNode[treeNode.length-1];
            var nodesStr = currentNode.name;
            while(currentNode.level != 0){
                currentNode = currentNode.getParentNode();
                nodesStr = currentNode.name + '.' + nodesStr;
            }
            return nodesStr;
        };

        return vm;
    }

})();

(function(){
    'use strict';

    angular
        .module('openc3')
        .directive('cmmenu', ztree);

    /** @ngInject */
    function ztree() {
        ZtreeController.$inject = ["$injector", "$stateParams", "$window", "$http", "$state", "treeService"];
        var directive = {
            restrict: 'E',
            templateUrl: 'app/components/menu/menu.html',
            scope: {},
            controller: ZtreeController,
            controllerAs: 'tree'
        };
        return directive;

        /** @ngInject */
        function ZtreeController($injector, $stateParams, $window, $http, $state, treeService) {

            var vm = this;
            vm.zTree = '';
            var toastr = toastr || $injector.get('toastr');

            // tree height auto
            angular.element('.scroller').css('height', $window.innerHeight-95);
            angular.element($window).bind('resize', function(){
                angular.element('.scroller').css('height', $window.innerHeight-95);
            });

            treeService.sync.then(function(){
                vm.zTree = $.fn.zTree.getZTreeObj('openc3tree');
                vm.focusCurrent();
                vm.zTree.setting.callback.onClick = function(event, treeId, treeNode){
                    if(treeNode.hasOwnProperty('id')){
                        if (treeNode.id == $stateParams.treeid){
                            return;
                        }
                        if (treeNode.id != 0){
                            var sName = $state.current.name;

// sName.indexOf('home.connector.tree') !=-1
                            if(  
                                   sName == 'home.favorites'
                                || sName == 'home.quickentry.flowline'
                                || sName == 'home.quickentry.runtask'
                                || sName == 'home.quickentry.cmd'
                                || sName == 'home.quickentry.scp'
                                || sName == 'home.quickentry.approval'
                                || sName == 'home.quickentry.terminal'
                                || sName == 'home.quickentry.sendfile'
                                || sName == 'home.business.job'
                                || sName == 'home.business.user'
                                || sName == 'home.business.file'
                                || sName == 'home.business.scripts'
                                || sName == 'home.business.nodegroup'
                                || sName == 'home.business.nodebatch'
                                || sName == 'home.business.machine'
                                || sName == 'home.business.notify'
                                || sName == 'home.business.crontab'
                                || sName == 'home.business.agent'
                                || sName == 'home.business.variate'
                                || sName == 'home.history.jobx'
                                || sName == 'home.history.job'
                                || sName == 'home.history.terminal'
                                || sName == 'home.approval'
                                || sName == 'home.global.notify'
                                || sName == 'home.global.template'
                                || sName == 'home.global.ticket'
                                || sName == 'home.connector.config'
                                || sName == 'home.connector.userinfo'
                                || sName == 'home.connector.userauth'
                                || sName == 'home.connector.tree'
                                || sName == 'home.connector.node'
                                || sName == 'home.connector.mail'
                                || sName == 'home.connector.mesg'
                                || sName == 'home.gitreport'
                                || sName == 'home.flowreport'
                                || sName == 'home.kubernetesmanage'
                             ){
                                $state.go(sName, {treeid:treeNode.id});
                            }else{
                                $state.go('home.dashboard', {treeid:treeNode.id});
                            }

                            if( sName == 'home.quickentry.flowlinedetail' )
                            {
                                $state.go('home.quickentry.flowline', {treeid:treeNode.id});
                            }

                            if( sName == 'home.gitreportfilterdata' )
                            {
                                $state.go('home.gitreport', {treeid:treeNode.id});
                            }
                            if( sName == 'home.flowreportfilterdata' )
                            {
                                $state.go('home.flowreport', {treeid:treeNode.id});
                            }

                        } else {
                            toastr.error("没有节点权限");
                        }
                    } else {
                        toastr.error("没有节点权限");
                    }
                }
            });

            // focus current node
            vm.focusCurrent = function(){
                var cNode = vm.zTree.getNodeByParam('id', $state.params.treeid);
                vm.zTree.selectNode(cNode);
                vm.zTree.expandNode(cNode);
            };

            // expand/collapse tree
            vm.expandAll = function(flag){
                vm.zTree.expandAll(flag);
            };

            // tree refresh
            vm.refresh = function(){
                angular.element('.treeFresh').addClass('fa-spin');
                $http.get('/api/connector/connectorx/usertree').success(function(nodes) {
                    $.fn.zTree.init(angular.element('#openc3tree'), vm.zTree.setting, nodes.data);
                    angular.element('.treeFresh').removeClass('fa-spin');
                    vm.focusCurrent();
                });
            };
        }
    }

})();

(function () {
    'use strict';
    ChoiceController.$inject = ["$uibModalInstance", "$timeout", "$http", "$scope", "ngTableParams", "resoureceService", "treeId"];
    angular
        .module('openc3')
        .controller('ChoiceController', ChoiceController);

    function ChoiceController($uibModalInstance,$timeout, $http, $scope, ngTableParams,resoureceService, treeId) {

        var vm = this;
        $scope.dataready = true;
        $scope.selected = [];
        $scope.selected_inip = [];
        $scope.selected_exip = [];
        $scope.selected_name = [];
        $scope.radioselected = {};
        $scope.selectedData = [];
        $scope.selectedDataName = [];
        $scope.selectedDataInip = [];
        $scope.selectedDataExip = [];
        $scope.allData = [];
        $scope.ipVar = {"variable":"$ip"};
        $scope.formType = 'ip';
        $scope.groupHide = false;
        var ss = window.location.href;
        if(ss.split("#")[1].indexOf("/quickentry/terminal") !=-1){
            $scope.groupHide = true;
        }else if(ss.split("#")[1].indexOf("creaetjob") !=-1){
            $scope.variableShow = true;
        }else if(ss.split("#")[1].indexOf("editjob") !=-1){
            $scope.variableShow = true;
        }else if(ss.split("#")[1].indexOf("business") !=-1){
            $scope.variableShow = true;
        }else if(ss.split("#")[1].indexOf("/quickentry/flowlinedetail") !=-1){
            $scope.variableShow = true;
        }else if(ss.split("#")[1].indexOf("/quickentry/flowline") !=-1){
            $scope.variableShow = true;
        }
 
        vm.cancel = function(){ $uibModalInstance.dismiss()};

        vm.getMachine = function () {
            $http.get('/api/agent/nodeinfo/' + treeId).then(
                function successCallback(response) {
                    if (response.data.stat){
                        vm.machine_Table = new ngTableParams({count:10}, {counts:[],data:response.data.data.reverse()});
                        vm.machineData = response.data.data;
                    }else {
                        $scope.dataready = false;
                        $scope.dataerror = "获取机器信息失败："+response.data.info;
                    }
                },
                function errorCallback (response ){
                    $scope.dataready = false;
                    $scope.dataerror = "获取机器信息失败："+response.data.status;
                });
        };
        vm.getGroup = function () {
            $http.get('/api/job/nodegroup/' + treeId).then(
                function successCallback(response) {
                    if (response.data.stat){
                        $scope.dataready = true;
                        vm.group_Table = new ngTableParams({count:10}, {counts:[],data:response.data.data.reverse()});
                        vm.groupData = response.data.data;
                    }else {
                        $scope.dataready = false;
                        $scope.dataerror = "获取分组信息失败："+response.data.info;
                    }
                },
                function errorCallback (response ){
                    $scope.dataready = false;
                    $scope.dataerror = "获取分组信息失败："+response.status;
                });
        };
        vm.cleanSelected = function () {
            $scope.selected = [];
            var from = $scope.formType;

            if (from == "ip"){
                $scope.allData = vm.machineData;
            }else if(from == "group"){
                $scope.allData = vm.groupData;
            }
        };
        // exip:"119.28.85.72"
        // id:44
        // inip:"10.45.100.99"
        // ip:"10.45.100.99,119.28.85.72"
        // name:"geth-blockscan-txyxg1-01"
        // type:"qcloud-cvm"

        vm.add = function(){
            var ips = [];
            var re_ips = ips.concat($scope.selectedDataName, $scope.selectedDataInip, $scope.selectedDataExip);
            if ($scope.formType == "group" && $scope.radioselected.group){
                $scope.selectedData.push($scope.radioselected.group);
                $uibModalInstance.close(
                    $scope.selectedData
                );
            }
            if ($scope.formType == "ip"){
                $uibModalInstance.close(
                    re_ips
                );
            }
            if ($scope.formType == "variable"){
                $uibModalInstance.close(
                    vm.ipVar
                );
            }

        };


        var updateSelected = function (action, id, data) {
            if (action == 'add' & $scope.selected.indexOf(id) == -1) {
                $scope.selected.push(id);
                $scope.selectedData.push(data);
            }
            if (action == 'remove' && $scope.selected.indexOf(id) != -1){
                $scope.selected.splice($scope.selected.indexOf(id), 1);
                $scope.selectedData.splice($scope.selectedData.indexOf(data), 1)
            }
        };
        var changeSelected = function (action, id, data, type) {
            if (action == 'add') {
                if (type == 'name'){
                    $scope.selected_name.push(id);
                    $scope.selectedDataName.push(data);
                }
                if (type == 'inip'){
                    $scope.selected_inip.push(id);
                    $scope.selectedDataInip.push(data);
                }
                if (type == 'exip'){
                    $scope.selected_exip.push(id);
                    $scope.selectedDataExip.push(data);
                }
            }
            if (action == 'remove'){
                if (type == 'name'){
                    $scope.selected_name.splice($scope.selected_name.indexOf(id), 1);
                    $scope.selectedDataName.splice($scope.selectedDataName.indexOf(data), 1)
                }
                if (type == 'inip'){
                    $scope.selected_inip.splice($scope.selected_inip.indexOf(id), 1);
                    $scope.selectedDataInip.splice($scope.selectedDataInip.indexOf(data), 1)
                }
                if (type == 'exip'){
                    $scope.selected_exip.splice($scope.selected_exip.indexOf(id), 1);
                    $scope.selectedDataExip.splice($scope.selectedDataExip.indexOf(data), 1)
                }
            }
        };
        var updateRadioSelected = function (action, id, data) {
            if (action == 'add' & $scope.selected.indexOf(id) == -1) {
                $scope.selected.push(id);
                $scope.selectedData.push(data);
            }
            if (action == 'remove' && $scope.selected.indexOf(id) != -1){
                $scope.selected.splice($scope.selected.indexOf(id), 1);
                $scope.selectedData.splice($scope.selectedData.indexOf(data), 1)
            }
        };
        $scope.updateSelection = function ($event, id, data) {
            var checkbox = $event.target;
            var action = (checkbox.checked ? 'add' : 'remove');
            updateSelected(action, id, data);
        };
        // 机器名称
        $scope.nameUpdateSelection = function ($event, id, data) {
            var checkbox = $event.target;
            var action = (checkbox.checked ? 'add' : 'remove');
            changeSelected(action, id, data, 'name');
        };
        // 内网IP
        $scope.inipUpdateSelection = function ($event, id, data) {
            var checkbox = $event.target;
            var action = (checkbox.checked ? 'add' : 'remove');
            changeSelected(action, id, data, 'inip');
        };
        // 外网IP
        $scope.exipUpdateSelection = function ($event, id, data) {
            var checkbox = $event.target;
            var action = (checkbox.checked ? 'add' : 'remove');
            changeSelected(action, id, data, 'exip');
        };
        $scope.updateRadio = function ($event, id, data) {
            // var checkbox = $event.target;
            // var action = (checkbox.checked ? 'add' : 'remove');
            // updateSelected(action, id, data);
            $scope.radioselected['group'] = data
        };
        $scope.selectAll = function ($event) {
            var checkbox = $event.target;
            var action = (checkbox.checked ? 'add' : 'remove');
            for (var i = 0; i < $scope.allData.length; i++) {
                var entity = $scope.allData[i];
                updateSelected(action, entity.id, entity);
            }
        };
        // $scope.getSelectedClass = function (entity) {
        //     return $scope.isSelected(entity.id) ? 'selected' : '';
        // };
        $scope.isSelected = function (id, type) {
            if (type == 'name'){
                return $scope.selected_name.indexOf(id) >= 0;
            }
            if (type == 'inip'){
                return $scope.selected_inip.indexOf(id) >= 0;
            }
            if (type == 'exip'){
                return $scope.selected_exip.indexOf(id) >= 0;
            }
        };
        $scope.isSelectedAll = function () {
            if ($scope.selected.length){
                return $scope.selected.length === $scope.allData.length;
            }

        };
        vm.getMachine();
        vm.getGroup();
        // $scope.$watch("filter.$", function () {
        //     vm.machine_Table.reload();
        // });

    }
})();


(function(){
    'use strict';

    angular
        .module('openc3')
        .directive('cmloading', loading);

    function loading() {
        var directive = {
            restrict: 'E',
            templateUrl: 'app/components/loading/loading.html'
        };
        return directive;
    }

})();

(function(){
    'use strict';

    angular
        .module('openc3')
        .directive('cmfooter', cmfooter);

    function cmfooter() {

        var directive = {

            restrict: 'E',
            templateUrl: 'app/components/footer/footer.html',
            scope: {},
            controller: footerController,
            controllerAs: 'footer'
        };

        return directive;

        function footerController() {

            var vm = this;

            vm.year = (new Date()).getFullYear();

        }

    }

})();

(function() {
    'use strict';

    angular
        .module('openc3')
        .directive('dataerror', errController);

    function errController() {
        var directive = {

            restrict: 'E',
            templateUrl: 'app/components/error/errorMsg.html',
            scope: {errmsg: "@"},
            controller: ErrorMsg,
            controllerAs: 'errormsg'
        };
        return directive;
        function ErrorMsg() {
            var vm = this;
        }



    }

})();
(function () {
    'use strict';
    EmptyVarController.$inject = ["$uibModalInstance", "$state", "$http", "$scope", "emptyData"];
    angular
        .module('openc3')
        .controller('EmptyVarController', EmptyVarController);

    function EmptyVarController($uibModalInstance,$state, $http, $scope, emptyData) {

        var vm = this;
        vm.emptyVar = emptyData;
        vm.treeid = $state.params.treeid;
        vm.cancel = function(){ $uibModalInstance.dismiss()};
        vm.inputOver = function(){
            $uibModalInstance.close(
                vm.emptyVar
            );
        };



    }
})();


(function() {
  'use strict';

  authInterceptor.$inject = ["$log", "$q", "$window", "$location", "$injector", "ssoService"];
  angular
    .module('openc3')
    .factory('authInterceptor', authInterceptor);

  function authInterceptor($log, $q,$window, $location, $injector, ssoService) {

      var ai = {

          'response': function(res){

              var toastr = toastr || $injector.get('toastr');

              if (res.config.url.match(/^\/api.*$/)) {

                  if(res.data){
                      if(res.data.hasOwnProperty('code')){
                          if(res.data.code == 10000){
                              $log.debug('data   ', res.data);
                              var currentUrl = $window.location.href;
                              var siteaddr = window.location.protocol + '//' + window.location.host;
                              $window.location.href=ssoService.login + '?siteaddr=' + siteaddr + '&callback=' + currentUrl;
                              return null;
                          }
                          if(res.data.code != 200){
                              $log.debug(res.data.code, res);
                              toastr.error(res.data.msg);
                          }
                      }
                  }
              }
              return res;
          },

          'responseError': function(res){
              $log.debug(res);
              //if(res.status >= 500){
              //    //$location.path('error/500');
              //    //TODO alarm message
              //    return $q.reject(res);
              //}
              $log.debug("error interceptor!!");
              var toastr = toastr || $injector.get('toastr');
              toastr.error(res.config.url, res.data);
              //toastr.error(res.data);
              return $q.reject(res);
          }
      
      };

      return ai;
  }

})();

(function() {
    'use strict';

    MainController.$inject = ["$rootScope"];
    angular
        .module('openc3')
        .controller('MainController', MainController);

    /** @ngInject */
    function MainController($rootScope) {
        $rootScope.back = function() {
            $window.history.back();
        };

    }

})();

(function() {
  'use strict';

  angular
    .module('openc3')
    .filter('highlight', function(){
        
        return function(shell){
            if( shell == null || shell == "" ){
                return;
            }else{
                return  Prism.highlight(shell, Prism.languages.bash);
            }
        }

    });


})();

(function() {
  'use strict';

  resoureceService.$inject = ["$http", "treeService", "$q", "$state", "$log"];
  angular
    .module('openc3')
    .factory('resoureceService', resoureceService);


  /** @ngInject */
  function resoureceService($http, treeService, $q, $state, $log) {

      //----- define here -----

      var List=[

          // ==================== script ==============================

          {
              namespace: 'script.check', method: 'get',
              url:       function(treeid){return '/api/job/scripts/' + treeid},
              actName:   '查询脚本', confirm: true, failAlert: true, sucAlert: true,
          },
          {
              namespace: 'script.create', method: 'post',
              url:       function(treeid){return '/api/job/scripts/' + treeid},
              actName:   '创建脚本', confirm: true, failAlert: true, sucAlert: true,
          },
          {
              namespace: 'script.change', method: 'post',
              url:       function(param){return '/api/job/scripts/' + param[0] +  "/"+ param[1]},
              actName:   '修改脚本', confirm: true, failAlert: true, sucAlert: true,
          },
          {
              namespace: 'script.delete', method: 'delete',
              url:       function(param){return '/api/job/scripts/' + param[0]+  "/"+ param[1]},
              actName:   '删除脚本', confirm: true, failAlert: true, sucAlert: true,
          },
          // =========================== task ======================
          {
              namespace: 'work.runScript', method: 'post',
              url:       function(treeid){return '/api/job/task/' + treeid+  "/plugin_cmd"},
              actName:   '执行脚本', confirm: true, failAlert: true, sucAlert: true,
          },
          {
              namespace: 'work.scp', method: 'post',
              url:       function(treeid){return '/api/job/task/' + treeid + "/plugin_scp"},
              actName:   '分发文件', confirm: true, failAlert: true, sucAlert: true,
          },
          {
              namespace: 'work.runJob', method: 'post',
              url:       function(treeid){return '/api/job/task/' + treeid + "/job"},
              actName:   '执行作业', confirm: true, failAlert: true, sucAlert: true,
          },
          {
              namespace: 'work.rebootTask', method: 'post',
              url:       function(treeid){return '/api/job/task/' + treeid + "/job"},
              actName:   '重新执行任务', confirm: true, failAlert: true, sucAlert: true,
          },
          {
              namespace: 'work.reloadTask', method: 'post',
              url:       function(treeid){return '/api/job/task/' + treeid + "/redo"},
              actName:   '重新执行任务', confirm: true, failAlert: true, sucAlert: true,
          },
          // =========================== crontab  ===========================
          {
              namespace: 'work.createCron', method: 'post',
              url:       function(treeid){return '/api/job/crontab/' + treeid},
              actName:   '创建计划任务', confirm: true, failAlert: true, sucAlert: true,
          },
          {
              namespace: 'work.changeCron', method: 'post',
              url:       function(param){return '/api/job/crontab/' + param[0]+  "/"+ param[1]},
              actName:   '修改计划任务', confirm: true, failAlert: true, sucAlert: true,
          },
          {
              namespace: 'work.delCron', method: 'delete',
              url:       function(param){return '/api/job/crontab/' + param[0]+  "/"+ param[1]},
              actName:   '删除计划任务', confirm: true, failAlert: true, sucAlert: true,
          },
          {
              namespace: 'work.runCron', method: 'post',
              url:       function(param){return '/api/job/crontab/' + param[0]+  "/"+ param[1] + "/status"},
              actName:   '执行计划任务', confirm: true, failAlert: true, sucAlert: true,
          },
          {
              namespace: 'work.stopCron', method: 'post',
              url:       function(param){return '/api/job/crontab/' + param[0]+  "/"+ param[1] + "/status"},
              actName:   '停止计划任务', confirm: true, failAlert: true, sucAlert: true,
          },
          // =========================== task =================
          {
              namespace: 'task.runContinue', method: 'put',
              url:       function(treeid){return '/api/job/subtask/' + treeid},
              actName:   '继续执行', confirm: false, failAlert: true, sucAlert: true,
          }, {
              namespace: 'task.runRunnings', method: 'put',
              url:       function(treeid){return '/api/job/subtask/' + treeid},
              actName:   '重试任务', confirm: true, failAlert: true, sucAlert: true,
          }, {
              namespace: 'task.runIgnore', method: 'post',
              url:       function(treeid){return '/api/job/subtask/' + treeid},
              actName:   '忽略错误', confirm: true, failAlert: true, sucAlert: true,
          },{
              namespace: 'task.runShutTask', method: 'post',
              url:       function(treeid){return '/api/job/subtask/' + treeid},
              actName:   '终止整个任务', confirm: true, failAlert: true, sucAlert: true,
          },
          // =========================== job ==================================
          {
              namespace: 'job.createJob', method: 'post',
              url:       function(treeid){return '/api/job/jobs/' + treeid},
              actName:   '创建作业', confirm: true, failAlert: true, sucAlert: true,
          },
          {
              namespace: 'job.delJob', method: 'delete',
              url:       function(param){return '/api/job/jobs/' + param[0] +"/"+ param[1]},
              actName:   '删除作业', confirm: true, failAlert: true, sucAlert: true,
          },
          {
              namespace: 'job.updateJob', method: 'post',
              url:       function(param){return '/api/job/jobs/'  + param[0] +"/"+ param[1]},
              actName:   '修改作业', confirm: true, failAlert: true, sucAlert: true,
          },
          // ======================== user ============================
          {
              namespace: 'user.addUser', method: 'post',
              url:       function(treeid){return '/api/job/userlist/' + treeid},
              actName:   '添加用户', confirm: true, failAlert: true, sucAlert: true,
          },{
              namespace: 'user.delUser', method: 'delete',
              url:       function(param){return '/api/job/userlist/' + param[0] +"/"+ param[1]},
              actName:   '删除用户', confirm: true, failAlert: true, sucAlert: true,
          },
            // ======================== machine============================
          {
              namespace: 'machine.addMachine', method: 'post',
              url:       function(treeid){return '/api/job/nodelist/' + treeid},
              actName:   '添加机器', confirm: true, failAlert: true, sucAlert: true,
          },{
              namespace: 'machine.delMachine', method: 'delete',
              url:       function(param){return '/api/job/nodelist/' + param[0] +"/"+ param[1]},
              actName:   '删除机器', confirm: true, failAlert: true, sucAlert: true,
          },
            // ======================== machinew============================
          {
              namespace: 'machinew.addMachinew', method: 'post',
              url:       function(treeid){return '/api/connector/default/node/' + treeid},
              actName:   '添加机器', confirm: true, failAlert: true, sucAlert: true,
          },{
              namespace: 'machinew.delMachinew', method: 'delete',
              url:       function(param){return '/api/connector/default/node/' + param[0] +"/"+ param[1]},
              actName:   '删除机器', confirm: true, failAlert: true, sucAlert: true,
          },
 
          // ======================== variate============================
          {
            namespace: 'variate.delVV', method: 'delete',
            url:       function(param){return '/api/job/vv/' + param[0] +"/"+ param[1]},
            actName:   '删除该条信息', confirm: true, failAlert: true, sucAlert: true,
            },
          // ======================== nodegroup ============================
          {
              namespace: 'group.create', method: 'post',
              url:       function(treeid){return '/api/job/nodegroup/' + treeid},
              actName:   '创建分组', confirm: true, failAlert: true, sucAlert: true,
          },{
              namespace: 'group.change', method: 'post',
              url:       function(param){return '/api/job/nodegroup/'+ param[0] +"/"+ param[1]},
              actName:   '修改分组', confirm: true, failAlert: true, sucAlert: true,
          },{
              namespace: 'group.delete', method: 'delete',
              url:       function(param){return '/api/job/nodegroup/'+ param[0] +"/"+ param[1]},
              actName:   '删除分组', confirm: true, failAlert: true, sucAlert: true,
          },
          // ======================== notify ============================
          {
              namespace: 'notify.adduser', method: 'post',
              url:       function(treeid){return '/api/job/notify/'+ treeid},
              actName:   '添加通知人', confirm: true, failAlert: true, sucAlert: true,
          },{
              namespace: 'notify.deluser', method: 'delete',
              url:       function(param){return '/api/job/notify/'+  param[0] +"/"+ param[1]},
              actName:   '删除通知人', confirm: true, failAlert: true, sucAlert: true,
          },
          // ======================= global ==============================
          {
              namespace: 'global.update', method: 'post',
              url:       function(){return '/api/job/environment'},
              actName:   '更新报警通知', confirm: true, failAlert: true, sucAlert: true,
          },

          // ======================= var ==============================
          {
              namespace: 'variable.save', method: 'post',
              url:       function(treeid){return '/api/job/variable/'+  treeid},
              actName:   '保存变量', confirm: true, failAlert: true, sucAlert: true,
          },
          {
              namespace: 'variable.update', method: 'post',
              url:       function(treeid){return '/api/job/variable/'+  treeid+"/update"},
              actName:   '保存变量', confirm: true, failAlert: true, sucAlert: true,
          },
          {
              namespace: 'variable.delete', method: 'delete',
              url:       function(treeid){return '/api/job/variable/'+  treeid},
              actName:   '删除变量', confirm: true, failAlert: true, sucAlert: true,
          },
          // ======================= kill task ==============================
          {
              namespace: 'task.kill', method: 'delete',
              url:       function(param){return '/api/job/slave/'+param[0]+"/killtask/"+  param[1]},
              actName:   '终止任务', confirm: true, failAlert: true, sucAlert: true,
          },// ======================= file manage ==============================
          {
              namespace: 'file.delete', method: 'delete',
              url:       function(param){return '/api/job/fileserver/'+param[0]+"/"+  param[1]},
              actName:   '删除文件', confirm: true, failAlert: true, sucAlert: true,
          },// ======================= token ==============================
          {
              namespace: 'token.delete', method: 'delete',
              url:       function(param){return '/api/job/token/'+param[0]+"/"+  param[1]},
              actName:   '删除token', confirm: true, failAlert: true, sucAlert: true,
          },

          // ============================ jobx group job ===========================

//TODO OPENC3 这里临时创建了两个函数xx
          {
              namespace: 'group.creategroupxx', method: 'post',
              url:       function(treeid){return '/api/jobx/group/' + treeid},
              actName:   '创建分组', confirm: false, failAlert: true, sucAlert: false,
          },{
              namespace: 'group.updategroupxx', method: 'post',
              url:       function(params){return '/api/jobx/group/' + params[0] + "/"+ params[1]},
              actName:   '更新分组', confirm: false, failAlert: true, sucAlert: false,
          }, {
              namespace: 'group.creategroup', method: 'post',
              url:       function(treeid){return '/api/jobx/group/' + treeid},
              actName:   '创建分组', confirm: true, failAlert: true, sucAlert: true,
          },{
              namespace: 'group.updategroup', method: 'post',
              url:       function(params){return '/api/jobx/group/' + params[0] + "/"+ params[1]},
              actName:   '更新分组', confirm: true, failAlert: true, sucAlert: true,
          },{
              namespace: 'group.deletegroup', method: 'delete',
              url:       function(params){return '/api/jobx/group/' + params[0] + "/"+ params[1]},
              actName:   '删除分组', confirm: true, failAlert: true, sucAlert: true,
          },
          // =================================== jobx task =============================
          {
              namespace: 'task.createtask', method: 'post',
              url:       function(treeid){return '/api/jobx/task/' +treeid +'/job/byname'},
              actName:   '创建任务', confirm: true, failAlert: true, sucAlert: true,
          },{
              namespace: 'task.stoptask', method: 'delete',
              url:       function(params){return '/api/jobx/task/' +params[0] +'/'+params[1]},
              actName:   '停止任务', confirm: true, failAlert: true, sucAlert: true,
          },{
              namespace: 'task.confirmtask', method: 'put',
              url:       function(params){return '/api/jobx/subtask/' +params[0] +'/'+params[1]+'/confirm'},
              actName:   '执行确认', confirm: true, failAlert: true, sucAlert: true,
          },



      ];


      //----- code begin -----

      var self = {};
      for(var i in List)
      {
          var item = List[i];       // get a dict from List.

          var strings = item.namespace.split('.');      // get namespace split list

          if(strings.length != 2)
          {
              continue;
          }
          if(!self[strings[0]])
          {
              self[strings[0]] = {};
          }

          function action(urlObj, dataObj, wait){

              var res = this;       // res is replaced  item. item = List[i] = {namespace:copy.save, ...}
              angular.element(document).find("div[wait-mark='"+ wait +"']").css('display','');
              angular.element(document).find("div[wait-show='"+ wait +"']").css('display','none');
              if(wait){
                  if(wait.warning){
                      res.warningtext = wait.warning;
                  }else {
                      res.warningtext = null;
                  }
              }else {
                  res.warningtext = null;
              }



              var deferred = $q.defer();            // create a promise obj.

              function httpSuc(response){

                  $log.debug('http suc!', response);
                  if(response.data.stat != true)
                  {
                      if(res.failAlert){

                          swal({ title: res.actName + "失败!", text: response.data.info, type:'error' });
                      }
                      deferred.reject(response.data);       // change state is reject. error
                  }else{

                      if(res.sucAlert){

                          swal({ title: res.actName + "成功!", type:'success' });
                      }
                      deferred.resolve(response.data);      // change state is  resolve. success
                  }
              }

              function httpFail(response){

                  $log.debug('http fail!', response);

                  if(res.failAlert){

                      swal({ title: res.actName + "失败!", text: response.status + ": " + response.statusText, type:'error' });
                  }
                  deferred.reject(response);
              }

              function act(){
                  var url = res.url(urlObj);
                  $log.debug(urlObj);
                  $log.debug('url:', url);
                  $log.debug('data:', dataObj);

                  if(res.method=='post')
                  {
                      $http.post(url, dataObj).then(httpSuc,httpFail).finally(function(){
                          if(wait)
                          {
                              angular.element(document).find("div[wait-mark='"+ wait +"']").css('display','none');
                              angular.element(document).find("div[wait-show='"+ wait +"']").css('display','');
                          }

                      });
                  }else if(res.method=='put')
                  {
                      $http.put(url, dataObj).then(httpSuc,httpFail).finally(function(){
                          if(wait)
                          {
                              angular.element(document).find("div[wait-mark='"+ wait +"']").css('display','none');
                              angular.element(document).find("div[wait-show='"+ wait +"']").css('display','');
                          }

                      });
                  }else if(res.method=='get'){

                      $http.get(url, dataObj).then(httpSuc,httpFail).finally(function(){
                          if(wait)
                          {
                              angular.element(document).find("div[wait-mark='"+ wait +"']").css('display','none');
                              angular.element(document).find("div[wait-show='"+ wait +"']").css('display','');
                          }
                      });
                  }else if(res.method=='delete'){

                      $http.delete(url, dataObj).then(httpSuc,httpFail).finally(function(){
                          if(wait)
                          {
                              angular.element(document).find("div[wait-mark='"+ wait +"']").css('display','none');
                              angular.element(document).find("div[wait-show='"+ wait +"']").css('display','');
                          }
                      });
                  }
              }

              if(res.confirm)
              {
                  swal({

                      title: "确定" + res.actName + "?",
                      text: res.warningtext,
                      type: "warning", showCancelButton: true,
                      confirmButtonColor: "#DD6B55",
                      closeOnConfirm: false, showLoaderOnConfirm: true

                  }, act);
              }else{
                  act();
              }

              return deferred.promise;
          }
          self[strings[0]][strings[1]] = action.bind(item);         // save
      }
      $log.debug(self);
      return self;
  }

})();

(function() {
  'use strict';

  runBlock.$inject = ["$log", "$rootScope"];
  angular
    .module('openc3')
    .run(runBlock);

  /** @ngInject */
  function runBlock($log, $rootScope) {

    $log.debug('runBlock end');
  }

})();

(function() {
    'use strict';

    routerConfig.$inject = ["$stateProvider", "$urlRouterProvider"];
    angular
        .module('openc3')
        .config(routerConfig);

    /** @ngInject */
    function routerConfig($stateProvider, $urlRouterProvider) {

        $stateProvider
            .state('home', {
                url: '/',
                templateUrl: 'app/main/main.html',
                controller: 'MainController',
                controllerAs: 'main',
                abstract: true
            })
            .state('login', {
                url: '/login',
                templateUrl: 'app/pages/login/login.html',
                controller: 'LoginController',
                controllerAs: 'login',
            })
            .state('quickapproval', {
                url: '/quickapproval/:uuid',
                templateUrl: 'app/pages/quickapproval/quickapproval.html',
                controller: 'QuickApprovalController',
                controllerAs: 'quickapproval',
            })
 
            .state('home.dashboard', {
                url: 'dashboard/:treeid',
                templateUrl: 'app/pages/dashboard/dashboard.html',
                controller: 'DashboardController',
                controllerAs: 'dashboard'
            })

            .state('home.gitreport', {
                url: 'gitreport/:treeid',
                templateUrl: 'app/pages/gitreport/gitreport.html',
                controller: 'GitreportController',
                controllerAs: 'gitreport'
            })

            .state('home.gitreportfilterdata', {
                url: 'gitreportfilterdata/:treeid/:data/:user/:project',
                templateUrl: 'app/pages/gitreport/gitreport.html',
                controller: 'GitreportController',
                controllerAs: 'gitreport'
            })

            .state('home.flowreport', {
                url: 'flowreport/:treeid',
                templateUrl: 'app/pages/flowreport/flowreport.html',
                controller: 'FlowreportController',
                controllerAs: 'flowreport'
            })

            .state('home.flowreportfilterdata', {
                url: 'flowreportfilterdata/:treeid/:data/:user',
                templateUrl: 'app/pages/flowreport/flowreport.html',
                controller: 'FlowreportController',
                controllerAs: 'flowreport'
            })

            .state('home.kubernetesmanage', {
                url: 'kubernetesmanage/:treeid/:clusterid/:namespace/:stat',
                templateUrl: 'app/pages/kubernetesmanage/kubernetesmanage.html',
                controller: 'KubernetesmanageController',
                controllerAs: 'kubernetesmanage'
            })

            .state('home.favorites', {
                url: 'favorites/:treeid',
                templateUrl: 'app/pages/favorites/favorites.html',
                controller: 'FavoritesController',
                controllerAs: 'favorites'
            })

//agent
            .state('home.business.agent', {
                url: 'agent/:treeid',
                templateUrl: 'app/pages/business/agent/agent.html',
                controller: 'AgentController',
                controllerAs: 'agent'
            })
//jobx
            .state('home.group', {
                url: 'group/',
                templateUrl: 'app/pages/groupManage/group.html',
                controller: 'GroupController',
                controllerAs: 'group'
            })
            .state('home.business.nodebatch', {
                url: 'nodebatch/:treeid',
                templateUrl: 'app/pages/business/nodebatch/nodebatch.html',
                controller: 'GroupIndexController',
                controllerAs: 'groupindex'
            })

            .state('home.task', {
                url: 'task/',
                templateUrl: 'app/pages/taskManage/task.html',
                controller: 'TaskController',
                controllerAs: 'task'
            })
            .state('home.history.jobx', {
                url: 'jobx/:treeid',
                templateUrl: 'app/pages/history/jobx/jobx.html',
                controller: 'HistoryJobxController',
                controllerAs: 'historyjobx'
            })
            .state('home.quickentry', {
                url: 'quickentry/',
                templateUrl: 'app/pages/quickentry/quickentry.html',
                controller: 'QuickentryController',
                controllerAs: 'quickentry'
            })
 
            .state('home.quickentry.runtask', {
                url: 'runtask/:treeid',
                templateUrl: 'app/pages/quickentry/runtask/runtask.html',
                controller: 'RunTaskController',
                controllerAs: 'runtask'
            })

            .state('home.quickentry.runtasksa', {
                url: 'runtasksa/:treeid/:jobid',
                templateUrl: 'app/pages/quickentry/runtask/runtask.html',
                controller: 'RunTaskController',
                controllerAs: 'runtask'
            })

            .state('home.history.jobxdetail', {
                url: 'jobxdetail/:treeid/:taskuuid',
                templateUrl: 'app/pages/history/jobx/detail/detail.html',
                controller: 'HistoryJobxDetailController',
                controllerAs: 'historyjobxdetail',
                params:{"taskuuid":null, "accesspage":null}
            })

            .state('home.quickentry.smallapplication', {
                url: 'smallapplication/:treeid',
                templateUrl: 'app/pages/quickentry/smallapplication/smallapplication.html',
                controller: 'SmallApplicationController',
                controllerAs: 'smallapplication'
            })
 
            .state('home.quickentry.smallapplicationedit', {
                url: 'smallapplicationedit/:treeid',
                templateUrl: 'app/pages/quickentry/smallapplication/edit.html',
                controller: 'SmallApplicationEditController',
                controllerAs: 'smallapplicationedit'
            })
 
            .state('home.quickentry.flowline', {
                url: 'flowline/:treeid',
                templateUrl: 'app/pages/quickentry/flowline/flowline.html',
                controller: 'CiGroupController',
                controllerAs: 'cigroup'
            })
 
            .state('home.quickentry.flowlinedetail', {
                url: 'flowlinedetail/:treeid/:projectid',
                templateUrl: 'app/pages/quickentry/flowline/detail/detail.html',
                controller: 'CiController',
                controllerAs: 'ci'
            })
            .state('home.global.ticket', {
                url: 'ticket/:treeid',
                templateUrl: 'app/pages/global/ticket/ticket.html',
                controller: 'TicketController',
                controllerAs: 'ticket'
            })
            .state('home.global.images', {
                url: 'images/:treeid',
                templateUrl: 'app/pages/global/images/images.html',
                controller: 'ImagesController',
                controllerAs: 'images'
            })
            .state('home.global.useraddr', {
                url: 'useraddr/:treeid',
                templateUrl: 'app/pages/global/useraddr/useraddr.html',
                controller: 'UseraddrController',
                controllerAs: 'useraddr'
            })
            .state('home.global.private', {
                url: 'private/:treeid',
                templateUrl: 'app/pages/global/private/private.html',
                controller: 'PrivateController',
                controllerAs: 'private'
            })
            .state('home.config', {
                url: 'config/:treeid',
                templateUrl: 'app/pages/config/config.html',
                controller: 'ConfigController',
                controllerAs: 'config'
            })

//job
            // work change
            .state('home.work', {
                url: 'work/',
                templateUrl: 'app/pages/work/work.html',
                controller: 'WorkController',
                controllerAs: 'work'
            })
            .state('home.quickentry.cmd', {
                url: 'cmd/:treeid',
                templateUrl: 'app/pages/quickentry/cmd/cmd.html',
                controller: 'QuickController',
                controllerAs: 'quick'
            })
            .state('home.quickentry.approval', {
                url: 'approval/:treeid',
                templateUrl: 'app/pages/quickentry/approval/approval.html',
                controller: 'QuickentryApprovalController',
                controllerAs: 'quickentryapproval'
            })
 
            .state('home.quickentry.scp', {
                url: 'scp/:treeid',
                templateUrl: 'app/pages/quickentry/scp/scp.html',
                controller: 'DistributeController',
                controllerAs: 'distribute'
            })
            .state('home.business.job', {
                url: 'job/:treeid',
                templateUrl: 'app/pages/business/job/job.html',
                controller: 'BusinessJobController',
                controllerAs: 'businessjob'
            })
            .state('home.business.jobcreate', {
                url: 'jobcreate/:treeid',
                templateUrl: 'app/pages/business/job/create.html',
                controller: 'BusinessJobCreateController',
                controllerAs: 'businessjobcreate',
            })
            .state('home.business.jobedit', {
                url: 'jobedit/:treeid',
                templateUrl: 'app/pages/business/job/edit.html',
                controller: 'BusinessJobEditController',
                controllerAs: 'businessjobedit',
                params:{"editjobuuid":null, "editdata":null, "jobtypes":null,"mon_status":null, "mon_ids":null, "editjobname":null,"copyjob":null}
            })
            .state('home.business.jobcopy', {
                url: 'jobcopy/:treeid',
                templateUrl: 'app/pages/business/job/edit.html',
                controller: 'BusinessJobEditController',
                controllerAs: 'businessjobedit',
                params:{"editjobuuid":null, "editdata":null, "jobtypes":null,"mon_status":null, "mon_ids":null, "editjobname":null,"copyjob":null}
            })
            .state('home.history.jobdetail', {
                url: 'jobdetail/:treeid/:taskuuid',
                templateUrl: 'app/pages/history/job/detail/detail.html',
                controller: 'HistoryJobDetailController',
                controllerAs: 'historyjobdetail',
                params:{"taskuuid":null, "jobtype":null, "jobuuid":null}
            })
 
            // flow
            // .state('work', {
            //     url: '/',
            //     templateUrl: 'app/main/main.html',
            //     controller: 'MainController',
            //     controllerAs: 'main',
            //     abstract: true
            // })
            .state('home.business.crontab', {
                url: 'crontab/:treeid',
                templateUrl: 'app/pages/business/crontab/crontab.html',
                controller: 'BusinessCrontabController',
                controllerAs: 'businesscrontab',
            })
            .state('home.history.job', {
                url: 'job/:treeid',
                templateUrl: 'app/pages/history/job/job.html',
                controller: 'HistoryJobController',
                controllerAs: 'historyjob',
            })

            // business
            .state('home.business', {
                url: 'business/',
                templateUrl: 'app/pages/business/business.html',
                controller: 'BusinessController',
                controllerAs: 'business'
            })
            .state('home.business.user', {
                url: 'user/:treeid',
                templateUrl: 'app/pages/business/user/user.html',
                controller: 'UserController',
                controllerAs: 'user'
            })            
            .state('home.business.file', {
                url: 'file/:treeid',
                templateUrl: 'app/pages/business/file/file.html',
                controller: 'FileController',
                controllerAs: 'file'
            })
            .state('home.business.scripts', {
                url: 'scripts/:treeid',
                templateUrl: 'app/pages/business/scripts/script.html',
                controller: 'ScriptsController',
                controllerAs: 'scripts'
            })
            .state('home.business.nodegroup', {
                url: 'nodegroup/:treeid',
                templateUrl: 'app/pages/business/nodegroup/nodegroup.html',
                controller: 'NodeGroupController',
                controllerAs: 'group'
            })
            .state('home.approval', {
                url: 'approval/:treeid',
                templateUrl: 'app/pages/approval/approval.html',
                controller: 'ApprovalController',
                controllerAs: 'approval'
            })
            .state('home.assignment', {
                url: 'assignment/:treeid',
                templateUrl: 'app/pages/assignment/assignment.html',
                controller: 'AssignmentController',
                controllerAs: 'assignment'
            })
            .state('home.business.machine', {
                url: 'machine/:treeid',
                templateUrl: 'app/pages/business/machine/machine.html',
                controller: 'MachineController',
                controllerAs: 'machine'
            })
            .state('home.connector.node', {
                url: 'node/:treeid',
                templateUrl: 'app/pages/connector/node/node.html',
                controller: 'ConnectorNodeController',
                controllerAs: 'connectornode'
            })
            .state('home.connector.userinfo', {
                url: 'userinfo/:treeid',
                templateUrl: 'app/pages/connector/userinfo/userinfo.html',
                controller: 'ConnectorUserinfoController',
                controllerAs: 'connectoruserinfo'
            })
            .state('home.connector.userauth', {
                url: 'userauth/:treeid',
                templateUrl: 'app/pages/connector/userauth/userauth.html',
                controller: 'ConnectorUserauthController',
                controllerAs: 'connectoruserauth'
            })

            .state('home.history', {
                url: 'history/',
                templateUrl: 'app/pages/history/history.html',
                controller: 'HistoryController',
                controllerAs: 'history'
            })
 
            // connector
            .state('home.connector', {
                url: 'connector/',
                templateUrl: 'app/pages/connector/connector.html',
                controller: 'ConnectorController',
                controllerAs: 'connector'
            })
 
             .state('home.connector.chpasswd', {
                url: 'chpasswd',
                templateUrl: 'app/pages/connector/chpasswd/chpasswd.html',
                controller: 'ConnectorChpasswdController',
                controllerAs: 'connectorchpasswd'
            })
 
             .state('home.connector.mesg', {
                url: 'mesg/:treeid',
                templateUrl: 'app/pages/connector/mesg/mesg.html',
                controller: 'ConnectorMesgController',
                controllerAs: 'connectormesg'
            })

             .state('home.connector.mail', {
                url: 'mail/:treeid',
                templateUrl: 'app/pages/connector/mail/mail.html',
                controller: 'ConnectorMailController',
                controllerAs: 'connectormail'
            })
 
 
            .state('home.connector.tree', {
                url: 'tree/:treeid',
                templateUrl: 'app/pages/connector/tree/tree.html',
                controller: 'ConnectorTreeController',
                controllerAs: 'connectortree'
            })
            .state('home.business.notify', {
                url: 'notify/:treeid',
                templateUrl: 'app/pages/business/notify/notify.html',
                controller: 'AlarmNotifyController',
                controllerAs: 'notify'
            })
            // global
            .state('home.global', {
                url: 'global/',
                templateUrl: 'app/pages/global/global.html',
                controller: 'GlobalController',
                controllerAs: 'global'
            })
            .state('home.global.notify', {
                url: 'notify/:treeid',
                templateUrl: 'app/pages/global/notify/notify.html',
                controller: 'NotifyController',
                controllerAs: 'notify'
            })
            .state('home.global.monitor', {
                url: 'monitor/:treeid',
                templateUrl: 'app/pages/global/monitor/monitor.html',
                controller: 'MonitorController',
                controllerAs: 'monitor'
            })
            .state('home.global.versionlog', {
                url: 'versionlog/:treeid',
                templateUrl: 'app/pages/global/versionlog/versionlog.html',
                controller: 'VersionLogController',
                controllerAs: 'versionlog'
            })
            .state('home.global.auditlog', {
                url: 'auditlog/:treeid',
                templateUrl: 'app/pages/global/auditlog/auditlog.html',
                controller: 'AuditLogController',
                controllerAs: 'auditlog'
            })
            .state('home.global.template', {
                url: 'template/:treeid',
                templateUrl: 'app/pages/global/template/template.html',
                controller: 'TemplateController',
                controllerAs: 'template',
            })
           .state('home.connector.config', {
                url: 'config/:treeid',
                templateUrl: 'app/pages/connector/config/config.html',
                controller: 'ConnectorConfigController',
                controllerAs: 'connectorconfig'
            })
            .state('home.terminal', {
                url: 'terminal/',
                templateUrl: 'app/pages/terminal/terminal.html',
                controller: 'TerminalController',
                controllerAs: 'terminal',
            })
            .state('home.quickentry.terminal', {
                url: 'terminal/:treeid',
                templateUrl: 'app/pages/quickentry/terminal/terminal.html',
                controller: 'TerminalCmdController',
                controllerAs: 'templatecmd',
            })
            .state('home.quickentry.sendfile', {
                url: 'sendfile/:treeid',
                templateUrl: 'app/pages/quickentry/sendfile/sendfile.html',
                controller: 'SendfileController',
                controllerAs: 'sendfile',
            })
            .state('home.history.terminal', {
                url: 'terminal/:treeid',
                templateUrl: 'app/pages/history/terminal/terminal.html',
                controller: 'HistoryTerminalController',
                controllerAs: 'historyterminal',
            })
            // end change.
            .state('home.cfg', {
                url: 'cfg/',
                templateUrl: 'app/pages/cfg/cfg.html',
                controller: 'CfgController',
                controllerAs: 'cfg'
            })
            .state('home.cfg.jicheng', {
                url: 'jicheng/:treeid',
                templateUrl: 'app/pages/cfg/tabs/jicheng/jicheng.html',
                controller: 'JichengController',
                controllerAs: 'jicheng'
            })
            .state('home.cfg.bushu', {
                url: 'bushu/:treeid',
                templateUrl: 'app/pages/cfg/tabs/bushu/bushu.html',
                controller: 'BushuController',
                controllerAs: 'bushu'
            })
            .state('home.cfg.yunwei', {
                url: 'yunwei/:treeid',
                templateUrl: 'app/pages/cfg/tabs/yunwei/yunwei.html',
                controller: 'YunweiController',
                controllerAs: 'yunwei'
            })
            //variate query
            .state('home.business.variate', {
                url: "variate/:treeid",
                templateUrl: 'app/pages/business/variate/variate.html',
                controller: 'variateQueryController',
                controllerAs: 'variate'
            })

            .state('home.e401', {
                url:'error/401',
                templateUrl: 'app/pages/others/401.html'
            })
            .state('home.e404', {
                url:'error/404',
                templateUrl: 'app/pages/others/404.html'
            })
            .state('home.e500', {
                url:'error/500',
                templateUrl: 'app/pages/others/500.html'
            })

            .state('log', {
                url: '/api/log/:id',
                templateUrl: 'app/api/log.html',
                controller: 'ApiLogController',
                controllerAs: 'log'
            });


        $urlRouterProvider.otherwise('/dashboard/4000000000');
    }

})();

(function() {
  'use strict';

  angular
    .module('openc3')
    .constant('env', 'debug');

})();

(function() {
    'use strict';

    config.$inject = ["$logProvider", "$httpProvider", "toastrConfig", "$sceDelegateProvider", "env"];
    angular
        .module('openc3')
        .config(config);

    /** @ngInject */
    function config($logProvider, $httpProvider, toastrConfig, $sceDelegateProvider, env) {

        $sceDelegateProvider.resourceUrlWhitelist([
          // Allow same origin resource loads.
          'self',
          // Allow loading from our assets domain.  Notice the difference between * and **.
          'http://docker.open-c3.org:8000/**'
        ]);

        // Enable log
        if(env == 'debug')
        {
            $logProvider.debugEnabled(true);
        }else{
            $logProvider.debugEnabled(false);
        }

        // interceptor
        $httpProvider.interceptors.push('authInterceptor');

        // Set options third-party lib
        toastrConfig.allowHtml = true;
        toastrConfig.timeOut = 4000;
        toastrConfig.positionClass = 'toast-top-right';
//        toastrConfig.preventDuplicates = true;
        toastrConfig.progressBar = true;

    }

})();

(function() {
  'use strict';

  genericService.$inject = ["$http", "$q", "$state", "$filter"];
  angular
    .module('openc3')
    .factory('genericService', genericService);


  function genericService($http, $q, $state, $filter) {

        var fun = {};
        fun.seftime = function(starttime, finishtime ) {

            if( ! starttime )
            {
                return '0:00:00';
            }
            if( ! finishtime )
            {
                finishtime = $filter('date')(new  Date(), 'yyyy-MM-dd HH:mm:ss')
            }

            var S = new Date( starttime.replace(/-/g, "/") )
            var E = new Date( finishtime.replace(/-/g, "/") )

            var sec =  ( (E.getTime() - S.getTime() ) /1000);
            var s = sec % 60;
            if(s < 10)
            {
                s = '0' + s
            }
            var min = Math.trunc(sec / 60);

            var m = min % 60;
            if( m < 10 )
            {
                 m = '0' + m
            }
    
            return (Math.trunc(min / 60) ) + ':' + m +':' + s;

        }

        fun.time2date = function( time ) {
            return time.split(" ")[0]
        }

   return fun

  }

})();

angular.module("openc3").run(["$templateCache", function($templateCache) {$templateCache.put("app/main/main.html","<div><cmnavbar></cmnavbar><cmmenu></cmmenu><div id=content_wrapper><div ui-view><cmindex></cmindex></div></div><cmfooter></cmfooter></div>");
$templateCache.put("app/components/emptyvar/emptyVar.html","<div class=modal-header><h4 class=modal-title>填写空变量</h4></div><div><form name=varForm><div class=panel-tabs style=\"width: 100%\"><table class=\"table table-hover text-center table-condensed\"><thead><tr><th style=\"text-align: center\">#</th><th style=\"text-align: center\">变量名</th><th style=\"text-align: center\">值</th><th style=\"text-align: center\">描述</th></tr></thead><tr ng-repeat=\"ss in emptyvars.emptyVar\"><td style=\"width: 5%\">{{$index}}</td><td><input type=text class=\"form-control input-global\" ng-model=ss.name readonly></td><td><input type=text class=\"form-control input-global\" ng-model=ss.value required></td><td><input type=text class=\"form-control input-global\" ng-model=ss.describe readonly></td></tr></table></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=varForm.$invalid ng-click=emptyvars.inputOver()>确认</button> <button class=\"btn btn-warning\" ng-click=emptyvars.cancel()>取消</button></div></div></form></div>");
$templateCache.put("app/components/error/errorMsg.html","<div style=\"padding: 15px;color:red;font-weight:bold;font-size:14px\"><span>{{errmsg}}</span></div>");
$templateCache.put("app/components/footer/footer.html","<div id=footer><small><span>OPEN-C3 © {{footer.year}}</span></small></div>");
$templateCache.put("app/components/loading/loading.html","<div class=loading-container><div class=loading><div class=l1><div></div></div><div class=l2><div></div></div><div class=l3><div></div></div><div class=l4><div></div></div></div></div>");
$templateCache.put("app/components/machine/choiceMachine.html","<div class=modal-header><h4 class=modal-title>选择服务器</h4></div><div class=modal-body><form class=form-horizontal name=addForm role=form><div style=\"height: 40px;border-bottom: 1px solid #ddd\"><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\"><input type=radio ng-model=formType value=ip ng-click=choice.cleanSelected()> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>通过IP选择服务器</label><label ng-hide=groupHide class=\"option option-primary\"><input type=radio ng-model=formType value=group ng-click=choice.cleanSelected()> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>分组选择</label><label ng-show=variableShow class=\"option option-primary\"><input type=radio ng-model=formType value=variable ng-click=choice.cleanSelected()> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>选择变量</label></div></div></div></form><div ng-switch=formType><div ng-switch-when=ip><dataerror ng-hide=dataready errmsg={{dataerror}}></dataerror><div class=panel-tabs><table ng-table=choice.machine_Table show-filter=true class=\"table table-hover text-center table-condensed\"><!--<table class=\"table table-hover text-center table-condensed\">--><tr ng-repeat=\"ss in $data\" style=\"text-align: left\"><td style=\"width: 20%\" data-title=\"\'机器名称\'\" filter=\"{ name: \'text\'}\"><label for={{ss.name}} style=\"font-weight: normal;height: 100%;width: 100%\">{{ss.name}}</label></td><td style=\"width: 15%\" data-title=\"\'类型\'\" filter=\"{ type: \'text\'}\">{{ss.type}}</td><td style=\"width: 20%\" data-title=\"\'内网IP\'\" filter=\"{ inip: \'text\'}\"><label for={{ss.inip}} style=\"font-weight: normal;height: 100%;width: 100%\"><input id={{ss.inip}} ng-if=ss.inip type=checkbox name=selected ng-checked=\"isSelected(ss.id, \'inip\')\" ng-click=\"inipUpdateSelection($event, ss.id, ss.inip)\" style=\"zoom: 125%\">{{ss.inip}} <i ng-if=\"ss.inip && ! ss.inips.status\" class=\"fa fa-exclamation-circle\" aria-hidden=true></i> <i ng-if=\"ss.inip && ss.inips.status==\'fail\'\" class=\"fa fa-circle\" style=\"color: red\" aria-hidden=true></i> <i ng-if=\"ss.inip && ss.inips.status==\'success\'\" class=\"fa fa-circle\" style=\"color: green\" aria-hidden=true></i></label></td><td style=\"width: 20%\" data-title=\"\'外网ip\'\" filter=\"{ exip: \'text\'}\"><label for={{ss.exip}} style=\"font-weight: normal;height: 100%;width: 100%\"><input ng-if=ss.exip id={{ss.exip}} type=checkbox name=selected ng-checked=\"isSelected(ss.id, \'exip\')\" ng-click=\"exipUpdateSelection($event, ss.id, ss.exip)\" style=\"zoom: 125%\">{{ss.exip}} <i ng-if=\"ss.exip && ! ss.exips.status\" class=\"fa fa-exclamation-circle\" aria-hidden=true></i> <i ng-if=\"ss.exip && ss.exips.status==\'fail\'\" class=\"fa fa-circle\" style=\"color: red\" aria-hidden=true></i> <i ng-if=\"ss.exip && ss.exips.status==\'success\'\" class=\"fa fa-circle\" style=\"color: green\" aria-hidden=true></i></label></td><td style=\"width: 5%\" data-title=\"\'客户端版本\'\"><a ng-if=ss.inip>{{ss.inips.version}}</a> <a ng-if=\"ss.exip && ! ss.inip\">{{ss.exips.version}}</a></td><td style=\"width: 20%\" data-title=\"\'客户端上一次检测时间\'\"><a ng-if=ss.inip>{{ss.inips.edit_time}}</a> <a ng-if=\"ss.exip && ! ss.inip\">{{ss.exips.edit_time}}</a></td><td style=\"width: 20%\" data-title=\"\'客户端错误原因\'\"><a ng-if=\"ss.inip && ss.inips.status==\'fail\'\">failcount:{{ss.inips.fail}}; {{ss.inips.reason}}</a> <a ng-if=\"ss.exip && ! ss.inip && ss.exips.status==\'fail\'\">failcount:{{ss.exips.fail}}; {{ss.exips.reason}}</a></td></tr></table></div></div><!--组--><div ng-switch-when=group><dataerror ng-hide=dataready errmsg={{dataerror}}></dataerror><div class=panel-tabs><table ng-table=choice.group_Table class=\"table table-hover text-center table-condensed\"><!--<table class=\"table table-hover text-center table-condensed\">--><thead><tr><th><!--<input type=\"checkbox\" ng-click=\"selectAll($event)\" ng-checked=\"isSelectedAll()\" style=\"zoom: 125%\" />--></th><th>名称</th><th>插件</th></tr></thead><tbody><tr ng-repeat=\"ss in $data\"><td><input type=radio name=selected ng-checked=isSelected(ss.id) ng-click=\"updateRadio($event, ss.id, ss)\" style=\"zoom: 125%\"></td><td>{{ss.name}}</td><td>{{ss.plugin}}</td></tr></tbody></table></div></div><!--变量--><div ng-switch-when=variable style=\"width: 40%\"><dataerror ng-hide=dataready errmsg={{dataerror}}></dataerror><div class=panel-tabs><table ng-table=choice.group_Table class=\"table table-hover text-center table-condensed\"><!--<table class=\"table table-hover text-center table-condensed\">--><thead><tr><th>名称</th></tr></thead><tbody><tr><td><input type=text class=\"form-control input-global\" ng-model=ipVar.variable></td></tr></tbody></table></div></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=addForm.$invalid ng-click=choice.add()>确认</button> <button class=\"btn btn-warning\" ng-click=choice.cancel()>取消</button></div></div></div>");
$templateCache.put("app/components/menu/menu.html","<div id=sidebar_left class=affix style=\"background-color: #FFF;z-index: 0\"><div class=\"sidebar-left-content has-scrollbar\"><div id=\"sidebar-scroll nav sidebar-menu\"><div class=sidebar-content><div class=panel><div class=panel-heading><span class=panel-title>TREE</span> <span class=panel-controls><a href=javascript:void(0) ng-click=tree.focusCurrent()><i class=\"fa fa-map-marker\"></i></a> <a href=javascript:void(0) ng-click=tree.expandAll(true)><i class=\"fa fa-plus\"></i></a> <a href=javascript:void(0) ng-click=tree.expandAll(false)><i class=\"fa fa-minus\"></i></a> <a href=javascript:void(0) ng-click=tree.refresh()><i class=\"treeFresh fa fa-refresh\"></i></a></span></div><div class=\"panel-body prn\"><perfect-scrollbar class=scroller style=\"margin:-15px 0 -20px -20px\"><ul class=ztree id=openc3tree></ul></perfect-scrollbar></div></div></div></div></div></div>");
$templateCache.put("app/components/navbar/navbar.html","<header ng-init=\'openc3_style_ctrl=\"openc3\";openc3_job_system_only=0\' class=\"navbar navbar-fixed-top bg-danger\"><div ng-show=!openc3_job_system_only><div ng-if=\"openc3_style_ctrl == \'openc3\'\" class=navbar-branding><a class=navbar-brand ui-sref=\"home.dashboard({treeid: 4000000000})\"><img src=/assets/images/open-c3-logo.jpeg> <span>OPEN-C3</span></a></div><div ng-if=\"openc3_style_ctrl == \'juyun\'\" class=navbar-branding><a class=navbar-brand ui-sref=\"home.dashboard({treeid: 4000000000})\"><img style=\"width: 120px\" src=/assets/images/juyun-logo.jpeg> <span style=\"font-size: 10px\">OPEN-C3</span></a></div><ul class=\"nav navbar-nav navbar-left\"><li><form class=\"navbar-form navbar-left navbar-search\"><div style=\"width: 100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;word-wrap: break-word\"><input type=text class=form-control ng-model=selected placeholder=\"Search tree node name\" typeahead-on-select=\"nav.searchNode($item, $model, $label, $event)\" ng-click=nav.search_init() typeahead=\"name for name in nav.names.sort()|filter:$viewValue| limitTo:8\"></div></form></li></ul><ul class=\"nav navbar-nav navbar-left\"><li><a ui-sref=\"home.dashboard({treeid: nav.state.params.treeid})\"><span>仪表盘</span></a></li></ul><ul class=\"nav navbar-nav navbar-left\"><li class=dropdown uib-dropdown><a href=javascript:void(0) class=\"dropdown-toggle fw600 p15 lh30 ripple\" uib-dropdown-toggle><span>报告</span> <span class=\"caret caret-tp hidden-xs\"></span></a><ul class=\"dropdown-menu list-group dropdown-persist w250\" uib-dropdown-menu><li class=list-group-item><a ui-sref=\"home.gitreport({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>GIT报告</span> </a><a ui-sref=\"home.flowreport({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>流水线报告</span></a></li></ul></li></ul><ul class=\"nav navbar-nav navbar-left\"><li><a ui-sref=\"home.quickentry.flowline({treeid: nav.state.params.treeid})\"><span>流水线[CI/CD]</span></a></li></ul><ul class=\"nav navbar-nav navbar-left\"><li class=dropdown uib-dropdown><a href=javascript:void(0) class=\"dropdown-toggle fw600 p15 lh30 ripple\" uib-dropdown-toggle><span>快速执行</span> <span class=\"caret caret-tp hidden-xs\"></span></a><ul class=\"dropdown-menu list-group dropdown-persist w250\" uib-dropdown-menu><li class=list-group-item><a ui-sref=\"home.quickentry.runtask({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>启动任务</span> </a><a ui-sref=\"home.quickentry.cmd({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>脚本执行</span> </a><a ui-sref=\"home.quickentry.scp({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>分发文件</span> </a><a ui-sref=\"home.quickentry.approval({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>发起审批</span> </a><a ui-sref=\"home.quickentry.terminal({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>虚拟终端</span> </a><a ui-sref=\"home.quickentry.sendfile({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>文件发送</span></a></li></ul></li></ul><ul class=\"nav navbar-nav navbar-left\"><li class=dropdown uib-dropdown><a href=javascript:void(0) class=\"dropdown-toggle fw600 p15 lh30 ripple\" uib-dropdown-toggle><span>业务管理</span> <span class=\"caret caret-tp hidden-xs\"></span></a><ul class=\"dropdown-menu list-group dropdown-persist w250\" uib-dropdown-menu><li class=list-group-item><a ui-sref=\"home.business.job({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>作业管理</span> </a><a ui-sref=\"home.business.user({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>账户管理</span> </a><a ui-sref=\"home.business.file({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>文件管理</span> </a><a ui-sref=\"home.business.scripts({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>脚本管理</span> </a><a ui-sref=\"home.business.nodegroup({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>机器分组</span> </a><a ui-sref=\"home.business.nodebatch({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>机器分批</span> </a><a ui-sref=\"home.business.machine({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>机器管理</span> </a><a ui-sref=\"home.business.notify({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>报警通知</span> </a><a ui-sref=\"home.business.crontab({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>定时作业</span> </a><a ui-sref=\"home.business.agent({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>代理设置(AGENT安装)</span> </a><a ui-sref=\"home.business.variate({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>变量查看</span></a></li></ul></li></ul><ul class=\"nav navbar-nav navbar-left\"><li class=dropdown uib-dropdown><a href=javascript:void(0) class=\"dropdown-toggle fw600 p15 lh30 ripple\" uib-dropdown-toggle><span>执行历史</span> <span class=\"caret caret-tp hidden-xs\"></span></a><ul class=\"dropdown-menu list-group dropdown-persist w250\" uib-dropdown-menu><li class=list-group-item><a ui-sref=\"home.history.jobx({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>分组任务</span> </a><a ui-sref=\"home.history.job({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>作业任务</span> </a><a ui-sref=\"home.history.terminal({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>虚拟终端</span></a></li></ul></li></ul><ul class=\"nav navbar-nav navbar-right\"><!--<li class=\"menu-divider hidden-xs\">--><!--<i class=\"fa fa-circle\"></i>--><!--</li>--><li><a ui-sref=\"home.quickentry.smallapplication({treeid: nav.state.params.treeid})\"><span>轻应用</span></a></li><li class=dropdown uib-dropdown><a href=javascript:void(0) class=\"dropdown-toggle fw600 p15 lh30 ripple\" uib-dropdown-toggle><span>容器集群</span> <span class=\"caret caret-tp hidden-xs\"></span></a><ul class=\"dropdown-menu list-group dropdown-persist w250\" uib-dropdown-menu><li class=\"dropdown-header clearfix\" style=\"border: 0\"><div class=\"pull-left ml10\">kubernetes</div></li><li class=list-group-item><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.kubernetesmanage({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>应用管理</span></a></li><li class=\"dropdown-header clearfix\" style=\"border: 0\"><div class=\"pull-left ml10\">AWS ECS</div></li><li class=list-group-item><a style=\"padding: 8px 9px 8px 37px\" class=\"animated animated-short fadeInUp\"><span>开发中...</span></a></li></ul></li><li ng-if=\"openc3_style_ctrl == \'juyun\'\" class=dropdown uib-dropdown><a href=https://console.polymericcloud.com class=\"dropdown-toggle fw600 p15 lh30 ripple\"><span>返回聚云立方</span></a></li><li ng-if=\"nav.user.admin==1\" class=dropdown uib-dropdown><a href=javascript:void(0) class=\"dropdown-toggle fw600 p15 lh30 ripple\" uib-dropdown-toggle><span>管理员</span> <span class=\"caret caret-tp hidden-xs\"></span></a><ul class=\"dropdown-menu list-group dropdown-persist w250\" uib-dropdown-menu><li class=\"dropdown-header clearfix\" style=\"border: 0\"><div class=\"pull-left ml10\">全局信息</div></li><li class=list-group-item><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.global.notify({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>通知管理</span> </a><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.global.template({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>模板管理</span> </a><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.global.monitor({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>监控信息</span> </a><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.global.auditlog({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>审计日志</span> </a><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.quickentry.smallapplicationedit({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>轻应用配置</span> </a><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.global.useraddr({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>地址簿管理</span> </a><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.global.private({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>私有节点管理</span></a></li></ul></li><li ng-if=\"nav.user.showconnector==1 || nav.user.admin==1\" class=dropdown uib-dropdown><a href=javascript:void(0) class=\"dropdown-toggle fw600 p15 lh30 ripple\" uib-dropdown-toggle><span>连接器</span> <span class=\"caret caret-tp hidden-xs\"></span></a><ul class=\"dropdown-menu list-group dropdown-persist w250\" uib-dropdown-menu><li ng-if=\"nav.user.admin==1\" class=\"dropdown-header clearfix\" style=\"border: 0\"><div class=\"pull-left ml10\">设置连接器</div></li><li ng-if=\"nav.user.admin==1\" class=list-group-item><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.connector.config({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>设置连接器</span></a></li><li ng-if=\"nav.user.admin==1\" class=\"dropdown-header clearfix\" style=\"border: 0\"><div class=\"pull-left ml10\">登录管理(内置)</div></li><li ng-if=\"nav.user.admin==1\" class=list-group-item><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.connector.userinfo({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>用户管理</span> </a><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.connector.userauth({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>权限管理</span></a></li><li class=\"dropdown-header clearfix\" style=\"border: 0\"><div class=\"pull-left ml10\">服务树(内置)</div></li><li class=list-group-item><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.connector.tree({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>编辑服务树节点</span> </a><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.connector.node({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>编辑服务树资源</span></a></li><li class=\"dropdown-header clearfix\" style=\"border: 0\"><div class=\"pull-left ml10\">消息出口(内置)</div></li><li class=list-group-item><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.connector.mail({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>给我的邮件</span> </a><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.connector.mesg({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>给我的短信</span></a></li></ul></li><li class=dropdown uib-dropdown><a href=javascript:void(0) class=\"dropdown-toggle fw600 p15 lh30 ripple\" uib-dropdown-toggle><span>{{ nav.user.name }}</span> <span class=\"caret caret-tp hidden-xs\"></span></a><ul class=\"dropdown-menu list-group dropdown-persist w250\" uib-dropdown-menu><li class=\"dropdown-header clearfix\"><div class=\"pull-left ml10\">用户:{{ nav.user.email }}</div><div class=\"pull-left ml10\">组织:{{ nav.user.company }}</div></li><li class=list-group-item><a href=javascript:void(0) class=\"animated animated-short fadeInUp\" ui-sref=\"home.favorites({treeid: nav.state.params.treeid})\"><span class=\"fa fa-star\"></span><span>我的收藏夹</span> </a><a href=javascript:void(0) class=\"animated animated-short fadeInUp\" ui-sref=\"home.approval({treeid: nav.state.params.treeid})\"><span class=\"fa fa-hand-o-right\"></span><span>我的审批</span> </a><a href=javascript:void(0) class=\"animated animated-short fadeInUp\" ui-sref=\"home.assignment({treeid: nav.state.params.treeid})\"><span class=\"fa fa-blind\"></span><span>操作协助</span> </a><a href=javascript:void(0) class=\"animated animated-short fadeInUp\" ui-sref=\"home.global.ticket({treeid: nav.state.params.treeid})\"><span class=\"fa fa-ticket\"></span><span>我的凭据</span> </a><a href=javascript:void(0) class=\"animated animated-short fadeInUp\" ui-sref=\"home.global.images({treeid: nav.state.params.treeid})\"><span class=\"fa fa-cube\"></span><span>我的镜像</span></a></li><li class=list-group-item><a href=/book/index.html target=_blank class=\"animated animated-short fadeInUp\"><span class=\"fa fa-book\"></span><span>使用手册</span></a></li><li class=list-group-item><a href=javascript:void(0) class=\"animated animated-short fadeInUp\" ui-sref=\"home.global.versionlog({treeid: nav.state.params.treeid})\"><span class=\"fa fa-diamond\"></span><span>版本信息</span></a></li><li class=list-group-item><a href=javascript:void(0) class=\"animated animated-short fadeInUp\" ng-click=nav.chpasswd()><span class=\"fa fa-key\"></span><span>修改密码</span> </a><a href=javascript:void(0) class=\"animated animated-short fadeInUp\" ng-click=nav.logout()><span class=\"fa fa-power-off\"></span><span>登出</span></a></li></ul></li></ul></div><div ng-show=openc3_job_system_only><div ng-if=\"openc3_style_ctrl == \'openc3\'\" class=navbar-branding><a class=navbar-brand ui-sref=\"home.dashboard({treeid: 4000000000})\"><img src=/assets/images/open-c3-logo.jpeg> <span>OPEN-C3 作业平台</span></a></div><div ng-if=\"openc3_style_ctrl == \'juyun\'\" class=navbar-branding><a class=navbar-brand ui-sref=\"home.dashboard({treeid: 4000000000})\"><img style=\"width: 120px\" src=/assets/images/juyun-logo.jpeg> <span style=\"font-size: 10px\">OPEN-C3</span></a></div><ul class=\"nav navbar-nav navbar-left\"><li><form class=\"navbar-form navbar-left navbar-search\"><div style=\"width: 100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;word-wrap: break-word\"><input type=text class=form-control ng-model=selected placeholder=\"Search tree node name\" typeahead-on-select=\"nav.searchNode($item, $model, $label, $event)\" ng-click=nav.search_init() typeahead=\"name for name in nav.names.sort()|filter:$viewValue| limitTo:8\"></div></form></li></ul><ul class=\"nav navbar-nav navbar-left\"><li><a ui-sref=\"home.dashboard({treeid: nav.state.params.treeid})\"><span>仪表盘</span></a></li></ul><ul class=\"nav navbar-nav navbar-left\"><li class=dropdown uib-dropdown><a href=javascript:void(0) class=\"dropdown-toggle fw600 p15 lh30 ripple\" uib-dropdown-toggle><span>快速执行</span> <span class=\"caret caret-tp hidden-xs\"></span></a><ul class=\"dropdown-menu list-group dropdown-persist w250\" uib-dropdown-menu><li class=list-group-item><a ui-sref=\"home.quickentry.runtask({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>启动任务</span> </a><a ui-sref=\"home.quickentry.cmd({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>脚本执行</span> </a><a ui-sref=\"home.quickentry.scp({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>分发文件</span> </a><a ui-sref=\"home.quickentry.sendfile({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>文件发送</span></a></li></ul></li></ul><ul class=\"nav navbar-nav navbar-left\"><li class=dropdown uib-dropdown><a href=javascript:void(0) class=\"dropdown-toggle fw600 p15 lh30 ripple\" uib-dropdown-toggle><span>业务管理</span> <span class=\"caret caret-tp hidden-xs\"></span></a><ul class=\"dropdown-menu list-group dropdown-persist w250\" uib-dropdown-menu><li class=list-group-item><a ui-sref=\"home.business.job({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>作业管理</span> </a><a ui-sref=\"home.business.user({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>账户管理</span> </a><a ui-sref=\"home.business.file({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>文件管理</span> </a><a ui-sref=\"home.business.scripts({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>脚本管理</span> </a><a ui-sref=\"home.business.nodegroup({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>机器分组</span> </a><a ui-sref=\"home.business.machine({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>机器管理</span> </a><a ui-sref=\"home.business.notify({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>报警通知</span> </a><a ui-sref=\"home.business.crontab({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>定时作业</span> </a><a ui-sref=\"home.business.agent({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>代理设置(AGENT安装)</span></a></li></ul></li></ul><ul class=\"nav navbar-nav navbar-left\"><li><a ui-sref=\"home.history.job({treeid: nav.state.params.treeid})\"><span>执行历史</span></a></li></ul><ul class=\"nav navbar-nav navbar-right\"><!--<li class=\"menu-divider hidden-xs\">--><!--<i class=\"fa fa-circle\"></i>--><!--</li>--><li ng-if=\"openc3_style_ctrl == \'juyun\'\" class=dropdown uib-dropdown><a href=https://console.polymericcloud.com class=\"dropdown-toggle fw600 p15 lh30 ripple\"><span>返回聚云立方</span></a></li><li ng-if=\"nav.user.admin==1\" class=dropdown uib-dropdown><a href=javascript:void(0) class=\"dropdown-toggle fw600 p15 lh30 ripple\" uib-dropdown-toggle><span>管理员</span> <span class=\"caret caret-tp hidden-xs\"></span></a><ul class=\"dropdown-menu list-group dropdown-persist w250\" uib-dropdown-menu><li class=\"dropdown-header clearfix\" style=\"border: 0\"><div class=\"pull-left ml10\">全局信息</div></li><li class=list-group-item><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.global.notify({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>通知管理</span> </a><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.global.template({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>模板管理</span> </a><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.global.monitor({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>监控信息</span> </a><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.global.auditlog({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>审计日志</span> </a><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.global.useraddr({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>地址簿管理</span></a></li></ul></li><li ng-if=\"nav.user.showconnector==1 || nav.user.admin==1\" class=dropdown uib-dropdown><a href=javascript:void(0) class=\"dropdown-toggle fw600 p15 lh30 ripple\" uib-dropdown-toggle><span>连接器</span> <span class=\"caret caret-tp hidden-xs\"></span></a><ul class=\"dropdown-menu list-group dropdown-persist w250\" uib-dropdown-menu><li ng-if=\"nav.user.admin==1\" class=\"dropdown-header clearfix\" style=\"border: 0\"><div class=\"pull-left ml10\">设置连接器</div></li><li ng-if=\"nav.user.admin==1\" class=list-group-item><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.connector.config({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>设置连接器</span></a></li><li ng-if=\"nav.user.admin==1\" class=\"dropdown-header clearfix\" style=\"border: 0\"><div class=\"pull-left ml10\">登录管理(内置)</div></li><li ng-if=\"nav.user.admin==1\" class=list-group-item><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.connector.userinfo({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>用户管理</span> </a><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.connector.userauth({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>权限管理</span></a></li><li class=\"dropdown-header clearfix\" style=\"border: 0\"><div class=\"pull-left ml10\">服务树(内置)</div></li><li class=list-group-item><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.connector.tree({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>编辑服务树节点</span> </a><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.connector.node({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>编辑服务树资源</span></a></li><li class=\"dropdown-header clearfix\" style=\"border: 0\"><div class=\"pull-left ml10\">消息出口(内置)</div></li><li class=list-group-item><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.connector.mail({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>给我的邮件</span> </a><a style=\"padding: 8px 9px 8px 37px\" ui-sref=\"home.connector.mesg({treeid: nav.state.params.treeid})\" class=\"animated animated-short fadeInUp\"><span>给我的短信</span></a></li></ul></li><li class=dropdown uib-dropdown><a href=javascript:void(0) class=\"dropdown-toggle fw600 p15 lh30 ripple\" uib-dropdown-toggle><span>{{ nav.user.name }}</span> <span class=\"caret caret-tp hidden-xs\"></span></a><ul class=\"dropdown-menu list-group dropdown-persist w250\" uib-dropdown-menu><li class=\"dropdown-header clearfix\"><div class=\"pull-left ml10\">用户:{{ nav.user.email }}</div><div class=\"pull-left ml10\">组织:{{ nav.user.company }}</div></li><li class=list-group-item><a href=/book/index.html target=_blank class=\"animated animated-short fadeInUp\"><span class=\"fa fa-book\"></span><span>使用手册</span></a></li><li class=list-group-item><a href=javascript:void(0) class=\"animated animated-short fadeInUp\" ui-sref=\"home.global.versionlog({treeid: nav.state.params.treeid})\"><span class=\"fa fa-diamond\"></span><span>版本信息</span></a></li><li class=list-group-item><a href=javascript:void(0) class=\"animated animated-short fadeInUp\" ng-click=nav.chpasswd()><span class=\"fa fa-key\"></span><span>修改密码</span> </a><a href=javascript:void(0) class=\"animated animated-short fadeInUp\" ng-click=nav.logout()><span class=\"fa fa-power-off\"></span><span>登出</span></a></li></ul></li></ul></div></header>");
$templateCache.put("app/components/nodestr/nodeStr.html","<div><div class=pull-left><h4 style=\"font-weight: bold\">{{node.nodeStr}}</h4></div></div>");
$templateCache.put("app/components/scripts/createButton.html","<button class=\"btn btn-primary\" ng-click=creat.creats()><i class=\"fa fa-clone fa-fw\"></i>新建脚本</button>");
$templateCache.put("app/components/scripts/createScript.html","<div class=modal-header><h4 class=modal-title>新建脚本</h4></div><div class=modal-body><form class=form-horizontal role=form name=createForm><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">脚本名称 <span style=\"color: red\">*</span> :</label><div class=col-sm-9><input type=text name=scriptname class=form-control ng-model=scriptName ng-minlength=2 required> <span style=color:red ng-show=createForm.scriptname.$error.minlength>不少于2字符</span> {{name}}</div></div></div><div class=row ng-hide=editStatus><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">脚本来源 <span style=\"color: red\">*</span> :</label><div class=col-sm-9><!--选择 仓库类型--><div class=admin-form ng-disabled=unClick><div class=\"option-group field\"><label class=\"option option-primary\"><input type=radio name=src ng-model=createS.from value=manual ng-disabled=unClick ng-click=createS.scriptManual()> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>手工录入</label><label class=\"option option-primary\"><input type=radio name=src ng-model=createS.from value=clone ng-disabled=unClick ng-click=createS.scriptClone()> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>脚本克隆</label></div><div ng-hide=createS.scriptHide style=\"padding-top: 10px; padding-left: 0\"><select class=form-control ng-model=selectedScript ng-change=createS.inputScript() ng-options=\"s.name for s in allScript\"></select><dataerror ng-hide=dataready errmsg={{dataerror}}></dataerror></div></div></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">脚本内容 <span style=\"color: red\">*</span> :</label><div class=col-sm-9><div class=\"panel panel-primary\"><div style=\"border: 1px solid #e5e5e5;padding: 10px\"><!--选择 仓库类型--><div class=admin-form><div class=\"option-group field\" style=\"padding-bottom: 9px\"><label class=\"option option-primary\"><input type=radio name=code ng-model=scriptType ng-click=createS.editorSh() value=shell> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>shell</label><label class=\"option option-primary\"><input type=radio name=code ng-model=scriptType ng-click=createS.editorPy() value=python> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>python</label><label class=\"option option-primary\"><input type=radio name=code ng-model=scriptType ng-click=createS.editorPerl() value=perl> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>perl</label><label class=\"option option-primary\"><input type=radio name=code ng-model=scriptType ng-click=createS.editorPhp() value=php> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>php</label><label class=\"option option-primary\"><input type=radio name=code ng-model=scriptType ng-click=createS.editorBuildin() value=buildin> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>内建</label><label class=\"option option-primary\"><input type=radio name=code ng-model=scriptType ng-click=createS.editorAuto() value=auto> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>自动识别</label></div></div><div class=form-horizontal><!-- shell --><div style=height:400px class=form-group id=editor></div></div></div></div></div></div><a class=\"glyphicon glyphicon-question-sign\" data-toggle=tooltip data-placement=right target=_blank ng-href=/book/客户端内置命令/ uib-tooltip=查看客户端内置命令帮助 aria-hidden=true style=\"padding-top: 11px;font-size: larger\"></a></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=createForm.$invalid ng-click=createS.save()>保存</button> <button class=\"btn btn-warning\" ng-click=createS.cancel()>取消</button></div></div></form></div>");
$templateCache.put("app/components/variable/choiceVar.html","<div class=modal-header><h4 class=modal-title>构建文件</h4></div><div><div class=panel-tabs style=\"width: 100%\"><table class=\"table table-hover text-center table-condensed\"><thead><tr><th style=\"text-align: center\">构建ID(流水线ID)</th><th ng-if=!fileci style=\"text-align: center\">版本</th></tr></thead><tr><td><input type=text class=\"form-control input-global\" ng-model=ciData.ci></td><td><input type=text class=\"form-control input-global\" ng-model=ciData.version></td></tr></table></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=addForm.$invalid ng-click=choicevar.chioceover()>确认</button> <button class=\"btn btn-warning\" ng-click=choicevar.cancel()>取消</button></div></div></div>");
$templateCache.put("app/pages/approval/approval.html","<div class=\"row block\"><div><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=approval.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!approval.loadover}\"></i></button></span><h5>我的审批</h5></div><div class=panel-body ng-init=\"ns = { \'null\': \'未发送\', \'sending\': \'发送中\', \'done\':\'完成\', \'skip\': \'忽略\', \'fail\': \'失败\'}\"><div class=panel-tabs><table ng-table=approval.dataTable class=\"table table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"d in $data\"><td style=\"width: 10%\" data-title=\"\'创建时间\'\" filter=\"{ create_time: \'text\'}\" sortable>{{d.create_time}}</td><td style=\"width: 10%\" data-title=\"\'结束时间\'\" filter=\"{ finishtime: \'text\'}\" sortable>{{d.finishtime}}</td><td style=\"width: 10%\" data-title=\"\'耗时\'\">{{ approval.seftime(d.create_time,d.finishtime)}}</td><td style=\"width: 10%\" data-title=\"\'提交人\'\" filter=\"{ submitter: \'text\'}\" sortable>{{d.submitter}}</td><td style=\"width: 20%\" data-title=\"\'审批名称\'\" filter=\"{ name: \'text\'}\" sortable>{{d.name}}</td><td style=\"width: 10%\" data-title=\"\'OA单号\'\" filter=\"{ oauuid: \'text\'}\" sortable><a ng-if=\"d.oauuid==0\">尚未发送</a> <a ng-if=\"d.oauuid==1\">创建中</a> <a ng-if=\"d.oauuid!=0 && d.oauuid!=1\">{{d.oauuid}}</a></td><td style=\"width: 10%\" data-title=\"\'通知状态\'\">{{ns[d.notifystatus]}}</td><td style=\"width: 10%\" data-title=\"\'审批状态\'\" sortable><a ng-if=\"d.opinion == \'agree\'\" style=\"color: green\">同意 </a><a ng-if=\"d.opinion == \'unconfirmed\'\">未审批 </a><a ng-if=\"d.opinion == \'refuse\'\" style=\"color: red\">拒绝</a></td><td style=\"width: 10%\" data-title=\"\'操作\'\"><button ng-if=\"d.opinion==\'unconfirmed\'\" class=\"btn btn-primary btn-sm\" ng-click=approval.edit(d.uuid,1)>审批</button> <button ng-if=\"d.opinion!=\'unconfirmed\'\" class=\"btn btn-info btn-sm\" ng-click=approval.edit(d.uuid,0)>查看</button></td></tr></table></div></div></div></div></div>");
$templateCache.put("app/pages/assignment/assignment.html","<div class=\"row block\" ng-init=\"assignmentns = { \'todo\': \'待办\', \'fail\': \'操作失败\', \'success\':\'已完成\', \'refuse\': \'已拒绝\', \'cancel\': \'已取消\', \'close\': \'关闭\'}\"><div><div class=\"panel panel-info\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-info\" uib-tooltip=刷新 ng-click=assignment.reloadA()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!assignment.loadoverA}\"></i></button></span><h5>我请求的协助</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=assignment.bymeTable class=\"table table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"d in $data\"><td style=\"width: 10%\" data-title=\"\'创建时间\'\" filter=\"{ create_time: \'text\'}\" sortable>{{d.create_time}}</td><td style=\"width: 10%\" data-title=\"\'结束时间\'\" filter=\"{ finish_time: \'text\'}\" sortable>{{d.finish_time}}</td><td style=\"width: 10%\" data-title=\"\'耗时\'\">{{ assignment.seftime(d.create_time,d.finish_time)}}</td><td style=\"width: 10%\" data-title=\"\'处理人\'\" filter=\"{ handler: \'text\'}\" sortable>{{d.handler}}</td><td style=\"width: 20%\" data-title=\"\'审批名称\'\" filter=\"{ name: \'text\'}\" sortable>{{d.name}}</td><td style=\"width: 10%\" data-title=\"\'状态\'\">{{assignmentns[d.status]}}</td><td style=\"width: 10%\" data-title=\"\'操作\'\"><button ng-disabled=\"d.status!==\'todo\'\" class=\"btn btn-primary btn-sm\" ng-click=\"assignment.updateStatus(d.id, \'cancel\')\">取消</button> <button class=\"btn btn-info btn-sm\" ng-click=assignment.edit(d.id,0)>详情</button></td></tr></table></div></div></div></div><div><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=assignment.reloadB()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!assignment.loadoverB}\"></i></button></span><h5>需要我协助</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=assignment.tomeTable class=\"table table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"d in $data\"><td style=\"width: 10%\" data-title=\"\'创建时间\'\" filter=\"{ create_time: \'text\'}\" sortable>{{d.create_time}}</td><td style=\"width: 10%\" data-title=\"\'结束时间\'\" filter=\"{ finish_time: \'text\'}\" sortable>{{d.finish_time}}</td><td style=\"width: 10%\" data-title=\"\'耗时\'\">{{ assignment.seftime(d.create_time,d.finish_time)}}</td><td style=\"width: 10%\" data-title=\"\'提交人\'\" filter=\"{ submitter: \'text\'}\" sortable>{{d.submitter}}</td><td style=\"width: 20%\" data-title=\"\'审批名称\'\" filter=\"{ name: \'text\'}\" sortable>{{d.name}}</td><td style=\"width: 10%\" data-title=\"\'状态\'\">{{assignmentns[d.status]}}</td><td style=\"width: 10%\" data-title=\"\'操作\'\"><button ng-disabled=\"d.status!==\'todo\'\" class=\"btn btn-primary btn-sm\" ng-click=\"assignment.commit(d, \'todo\')\">提交</button> <button ng-disabled=\"d.status!==\'todo\'\" class=\"btn btn-primary btn-sm\" ng-click=\"assignment.updateStatus(d.id, \'refuse\')\">拒绝</button> <button ng-disabled=\"d.status!==\'fail\'\" class=\"btn btn-primary btn-sm\" ng-click=\"assignment.commit(d, \'fail\')\">重试</button> <button ng-disabled=\"d.status!==\'fail\'\" class=\"btn btn-primary btn-sm\" ng-click=\"assignment.updateStatus(d.id, \'close\')\">关闭</button> <button class=\"btn btn-info btn-sm\" ng-click=\"assignment.edit(d.id, 1)\">详情</button></td></tr></table></div></div></div></div></div>");
$templateCache.put("app/pages/assignment/assignmentcommit.html","<div class=\"row block\"><div class=modal-header><h4 class=modal-title>操作协助</h4></div><div class=modal-body><form class=form-horizontal name=myForm role=form><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">协助人</label><div class=col-sm-9><input type=text class=form-control name=handler placeholder=协助人 ng-model=assignmentcommit.postData.handler required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">申请操作理由</label><div class=col-sm-9><textarea type=text class=form-control name=reason placeholder=操作理由 rows=3 cols=100 ng-model=assignmentcommit.postData.submit_reason required></textarea></div></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=assignmentcommit.commit()>提交</button> <button class=\"btn btn-warning\" ng-click=assignmentcommit.cancel()>取消</button></div></div></form></div></div><style>.modal-dialog {width: 40%;}</style>");
$templateCache.put("app/pages/connector/connector.html","<div class=\"row block\"><div ui-view></div></div>");
$templateCache.put("app/pages/business/business.html","<div class=\"row block\"><div ui-view></div></div>");
$templateCache.put("app/pages/dashboard/dashboard.html","<div class=\"row block\"><div class=\"col-lg-3 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 class=kb_title>业务主机数</h4></div><div class=panel-body><div style=\"font-size: 45px;font-weight: bold;text-align: center;height: 115px\"><span>{{businessCount}}</span></div></div></div></div><div class=\"col-lg-3 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">常用作业数</h4></div><div class=panel-body><div style=\"font-size: 45px;font-weight: bold;text-align: center;height: 115px\"><span>{{commonCount}}</span></div></div></div></div><div class=\"col-lg-3 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">本月执行任务数</h4></div><div class=panel-body><div style=\"font-size: 45px;font-weight: bold;text-align: center\"><span>{{monthTask}}</span></div><div style=\"font-size: 12px;font-weight: bold;text-align: left\"><p style=\"margin: 0;color: green\">成功：{{success}}</p><p style=\"margin: 0;color: red\">失败：{{fail}}</p><p style=\"margin: 0;color: #f19e01\">执行中：{{running}}</p></div></div></div></div><div class=\"col-lg-3 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">定时任务数</h4></div><div class=panel-body><div style=\"font-size: 45px;font-weight: bold;text-align: center;height: 82px\"><span>{{crontCount}}</span></div><div style=\"font-size: 12px;font-weight: bold;text-align: left\"><p style=\"margin: 0;color: green\">启动：{{available}}</p><p style=\"margin: 0;color: red\">暂停：{{unavailable}}</p></div></div></div></div><div class=\"col-lg-12 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">历史任务执行情况</h4></div><div class=panel-body style=\"margin-top: 20px\"><div id=container></div></div></div></div><div class=\"col-lg-5 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">任务执行时长统计</h4></div><div class=panel-body><div id=container2 style=min-width:400px;height:400px></div></div></div></div><div class=\"col-lg-7 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">最近任务执行记录</h4></div><div class=panel-body><div style=\"height: 25px\"><a style=\"right: 0;position: absolute;margin-right: 20px\" ui-sref=\"home.history.job({treeid: dashboard.treeid})\" class=\"animated animated-short fadeInUp\"><span>更多</span></a></div><div class=panel-tabs><table ng-table=dashboard.data_Table class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"ss in $data\" style=\"height: 35px\"><td data-title=\"\'执行用户\'\">{{ss.user}}</td><td data-title=\"\'耗时\'\">{{dashboard.seftime(ss.starttime, ss.finishtime)}}</td><td data-title=\"\'当前状态\'\">{{dashboard.statuszh[ss.status]}}</td><td data-title=\"\'作业名称\'\"><a ng-if=!dashboard.ciinfo[ss.name]>{{ss.name}}</a> <a ng-if=dashboard.ciinfo[ss.name]>{{dashboard.ciinfo[ss.name]}}</a></td></tr></table></div></div></div></div></div>");
$templateCache.put("app/pages/favorites/addFavorites.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=addfavorites.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!addfavorites.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=addfavorites.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>我的流水线</h5></div><div class=panel-body><div class=pt20><table ng-table=addfavorites.activeRegionTable class=\"table table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td style=\"width: 5%\" data-title=\"\'ID\'\" filter=\"{ id: \'text\'}\" sortable><i class=\"fa fa-star-o fa-1x\" aria-hidden=true ng-if=!m.favorites ng-click=addfavorites.addToFavorites(m.id,m.name) uib-tooltip=收藏 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-star fa-1x\" aria-hidden=true ng-if=m.favorites ng-click=addfavorites.delToFavorites(m.id,m.name) uib-tooltip=取消收藏 style=\"cursor:pointer;color: #339094\"></i> {{m.id}}</td><td style=\"width: 15%\" data-title=\"\'名称\'\" filter=\"{ name: \'text\'}\" sortable>{{m.name}}</td><td style=\"width: 15%\" data-title=\"\'别名\'\" filter=\"{ alias: \'text\'}\" sortable>{{m.alias}}</td><td style=\"width: 25%\" data-title=\"\'服务树名\'\" filter=\"{ treename: \'text\'}\" sortable>{{m.treename}}</td><td style=\"width: 30%\" data-title=\"\'代码仓库地址\'\" filter=\"{ addr: \'text\'}\" sortable>{{m.addr}}</td><td style=\"width: 5%\" data-title=\"\'编辑者\'\" filter=\"{ edit_user: \'text\'}\" sortable>{{m.edit_user}}</td></tr></table></div></div></div></div><style>.modal-dialog {width: 100%;}</style>");
$templateCache.put("app/pages/favorites/favorites.html","<cmloading ng-if=!favorites.loadover></cmloading><div class=\"row block\"><div><div style=\"float: right\"><form class=form-inline name=myForm novalidate><button type=submit class=\"btn btn-primary\" style=\"padding: 10px 25px\" ng-click=favorites.addFavorites()><i class=\"fa fa-plus-circle fa-lg\" aria-hidden=true></i> 更多待收藏</button></form></div><div style=\"clear: both\">&nbsp;</div></div><div class=\"panel panel-primary\"><div style=\"padding: 10px\"></div><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=favorites.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!favorites.loadover}\"></i></button></span><h5>我收藏的流水线</h5></div><div class=panel-body><div class=pt20><table ng-table=favorites.activeRegionTable class=\"table table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td style=\"width: 10%\" data-title=\"\'ID\'\" filter=\"{ id: \'text\'}\" sortable><i class=\"fa fa-star fa-1x\" aria-hidden=true ng-if=m.favorites ng-click=favorites.delToFavorites(m.id,m.name) uib-tooltip=取消收藏 style=\"cursor:pointer;color: #339094\"></i> {{m.id}}</td><td style=\"width: 10%\" data-title=\"\'名称\'\" filter=\"{ name: \'text\'}\" sortable>{{m.name}}</td><td style=\"width: 10%\" data-title=\"\'别名\'\" filter=\"{ alias: \'text\'}\" sortable>{{m.alias}}</td><td style=\"width: 10%\" data-title=\"\'服务树名\'\" filter=\"{ treename: \'text\'}\" sortable><nobr>{{m.treename}} <i class=\"fa fa-chevron-circle-right fa-1x\" aria-hidden=true ng-click=favorites.treedetail(m.groupid) uib-tooltip=进入 style=\"cursor:pointer;color: #339094\"></i></nobr></td><td style=\"width: 10%\" data-title=\"\'构建状态\'\"><div class=\"panel panel-info\" ng-if=m.lastbuild.status style=\"cursor:pointer;background-color: {{panelcolor[m.lastbuild.status]}};margin: 0 0 0\" ng-click=\"favorites.showlog(m.lastbuild.uuid, m.lastbuild.slave)\"><i class=\"fa fa-cloud\" ng-if=\"m.lastbuild.status==\'fail\'\" aria-hidden=true></i> <i class=\"fa fa-spinner\" ng-if=\"m.lastbuild.status==\'running\'\" ng-class=\"{\'fa-spin\':1}\" aria-hidden=true></i> <i class=\"fa fa-sun-o\" ng-if=\"m.lastbuild.status==\'success\'\" aria-hidden=true></i> # {{m.lastbuild.name}}<br>耗时 {{favorites.seftime(m.lastbuild.starttime,m.lastbuild.finishtime)}}<br>{{favorites.time2date(m.lastbuild.starttime)}}</div></td><td style=\"width: 15%\" data-title=\"\'测试环境状态\'\"><div class=\"panel panel-info\" ng-if=favorites.taskInfoTest[m.id] style=\"cursor:pointer;background-color: {{panelcolor[favorites.taskInfoTest[m.id].status]}};margin: 0 0 0\" ng-click=favorites.deployDetail(favorites.taskInfoTest[m.id].projectid,favorites.taskInfoTest[m.id].uuid)><i class=\"fa fa-cloud\" ng-if=\"favorites.taskInfoTest[m.id].status==\'fail\'\" aria-hidden=true></i> <i class=\"fa fa-spinner\" ng-if=\"favorites.taskInfoTest[m.id].status==\'running\'\" ng-class=\"{\'fa-spin\':1}\" aria-hidden=true></i> <i class=\"fa fa-sun-o\" ng-if=\"favorites.taskInfoTest[m.id].status==\'success\'\" aria-hidden=true></i> # {{favorites.taskInfoTest[m.id].version}}<br>耗时 {{favorites.seftime(favorites.taskInfoTest[m.id].starttime, favorites.taskInfoTest[m.id].finishtime)}}<br>{{favorites.time2date(favorites.taskInfoTest[m.id].starttime)}} <i class=\"fa fa-spinner\" ng-if=\"favorites.taskInfoTestRunning[m.id] && favorites.taskInfoTest[m.id].status!=\'running\' \" ng-class=\"{\'fa-spin\':1}\" aria-hidden=true></i></div></td><td style=\"width: 15%\" data-title=\"\'线上环境状态\'\"><div class=\"panel panel-info\" ng-if=favorites.taskInfoOnline[m.id] style=\"cursor:pointer;background-color: {{panelcolor[favorites.taskInfoOnline[m.id].status]}};margin: 0 0 0\" ng-click=favorites.deployDetail(favorites.taskInfoOnline[m.id].projectid,favorites.taskInfoOnline[m.id].uuid)>{{favorites.deployType(favorites.taskInfoOnline[m.id].uuid)}} <i class=\"fa fa-cloud\" ng-if=\"favorites.taskInfoOnline[m.id].status==\'fail\'\" aria-hidden=true></i> <i class=\"fa fa-spinner\" ng-if=\"favorites.taskInfoOnline[m.id].status==\'running\'\" ng-class=\"{\'fa-spin\':1}\" aria-hidden=true></i> <i class=\"fa fa-sun-o\" ng-if=\"favorites.taskInfoOnline[m.id].status==\'success\'\" aria-hidden=true></i> # {{favorites.taskInfoOnline[m.id].version}}<br>耗时 {{favorites.seftime(favorites.taskInfoOnline[m.id].starttime, favorites.taskInfoOnline[m.id].finishtime)}}<br>{{favorites.time2date(favorites.taskInfoOnline[m.id].starttime)}} <i class=\"fa fa-spinner\" ng-if=\"favorites.taskInfoOnlineRunning[m.id] && favorites.taskInfoOnline[m.id].status!=\'running\'\" ng-class=\"{\'fa-spin\':1}\" aria-hidden=true></i></div></td><td style=\"width: 10%\" data-title=\"\'编辑者\'\" filter=\"{ user: \'text\'}\" sortable>{{m.edit_user}}</td><td data-title=\"\'操作\'\"><nobr><i class=\"fa fa-chevron-circle-right fa-2x\" aria-hidden=true ng-click=favorites.versiondetail(m.groupid,m.id) uib-tooltip=进入 style=\"cursor:pointer;color: #339094\"></i></nobr></td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/flowreport/flowreport.html","<div class=\"row block\"><div class=\"col-lg-3 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 class=kb_title>打包次数</h4></div><div class=panel-body><div style=\"font-size: 45px;font-weight: bold;text-align: center;height: 115px\"><span>{{ciCount}}</span></div></div></div></div><div class=\"col-lg-3 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 class=kb_title>测试环境发布</h4></div><div class=panel-body><div style=\"font-size: 45px;font-weight: bold;text-align: center;height: 115px\"><span>{{testCount}}</span></div></div></div></div><div class=\"col-lg-3 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">发版次数</h4></div><div class=panel-body><div style=\"font-size: 45px;font-weight: bold;text-align: center;height: 115px\"><span>{{deployCount}}</span></div></div></div></div><div class=\"col-lg-3 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">回滚次数</h4></div><div class=panel-body><div style=\"font-size: 45px;font-weight: bold;text-align: center;height: 115px\"><span>{{rollbackCount}}</span></div></div></div></div><div class=\"col-lg-12 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">标签</h4></div><div class=panel-body style=\"margin-top: 20px\"><a ng-if=flowreport.updatetime>数据最近更新时间:{{flowreport.updatetime}}</a><div class=row><label class=\"col-md-1 control-label fwbold\">数据:</label><select id=selecteddataval class=form-control ng-model=choiceData style=\"width: 20%\"><option ng-repeat=\"x in flowreport.datalist\" value={{x}}>{{x}}</option></select></div></div></div></div><div class=\"col-lg-12 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">近期代码行数变化情况</h4></div><div class=panel-body style=\"margin-top: 20px\"><div id=container></div></div></div></div><div class=\"col-lg-12 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">详情</h4></div><div class=panel-body><div class=panel-tabs><table ng-table=flowreport.data_Table class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"ss in $data\" style=\"height: 35px\"><td data-title=\"\'时间\'\">{{ss.time}}</td><td data-title=\"\'类型\'\">{{ss.type}}</td><td data-title=\"\'编号\'\">{{ss.uuid}}</td><td data-title=\"\'服务树编号\'\">{{ss.groupid}}</td><td data-title=\"\'流水线编号\'\">{{ss.projectid}}</td><td data-title=\"\'状态\'\">{{ss.status}}</td><td data-title=\"\'版本\'\">{{ss.version}}</td><td data-title=\"\'发布地址\'\"><a ng-if=\"ss.type==\'ci\'\" target=_blank ng-href={{flowreport.siteaddr}}/#/quickentry/flowlinedetail/{{ss.groupid}}/{{ss.projectid}}>{{flowreport.siteaddr}}/#/quickentry/flowlinedetail/{{ss.groupid}}/{{ss.projectid}}</a> <a ng-if=\"ss.type!=\'ci\'\" target=_blank ng-href={{flowreport.siteaddr}}/#/history/jobxdetail/{{ss.groupid}}/{{ss.uuid}}>{{flowreport.siteaddr}}/#/history/jobxdetail/{{ss.groupid}}/{{ss.uuid}}</a></td></tr></table></div></div></div></div></div>");
$templateCache.put("app/pages/gitreport/gitreport.html","<div class=\"row block\"><div class=\"col-lg-3 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 class=kb_title>用户数</h4></div><div class=panel-body><div style=\"font-size: 45px;font-weight: bold;text-align: center;height: 115px\"><span>{{userCount}}</span></div></div></div></div><div class=\"col-lg-3 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">添加行数</h4></div><div class=panel-body><div style=\"font-size: 45px;font-weight: bold;text-align: center;height: 115px\"><span>{{codeAddCount}}</span></div></div></div></div><div class=\"col-lg-3 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">删除行数</h4></div><div class=panel-body><div style=\"font-size: 45px;font-weight: bold;text-align: center;height: 115px\"><span>{{codeDelCount}}</span></div></div></div></div><div class=\"col-lg-3 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">提交次数</h4></div><div class=panel-body><div style=\"font-size: 45px;font-weight: bold;text-align: center;height: 115px\"><span>{{commitCount}}</span></div></div></div></div><div class=\"col-lg-12 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">标签</h4></div><div class=panel-body style=\"margin-top: 20px\"><a ng-if=gitreport.updatetime>数据最近更新时间:{{gitreport.updatetime}}</a><div class=row><label class=\"col-md-1 control-label fwbold\">数据:</label><select id=selecteddataval class=form-control ng-model=choiceData style=\"width: 20%\"><option ng-repeat=\"x in gitreport.datalist\" value={{x}}>{{x}}</option></select><label class=\"col-md-1 control-label fwbold\">用户:</label><select id=selectednameval class=form-control ng-model=choiceName style=\"width: 20%\"><option value=\"\">全部</option><option ng-repeat=\"x in gitreport.userlist\" value={{x}}>{{x}}</option></select><label class=\"col-md-1 control-label fwbold\">项目:</label><select id=selectedprojectval class=form-control ng-model=choiceProject style=\"width: 20%\"><option value=\"\">全部</option><option ng-repeat=\"x in gitreport.projectlist\" value={{x}}>{{x}}</option></select></div></div></div></div><div class=\"col-lg-12 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">代码行数增删情况</h4></div><div class=panel-body style=\"margin-top: 20px\"><div id=container></div></div></div></div><div class=\"col-lg-6 col-xs-6 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">代码行数增删情况</h4></div><div class=panel-body style=\"margin-top: 20px\"><div id=container4></div></div></div></div><div class=\"col-lg-6 col-xs-6 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">代码行数增删情况</h4></div><div class=panel-body style=\"margin-top: 20px\"><div id=container5></div></div></div></div><div class=\"col-lg-6 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">提交次数(用户)</h4></div><div class=panel-body><div id=container2 style=min-width:400px;height:400px></div></div></div></div><div class=\"col-lg-6 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">提交行数(用户)</h4></div><div class=panel-body><div id=container3 style=min-width:400px;height:400px></div></div></div></div><div class=\"col-lg-6 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">提交次数(项目)</h4></div><div class=panel-body><div id=container6 style=min-width:400px;height:400px></div></div></div></div><div class=\"col-lg-6 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">提交行数(项目)</h4></div><div class=panel-body><div id=container7 style=min-width:400px;height:400px></div></div></div></div><div class=\"col-lg-12 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><h4 style=\"font-weight: bold;color: #337ab7\">详情</h4></div><div class=panel-body><div class=panel-tabs><table ng-table=gitreport.data_Table class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"ss in $data\" style=\"height: 35px\"><td data-title=\"\'提交时间\'\">{{ss.time}}</td><td data-title=\"\'提交编号\'\">{{ss.uuid}}</td><td data-title=\"\'有效提交\'\">{{ss.effective}}</td><td data-title=\"\'提交人\'\">{{ss.user}}</td><td data-title=\"\'添加行数\'\">{{ss.add}}</td><td data-title=\"\'删除行数\'\">{{ss.del}}</td><td data-title=\"\'提交地址\'\"><a target=_blank ng-href={{ss.url}}>{{ss.url}}</a></td></tr></table></div></div></div></div></div>");
$templateCache.put("app/pages/global/global.html","<div class=\"row block\"><div ui-view></div></div>");
$templateCache.put("app/pages/history/history.html","<div class=\"row block\"><div ui-view></div></div>");
$templateCache.put("app/pages/kubernetesmanage/apply.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=kubernetesapply.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>apply</h5></div><div class=panel-body><div class=row><div class=\"col-sm-5 form-group pull-left\"><button class=\"btn btn-warning\" ng-click=\"kubernetesapply.demo(\'deploy_serverside\')\">Deployment例子</button> <button class=\"btn btn-warning\" ng-click=\"kubernetesapply.demo(\'cm\')\">ConfigMap例子</button></div></div><div class=pt20><div><div class=row class=form-group><div class=col-md-12><textarea style=\"min-height: 100px\" class=form-control rows=30 cols=100 ng-model=kubernetesapply.yaml> </textarea></div></div></div></div><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-info\" ng-disabled=myForm.$invalid ng-click=kubernetesapply.assignment()>操作协助</button> <button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetesapply.apply()>提交变更</button></div></div></div></div></div><style>.modal-dialog {width: 60%;}</style>");
$templateCache.put("app/pages/kubernetesmanage/configmap.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=kubernetesconfigmap.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!kubernetesconfigmap.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=kubernetesconfigmap.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>ConfigMap 管理 集群: {{kubernetesconfigmap.clusterinfo.name}}</h5></div><div class=panel-body style=\"margin-top: 2px\"><button class=\"btn btn-info\" uib-tooltip=创建ConfigMap ng-click=\"kubernetesconfigmap.createConfigMap(\'\',\'\')\"><i class=\"fa fa-cubes\" aria-hidden=true>创建ConfigMap</i></button><div class=pt20 style=\"overflow: auto\"><table ng-table=kubernetesconfigmap.nodeTable class=\"table table-scroll table-hover text-left table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td ng-if=!kubernetesconfigmap.namespace data-title=\"\'命名空间\'\" width=80 filter=\"{ NAMESPACE: \'text\'}\" sortable>{{m.NAMESPACE}}</td><td data-title=\"\'名称\'\" width=80 filter=\"{ NAME: \'text\'}\" sortable><i class=\"fa fa-cog fa-2x\" aria-hidden=true ng-if=\"kubernetesconfigmap.clusterinfo.auth===\'X\'\" ng-click=kubernetesconfigmap.createConfigMap(m.NAMESPACE||kubernetesconfigmap.namespace,m.NAME) uib-tooltip=编辑 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-cog fa-2x\" aria-hidden=true ng-if=\"kubernetesconfigmap.clusterinfo.auth!==\'X\'\" style=\"color: #685e5e\" uib-tooltip=无编辑权限 style=\"cursor:pointer;color: #339094\"></i> {{m.NAME}}</td><td data-title=\"\'数据\'\" width=80 filter=\"{ DATA: \'text\'}\" sortable>{{m.DATA}}</td><td data-title=\"\'时间\'\" width=80 filter=\"{ AGE: \'text\'}\" sortable>{{m.AGE}}</td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-search fa-2x\" aria-hidden=true ng-if=\"kubernetesconfigmap.clusterinfo.auth===\'X\'\" ng-click=\"kubernetesconfigmap.describe(\'configmap\',m.NAME,m.NAMESPACE||kubernetesconfigmap.namespace)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-search fa-2x\" aria-hidden=true ng-if=\"kubernetesconfigmap.clusterinfo.auth!==\'X\'\" style=\"color: #685e5e\" uib-tooltip=无查看权限 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-edit fa-2x\" aria-hidden=true ng-if=\"kubernetesconfigmap.clusterinfo.auth===\'X\'\" ng-click=\"kubernetesconfigmap.edityaml(\'configmap\',m.NAME,m.NAMESPACE||kubernetesconfigmap.namespace)\" uib-tooltip=编辑yaml style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-edit fa-2x\" aria-hidden=true ng-if=\"kubernetesconfigmap.clusterinfo.auth!==\'X\'\" style=\"color: #685e5e\" uib-tooltip=无编辑权限 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetesconfigmap.deleteApp(\'configmap\',m.NAME,m.NAMESPACE)\" uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div></div><style>.modal-dialog {width: 60%;}</style>");
$templateCache.put("app/pages/kubernetesmanage/copyProjectByTemplate.html","<div class=modal-header><h4 class=modal-title>创建流水线</h4></div><div class=modal-body><form class=form-horizontal name=addForm role=form><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">模版</label><div class=col-sm-9><select id=selecteddataval class=form-control ng-model=copyProjectByTemplate.templateid><option ng-repeat=\"x in copyProjectByTemplate.templatelist\" value={{x.id}}>{{x.name}}</option></select></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">容器</label><div class=col-sm-9><select id=selecteddataval class=form-control ng-model=copyProjectByTemplate.containerid><option ng-repeat=\"x in copyProjectByTemplate.containerlist\" value={{x.id}}>名称:{{x.name}} 镜像:{{x.image}}</option></select></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">流水线名称</label><div class=col-sm-9><input type=text class=form-control name=adduser placeholder=流水线名 ng-model=projectname required></div></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=addForm.$invalid ng-click=copyProjectByTemplate.add()>创建</button> <button class=\"btn btn-warning\" ng-click=copyProjectByTemplate.cancel()>取消</button></div></div></form></div><hr><div class=modal-header><h4 class=modal-title>关联已有流水线</h4></div><div class=modal-body><form class=form-horizontal name=flowForm role=form><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">流水线名称</label><div class=col-sm-9><select id=selecteddataval class=form-control ng-model=copyProjectByTemplate.flowlineid required><option ng-repeat=\"x in copyProjectByTemplate.flowlinelist\" value={{x.id}}>{{x.name}}</option></select></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">容器</label><div class=col-sm-9><select id=selecteddataval class=form-control ng-model=copyProjectByTemplate.containerid><option ng-repeat=\"x in copyProjectByTemplate.containerlist\" value={{x.id}}>名称:{{x.name}} 镜像:{{x.image}}</option></select></div></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=flowForm.$invalid ng-click=copyProjectByTemplate.connect()>关联</button> <button class=\"btn btn-warning\" ng-click=copyProjectByTemplate.cancel()>取消</button></div></div></form></div>");
$templateCache.put("app/pages/kubernetesmanage/createconfigmap.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=kubernetescreateconfigmap.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!kubernetescreateconfigmap.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=kubernetescreateconfigmap.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>ConfigMap</h5></div><div class=panel-body ng-if=\"editstep===0\"><div class=pt20><table class=textdiff><tr><td><textarea style=\"width: 100%;overflow: auto;word-break: break-all;height: 1000px\" ng-model=kubernetescreateconfigmap.newyaml> </textarea></td></tr></table></div><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreateconfigmap.gotostep1()>下一步</button></div></div></div><div class=panel-body ng-if=\"editstep===1\"><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-info\" ng-disabled=myForm.$invalid ng-click=kubernetescreateconfigmap.gotostep0()>导入YAML</button></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-1 control-label\">名称</label><div class=col-sm-3><input type=text class=form-control name=adduser placeholder=名称 ng-disabled=\"kubernetescreateconfigmap.tasktype===\'apply\'\" ng-model=kubernetescreateconfigmap.editData.metadata.name required></div><label class=\"col-sm-1 control-label\">命名空间</label><div class=col-sm-4><input ng-if=\"kubernetescreateconfigmap.tasktype===\'apply\'\" ng-disabled=1 type=text class=form-control name=adduser placeholder=名称 ng-disabled=\"kubernetescreateconfigmap.tasktype===\'apply\'\" ng-model=kubernetescreateconfigmap.editData.metadata.namespace required><select id=selectednameval class=form-control ng-if=\"kubernetescreateconfigmap.tasktype!==\'apply\'\" ng-model=kubernetescreateconfigmap.editData.metadata.namespace required><option ng-repeat=\"x in kubernetescreateconfigmap.namespaces\" value={{x.NAME}}>{{x.NAME}}</option></select></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-1 control-label\">描述</label><div class=col-sm-8><input type=text class=form-control name=adduser placeholder=描述 ng-model=kubernetescreateconfigmap.editData.metadata.annotations.describe required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-1 control-label\">标签</label><div class=col-sm-1><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateconfigmap.addLabel() uib-tooltip=添加 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-6><table border=0 style=\"width: 800px\"><tr ng-repeat=\"(id, x) in labels\"><td><input type=text class=form-control ng-model=x.K></td><td style=\"width: 20px\">=</td><td><input type=text class=form-control ng-model=x.V></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateconfigmap.delLabel(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><hr><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-1 control-label\">配置项</label><div class=col-sm-1><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateconfigmap.addData() uib-tooltip=添加 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-10><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in kubernetescreateconfigmap.configMapData\"><td><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">名称</label><div class=col-sm-3><input type=text class=form-control placeholder=名称 ng-model=x.key required></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">内容</label><div class=col-sm-11><textarea style=\"min-height: 100px\" class=form-control rows=15 cols=100 ng-model=x.val> </textarea></div></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateconfigmap.delData(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreateconfigmap.gotostep2()>下一步</button></div></div></div><div class=panel-body ng-if=\"editstep===2\"><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreateconfigmap.gotostep1()>返回上一步</button></div></div><div class=pt20><table class=textdiff><tr><td><textarea style=\"width: 100%;overflow: auto;word-break: break-all;height: 1000px\" ng-model=kubernetescreateconfigmap.newyaml ng-change=kubernetescreateconfigmap.diff()> </textarea></td><td><pre style=\"height: 1000px\" id=diffresultstring></pre></td></tr></table></div><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-info\" ng-disabled=myForm.$invalid ng-click=kubernetescreateconfigmap.assignment()>操作协助</button> <button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreateconfigmap.apply()>提交变更</button></div></div></div></div></div><style>.modal-dialog {width: 60%;}</style><script src=assets/js/diff.js></script><link rel=stylesheet href=assets/css/style.css>");
$templateCache.put("app/pages/kubernetesmanage/createdaemonset.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=kubernetescreatedaemonset.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!kubernetescreatedaemonset.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=kubernetescreatedaemonset.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>守护进程集</h5></div><div class=panel-body ng-if=\"editstep===0\"><div class=pt20><table class=textdiff><tr><td><textarea style=\"width: 100%;overflow: auto;word-break: break-all;height: 1000px\" ng-model=kubernetescreatedaemonset.newyaml> </textarea></td></tr></table></div><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreatedaemonset.gotostep1()>下一步</button></div></div></div><div class=panel-body ng-if=\"editstep===1\"><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-info\" ng-disabled=myForm.$invalid ng-click=kubernetescreatedaemonset.gotostep0()>导入YAML</button></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-1 control-label\">名称</label><div class=col-sm-3><input type=text class=form-control name=adduser placeholder=名称 ng-disabled=\"kubernetescreatedaemonset.tasktype===\'apply\'\" ng-model=kubernetescreatedaemonset.editData.metadata.name required></div><label class=\"col-sm-1 control-label\">命名空间</label><div class=col-sm-3><input ng-if=\"kubernetescreatedaemonset.tasktype===\'apply\'\" ng-disabled=1 type=text class=form-control name=adduser placeholder=名称 ng-disabled=\"kubernetescreatedaemonset.tasktype===\'apply\'\" ng-model=kubernetescreatedaemonset.editData.metadata.namespace required><select id=selectednameval class=form-control ng-if=\"kubernetescreatedaemonset.tasktype!==\'apply\'\" ng-model=kubernetescreatedaemonset.editData.metadata.namespace required><option ng-repeat=\"x in kubernetescreatedaemonset.namespaces\" value={{x.NAME}}>{{x.NAME}}</option></select></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-1 control-label\">描述</label><div class=col-sm-7><input type=text class=form-control name=adduser placeholder=描述 ng-model=kubernetescreatedaemonset.editData.metadata.annotations.describe required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-1 control-label\">标签</label><div class=col-sm-7><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.addLabel() uib-tooltip=添加标签 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-7><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in labels\"><td><input type=text class=form-control ng-model=x.K></td><td style=\"width: 20px\">=</td><td><input type=text class=form-control ng-model=x.V></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.delLabel(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-1 control-label\">停止等待时间</label><div class=col-sm-1><input type=number class=form-control name=adduser placeholder=停止等待时间 ng-model=kubernetescreatedaemonset.editData.spec.template.spec.terminationGracePeriodSeconds required></div></div></div><hr><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">添加数据卷</label><div class=col-sm-9><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetescreatedaemonset.addVolume(\'emptyDir\')\" uib-tooltip=添加emptyDir style=\"cursor:pointer;color: #339094\">empty</i> <i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetescreatedaemonset.addVolume(\'hostPath\')\" uib-tooltip=添加hostPath style=\"cursor:pointer;color: #339094\">hostpath</i> <i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetescreatedaemonset.addVolume(\'nfs\')\" uib-tooltip=添加nfs style=\"cursor:pointer;color: #339094\">nfs</i> <i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetescreatedaemonset.addVolume(\'secret\')\" uib-tooltip=添加secret style=\"cursor:pointer;color: #339094\">secret</i> <i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetescreatedaemonset.addVolume(\'configMap\')\" uib-tooltip=添加configMap style=\"cursor:pointer;color: #339094\">configMap</i> <i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetescreatedaemonset.addVolume(\'persistentVolumeClaim\')\" uib-tooltip=添加persistentVolumeClaim style=\"cursor:pointer;color: #339094\">persistentVolumeClaim</i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.cleanVolume() uib-tooltip=清空 style=\"cursor:pointer;color: #f63\">清空</i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-9><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in kubernetescreatedaemonset.editData.spec.template.spec.volumes\"><td><div class=row ng-if=x.emptyDir><div class=\"col-sm-12 form-group\"><label class=\"col-sm-2 control-label\">类型: emptyDir</label><label class=\"col-sm-1 control-label\">名称</label><div class=col-sm-9><input type=text class=form-control placeholder=\"\" ng-model=x.name required></div></div></div><div class=row ng-if=x.hostPath><div class=\"col-sm-12 form-group\"><label class=\"col-sm-2 control-label\">类型: hostPath</label><label class=\"col-sm-1 control-label\">名称</label><div class=col-sm-4><input type=text class=form-control placeholder=\"\" ng-model=x.name required></div><label class=\"col-sm-1 control-label\">path</label><div class=col-sm-4><input type=text class=form-control placeholder=\"\" ng-model=x.hostPath.path required></div></div></div><div class=row ng-if=x.nfs><div class=\"col-sm-12 form-group\"><label class=\"col-sm-2 control-label\">类型: nfs</label><label class=\"col-sm-1 control-label\">名称</label><div class=col-sm-2><input type=text class=form-control placeholder=\"\" ng-model=x.name required></div><label class=\"col-sm-1 control-label\">server</label><div class=col-sm-3><input type=text class=form-control placeholder=\"\" ng-model=x.nfs.server required></div><label class=\"col-sm-1 control-label\">path</label><div class=col-sm-2><input type=text class=form-control placeholder=\"\" ng-model=x.nfs.path required></div></div></div><div class=row ng-if=x.secret><div class=\"col-sm-12 form-group\"><label class=\"col-sm-2 control-label\">类型: secret</label><label class=\"col-sm-1 control-label\">名称</label><div class=col-sm-4><input type=text class=form-control placeholder=\"\" ng-model=x.name required></div><label class=\"col-sm-1 control-label\">secretName</label><div class=col-sm-4><input type=text class=form-control placeholder=\"\" ng-model=x.secret.secretName required></div></div></div><div class=row ng-if=x.persistentVolumeClaim><div class=\"col-sm-12 form-group\"><label class=\"col-sm-4 control-label\">类型: persistentVolumeClaim</label><label class=\"col-sm-1 control-label\">名称</label><div class=col-sm-3><input type=text class=form-control placeholder=\"\" ng-model=x.name required></div><label class=\"col-sm-1 control-label\">claimName</label><div class=col-sm-3><input type=text class=form-control placeholder=\"\" ng-model=x.persistentVolumeClaim.claimName required></div></div></div><div class=row ng-if=x.configMap><div class=\"col-sm-12 form-group\"><label class=\"col-sm-2 control-label\">类型: configMap</label><label class=\"col-sm-1 control-label\">名称</label><div class=col-sm-4><input type=text class=form-control placeholder=\"\" ng-model=x.name required></div><label class=\"col-sm-1 control-label\">configMap</label><div class=col-sm-4><input type=text class=form-control placeholder=\"\" ng-model=x.configMap.name required></div></div></div><div class=row ng-if=\"(!x.emptyDir) && (!x.hostPath) && (!x.nfs) && ( ! x.secret) && ( !x.persistentVolumeClaim ) &&(!x.configMap)\"><div class=\"col-sm-12 form-group\"><label class=\"col-sm-3 control-label\">类型: 未知</label><label class=\"col-sm-9 control-label\">信息: {{x}}</label></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.delVolume(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><hr><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">拉取私有镜像管理</label><div class=col-sm-6><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.addSecret() uib-tooltip=添加凭证 style=\"cursor:pointer;color: #339094\">添加已经凭证</i> <i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.createSecret() uib-tooltip=创建 style=\"cursor:pointer;color: green\">创建</i> <i class=\"fa fa-arrow-circle-down fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.autoGetSecret() uib-tooltip=自动获取Namepspace下所有凭证 style=\"cursor:pointer;color: #4541f4\">导入</i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.cleanSecret() uib-tooltip=清空 style=\"cursor:pointer;color: #f63\">清空</i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-9><table border=0 style=\"width: 450px\"><tr ng-repeat=\"(id, x) in kubernetescreatedaemonset.editData.spec.template.spec.imagePullSecrets\"><td><input type=text class=form-control ng-model=x.name></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.delSecret(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><hr>调度<br><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">节点亲和性调度</label><div class=col-sm-6><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.addNodeAffinity() uib-tooltip=添加目标节点标签 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-9><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in kubernetescreatedaemonset.editData.spec.template.spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms[0].matchExpressions\"><td><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">key</label><div class=col-sm-3><select id=selecteddataval class=form-control ng-model=x.key><option ng-repeat=\"x in kubernetescreatedaemonset.nodelabel.key\" value={{x}}>{{x}}</option></select></div><label class=\"col-sm-1 control-label\">operator</label><div class=col-sm-3><select id=selecteddataval class=form-control ng-model=x.operator><option value=In>In</option><option value=NotIn>NotIn</option><option value=Exists>Exists</option><option value=DoesNotExist>DoesNotExist</option><option value=Gt>Gt</option><option value=Lt>Lt</option></select></div><label class=\"col-sm-1 control-label\">values</label><div class=col-sm-3>{{x.values}}<select id=selecteddataval class=form-control ng-model=x.values multiple><option ng-repeat=\"x in kubernetescreatedaemonset.nodelabel.value[x.key]\" value={{x}}>{{x}}</option></select></div></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.delNodeAffinity(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">POD亲和性调度</label><div class=col-sm-6><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.addPodAffinity() uib-tooltip=添加亲和POD信息 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-9><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in kubernetescreatedaemonset.editData.spec.template.spec.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].labelSelector.matchExpressions\"><td><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">key</label><div class=col-sm-3><select id=selecteddataval class=form-control ng-model=x.key><option ng-repeat=\"x in kubernetescreatedaemonset.nodepodlabel.key\" value={{x}}>{{x}}</option></select></div><label class=\"col-sm-1 control-label\">operator</label><div class=col-sm-3><select id=selecteddataval class=form-control ng-model=x.operator><option value=In>In</option><option value=NotIn>NotIn</option><option value=Exists>Exists</option><option value=DoesNotExist>DoesNotExist</option><option value=Gt>Gt</option><option value=Lt>Lt</option></select></div><label class=\"col-sm-1 control-label\">values</label><div class=col-sm-3>{{x.values}}<select id=selecteddataval class=form-control ng-model=x.values multiple><option ng-repeat=\"x in kubernetescreatedaemonset.nodepodlabel.value[x.key]\" value={{x}}>{{x}}</option></select></div></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.delPodAffinity(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row ng-if=kubernetescreatedaemonset.editData.spec.template.spec.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution[0]><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><label class=\"col-sm-1 control-label\">namespace</label><div class=col-sm-4>{{ kubernetescreatedaemonset.editData.spec.template.spec.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].namespaces }}<select id=selecteddataval class=form-control ng-model=kubernetescreatedaemonset.editData.spec.template.spec.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].namespaces multiple><option ng-repeat=\"x in kubernetescreatedaemonset.namespaces\" value={{x.NAME}}>{{x.NAME}}</option></select></div><label class=\"col-sm-1 control-label\">topologyKey</label><div class=col-sm-3><input type=text class=form-control placeholder=节点标签Key ng-model=kubernetescreatedaemonset.editData.spec.template.spec.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].topologyKey></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">POD反亲和性调度</label><div class=col-sm-6><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.addPodAntiAffinity() uib-tooltip=添加反亲和POD信息 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-9><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in kubernetescreatedaemonset.editData.spec.template.spec.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].labelSelector.matchExpressions\"><td><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">key</label><div class=col-sm-3><select id=selecteddataval class=form-control ng-model=x.key><option ng-repeat=\"x in kubernetescreatedaemonset.nodepodlabel.key\" value={{x}}>{{x}}</option></select></div><label class=\"col-sm-1 control-label\">operator</label><div class=col-sm-3><select id=selecteddataval class=form-control ng-model=x.operator><option value=In>In</option><option value=NotIn>NotIn</option><option value=Exists>Exists</option><option value=DoesNotExist>DoesNotExist</option><option value=Gt>Gt</option><option value=Lt>Lt</option></select></div><label class=\"col-sm-1 control-label\">values</label><div class=col-sm-3>{{x.values}}<select id=selecteddataval class=form-control ng-model=x.values multiple><option ng-repeat=\"x in kubernetescreatedaemonset.nodepodlabel.value[x.key]\" value={{x}}>{{x}}</option></select></div></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.delPodAntiAffinity(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row ng-if=kubernetescreatedaemonset.editData.spec.template.spec.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[0]><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><label class=\"col-sm-1 control-label\">namespace</label><div class=col-sm-4>{{ kubernetescreatedaemonset.editData.spec.template.spec.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].namespaces }}<select id=selecteddataval class=form-control ng-model=kubernetescreatedaemonset.editData.spec.template.spec.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].namespaces multiple><option ng-repeat=\"x in kubernetescreatedaemonset.namespaces\" value={{x.NAME}}>{{x.NAME}}</option></select></div><label class=\"col-sm-1 control-label\">topologyKey</label><div class=col-sm-3><input type=text class=form-control placeholder=节点标签Key ng-model=kubernetescreatedaemonset.editData.spec.template.spec.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].topologyKey></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">容忍</label><div class=col-sm-6><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.addTolerations() uib-tooltip=添加容忍规则 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-9><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in kubernetescreatedaemonset.editData.spec.template.spec.tolerations\"><td><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">key</label><div class=col-sm-2><select id=selecteddataval class=form-control ng-model=x.key><option ng-repeat=\"x in kubernetescreatedaemonset.nodepodlabel.key\" value={{x}}>{{x}}</option></select></div><label class=\"col-sm-1 control-label\">operator</label><div class=col-sm-1><select id=selecteddataval class=form-control ng-model=x.operator><option value=Equal>Equal</option><option value=Exists>Exists</option></select></div><label class=\"col-sm-1 control-label\">value</label><div class=col-sm-2><select id=selecteddataval class=form-control ng-model=x.value><option ng-repeat=\"x in kubernetescreatedaemonset.nodepodlabel.value[x.key]\" value={{x}}>{{x}}</option></select></div><label class=\"col-sm-1 control-label\">effect</label><div class=col-sm-3><select id=selecteddataval class=form-control ng-model=x.effect><option value=NoSchedule>NoExecute(不允许调度，已经调度的资源不受影响)</option><option value=PreferNoSchedule>PreferNoSchedule(尽量不调度)</option><option value=NoExecute>NoExecute（不允许调度）</option></select></div></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.delTolerations(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><hr><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">容器</label><div class=col-sm-6><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.addContainer() uib-tooltip=添加容器 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-10><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in kubernetescreatedaemonset.editData.spec.template.spec.containers\"><td><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">容器名称</label><div class=col-sm-9><input type=text class=form-control placeholder=容器名称 ng-model=x.name required></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">镜像</label><div class=col-sm-9><input type=text class=form-control placeholder=镜像 ng-model=x.image required></div><div class=col-sm-1><button class=\"btn btn-primary\" ng-click=kubernetescreatedaemonset.addImageAddrByTicket(x)>获取仓库地址</button></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">镜像拉取策略</label><div class=col-sm-9><button class=\"btn btn-primary\" ng-disabled=\"x.imagePullPolicy == \'Always\'\" ng-click=\"kubernetescreatedaemonset.switchImagePullPolicy(x, \'Always\')\">Always</button> <button class=\"btn btn-primary\" ng-disabled=\"x.imagePullPolicy == \'IfNotPresent\'\" ng-click=\"kubernetescreatedaemonset.switchImagePullPolicy(x, \'IfNotPresent\')\">IfNotPresent</button> <button class=\"btn btn-primary\" ng-disabled=\"x.imagePullPolicy == \'Never\'\" ng-click=\"kubernetescreatedaemonset.switchImagePullPolicy(x, \'Never\')\">Never</button> <button class=\"btn btn-primary\" ng-disabled=!x.imagePullPolicy ng-click=\"kubernetescreatedaemonset.switchImagePullPolicy(x, \'\')\">清空</button></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-9>若不设置镜像拉取策略，当镜像版本为空或:latest时，使用Always策略，否则使用IfNotPresent策略</div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">CPU限制</label><label class=\"col-sm-1 control-label\">request</label><div class=col-sm-2><input type=text class=form-control placeholder=\"\" ng-model=x.resources.requests.cpu required></div><label class=\"col-sm-1 control-label\">limit</label><div class=col-sm-2><input type=text class=form-control placeholder=\"\" ng-model=x.resources.limits.cpu required></div><label class=\"col-sm-1 control-label\"></label></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">内存限制</label><label class=\"col-sm-1 control-label\">request</label><div class=col-sm-2><input type=text class=form-control placeholder=\"\" ng-model=x.resources.requests.memory required></div><label class=\"col-sm-1 control-label\">limit</label><div class=col-sm-2><input type=text class=form-control placeholder=\"\" ng-model=x.resources.limits.memory required></div><label class=\"col-sm-1 control-label\"></label></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-9>Request用于预分配资源，当集群中的节点没有request所要求的资源数量时，容器会创建失败。Limit用于设置容器使用的最大上限，避免异常情况下节点资源消耗过多。</div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">启动命令</label><div class=col-sm-7>{{x.command||\'无\'}}</div><div class=col-sm-1><a ng-click=\"kubernetescreatedaemonset.editCommandText=1\">编辑</a></div><div class=col-sm-1><a ng-click=kubernetescreatedaemonset.delCommand(x)>清空</a></div></div></div><div class=row ng-if=\"kubernetescreatedaemonset.editCommandText===1\"><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-7><input type=text class=form-control name=adduser placeholder=启动命令 ng-model=x.tempcommandstring></div><div class=col-sm-1><a ng-click=\"kubernetescreatedaemonset.addCommand(x, x.tempcommandstring)\">添加</a></div><div class=col-sm-1><a ng-click=\"kubernetescreatedaemonset.editCommandText=0\">关闭</a></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">命令参数</label><div class=col-sm-7>{{x.args||\'无\'}}</div><div class=col-sm-1><a ng-click=\"kubernetescreatedaemonset.editArgsText=1\">编辑</a></div><div class=col-sm-1><a ng-click=kubernetescreatedaemonset.delArgs(x)>清空</a></div></div></div><div class=row ng-if=\"kubernetescreatedaemonset.editArgsText===1\"><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-7><input type=text class=form-control name=adduser placeholder=命令参数 ng-model=x.tempargsstring></div><div class=col-sm-1><a ng-click=\"kubernetescreatedaemonset.addArgs(x, x.tempargsstring)\">添加</a></div><div class=col-sm-1><a ng-click=\"kubernetescreatedaemonset.editArgsText=0\">关闭</a></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">环境变量</label><div class=col-sm-9><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.addContainerEnv(x) uib-tooltip=添加普通环境变量 style=\"cursor:pointer;color: #339094\">普通变量</i> <i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.addContainerEnvConfigMap(x) uib-tooltip=添加ConfigMap环境变量 style=\"cursor:pointer;color: #339094\">ConfigMap变量</i> <i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.addContainerEnvSecret(x) uib-tooltip=添加Secret环境变量 style=\"cursor:pointer;color: #339094\">Secret变量</i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.cleanContainerEnv(x) uib-tooltip=清空环境变量 style=\"cursor:pointer;color: #f63\">清空</i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-11><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, xx) in x.env\"><td><div class=row ng-if=\"( xx.value === undefined ) && (!xx.valueFrom.configMapKeyRef) && ( ! xx.valueFrom.secretKeyRef)\"><div class=\"col-sm-12 form-group\"><label class=\"col-sm-12 control-label\">未知变量类型：{{xx}}</label></div></div><div class=row ng-if=\"xx.value !== undefined\"><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">普通变量</label><label class=\"col-sm-1 control-label\">name</label><div class=col-sm-4><input type=text class=form-control placeholder=\"\" ng-model=xx.name required></div><label class=\"col-sm-1 control-label\">value</label><div class=col-sm-5><input type=text class=form-control placeholder=\"\" ng-model=xx.value required></div></div></div><div class=row ng-if=xx.valueFrom.configMapKeyRef><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">ConfigMap变量</label><label class=\"col-sm-1 control-label\">name</label><div class=col-sm-2><input type=text class=form-control placeholder=\"\" ng-model=xx.name required></div><label class=\"col-sm-1 control-label\">ConfigMapName</label><div class=col-sm-3><input type=text class=form-control placeholder=\"\" ng-model=xx.valueFrom.configMapKeyRef.name required></div><label class=\"col-sm-1 control-label\">ConfigMapKey</label><div class=col-sm-3><input type=text class=form-control placeholder=\"\" ng-model=xx.valueFrom.configMapKeyRef.key required></div></div></div><div class=row ng-if=xx.valueFrom.secretKeyRef><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">secret变量</label><label class=\"col-sm-1 control-label\">name</label><div class=col-sm-2><input type=text class=form-control placeholder=\"\" ng-model=xx.name required></div><label class=\"col-sm-1 control-label\">SecretName</label><div class=col-sm-3><input type=text class=form-control placeholder=\"\" ng-model=xx.valueFrom.secretKeyRef.name required></div><label class=\"col-sm-1 control-label\">SecretKey</label><div class=col-sm-3><input type=text class=form-control placeholder=\"\" ng-model=xx.valueFrom.secretKeyRef.key required></div></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.delContainerEnv(x,id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">端口设置</label><div class=col-sm-9><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetescreatedaemonset.addContainerPorts(x,\'TCP\')\" uib-tooltip=添加TCP端口 style=\"cursor:pointer;color: #339094\">TCP</i> <i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetescreatedaemonset.addContainerPorts(x,\'UDP\')\" uib-tooltip=添加UDP端口 style=\"cursor:pointer;color: #339094\">UDP</i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.cleanContainerPorts(x) uib-tooltip=清空 style=\"cursor:pointer;color: #f63\">清空</i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-7><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, xx) in x.ports\"><td><div ng-if=\"!( xx.protocol ===\'TCP\' || xx.protocol ===\'UDP\' )\">未知类型:{{xx}}</div><div class=row ng-if=\"xx.protocol ===\'TCP\' || xx.protocol ===\'UDP\' \"><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">{{xx.protocol}}</label><label class=\"col-sm-1 control-label\">name</label><div class=col-sm-4><input type=text class=form-control placeholder=\"\" ng-model=xx.name required></div><label class=\"col-sm-1 control-label\">端口</label><div class=col-sm-5><input type=number class=form-control placeholder=\"\" ng-model=xx.containerPort required></div></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.delContainerEnv(x,id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">卷挂载点</label><div class=col-sm-9><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.addContainerVolume(x) uib-tooltip=添加挂载点 style=\"cursor:pointer;color: #339094\">目录</i> <i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.addContainerVolumeFile(x) uib-tooltip=添加挂载点 style=\"cursor:pointer;color: #339094\">单个文件</i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.cleanContainerVolume(x) uib-tooltip=清空 style=\"cursor:pointer;color: #f63\">清空</i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-11><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, xx) in x.volumeMounts\"><td><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">name</label><div class=col-sm-2><select id=selecteddataval class=form-control ng-model=xx.name><option ng-repeat=\"x in kubernetescreatedaemonset.editData.spec.template.spec.volumes\" value={{x.name}}>{{x.name}}</option></select></div><label class=\"col-sm-1 control-label\">mountPath</label><div class=col-sm-3><input type=text class=form-control placeholder=挂载文件时写文件路径 ng-model=xx.mountPath required></div><label ng-if=\"!(xx.subPath === undefined)\" class=\"col-sm-1 control-label\">subPath</label><div ng-if=\"!(xx.subPath === undefined)\" class=col-sm-3><input type=text class=form-control placeholder=\"\" ng-model=xx.subPath required></div></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.delContainerVolume(x,id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">应用存活探针</label><div class=col-sm-9><button class=\"btn btn-primary\" ng-disabled=x.livenessProbe.exec ng-click=kubernetescreatedaemonset.addContainerlivenessProbeCmd(x)>命令行方式</button> <button class=\"btn btn-primary\" ng-disabled=x.livenessProbe.httpGet ng-click=kubernetescreatedaemonset.addContainerlivenessProbeHttp(x)>HTTP请求方式</button> <button class=\"btn btn-primary\" ng-disabled=x.livenessProbe.tcpSocket ng-click=kubernetescreatedaemonset.addContainerlivenessProbePort(x)>TCP请求方式</button> <button class=\"btn btn-primary\" ng-disabled=!x.livenessProbe ng-click=kubernetescreatedaemonset.cleanContainerlivenessProbe(x)>清空</button></div></div></div><div class=row ng-if=x.livenessProbe><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><label class=\"col-sm-1 control-label\">首次探测时间/秒</label><div class=col-sm-2><input type=number class=form-control placeholder=\"\" ng-model=x.livenessProbe.initialDelaySeconds required></div><label class=\"col-sm-1 control-label\">探测间隔时间/秒</label><div class=col-sm-2><input type=number class=form-control placeholder=\"\" ng-model=x.livenessProbe.periodSeconds required></div><label class=\"col-sm-1 control-label\">探测超时时间/秒</label><div class=col-sm-2><input type=number class=form-control placeholder=\"\" ng-model=x.livenessProbe.timeoutSeconds required></div></div></div><div class=row ng-if=x.livenessProbe.exec><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><label class=\"col-sm-1 control-label\">命令行</label><label class=\"col-sm-8 control-label\">{{x.livenessProbe.exec.command}}</label></div></div><div class=row ng-if=x.livenessProbe.httpGet><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><label class=\"col-sm-1 control-label\">端口</label><div class=col-sm-2><input type=number class=form-control placeholder=\"\" ng-model=x.livenessProbe.httpGet.port required></div><label class=\"col-sm-1 control-label\">路径</label><div class=col-sm-5><input type=text class=form-control placeholder=\"\" ng-model=x.livenessProbe.httpGet.path required></div></div></div><div class=row ng-if=x.livenessProbe.tcpSocket><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><label class=\"col-sm-1 control-label\">端口</label><div class=col-sm-2><input type=number class=form-control placeholder=\"\" ng-model=x.livenessProbe.tcpSocket.port required></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">应用就绪探针</label><div class=col-sm-9><button class=\"btn btn-primary\" ng-disabled=x.readinessProbe.exec ng-click=kubernetescreatedaemonset.addContainerreadinessProbeCmd(x)>命令行方式</button> <button class=\"btn btn-primary\" ng-disabled=x.readinessProbe.httpGet ng-click=kubernetescreatedaemonset.addContainerreadinessProbeHttp(x)>HTTP请求方式</button> <button class=\"btn btn-primary\" ng-disabled=x.readinessProbe.tcpSocket ng-click=kubernetescreatedaemonset.addContainerreadinessProbePort(x)>TCP请求方式</button> <button class=\"btn btn-primary\" ng-disabled=!x.readinessProbe ng-click=kubernetescreatedaemonset.cleanContainerreadinessProbe(x)>清空</button></div></div></div><div class=row ng-if=x.readinessProbe><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><label class=\"col-sm-1 control-label\">首次探测时间/秒</label><div class=col-sm-2><input type=number class=form-control placeholder=\"\" ng-model=x.readinessProbe.initialDelaySeconds required></div><label class=\"col-sm-1 control-label\">探测间隔时间/秒</label><div class=col-sm-2><input type=number class=form-control placeholder=\"\" ng-model=x.readinessProbe.periodSeconds required></div><label class=\"col-sm-1 control-label\">探测超时时间/秒</label><div class=col-sm-2><input type=number class=form-control placeholder=\"\" ng-model=x.readinessProbe.timeoutSeconds required></div></div></div><div class=row ng-if=x.readinessProbe.exec><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><label class=\"col-sm-1 control-label\">命令行</label><label class=\"col-sm-8 control-label\">{{x.readinessProbe.exec.command}}</label></div></div><div class=row ng-if=x.readinessProbe.httpGet><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><label class=\"col-sm-1 control-label\">端口</label><div class=col-sm-2><input type=number class=form-control placeholder=\"\" ng-model=x.readinessProbe.httpGet.port required></div><label class=\"col-sm-1 control-label\">路径</label><div class=col-sm-5><input type=text class=form-control placeholder=\"\" ng-model=x.readinessProbe.httpGet.path required></div></div></div><div class=row ng-if=x.readinessProbe.tcpSocket><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><label class=\"col-sm-1 control-label\">端口</label><div class=col-sm-2><input type=number class=form-control placeholder=\"\" ng-model=x.readinessProbe.tcpSocket.port required></div></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedaemonset.delContainer(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreatedaemonset.gotostep2()>下一步</button></div></div></div><div class=panel-body ng-if=\"editstep===2\"><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreatedaemonset.gotostep1()>返回上一步</button></div></div><div class=pt20><table class=textdiff><tr><td><textarea style=\"width: 100%;overflow: auto;word-break: break-all;height: 1000px\" ng-model=kubernetescreatedaemonset.newyaml ng-change=kubernetescreatedaemonset.diff()> </textarea></td><td><pre style=\"height: 1000px\" id=diffresultstring></pre></td></tr></table></div><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-info\" ng-disabled=myForm.$invalid ng-click=kubernetescreatedaemonset.assignment()>操作协助</button> <button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreatedaemonset.apply()>提交变更</button></div></div></div></div></div><style>.modal-dialog {width: 90%;}</style><script src=assets/js/diff.js></script><link rel=stylesheet href=assets/css/style.css>");
$templateCache.put("app/pages/kubernetesmanage/createdeployment.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=kubernetescreatedeployment.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!kubernetescreatedeployment.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=kubernetescreatedeployment.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>无状态应用</h5></div><div class=panel-body ng-if=\"editstep===0\"><div class=pt20><table class=textdiff><tr><td><textarea style=\"width: 100%;overflow: auto;word-break: break-all;height: 1000px\" ng-model=kubernetescreatedeployment.newyaml> </textarea></td></tr></table></div><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreatedeployment.gotostep1()>下一步</button></div></div></div><div class=panel-body ng-if=\"editstep===1\"><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-info\" ng-disabled=myForm.$invalid ng-click=kubernetescreatedeployment.gotostep0()>导入YAML</button></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">名称</label><div class=col-sm-3><input type=text class=form-control name=adduser placeholder=名称 ng-disabled=\"kubernetescreatedeployment.tasktype===\'apply\'\" ng-model=kubernetescreatedeployment.editData.metadata.name required></div><label class=\"col-sm-1 control-label\">命名空间</label><div class=col-sm-3><input ng-if=\"kubernetescreatedeployment.namespace!==\'\'\" ng-disabled=1 type=text class=form-control name=adduser placeholder=名称 ng-disabled=\"kubernetescreatedeployment.tasktype===\'apply\'\" ng-model=kubernetescreatedeployment.editData.metadata.namespace required><select id=selectednameval class=form-control ng-if=\"kubernetescreatedeployment.namespace===\'\'\" ng-model=kubernetescreatedeployment.editData.metadata.namespace required><option ng-repeat=\"x in kubernetescreatedeployment.namespaces\" value={{x.NAME}}>{{x.NAME}}</option></select></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">描述</label><div class=col-sm-7><input type=text class=form-control name=adduser placeholder=描述 ng-model=kubernetescreatedeployment.editData.metadata.annotations.describe required></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">标签</label><div class=col-sm-1><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.addLabel() uib-tooltip=添加标签 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-7><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in labels\"><td><input type=text class=form-control ng-model=x.K></td><td style=\"width: 20px\">=</td><td><input type=text class=form-control ng-model=x.V></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.delLabel(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">停止等待时间</label><div class=col-sm-3><input type=number class=form-control name=adduser placeholder=停止等待时间 ng-model=kubernetescreatedeployment.editData.spec.template.spec.terminationGracePeriodSeconds required></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">副本数量</label><div class=col-sm-3><input type=number class=form-control name=adduser placeholder=副本数量 ng-model=kubernetescreatedeployment.editData.spec.replicas required></div></div></div><hr>滚动升级策略<div class=row><div class=\"col-sm-12 form-group pull-left\"><button class=\"btn btn-primary\" ng-disabled=\"kubernetescreatedeployment.editData.spec.strategy.type == \'RollingUpdate\'\" ng-click=\"kubernetescreatedeployment.switchStrategy(\'RollingUpdate\')\">RollingUpdate</button> <button class=\"btn btn-primary\" ng-disabled=\"kubernetescreatedeployment.editData.spec.strategy.type == \'Recreate\'\" ng-click=\"kubernetescreatedeployment.switchStrategy(\'Recreate\')\">Recreate</button></div></div><div class=row ng-if=\"kubernetescreatedeployment.editData.spec.strategy.type == \'RollingUpdate\'\"><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">MaxUnavailable</label><div class=col-sm-3><input type=text class=form-control name=adduser placeholder=MaxUnavailable ng-model=kubernetescreatedeployment.editData.spec.strategy.rollingUpdate.maxUnavailable required></div><label class=\"col-sm-1 control-label\">MaxSurge</label><div class=col-sm-3><input type=text class=form-control name=adduser placeholder=MaxUnavailable ng-model=kubernetescreatedeployment.editData.spec.strategy.rollingUpdate.maxSurge required></div></div></div><hr><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">添加数据卷</label><div class=col-sm-9><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetescreatedeployment.addVolume(\'emptyDir\')\" uib-tooltip=添加emptyDir style=\"cursor:pointer;color: #339094\">empty</i> <i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetescreatedeployment.addVolume(\'hostPath\')\" uib-tooltip=添加hostPath style=\"cursor:pointer;color: #339094\">hostpath</i> <i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetescreatedeployment.addVolume(\'nfs\')\" uib-tooltip=添加nfs style=\"cursor:pointer;color: #339094\">nfs</i> <i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetescreatedeployment.addVolume(\'secret\')\" uib-tooltip=添加secret style=\"cursor:pointer;color: #339094\">secret</i> <i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetescreatedeployment.addVolume(\'configMap\')\" uib-tooltip=添加configMap style=\"cursor:pointer;color: #339094\">configMap</i> <i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetescreatedeployment.addVolume(\'persistentVolumeClaim\')\" uib-tooltip=添加persistentVolumeClaim style=\"cursor:pointer;color: #339094\">persistentVolumeClaim</i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.cleanVolume() uib-tooltip=清空 style=\"cursor:pointer;color: #f63\">清空</i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-9><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in kubernetescreatedeployment.editData.spec.template.spec.volumes\"><td><div class=row ng-if=x.emptyDir><div class=\"col-sm-12 form-group\"><label class=\"col-sm-2 control-label\">类型: emptyDir</label><label class=\"col-sm-1 control-label\">名称</label><div class=col-sm-9><input type=text class=form-control placeholder=\"\" ng-model=x.name required></div></div></div><div class=row ng-if=x.hostPath><div class=\"col-sm-12 form-group\"><label class=\"col-sm-2 control-label\">类型: hostPath</label><label class=\"col-sm-1 control-label\">名称</label><div class=col-sm-4><input type=text class=form-control placeholder=\"\" ng-model=x.name required></div><label class=\"col-sm-1 control-label\">path</label><div class=col-sm-4><input type=text class=form-control placeholder=\"\" ng-model=x.hostPath.path required></div></div></div><div class=row ng-if=x.nfs><div class=\"col-sm-12 form-group\"><label class=\"col-sm-2 control-label\">类型: nfs</label><label class=\"col-sm-1 control-label\">名称</label><div class=col-sm-2><input type=text class=form-control placeholder=\"\" ng-model=x.name required></div><label class=\"col-sm-1 control-label\">server</label><div class=col-sm-3><input type=text class=form-control placeholder=\"\" ng-model=x.nfs.server required></div><label class=\"col-sm-1 control-label\">path</label><div class=col-sm-2><input type=text class=form-control placeholder=\"\" ng-model=x.nfs.path required></div></div></div><div class=row ng-if=x.secret><div class=\"col-sm-12 form-group\"><label class=\"col-sm-2 control-label\">类型: secret</label><label class=\"col-sm-1 control-label\">名称</label><div class=col-sm-4><input type=text class=form-control placeholder=\"\" ng-model=x.name required></div><label class=\"col-sm-1 control-label\">secretName</label><div class=col-sm-4><input type=text class=form-control placeholder=\"\" ng-model=x.secret.secretName required></div></div></div><div class=row ng-if=x.persistentVolumeClaim><div class=\"col-sm-12 form-group\"><label class=\"col-sm-4 control-label\">类型: persistentVolumeClaim</label><label class=\"col-sm-1 control-label\">名称</label><div class=col-sm-3><input type=text class=form-control placeholder=\"\" ng-model=x.name required></div><label class=\"col-sm-1 control-label\">claimName</label><div class=col-sm-3><input type=text class=form-control placeholder=\"\" ng-model=x.persistentVolumeClaim.claimName required></div></div></div><div class=row ng-if=x.configMap><div class=\"col-sm-12 form-group\"><label class=\"col-sm-2 control-label\">类型: configMap</label><label class=\"col-sm-1 control-label\">名称</label><div class=col-sm-4><input type=text class=form-control placeholder=\"\" ng-model=x.name required></div><label class=\"col-sm-1 control-label\">configMap</label><div class=col-sm-4><input type=text class=form-control placeholder=\"\" ng-model=x.configMap.name required></div></div></div><div class=row ng-if=\"(!x.emptyDir) && (!x.hostPath) && (!x.nfs) && ( ! x.secret) && ( !x.persistentVolumeClaim ) &&(!x.configMap)\"><div class=\"col-sm-12 form-group\"><label class=\"col-sm-3 control-label\">类型: 未知</label><label class=\"col-sm-9 control-label\">信息: {{x}}</label></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.delVolume(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><hr><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">拉取私有镜像管理</label><div class=col-sm-6><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.addSecret() uib-tooltip=添加凭证 style=\"cursor:pointer;color: #339094\">添加已经凭证</i> <i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.createSecret() uib-tooltip=创建 style=\"cursor:pointer;color: green\">创建</i> <i class=\"fa fa-arrow-circle-down fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.autoGetSecret() uib-tooltip=自动获取Namepspace下所有凭证 style=\"cursor:pointer;color: #4541f4\">导入</i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.cleanSecret() uib-tooltip=清空 style=\"cursor:pointer;color: #f63\">清空</i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-9><table border=0 style=\"width: 450px\"><tr ng-repeat=\"(id, x) in kubernetescreatedeployment.editData.spec.template.spec.imagePullSecrets\"><td><input type=text class=form-control ng-model=x.name></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.delSecret(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><hr>调度<br><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">节点亲和性调度</label><div class=col-sm-6><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.addNodeAffinity() uib-tooltip=添加目标节点标签 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-9><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in kubernetescreatedeployment.editData.spec.template.spec.affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms[0].matchExpressions\"><td><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">key</label><div class=col-sm-3><select id=selecteddataval class=form-control ng-model=x.key><option ng-repeat=\"x in kubernetescreatedeployment.nodelabel.key\" value={{x}}>{{x}}</option></select></div><label class=\"col-sm-1 control-label\">operator</label><div class=col-sm-3><select id=selecteddataval class=form-control ng-model=x.operator><option value=In>In</option><option value=NotIn>NotIn</option><option value=Exists>Exists</option><option value=DoesNotExist>DoesNotExist</option><option value=Gt>Gt</option><option value=Lt>Lt</option></select></div><label class=\"col-sm-1 control-label\">values</label><div class=col-sm-3>{{x.values}}<select id=selecteddataval class=form-control ng-model=x.values multiple><option ng-repeat=\"x in kubernetescreatedeployment.nodelabel.value[x.key]\" value={{x}}>{{x}}</option></select></div></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.delNodeAffinity(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">POD亲和性调度</label><div class=col-sm-6><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.addPodAffinity() uib-tooltip=添加亲和POD信息 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-9><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in kubernetescreatedeployment.editData.spec.template.spec.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].labelSelector.matchExpressions\"><td><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">key</label><div class=col-sm-3><select id=selecteddataval class=form-control ng-model=x.key><option ng-repeat=\"x in kubernetescreatedeployment.nodepodlabel.key\" value={{x}}>{{x}}</option></select></div><label class=\"col-sm-1 control-label\">operator</label><div class=col-sm-3><select id=selecteddataval class=form-control ng-model=x.operator><option value=In>In</option><option value=NotIn>NotIn</option><option value=Exists>Exists</option><option value=DoesNotExist>DoesNotExist</option><option value=Gt>Gt</option><option value=Lt>Lt</option></select></div><label class=\"col-sm-1 control-label\">values</label><div class=col-sm-3>{{x.values}}<select id=selecteddataval class=form-control ng-model=x.values multiple><option ng-repeat=\"x in kubernetescreatedeployment.nodepodlabel.value[x.key]\" value={{x}}>{{x}}</option></select></div></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.delPodAffinity(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row ng-if=kubernetescreatedeployment.editData.spec.template.spec.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution[0]><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><label class=\"col-sm-1 control-label\">namespace</label><div class=col-sm-4>{{ kubernetescreatedeployment.editData.spec.template.spec.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].namespaces }}<select id=selecteddataval class=form-control ng-model=kubernetescreatedeployment.editData.spec.template.spec.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].namespaces multiple><option ng-repeat=\"x in kubernetescreatedeployment.namespaces\" value={{x.NAME}}>{{x.NAME}}</option></select></div><label class=\"col-sm-1 control-label\">topologyKey</label><div class=col-sm-3><input type=text class=form-control placeholder=节点标签Key ng-model=kubernetescreatedeployment.editData.spec.template.spec.affinity.podAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].topologyKey></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">POD反亲和性调度</label><div class=col-sm-6><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.addPodAntiAffinity() uib-tooltip=添加反亲和POD信息 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-9><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in kubernetescreatedeployment.editData.spec.template.spec.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].labelSelector.matchExpressions\"><td><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">key</label><div class=col-sm-3><select id=selecteddataval class=form-control ng-model=x.key><option ng-repeat=\"x in kubernetescreatedeployment.nodepodlabel.key\" value={{x}}>{{x}}</option></select></div><label class=\"col-sm-1 control-label\">operator</label><div class=col-sm-3><select id=selecteddataval class=form-control ng-model=x.operator><option value=In>In</option><option value=NotIn>NotIn</option><option value=Exists>Exists</option><option value=DoesNotExist>DoesNotExist</option><option value=Gt>Gt</option><option value=Lt>Lt</option></select></div><label class=\"col-sm-1 control-label\">values</label><div class=col-sm-3>{{x.values}}<select id=selecteddataval class=form-control ng-model=x.values multiple><option ng-repeat=\"x in kubernetescreatedeployment.nodepodlabel.value[x.key]\" value={{x}}>{{x}}</option></select></div></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.delPodAntiAffinity(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row ng-if=kubernetescreatedeployment.editData.spec.template.spec.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[0]><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><label class=\"col-sm-1 control-label\">namespace</label><div class=col-sm-4>{{ kubernetescreatedeployment.editData.spec.template.spec.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].namespaces }}<select id=selecteddataval class=form-control ng-model=kubernetescreatedeployment.editData.spec.template.spec.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].namespaces multiple><option ng-repeat=\"x in kubernetescreatedeployment.namespaces\" value={{x.NAME}}>{{x.NAME}}</option></select></div><label class=\"col-sm-1 control-label\">topologyKey</label><div class=col-sm-3><input type=text class=form-control placeholder=节点标签Key ng-model=kubernetescreatedeployment.editData.spec.template.spec.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution[0].topologyKey></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">容忍</label><div class=col-sm-6><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.addTolerations() uib-tooltip=添加容忍规则 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-9><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in kubernetescreatedeployment.editData.spec.template.spec.tolerations\"><td><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">key</label><div class=col-sm-2><select id=selecteddataval class=form-control ng-model=x.key><option ng-repeat=\"x in kubernetescreatedeployment.nodepodlabel.key\" value={{x}}>{{x}}</option></select></div><label class=\"col-sm-1 control-label\">operator</label><div class=col-sm-1><select id=selecteddataval class=form-control ng-model=x.operator><option value=Equal>Equal</option><option value=Exists>Exists</option></select></div><label class=\"col-sm-1 control-label\">value</label><div class=col-sm-2><select id=selecteddataval class=form-control ng-model=x.value><option ng-repeat=\"x in kubernetescreatedeployment.nodepodlabel.value[x.key]\" value={{x}}>{{x}}</option></select></div><label class=\"col-sm-1 control-label\">effect</label><div class=col-sm-3><select id=selecteddataval class=form-control ng-model=x.effect><option value=NoSchedule>NoExecute(不允许调度，已经调度的资源不受影响)</option><option value=PreferNoSchedule>PreferNoSchedule(尽量不调度)</option><option value=NoExecute>NoExecute（不允许调度）</option></select></div></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.delTolerations(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><hr><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">容器</label><div class=col-sm-6><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.addContainer() uib-tooltip=添加容器 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-10><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in kubernetescreatedeployment.editData.spec.template.spec.containers\"><td><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">容器名称</label><div class=col-sm-9><input type=text class=form-control placeholder=容器名称 ng-model=x.name required></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">镜像</label><div class=col-sm-9><input type=text class=form-control placeholder=镜像 ng-model=x.image required></div><div class=col-sm-1><button class=\"btn btn-primary\" ng-click=kubernetescreatedeployment.addImageAddrByTicket(x)>获取仓库地址</button></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">镜像拉取策略</label><div class=col-sm-9><button class=\"btn btn-primary\" ng-disabled=\"x.imagePullPolicy == \'Always\'\" ng-click=\"kubernetescreatedeployment.switchImagePullPolicy(x, \'Always\')\">Always</button> <button class=\"btn btn-primary\" ng-disabled=\"x.imagePullPolicy == \'IfNotPresent\'\" ng-click=\"kubernetescreatedeployment.switchImagePullPolicy(x, \'IfNotPresent\')\">IfNotPresent</button> <button class=\"btn btn-primary\" ng-disabled=\"x.imagePullPolicy == \'Never\'\" ng-click=\"kubernetescreatedeployment.switchImagePullPolicy(x, \'Never\')\">Never</button> <button class=\"btn btn-primary\" ng-disabled=!x.imagePullPolicy ng-click=\"kubernetescreatedeployment.switchImagePullPolicy(x, \'\')\">清空</button></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-9>若不设置镜像拉取策略，当镜像版本为空或:latest时，使用Always策略，否则使用IfNotPresent策略</div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">CPU限制</label><label class=\"col-sm-1 control-label\">request</label><div class=col-sm-2><input type=text class=form-control placeholder=\"\" ng-model=x.resources.requests.cpu required></div><label class=\"col-sm-1 control-label\">limit</label><div class=col-sm-2><input type=text class=form-control placeholder=\"\" ng-model=x.resources.limits.cpu required></div><label class=\"col-sm-1 control-label\"></label></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">内存限制</label><label class=\"col-sm-1 control-label\">request</label><div class=col-sm-2><input type=text class=form-control placeholder=\"\" ng-model=x.resources.requests.memory required></div><label class=\"col-sm-1 control-label\">limit</label><div class=col-sm-2><input type=text class=form-control placeholder=\"\" ng-model=x.resources.limits.memory required></div><label class=\"col-sm-1 control-label\"></label></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-9>Request用于预分配资源，当集群中的节点没有request所要求的资源数量时，容器会创建失败。Limit用于设置容器使用的最大上限，避免异常情况下节点资源消耗过多。</div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">启动命令</label><div class=col-sm-7>{{x.command||\'无\'}}</div><div class=col-sm-1><a ng-click=\"kubernetescreatedeployment.editCommandText=1\">编辑</a></div><div class=col-sm-1><a ng-click=kubernetescreatedeployment.delCommand(x)>清空</a></div></div></div><div class=row ng-if=\"kubernetescreatedeployment.editCommandText===1\"><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-7><input type=text class=form-control name=adduser placeholder=启动命令 ng-model=x.tempcommandstring></div><div class=col-sm-1><a ng-click=\"kubernetescreatedeployment.addCommand(x, x.tempcommandstring)\">添加</a></div><div class=col-sm-1><a ng-click=\"kubernetescreatedeployment.editCommandText=0\">关闭</a></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">命令参数</label><div class=col-sm-7>{{x.args||\'无\'}}</div><div class=col-sm-1><a ng-click=\"kubernetescreatedeployment.editArgsText=1\">编辑</a></div><div class=col-sm-1><a ng-click=kubernetescreatedeployment.delArgs(x)>清空</a></div></div></div><div class=row ng-if=\"kubernetescreatedeployment.editArgsText===1\"><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-7><input type=text class=form-control name=adduser placeholder=命令参数 ng-model=x.tempargsstring></div><div class=col-sm-1><a ng-click=\"kubernetescreatedeployment.addArgs(x, x.tempargsstring)\">添加</a></div><div class=col-sm-1><a ng-click=\"kubernetescreatedeployment.editArgsText=0\">关闭</a></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">环境变量</label><div class=col-sm-9><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.addContainerEnv(x) uib-tooltip=添加普通环境变量 style=\"cursor:pointer;color: #339094\">普通变量</i> <i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.addContainerEnvConfigMap(x) uib-tooltip=添加ConfigMap环境变量 style=\"cursor:pointer;color: #339094\">ConfigMap变量</i> <i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.addContainerEnvSecret(x) uib-tooltip=添加Secret环境变量 style=\"cursor:pointer;color: #339094\">Secret变量</i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.cleanContainerEnv(x) uib-tooltip=清空环境变量 style=\"cursor:pointer;color: #f63\">清空</i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-11><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, xx) in x.env\"><td><div class=row ng-if=\"( xx.value === undefined ) && (!xx.valueFrom.configMapKeyRef) && ( ! xx.valueFrom.secretKeyRef)\"><div class=\"col-sm-12 form-group\"><label class=\"col-sm-12 control-label\">未知变量类型：{{xx}}</label></div></div><div class=row ng-if=\"xx.value !== undefined\"><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">普通变量</label><label class=\"col-sm-1 control-label\">name</label><div class=col-sm-4><input type=text class=form-control placeholder=\"\" ng-model=xx.name required></div><label class=\"col-sm-1 control-label\">value</label><div class=col-sm-5><input type=text class=form-control placeholder=\"\" ng-model=xx.value required></div></div></div><div class=row ng-if=xx.valueFrom.configMapKeyRef><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">ConfigMap变量</label><label class=\"col-sm-1 control-label\">name</label><div class=col-sm-2><input type=text class=form-control placeholder=\"\" ng-model=xx.name required></div><label class=\"col-sm-1 control-label\">ConfigMapName</label><div class=col-sm-3><input type=text class=form-control placeholder=\"\" ng-model=xx.valueFrom.configMapKeyRef.name required></div><label class=\"col-sm-1 control-label\">ConfigMapKey</label><div class=col-sm-3><input type=text class=form-control placeholder=\"\" ng-model=xx.valueFrom.configMapKeyRef.key required></div></div></div><div class=row ng-if=xx.valueFrom.secretKeyRef><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">secret变量</label><label class=\"col-sm-1 control-label\">name</label><div class=col-sm-2><input type=text class=form-control placeholder=\"\" ng-model=xx.name required></div><label class=\"col-sm-1 control-label\">SecretName</label><div class=col-sm-3><input type=text class=form-control placeholder=\"\" ng-model=xx.valueFrom.secretKeyRef.name required></div><label class=\"col-sm-1 control-label\">SecretKey</label><div class=col-sm-3><input type=text class=form-control placeholder=\"\" ng-model=xx.valueFrom.secretKeyRef.key required></div></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.delContainerEnv(x,id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">端口设置</label><div class=col-sm-9><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetescreatedeployment.addContainerPorts(x,\'TCP\')\" uib-tooltip=添加TCP端口 style=\"cursor:pointer;color: #339094\">TCP</i> <i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetescreatedeployment.addContainerPorts(x,\'UDP\')\" uib-tooltip=添加UDP端口 style=\"cursor:pointer;color: #339094\">UDP</i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.cleanContainerPorts(x) uib-tooltip=清空 style=\"cursor:pointer;color: #f63\">清空</i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-7><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, xx) in x.ports\"><td><div ng-if=\"!( xx.protocol ===\'TCP\' || xx.protocol ===\'UDP\' )\">未知类型:{{xx}}</div><div class=row ng-if=\"xx.protocol ===\'TCP\' || xx.protocol ===\'UDP\' \"><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">{{xx.protocol}}</label><label class=\"col-sm-1 control-label\">name</label><div class=col-sm-4><input type=text class=form-control placeholder=\"\" ng-model=xx.name required></div><label class=\"col-sm-1 control-label\">端口</label><div class=col-sm-5><input type=number class=form-control placeholder=\"\" ng-model=xx.containerPort required></div></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.delContainerEnv(x,id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">卷挂载点</label><div class=col-sm-9><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.addContainerVolume(x) uib-tooltip=添加挂载点 style=\"cursor:pointer;color: #339094\">目录</i> <i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.addContainerVolumeFile(x) uib-tooltip=添加挂载点 style=\"cursor:pointer;color: #339094\">单个文件</i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.cleanContainerVolume(x) uib-tooltip=清空 style=\"cursor:pointer;color: #f63\">清空</i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-11><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, xx) in x.volumeMounts\"><td><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">name</label><div class=col-sm-2><select id=selecteddataval class=form-control ng-model=xx.name><option ng-repeat=\"x in kubernetescreatedeployment.editData.spec.template.spec.volumes\" value={{x.name}}>{{x.name}}</option></select></div><label class=\"col-sm-1 control-label\">mountPath</label><div class=col-sm-3><input type=text class=form-control placeholder=挂载文件时写文件路径 ng-model=xx.mountPath required></div><label ng-if=\"!(xx.subPath === undefined)\" class=\"col-sm-1 control-label\">subPath</label><div ng-if=\"!(xx.subPath === undefined)\" class=col-sm-3><input type=text class=form-control placeholder=\"\" ng-model=xx.subPath required></div></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.delContainerVolume(x,id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">应用存活探针</label><div class=col-sm-9><button class=\"btn btn-primary\" ng-disabled=x.livenessProbe.exec ng-click=kubernetescreatedeployment.addContainerlivenessProbeCmd(x)>命令行方式</button> <button class=\"btn btn-primary\" ng-disabled=x.livenessProbe.httpGet ng-click=kubernetescreatedeployment.addContainerlivenessProbeHttp(x)>HTTP请求方式</button> <button class=\"btn btn-primary\" ng-disabled=x.livenessProbe.tcpSocket ng-click=kubernetescreatedeployment.addContainerlivenessProbePort(x)>TCP请求方式</button> <button class=\"btn btn-primary\" ng-disabled=!x.livenessProbe ng-click=kubernetescreatedeployment.cleanContainerlivenessProbe(x)>清空</button></div></div></div><div class=row ng-if=x.livenessProbe><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><label class=\"col-sm-1 control-label\">首次探测时间/秒</label><div class=col-sm-2><input type=number class=form-control placeholder=\"\" ng-model=x.livenessProbe.initialDelaySeconds required></div><label class=\"col-sm-1 control-label\">探测间隔时间/秒</label><div class=col-sm-2><input type=number class=form-control placeholder=\"\" ng-model=x.livenessProbe.periodSeconds required></div><label class=\"col-sm-1 control-label\">探测超时时间/秒</label><div class=col-sm-2><input type=number class=form-control placeholder=\"\" ng-model=x.livenessProbe.timeoutSeconds required></div></div></div><div class=row ng-if=x.livenessProbe.exec><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><label class=\"col-sm-1 control-label\">命令行</label><label class=\"col-sm-8 control-label\">{{x.livenessProbe.exec.command}}</label></div></div><div class=row ng-if=x.livenessProbe.httpGet><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><label class=\"col-sm-1 control-label\">端口</label><div class=col-sm-2><input type=number class=form-control placeholder=\"\" ng-model=x.livenessProbe.httpGet.port required></div><label class=\"col-sm-1 control-label\">路径</label><div class=col-sm-5><input type=text class=form-control placeholder=\"\" ng-model=x.livenessProbe.httpGet.path required></div></div></div><div class=row ng-if=x.livenessProbe.tcpSocket><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><label class=\"col-sm-1 control-label\">端口</label><div class=col-sm-2><input type=number class=form-control placeholder=\"\" ng-model=x.livenessProbe.tcpSocket.port required></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">应用就绪探针</label><div class=col-sm-9><button class=\"btn btn-primary\" ng-disabled=x.readinessProbe.exec ng-click=kubernetescreatedeployment.addContainerreadinessProbeCmd(x)>命令行方式</button> <button class=\"btn btn-primary\" ng-disabled=x.readinessProbe.httpGet ng-click=kubernetescreatedeployment.addContainerreadinessProbeHttp(x)>HTTP请求方式</button> <button class=\"btn btn-primary\" ng-disabled=x.readinessProbe.tcpSocket ng-click=kubernetescreatedeployment.addContainerreadinessProbePort(x)>TCP请求方式</button> <button class=\"btn btn-primary\" ng-disabled=!x.readinessProbe ng-click=kubernetescreatedeployment.cleanContainerreadinessProbe(x)>清空</button></div></div></div><div class=row ng-if=x.readinessProbe><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><label class=\"col-sm-1 control-label\">首次探测时间/秒</label><div class=col-sm-2><input type=number class=form-control placeholder=\"\" ng-model=x.readinessProbe.initialDelaySeconds required></div><label class=\"col-sm-1 control-label\">探测间隔时间/秒</label><div class=col-sm-2><input type=number class=form-control placeholder=\"\" ng-model=x.readinessProbe.periodSeconds required></div><label class=\"col-sm-1 control-label\">探测超时时间/秒</label><div class=col-sm-2><input type=number class=form-control placeholder=\"\" ng-model=x.readinessProbe.timeoutSeconds required></div></div></div><div class=row ng-if=x.readinessProbe.exec><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><label class=\"col-sm-1 control-label\">命令行</label><label class=\"col-sm-8 control-label\">{{x.readinessProbe.exec.command}}</label></div></div><div class=row ng-if=x.readinessProbe.httpGet><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><label class=\"col-sm-1 control-label\">端口</label><div class=col-sm-2><input type=number class=form-control placeholder=\"\" ng-model=x.readinessProbe.httpGet.port required></div><label class=\"col-sm-1 control-label\">路径</label><div class=col-sm-5><input type=text class=form-control placeholder=\"\" ng-model=x.readinessProbe.httpGet.path required></div></div></div><div class=row ng-if=x.readinessProbe.tcpSocket><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><label class=\"col-sm-1 control-label\">端口</label><div class=col-sm-2><input type=number class=form-control placeholder=\"\" ng-model=x.readinessProbe.tcpSocket.port required></div></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatedeployment.delContainer(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreatedeployment.gotostep2()>下一步</button></div></div></div><div class=panel-body ng-if=\"editstep===2\"><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreatedeployment.gotostep1()>返回上一步</button></div></div><div class=pt20><table class=textdiff><tr><td><textarea style=\"width: 100%;overflow: auto;word-break: break-all;height: 1000px\" ng-model=kubernetescreatedeployment.newyaml ng-change=kubernetescreatedeployment.diff()> </textarea></td><td><pre style=\"height: 1000px\" id=diffresultstring></pre></td></tr></table></div><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-info\" ng-disabled=myForm.$invalid ng-click=kubernetescreatedeployment.assignment()>操作协助</button> <button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreatedeployment.apply()>提交变更</button></div></div></div></div></div><style>.modal-dialog {width: 90%;}</style><script src=assets/js/diff.js></script><link rel=stylesheet href=assets/css/style.css>");
$templateCache.put("app/pages/kubernetesmanage/createhpa.html","<div class=\"row block\"><div class=modal-header><h4 class=modal-title>添加HPA: {{kubernetescreatehpa.type}}/{{kubernetescreatehpa.name}}</h4></div><div class=modal-body><form class=form-horizontal name=myForm role=form><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">CPU阈值</label><div class=col-sm-9><input type=text class=form-control placeholder=CPU百分比 ng-model=kubernetescreatehpa.cpu required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">副本数</label><div class=col-sm-3><input type=text class=form-control placeholder=CPU百分比 ng-model=kubernetescreatehpa.min required></div><label class=\"col-sm-1 control-label\">-</label><div class=col-sm-3><input type=text class=form-control placeholder=CPU百分比 ng-model=kubernetescreatehpa.max required></div></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-info\" ng-disabled=myForm.$invalid ng-click=kubernetescreatehpa.assignment()>操作协助</button> <button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreatehpa.add()>确认添加</button> <button class=\"btn btn-warning\" ng-click=kubernetescreatehpa.cancel()>取消</button></div></div></form></div></div><style>.modal-dialog {width: 30%;}</style>");
$templateCache.put("app/pages/kubernetesmanage/createingress.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=kubernetescreateingress.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!kubernetescreateingress.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=kubernetescreateingress.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>Ingress</h5></div><div class=panel-body ng-if=\"editstep===0\"><div class=pt20><table class=textdiff><tr><td><textarea style=\"width: 100%;overflow: auto;word-break: break-all;height: 1000px\" ng-model=kubernetescreateingress.newyaml> </textarea></td></tr></table></div><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreateingress.gotostep1()>下一步</button></div></div></div><div class=panel-body ng-if=\"editstep===1\"><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-info\" ng-disabled=myForm.$invalid ng-click=kubernetescreateingress.gotostep0()>导入YAML</button></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">名称</label><div class=col-sm-3><input type=text class=form-control name=adduser placeholder=名称 ng-disabled=\"kubernetescreateingress.tasktype===\'apply\'\" ng-model=kubernetescreateingress.editData.metadata.name required></div><label class=\"col-sm-1 control-label\">命名空间</label><div class=col-sm-3><input ng-if=\"kubernetescreateingress.tasktype===\'apply\'\" ng-disabled=1 type=text class=form-control name=adduser placeholder=名称 ng-disabled=\"kubernetescreateingress.tasktype===\'apply\'\" ng-model=kubernetescreateingress.editData.metadata.namespace required><select ng-change=\"kubernetescreateingress.namespacechange( kubernetescreateingress.editData.metadata.namespace )\" id=selectednameval class=form-control ng-if=\"kubernetescreateingress.tasktype!==\'apply\'\" ng-model=kubernetescreateingress.editData.metadata.namespace required><option ng-repeat=\"x in kubernetescreateingress.namespaces\" value={{x.NAME}}>{{x.NAME}}</option></select></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">描述</label><div class=col-sm-9><input type=text class=form-control name=adduser placeholder=描述 ng-model=kubernetescreateingress.editData.metadata.annotations.describe required></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">标签</label><div class=col-sm-1><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateingress.addLabel() uib-tooltip=添加 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-6><table border=0 style=\"width: 800px\"><tr ng-repeat=\"(id, x) in labels\"><td><input type=text class=form-control ng-model=x.K></td><td style=\"width: 20px\">=</td><td><input type=text class=form-control ng-model=x.V></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateingress.delLabel(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">annotations</label><div class=col-sm-1><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateingress.addAnnotations() uib-tooltip=添加 style=\"cursor:pointer;color: #339094\"></i></div><div class=col-sm-1 ng-repeat=\"(id, x) in kubernetescreateingress.ingress_lb_annotations\"><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateingress.addAnnotationsByType(id) uib-tooltip=添加 style=\"cursor:pointer;color: #339094\">{{id}}</i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-9><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in annotations\"><td style=\"width: 350px\"><input type=text class=form-control ng-model=x.K></td><td style=\"width: 20px\">=</td><td><input type=text class=form-control ng-model=x.V></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateingress.delAnnotations(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><hr>apiVersion<div class=row><div class=\"col-sm-12 form-group pull-left\"><button class=\"btn btn-primary\" ng-disabled=\"kubernetescreateingress.editData.apiVersion == \'extensions/v1beta1\'\" ng-click=\"kubernetescreateingress.switchApiVersion(\'extensions/v1beta1\')\">extensions/v1beta1旧版</button> <button class=\"btn btn-primary\" ng-disabled=\"kubernetescreateingress.editData.apiVersion == \'networking.k8s.io/v1\'\" ng-click=\"kubernetescreateingress.switchApiVersion(\'networking.k8s.io/v1\')\">networking.k8s.io/v1新版本</button></div></div><hr><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">规则</label><div class=col-sm-6><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateingress.addRules() uib-tooltip=添加规则 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-2 control-label\"></label><div class=col-sm-8><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in kubernetescreateingress.editData.spec.rules\"><td><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">域名</label><div class=col-sm-5><input type=text class=form-control placeholder=域名 ng-model=x.host required></div><label class=\"col-sm-1 control-label\">HTTPS证书</label><div class=col-sm-5><select id=selectednameval class=form-control ng-model=x.https_tls_temp required><option ng-repeat=\"x in kubernetescreateingress.secrets\" value={{x.NAME}}>{{x.NAME}}</option></select></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">Path</label><div class=col-sm-9><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateingress.addPaths(x) uib-tooltip=添加Path style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-11><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, xx) in x.http.paths\"><td><div class=row ng-if=\"kubernetescreateingress.editData.apiVersion === \'extensions/v1beta1\'\"><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">路径</label><div class=col-sm-2><input type=text class=form-control placeholder=\"\" ng-model=xx.path required></div><label class=\"col-sm-1 control-label\">路径类型</label><div class=col-sm-2><select id=selectednameval class=form-control ng-model=xx.pathType required><option value=ImplementationSpecific>ImplementationSpecific</option><option value=Exact>Exact</option><option value=Prefix>Prefix</option></select></div><label class=\"col-sm-1 control-label\">serviceName</label><div class=col-sm-2><select id=selectednameval class=form-control ng-model=xx.backend.serviceName required><option ng-repeat=\"x in kubernetescreateingress.services\" value={{x.NAME}}>{{x.NAME}}</option></select></div><label class=\"col-sm-1 control-label\">端口</label><div class=col-sm-1><input type=number class=form-control placeholder=\"\" ng-model=xx.backend.servicePort required></div></div></div><div class=row ng-if=\"kubernetescreateingress.editData.apiVersion === \'networking.k8s.io/v1\'\"><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">路径</label><div class=col-sm-2><input type=text class=form-control placeholder=\"\" ng-model=xx.path required></div><label class=\"col-sm-1 control-label\">路径类型</label><div class=col-sm-2><select id=selectednameval class=form-control ng-model=xx.pathType required><option value=ImplementationSpecific>ImplementationSpecific</option><option value=Exact>Exact</option><option value=Prefix>Prefix</option></select></div><label class=\"col-sm-1 control-label\">serviceName</label><div class=col-sm-2><select id=selectednameval class=form-control ng-model=xx.backend.service.name required><option ng-repeat=\"x in kubernetescreateingress.services\" value={{x.NAME}}>{{x.NAME}}</option></select></div><label class=\"col-sm-1 control-label\">端口</label><div class=col-sm-2><input type=number class=form-control placeholder=\"\" ng-model=xx.backend.service.port.number required></div></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateingress.delPaths(x,id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateingress.delRules(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreateingress.gotostep2()>下一步</button></div></div></div><div class=panel-body ng-if=\"editstep===2\"><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreateingress.gotostep1()>返回上一步</button></div></div><div class=pt20><table class=textdiff><tr><td><textarea style=\"width: 100%;overflow: auto;word-break: break-all;height: 1000px\" ng-model=kubernetescreateingress.newyaml ng-change=kubernetescreateingress.diff()> </textarea></td><td><pre style=\"height: 1000px\" id=diffresultstring></pre></td></tr></table></div><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-info\" ng-disabled=myForm.$invalid ng-click=kubernetescreateingress.assignment()>操作协助</button> <button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreateingress.apply()>提交变更</button></div></div></div></div></div><style>.modal-dialog {width: 90%;}</style><script src=assets/js/diff.js></script><link rel=stylesheet href=assets/css/style.css>");
$templateCache.put("app/pages/kubernetesmanage/createnamespace.html","<div class=\"row block\"><div class=modal-header><h4 class=modal-title>创建命名空间</h4></div><div class=modal-body><form class=form-horizontal name=myForm role=form><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">名称</label><div class=col-sm-9><input type=text class=form-control placeholder=命令空间 ng-model=kubernetescreatenamespace.namespace required></div></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-info\" ng-disabled=myForm.$invalid ng-click=kubernetescreatenamespace.assignment()>操作协助</button> <button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreatenamespace.create()>确认添加</button> <button class=\"btn btn-warning\" ng-click=kubernetescreatenamespace.cancel()>取消</button></div></div></form></div></div><style>.modal-dialog {width: 60%;}</style>");
$templateCache.put("app/pages/kubernetesmanage/createsecret.html","<div class=\"row block\"><div class=modal-header><h4 class=modal-title>创建dockerconfigjson</h4></div><div class=modal-body><form class=form-horizontal name=myForm role=form><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-info\" ng-click=kubernetescreatesecret.loadTicketData()>从Harbor凭据中获取信息</button></div></div><div ng-if=kubernetescreatesecret.ticketData class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">凭据</label><div class=col-sm-9><select id=selectednameval class=form-control ng-model=selectedTicketId ng-change=kubernetescreatesecret.setData(selectedTicketId) required><option ng-repeat=\"x in kubernetescreatesecret.tickets\" value={{x.id}}>{{x.name}}</option></select></div></div></div><div ng-if=!kubernetescreatesecret.namespacetemp class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">*命名空间</label><div class=col-sm-9><select id=selectednameval class=form-control ng-model=kubernetescreatesecret.namespace required><option ng-repeat=\"x in kubernetescreatesecret.namespaces\" value={{x.NAME}}>{{x.NAME}}</option></select></div></div></div><div ng-if=kubernetescreatesecret.namespacetemp class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">*命名空间</label><div class=col-sm-9><input type=text ng-disabled=1 class=form-control placeholder=\"\" ng-model=kubernetescreatesecret.namespace required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">*名称</label><div class=col-sm-9><input type=text class=form-control placeholder=名称,必填项，允许小写字母/数字/短横线组成 ng-model=kubernetescreatesecret.name required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">*域名</label><div class=col-sm-9><input type=text class=form-control placeholder=域名,请勿以http或https开头，直接填写域名或IP即可 ng-model=kubernetescreatesecret.server required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">*用户名</label><div class=col-sm-9><input type=text class=form-control placeholder=用户名 ng-model=kubernetescreatesecret.username required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">*密码</label><div class=col-sm-9><input type=text class=form-control placeholder=密码 ng-model=kubernetescreatesecret.password required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">邮箱</label><div class=col-sm-9><input type=text class=form-control placeholder=邮箱 ng-model=kubernetescreatesecret.email></div></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-info\" ng-disabled=myForm.$invalid ng-click=kubernetescreatesecret.assignment()>操作协助</button> <button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreatesecret.deleteapp()>确认添加</button> <button class=\"btn btn-warning\" ng-click=kubernetescreatesecret.cancel()>取消</button></div></div></form></div></div><style>.modal-dialog {width: 60%;}</style>");
$templateCache.put("app/pages/kubernetesmanage/createsecretopaque.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=kubernetescreatesecretopaque.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!kubernetescreatesecretopaque.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=kubernetescreatesecretopaque.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>Secret {{kubernetescreatesecretopaque.type}}</h5></div><div class=panel-body ng-if=\"editstep===0\"><div class=pt20><table class=textdiff><tr><td><textarea style=\"width: 100%;overflow: auto;word-break: break-all;height: 1000px\" ng-model=kubernetescreatesecretopaque.newyaml> </textarea></td></tr></table></div><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreatesecretopaque.gotostep1()>下一步</button></div></div></div><div class=panel-body ng-if=\"editstep===1\"><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-info\" ng-disabled=myForm.$invalid ng-click=kubernetescreatesecretopaque.gotostep0()>导入YAML</button></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">名称</label><div class=col-sm-3><input type=text class=form-control name=adduser placeholder=名称 ng-disabled=\"kubernetescreatesecretopaque.tasktype===\'apply\'\" ng-model=kubernetescreatesecretopaque.editData.metadata.name required></div><label class=\"col-sm-1 control-label\">命名空间</label><div class=col-sm-3><input ng-if=\"kubernetescreatesecretopaque.tasktype===\'apply\'\" ng-disabled=1 type=text class=form-control name=adduser placeholder=名称 ng-disabled=\"kubernetescreatesecretopaque.tasktype===\'apply\'\" ng-model=kubernetescreatesecretopaque.editData.metadata.namespace required><select id=selectednameval class=form-control ng-if=\"kubernetescreatesecretopaque.tasktype!==\'apply\'\" ng-model=kubernetescreatesecretopaque.editData.metadata.namespace required><option ng-repeat=\"x in kubernetescreatesecretopaque.namespaces\" value={{x.NAME}}>{{x.NAME}}</option></select></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">描述</label><div class=col-sm-7><input type=text class=form-control name=adduser placeholder=描述 ng-model=kubernetescreatesecretopaque.editData.metadata.annotations.describe required></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">标签</label><div class=col-sm-6><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatesecretopaque.addLabel() uib-tooltip=添加 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-6><table border=0 style=\"width: 800px\"><tr ng-repeat=\"(id, x) in labels\"><td><input type=text class=form-control ng-model=x.K></td><td style=\"width: 20px\">=</td><td><input type=text class=form-control ng-model=x.V></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatesecretopaque.delLabel(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">annotations</label><div class=col-sm-6><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatesecretopaque.addAnnotations() uib-tooltip=添加 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-6><table border=0 style=\"width: 800px\"><tr ng-repeat=\"(id, x) in annotations\"><td><input type=text class=form-control ng-model=x.K></td><td style=\"width: 20px\">=</td><td><input type=text class=form-control ng-model=x.V></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatesecretopaque.delAnnotations(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><hr><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">数据</label><div class=col-sm-6><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatesecretopaque.addDatabase64() uib-tooltip=添加数据 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-2 control-label\"></label><div class=col-sm-6><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in database64\"><td><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">名称</label><div class=col-sm-3><input type=text class=form-control placeholder=名称 ng-model=x.K required></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">内容</label><div class=col-sm-11><textarea ng-if=\"x.K !== \'namespace\'\" style=\"min-height: 100px\" class=form-control rows=5 cols=100 ng-model=x.V> </textarea><input ng-if=\"x.K === \'namespace\'\" type=text class=form-control placeholder=内容 ng-model=x.V required></div></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreatesecretopaque.delDatabase64(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreatesecretopaque.gotostep2()>下一步</button></div></div></div><div class=panel-body ng-if=\"editstep===2\"><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreatesecretopaque.gotostep1()>返回上一步</button></div></div><div class=pt20><table class=textdiff><tr><td><textarea style=\"width: 100%;overflow: auto;word-break: break-all;height: 1000px\" ng-model=kubernetescreatesecretopaque.newyaml ng-change=kubernetescreatesecretopaque.diff()> </textarea></td><td><pre style=\"height: 1000px\" id=diffresultstring></pre></td></tr></table></div><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-info\" ng-disabled=myForm.$invalid ng-click=kubernetescreatesecretopaque.assignment()>操作协助</button> <button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreatesecretopaque.apply()>提交变更</button></div></div></div></div></div><style>.modal-dialog {width: 90%;}</style><script src=assets/js/diff.js></script><link rel=stylesheet href=assets/css/style.css>");
$templateCache.put("app/pages/kubernetesmanage/createservice.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=kubernetescreateservice.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!kubernetescreateservice.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=kubernetescreateservice.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>Service</h5></div><div class=panel-body ng-if=\"editstep===0\"><div class=pt20><table class=textdiff><tr><td><textarea style=\"width: 100%;overflow: auto;word-break: break-all;height: 1000px\" ng-model=kubernetescreateservice.newyaml> </textarea></td></tr></table></div><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreateservice.gotostep1()>下一步</button></div></div></div><div class=panel-body ng-if=\"editstep===1\"><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-info\" ng-disabled=myForm.$invalid ng-click=kubernetescreateservice.gotostep0()>导入YAML</button></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">名称</label><div class=col-sm-3><input type=text class=form-control name=adduser placeholder=名称 ng-disabled=\"kubernetescreateservice.tasktype===\'apply\'\" ng-model=kubernetescreateservice.editData.metadata.name required></div><label class=\"col-sm-1 control-label\">命名空间</label><div class=col-sm-3><input ng-if=\"kubernetescreateservice.tasktype===\'apply\'\" ng-disabled=1 type=text class=form-control name=adduser placeholder=名称 ng-disabled=\"kubernetescreateservice.tasktype===\'apply\'\" ng-model=kubernetescreateservice.editData.metadata.namespace required><select id=selectednameval class=form-control ng-if=\"kubernetescreateservice.tasktype!==\'apply\'\" ng-model=kubernetescreateservice.editData.metadata.namespace required><option ng-repeat=\"x in kubernetescreateservice.namespaces\" value={{x.NAME}}>{{x.NAME}}</option></select></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">描述</label><div class=col-sm-7><input type=text class=form-control name=adduser placeholder=描述 ng-model=kubernetescreateservice.editData.metadata.annotations.describe required></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">标签</label><div class=col-sm-1><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateservice.addLabel() uib-tooltip=添加 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-7><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in labels\"><td><input type=text class=form-control ng-model=x.K></td><td style=\"width: 20px\">=</td><td><input type=text class=form-control ng-model=x.V></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateservice.delLabel(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">annotations</label><div class=col-sm-1><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateservice.addAnnotations() uib-tooltip=添加 style=\"cursor:pointer;color: #339094\"></i></div><div class=col-sm-1 ng-repeat=\"(id, x) in kubernetescreateservice.service_lb_annotations\"><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateservice.addAnnotationsByType(id) uib-tooltip=添加 style=\"cursor:pointer;color: #339094\">{{id}}</i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-7><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in annotations\"><td><input type=text class=form-control ng-model=x.K></td><td style=\"width: 20px\">=</td><td><input type=text class=form-control ng-model=x.V></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateservice.delAnnotations(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><hr><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">开放端口</label><div class=col-sm-6><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateservice.addPorts() uib-tooltip=添加规则 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-9><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in kubernetescreateservice.editData.spec.ports\"><td><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">名称</label><div class=col-sm-2><input type=text class=form-control placeholder=名称 ng-model=x.name required></div><label class=\"col-sm-1 control-label\">端口</label><div class=col-sm-2><input type=number class=form-control placeholder=端口 ng-model=x.port required></div><label class=\"col-sm-1 control-label\">容器端口</label><div class=col-sm-2><input type=number class=form-control placeholder=端口 ng-model=x.targetPort required></div><label class=\"col-sm-1 control-label\">协议</label><div class=col-sm-2><select id=selectednameval class=form-control ng-model=x.protocol required><option value=TCP>TCP</option><option value=UDP>UDP</option></select></div></div></div></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateservice.delPorts(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><hr><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">selector</label><div class=col-sm-6><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateservice.addSelector() uib-tooltip=添加 style=\"cursor:pointer;color: #339094\"></i></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\"></label><div class=col-sm-7><table border=0 style=\"width: 100%\"><tr ng-repeat=\"(id, x) in selector\"><td><input type=text class=form-control ng-model=x.K></td><td style=\"width: 20px\">=</td><td><input type=text class=form-control ng-model=x.V></td><td style=\"width: 50px\"><i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetescreateservice.delSelector(id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreateservice.gotostep2()>下一步</button></div></div></div><div class=panel-body ng-if=\"editstep===2\"><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreateservice.gotostep1()>返回上一步</button></div></div><div class=pt20><table class=textdiff><tr><td><textarea style=\"width: 100%;overflow: auto;word-break: break-all;height: 1000px\" ng-model=kubernetescreateservice.newyaml ng-change=kubernetescreateservice.diff()> </textarea></td><td><pre style=\"height: 1000px\" id=diffresultstring></pre></td></tr></table></div><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-info\" ng-disabled=myForm.$invalid ng-click=kubernetescreateservice.assignment()>操作协助</button> <button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetescreateservice.apply()>提交变更</button></div></div></div></div></div><style>.modal-dialog {width: 90%;}</style><script src=assets/js/diff.js></script><link rel=stylesheet href=assets/css/style.css>");
$templateCache.put("app/pages/kubernetesmanage/deleteapp.html","<div class=\"row block\"><div class=modal-header><h4 class=modal-title>删除: {{kubernetesdeleteapp.type}}/{{kubernetesdeleteapp.name}}</h4></div><div class=modal-body><form class=form-horizontal name=myForm role=form><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">名称确认</label><div class=col-sm-9><input type=text class=form-control placeholder=输入删除的名称:{{kubernetesdeleteapp.name}} ng-model=kubernetesdeleteapp.deletename required></div></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-info\" ng-disabled=myForm.$invalid ng-click=kubernetesdeleteapp.assignment()>操作协助</button> <button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetesdeleteapp.deleteapp()>确认删除</button> <button class=\"btn btn-warning\" ng-click=kubernetesdeleteapp.cancel()>取消</button></div></div></form></div></div><style>.modal-dialog {width: 30%;}</style>");
$templateCache.put("app/pages/kubernetesmanage/describe.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=kubernetesdescribe.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!kubernetesdescribe.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=kubernetesdescribe.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>describe信息</h5></div><div class=panel-body><div class=pt20><div><div class=row class=form-group><div class=col-md-12><pre style=\"min-height: 100px\" ng-dblclick=\"dataEdit=true\" class=text-left ng-bind-html=kubernetesdescribe.describe></pre></div></div></div></div></div></div></div><style>.modal-dialog {width: 60%;}</style>");
$templateCache.put("app/pages/kubernetesmanage/describedeployment.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=kubernetesdescribedeployment.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!kubernetesdescribedeployment.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=kubernetesdescribedeployment.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>deployment describe 信息</h5></div><div class=panel-body><div class=pt20><div><div class=panel-body style=\"margin-top: 2px\"><div class=pt20 style=\"overflow: auto\"><table ng-table=kubernetesdescribedeployment.newpodTable class=\"table table-scroll table-hover text-left table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td data-title=\"\'新容器\'\" width=80><i class=\"fa fa-television fa-2x\" aria-hidden=true ng-click=\"kubernetesdescribedeployment.openOneTab(m,\'sh\')\" uib-tooltip=进入POD虚拟终端 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-file-text-o fa-2x\" aria-hidden=true ng-click=\"kubernetesdescribedeployment.openOneTab(m,\'log\')\" uib-tooltip=查看POD日志 style=\"cursor:pointer;color: #339094\"></i> {{m.NAME}}</td><td data-title=\"\'READY\'\" width=80>{{m.READY}}</td><td data-title=\"\'STATUS\'\" width=80><a ng-if=\"m.STATUS===\'Running\'\" style=\"color: green\">{{m.STATUS}}</a> <a ng-if=\"m.STATUS!==\'Running\'\" style=\"color: red\">{{m.STATUS}}</a></td><td data-title=\"\'RESTARTS\'\" width=80>{{m.RESTARTS}}</td><td data-title=\"\'AGE\'\" width=80>{{m.AGE}}</td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=\"kubernetesdescribedeployment.describexx(\'pod\',m.NAME)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i></td></tr></table></div></div><div class=panel-body style=\"margin-top: 2px\"><div class=pt20 style=\"overflow: auto\"><table ng-table=kubernetesdescribedeployment.oldpodTable class=\"table table-scroll table-hover text-left table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td data-title=\"\'旧容器\'\" width=80 filter=\"{ NAME: \'text\'}\" sortable><i class=\"fa fa-television fa-2x\" aria-hidden=true ng-click=\"kubernetesdescribedeployment.openOneTab(m,\'sh\')\" uib-tooltip=进入POD虚拟终端 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-file-text-o fa-2x\" aria-hidden=true ng-click=\"kubernetesdescribedeployment.openOneTab(m,\'log\')\" uib-tooltip=查看POD日志 style=\"cursor:pointer;color: #339094\"></i> {{m.NAME}}</td><td data-title=\"\'READY\'\" width=80 filter=\"{ READY: \'text\'}\" sortable>{{m.READY}}</td><td data-title=\"\'STATUS\'\" width=80 filter=\"{ STATUS: \'text\'}\" sortable><a ng-if=\"m.STATUS===\'Running\'\" style=\"color: green\">{{m.STATUS}}</a> <a ng-if=\"m.STATUS!==\'Running\'\" style=\"color: red\">{{m.STATUS}}</a></td><td data-title=\"\'RESTARTS\'\" width=80 filter=\"{ RESTARTS: \'text\'}\" sortable>{{m.RESTARTS}}</td><td data-title=\"\'AGE\'\" width=80 filter=\"{ AGE: \'text\'}\" sortable>{{m.AGE}}</td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=\"kubernetesdescribedeployment.describexx(\'pod\',m.NAME)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i></td></tr></table></div></div><div class=row class=form-group><div class=col-md-12><pre style=\"min-height: 100px\" ng-dblclick=\"dataEdit=true\" class=text-left ng-bind-html=kubernetesdescribedeployment.describe></pre></div></div></div></div></div></div></div><style>.modal-dialog {width: 60%;}</style>");
$templateCache.put("app/pages/kubernetesmanage/describeingress.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=kubernetesdescribeingress.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!kubernetesdescribeingress.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=kubernetesdescribeingress.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>ingress describe 信息</h5></div><div class=panel-body><div class=pt20><div><div class=panel-body style=\"margin-top: 2px\"><div class=pt20 style=\"overflow: auto\"><table ng-table=kubernetesdescribeingress.serviceTable class=\"table table-scroll table-hover text-left table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td data-title=\"\'域名\'\" width=80>{{m.host}}</td><td data-title=\"\'路径\'\" width=80>{{m.path}}</td><td data-title=\"\'路径类型\'\" width=80>{{m.pathType}}</td><td data-title=\"\'service\'\" width=80><i class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=\"kubernetesdescribeingress.describexxservice(\'service\',m.servicename)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i> {{m.servicename}}</td><td data-title=\"\'端口\'\" width=80>{{m.port}}</td></tr></table></div></div><div class=row class=form-group><div class=col-md-12><pre style=\"min-height: 100px\" ng-dblclick=\"dataEdit=true\" class=text-left ng-bind-html=kubernetesdescribeingress.describe></pre></div></div></div></div></div></div></div><style>.modal-dialog {width: 60%;}</style>");
$templateCache.put("app/pages/kubernetesmanage/describeservice.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=kubernetesdescribeservice.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!kubernetesdescribeservice.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=kubernetesdescribeservice.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>service describe 信息</h5></div><div class=panel-body><div class=pt20><div><div class=panel-body style=\"margin-top: 2px\"><div class=pt20 style=\"overflow: auto\"><table ng-table=kubernetesdescribeservice.deploymentTable class=\"table table-scroll table-hover text-left table-condensed\" style=\"white-space: unset\" show-filter=true><tr ng-repeat=\"m in $data\"><td data-title=\"\'Deployment\'\" width=80>{{m.NAME}}</td><td data-title=\"\'READY\'\" width=80>{{m.READY}}</td><td data-title=\"\'UP-TO-DATE\'\" width=80>{{m.UP_TO_DATE}}</td><td data-title=\"\'AVAILABLE\'\" width=80>{{m.AVAILABLE}}</td><td data-title=\"\'AGE\'\" width=80>{{m.AGE}}</td><td data-title=\"\'CONTAINERS\'\" width=80>{{m.CONTAINERS}}</td><td data-title=\"\'IMAGES\'\" width=80>{{m.IMAGES}}</td><td data-title=\"\'SELECTOR\'\" width=80>{{m.SELECTOR}}</td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=\"kubernetesdescribeservice.describexxdeployment(\'deployment\',m.INAME)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i></td></tr></table></div></div><div class=panel-body style=\"margin-top: 2px\"><div class=pt20 style=\"overflow: auto\"><table ng-table=kubernetesdescribeservice.replicasetTable class=\"table table-scroll table-hover text-left table-condensed\" style=\"white-space: unset\" show-filter=true><tr ng-repeat=\"m in $data\"><td data-title=\"\'Replicaset\'\" width=80>{{m.NAME}}</td><td data-title=\"\'DESIRED\'\" width=80>{{m.DESIRED}}</td><td data-title=\"\'CURRENT\'\" width=80>{{m.CURRENT}}</td><td data-title=\"\'READY\'\" width=80>{{m.READY}}</td><td data-title=\"\'AGE\'\" width=80>{{m.AGE}}</td><td data-title=\"\'CONTAINERS\'\" width=80>{{m.CONTAINERS}}</td><td data-title=\"\'IMAGES\'\" width=80>{{m.IMAGES}}</td><td data-title=\"\'SELECTOR\'\" width=80>{{m.SELECTOR}}</td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=\"kubernetesdescribeservice.describexx(\'replicaset\',m.INAME)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i></td></tr></table></div></div><div class=panel-body style=\"margin-top: 2px\"><div class=pt20 style=\"overflow: auto\"><table ng-table=kubernetesdescribeservice.podTable class=\"table table-scroll table-hover text-left table-condensed\" show-filter=true style=\"white-space: unset\"><tr ng-repeat=\"m in $data\"><td data-title=\"\'Pod\'\" width=80><i class=\"fa fa-television fa-2x\" aria-hidden=true ng-click=\"kubernetesdescribeservice.openOneTab(m,\'sh\')\" uib-tooltip=进入POD虚拟终端 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-file-text-o fa-2x\" aria-hidden=true ng-click=\"kubernetesdescribeservice.openOneTab(m,\'log\')\" uib-tooltip=查看POD日志 style=\"cursor:pointer;color: #339094\"></i> {{m.NAME}}</td><td data-title=\"\'READY\'\" width=80>{{m.READY}}</td><td data-title=\"\'STATUS\'\" width=80><a ng-if=\"m.STATUS===\'Running\'\" style=\"color: green\">{{m.STATUS}}</a> <a ng-if=\"m.STATUS!==\'Running\'\" style=\"color: red\">{{m.STATUS}}</a></td><td data-title=\"\'RESTARTS\'\" width=80>{{m.RESTARTS}}</td><td data-title=\"\'AGE\'\" width=80>{{m.AGE}}</td><td data-title=\"\'IP\'\" width=80>{{m.IP}}</td><td data-title=\"\'NODE\'\" width=80>{{m.NODE}}</td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=\"kubernetesdescribeservice.describexx(\'pod\',m.INAME)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i></td></tr></table></div></div><div class=row class=form-group><div class=col-md-12><pre style=\"min-height: 100px\" ng-dblclick=\"dataEdit=true\" class=text-left ng-bind-html=kubernetesdescribeservice.describe></pre></div></div></div></div></div></div></div><style>.modal-dialog {width: 60%;}</style>");
$templateCache.put("app/pages/kubernetesmanage/edityaml.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=kubernetesedityaml.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!kubernetesedityaml.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=kubernetesedityaml.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>编辑YAML</h5></div><div class=panel-body><div class=pt20><table class=textdiff><tr><td><textarea style=\"width: 100%;overflow: auto;word-break: break-all;height: 1000px\" ng-model=kubernetesedityaml.newyaml ng-change=kubernetesedityaml.diff()> </textarea></td><td><pre style=\"height: 1000px\" id=diffresultstring></pre></td></tr></table></div><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-info\" ng-disabled=myForm.$invalid ng-click=kubernetesedityaml.assignment()>操作协助</button> <button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetesedityaml.apply()>提交变更</button> <button class=\"btn btn-warning\" ng-click=kubernetesedityaml.cancel()>关闭</button></div></div></div></div></div><style>.modal-dialog {width: 90%;}</style><script src=assets/js/diff.js></script><link rel=stylesheet href=assets/css/style.css>");
$templateCache.put("app/pages/kubernetesmanage/harborimage.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=kubernetesharborimage.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!kubernetesharborimage.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=kubernetesharborimage.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>Harbor镜像仓库选择</h5></div><div class=panel-body style=\"margin-top: 2px\"><div ng-if=\"kubernetesharborimage.tickethas===\'\'\" class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">凭据</label><div class=col-sm-9><select id=selectednameval class=form-control ng-model=kubernetesharborimage.ticketid ng-change=kubernetesharborimage.reload() required><option ng-repeat=\"x in kubernetesharborimage.tickets\" value={{x.id}}>{{x.name}}</option></select></div></div></div><div ng-if=kubernetesharborimage.nodeTable class=pt20 style=\"overflow: auto\"><table ng-table=kubernetesharborimage.nodeTable class=\"table table-scroll table-hover text-left table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td data-title=\"\'名称\'\" width=80 filter=\"{ repo: \'text\'}\" sortable>{{m.repo}}</td><td data-title=\"\'artifact_count\'\" width=80 filter=\"{ artifact_count: \'text\'}\" sortable>{{m.artifact_count}}</td><td data-title=\"\'pull_count\'\" width=80 filter=\"{ pull_count: \'text\'}\" sortable>{{m.pull_count}}</td><td data-title=\"\'公开仓库\'\" width=80 sortable><a ng-if=\"m.project_public===\'0\' || m.project_public===false\">否</a> <a ng-if=\"!(m.project_public===\'0\' || m.project_public===false)\">是</a></td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-check-circle fa-2x\" aria-hidden=true ng-click=kubernetesharborimage.selectRepo(m.repo) uib-tooltip=选择该仓库 style=\"cursor:pointer;color: #339094\"></i></td></tr></table></div></div></div></div><style>.modal-dialog {width: 60%;}</style>");
$templateCache.put("app/pages/kubernetesmanage/kubernetesmanage.html","<cmloading ng-if=\"(!kubernetesmanage.loadoverA ) || (!kubernetesmanage.loadoverB) || (!kubernetesmanage.loadoverC) || (!kubernetesmanage.loadoverD)\"></cmloading><div class=\"row block\"><div class=\"col-lg-12 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-info\" uib-tooltip=搜索 ng-click=kubernetesmanage.searchingress()><i class=\"fa fa-search fa-fw\"></i>搜索</button> <button class=\"btn btn-info\" uib-tooltip=刷新 ng-click=kubernetesmanage.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':(!kubernetesmanage.loadoverA ) || (!kubernetesmanage.loadoverB) || (!kubernetesmanage.loadoverC)}\"></i>刷新</button></span><h4 style=\"font-weight: bold;color: #337ab7\">集群({{clusterCount||0}})</h4></div><div class=panel-body style=\"margin-top: 20px\"><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">集群</label><div class=col-sm-4><select id=selecteddataval class=form-control ng-model=choiceClusterId><option ng-repeat=\"x in kubernetesmanage.clusterlist\" value={{x.id}}>{{x.name}} 详情: {{x.describe}} 操作权限: {{x.auth}}</option></select></div><div class=col-sm-1><button class=\"btn btn-info\" uib-tooltip=添加集群 ng-click=kubernetesmanage.addCluster()><i class=\"fa fa-plus\" aria-hidden=true>添加</i></button></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">命名空间</label><div class=col-sm-4><select id=selectednameval class=form-control ng-model=choiceNamespace><option value=\"\">全部</option><option ng-repeat=\"x in kubernetesmanage.namespace\" value={{x.NAME}}>{{x.NAME}}</option></select></div><div class=col-sm-1 ng-if=choiceClusterId><button class=\"btn btn-info\" uib-tooltip=添加命名空间 ng-click=kubernetesmanage.addNamespace()><i class=\"fa fa-plus\" aria-hidden=true>添加</i></button></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">状态</label><div class=col-sm-2><select id=selectedprojectval class=form-control ng-model=choiceStat style=\"width: 40%\"><option value=\"\">全部</option><option value=fail>异常</option></select></div></div></div><div ng-if=choiceClusterId class=row><button style=\"float: right;margin-right: 4px\" class=\"btn btn-info\" uib-tooltip=新建应用 ng-click=kubernetesmanage.apply()><i class=\"fa fa-rocket\" aria-hidden=true>创建应用</i></button> <button class=\"btn btn-info\" uib-tooltip=测试能否连接上集群 ng-click=kubernetesmanage.connectiontest()><i class=\"fa fa-cubes\" aria-hidden=true>连接测试</i></button> <button class=\"btn btn-info\" uib-tooltip=编辑本集群凭据 ng-click=kubernetesmanage.editCluster()><i class=\"fa fa-cubes\" aria-hidden=true>修改集群</i></button> <button class=\"btn btn-info\" uib-tooltip=管理集群节点 ng-click=kubernetesmanage.node()><i class=\"fa fa-cubes\" aria-hidden=true>Node管理</i></button> <button class=\"btn btn-info\" uib-tooltip=管理集群Secret ng-click=kubernetesmanage.secret()><i class=\"fa fa-cubes\" aria-hidden=true>Secret管理</i></button> <button class=\"btn btn-info\" uib-tooltip=管理集群ConfigMap ng-click=kubernetesmanage.configMap()><i class=\"fa fa-cubes\" aria-hidden=true>ConfigMap管理</i></button></div></div></div></div><div class=\"col-lg-12 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-info\" uib-tooltip=刷新 ng-click=kubernetesmanage.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':(!kubernetesmanage.loadoverA ) || (!kubernetesmanage.loadoverB) || (!kubernetesmanage.loadoverC) || (!kubernetesmanage.loadoverD) }\"></i>刷新</button> <button class=\"btn btn-info\" uib-tooltip=创建Ingress ng-click=\"kubernetesmanage.createIngress(\'\',\'\')\"><i class=\"fa fa-plus\" aria-hidden=true>创建</i></button></span><h4 style=\"font-weight: bold;color: #337ab7\">Ingress({{kubernetesmanage.ingressCount||0}})</h4></div><div class=panel-body style=\"margin-top: 2px\"><div class=pt20 style=\"overflow: auto\"><table ng-table=kubernetesmanage.ingressTable class=\"table table-scroll table-hover text-left table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td data-title=\"\'命名空间\'\" width=80 filter=\"{ NAMESPACE: \'text\'}\" sortable>{{m.NAMESPACE}}</td><td data-title=\"\'名称\'\" width=80 filter=\"{ NAME: \'text\'}\" sortable><i class=\"fa fa-cog fa-2x\" aria-hidden=true ng-click=kubernetesmanage.createIngress(m.NAMESPACE,m.NAME) uib-tooltip=编辑 style=\"cursor:pointer;color: #339094\"></i> {{m.NAME}}</td><td data-title=\"\'CLASS\'\" width=80 filter=\"{ CLASS: \'text\'}\" sortable>{{m.CLASS}}</td><td data-title=\"\'HOSTS\'\" width=80 filter=\"{ HOSTS: \'text\'}\" sortable>{{m.HOSTS}}</td><td data-title=\"\'ADDRESS\'\" width=80 filter=\"{ ADDRESS: \'text\'}\" sortable><a ng-if=!m.ADDRESS style=\"color: red\">null<a> <a ng-if=m.ADDRESS>{{m.ADDRESS}}<a></a></a></a></a></td><td data-title=\"\'PORTS\'\" width=80 filter=\"{ PORTS: \'text\'}\" sortable>{{m.PORTS}}</td><td data-title=\"\'AGE\'\" width=80 filter=\"{ AGE: \'text\'}\" sortable>{{m.AGE}}</td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.describeingress(\'ingress\',m.NAME,m.NAMESPACE)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-edit fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.edityaml(\'ingress\',m.NAME,m.NAMESPACE)\" uib-tooltip=编辑yaml style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.deleteApp(\'ingress\',m.NAME,m.NAMESPACE)\" uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div></div><div class=\"col-lg-12 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-info\" uib-tooltip=刷新 ng-click=kubernetesmanage.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':(!kubernetesmanage.loadoverA ) || (!kubernetesmanage.loadoverB) || (!kubernetesmanage.loadoverC) || (!kubernetesmanage.loadoverD) }\"></i>刷新</button> <button class=\"btn btn-info\" uib-tooltip=创建Service ng-click=\"kubernetesmanage.createService(\'\',\'\')\"><i class=\"fa fa-plus\" aria-hidden=true>创建</i></button></span><h4 style=\"font-weight: bold;color: #337ab7\">Service({{kubernetesmanage.serviceCount||0}})</h4></div><div class=panel-body style=\"margin-top: 2px\"><div class=pt20 style=\"overflow: auto\"><table ng-table=kubernetesmanage.serviceTable class=\"table table-scroll table-hover text-left table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td data-title=\"\'命名空间\'\" width=80 filter=\"{ NAMESPACE: \'text\'}\" sortable>{{m.NAMESPACE}}</td><td data-title=\"\'名称\'\" width=80 filter=\"{ NAME: \'text\'}\" sortable><i class=\"fa fa-cog fa-2x\" aria-hidden=true ng-click=kubernetesmanage.createService(m.NAMESPACE,m.INAME) uib-tooltip=编辑 style=\"cursor:pointer;color: #339094\"></i> {{m.NAME}}</td><td data-title=\"\'TYPE\'\" width=80 filter=\"{ TYPE: \'text\'}\" sortable>{{m.TYPE}}</td><td data-title=\"\'CLUSTER-IP\'\" width=80 filter=\"{ CLUSTER_IP: \'text\'}\" sortable>{{m.CLUSTER_IP}}</td><td data-title=\"\'EXTERNAL-IP\'\" width=80 filter=\"{ EXTERNAL_IP: \'text\'}\" sortable>{{m.EXTERNAL_IP}}</td><td data-title=\"\'PORT(S)\'\" width=80 filter=\"{ PORT_S_: \'text\'}\" sortable>{{m.PORT_S_}}</td><td data-title=\"\'AGE\'\" width=80 filter=\"{ AGE: \'text\'}\" sortable>{{m.AGE}}</td><td data-title=\"\'SELECTOR\'\" width=80 filter=\"{ SELECTOR: \'text\'}\" sortable>{{m.SELECTOR}}</td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.describeservice(\'service\',m.INAME,m.NAMESPACE)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-edit fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.edityaml(\'service\',m.INAME,m.NAMESPACE)\" uib-tooltip=编辑yaml style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.deleteApp(\'service\',m.INAME,m.NAMESPACE)\" uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div></div><div class=\"col-lg-12 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-info\" uib-tooltip=刷新 ng-click=kubernetesmanage.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':(!kubernetesmanage.loadoverA ) || (!kubernetesmanage.loadoverB) || (!kubernetesmanage.loadoverC) || (!kubernetesmanage.loadoverD)}\"></i>刷新</button> <button class=\"btn btn-info\" uib-tooltip=创建无状态应用 ng-click=\"kubernetesmanage.createDeployment(\'\',\'\')\"><i class=\"fa fa-plus\" aria-hidden=true>创建</i></button></span><h4 style=\"font-weight: bold;color: #337ab7\">Deployment({{kubernetesmanage.deploymentCount||0}})<a>:READY({{ kubernetesmanage.deploymentReady||0}}) </a></h4></div><div class=panel-body style=\"margin-top: 2px\"><div class=pt20 style=\"overflow: auto\"><table ng-table=kubernetesmanage.deploymentTable class=\"table table-scroll table-hover text-left table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td data-title=\"\'命名空间\'\" width=80 filter=\"{ NAMESPACE: \'text\'}\" sortable>{{m.NAMESPACE}}</td><td data-title=\"\'名称\'\" width=80 filter=\"{ NAME: \'text\'}\" sortable><i class=\"fa fa-location-arrow fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.setimage(\'deployment\',m.INAME,m.NAMESPACE,m.IMAGES,m.CONTAINERS)\" uib-tooltip=升级 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-life-ring fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.rollback(\'deployment\',m.INAME,m.NAMESPACE,m.IMAGES,m.CONTAINERS)\" uib-tooltip=回滚 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-sort-numeric-asc fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.setreplicas(\'deployment\',m.INAME,m.NAMESPACE,m.AVAILABLE)\" uib-tooltip=扩缩容 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-cog fa-2x\" aria-hidden=true ng-click=kubernetesmanage.createDeployment(m.NAMESPACE,m.INAME) uib-tooltip=编辑 style=\"cursor:pointer;color: #339094\"></i> {{m.NAME}}</td><td data-title=\"\'READY\'\" width=80 filter=\"{ READY: \'text\'}\" sortable><a ng-if=m.IREADY>{{m.READY}}<a> <a ng-if=!m.IREADY style=\"color: red\">{{m.READY}}<a></a></a></a></a></td><td data-title=\"\'UP-TO-DATE\'\" width=80 filter=\"{ UP_TO_DATE: \'text\'}\" sortable>{{m.UP_TO_DATE}}</td><td data-title=\"\'AVAILABLE\'\" width=80 filter=\"{ AVAILABLE: \'text\'}\" sortable>{{m.AVAILABLE}}</td><td data-title=\"\'AGE\'\" width=80 filter=\"{ AGE: \'text\'}\" sortable>{{m.AGE}}</td><td data-title=\"\'HPA\'\" width=80 class=text-center><a ng-if=kubernetesmanage.hpa[m.NAMESPACE][m.NAME]>{{kubernetesmanage.hpa[m.NAMESPACE][m.NAME][\'describe\']}}</a> <i ng-if=!kubernetesmanage.hpa[m.NAMESPACE][m.NAME] class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.createHpa(\'deployment\',m.INAME,m.NAMESPACE)\" uib-tooltip=添加HPA style=\"cursor:pointer;color: #339094\"></i> <i ng-if=kubernetesmanage.hpa[m.NAMESPACE][m.NAME] class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.describe(\'hpa\',m.INAME,m.NAMESPACE)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i> <i ng-if=kubernetesmanage.hpa[m.NAMESPACE][m.NAME] class=\"fa fa-edit fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.edityaml(\'hpa\',m.INAME,m.NAMESPACE)\" uib-tooltip=编辑 style=\"cursor:pointer;color: #339094\"></i> <i ng-if=kubernetesmanage.hpa[m.NAMESPACE][m.NAME] class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.deleteApp(\'hpa\',m.INAME,m.NAMESPACE)\" uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td><td data-title=\"\'发布流水线\'\" width=80 class=text-center><div ng-repeat=\"xx in kubernetesmanage.flowlineinfo[\'deployment\'][m.NAMESPACE][m.INAME]\">{{xx.name}} <i class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.gotoflowline(xx.groupid, xx.id)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-edit fa-2x\" aria-hidden=true ng-click=kubernetesmanage.editconfig(xx.groupid,xx.id,xx.name) uib-tooltip=编辑 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=kubernetesmanage.deleteProject(xx.groupid,xx.id) uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></div><i class=\"fa fa-plus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.copyProjectByTemplate(m.INAME, \'deployment\',m.INAME,m.NAMESPACE )\" uib-tooltip=创建流水线 style=\"cursor:pointer;color: #339094\"></i></td><td data-title=\"\'CONTAINERS\'\" width=80 filter=\"{ CONTAINERS: \'text\'}\" sortable>{{m.CONTAINERS}}</td><td data-title=\"\'IMAGES\'\" width=80 filter=\"{ IMAGES: \'text\'}\" sortable>{{m.IMAGES}}</td><td data-title=\"\'SELECTOR\'\" width=80 filter=\"{ SELECTOR: \'text\'}\" sortable>{{m.SELECTOR}}</td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.describedeployment(\'deployment\',m.INAME,m.NAMESPACE)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-edit fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.edityaml(\'deployment\',m.INAME,m.NAMESPACE)\" uib-tooltip=编辑yaml style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.deleteApp(\'deployment\',m.INAME,m.NAMESPACE)\" uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div></div><div class=\"col-lg-12 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-info\" uib-tooltip=刷新 ng-click=kubernetesmanage.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':(!kubernetesmanage.loadoverA ) || (!kubernetesmanage.loadoverB) || (!kubernetesmanage.loadoverC) || (!kubernetesmanage.loadoverD) }\"></i>刷新</button> <button class=\"btn btn-info\" uib-tooltip=创建守护进程集 ng-click=\"kubernetesmanage.createDaemonSet(\'\',\'\')\"><i class=\"fa fa-plus\" aria-hidden=true>创建</i></button></span><h4 style=\"font-weight: bold;color: #337ab7\">DaemonSet({{kubernetesmanage.daemonsetCount||0}}) <a>READY(</a> <a ng-if=\"kubernetesmanage.daemonsetCount == kubernetesmanage.daemonsetReady\">{{kubernetesmanage.daemonsetReady||0}}</a> <a ng-if=\"kubernetesmanage.daemonsetCount != kubernetesmanage.daemonsetReady\" style=\"color: red\">{{kubernetesmanage.daemonsetReady||0}}</a> <a>)</a></h4></div><div class=panel-body style=\"margin-top: 2px\"><div class=pt20 style=\"overflow: auto\"><table ng-table=kubernetesmanage.daemonsetTable class=\"table table-scroll table-hover text-left table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td data-title=\"\'命名空间\'\" width=80 filter=\"{ NAMESPACE: \'text\'}\" sortable>{{m.NAMESPACE}}</td><td data-title=\"\'名称\'\" width=80 filter=\"{ NAME: \'text\'}\" sortable><i class=\"fa fa-cog fa-2x\" aria-hidden=true ng-click=kubernetesmanage.createDaemonSet(m.NAMESPACE,m.INAME) uib-tooltip=编辑 style=\"cursor:pointer;color: #339094\"></i> {{m.NAME}}</td><td data-title=\"\'DESIRED\'\" width=80 filter=\"{ DESIRED: \'text\'}\" sortable>{{m.DESIRED}}</td><td data-title=\"\'CURRENT\'\" width=80 filter=\"{ CURRENT: \'text\'}\" sortable>{{m.CURRENT}}</td><td data-title=\"\'READY\'\" width=80 filter=\"{ READY: \'text\'}\" sortable>{{m.READY}}</td><td data-title=\"\'UP-TO-DATE\'\" width=80 filter=\"{ UP_TO_DATE: \'text\'}\" sortable>{{m.UP_TO_DATE}}</td><td data-title=\"\'AVAILABLE\'\" width=80 filter=\"{ AVAILABLE: \'text\'}\" sortable>{{m.AVAILABLE}}</td><td data-title=\"\'AGE\'\" width=80 filter=\"{ AGE: \'text\'}\" sortable>{{m.AGE}}</td><td data-title=\"\'CONTAINERS\'\" width=80 filter=\"{ CONTAINERS: \'text\'}\" sortable>{{m.CONTAINERS}}</td><td data-title=\"\'IMAGES\'\" width=80 filter=\"{ IMAGES: \'text\'}\" sortable>{{m.IMAGES}}</td><td data-title=\"\'SELECTOR\'\" width=80 filter=\"{ SELECTOR: \'text\'}\" sortable>{{m.SELECTOR}}</td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.describe(\'daemonset\',m.INAME,m.NAMESPACE)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-edit fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.edityaml(\'daemonset\',m.INAME,m.NAMESPACE)\" uib-tooltip=编辑yaml style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.deleteApp(\'daemonset\',m.INAME,m.NAMESPACE)\" uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div></div><div class=\"col-lg-12 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-info\" uib-tooltip=刷新 ng-click=kubernetesmanage.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':(!kubernetesmanage.loadoverA ) || (!kubernetesmanage.loadoverB) || (!kubernetesmanage.loadoverC) || (!kubernetesmanage.loadoverD) }\"></i>刷新</button></span><h4 style=\"font-weight: bold;color: #337ab7\">Pod({{kubernetesmanage.podCount||0}}) <a>READY(</a> <a ng-if=\"kubernetesmanage.podCount == kubernetesmanage.podReady\">{{kubernetesmanage.podReady||0}}</a> <a ng-if=\"kubernetesmanage.podCount != kubernetesmanage.podReady\" style=\"color: red\">{{kubernetesmanage.podReady||0}}</a> <a>)</a> <a>Running(</a> <a ng-if=\"kubernetesmanage.podCount == kubernetesmanage.podRunning\">{{kubernetesmanage.podRunning||0}}</a> <a ng-if=\"kubernetesmanage.podCount != kubernetesmanage.podRunning\" style=\"color: red\">{{kubernetesmanage.podRunning||0}}</a> <a>)</a></h4></div><div class=panel-body style=\"margin-top: 2px\"><div class=pt20 style=\"overflow: auto\"><table ng-table=kubernetesmanage.podTable class=\"table table-scroll table-hover text-left table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td data-title=\"\'命名空间\'\" width=80 filter=\"{ NAMESPACE: \'text\'}\" sortable>{{m.NAMESPACE}}</td><td data-title=\"\'名称\'\" width=80 filter=\"{ NAME: \'text\'}\" sortable><i class=\"fa fa-television fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.openOneTab(m,\'sh\')\" uib-tooltip=进入POD虚拟终端 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-file-text-o fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.openOneTab(m,\'log\')\" uib-tooltip=查看POD日志 style=\"cursor:pointer;color: #339094\"></i> {{m.NAME}}</td><td data-title=\"\'READY\'\" width=80 filter=\"{ READY: \'text\'}\" sortable><a ng-if=m.IREADY>{{m.READY}}<a> <a ng-if=!m.IREADY style=\"color: red\">{{m.READY}}<a></a></a></a></a></td><td data-title=\"\'STATUS\'\" width=80 filter=\"{ STATUS: \'text\'}\" sortable><a ng-if=\"m.STATUS==\'Running\'\">{{m.STATUS}}<a> <a ng-if=\"m.STATUS!=\'Running\'\" style=\"color: red\">{{m.STATUS}}<a></a></a></a></a></td><td data-title=\"\'RESTARTS\'\" width=80 filter=\"{ RESTARTS: \'text\'}\" sortable>{{m.RESTARTS}}</td><td data-title=\"\'AGE\'\" width=80 filter=\"{ AGE: \'text\'}\" sortable>{{m.AGE}}</td><td data-title=\"\'IP\'\" width=80 filter=\"{ IP: \'text\'}\" sortable>{{m.IP}}</td><td data-title=\"\'NODE\'\" width=80 filter=\"{ NODE: \'text\'}\" sortable>{{m.NODE}}</td><td data-title=\"\'NOMINATED NODE\'\" width=80 filter=\"{ NOMINATED_NODE: \'text\'}\" sortable>{{m.NOMINATED_NODE}}</td><td data-title=\"\'READINESS GATES\'\" width=80 filter=\"{ READINESS_GATES: \'text\'}\" sortable>{{m.READINESS_GATES}}</td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.describe(\'pod\',m.INAME,m.NAMESPACE)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-edit fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.edityaml(\'pod\',m.INAME,m.NAMESPACE)\" uib-tooltip=编辑yaml style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.deleteApp(\'pod\',m.INAME,m.NAMESPACE)\" uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div></div><div class=\"col-lg-12 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-info\" uib-tooltip=刷新 ng-click=kubernetesmanage.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':(!kubernetesmanage.loadoverA ) || (!kubernetesmanage.loadoverB) || (!kubernetesmanage.loadoverC) || (!kubernetesmanage.loadoverD) }\"></i>刷新</button></span><h4 style=\"font-weight: bold;color: #337ab7\">Replicaset({{kubernetesmanage.replicasetCount||0}}) <a>READY(</a> <a ng-if=\"kubernetesmanage.replicasetCount == kubernetesmanage.replicasetReady\">{{kubernetesmanage.replicasetReady||0}}</a> <a ng-if=\"kubernetesmanage.replicasetCount != kubernetesmanage.replicasetReady\" style=\"color: red\">{{kubernetesmanage.replicasetReady||0}}</a> <a>)</a></h4></div><div class=panel-body style=\"margin-top: 2px\"><div class=pt20 style=\"overflow: auto\"><table ng-table=kubernetesmanage.replicasetTable class=\"table table-scroll table-hover text-left table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td data-title=\"\'命名空间\'\" width=80 filter=\"{ NAMESPACE: \'text\'}\" sortable>{{m.NAMESPACE}}</td><td data-title=\"\'名称\'\" width=80 filter=\"{ NAME: \'text\'}\" sortable>{{m.NAME}}</td><td data-title=\"\'DESIRED\'\" width=80 filter=\"{ DESIRED: \'text\'}\" sortable>{{m.DESIRED}}</td><td data-title=\"\'CURRENT\'\" width=80 filter=\"{ CURRENT: \'text\'}\" sortable>{{m.CURRENT}}</td><td data-title=\"\'READY\'\" width=80 filter=\"{ READY: \'text\'}\" sortable>{{m.READY}}</td><td data-title=\"\'AGE\'\" width=80 filter=\"{ AGE: \'text\'}\" sortable>{{m.AGE}}</td><td data-title=\"\'CONTAINERS\'\" width=80 filter=\"{ CONTAINERS: \'text\'}\" sortable>{{m.CONTAINERS}}</td><td data-title=\"\'IMAGES\'\" width=80 filter=\"{ IMAGES: \'text\'}\" sortable>{{m.IMAGES}}</td><td data-title=\"\'SELECTOR\'\" width=80 filter=\"{ SELECTOR: \'text\'}\" sortable>{{m.SELECTOR}}</td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.describe(\'replicaset\',m.INAME,m.NAMESPACE)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-edit fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.edityaml(\'replicaset\',m.INAME,m.NAMESPACE)\" uib-tooltip=编辑yaml style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.deleteApp(\'replicaset\',m.INAME,m.NAMESPACE)\" uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div></div><div class=\"col-lg-12 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-info\" uib-tooltip=刷新 ng-click=kubernetesmanage.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':(!kubernetesmanage.loadoverA ) || (!kubernetesmanage.loadoverB) || (!kubernetesmanage.loadoverC) || (!kubernetesmanage.loadoverD) }\"></i>刷新</button></span><h4 style=\"font-weight: bold;color: #337ab7\">HPA({{kubernetesmanage.hpaCount||0}})</h4></div><div class=panel-body style=\"margin-top: 2px\"><div class=pt20 style=\"overflow: auto\"><table ng-table=kubernetesmanage.hpaTable class=\"table table-scroll table-hover text-left table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td data-title=\"\'命名空间\'\" width=80 filter=\"{ NAMESPACE: \'text\'}\" sortable>{{m.NAMESPACE}}</td><td data-title=\"\'名称\'\" width=80 filter=\"{ NAME: \'text\'}\" sortable>{{m.NAME}}</td><td data-title=\"\'REFERENCE\'\" width=80 filter=\"{ REFERENCE: \'text\'}\" sortable>{{m.REFERENCE}}</td><td data-title=\"\'TARGETS\'\" width=80 filter=\"{ TARGETS: \'text\'}\" sortable>{{m.TARGETS}}</td><td data-title=\"\'MINPODS\'\" width=80 filter=\"{ MINPODS: \'text\'}\" sortable>{{m.MINPODS}}</td><td data-title=\"\'MAXPODS\'\" width=80 filter=\"{ MAXPODS: \'text\'}\" sortable>{{m.MAXPODS}}</td><td data-title=\"\'REPLICAS\'\" width=80 filter=\"{ REPLICAS: \'text\'}\" sortable>{{m.REPLICAS}}</td><td data-title=\"\'AGE\'\" width=80 filter=\"{ AGE: \'text\'}\" sortable>{{m.AGE}}</td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.describe(\'hpa\',m.INAME,m.NAMESPACE)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-edit fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.edityaml(\'hpa\',m.INAME,m.NAMESPACE)\" uib-tooltip=编辑yaml style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.deleteApp(\'hpa\',m.INAME,m.NAMESPACE)\" uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div></div><div class=\"col-lg-12 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-info\" uib-tooltip=刷新 ng-click=kubernetesmanage.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':(!kubernetesmanage.loadoverA ) || (!kubernetesmanage.loadoverB) || (!kubernetesmanage.loadoverC) || (!kubernetesmanage.loadoverD) }\"></i>刷新</button></span><h4 style=\"font-weight: bold;color: #337ab7\">Endpoint({{kubernetesmanage.endpointCount||0}})</h4></div><div class=panel-body style=\"margin-top: 2px\"><div class=pt20 style=\"overflow: auto\"><table ng-table=kubernetesmanage.endpointTable class=\"table table-scroll table-hover text-left table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td data-title=\"\'命名空间\'\" width=80 filter=\"{ NAMESPACE: \'text\'}\" sortable>{{m.NAMESPACE}}</td><td data-title=\"\'名称\'\" width=80 filter=\"{ NAME: \'text\'}\" sortable>{{m.NAME}}</td><td data-title=\"\'ENDPOINTS\'\" width=80 filter=\"{ ENDPOINTS: \'text\'}\" sortable><a ng-if=\"m.ENDPOINTS===\'<none>\'\" style=\"color: red\">{{m.ENDPOINTS}}<a> <a ng-if=\"m.ENDPOINTS!==\'<none>\'\">{{m.ENDPOINTS}}<a></a></a></a></a></td><td data-title=\"\'AGE\'\" width=80 filter=\"{ AGE: \'text\'}\" sortable>{{m.AGE}}</td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.describe(\'endpoints\',m.NAME,m.NAMESPACE)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-edit fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.edityaml(\'endpoints\',m.NAME,m.NAMESPACE)\" uib-tooltip=编辑yaml style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.deleteApp(\'endpoints\',m.NAME,m.NAMESPACE)\" uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div></div><div class=\"col-lg-12 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-info\" uib-tooltip=刷新 ng-click=kubernetesmanage.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':(!kubernetesmanage.loadoverA ) || (!kubernetesmanage.loadoverB) || (!kubernetesmanage.loadoverC) || (!kubernetesmanage.loadoverD) }\"></i>刷新</button></span><h4 style=\"font-weight: bold;color: #337ab7\">Job.Batch({{kubernetesmanage.jobbatchCount||0}})</h4></div><div class=panel-body style=\"margin-top: 2px\"><div class=pt20 style=\"overflow: auto\"><table ng-table=kubernetesmanage.jobbatchTable class=\"table table-scroll table-hover text-left table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td data-title=\"\'命名空间\'\" width=80 filter=\"{ NAMESPACE: \'text\'}\" sortable>{{m.NAMESPACE}}</td><td data-title=\"\'名称\'\" width=80 filter=\"{ NAME: \'text\'}\" sortable>{{m.NAME}}</td><td data-title=\"\'COMPLETIONS\'\" width=80 filter=\"{ COMPLETIONS: \'text\'}\" sortable>{{m.COMPLETIONS}}</td><td data-title=\"\'DURATION\'\" width=80 filter=\"{ DURATION: \'text\'}\" sortable>{{m.DURATION}}</td><td data-title=\"\'AGE\'\" width=80 filter=\"{ AGE: \'text\'}\" sortable>{{m.AGE}}</td><td data-title=\"\'CONTAINERS\'\" width=80 filter=\"{ CONTAINERS: \'text\'}\" sortable>{{m.CONTAINERS}}</td><td data-title=\"\'IMAGES\'\" width=80 filter=\"{ IMAGES: \'text\'}\" sortable>{{m.IMAGES}}</td><td data-title=\"\'SELECTOR\'\" width=80 filter=\"{ SELECTOR: \'text\'}\" sortable>{{m.SELECTOR}}</td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.describe(\'job\',m.INAME,m.NAMESPACE)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-edit fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.edityaml(\'job\',m.INAME,m.NAMESPACE)\" uib-tooltip=编辑yaml style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.deleteApp(\'job\',m.INAME,m.NAMESPACE)\" uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div></div><div class=\"col-lg-12 col-xs-12 ml0 pl0\" style=\"padding-left: 0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-info\" uib-tooltip=刷新 ng-click=kubernetesmanage.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':(!kubernetesmanage.loadoverA ) || (!kubernetesmanage.loadoverB) || (!kubernetesmanage.loadoverC) || (!kubernetesmanage.loadoverD) }\"></i>刷新</button></span><h4 style=\"font-weight: bold;color: #337ab7\">StatefulSet({{kubernetesmanage.statefulsetCount||0}})</h4></div><div class=panel-body style=\"margin-top: 2px\"><div class=pt20 style=\"overflow: auto\"><table ng-table=kubernetesmanage.statefulsetTable class=\"table table-scroll table-hover text-left table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td data-title=\"\'命名空间\'\" width=80 filter=\"{ NAMESPACE: \'text\'}\" sortable>{{m.NAMESPACE}}</td><td data-title=\"\'名称\'\" width=80 filter=\"{ NAME: \'text\'}\" sortable>{{m.NAME}}</td><td data-title=\"\'READY\'\" width=80 filter=\"{ READY: \'text\'}\" sortable>{{m.READY}}</td><td data-title=\"\'AGE\'\" width=80 filter=\"{ AGE: \'text\'}\" sortable>{{m.AGE}}</td><td data-title=\"\'CONTAINERS\'\" width=80 filter=\"{ CONTAINERS: \'text\'}\" sortable>{{m.CONTAINERS}}</td><td data-title=\"\'IMAGES\'\" width=80 filter=\"{ IMAGES: \'text\'}\" sortable>{{m.IMAGES}}</td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.describe(\'statefulset\',m.INAME,m.NAMESPACE)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-edit fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.edityaml(\'statefulset\',m.INAME,m.NAMESPACE)\" uib-tooltip=编辑yaml style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetesmanage.deleteApp(\'statefulset\',m.INAME,m.NAMESPACE)\" uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div></div></div>");
$templateCache.put("app/pages/kubernetesmanage/node.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=kubernetesnode.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!kubernetesnode.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=kubernetesnode.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>集群节点管理</h5></div><div class=panel-body style=\"margin-top: 2px\"><div class=pt20 style=\"overflow: auto\"><table ng-table=kubernetesnode.nodeTable class=\"table table-scroll table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td data-title=\"\'名称\'\" width=80 filter=\"{ NAME: \'text\'}\" sortable>{{m.NAME}}</td><td data-title=\"\'状态\'\" width=80 filter=\"{ STATUS: \'text\'}\" sortable>{{m.STATUS}}</td><td data-title=\"\'角色\'\" width=80 filter=\"{ ROLES: \'text\'}\" sortable>{{m.ROLES}}</td><td data-title=\"\'时间\'\" width=80 filter=\"{ AGE: \'text\'}\" sortable>{{m.AGE}}</td><td data-title=\"\'版本\'\" width=80 filter=\"{ VERSION: \'text\'}\" sortable>{{m.VERSION}}</td><td data-title=\"\'内网IP\'\" width=80 filter=\"{ INTERNAL_IP: \'text\'}\" sortable>{{m.INTERNAL_IP}}</td><td data-title=\"\'外网IP\'\" width=80 filter=\"{ EXTERNAL_IP: \'text\'}\" sortable>{{m.EXTERNAL_IP}}</td><td data-title=\"\'操作系统\'\" width=80 filter=\"{ OS_IMAGE: \'text\'}\" sortable>{{m.OS_IMAGE}}</td><td data-title=\"\'内核版本\'\" width=80 filter=\"{ KERNEL_VERSION: \'text\'}\" sortable>{{m.KERNEL_VERSION}}</td><td data-title=\"\'容器运行时\'\" width=80 filter=\"{ CONTAINER_RUNTIME: \'text\'}\" sortable>{{m.CONTAINER_RUNTIME}}</td><td data-title=\"\'操作\'\" width=80><button class=\"btn btn-danger\" ng-disabled=m.stat.SchedulingDisabled ng-click=\"kubernetesnode.cordon(m.NAME,\'cordon\')\">设置成不可调度</button> <button class=\"btn btn-primary\" ng-disabled=!m.stat.SchedulingDisabled ng-click=\"kubernetesnode.cordon(m.NAME,\'uncordon\')\">设置成可调度</button></td></tr></table></div></div></div></div><style>.modal-dialog {width: 90%;}</style>");
$templateCache.put("app/pages/kubernetesmanage/rollback.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=kubernetesrollback.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!kubernetesrollback.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=kubernetesrollback.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>回滚</h5></div><div class=panel-body style=\"margin-top: 2px\"><div class=pt20 style=\"overflow: auto\"><table ng-table=kubernetesrollback.versionTable class=\"table table-scroll table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td data-title=\"\'版本\'\" width=80 filter=\"{ REVISION: \'text\'}\" sortable>{{m.REVISION}}</td><td data-title=\"\'镜像\'\" width=80 filter=\"{ IMAGE: \'text\'}\" sortable>{{m.IMAGE}}</td><td data-title=\"\'CHANGE_CAUSE\'\" width=80 filter=\"{ CHANGE_CAUSE: \'text\'}\" sortable>{{m.CHANGE_CAUSE}}</td><td data-title=\"\'操作\'\" width=80><button class=\"btn btn-info\" ng-click=kubernetesrollback.assignment(m.REVISION,m.IMAGE)>操作协助</button> <button class=\"btn btn-primary\" ng-click=kubernetesrollback.rollback(m.REVISION)>回滚</button></td></tr></table></div></div></div></div><style>.modal-dialog {width: 60%;}</style>");
$templateCache.put("app/pages/kubernetesmanage/searchingress.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=kubernetessearchingress.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!kubernetessearchingress.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=kubernetessearchingress.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>所有集群的Ingress汇总</h5></div><div class=panel-body style=\"margin-top: 2px\"><div class=pt20 style=\"overflow: auto\"><table ng-table=kubernetessearchingress.nodeTable class=\"table table-scroll table-hover text-left table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td data-title=\"\'集群名称\'\" width=80 filter=\"{ clustername: \'text\'}\" sortable>{{m.clustername}}</td><td data-title=\"\'命名空间\'\" width=80 filter=\"{ NAMESPACE: \'text\'}\" sortable>{{m.NAMESPACE}}</td><td data-title=\"\'名称\'\" width=80 filter=\"{ NAME: \'text\'}\" sortable><i ng-if=m.NAME class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=\"kubernetessearchingress.describeingress(m.clusterid,\'ingress\',m.NAME,m.NAMESPACE)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i> {{m.NAME}}</td><td data-title=\"\'CLASS\'\" width=80 filter=\"{ CLASS: \'text\'}\" sortable>{{m.CLASS}}</td><td data-title=\"\'HOSTS\'\" width=80 filter=\"{ HOSTS: \'text\'}\" sortable>{{m.HOSTS}}</td><td data-title=\"\'ADDRESS\'\" width=80 filter=\"{ ADDRESS: \'text\'}\" sortable>{{m.ADDRESS}}</td><td data-title=\"\'PORTS\'\" width=80 filter=\"{ PORTS: \'text\'}\" sortable>{{m.PORTS}}</td><td data-title=\"\'AGE\'\" width=80 filter=\"{ AGE: \'text\'}\" sortable>{{m.AGE}}</td><td data-title=\"\'错误\'\" width=80 filter=\"{ error: \'text\'}\" sortable><a style=\"color: red\">{{m.error}}</a></td></tr></table></div></div></div></div><style>.modal-dialog {width: 90%;}</style>");
$templateCache.put("app/pages/kubernetesmanage/secret.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=kubernetessecret.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!kubernetessecret.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=kubernetessecret.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>Secret管理 集群:{{kubernetessecret.clusterinfo.name}}</h5></div><div class=panel-body style=\"margin-top: 2px\"><button class=\"btn btn-info\" uib-tooltip=创建secret ng-click=kubernetessecret.createSecret()><i class=\"fa fa-cubes\" aria-hidden=true>创建dockerconfigjson</i></button> <button class=\"btn btn-info\" uib-tooltip=创建secret ng-click=\"kubernetessecret.createSecretOpaque(\'\',\'\',\'Opaque\')\"><i class=\"fa fa-cubes\" aria-hidden=true>创建Opaque</i></button> <button class=\"btn btn-info\" uib-tooltip=创建secret ng-click=\"kubernetessecret.createSecretOpaque(\'\',\'\',\'kubernetes.io/service-account-token\')\"><i class=\"fa fa-cubes\" aria-hidden=true>创建service-account-token</i></button> <button class=\"btn btn-info\" uib-tooltip=创建secret ng-click=\"kubernetessecret.createSecretOpaque(\'\',\'\',\'IngressTLS\')\"><i class=\"fa fa-cubes\" aria-hidden=true>创建IngressTLS</i></button><div class=pt20 style=\"overflow: auto\"><table ng-table=kubernetessecret.nodeTable class=\"table table-scroll table-hover text-left table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td ng-if=!kubernetessecret.namespace data-title=\"\'命名空间\'\" width=80 filter=\"{ NAMESPACE: \'text\'}\" sortable>{{m.NAMESPACE}}</td><td data-title=\"\'名称\'\" width=80 filter=\"{ NAME: \'text\'}\" sortable><i class=\"fa fa-cog fa-2x\" aria-hidden=true ng-if=\"kubernetessecret.clusterinfo.auth===\'X\'\" ng-click=kubernetessecret.createSecretOpaque(m.NAMESPACE||kubernetessecret.namespace,m.NAME,m.TYPE) uib-tooltip=编辑 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-cog fa-2x\" aria-hidden=true ng-if=\"kubernetessecret.clusterinfo.auth!==\'X\'\" style=\"color: #685e5e\" uib-tooltip=无编辑权限 style=\"cursor:pointer;color: #339094\"></i> {{m.NAME}}</td><td data-title=\"\'类型\'\" width=80 filter=\"{ TYPE: \'text\'}\" sortable>{{m.TYPE}}</td><td data-title=\"\'数据\'\" width=80 filter=\"{ DATA: \'text\'}\" sortable>{{m.DATA}}</td><td data-title=\"\'AGE\'\" width=80 filter=\"{ AGE: \'text\'}\" sortable>{{m.AGE}}</td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-search fa-2x\" aria-hidden=true ng-if=\"kubernetessecret.clusterinfo.auth===\'X\'\" ng-click=\"kubernetessecret.describe(\'secrets\',m.NAME,m.NAMESPACE||kubernetessecret.namespace)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-search fa-2x\" aria-hidden=true ng-if=\"kubernetessecret.clusterinfo.auth!==\'X\'\" style=\"color: #685e5e\" uib-tooltip=无查看权限 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-edit fa-2x\" aria-hidden=true ng-if=\"kubernetessecret.clusterinfo.auth===\'X\'\" ng-click=\"kubernetessecret.edityaml(\'secrets\',m.NAME,m.NAMESPACE||kubernetessecret.namespace)\" uib-tooltip=编辑yaml style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-edit fa-2x\" aria-hidden=true ng-if=\"kubernetessecret.clusterinfo.auth!==\'X\'\" style=\"color: #685e5e\" uib-tooltip=无编辑权限 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-minus-circle fa-2x\" aria-hidden=true ng-click=\"kubernetessecret.deleteApp(\'secrets\',m.NAME,m.NAMESPACE)\" uib-tooltip=删除 style=\"cursor:pointer;color: #f63\"></i></td></tr></table></div></div></div></div><style>.modal-dialog {width: 60%;}</style>");
$templateCache.put("app/pages/kubernetesmanage/setimage.html","<div class=\"row block\"><div class=modal-header><h4 class=modal-title>升级</h4></div><div class=modal-body><form class=form-horizontal name=myForm role=form><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">镜像</label><div class=col-sm-9><input type=text class=form-control placeholder=镜像 ng-model=kubernetessetimage.image required></div></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-info\" ng-disabled=myForm.$invalid ng-click=kubernetessetimage.assignment()>操作协助</button> <button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetessetimage.setimage()>确认</button> <button class=\"btn btn-warning\" ng-click=kubernetessetimage.cancel()>取消</button></div></div></form></div></div><style>.modal-dialog {width: 60%;}</style>");
$templateCache.put("app/pages/kubernetesmanage/setreplicas.html","<div class=\"row block\"><div class=modal-header><h4 class=modal-title>手动扩缩容</h4></div><div class=modal-body><form class=form-horizontal name=myForm role=form><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">副本数</label><div class=col-sm-9><input type=text class=form-control placeholder=副本数 ng-model=kubernetessetreplicas.replicas required></div></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-info\" ng-disabled=myForm.$invalid ng-click=kubernetessetreplicas.assignment()>操作协助</button> <button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=kubernetessetreplicas.setreplicas()>确认</button> <button class=\"btn btn-warning\" ng-click=kubernetessetreplicas.cancel()>取消</button></div></div></form></div></div><style>.modal-dialog {width: 30%;}</style>");
$templateCache.put("app/pages/login/login.html","<div class=login style=\"background: #f86632;margin:0;padding:0;height:100%;width:100%;position:absolute\"><h1 class=\"h2 text-light text-center push-top-bottom animation-slideDown\"><img src=/assets/images/open-c3-logo.jpeg width=150></h1><div><div id=login><div class=logo></div><form onsubmit=\"return false\"><div class=wrapper-login><span class=input-icon><i class=\"glyphicon glyphicon-user\"></i> <span class=\"glyphicon glyphicon-alert text-danger hide\"></span> <input type=text class=user placeholder=username cmlang=login_username ng-model=login.post.user name=username> </span><span class=input-icon><i class=\"glyphicon glyphicon-lock\"></i> <input type=password placeholder=password cmlang=login_password ng-model=login.post.pass name=password></span></div><button type=submit class=login-button ng-click=login.login() cmlang=login_login>登录</button><p style=text-align:center;padding-top:5px;color:#fff ng-if=login.logining id=logining><span>登录中...</span></p></form><span><a href=https://oa.openc3.com/ cmlang=login_find_pwd></a></span></div></div></div>");
$templateCache.put("app/pages/others/401.html","<div id=error-container class=text-center><h1>401</h1><button class=\"btn btn-default\" ui-sref=home><i class=\"fa fa-arrow-left\"></i> Go back</button></div>");
$templateCache.put("app/pages/others/404.html","<div id=error-container class=text-center><h1>404</h1><button class=\"btn btn-default\" ui-sref=home><i class=\"fa fa-arrow-left\"></i> Go back</button></div>");
$templateCache.put("app/pages/others/500.html","<div id=error-container class=text-center><h1>500</h1><button class=\"btn btn-default\" ui-sref=home><i class=\"fa fa-arrow-left\"></i> Go back</button></div>");
$templateCache.put("app/pages/quickapproval/quickapproval.html","<div class=\"row block\" id=changewidth style=\"background: #fff;margin:0;padding:0;height:100%;width:100%;position:absolute\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=quickapproval.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!quickapproval.loadover}\"></i></button></span><h5>审批:{{quickapproval.data.name}}</h5></div><div class=panel-body ng-init=\"ns = { \'null\': \'未发送\', \'sending\': \'发送中\', \'done\':\'完成\', \'skip\': \'忽略\', \'fail\': \'失败\'}\"><div class=panel-tabs><table ng-table=quickapproval.dataTable class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"d in $data\"><td style=\"width: 10%\" data-title=\"\'审批人\'\">{{d.user}}</td><td style=\"width: 10%\" data-title=\"\'耗时\'\">{{quickapproval.seftime(d.create_time,d.finishtime)}}</td><td style=\"width: 10%\" data-title=\"\'审批状态\'\"><a ng-if=\"d.opinion == \'agree\'\" style=\"color: green\">同意 </a><a ng-if=\"d.opinion == \'unconfirmed\'\">未审批 </a><a ng-if=\"d.opinion == \'refuse\'\" style=\"color: red\">拒绝</a></td></tr></table></div></div><div class=row><label class=\"col-md-2 control-label fwbold\">创建时间</label><label class=\"col-md-4 control-label fwbold\">{{quickapproval.data.create_time}}</label></div><div class=row><label class=\"col-md-2 control-label fwbold\">提交人</label><label class=\"col-md-4 control-label fwbold\">{{quickapproval.data.submitter}}</label></div><div class=row><label class=\"col-md-2 control-label fwbold\">审批内容</label><label class=\"col-md-4 control-label fwbold\">{{quickapproval.data.cont}}</label></div><div class=\"panel-footer text-right\"><button class=\"btn btn-success\" ng-disabled=\"quickapproval.stat.opinion != \'unconfirmed\'\" ng-click=\"quickapproval.edit(\'agree\')\">同意</button> <button class=\"btn btn-danger\" ng-disabled=\"quickapproval.stat.opinion != \'unconfirmed\'\" ng-click=\"quickapproval.edit(\'refuse\')\">拒绝</button></div></div></div>");
$templateCache.put("app/pages/quickentry/addUser.html","<div class=modal-header><h4 class=modal-title>添加用户</h4></div><div class=modal-body><form class=form-horizontal name=addForm role=form><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">账户名</label><div class=col-sm-9><input type=text class=form-control name=adduser placeholder=username ng-minlength=2 ng-model=username required> <span style=color:red ng-show=addForm.adduser.$error.minlength>不少于2字符</span></div></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=addForm.$invalid ng-click=addUser.add()>确认</button> <button class=\"btn btn-warning\" ng-click=addUser.cancel()>取消</button></div></div></form></div>");
$templateCache.put("app/pages/quickentry/quickentry.html","<div class=\"row block\"><div ui-view></div></div>");
$templateCache.put("app/pages/quickentry/taskDetail.html","<div class=\"row block\" id=changewidth><div class=\"panel panel-success\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-success\" style=cursor:default><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!jobDetail.loadover}\"></i></button> <button class=\"btn btn-success\" ng-click=jobDetail.cancel() uib-tooltip=关闭><i class=\"fa fa-times fa-fw\"></i></button></span><h5>任务执行日志</h5></div><div class=table-responsive style=\"width: 100%\"><table class=\"table table-bordered\" style=\"font-weight: bold;border: 0px\"><tbody><tr><td>任务名称</td><td>{{jobDetail.taskInfo.name}}</td><td>任务类型</td><td>{{jobDetail.pluginname[jobDetail.taskInfo.jobtype]}}</td><td>执行账户</td><td>{{jobDetail.taskInfo.user}}</td><td>耗时</td><td>{{jobDetail.seftime(jobDetail.taskInfo.starttime,jobDetail.taskInfo.finishtime)}}</td></tr><tr><td>任务状态</td><td><span ng-style=statucolor>{{jobDetail.jobState}}</span></td><td>开始时间</td><td>{{jobDetail.taskInfo.starttime}}</td><td>结束时间</td><td>{{jobDetail.taskInfo.finishtime}}</td><td></td><td></td></tr></tbody></table></div><div class=panel-body><div><h5 class=fwbold>日志详情</h5><job-subtask-log-area jobuuid=jobDetail.jobuuid loguuid=jobDetail.loguuid jobaddr=jobDetail.jobaddr class=fluid-width></job-subtask-log-area></div></div><div class=\"panel-footer text-right\"><button class=\"btn btn-warning\" ng-click=jobDetail.cancel()>关闭</button></div></div></div>");
$templateCache.put("app/pages/approval/edit/edit.html","<div class=\"row block\" id=changewidth><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=approvaledit.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!approvaledit.loadover}\"></i></button> <button class=\"btn btn-primary\" ng-click=approvaledit.cancel() uib-tooltip=关闭><i class=\"fa fa-times fa-fw\"></i></button></span><h5>审批:{{approvaledit.data.name}}</h5></div><div class=panel-body ng-init=\"ns = { \'null\': \'未发送\', \'sending\': \'发送中\', \'done\':\'完成\', \'skip\': \'忽略\', \'fail\': \'失败\'}\"><div class=panel-tabs><table ng-table=approvaledit.dataTable class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"d in $data\"><td style=\"width: 10%\" data-title=\"\'审批人\'\">{{d.user}}</td><td style=\"width: 10%\" data-title=\"\'耗时\'\">{{approvaledit.seftime(d.create_time,d.finishtime)}}</td><td style=\"width: 10%\" data-title=\"\'OA单号\'\">{{d.oauuid}}</td><td style=\"width: 10%\" data-title=\"\'通知状态\'\">{{ns[d.notifystatus]}}</td><td style=\"width: 10%\" data-title=\"\'审批状态\'\"><a ng-if=\"d.opinion == \'agree\'\" style=\"color: green\">同意 </a><a ng-if=\"d.opinion == \'unconfirmed\'\">未审批 </a><a ng-if=\"d.opinion == \'refuse\'\" style=\"color: red\">拒绝</a></td></tr></table></div></div><div class=table-responsive style=\"width: 100%\"><table class=\"table table-bordered\" style=\"font-weight: bold;border: 0px\"><tbody><tr><td>创建时间</td><td>{{approvaledit.data.create_time}}</td><td>审批名称</td><td>{{approvaledit.data.name}}</td><td>提交人</td><td>{{approvaledit.data.submitter}}</td></tr></tbody></table></div><a><pre>审批内容: {{approvaledit.data.cont}}</pre></a><div class=\"panel-footer text-right\"><button class=\"btn btn-success\" ng-disabled=!approvaledit.show ng-click=\"approvaledit.edit(\'agree\')\">同意</button> <button class=\"btn btn-danger\" ng-disabled=!approvaledit.show ng-click=\"approvaledit.edit(\'refuse\')\">拒绝</button></div></div></div>");
$templateCache.put("app/pages/assignment/edit/edit.html","<div class=\"row block\" id=changewidth><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=assignmentedit.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!assignmentedit.loadover}\"></i></button> <button class=\"btn btn-primary\" ng-click=assignmentedit.cancel() uib-tooltip=关闭><i class=\"fa fa-times fa-fw\"></i></button></span><h5>名称:{{assignmentedit.data.name}}</h5></div><div class=table-responsive style=\"width: 100%\"><table class=\"table table-bordered\" style=\"font-weight: bold;border: 0px\"><tbody><tr><td>创建时间</td><td>{{assignmentedit.data.create_time}}</td><td>结束时间</td><td>{{assignmentedit.data.finish_time}}</td></tr><tr><td>提交人</td><td>{{assignmentedit.data.submitter}}</td><td>处理人</td><td>{{assignmentedit.data.handler}}</td></tr><tr><td>类型</td><td>{{assignmentedit.data.type}}</td><td>审批名称</td><td>{{assignmentedit.data.name}}</td></tr></tbody></table></div><a><pre>申请详情: {{assignmentedit.data.remarks}}</pre></a><a><pre>申请理由: {{assignmentedit.data.submit_reason}}</pre></a><a ng-show=\"!(assignmentedit.show && assignmentedit.data.status===\'todo\')\"><pre>处理答复: {{assignmentedit.data.handle_reason}}</pre></a><a ng-show=\"assignmentedit.show && assignmentedit.data.status===\'todo\'\">处理答复:</a><textarea style=\"min-height: 100px\" ng-show=\"assignmentedit.show && assignmentedit.data.status===\'todo\'\" class=form-control rows=3 cols=100 ng-model=assignmentedit.data.handle_reason> </textarea><div ng-if=assignmentedit.show class=\"panel-footer text-right\"><button class=\"btn btn-success\" ng-disabled=\"assignmentedit.data.status!==\'todo\'\" ng-click=assignmentedit.commit()>提交</button> <button class=\"btn btn-danger\" ng-disabled=\"assignmentedit.data.status!==\'todo\'\" ng-click=\"assignmentedit.updateStatus(\'refuse\')\">拒绝</button></div></div></div>");
$templateCache.put("app/pages/connector/chpasswd/chpasswd.html","<div><div class=\"panel panel-primary\"><div class=panel-heading><h5>修改个人密码</h5></div></div><div><form name=myForm novalidate><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">原密码</label><div class=col-sm-3><input type=password class=form-control ng-model=connectorchpasswd.chpasswd.old required></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">新密码</label><div class=col-sm-3><input type=password class=form-control ng-model=connectorchpasswd.chpasswd.new1 ng-change=connectorchpasswd.change() required></div></div></div><div class=row><div class=\"col-sm-12 form-group\"><label class=\"col-sm-1 control-label\">重复新密码</label><div class=col-sm-3><input type=password class=form-control ng-model=connectorchpasswd.chpasswd.new2 ng-change=connectorchpasswd.change() required></div><label class=\"col-sm-1 control-label\" ng-if=connectorchpasswd.new2err style=\"color: red\">两个新密码不一致</label></div></div><div class=row><div class=\"col-sm-12 form-group\"><div class=col-sm-3><button type=submit ng-disabled=\"myForm.$invalid || connectorchpasswd.new2err\" class=\"btn btn-primary\" style=\"padding: 10px 25px\" ng-click=connectorchpasswd.changepasswd()><i class=\"fa fa-key fa-lg\" aria-hidden=true></i>修改密码</button></div></div></div><div id=createerr style=\"padding: 10px;color: red;font-weight: bold\" class=form-inline>{{errmsg}}</div><div id=createok style=\"padding: 10px;color: green;font-weight: bold\" class=form-inline>{{okmsg}}</div><div style=\"clear: both\">&nbsp;</div></form></div></div>");
$templateCache.put("app/pages/connector/config/config.html","<div><div class=\"panel panel-info\"><div class=panel-heading><span class=panel-controls></span><h5>聚云立方对接</h5></div><div class=panel-body><div class=form-horizontal><div class=container-fluid><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">AppName</label><div class=col-sm-2><input type=text class=form-control ng-model=connectorconfig.config.juyunappname required></div><label class=\"col-sm-2 control-label\">AppKey</label><div class=col-sm-4><input type=text class=form-control ng-model=connectorconfig.config.juyunappkey required></div></div><div class=\"col-sm-2 form-group\"><button class=\"btn btn-primary\" ng-disabled=\"! ( connectorconfig.config.juyunappname && connectorconfig.config.juyunappkey )\" ng-click=connectorconfig.save()>聚云连接器初始化</button></div></div></div></div></div><br><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=保存 ng-click=connectorconfig.save()><i class=\"fa fa-floppy-o\" aria-hidden=true></i></button> <button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=connectorconfig.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!connectorconfig.loadover}\"></i></button></span><h5>连接器配置管理</h5></div><div class=panel-body><div class=form-horizontal><div class=container-fluid><h4>历史连接器</h4><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-md-2 control-label fwbold\">连接器切换(保存后生效)</label><div class=\"col-md-9 form-inline\"><select class=form-control ng-model=connectorconfig.name ng-change=connectorconfig.reload()><option ng-repeat=\"x in connectorconfig.configlist\" value={{x}}>{{x}}</option></select></div></div></div><hr><h4>登录</h4><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">获取用户信息</label><div class=col-sm-9><input type=text class=form-control ng-model=connectorconfig.config.ssousername required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">用户登出</label><div class=col-sm-9><input type=text class=form-control ng-model=connectorconfig.config.ssologoutapi required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">回调</label><div class=col-sm-9><input type=text class=form-control ng-model=connectorconfig.config.ssocallback required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">cookie名</label><div class=col-sm-9><input type=text class=form-control ng-model=connectorconfig.config.cookiekey required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">修改密码</label><div class=col-sm-9><input type=text class=form-control ng-model=connectorconfig.config.ssochpasswd required></div></div></div><h4>服务树</h4><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">用户服务树</label><div class=col-sm-9><input type=text class=form-control ng-model=connectorconfig.config.usertree required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">全量服务树</label><div class=col-sm-9><input type=text class=form-control ng-model=connectorconfig.config.treemap required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\"></label><label class=\"col-sm-2 control-label\">appname</label><div class=col-sm-2><input type=text class=form-control ng-model=connectorconfig.config.treemapenv.appname required></div><label class=\"col-sm-2 control-label\">appkey</label><div class=col-sm-3><input type=text class=form-control ng-model=connectorconfig.config.treemapenv.appkey required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">服务树资源</label><div class=col-sm-9><input type=text class=form-control ng-model=connectorconfig.config.nodeinfo required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\"></label><label class=\"col-sm-2 control-label\">appname</label><div class=col-sm-2><input type=text class=form-control ng-model=connectorconfig.config.nodeinfoenv.appname required></div><label class=\"col-sm-2 control-label\">appkey</label><div class=col-sm-3><input type=text class=form-control ng-model=connectorconfig.config.nodeinfoenv.appkey required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">权限控制</label><div class=col-sm-9><input type=text class=form-control ng-model=connectorconfig.config.pmspoint required></div></div></div><h4>消息出口</h4><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">邮件</label><div class=col-sm-9><input type=text class=form-control ng-model=connectorconfig.config.usermail required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\"></label><label class=\"col-sm-2 control-label\">appname</label><div class=col-sm-2><input type=text class=form-control ng-model=connectorconfig.config.usermailenv.appname required></div><label class=\"col-sm-2 control-label\">appkey</label><div class=col-sm-3><input type=text class=form-control ng-model=connectorconfig.config.usermailenv.appkey required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">短信</label><div class=col-sm-9><input type=text class=form-control ng-model=connectorconfig.config.usermesg required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\"></label><label class=\"col-sm-2 control-label\">appname</label><div class=col-sm-2><input type=text class=form-control ng-model=connectorconfig.config.usermesgenv.appname required></div><label class=\"col-sm-2 control-label\">appkey</label><div class=col-sm-3><input type=text class=form-control ng-model=connectorconfig.config.usermesgenv.appkey required></div></div></div><h4>外部辅助审批</h4><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">审批接口</label><div class=col-sm-9><input type=text class=form-control ng-model=connectorconfig.config.approver required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\"></label><label class=\"col-sm-2 control-label\">appname</label><div class=col-sm-2><input type=text class=form-control ng-model=connectorconfig.config.approverenv.appname required></div><label class=\"col-sm-2 control-label\">appkey</label><div class=col-sm-3><input type=text class=form-control ng-model=connectorconfig.config.approverenv.appkey required></div></div></div><h4>前端风格</h4><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">选择前端风格</label><div class=col-sm-9 ng-init=\"frontendstylelist = {\'openc3\': \'openc3\',\'juyun\':\'juyun\'}\"><select id=selecteddataval class=form-control ng-model=connectorconfig.config.frontendstyle style=\"width: 20%\"><option ng-repeat=\"x in frontendstylelist\" value={{x}}>{{x}}</option></select></div></div></div><h4>连接器设置</h4><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">调试日志[debug]</label><div class=col-sm-9 ng-init=\"debuglist = {\'off\': \'0\',\'on\':\'1\'}\"><select id=selecteddataval class=form-control ng-model=connectorconfig.config.debug style=\"width: 20%\"><option ng-repeat=\"x in debuglist\" value={{x}}>{{x}}</option></select></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">接口缓存[秒]</label><div class=col-sm-9><input type=text class=form-control ng-model=connectorconfig.config.apicache style=\"width: 20%\" required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">仅使用作业系统</label><div class=col-sm-9 ng-init=\"openc3_job_system_onlylist = {\'off\': \'0\',\'on\':\'1\'}\"><select id=selecteddataval class=form-control ng-model=connectorconfig.config.openc3_job_system_only style=\"width: 20%\"><option ng-repeat=\"x in openc3_job_system_onlylist\" value={{x}}>{{x}}</option></select></div></div></div><hr><h4>报告</h4><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">GIT报告合并</label><div class=col-sm-9 ng-init=\"gitreport2companylist = {\'off\': \'0\',\'on\':\'1\'}\"><select id=selecteddataval class=form-control ng-model=connectorconfig.config.gitreport2company style=\"width: 20%\"><option ng-repeat=\"x in gitreport2companylist\" value={{x}}>{{x}}</option></select></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">流水线报告合并</label><div class=col-sm-9 ng-init=\"flowreport2companylist = {\'off\': \'0\',\'on\':\'1\'}\"><select id=selecteddataval class=form-control ng-model=connectorconfig.config.flowreport2company style=\"width: 20%\"><option ng-repeat=\"x in flowreport2companylist\" value={{x}}>{{x}}</option></select></div></div></div></div></div></div></div></div></div>");
$templateCache.put("app/pages/connector/mail/mail.html","<div><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=connectormail.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!connectormail.loadover}\"></i></button></span><h5>给我的邮件</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=connectormail.mailTable class=\"table table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"d in $data\"><td style=\"width: 10%\" data-title=\"\'时间\'\" filter=\"{ time: \'text\'}\" sortable>{{d.time}}</td><td style=\"width: 10%\" data-title=\"\'标题\'\" filter=\"{ title: \'text\'}\" sortable>{{d.title}}</td><td style=\"width: 70%\" data-title=\"\'内容\'\" filter=\"{ content: \'text\'}\" sortable>{{d.content}}</td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/connector/mesg/mesg.html","<div><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=connectormesg.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!connectormesg.loadover}\"></i></button></span><h5>给我的短信</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=connectormesg.mesgTable class=\"table table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"d in $data\"><td style=\"width: 10%\" data-title=\"\'时间\'\" filter=\"{ time: \'text\'}\" sortable>{{d.time}}</td><td style=\"width: 70%\" data-title=\"\'内容\'\" filter=\"{ mesg: \'text\'}\" sortable>{{d.mesg}}</td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/connector/node/node.html","<div><nodestr></nodestr><hr class=\"mv20 clear\"><div><div style=\"float: right\"><form class=form-inline name=myForm novalidate><div class=form-group ng-init=\"username=\'\'\"><input type=text class=form-control ng-model=nodename placeholder=机器ip required></div><button type=submit ng-disabled=myForm.$invalid class=\"btn btn-primary\" ng-click=connectornode.addNode()><i class=\"fa fa-desktop fa-lg\" aria-hidden=true></i>添加机器</button></form></div><div style=\"clear: both\">&nbsp;</div></div><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=connectornode.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!connectornode.loadover}\"></i></button></span><h5>服务器资源</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=connectornode.nodeTable class=\"table table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td style=\"width: 10%\" data-title=\"\'机器名称\'\" filter=\"{ name: \'text\'}\" sortable>{{m.name}}</td><td style=\"width: 10%\" data-title=\"\'创建人\'\" filter=\"{ create_user: \'text\'}\" sortable>{{m.create_user}}</td><td style=\"width: 10%\" data-title=\"\'内网IP\'\" filter=\"{ inip: \'text\'}\" sortable>{{m.inip}}</td><td style=\"width: 10%\" data-title=\"\'外网IP\'\" filter=\"{ exip: \'text\'}\" sortable>{{m.exip}}</td><td style=\"width: 10%\" data-title=\"\'创建时间\'\" filter=\"{ create_time: \'text\'}\" sortable>{{m.create_time}}</td><td style=\"width: 10%\" data-title=\"\'操作\'\"><button class=\"btn btn-primary btn-md\" ng-click=connectornode.delete(m.id)>删除</button></td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/connector/tree/tree.html","<div style=\"width: 100%\"><div id=sidebar_left style=\"width: 100%\"><div id=\"sidebar-scroll nav sidebar-menu\"><div class=sidebar-content><div class=panel style=\"margin: 0\"><div class=panel-heading style=\"background-color: #4a89dc;color: #fff\"><span class=panel-title>服务树编辑</span> <span class=panel-controls><a href=javascript:void(0) style=\"color: #fff\" ng-click=connectortree.focusCurrent()><i class=\"fa fa-map-marker\"></i></a> <a href=javascript:void(0) style=\"color: #fff\" ng-click=connectortree.expandAll(true)><i class=\"fa fa-plus\"></i></a> <a href=javascript:void(0) style=\"color: #fff\" ng-click=connectortree.expandAll(false)><i class=\"fa fa-minus\"></i></a> <a href=javascript:void(0) style=\"color: #fff\" ng-click=connectortree.reload()><i class=\"treeFresh fa fa-refresh\"></i></a></span></div><div class=\"panel-body prn\" style=\";padding: 0\"><perfect-scrollbar class=scroller><ul class=ztree id=openc3treeclone></ul></perfect-scrollbar></div><!-- start: right click menu --><div class=clickMenu ng-class=\"{open: !connectortree.hideMenu}\"><ul class=\"dropdown-menu tree-menu text-left\"><li class=dropdown-header><strong>{{ connectortree.menuTags }}</strong></li><li class=divider></li><li ng-show=\"connectortree.canAddNode && connectortree.canEditNode\"><a href=javascript:void(0) ng-click=connectortree.addNode()><i class=\"fa fa-plus pull-right\"></i> 添加节点</a></li><li ng-show=\"connectortree.canDelNode && connectortree.canEditNode\"><a href=javascript:void(0) ng-click=connectortree.delNode()><i class=\"fa fa-trash pull-right\"></i> 删除节点</a></li><li ng-show=!connectortree.canEditNode><a href=javascript:void(0)>私有节点不能在服务树中编辑</a></li></ul></div><!-- end: right click menu --></div></div></div></div></div>");
$templateCache.put("app/pages/connector/userauth/userauth.html","<div><div><div style=\"float: right\"><form class=form-inline name=myForm novalidate><div class=form-group ng-init=\"username=\'\'\"><input type=text class=form-control ng-model=username placeholder=用户登录名 required></div><div class=form-group ng-init=\"role= [ { id: 1, name: \'研发角色\'} , { id: 2, name: \'运维角色\'} , { id: 3, name: \'管理员\'} ]\"><select class=form-control ng-model=connectoruserauth.role ng-options=\"o.id as o.name for o in role\"></select></div><button type=submit ng-disabled=myForm.$invalid class=\"btn btn-primary\" ng-click=connectoruserauth.addAuth()><i class=\"fa fa-user-secret fa-lg\" aria-hidden=true></i>添加权限</button></form></div><div style=\"clear: both\">&nbsp;</div></div><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=connectoruserauth.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!connectoruserauth.loadover}\"></i></button></span><h5>用户权限</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=connectoruserauth.userTable class=\"table table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"user in $data\"><td style=\"width: 10%\" data-title=\"\'用户\'\" filter=\"{ name: \'text\'}\" sortable>{{user.name}}</td><td style=\"width: 10%\" data-title=\"\'级别\'\" sortable><a ng-if=\"user.level==1\">研发 </a><a ng-if=\"user.level==2\" style=\"color: #e52\">运维 </a><a ng-if=\"user.level==3\" style=\"color: red\">管理员</a></td><td style=\"width: 10%\" data-title=\"\'操作\'\"><button class=\"btn btn-primary btn-md\" ng-click=connectoruserauth.delete(user.name)>删除</button></td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/connector/userinfo/userinfo.html","<div><div><div style=\"float: right\"><form class=form-inline name=myForm novalidate><div class=form-group ng-init=\"username=\'\'\"><input type=text class=form-control ng-model=username placeholder=用户登录名 required></div><button type=submit ng-disabled=myForm.$invalid class=\"btn btn-primary\" ng-click=\"connectoruserinfo.addUser(username,\'创建\')\"><i class=\"fa fa-user-circle-o fa-lg\" aria-hidden=true></i>添加用户</button></form></div><div style=\"clear: both\">&nbsp;</div></div><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=connectoruserinfo.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!connectoruserinfo.loadover}\"></i></button></span><h5>可登录用户</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=connectoruserinfo.userTable class=\"table table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"user in $data\"><td style=\"width: 10%\" data-title=\"\'用户\'\" filter=\"{ name: \'text\'}\" sortable>{{user.name}}</td><td style=\"width: 10%\" data-title=\"\'密码未修改\'\" sortable><a ng-if=user.pass style=\"color: red\">是(危险) </a><a ng-if=!user.pass>否</a></td><td style=\"width: 10%\" data-title=\"\'操作\'\"><button class=\"btn btn-primary btn-md\" ng-click=\"connectoruserinfo.addUser(user.name, \'重置密码\')\">重置密码</button> <button class=\"btn btn-primary btn-md\" ng-click=connectoruserinfo.delete(user.name)>删除</button></td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/business/agent/agent.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=修改记录 ng-click=agent.showctrlLog()>修改记录</button> <button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=agent.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!agent.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=添加 ng-click=agent.addregion()><i class=\"fa fa-plus\"></i></button></span><h5>{{ agent.nodeStr }}</h5></div><div class=\"admin-form row\"><label class=\"col-md-2 control-label fwbold\" style=\"padding-left: 27px;padding-right: 27px;padding-top: 6px\">状态自动监测更新</label><div class=col-md-1 style=\"padding: 0\"><label class=\"switch switch-system mt5\"><input type=checkbox id=check_status ng-model=agent.checknewstatus><label for=check_status data-on=ON data-off=OFF></label></label></div><div class=col-md-1 style=\"padding: 0\"><button class=\"btn btn-primary\" ng-if=\"agent.checkoldstatus!=agent.checknewstatus\" uib-tooltip=添加机器 ng-click=agent.savecheckstatus()>保存新状态</button></div></div><div class=panel-body ng-if=agent.checkstatusloadover><div style=\"padding: 10px\"><span style=\"font-size: 14px;font-weight: bold; color: #626262\">安装代理:</span> <span style=\"color: red\">curl -L {{agent.siteaddr}}/api/scripts/installProxy.sh |sudo OPEN_C3_ADDR={{agent.siteaddr}} bash</span></div><div style=\"padding: 10px\"><span style=\"font-size: 14px;font-weight: bold; color: #626262\">安装AGENT:</span> <span style=\"color: red\">curl -L {{agent.siteaddr}}/api/scripts/installAgent.sh |sudo OPEN_C3_ADDR={{agent.siteaddr}} bash</span></div><div style=\"padding: 10px\"><span style=\"font-size: 14px;font-weight: bold; color: #626262\">指定AGENT启动用户:</span> <span>OPEN_C3_AGENT_USER=worker</span></div><div style=\"padding: 10px\"><span style=\"font-size: 14px;font-weight: bold; color: #626262\">强制重装:</span> <span>OPEN_C3_AGENT_FORCE_INSTALL=1</span></div><div style=\"padding: 10px\"><span style=\"font-size: 14px;font-weight: bold; color: #626262\">卸载命令【目录删除后AGENT会自动退出】:</span> <span>rm -rf /opt/mydan /data/mydan /etc/cron.d/mydan_bootstrap_cron_7d29f42</span></div><div style=\"padding-left: 93%\"><a style=\"font-size: 14px;font-weight: bold\" class=\"btn btn-primary\" href={{agent.siteaddr}}/api/agent/proxy/{{agent.treeid}} target=_blank>代理接口</a></div></div><br><br><div class=panel-body><div class=pt20><table ng-table=agent.activeRegionTable class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"m in $data\"><td data-title=\"\'ID\'\">{{m.id}}</td><td data-title=\"\'区域\'\"><font size=5>{{m.region}}</font></td><td data-title=\"\'代理\'\"><font size=3 color=green>正常：{{m.proxy.success||0}}</font><br><font size=3 color=red>异常：{{m.proxy.fail||0}}</font><br><button class=\"btn btn-primary\" ng-if=\"m.regionprojectid == agent.treeid\" uib-tooltip=添加代理 ng-click=\"agent.addproxy( m.id, m.region )\"><i class=\"fa fa-plus\"></i></button></td><td data-title=\"\'网段\'\"><font size=3 color=green>正常：{{m.agent.success||0}}</font><br><font size=3 color=red>异常：{{m.agent.fail||0}}</font><br><button class=\"btn btn-primary\" ng-if=\"m.proxy.success || m.agent.success > 0 || m.agent.fail > 0 \" uib-tooltip=添加网段 ng-click=agent.addagent(m.id,m.region)><i class=\"fa fa-plus\"></i></button></td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/business/crontab/create.html","<div class=modal-header><h4 ng-if=\"businesscrontabcreate.edit==false\" class=modal-title>创建定时任务</h4><h4 ng-if=\"businesscrontabcreate.edit==true\" class=modal-title>编辑定时任务</h4></div><div class=modal-body><form class=form-horizontal role=form name=myForm novalidate><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">定时任务 <span style=\"color: red\">*</span> :</label><div class=col-sm-9><input type=text name=cronTabname class=form-control ng-model=cronTabname ng-minlength=3 required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\" style=\"padding-top: 16px\">作业名称 <span style=\"color: red\">*</span> :</label><div class=col-sm-9><select class=form-control ng-model=selectedjob required><option ng-repeat=\"x in allJobs\" value={{x.uuid}}>{{x.name}}</option></select></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">规 则 <span style=\"color: red\">*</span> :</label><div class=col-sm-9><input type=text name=cronRule class=form-control ng-model=cronrule ng-minlength=3 required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">互斥锁:</label><div class=col-sm-9 style=\"margin-top: 10px\"><div class=admin-form ng-disabled=unClick><div class=\"option-group field\"><input type=checkbox name=cronlock style=\"zoom: 1.3\" ng-model=cronlock value=manual> <input ng-if=cronlock type=text name=mutex class=form-control ng-model=businesscrontabcreate.cronlockstr ng-minlength=3></div></div></div></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=businesscrontabcreate.createCron()>保 存</button> <button class=\"btn btn-warning\" ng-click=businesscrontabcreate.cancel()>取 消</button></div></div></form></div>");
$templateCache.put("app/pages/business/crontab/crontab.html","<div><div class=row style=\"padding: 0 20px 0\"><nodestr></nodestr></div><hr class=\"mv10 clear\"><div class=\"panel panel-primary\"><div class=panel-heading><h5>查询条件</h5></div><div class=panel-body><div class=form-horizontal><form class=form-inline name=searchForm novalidate><div class=container-fluid><div class=row><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">作业名称:</label><input type=text class=form-control ng-model=businesscrontab.cronname placeholder=定时任务名称></div><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">创建人:</label><input type=text class=form-control ng-model=businesscrontab.createuser placeholder=创建人全称> <button type=submit class=\"btn btn-default\" ng-click=businesscrontab.getMe()>我</button></div><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">最后修改人:</label><input type=text class=form-control ng-model=businesscrontab.edituser placeholder=创建人全称> <button type=submit class=\"btn btn-default\" ng-click=businesscrontab.getMe()>我</button></div></div><div class=row style=\"margin-top: 23px\"><div class=\"form-group col-sm-6\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">创建时间：</label><div style=\"width: 30%\" class=\"input-group date\" id=createstart><input type=text class=form-control ng-model=businesscrontab.createStart placeholder=开始时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div><span style=\"margin: 0 5px\">-</span><div style=\"width: 30%\" class=\"input-group date\" id=createend><input type=text class=form-control ng-model=businesscrontab.createEnd placeholder=结束时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div></div><div class=\"form-group col-sm-6\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">修改时间：</label><div style=\"width: 30%\" class=\"input-group date\" id=editstart><input type=text class=form-control ng-model=businesscrontab.editStart placeholder=开始时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div><span style=\"margin: 0 5px\">-</span><div style=\"width: 30%\" class=\"input-group date\" id=editend><input type=text class=form-control ng-model=businesscrontab.editEnd placeholder=结束时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div></div></div></div></form><hr class=\"mv20 clear\" style=\"margin-top: 30px!important\"><div class=col-md-10><button class=\"btn btn-primary\" ng-click=businesscrontab.reload()><i class=\"fa fa-search fa-fw\"></i>查询</button> <button class=\"btn btn-success\" ng-click=businesscrontab.Reset()><i class=\"fa fa-refresh fa-fw\"></i>重置</button></div></div></div></div><div><div style=\"float: right\"><form class=form-inline name=myForm novalidate><button type=submit ng-disabled=myForm.$invalid class=\"btn btn-primary\" ng-click=businesscrontab.createCron()><i class=\"glyphicon glyphicon-plus\" aria-hidden=true></i>创建定时任务</button></form></div><div style=\"clear: both\">&nbsp;</div></div><div class=\"panel panel-dark\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-dark\" uib-tooltip=刷新 ng-click=businesscrontab.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!businesscrontab.loadover}\"></i></button></span><h5>定时任务</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=businesscrontab.data_Table class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"ss in $data\"><td data-title=\"\'定时任务\'\">{{ss.name}}</td><td data-title=\"\'规则\'\">{{ss.cron}}</td><td data-title=\"\'创建用户\'\">{{ss.create_user}}</td><td data-title=\"\'创建时间\'\">{{ss.create_time}}</td><td data-title=\"\'修改用户\'\">{{ss.edit_user}}</td><td data-title=\"\'最后修改时间\'\">{{ss.edit_time}}</td><td data-title=\"\'操作\'\"><button ng-if=\"ss.status == \'unavailable\'\" class=\"btn btn-primary btn-sm\" ng-click=businesscrontab.runCronJob(ss.id)>开始</button> <button ng-if=\"ss.status == \'available\'\" class=\"btn btn-primary btn-sm\" ng-click=businesscrontab.stopCronJob(ss.id)>暂停</button> <span class=mr5 style=\"border-left:2px solid #ddd;padding:0px 0 0px 0\"></span> <button class=\"btn btn-warning btn-sm\" ng-click=businesscrontab.editCronJob(ss.id)>修改</button> <button class=\"btn btn-danger btn-sm\" ng-click=businesscrontab.deleteCronJob(ss.id)>删除</button></td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/business/file/choiceFile.html","<div class=modal-header><h4 class=modal-title>服务器文件</h4></div><div><div style=\"margin: 1%\"><input type=file id=choicefiles style=\"display: none\" onchange=angular.element(this).scope().upForm() multiple> <button class=\"btn btn-primary\" ng-click=choicefile.clickImport()><span class=\"glyphicon glyphicon-upload\" style=\"padding: 0 3px\"></span>上传文件</button><div class=form-inline style=\"font-weight: bold\"><span id=upresult123>{{choicefile.up_re}}</span></div></div><div class=row><div class=\"col-sm-12 form-group\"><div style=\"padding-left: 74%\"><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\"><input type=radio ng-model=choiceType value=choice> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>选择文件</label><label class=\"option option-primary\"><input type=radio ng-model=choiceType value=input> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>手动输入</label></div></div></div></div></div><div class=row ng-switch=choiceType><div class=\"panel-tabs col-sm-10\" ng-switch-when=input style=\"padding-left: 10%;padding-bottom: 5%\"><label style=\"float: left; line-height: 34px;min-width: 90px;text-align: right\" for=jobName>文件名称：</label><input ng-model=choicefile.inputFileName class=form-control style=\"width: 80%\"></div></div><div ng-switch=choiceType><div class=panel-tabs ng-switch-when=choice><table ng-table=choicefile.files_Table class=\"table table-hover text-center table-condensed\"><thead><tr><th></th><th>文件名</th><th>大小</th><th>创建用户</th><th>创建时间</th><th>修改用户</th><th>修改时间</th><th>操作</th></tr></thead><tbody><tr ng-repeat=\"ss in $data\"><td><input type=radio name=selected ng-checked=isSelected(ss.id) ng-click=\"updateSelectFile($event, ss.id, ss)\" style=\"zoom: 125%\"></td><td>{{ss.name}}</td><td>{{ss.size / 1000}}kb</td><td>{{ss.create_user}}</td><td>{{ss.create_time}}</td><td>{{ss.edit_user}}</td><td>{{ss.edit_time}}</td><td><button class=\"btn btn-danger btn-sm\" ng-click=choicefile.deleteFile(ss.id)>删除</button></td></tr></tbody></table></div></div><div style=\"margin: 1%\"><button ng-click=choicefile.manageToken()>token管理</button></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=addForm.$invalid ng-click=choicefile.chioceover()>确认</button> <button class=\"btn btn-warning\" ng-click=choicefile.cancel()>取消</button></div></div></div>");
$templateCache.put("app/pages/business/file/file.html","<div><nodestr></nodestr><hr class=\"mv20 clear\"><div class=\"panel panel-primary\"><div class=panel-heading><h5>查询条件</h5></div><div class=panel-body><div class=form-horizontal><form class=form-inline name=searchForm novalidate><div class=container-fluid><div class=row><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">文件名称：</label><input type=text class=form-control ng-model=file.filename placeholder=文件关键字></div><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">创建人：</label><input type=text class=form-control ng-model=file.createuser placeholder=创建人全称> <button type=submit class=\"btn btn-default\" ng-click=file.getMe()>我</button></div></div><div class=row style=\"margin-top: 23px\"><div class=\"form-group col-sm-6\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">创建时间：</label><div style=\"width: 30%\" class=\"input-group date\" id=createstart><input type=text class=form-control ng-model=file.createStart placeholder=开始时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div><span style=\"margin: 0 5px\">-</span><div style=\"width: 30%\" class=\"input-group date\" id=createend><input type=text class=form-control ng-model=file.createEnd placeholder=结束时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div></div></div></div></form><hr class=\"mv20 clear\" style=\"margin-top: 55px!important\"><div class=col-md-10><button class=\"btn btn-primary\" ng-click=file.reload()><i class=\"fa fa-search fa-fw\"></i>查询</button> <button class=\"btn btn-success\" ng-click=file.Reset()><i class=\"fa fa-refresh fa-fw\"></i>重置</button></div></div></div></div></div><div><div style=\"float: right\"><input type=file id=choicefiles style=\"display: none\" onchange=angular.element(this).scope().upForm() multiple> <button class=\"btn btn-primary\" ng-click=file.clickImport()><span class=\"glyphicon glyphicon-upload\" style=\"padding: 0 3px\"></span>上传文件</button> <button class=\"btn btn-primary\" ng-click=file.manageToken()><i class=\"fa fa-key fa-lg\" aria-hidden=true></i>token管理</button></div><div style=\"clear: both\">&nbsp;</div></div><div class=\"panel panel-dark\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-dark\" uib-tooltip=刷新 ng-click=file.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!file.loadover}\"></i></button></span><h5>文件列表</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=file.file_Table class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"ss in $data\"><td data-title=\"\'文件名\'\">{{ss.name}}</td><td data-title=\"\'创建人\'\">{{ss.create_user}}</td><td data-title=\"\'创建时间\'\">{{ss.create_time}}</td><td data-title=\"\'大小\'\">{{file.bytesToSize(ss.size)}}</td><td data-title=\"\'修改用户\'\">{{ss.edit_user}}</td><td data-title=\"\'修改时间\'\">{{ss.edit_time}}</td><td data-title=\"\'操作\'\"><button class=\"btn btn-primary btn-sm\" ng-click=file.downloadFile(ss.name)>下载</button> <button class=\"btn btn-danger btn-sm\" ng-click=file.deleteFile(ss.id)>删除</button></td></tr></table></div></div></div>");
$templateCache.put("app/pages/business/file/token.html","<div style=\"width: 100%\"><div class=panel-heading><span class=panel-title>token管理</span> <span class=panel-controls><a href=javascript:void(0) ng-click=token.cancel()><i class=\"fa fa-close\"></i></a></span></div><div class=panel-body style=\"padding: 10px\"><div class=panel-tabs><table class=\"table table-hover text-center table-condensed\"><thead><tr><th style=\"text-align: center\">token</th><th style=\"text-align: center\">创建用户</th><th style=\"text-align: center\">创建时间</th><th style=\"text-align: center\">描述</th><th style=\"text-align: center\">成功后调用作业</th><th style=\"text-align: center\">操作</th></tr></thead><tbody><tr ng-repeat=\"t in token.allToken \"><td>{{t.token}}</td><td>{{t.create_user}}</td><td>{{t.create_time}}</td><td>{{t.describe}}</td><td>{{token.showJob(t.isjob, t.jobname)}}</td><td><button class=\"btn btn-danger btn-sm\" ng-click=token.delToken(t.id)>删除</button></td></tr></tbody></table></div></div><div class=panel-heading><span class=panel-title>token添加：</span> <span class=panel-controls></span></div><div style=\"margin: 1%\" class=row><div class=col-md-4 style=\"padding: 0 5px\"><div class=\"input-group fluid-width\"><input type=text class=form-control ng-model=token.newToken style=\"padding-top: 4px;padding-bottom: 4px;height: 30px\" placeholder=token></div></div><div class=col-md-6 style=\"padding: 0 5px\"><div class=\"input-group fluid-width\"><input type=text class=form-control ng-model=token.tokenDis style=\"padding-top: 4px;padding-bottom: 4px;height: 30px\" placeholder=描述></div></div><button class=\"btn btn-primary btn-sm\" ng-click=token.addToken()>添加token</button></div><div class=row style=\"margin: 1%\"><div class=\"form-group col-sm-2\" style=\"padding:0 5px\"><label class=\"control-label fwbold\">上传文件后调用job:</label></div><div class=\"form-group admin-form col-sm-2\" style=\"padding: 0 5px\"><label class=\"switch switch-system mt5\"><input type=checkbox id=check_job ng-model=token.isjob><label for=check_job data-on=ON data-off=OFF></label></label></div><div class=\"form-group col-sm-2\" style=\"padding: 0 5px\"><label ng-if=token.isjob class=\"control-label fwbold\" style=\"padding-right: 2%\">常用作业:</label></div><div class=\"form-group col-sm-4\" style=\"padding: 0 5px\"><select ng-if=token.isjob class=form-control ng-model=token.jobname ng-options=\"jobname for jobname in token.allJobs\"></select></div></div><div style=\"margin: 2%\"><span><span style=\"color: red;font-weight: bold\">通过token上传:</span> curl -X POST <span>{{token.hosturl}}</span>/api/job/fileserver/<span>{{token.treeid}}</span>/upload -F \"filename=@/tmp/xxx.txt\" -H \'token: <span>{{token.newToken}}</span>\'</span></div><div class=row><div class=\"col-sm-3 form-group\" style=\"margin-left: 40%\"><button class=\"btn btn-warning btn-sm\" ng-click=token.cancel()>取消</button></div></div></div>");
$templateCache.put("app/pages/business/job/create.html","<div><div class=row style=\"padding: 0 20px 0\"><nodestr></nodestr></div><hr class=\"mv10 clear\"><div class=panel ng-hide=saveHide><div class=panel-heading><h5>创建作业</h5></div><div class=panel-body><div class=form-horizontal><form class=form-inline name=searchForm novalidate><div class=container-fluid><div class=row><div class=\"form-group col-sm-10\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\" for=jobName>作业名称：</label><input type=text id=jobName class=form-control style=\"width: 50%\" ng-model=newjobname> <button class=\"btn btn-default\" style=\"font-size: 14px;margin-left: 20%\" ng-click=businessjobcreate.hideGlobalVar()>全局变量设置</button></div></div></div></form></div></div></div><div class=\"panel panel-default\" ng-hide=globalVar><div class=panel-heading><h5>全局变量参数</h5></div><div class=panel-body style=\"padding: 10px\"><div class=panel-tabs><table class=\"table table-hover text-center table-condensed\"><thead><tr><th style=\"text-align: center\">变量名称</th><th style=\"text-align: center\">变量默认值</th><th style=\"text-align: center\">变量描述</th><th style=\"text-align: center\">操作</th></tr></thead><tr ng-repeat=\"ss in businessjobcreate.allVar\"><td><input type=text class=\"form-control input-global\" ng-model=ss.name></td><td><input type=text class=\"form-control input-global\" ng-model=ss.value></td><td><input type=text class=\"form-control input-global\" ng-model=ss.describe></td><td><button class=\"btn btn-danger btn-sm\" ng-click=businessjobcreate.delVar($index)>删除</button></td></tr></table><button class=\"btn btn-primary col-sm-1\" style=\"width: 5%;padding: 6px 12px\" uib-tooltip=添加变量 ng-click=businessjobcreate.addVar()><i class=\"fa fa-plus\"></i></button></div></div></div><div style=\"margin-bottom: 15px\" ng-hide=saveHide ng-init=\"openc3_job_system_only=0\"><button class=\"btn btn-success\" ng-click=businessjobcreate.createScriptJob()><i class=\"glyphicon glyphicon-copy\"></i> 添加脚本步骤</button> <button class=\"btn btn-primary\" ng-click=businessjobcreate.createScpJob()><i class=\"glyphicon glyphicon-file\"></i> 添加分发文件步骤</button> <button class=\"btn btn-primary\" ng-if=\"openc3_job_system_only==0\" ng-click=businessjobcreate.createApprovalJob()><i class=\"fa fa-id-card\"></i> 添加审批步骤</button></div><div ng-repeat=\"item in businessjobcreate.allNewJob\" ng-init=\"openc3_job_system_only=0\"><div ng-if=\"item.plugin_type == \'cmd\'\" class=\"panel panel-success\"><div style=\"padding: 2px\"><strong style=\"font-size: 15px\">步骤.{{$index+1}}</strong> <button class=\"btn btn-success btn-xs\" ng-click=businessjobcreate.createScriptJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>脚本</button> <button class=\"btn btn-primary btn-xs\" ng-click=businessjobcreate.createScpJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>文件</button> <button class=\"btn btn-primary btn-xs\" ng-if=\"openc3_job_system_only==0\" ng-click=businessjobcreate.createApprovalJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>审批</button></div><div class=panel-heading><h5>脚本作业</h5></div><div class=panel-body style=\"padding: 10px\"><div class=panel-tabs><table class=\"table table-hover text-center table-condensed\" style=\"margin-bottom: 0\"><thead><tr><th style=\"text-align: center\">作业名称</th><th style=\"text-align: center\">执行账户</th><th style=\"text-align: center\">服务器类型</th><th style=\"text-align: center\">脚本参数</th><th style=\"text-align: center;width: 20%\">操作</th></tr></thead><tr><td>{{item.name}}</td><td>{{item.user}}</td><td>{{item.node_type}}</td><td>{{item.scripts_argv}}</td><td style=\"width: 20%\"><button class=\"btn btn-info btn-sm\" ng-hide=saveHide ng-click=businessjobcreate.copyScript($index)>复制</button> <button class=\"btn btn-warning btn-sm\" ng-hide=saveHide ng-click=businessjobcreate.editScript($index)>编辑</button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=businessjobcreate.deljobdata($index)>删除</button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=businessjobcreate.up($index)><i class=\"fa fa-arrow-up\"></i></button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=businessjobcreate.down($index)><i class=\"fa fa-arrow-down\"></i></button></td></tr></table></div></div></div><div ng-if=\"item.plugin_type == \'scp\'\" class=\"panel panel-primary\"><div style=\"padding: 1px\"><strong style=\"font-size: 15px\">步骤.{{$index+1}}</strong> <button class=\"btn btn-success btn-xs\" ng-click=businessjobcreate.createScriptJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>脚本</button> <button class=\"btn btn-primary btn-xs\" ng-click=businessjobcreate.createScpJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>文件</button> <button class=\"btn btn-primary btn-xs\" ng-click=businessjobcreate.createApprovalJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>审批</button></div><div class=panel-heading><h5>文件作业</h5></div><div class=panel-body style=\"padding: 10px\"><div class=panel-tabs><table class=\"table table-hover text-center table-condensed\" style=\"margin-bottom: 0\"><thead><tr><th style=\"text-align: center\">作业名称</th><th style=\"text-align: center\">执行账户</th><th style=\"text-align: center; max-width:60%\">目标服务器</th><th style=\"text-align: center\">目标路径</th><th style=\"text-align: center;width: 20%\">操作</th></tr></thead><tbody><tr><td>{{item.name}}</td><td>{{item.user}}</td><td>{{item.dst}}</td><td>{{item.dp}}</td><td style=\"width: 20%\"><button class=\"btn btn-info btn-sm\" ng-hide=saveHide ng-click=businessjobcreate.copyScp($index)>复制</button> <button class=\"btn btn-warning btn-sm\" ng-hide=saveHide ng-click=businessjobcreate.editScp($index)>编辑</button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=businessjobcreate.deljobdata($index)>删除</button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=businessjobcreate.up($index)><i class=\"fa fa-arrow-up\"></i></button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=businessjobcreate.down($index)><i class=\"fa fa-arrow-down\"></i></button></td></tr></tbody></table></div></div></div><div ng-if=\"item.plugin_type == \'approval\'\" class=\"panel panel-primary\"><div style=\"padding: 1px\"><strong style=\"font-size: 15px\">步骤.{{$index+1}}</strong> <button class=\"btn btn-success btn-xs\" ng-click=businessjobcreate.createScriptJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>脚本</button> <button class=\"btn btn-primary btn-xs\" ng-click=businessjobcreate.createScpJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>文件</button> <button class=\"btn btn-primary btn-xs\" ng-click=businessjobcreate.createApprovalJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>审批</button></div><div class=panel-heading><h5>审批作业</h5></div><div class=panel-body style=\"padding: 10px\"><div class=panel-tabs><table class=\"table table-hover text-center table-condensed\" style=\"margin-bottom: 0\"><thead><tr><th style=\"text-align: center\">作业名称</th><th style=\"text-align: center\">审批人</th><th style=\"text-align: center; max-width:60%\">审批内容</th><th style=\"text-align: center;width: 20%\">操作</th></tr></thead><tbody><tr><td>{{item.name}}</td><td>{{item.approver}}</td><td>{{item.cont}}</td><td style=\"width: 20%\"><button class=\"btn btn-info btn-sm\" ng-hide=saveHide ng-click=businessjobcreate.copyApproval($index)>复制</button> <button class=\"btn btn-warning btn-sm\" ng-hide=saveHide ng-click=businessjobcreate.editApproval($index)>编辑</button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=businessjobcreate.deljobdata($index)>删除</button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=businessjobcreate.up($index)><i class=\"fa fa-arrow-up\"></i></button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=businessjobcreate.down($index)><i class=\"fa fa-arrow-down\"></i></button></td></tr></tbody></table></div></div></div></div><hr class=\"mv10 clear\"><div style=\"margin-bottom: 15px\"><div style=\"margin-left: 40%\"><button class=\"btn btn-warning\" ng-hide=saveHide ng-click=businessjobcreate.saveCreateData()>保存作业</button> <button class=\"btn btn-danger\" ng-click=businessjobcreate.runJob() ng-disabled=saveOK>立即执行</button></div></div></div>");
$templateCache.put("app/pages/business/job/edit.html","<div><div class=row style=\"padding: 0 20px 0\"><nodestr></nodestr></div><hr class=\"mv10 clear\"><div class=panel ng-hide=saveHide><div class=panel-heading><h5 ng-if=!businessjobedit.copyjob>编辑作业</h5><h5 ng-if=businessjobedit.copyjob>克隆作业</h5></div><div class=panel-body><div class=form-horizontal><form class=form-inline name=searchForm novalidate><div class=container-fluid><div class=row><div class=\"form-group col-sm-10\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\" for=jobName>作业名称：</label><input type=text id=jobName class=form-control style=\"width: 50%\" ng-model=newjobname> <button class=\"btn btn-default\" style=\"margin-left: 20%; font-size: 14px\" ng-click=businessjobedit.hideGlobalVar()>全局变量设置</button> <button ng-show=businessjobedit.copyjob class=\"btn btn-default\" style=\"font-size: 14px;margin-right: 3px\" ng-click=businessjobedit.cloneToNode()>克隆至目标节点</button></div></div><div class=row ng-show=businessjobedit.hashCloneNodes style=\"padding-top: 10px\"><div class=\"form-group col-sm-10\" style=\"padding: 0\"><div class=panel-tabs><label style=\"float: left;line-height: 29px;min-width: 90px;text-align: right\" for=jobName>克隆节点：</label><table class=\"table-hover text-center table-condensed\"><tbody><tr style=\"font-weight: bold;font-size: 14px;color: red\"><td ng-repeat=\"(n, node) in businessjobedit.hashCloneNodes\">{{node.name}}</td></tr></tbody></table></div></div></div></div></form></div></div></div><div class=\"panel panel-default\" ng-hide=globalVar><div class=panel-heading><h5>全局变量参数</h5></div><div class=panel-body style=\"padding: 10px\"><div class=panel-tabs><table class=\"table table-hover text-center table-condensed\"><!--<table class=\"table table-hover text-center table-condensed\">--><thead><tr><th style=\"text-align: center\">变量名称</th><th style=\"text-align: center\">变量默认值</th><th style=\"text-align: center\">变量描述</th><th style=\"text-align: center\">操作</th></tr></thead><tr ng-repeat=\"ss in businessjobedit.allVar\"><td><input type=text class=\"form-control input-global\" ng-model=ss.name ng-readonly=ss.id></td><td><input type=text class=\"form-control input-global\" ng-model=ss.value></td><td><input type=text class=\"form-control input-global\" ng-model=ss.describe></td><td><button class=\"btn btn-danger btn-sm\" ng-click=\"businessjobedit.delVar($index, ss)\">删除</button></td></tr></table><button class=\"btn btn-primary col-sm-1\" style=\"width: 5%;padding: 6px 12px\" uib-tooltip=添加变量 ng-click=businessjobedit.addVar()><i class=\"fa fa-plus\"></i></button></div></div></div><div style=\"margin-bottom: 15px\" ng-hide=saveHide ng-init=\"openc3_job_system_only=0\"><button class=\"btn btn-success\" ng-click=businessjobedit.createScriptJob()><i class=\"glyphicon glyphicon-copy\"></i> 添加脚本步骤</button> <button class=\"btn btn-primary\" ng-click=businessjobedit.createScpJob()><i class=\"glyphicon glyphicon-file\"></i> 添加分发文件步骤</button> <button class=\"btn btn-primary\" ng-if=\"openc3_job_system_only==0\" ng-click=businessjobedit.createApprovalJob()><i class=\"fa fa-id-card\"></i> 添加审批步骤</button></div><div ng-repeat=\"item in businessjobedit.allNewJob\" ng-init=\"openc3_job_system_only=0\"><div ng-if=\"item.plugin_type == \'cmd\'\" class=\"panel panel-success\"><div style=\"padding: 2px\"><strong style=\"font-size: 15px\">步骤.{{$index+1}}</strong> <button class=\"btn btn-success btn-xs\" ng-click=businessjobedit.createScriptJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>脚本</button> <button class=\"btn btn-primary btn-xs\" ng-click=businessjobedit.createScpJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>文件</button> <button class=\"btn btn-primary btn-xs\" ng-if=\"openc3_job_system_only==0\" ng-click=businessjobedit.createApprovalJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>审批</button></div><div class=panel-heading><h5>脚本作业</h5></div><div class=panel-body style=\"padding: 10px\"><div class=panel-tabs><table class=\"table table-hover text-center table-condensed\" style=\"margin-bottom: 0\"><!--<table class=\"table table-hover text-center table-condensed\">--><thead><tr><th style=\"text-align: center\">作业名称</th><th style=\"text-align: center\">执行账户</th><th style=\"text-align: center\">服务器类型</th><th style=\"text-align: center\">脚本参数</th><th style=\"text-align: center;width: 20%\">操作</th></tr></thead><tr><td>{{item.name}}</td><td>{{item.user}}</td><td>{{item.node_type}}</td><td>{{item.scripts_argv}}</td><td style=\"width: 20%\"><button class=\"btn btn-info btn-sm\" ng-hide=saveHide ng-click=businessjobedit.copyScript($index)>复制</button> <button class=\"btn btn-warning btn-sm\" ng-hide=saveHide ng-click=businessjobedit.editScript($index)>编辑</button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=businessjobedit.deljobdata($index)>删除</button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=businessjobedit.up($index)><i class=\"fa fa-arrow-up\"></i></button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=businessjobedit.down($index)><i class=\"fa fa-arrow-down\"></i></button></td></tr></table></div></div></div><div ng-if=\"item.plugin_type == \'scp\'\" class=\"panel panel-primary\"><div style=\"padding: 1px\"><strong style=\"font-size: 15px\">步骤.{{$index+1}}</strong> <button class=\"btn btn-success btn-xs\" ng-click=businessjobedit.createScriptJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>脚本</button> <button class=\"btn btn-primary btn-xs\" ng-click=businessjobedit.createScpJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>文件</button> <button class=\"btn btn-primary btn-xs\" ng-click=businessjobedit.createApprovalJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>审批</button></div><div class=panel-heading><h5>文件作业</h5></div><div class=panel-body style=\"padding: 10px\"><div class=panel-tabs><table class=\"table table-hover text-center table-condensed\" style=\"margin-bottom: 0;width: 100%\"><thead><tr><th style=\"text-align: center\">作业名称</th><th style=\"text-align: center\">执行账户</th><th style=\"text-align: center;max-width:600px\">目标服务器</th><th style=\"text-align: center\">目标路径</th><th style=\"text-align: center;width: 20%\">操作</th></tr></thead><!--<table class=\"table table-hover text-center table-condensed\">--><tbody><tr><td>{{item.name}}</td><td>{{item.user}}</td><td style=max-width:600px>{{item.dst}}</td><td>{{item.dp}}</td><td style=\"width: 20%\"><button class=\"btn btn-info btn-sm\" ng-hide=saveHide ng-click=businessjobedit.copyScp($index)>复制</button> <button class=\"btn btn-warning btn-sm\" ng-hide=saveHide ng-click=businessjobedit.editScp($index)>编辑</button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=businessjobedit.deljobdata($index)>删除</button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=businessjobedit.up($index)><i class=\"fa fa-arrow-up\"></i></button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=businessjobedit.down($index)><i class=\"fa fa-arrow-down\"></i></button></td></tr></tbody></table></div></div></div><div ng-if=\"item.plugin_type == \'approval\'\" class=\"panel panel-primary\"><div style=\"padding: 1px\"><strong style=\"font-size: 15px\">步骤.{{$index+1}}</strong> <button class=\"btn btn-success btn-xs\" ng-click=businessjobedit.createScriptJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>脚本</button> <button class=\"btn btn-primary btn-xs\" ng-click=businessjobedit.createScpJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>文件</button> <button class=\"btn btn-primary btn-xs\" ng-click=businessjobedit.createApprovalJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>审批</button></div><div class=panel-heading><h5>审批作业</h5></div><div class=panel-body style=\"padding: 10px\"><div class=panel-tabs><table class=\"table table-hover text-center table-condensed\" style=\"margin-bottom: 0;width: 100%\"><thead><tr><th style=\"text-align: center\">作业名称</th><th style=\"text-align: center\">审批人</th><th style=\"text-align: center;max-width:600px\">审批内容</th><th style=\"text-align: center;width: 20%\">操作</th></tr></thead><tbody><tr><td>{{item.name}}</td><td>{{item.approver}}</td><td style=max-width:600px>{{item.cont}}</td><td style=\"width: 20%\"><button class=\"btn btn-info btn-sm\" ng-hide=saveHide ng-click=businessjobedit.copyApproval($index)>复制</button> <button class=\"btn btn-warning btn-sm\" ng-hide=saveHide ng-click=businessjobedit.editApproval($index)>编辑</button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=businessjobedit.deljobdata($index)>删除</button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=businessjobedit.up($index)><i class=\"fa fa-arrow-up\"></i></button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=businessjobedit.down($index)><i class=\"fa fa-arrow-down\"></i></button></td></tr></tbody></table></div></div></div></div><hr class=\"mv10 clear\"><div style=\"margin-bottom: 15px\"><div style=\"margin-left: 40%\"><button ng-if=businessjobedit.copyjob class=\"btn btn-warning\" ng-click=businessjobedit.saveCloneData()>克隆作业</button> <button ng-if=!businessjobedit.copyjob class=\"btn btn-warning\" ng-hide=saveHide ng-click=businessjobedit.saveCreateData()>保存作业</button> <button ng-if=!businessjobedit.copyjob class=\"btn btn-danger\" ng-click=businessjobedit.runJob() ng-disabled=saveOK>立即执行</button></div></div></div>");
$templateCache.put("app/pages/business/job/job.html","<div><div class=row style=\"padding: 0 20px 0\"><nodestr></nodestr></div><hr class=\"mv10 clear\"><div class=\"panel panel-primary\"><div class=panel-heading><h5>查询条件</h5></div><div class=panel-body><div class=form-horizontal><form class=form-inline name=searchForm novalidate><div class=container-fluid><div class=row><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">作业名称：</label><input type=text class=form-control ng-model=businessjob.jobname placeholder=作业名称关键字></div><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">创建人：</label><input type=text class=form-control ng-model=businessjob.createuser placeholder=创建人全称> <button type=submit class=\"btn btn-default\" ng-click=\"businessjob.getMe(\'create\')\">我</button></div><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">最后修改人：</label><input type=text class=form-control ng-model=businessjob.edituser placeholder=修改人全称> <button type=submit class=\"btn btn-default\" ng-click=\"businessjob.getMe(\'edit\')\">我</button></div></div><div class=row style=\"margin-top: 23px\"><div class=\"form-group col-sm-6\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">创建时间：</label><div style=\"width: 30%\" class=\"input-group date\" id=createstart><input type=text class=form-control ng-model=businessjob.createStart placeholder=开始时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div><span style=\"margin: 0 5px\">-</span><div style=\"width: 30%\" class=\"input-group date\" id=createend><input type=text class=form-control ng-model=businessjob.createEnd placeholder=结束时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div></div><div class=\"form-group col-sm-6\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">修改时间：</label><div style=\"width: 30%\" class=\"input-group date\" id=editstart><input type=text class=form-control ng-model=businessjob.editStart placeholder=开始时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div><span style=\"margin: 0 5px\">-</span><div style=\"width: 30%\" class=\"input-group date\" id=editend><input type=text class=form-control ng-model=businessjob.editEnd placeholder=结束时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div></div></div></div></form><hr class=\"mv20 clear\" style=\"margin-top: 30px!important\"><div class=col-md-10><button class=\"btn btn-primary\" ng-click=businessjob.reload()><i class=\"fa fa-search fa-fw\"></i>查询</button> <button class=\"btn btn-success\" ng-click=businessjob.Reset()><i class=\"fa fa-refresh fa-fw\"></i>重置</button></div></div></div></div><div><div style=\"float: right\"><form class=form-inline name=myForm novalidate><button type=submit ng-disabled=myForm.$invalid class=\"btn btn-primary\" ng-click=\"businessjob.addJob(username,\'创建\')\"><i class=\"fa fa-cube fa-lg\" aria-hidden=true></i>新建作业</button></form></div><div style=\"clear: both\">&nbsp;</div></div><div class=\"panel panel-dark\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-dark\" uib-tooltip=刷新 ng-click=businessjob.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!businessjob.loadover}\"></i></button></span><h5>作业列表</h5></div><div class=panel-body ng-init=\"openc3_job_system_only=0\"><div class=panel-tabs ng-init=\'hasvariable = { \"0\":\"无\", \"1\":\"有\" }\'><table ng-table=businessjob.dataTable class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"ss in $data\"><td data-title=\"\'作业名称\'\">{{ss.name}}</td><td ng-if=\"openc3_job_system_only==0\" data-title=\"\'关联流水线\'\">{{businessjob.ciinfo[ss.name]}}</td><td data-title=\"\'步骤\'\">{{ss.stepcount}}</td><td data-title=\"\'变量\'\">{{hasvariable[ss.hasvariable]}}</td><td data-title=\"\'创建用户\'\">{{ss.create_user}}</td><td data-title=\"\'创建时间\'\">{{ss.create_time}}</td><td data-title=\"\'修改用户\'\">{{ss.edit_user}}</td><td data-title=\"\'最后修改时间\'\">{{ss.edit_time}}</td><td data-title=\"\'操作\'\"><button class=\"btn btn-primary btn-sm\" ng-click=businessjob.runJob(ss.uuid)>执行</button><!-- <button class=\"btn btn-primary btn-sm\" ng-click=\"businessjob.saveCron(ss)\">定时启动</button> --> <button class=\"btn btn-warning btn-sm\" ng-click=businessjob.editJob(ss.uuid)>编辑</button> <button class=\"btn btn-warning btn-sm\" ng-click=businessjob.copyJob(ss.uuid)>克隆</button> <button class=\"btn btn-danger btn-sm\" ng-click=businessjob.deleteJob(ss.uuid)>删除</button></td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/business/machine/machine.html","<div><nodestr></nodestr><hr class=\"mv20 clear\"><div class=\"panel panel-primary\"><div class=panel-heading><h5>查询条件</h5></div><div class=panel-body><form class=form-inline name=searchForm novalidate><div class=row><div class=\"form-group col-md-3\"><div class=\"input-group fluid-width\"><input type=text class=form-control ng-model=machine.name placeholder=机器名称包含的字符></div></div><div class=\"form-group col-md-3\"><div class=\"input-group fluid-width\"><input type=text class=form-control ng-model=machine.createuser placeholder=创建人全称> <span class=input-group-btn><button type=submit class=\"btn btn-default fluid-width\" ng-click=machine.getMe()>我</button></span></div></div><div class=\"form-group col-md-3\"><div class=\"input-group fluid-width\"><input type=text class=form-control ng-model=machine.inip placeholder=内网IP></div></div><div class=\"form-group col-md-3\"><div class=\"input-group fluid-width\"><input type=text class=form-control ng-model=machine.exip placeholder=外网IP></div></div></div><div class=row style=\"margin-top: 23px\"><div class=\"form-group col-md-3\"><div class=\"input-group fluid-width date\" id=createstart><input type=text class=form-control ng-model=machine.createStart placeholder=开始时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div></div><div class=\"form-group col-md-3\"><div class=\"input-group fluid-width date\" id=createend><input type=text class=form-control ng-model=machine.createEnd placeholder=结束时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div></div></div></form><div class=col-md-10 style=\"padding-top: 20px\"><button class=\"btn btn-primary\" ng-click=machine.reload()><i class=\"fa fa-search fa-fw\"></i>查询</button> <button class=\"btn btn-success\" ng-click=machine.Reset()><i class=\"fa fa-refresh fa-fw\"></i>重置</button></div></div></div></div><div><div style=\"float: right\"><form class=form-inline name=myForm novalidate><div class=form-group ng-init=\"newMachine=\'\'\"><input type=text class=form-control ng-model=newMachine placeholder=\"格式：  机器IP   or    机器名::内网IP::外网IP\" style=\"width: 450px\" required></div><button type=submit ng-disabled=myForm.$invalid class=\"btn btn-primary\" ng-click=machine.createMachine()><i class=\"fa fa-desktop fa-lg\" aria-hidden=true></i>添加机器</button></form></div><div style=\"clear: both\">&nbsp;</div></div><div class=\"panel panel-dark\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-dark\" uib-tooltip=刷新 ng-click=machine.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!machine.loadover}\"></i></button></span><h5>机器列表</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=machine.user_Table class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"ss in $data\"><td data-title=\"\'机器名\'\">{{ss.name}}</td><td data-title=\"\'创建人\'\">{{ss.create_user}}</td><td data-title=\"\'内网IP\'\">{{ss.inip}}</td><td data-title=\"\'外网IP\'\">{{ss.exip}}</td><td data-title=\"\'创建时间\'\">{{ss.create_time}}</td><td data-title=\"\'操作\'\"><button class=\"btn btn-danger btn-sm\" ng-click=machine.delete(ss.id)>删除</button></td></tr></table></div></div></div>");
$templateCache.put("app/pages/business/nodebatch/create.html","<div class=modal-header><h4 class=modal-title>选择服务器</h4></div><div class=modal-body><form class=form-horizontal name=addForm role=form><div class=row ng-if=!createjobgroup.ciid><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">分组名称</label><div class=col-sm-9><input type=text class=form-control name=addGroup ng-minlength=2 ng-model=createjobgroup.postData.name required></div></div></div><div class=row ng-if=!createjobgroup.ciid><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">备注</label><div class=col-sm-9><input type=text class=form-control name=addGroup ng-minlength=2 ng-model=createjobgroup.postData.note required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">分组类型</label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\"><input type=radio ng-model=machineType value=list> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>机器列表</label><label class=\"option option-primary\"><input type=radio ng-model=machineType value=percent> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>百分比</label></div></div></div></div></div><div ng-switch=machineType class=row><div ng-switch-when=list><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">选择机器</label><div class=col-sm-7><div class=admin-form><div class=\"option-group field\"><button class=\"btn btn-primary ng-binding\" ng-click=createjobgroup.choiceServer()>选择第{{choiceServerNum}}批服务器</button> <span>（可以选择，也可以手动输入）</span></div></div></div></div></div><div ng-switch=machineType class=row><div ng-switch-when=list><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">输入机器IP</label><div class=col-sm-9><textarea name=ips id=ips ng-model=createjobgroup.machineList style=\"width: 100%; height: 110px\"></textarea><span>机器列表,用逗号分隔，不同的分批用分号分隔 (如: 1.1.1.1,2.2.2.2;3.3.3.3)</span></div></div></div><div ng-switch-when=percent><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">比例输入</label><div class=col-sm-9><textarea name=ips id=ippercent ng-model=createjobgroup.machinePercent style=\"width: 100%; height: 110px\"></textarea><!--<span>百分比:用冒号分割数字或者百分比( 如: 1:2 or 10%:5% )</span>--><p>1.本节点的百分比用冒号分割数字或者百分比( 如: 1:2 or 10%:5% )</p><p>2.扩展的百分比.每一行是一个大分组；每一行由3段信息组成，用分号分隔（子树id［如：123 、 234 、空字符］，用英文逗号分隔; 机器编号范围［用逗号分隔，用～号标示范围］；百分比，和第一组类型一样）</p><p>如: 123,234;1~100;1:2<br>;1~10,13;2<br>1234;1,3,5;1:10%</p></div></div></div><div ng-switch-when=percent><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">服务器信息</label><div class=col-sm-9><div class=panel-tabs><table ng-table=createjobgroup.macheinInfoTable class=\"table table-hover text-center table-condensed table-bordered\"><thead><tr><th>名称</th><th>类型</th></tr></thead><tbody><tr ng-repeat=\"ss in $data\"><td>{{ss.name}}</td><td>{{ss.type}}</td></tr></tbody></table></div></div></div></div></div></div></form><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-danger\" ng-click=createjobgroup.deleteGroup()>删除并退出</button> <button class=\"btn btn-primary\" ng-disabled=addForm.$invalid ng-click=createjobgroup.saveGroup()>保存</button> <button class=\"btn btn-warning\" ng-click=createjobgroup.cancel()>取消</button></div></div></div>");
$templateCache.put("app/pages/business/nodebatch/log.html","<div><div class=\"panel panel-dark\"><div class=panel-heading><h5>分批编辑日志</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=operation.log_Table class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"ss in $data\"><td data-title=\"\'时间\'\">{{ss.create_time}}</td><td data-title=\"\'操作\'\">{{ss.info}}</td><td data-title=\"\'用户\'\">{{ss.user}}</td></tr></table></div></div></div><div class=\"panel-footer text-right\"><button class=\"btn btn-warning\" ng-click=operation.cancel()>取消</button></div></div>");
$templateCache.put("app/pages/business/nodebatch/nodebatch.html","<div><nodestr></nodestr><hr class=\"mv20 clear\"></div><div><div style=\"float: right\"><form class=form-inline name=myForm novalidate><button type=submit class=\"btn btn-primary\" ng-click=groupindex.createJobGroup()><i class=\"fa fa-object-ungroup fa-lg\" aria-hidden=true></i>新建分批</button></form></div><div style=\"clear: both\">&nbsp;</div></div><div class=\"panel panel-dark\"><div class=panel-heading><span class=panel-controls><!--<button type=\"submit\" class=\"btn btn-dark\" ng-click=\"groupindex.showEditLog()\">日志</button>--> <button class=\"btn btn-dark\" uib-tooltip=刷新 ng-click=groupindex.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!groupindex.loadover}\"></i></button></span><h5>分批列表</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=groupindex.group_Table class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"ss in $data\"><td data-title=\"\'分组名称\'\">{{ss.name}}</td><td data-title=\"\'关联流水线\'\">{{groupindex.ciinfo[ss.name]}}</td><td data-title=\"\'创建时间\'\">{{ss.edit_time}}</td><td data-title=\"\'分组类型\'\">{{ss.group_type}}</td><td data-title=\"\'备注\'\">{{ss.note}}</td><td data-title=\"\'操作\'\"><button class=\"btn btn-system btn-sm\" ng-click=groupindex.showIPlist(ss.id)>机器列表</button> <button class=\"btn btn-primary btn-sm\" ng-click=groupindex.editGroup(ss.id)>编辑</button> <button class=\"btn btn-danger btn-sm\" ng-click=groupindex.deleteGroup(ss.id)>删除</button></td></tr></table></div></div></div>");
$templateCache.put("app/pages/business/nodebatch/shownode.html","<div class=modal-header><h4 class=modal-title>分组机器列表</h4></div><div class=modal-body><form class=form-horizontal name=addForm role=form><div class=row ng-repeat=\"group in showIPstr\"><div class=\"col-sm-12 form-group\"><label class=\"col-sm-2 control-label\">分组{{$index+1}}({{group.num}}台机器):</label><div class=col-sm-9 style=\"padding-top: 10px\"><p ng-repeat=\"ip in group.infos\">{{ip}}</p></div></div></div></form><div class=row><div class=\"col-sm-2 form-group pull-right\"><button class=\"btn btn-warning\" ng-click=showip.cancel()>取消</button></div></div></div>");
$templateCache.put("app/pages/business/nodegroup/createGroup.html","<div class=modal-header><h4 class=modal-title>添加分组</h4></div><div class=modal-body><form class=form-horizontal name=createForm role=form><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">分组名称</label><div class=col-sm-9><input type=text class=form-control name=addGroup placeholder=不少于2字符 ng-minlength=2 ng-model=groupName required> <span style=color:red ng-show=createForm.addGroup.$error.minlength>不少于2字符</span></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">分组类型</label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClick><input type=radio name=src ng-model=selectedType value=machineName ng-click=createGroup.groupInfo()> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>根据机器名分组</label><label class=\"option option-primary\"><input type=radio name=src ng-model=selectedType value=machineType ng-click=createGroup.groupInfo()> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>根据机器类型分组</label></div><table class=\"table table-hover\" ng-show=choiceShow style=\"margin-top: 10px;border: 1px solid #ddd\"><thead><tr><th style=\"text-align: left\">#</th><th style=\"text-align: left\">Name</th><th style=\"text-align: left\">操作</th></tr></thead><tbody><tr ng-repeat=\"ss in choiceResult\"><td>{{$index + 1}}</td><td>{{ss}}</td><td><button ng-click=createGroup.delChoice($index)>删除</button></td></tr></tbody></table></div></div></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=\"createForm.$invalid || !choiceShow\" ng-click=createGroup.save()>创建</button> <button class=\"btn btn-warning\" ng-click=createGroup.cancel()>取消</button></div></div></form></div>");
$templateCache.put("app/pages/business/nodegroup/editGroup.html","<div class=modal-header><h4 class=modal-title>编辑分组</h4></div><div class=modal-body><form class=form-horizontal name=createForm role=form><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">分组名称</label><div class=col-sm-9><input type=text class=form-control name=addGroup placeholder=不少于2字符 ng-minlength=2 ng-model=groupName required> <span style=color:red ng-show=createForm.addGroup.$error.minlength>不少于2字符</span></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">分组类型</label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClick><input type=radio name=src ng-model=selectedType value=machineName ng-click=edit.choiceInfo()> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>根据机器名分组</label><label class=\"option option-primary\"><input type=radio name=src ng-model=selectedType value=machineType ng-click=edit.choiceInfo()> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>根据机器类型分组</label></div><table ng-table=edit.editTable class=\"table table-hover\" style=\"margin-top: 10px;border: 1px solid #ddd\"><thead><tr><th style=\"text-align: left\">#</th><th style=\"text-align: left\">Name</th><th style=\"text-align: left\">操作</th></tr></thead><tbody><tr ng-repeat=\"ss in editTable\"><td>{{$index + 1}}</td><td>{{ss}}</td><td><button ng-click=edit.delChoice($index)>删除</button></td></tr></tbody></table></div></div></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=\"createForm.$invalid || editTable.length == 0\" ng-click=edit.save()>确认修改</button> <button class=\"btn btn-warning\" ng-click=edit.cancel()>取消</button></div></div></form></div>");
$templateCache.put("app/pages/business/nodegroup/nodegroup.html","<div><nodestr></nodestr><hr class=\"mv20 clear\"><div class=\"panel panel-primary\"><div class=panel-heading><h5>查询条件</h5></div><div class=panel-body><div class=form-horizontal><form class=form-inline name=searchForm novalidate><div class=container-fluid><div class=row><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">分组名称：</label><input type=text class=form-control ng-model=group.groupname placeholder=分组名称关键字></div><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">插件名称：</label><input type=text class=form-control ng-model=group.pluginname placeholder=插件名称></div><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">作业名称：</label><input type=text class=form-control ng-model=group.jobname placeholder=作业名称关键字></div></div><div class=row style=\"margin-top: 20px\"><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">创建人：</label><input type=text class=form-control ng-model=group.createuser placeholder=创建人全称> <button type=submit class=\"btn btn-default\" ng-click=group.getMe()>我</button></div><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">编辑人：</label><input type=text class=form-control ng-model=group.edituser placeholder=编辑人全称> <button type=submit class=\"btn btn-default\" ng-click=group.getMe2()>我</button></div></div><div class=row style=\"margin-top: 20px\"><div class=\"form-group col-sm-6\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">创建时间：</label><div style=\"width: 30%\" class=\"input-group date\" id=createstart><input type=text class=form-control ng-model=group.createStart placeholder=开始时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div><span style=\"margin: 0 5px\">-</span><div style=\"width: 30%\" class=\"input-group date\" id=createend><input type=text class=form-control ng-model=group.createEnd placeholder=结束时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div></div><div class=\"form-group col-sm-6\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">修改时间：</label><div style=\"width: 30%\" class=\"input-group date\" id=editstart><input type=text class=form-control ng-model=group.editStart placeholder=开始时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div><span style=\"margin: 0 5px\">-</span><div style=\"width: 30%\" class=\"input-group date\" id=editend><input type=text class=form-control ng-model=group.editEnd placeholder=结束时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div></div></div></div></form><hr class=\"mv20 clear\" style=\"margin-top: 30px!important\"><div class=col-md-10><button class=\"btn btn-primary\" ng-click=group.reload()><i class=\"fa fa-search fa-fw\"></i>查询</button> <button class=\"btn btn-success\" ng-click=group.Reset()><i class=\"fa fa-refresh fa-fw\"></i>重置</button></div></div></div></div></div><div><div style=\"float: right\"><form class=form-inline name=myForm novalidate><button type=submit class=\"btn btn-primary\" ng-click=group.createGroup()><i class=\"fa fa-object-ungroup fa-lg\" aria-hidden=true></i>新建分组</button></form></div><div style=\"clear: both\">&nbsp;</div></div><div class=\"panel panel-dark\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-dark\" uib-tooltip=刷新 ng-click=group.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!group.loadover}\"></i></button></span><h5>分组信息</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=group.group_Table class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"ss in $data\"><td data-title=\"\'分组名称\'\">{{ss.name}}</td><td data-title=\"\'创建人\'\">{{ss.create_user}}</td><td data-title=\"\'plugin\'\">{{ss.plugin}}</td><td data-title=\"\'创建时间\'\">{{ss.create_time}}</td><td data-title=\"\'操作\'\"><button class=\"btn btn-primary btn-sm\" ng-click=group.edit(ss.id)>编辑</button> <button class=\"btn btn-danger btn-sm\" ng-click=group.delete(ss.id)>删除</button></td></tr></table></div></div></div>");
$templateCache.put("app/pages/business/notify/notify.html","<div><nodestr></nodestr><hr class=\"mv20 clear\"><div class=\"panel panel-primary\"><div class=panel-heading><h5>查询条件</h5></div><div class=panel-body><div class=form-horizontal><form class=form-inline name=searchForm novalidate><div class=container-fluid><div class=row><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">通知人名称：</label><input type=text class=form-control ng-model=notify.username placeholder=通知人名称> <button type=submit class=\"btn btn-default\" ng-click=notify.getMe()>我</button></div></div></div></form><hr class=\"mv20 clear\" style=\"margin-top: 30px!important\"><div class=col-md-10><button class=\"btn btn-primary\" ng-click=notify.reload()><i class=\"fa fa-search fa-fw\"></i>查询</button> <button class=\"btn btn-success\" ng-click=notify.Reset()><i class=\"fa fa-refresh fa-fw\"></i>重置</button></div></div></div></div><div><div style=\"float: right\"><form class=form-inline name=myForm novalidate><div class=form-group ng-init=\"newUser=\'\'\"><input type=text class=form-control ng-model=newUser placeholder=添加报警人 required></div><button type=submit ng-disabled=myForm.$invalid class=\"btn btn-primary\" ng-click=notify.createUser()><i class=\"fa fa-user fa-lg\" aria-hidden=true></i>添加报警人</button></form></div><div style=\"clear: both\">&nbsp;</div></div><div class=\"panel panel-dark\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-dark\" uib-tooltip=刷新 ng-click=notify.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!notify.loadover}\"></i></button></span><h5>通知用户</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=notify.notify_Table class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"ss in $data\"><td data-title=\"\'账户名\'\">{{ss.user}}</td><td data-title=\"\'创建人\'\">{{ss.create_user}}</td><td data-title=\"\'创建时间\'\">{{ss.create_time}}</td><td data-title=\"\'操作\'\"><button class=\"btn btn-primary btn-sm\" ng-click=notify.delete(ss.id)>删除</button></td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/business/scripts/script.html","<div><div class=\"pull-left mb10\"><h4>{{scripts.nodeStr}}</h4></div><hr class=\"mv20 clear\"><div class=\"panel panel-primary\"><div class=panel-heading><h5>查询条件</h5></div><div class=panel-body><div class=form-horizontal><form class=form-inline name=searchForm novalidate><div class=container-fluid><div class=row><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">脚本名称：</label><input type=text class=form-control ng-model=scripts.scriptname placeholder=脚本名称关键字></div><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">创建人：</label><input type=text class=form-control ng-model=scripts.createuser placeholder=创建人全称> <button type=submit class=\"btn btn-default\" ng-click=scripts.getMe()>我</button></div><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">编辑人：</label><input type=text class=form-control ng-model=scripts.edituser placeholder=编辑人全称></div></div><div class=row style=\"margin-top: 23px\"><div class=\"form-group col-sm-6\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">创建时间：</label><div style=\"width: 30%\" class=\"input-group date\" id=createstart><input type=text class=form-control ng-model=scripts.createStart placeholder=开始时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div><span style=\"margin: 0 5px\">-</span><div style=\"width: 30%\" class=\"input-group date\" id=createend><input type=text class=form-control ng-model=scripts.createEnd placeholder=结束时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div></div><div class=\"form-group col-sm-6\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">修改时间：</label><div style=\"width: 30%\" class=\"input-group date\" id=editstart><input type=text class=form-control ng-model=scripts.editStart placeholder=开始时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div><span style=\"margin: 0 5px\">-</span><div style=\"width: 30%\" class=\"input-group date\" id=editend><input type=text class=form-control ng-model=scripts.editEnd placeholder=结束时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div></div></div></div></form><hr class=\"mv20 clear\" style=\"margin-top: 50px!important\"><div class=col-md-10><button class=\"btn btn-primary\" ng-click=scripts.reload()><i class=\"fa fa-search fa-fw\"></i>查询</button> <button class=\"btn btn-success\" ng-click=scripts.Reset(scripts)><i class=\"fa fa-refresh fa-fw\"></i>重置</button></div></div></div></div><div style=\"padding: 10px 0\"><button class=\"btn btn-primary\" ng-click=scripts.createScript()><i class=\"fa fa-clone fa-fw\"></i>新建脚本</button></div><div class=\"panel panel-dark\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-dark\" uib-tooltip=刷新 ng-click=scripts.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!scripts.loadover}\"></i></button></span><h5>脚本信息</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=scripts.data_Table class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"ss in $data\"><td data-title=\"\'脚本名称\'\">{{ss.name}}</td><td data-title=\"\'类型\'\">{{ss.type}}</td><td data-title=\"\'创建用户\'\">{{ss.create_user}}</td><td data-title=\"\'创建时间\'\">{{ss.create_time}}</td><td data-title=\"\'修改用户\'\">{{ss.edit_user}}</td><td data-title=\"\'最后修改时间\'\">{{ss.edit_time}}</td><td data-title=\"\'关联作业\'\">{{ss.jobname}}</td><td data-title=\"\'操作\'\"><button ng-if=\"ss.projectid == scripts.treeid\" class=\"btn btn-warning btn-sm\" ng-click=scripts.editScript(ss.id)>编辑</button> <button class=\"btn btn-primary btn-sm\" ng-click=scripts.runScript(ss.id)>执行</button> <button ng-if=\"ss.projectid ==scripts.treeid\" class=\"btn btn-danger btn-sm\" ng-click=\"scripts.delete(ss.id, ss.jobname)\">删除</button></td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/business/user/user.html","<div><nodestr></nodestr><hr class=\"mv20 clear\"><div class=\"panel panel-primary\"><div class=panel-heading><h5>查询条件</h5></div><div class=panel-body><div class=form-horizontal><form class=form-inline name=searchForm novalidate><div class=container-fluid><div class=row><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">账户名称：</label><input type=text class=form-control ng-model=user.username placeholder=账户关键字></div><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">创建人：</label><input type=text class=form-control ng-model=user.createuser placeholder=创建人全称> <button type=submit class=\"btn btn-default\" ng-click=user.getMe()>我</button></div></div><div class=row style=\"margin-top: 23px\"><div class=\"form-group col-sm-6\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">创建时间：</label><div style=\"width: 30%\" class=\"input-group date\" id=createstart><input type=text class=form-control ng-model=user.createStart placeholder=开始时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div><span style=\"margin: 0 5px\">-</span><div style=\"width: 30%\" class=\"input-group date\" id=createend><input type=text class=form-control ng-model=user.createEnd placeholder=结束时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div></div></div></div></form><hr class=\"mv20 clear\" style=\"margin-top: 55px!important\"><div class=col-md-10><button class=\"btn btn-primary\" ng-click=user.reload()><i class=\"fa fa-search fa-fw\"></i>查询</button> <button class=\"btn btn-success\" ng-click=user.Reset()><i class=\"fa fa-refresh fa-fw\"></i>重置</button></div></div></div></div></div><div><div style=\"float: right\"><form class=form-inline name=myForm novalidate><div class=form-group ng-init=\"newUser=\'\'\"><input type=text class=form-control ng-model=newUser placeholder=新建账户名 required> <span></span></div><button type=submit class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=user.createUser()><i class=\"fa fa-user-circle-o fa-lg\" aria-hidden=true></i>新建账户</button></form></div><div style=\"clear: both\">&nbsp;</div></div><div class=\"panel panel-dark\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-dark\" uib-tooltip=刷新 ng-click=user.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!user.loadover}\"></i></button></span><h5>账户信息</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=user.user_Table class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"ss in $data\"><td data-title=\"\'账户名\'\">{{ss.username}}</td><td data-title=\"\'创建人\'\">{{ss.create_user}}</td><td data-title=\"\'创建时间\'\">{{ss.create_time}}</td><td data-title=\"\'操作\'\"><button class=\"btn btn-primary btn-sm\" ng-disabled=\"ss.projectid == 0 && user.treeid != 0\" ng-click=user.delete(ss.id)>删除</button></td></tr></table></div></div></div>");
$templateCache.put("app/pages/business/variate/variate.html","<!--<cmloading ng-if=\"variate.isLoading\"></cmloading>--><!--<div ng-if=\"!variate.isLoading\">--><div style=\"background-color: #fff\"><div class=row style=\"padding: 0 20px 0\"><nodestr></nodestr></div><hr class=\"mv10 clear\"><div class=\"panel panel-dark\"><div class=panel-heading><h5>变量信息</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=variate.data_Table class=\"table table-hover text-center table-condensed\"><thead><th ng-repeat=\"item in heads\">{{item}}</th><th>删除</th></thead><tr ng-repeat=\"ss in $data\"><td ng-repeat=\"item in ss track by $index\">{{item}}</td><td><a class=\"fa fa-close fa-fw\" ng-click=variate.delete(ss) style=\"color: red\"></a></td></tr></table></div></div><dataerror ng-hide=dataready errmsg={{dataerror}}></dataerror></div></div>");
$templateCache.put("app/pages/global/auditlog/auditlog.html","<div><div class=\"panel panel-primary\"><div class=panel-heading><h5>查询条件</h5></div><div class=panel-body><div class=form-horizontal><form class=form-inline name=searchForm novalidate><div class=container-fluid><div class=row><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">时间：</label><input type=text class=form-control ng-model=auditlog.time placeholder=\"2021-04-09 11:12\"></div><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">用户：</label><input type=text class=form-control ng-model=auditlog.user placeholder=用户名></div><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">标题：</label><input type=text class=form-control ng-model=auditlog.title placeholder=标题></div><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">内容：</label><input type=text class=form-control ng-model=auditlog.content placeholder=内容></div></div></div></form><hr class=\"mv20 clear\" style=\"margin-top: 30px!important\"><div class=col-md-10><button class=\"btn btn-primary\" ng-click=auditlog.reload()><i class=\"fa fa-search fa-fw\"></i>查询</button> <button class=\"btn btn-success\" ng-click=auditlog.Reset()><i class=\"fa fa-refresh fa-fw\"></i>重置</button></div></div></div></div><div class=\"panel panel-dark\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-dark\" uib-tooltip=刷新 ng-click=auditlog.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!auditlog.loadover}\"></i></button></span><h5>审计日志</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=auditlog.auditlogTable class=\"table table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"d in $data\"><td data-title=\"\'时间\'\" filter=\"{ time: \'text\'}\" sortable>{{d.time}}</td><td data-title=\"\'用户\'\" filter=\"{ user: \'text\'}\" sortable>{{d.user}}</td><td data-title=\"\'标题\'\" filter=\"{ title: \'text\'}\" sortable>{{d.title}}</td><td data-title=\"\'具体内容\'\" filter=\"{ content: \'text\'}\" sortable>{{d.content}}</td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/global/images/createImages.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=createimages.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>{{createimages.title}}</h5></div><div class=panel-body><div class=pt20><div><div class=\"form-group admin-form\"><form class=form-horizontal name=myForm novalidate><div class=row ng-show=\"createimages.title==\'编辑镜像\'\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">编号</label><div class=col-sm-9><input type=text disabled class=form-control name=addGroup ng-minlength=2 ng-model=createimages.postData.id></div></div></div><div class=row ng-show=!createimages.ciid><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">名称</label><div class=col-sm-9><input type=text class=form-control name=addGroup ng-minlength=2 ng-model=createimages.postData.name required></div></div></div><div class=row ng-show=!createimages.ciid><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">描述</label><div class=col-sm-9><input type=text class=form-control name=addGroup ng-minlength=2 ng-model=createimages.postData.describe required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">授权</label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\"><input type=radio ng-model=createimages.postData.share value=false> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>私人</label><label class=\"option option-primary\"><input type=radio ng-model=createimages.postData.share value=true> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>共享给我的组织</label></div></div></div></div></div><div ng-if=createimages.imagesid class=row><hr><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">镜像文件信息</label><label ng-if=\"createimages.uploadstatus.status==\'1\'\" class=\"col-sm-9 control-label\" style=\"text-align: left\">上传时间:{{createimages.uploadstatus.time}} 镜像大小:{{createimages.bytesToSize(createimages.uploadstatus.size)}}</label><div ng-if=\"createimages.uploadstatus.status==\'0\'\" class=col-sm-9><div class=admin-form><div class=\"option-group field\"><div><input type=file class=newFile id=choicefilesx style=\"display: none\" onchange=angular.element(this).scope().upForm() multiple> <input type=hidden name=newFileMsg data-name=\"\"> <button class=\"btn btn-primary\" ng-click=createimages.clickImport()><span class=\"glyphicon glyphicon-upload\" style=\"padding: 0 3px\"></span>上传镜像</button> <a class=\"glyphicon glyphicon-question-sign\" data-toggle=tooltip data-placement=right target=_blank ng-href=/book/我的镜像/ uib-tooltip=看镜像生成方式 aria-hidden=true style=\"padding-top: 11px;font-size: larger\">查看镜像生成方式</a></div><div style=\"display: none\" id=upload_progressBar_Module><div class=progress><div class=progress-bar id=upload_progressBar role=progressbar aria-valuemin=0 aria-valuemax=100 aria-valuenow=0 style=width:0></div></div><span id=percentage></span><span id=time></span></div></div></div></div></div></div><div ng-if=createimages.imagesid class=row><hr><div class=panel-body><div style=\"padding: 10px\"><span style=\"font-size: 14px;font-weight: bold; color: #626262\">1. 安装AGENT:</span> <span style=\"color: red\">curl -L {{createimages.siteaddr}}/api/scripts/installAgent.sh |sudo OPEN_C3_ADDR={{createimages.siteaddr}} bash</span></div></div><div class=panel-body><div style=\"padding: 10px\"><span style=\"font-size: 14px;font-weight: bold; color: #626262\">2. 添加公钥:</span> <span style=\"color: red\">wget {{createimages.siteaddr}}/api/ci/images/{{createimages.imagesid}}/sshkey.pub -O /opt/mydan/etc/agent/auth/c3_ci_{{createimages.imagesid}}.pub</span></div></div></div><div class=row ng-show=\"createimages.type!=\'show\'\"><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=\"!( createimages.postData.describe && createimages.postData.name )\" ng-click=createimages.saveImages()>保存镜像</button></div></div></form></div></div></div></div></div></div>");
$templateCache.put("app/pages/global/images/images.html","<div><div><div style=\"float: right\"><form class=form-inline name=myForm novalidate><button type=submit ng-disabled=myForm.$invalid class=\"btn btn-primary\" ng-click=images.createImages()><i class=\"fa fa-cube fa-lg\" aria-hidden=true></i>新建镜像</button></form></div><div style=\"clear: both\">&nbsp;</div></div><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=images.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!images.loadover}\"></i></button></span><h5>镜像</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=images.group_Table class=\"table table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"d in $data\"><td style=\"width: 10%\" data-title=\"\'镜像名称\'\" filter=\"{ name: \'text\'}\" sortable>{{d.name}}</td><td style=\"width: 10%\" data-title=\"\'创建时间\'\" filter=\"{ edit_time: \'text\'}\" sortable>{{d.edit_time}}</td><td style=\"width: 10%\" data-title=\"\'最后编辑人\'\" filter=\"{ edit_user: \'text\'}\" sortable>{{d.edit_user}}</td><td style=\"width: 10%\" data-title=\"\'备注\'\" filter=\"{ describe: \'text\'}\" sortable>{{d.describe}}</td><td style=\"width: 10%\" data-title=\"\'操作\'\"><button class=\"btn btn-primary btn-sm\" ng-disabled=\"d.self==0\" ng-click=images.editImages(d.id)>编辑</button> <button class=\"btn btn-danger btn-sm\" ng-disabled=\"d.self==0\" ng-click=images.deleteImages(d.id)>删除</button></td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/global/monitor/monitor.html","<div><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=monitor.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!monitor.loadover}\"></i></button></span><h5>系统监控信息</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=monitor.monitorTable class=\"table table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"d in $data\"><td data-title=\"\'时间\'\" filter=\"{ time: \'text\'}\" sortable>{{d.time}}</td><td data-title=\"\'监控对象\'\" filter=\"{ host: \'text\'}\" sortable>{{d.host}}</td><td data-title=\"\'状态\'\" filter=\"{ stat: \'text\'}\" sortable><span ng-if=\"d.stat==\'ok\' || d.stat==\'healthy\'\" style=\"color: green\">{{d.stat}}</span> <span ng-if=\"d.stat!=\'ok\' && d.stat!=\'healthy\'\">{{d.stat}}</span></td><td data-title=\"\'类型\'\" filter=\"{ type: \'text\'}\" sortable>{{d.type}}</td><td data-title=\"\'监控指标\'\" filter=\"{ key: \'text\'}\" sortable>{{d.key}}</td><td data-title=\"\'值\'\" filter=\"{ val: \'text\'}\" sortable>{{d.val}}</td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/global/notify/notify.html","<div><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=保存 ng-click=notify.save()><i class=\"fa fa-floppy-o\" aria-hidden=true></i></button> <button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=notify.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!notify.loadover}\"></i></button></span><h5>通知出口开关设置</h5></div><div class=panel-body><div class=form-horizontal><!-- tag 匹配规则 --><div class=container-fluid><div class=row><table class=\"table table-bordered\" style=\"text-align: center\"><thead><tr class=notice-bg><th colspan=2 class=right-bor style=\"text-align: center\">分类</th><th class=right-bor style=\"text-align: center\"><label for=email class=\"notice-top allmes\">邮件<input type=checkbox ng-model=emailall id=email ng-click=notify.checkAllEmail()></label></th><th class=right-bor style=\"text-align: center\"><label for=sms class=\"notice-top allout\" style=\"text-align: center\">短信<input type=checkbox ng-model=smsall id=sms ng-click=notify.checkAllSms()></label></th></tr></thead><tbody><tr><td rowspan=3 class=\"right-bor line\">页面执行作业</td><td class=right-bor>执行成功</td><td class=right-bor><input type=checkbox check-class=email ng-model=isPageSuccessEmail name=isPageSuccessEmail></td><td class=right-bor><input type=checkbox check-class=sms ng-model=isPageSuccessSms name=isPageSuccessSms></td></tr><tr><td class=right-bor>执行失败</td><td class=right-bor><label class=notice-top><input type=checkbox check-class=email ng-model=isPageFailEmail name=isPageFailEmail></label></td><td class=right-bor><label class=notice-top><input type=checkbox check-class=sms ng-model=isPageFailSms name=isPageFailSms></label></td></tr><tr><td class=right-bor>等待用户</td><td class=right-bor><label class=notice-top><input type=checkbox check-class=email ng-model=isPageWaitingEmail name=isPageWaitingEmail></label></td><td class=right-bor><label class=notice-top><input type=checkbox check-class=sms ng-model=isPageWaitingSms name=isPageWaitingSms></label></td></tr><tr><td rowspan=3 class=\"right-bor line\">分组启动作业</td><td class=right-bor>执行成功</td><td class=right-bor><label class=notice-top><input type=checkbox check-class=email ng-model=isApiSuccessEmail name=isApiSuccessEmail></label></td><td class=right-bor><label class=notice-top><input type=checkbox check-class=sms ng-model=isApiSuccessSms name=isApiSuccessSms></label></td></tr><tr><td class=right-bor>执行失败</td><td class=right-bor><label class=notice-top><input type=checkbox check-class=email ng-model=isApiFailEmail name=isApiFailEmail></label></td><td class=right-bor><label class=notice-top><input type=checkbox check-class=sms ng-model=isApiFailSms name=isApiFailSms></label></td></tr><tr><td class=right-bor>等待用户</td><td class=right-bor><label class=notice-top><input type=checkbox check-class=email ng-model=isApiWaitingEmail name=isApiWaitingEmail></label></td><td class=right-bor><label class=notice-top><input type=checkbox check-class=sms ng-model=isApiWaitingSms name=isApiWaitingSms></label></td></tr><tr><td rowspan=3 class=\"right-bor line\">定时启动作业</td><td class=right-bor>执行成功</td><td class=right-bor><label class=notice-top><input type=checkbox check-class=email ng-model=isCrontabSuccessEmail name=isCrontabSuccessEmail></label></td><td class=right-bor><label class=notice-top><input type=checkbox check-class=sms ng-model=isCrontabSuccessSms name=isCrontabSuccessSms></label></td></tr><tr><td class=right-bor>执行失败</td><td class=right-bor><label class=notice-top><input type=checkbox check-class=email ng-model=isCrontabFailEmail name=isCrontabFailEmail></label></td><td class=right-bor><label class=notice-top><input type=checkbox check-class=sms ng-model=isCrontabFailSms name=isCrontabFailSms></label></td></tr><tr><td class=right-bor>等待用户</td><td class=right-bor><label class=notice-top><input type=checkbox check-class=email ng-model=isCrontabWaitingEmail name=isCrontabWaitingEmail></label></td><td class=right-bor><label class=notice-top><input type=checkbox check-class=sms ng-model=isCrontabWaitingSms name=isCrontabWaitingSms></label></td></tr><tr><td rowspan=2 class=\"right-bor line\">构建任务</td><td class=right-bor>执行成功</td><td class=right-bor><label class=notice-top><input type=checkbox check-class=email ng-model=isCiSuccessEmail name=isCiSuccessEmail></label></td><td class=right-bor><label class=notice-top><input type=checkbox check-class=sms ng-model=isCiSuccessSms name=isCiSuccessSms></label></td></tr><tr><td class=right-bor>执行失败</td><td class=right-bor><label class=notice-top><input type=checkbox check-class=email ng-model=isCiFailEmail name=isCiFailEmail></label></td><td class=right-bor><label class=notice-top><input type=checkbox check-class=sms ng-model=isCiFailSms name=isCiFailSms></label></td></tr><tr><td rowspan=1 class=\"right-bor line\">审批</td><td class=right-bor>审批事件</td><td class=right-bor><label class=notice-top><input type=checkbox check-class=email ng-model=isApprovalSuccessEmail name=isApprovalSuccessEmail></label></td><td class=right-bor><label class=notice-top><input type=checkbox check-class=sms ng-model=isApprovalSuccessSms name=isApprovalSuccessSms></label></td></tr></tbody></table></div></div></div></div></div></div>");
$templateCache.put("app/pages/global/private/create.html","<div class=modal-header><h4 class=modal-title>添加用户</h4></div><div class=modal-body><form class=form-horizontal name=myForm role=form><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">用户</label><div class=col-sm-9><input type=text class=form-control name=adduser placeholder=用户 ng-model=privatecreate.postdata.user required></div></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=privatecreate.add()>确认</button> <button class=\"btn btn-warning\" ng-click=privatecreate.cancel()>取消</button></div></div></form></div>");
$templateCache.put("app/pages/global/private/private.html","<div class=\"row block\"><h2>私有节点管理</h2><hr class=\"mv20 clear\"><div><div style=\"float: right\"><form class=form-inline name=myForm novalidate><button type=submit class=\"btn btn-primary\" style=\"padding: 10px 25px\" ng-click=private.createPrivate()><i class=\"fa fa-plusecircle fa-lg\" aria-hidden=true></i> 添加用户</button></form></div><div style=\"clear: both\">&nbsp;</div></div><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=private.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!private.loadover}\"></i></button></span><h5>用户</h5></div><div class=panel-body><div class=pt20 style=\"overflow: auto\"><table ng-table=private.dataTable class=\"table table-scroll table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td width=60 class=textcenter data-title=\"\'ID\'\" filter=\"{ id: \'text\'}\" sortable>{{m.id}}</td><td data-title=\"\'用户\'\" width=80 filter=\"{ user: \'text\'}\" sortable>{{m.user}}</td><td data-title=\"\'添加操作人\'\" width=80 filter=\"{ edit_user: \'text\'}\" sortable>{{m.edit_user}}</td><td data-title=\"\'添加时间\'\" width=80 filter=\"{ edit_time: \'text\'}\" sortable>{{m.edit_time}}</td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-edit fa-2x\" aria-hidden=true ui-sref=\"home.business.machine({treeid: {{m.id}}})\" uib-tooltip=机器管理 style=cursor:pointer>管理机器</i></td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/global/template/template.html","<div><uib-tabset><uib-tab><uib-tab-heading>作业任务通知模版</uib-tab-heading><br><br><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=复制模版 ng-click=template.emailSet()><i class=\"fa fa-clone\" aria-hidden=true></i></button> <button class=\"btn btn-primary\" uib-tooltip=保存 ng-click=template.emailSave()><i class=\"fa fa-floppy-o\" aria-hidden=true></i></button> <button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=template.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!template.loadover}\"></i></button></span><h5 style=\"font-weight: bold\">邮件模板</h5></div><div class=panel-body><form class=form-horizontal name=templateForm role=form novalidate><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">邮件标题：</label><div class=col-sm-9><input type=text class=form-control ng-model=template.environment.notifyTemplateEmailTitle></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">邮件内容：</label><div class=col-sm-9><textarea style=\"height: 250px\" class=fluid-width ng-model=template.environment.notifyTemplateEmailContent id=emailDetail></textarea></div></div></div></form></div></div><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=复制模版 ng-click=template.smsSet()><i class=\"fa fa-clone\" aria-hidden=true></i></button> <button class=\"btn btn-primary\" uib-tooltip=保存 ng-click=template.smsSave()><i class=\"fa fa-floppy-o\" aria-hidden=true></i></button> <button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=template.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!template.loadover}\"></i></button></span><h5 style=\"font-weight: bold\">短信模板</h5></div><div class=panel-body><form class=form-horizontal name=templateForm role=form novalidate><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">短信内容：</label><div class=col-sm-9><textarea style=\"height: 150px\" class=fluid-width ng-model=template.environment.notifyTemplateSmsContent></textarea></div></div></div></form></div></div></uib-tab><uib-tab><uib-tab-heading>构建通知模版</uib-tab-heading><br><br><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=复制模版 ng-click=template.emailCiSet()><i class=\"fa fa-clone\" aria-hidden=true></i></button> <button class=\"btn btn-primary\" uib-tooltip=保存 ng-click=template.emailCiSave()><i class=\"fa fa-floppy-o\" aria-hidden=true></i></button> <button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=template.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!template.loadover}\"></i></button></span><h5 style=\"font-weight: bold\">邮件模板</h5></div><div class=panel-body><form class=form-horizontal name=templateForm role=form novalidate><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">邮件标题：</label><div class=col-sm-9><input type=text class=form-control ng-model=template.environment.ciTemplateEmailTitle></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">邮件内容：</label><div class=col-sm-9><textarea style=\"height: 250px\" class=fluid-width ng-model=template.environment.ciTemplateEmailContent id=emailDetail></textarea></div></div></div></form></div></div><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=复制模版 ng-click=template.smsCiSet()><i class=\"fa fa-clone\" aria-hidden=true></i></button> <button class=\"btn btn-primary\" uib-tooltip=保存 ng-click=template.smsCiSave()><i class=\"fa fa-floppy-o\" aria-hidden=true></i></button> <button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=template.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!template.loadover}\"></i></button></span><h5 style=\"font-weight: bold\">短信模板</h5></div><div class=panel-body><form class=form-horizontal name=templateForm role=form novalidate><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">短信内容：</label><div class=col-sm-9><textarea style=\"height: 150px\" class=fluid-width ng-model=template.environment.ciTemplateSmsContent></textarea></div></div></div></form></div></div></uib-tab><uib-tab><uib-tab-heading>审批通知模版</uib-tab-heading><br><br><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=复制模版 ng-click=template.emailApprovalSet()><i class=\"fa fa-clone\" aria-hidden=true></i></button> <button class=\"btn btn-primary\" uib-tooltip=保存 ng-click=template.emailApprovalSave()><i class=\"fa fa-floppy-o\" aria-hidden=true></i></button> <button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=template.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!template.loadover}\"></i></button></span><h5 style=\"font-weight: bold\">邮件模板</h5></div><div class=panel-body><form class=form-horizontal name=templateForm role=form novalidate><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">邮件标题：</label><div class=col-sm-9><input type=text class=form-control ng-model=template.environment.approvalTemplateEmailTitle></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">邮件内容：</label><div class=col-sm-9><textarea style=\"height: 250px\" class=fluid-width ng-model=template.environment.approvalTemplateEmailContent id=emailDetail></textarea></div></div></div></form></div></div><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=复制模版 ng-click=template.smsApprovalSet()><i class=\"fa fa-clone\" aria-hidden=true></i></button> <button class=\"btn btn-primary\" uib-tooltip=保存 ng-click=template.smsApprovalSave()><i class=\"fa fa-floppy-o\" aria-hidden=true></i></button> <button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=template.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!template.loadover}\"></i></button></span><h5 style=\"font-weight: bold\">短信模板</h5></div><div class=panel-body><form class=form-horizontal name=templateForm role=form novalidate><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-2 control-label\">短信内容：</label><div class=col-sm-9><textarea style=\"height: 150px\" class=fluid-width ng-model=template.environment.approvalTemplateSmsContent></textarea></div></div></div></form></div></div></uib-tab></uib-tabset></div>");
$templateCache.put("app/pages/global/ticket/createTicket.html","<cmloading ng-if=createticket.loading></cmloading><div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=createticket.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>{{createticket.title}}</h5></div><div class=panel-body><div class=pt20><div><div class=\"form-group admin-form\"><form class=form-horizontal name=myForm novalidate><div class=row ng-if=!createticket.ciid><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">名称</label><div class=col-sm-9><input type=text class=form-control name=addGroup ng-minlength=2 ng-model=createticket.postData.name required></div></div></div><div class=row ng-if=!createticket.ciid><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">描述</label><div class=col-sm-9><input type=text class=form-control name=addGroup ng-minlength=2 ng-model=createticket.postData.describe required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">授权</label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\"><input type=radio ng-model=createticket.postData.share value=P> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅个人可见</label><label class=\"option option-primary\"><input type=radio ng-model=createticket.postData.share value=T> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>读写共享给组内人员</label><label class=\"option option-primary\"><input type=radio ng-model=createticket.postData.share value=O> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>高级共享配置</label></div></div></div></div></div><div class=row ng-if=\"createticket.postData.share===\'O\'\"><div><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">共享组</label><div class=col-sm-4><textarea ng-model=createticket.postData.share_T style=\"width: 100%; height: 110px\"></textarea><span>读写权限</span></div><label class=\"col-sm-1 control-label\"></label><div class=col-sm-4><textarea ng-model=createticket.postData.share_TR style=\"width: 100%; height: 110px\"></textarea><span>只读权限</span></div></div></div></div><div class=row ng-if=\"createticket.postData.share===\'O\'\"><div><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">用户共享</label><div class=col-sm-4><textarea ng-model=createticket.postData.share_P style=\"width: 100%; height: 110px\"></textarea><span>读写权限</span></div><label class=\"col-sm-1 control-label\"></label><div class=col-sm-4><textarea ng-model=createticket.postData.share_PR style=\"width: 100%; height: 110px\"></textarea><span>只读权限</span></div></div></div></div><div ng-if=!createticket.point class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">类型</label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\"><input type=radio ng-model=createticket.postData.type value=SSHKey> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>SSH Key</label><label class=\"option option-primary\"><input type=radio ng-model=createticket.postData.type value=UsernamePassword> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>用户名密码</label><label class=\"option option-primary\"><input type=radio ng-model=createticket.postData.type value=JobBuildin> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>插件</label><label class=\"option option-primary\"><input type=radio ng-model=createticket.postData.type value=KubeConfig> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>KubeConfig</label><label class=\"option option-primary\"><input type=radio ng-model=createticket.postData.type value=Harbor> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>Harbor镜像仓库</label></div></div></div></div></div><div ng-switch=createticket.postData.type class=row><div ng-if=\"createticket.postData.type==\'SSHKey\'\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">SSH Key</label><div class=col-sm-9><textarea ng-model=createticket.postData.ticket.SSHKey style=\"width: 100%; height: 110px\"></textarea><span>SSH Key 适用于git</span></div></div></div><div ng-if=\"createticket.postData.type==\'UsernamePassword\'\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">用户名</label><div class=col-sm-3><input ng-model=createticket.postData.ticket.Username></div><label class=\"col-sm-3 control-label\">密码</label><div class=col-sm-3><input ng-model=createticket.postData.ticket.Password></div></div></div></div><div ng-if=\"createticket.postData.type==\'JobBuildin\'\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">内容</label><div class=col-sm-9><textarea ng-model=createticket.postData.ticket.JobBuildin style=\"width: 100%; height: 110px\"></textarea><span>适用于作业内建插件或者构建触发脚本</span></div></div></div><div ng-if=\"createticket.postData.type==\'KubeConfig\'\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">kubectl版本</label><div class=col-sm-9><select id=selectednameval class=form-control ng-model=createticket.postData.ticket.kubectlVersion><option value=v0.0.0>默认版本</option><option ng-repeat=\"x in createticket.kubectlVersion\" value={{x}}>{{x}}</option></select></div></div><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">内容</label><div class=col-sm-9><textarea ng-model=createticket.postData.ticket.KubeConfig style=\"width: 100%; height: 110px\"></textarea><span>~/.kube/config文件内容</span></div></div></div><div ng-if=\"createticket.postData.type==\'Harbor\'\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">服务地址</label><div class=col-sm-9><input style=\"width: 100%\" ng-model=createticket.postData.ticket.Server></div></div><div class=\"col-sm-10 form-group\"><label class=\"col-sm-1 control-label\"></label><label class=\"col-sm-9 control-label\">例:https://harbor.xxx.org/api/v2.0/search</label></div><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">用户名</label><div class=col-sm-3><input ng-model=createticket.postData.ticket.Username></div></div><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">密码</label><div class=col-sm-3><input ng-model=createticket.postData.ticket.Password></div></div></div></form></div><div class=row ng-show=\"createticket.type!=\'show\'\"><div class=\"col-sm-5 form-group pull-right\"><button ng-if=\"createticket.postData.type==\'KubeConfig\'\" class=\"btn btn-info\" ng-disabled=myForm.$invalid ng-click=createticket.connectiontest()>连接测试</button> <button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=createticket.saveTicket()>保存凭据</button></div></div></div></div></div></div></div>");
$templateCache.put("app/pages/global/ticket/ticket.html","<div><div><div style=\"float: right\"><form class=form-inline name=myForm novalidate><button type=submit ng-disabled=myForm.$invalid class=\"btn btn-primary\" ng-click=ticket.createTicket()><i class=\"fa fa-key fa-lg\" aria-hidden=true></i>新建凭据</button></form></div><div style=\"clear: both\">&nbsp;</div></div><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=ticket.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!ticket.loadover}\"></i></button></span><h5>凭据</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=ticket.group_Table class=\"table table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"d in $data\"><td style=\"width: 10%\" data-title=\"\'凭据名称\'\" filter=\"{ name: \'text\'}\" sortable>{{d.name}}</td><td style=\"width: 10%\" data-title=\"\'创建时间\'\" filter=\"{ edit_time: \'text\'}\" sortable>{{d.edit_time}}</td><td style=\"width: 10%\" data-title=\"\'类型\'\" filter=\"{ type: \'text\'}\" sortable>{{d.type}}</td><td style=\"width: 10%\" data-title=\"\'最后编辑人\'\" filter=\"{ edit_user: \'text\'}\" sortable>{{d.edit_user}}</td><td style=\"width: 10%\" data-title=\"\'备注\'\" filter=\"{ describe: \'text\'}\" sortable>{{d.describe}}</td><td style=\"width: 10%\" data-title=\"\'操作\'\"><button class=\"btn btn-info btn-sm\" ng-click=ticket.showTicket(d.id)>查看</button> <button class=\"btn btn-primary btn-sm\" ng-disabled=\"d.self==0\" ng-click=ticket.editTicket(d.id)>编辑</button> <button class=\"btn btn-danger btn-sm\" ng-disabled=\"d.self==0\" ng-click=ticket.deleteTicket(d.id)>删除</button></td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/global/useraddr/create.html","<div class=modal-header><h4 class=modal-title>添加用户地址簿</h4></div><div class=modal-body><form class=form-horizontal name=myForm role=form><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">用户</label><div class=col-sm-9><input type=text class=form-control name=adduser placeholder=用户 ng-model=useraddrcreate.postdata.user required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">邮箱地址</label><div class=col-sm-9><input type=text class=form-control name=adduser placeholder=邮箱地址 ng-model=useraddrcreate.postdata.email required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">手机号</label><div class=col-sm-9><input type=text class=form-control name=adduser placeholder=手机号 ng-model=useraddrcreate.postdata.phone required></div></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=useraddrcreate.add()>确认</button> <button class=\"btn btn-warning\" ng-click=useraddrcreate.cancel()>取消</button></div></div></form></div>");
$templateCache.put("app/pages/global/useraddr/useraddr.html","<div class=\"row block\"><h2>用户地址簿管理</h2><hr class=\"mv20 clear\"><div><div style=\"float: right\"><form class=form-inline name=myForm novalidate><button type=submit class=\"btn btn-primary\" style=\"padding: 10px 25px\" ng-click=useraddr.createUseraddr()><i class=\"fa fa-plusecircle fa-lg\" aria-hidden=true></i> 添加通信地址</button></form></div><div style=\"clear: both\">&nbsp;</div></div><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=useraddr.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!useraddr.loadover}\"></i></button></span><h5>地址簿</h5></div><div class=panel-body><div class=pt20 style=\"overflow: auto\"><table ng-table=useraddr.dataTable class=\"table table-scroll table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td width=60 class=textcenter data-title=\"\'ID\'\" filter=\"{ id: \'text\'}\" sortable>{{m.id}}</td><td data-title=\"\'用户\'\" width=80 filter=\"{ user: \'text\'}\" sortable>{{m.user}}</td><td data-title=\"\'邮箱地址\'\" width=80 filter=\"{ email: \'text\'}\" sortable>{{m.email}}</td><td data-title=\"\'手机号\'\" width=80 filter=\"{ phone: \'text\'}\" sortable>{{m.phone}}</td><td data-title=\"\'最后编辑人\'\" width=80 filter=\"{ edit_user: \'text\'}\" sortable>{{m.edit_user}}</td><td data-title=\"\'更新时间\'\" width=80 filter=\"{ edit_time: \'text\'}\" sortable>{{m.edit_time}}</td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-times-circle fa-2x\" aria-hidden=true ng-click=useraddr.deleteUseraddr(m.id) uib-tooltip=删除 style=\"cursor:pointer;color: red\"></i></td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/global/versionlog/versionlog.html","<div><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=versionlog.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!versionlog.loadover}\"></i></button></span><h5>系统代码更新</h5></div><div class=panel-body>版本：{{versionlog.versionname}}<div class=panel-tabs><table ng-table=versionlog.versionlogTable class=\"table table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"d in $data\"><td data-title=\"\'时间\'\">{{d.time}}</td><td style=text-align:left data-title=\"\'更新内容\'\">{{d.mesg}}</td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/history/job/job.html","<div style=\"background-color: #fff\"><div class=row style=\"padding: 0 20px 0\"><nodestr></nodestr></div><hr class=\"mv10 clear\"><div class=\"panel panel-primary\"><div class=panel-heading><h5>查询条件</h5></div><div class=panel-body><div class=form-horizontal><form class=form-inline name=searchForm novalidate><div class=container-fluid><div class=row><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">作业名称：</label><input type=text class=form-control ng-model=historyjob.taskname placeholder=任务名称></div><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">启动人：</label><input type=text class=form-control ng-model=historyjob.startuser placeholder=启动人> <button type=submit class=\"btn btn-default\" ng-click=historyjob.getMe()>我</button></div><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">任务状态：</label><select class=form-control ng-init=\'statusType= [ {\"status\":null, \"name\":\"全部\"}, {\"status\":\"fail\", \"name\":\"失败\"}, {\"status\":\"success\", \"name\":\"成功\"}, { \"status\": \"refuse\", \"name\":\"审批拒绝\"},{\"status\":\"running\", \"name\":\"执行中\"}, {\"status\":\"waiting\", \"name\":\"等待\"} ]\' ng-model=historyjob.searchStatus ng-options=\"o.status as o.name for o in statusType\"></select></div></div><div class=row style=\"margin-top: 23px\"><div class=\"form-group col-sm-6\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">执行时间：</label><div style=\"width: 30%\" class=\"input-group date\" id=starttime><input type=text class=form-control ng-model=historyjob.starttime placeholder=开始时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div><span style=\"margin: 0 5px\">-</span><div style=\"width: 30%\" class=\"input-group date\" id=finishtime><input type=text class=form-control ng-model=historyjob.finishtime placeholder=结束时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div></div></div></div></form><hr class=\"mv20 clear\" style=\"margin-top: 30px!important\"><div class=col-md-10><button class=\"btn btn-primary\" ng-click=historyjob.reload()><i class=\"fa fa-search fa-fw\"></i>查询</button> <button class=\"btn btn-success\" ng-click=historyjob.Reset()><i class=\"fa fa-refresh fa-fw\"></i>重置</button></div></div></div></div><div class=\"panel panel-dark\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-dark\" uib-tooltip=刷新 ng-click=historyjob.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!historyjob.loadover}\"></i></button></span><h5>执行历史</h5></div><div class=panel-body ng-init=\"openc3_job_system_only=0\"><div class=panel-tabs ng-init=\'calltype = { \"page\":\"页面\", \"api\":\"API\", \"crontab\":\"计划任务\" }\'><table ng-table=historyjob.data_Table class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"ss in $data\"><td data-title=\"\'任务名称\'\">{{ss.name}}</td><td ng-if=\"openc3_job_system_only==0\" data-title=\"\'关联流水线\'\">{{historyjob.ciinfo[ss.name]}}</td><td data-title=\"\'启动人\'\">{{ss.user}}</td><td data-title=\"\'任务状态\'\">{{historyjob.statuszh[ss.status]}}</td><td data-title=\"\'开始时间\'\">{{ss.starttime}}</td><td data-title=\"\'结束时间\'\">{{ss.finishtime}}</td><td data-title=\"\'启动方式\'\">{{calltype[ss.calltype]}}</td><td data-title=\"\'耗时\'\">{{historyjob.seftime(ss.starttime,ss.finishtime)}}</td><td ng-if=\"openc3_job_system_only==0\" data-title=\"\'version\'\">{{ss.variable| showversion}}</td><td data-title=\"\'操作\'\"><button ng-if=\"ss.jobtype ==\'jobs\'\" class=\"btn btn-warning btn-sm\" ng-click=historyjob.taskDetail(ss.uuid)>执行详情</button> <button ng-if=\"ss.jobtype ==\'plugin_scp\' || ss.jobtype ==\'plugin_cmd\' || ss.jobtype ==\'plugin_approval\'\" class=\"btn btn-warning btn-sm\" ng-click=\"historyjob.quickTaskDetail(ss.jobuuid,ss.uuid, ss.jobtype)\">执行详情</button> <button class=\"btn btn-danger btn-sm\" ng-click=historyjob.redo(ss.uuid)>重做</button></td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/history/jobx/jobx.html","<div><nodestr></nodestr><hr class=\"mv20 clear\"><div class=\"panel panel-system\"><div class=panel-heading><h5>查询条件</h5></div><div class=panel-body><div class=form-horizontal><form class=form-inline name=searchForm novalidate><div class=container-fluid><div class=row><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">任务名称：</label><input type=text class=form-control ng-model=searchData.name placeholder=任务名称关键字></div><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">创建人：</label><input type=text class=form-control ng-model=searchData.user placeholder=创建人全称> <button type=submit class=\"btn btn-default\" ng-click=historyjobx.getMe()>我</button></div><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">任务状态：</label><select class=form-control ng-init=\'statusType= [ {\"status\":null, \"name\":\"全部\"}, {\"status\":\"fail\", \"name\":\"执行失败\"}, {\"status\":\"success\", \"name\":\"执行成功\"}, {\"status\":\"running\", \"name\":\"执行中\"}, {\"status\":\"waiting\", \"name\":\"等待\"} ]\' ng-model=searchData.status ng-options=\"o.status as o.name for o in statusType\"></select></div></div><div class=row style=\"margin-top: 20px\"><div class=\"form-group col-sm-6\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">创建时间：</label><div style=\"width: 30%\" class=\"input-group date\" id=createstart><input type=text class=form-control ng-model=searchData.time_start placeholder=开始时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div><span style=\"margin: 0 5px\">-</span><div style=\"width: 30%\" class=\"input-group date\" id=createend><input type=text class=form-control ng-model=searchData.time_end placeholder=结束时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div></div><div class=\"form-group col-sm-6\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">任务uuid：</label><input type=text class=form-control ng-model=searchData.taskuuid placeholder=任务uuid></div></div></div></form><hr class=\"mv20 clear\" style=\"margin-top: 30px!important\"><div class=col-md-10><button class=\"btn btn-primary\" ng-click=historyjobx.reload()><i class=\"fa fa-search fa-fw\"></i>查询</button> <button class=\"btn btn-success\" ng-click=historyjobx.Reset()><i class=\"fa fa-refresh fa-fw\"></i>重置</button></div></div></div></div></div><div class=\"panel panel-dark\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-dark\" uib-tooltip=刷新 ng-click=historyjobx.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!historyjobx.loadover}\"></i></button></span><h5>执行历史</h5></div><div class=panel-body><div class=panel-tabs ng-init=\'calltype = { \"page\":\"页面\", \"api\":\"API\", \"crontab\":\"计划任务\" }\'><table ng-table=historyjobx.task_Table class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"ss in $data\"><td data-title=\"\'任务名称\'\">{{ss.name}}</td><td data-title=\"\'关联流水线\'\">{{historyjobx.ciinfo[ss.name]}}</td><td data-title=\"\'是回滚流程\'\">{{historyjobx.showRollback(ss)}}</td><td data-title=\"\'创建人\'\">{{ss.user}}</td><td data-title=\"\'任务状态\'\">{{historyjobx.statuszh[ss.status]}}</td><td data-title=\"\'开始时间\'\">{{ss.starttime}}</td><td data-title=\"\'结束时间\'\">{{ss.finishtime}}</td><td data-title=\"\'耗间\'\">{{historyjobx.seftime(ss.starttime,ss.finishtime)}}</td><td data-title=\"\'启动方式\'\">{{calltype[ss.calltype]}}</td><td data-title=\"\'uuid\'\">{{ss.uuid}}</td><td data-title=\"\'version\'\">{{ss.variable | showversion}}</td><td data-title=\"\'操作\'\"><button class=\"btn btn-info btn-sm\" ng-click=historyjobx.taskDetail(ss.uuid)>执行详情</button></td></tr></table></div></div></div>");
$templateCache.put("app/pages/history/terminal/terminal.html","<div><div class=row style=\"padding: 0 20px 0\"><nodestr></nodestr></div><hr class=\"mv10 clear\"><div class=\"panel panel-info\"><div class=panel-heading><h5>查询条件</h5></div><div class=panel-body><div class=form-horizontal><form class=form-inline name=searchForm novalidate><div class=container-fluid><div class=row><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">启动人：</label><input type=text class=form-control ng-model=historyterminal.startuser placeholder=启动人> <button type=submit class=\"btn btn-default\" ng-click=historyterminal.getMe()>我</button></div><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">执行节点：</label><input type=text class=form-control ng-model=historyterminal.runnode placeholder=执行节点></div><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">执行账户：</label><input type=text class=form-control ng-model=historyterminal.runusr placeholder=执行账户></div><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">执行命令：</label><input type=text class=form-control ng-model=historyterminal.runcmd placeholder=执行命令></div></div><div class=row style=\"margin-top: 23px\"><div class=\"form-group col-sm-6\" style=\"padding: 0\"><label style=\"float: left;line-height: 34px;min-width: 90px;text-align: right\">执行时间：</label><div style=\"width: 30%\" class=\"input-group date\" id=time_start><input type=text class=form-control ng-model=historyterminal.timeStart placeholder=开始时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div><span style=\"margin: 0 5px\">-</span><div style=\"width: 30%\" class=\"input-group date\" id=time_end><input type=text class=form-control ng-model=historyterminal.timeEnd placeholder=结束时间> <span class=input-group-addon><span class=\"glyphicon glyphicon-calendar\"></span></span></div></div></div></div></form><hr class=\"mv20 clear\" style=\"margin-top: 30px!important\"><div class=col-md-10><button class=\"btn btn-primary\" ng-click=historyterminal.reload()><i class=\"fa fa-search fa-fw\"></i>查询</button> <button class=\"btn btn-success\" ng-click=historyterminal.Reset()><i class=\"fa fa-refresh fa-fw\"></i>重置</button></div></div></div></div><div class=\"panel panel-dark\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-dark\" uib-tooltip=刷新 ng-click=historyterminal.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!historyterminal.loadover}\"></i></button></span><h5>命令执行日志</h5></div><div class=panel-body><div class=panel-tabs><table ng-table=historyterminal.data_Table class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"ss in $data\"><td data-title=\"\'时间\'\">{{ss.time}}</td><td data-title=\"\'执行命令\'\">{{ss.cmd}}</td><td data-title=\"\'用户\'\">{{ss.usr}}</td><td data-title=\"\'执行节点\'\">{{ss.node}}</td><td data-title=\"\'启动人\'\">{{ss.user}}</td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/quickentry/approval/approval.html","<div class=row style=\"padding: 10px 20px 0px\"><nodestr></nodestr></div><div class=\"panel panel-primary\"><div class=panel-body><div class=form-horizontal><form class=form-horizontal name=myForm role=form novalidate><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">作业名称 <span style=\"color: red\">*</span></label><div class=col-sm-9><input type=text class=form-control name=quickentryapproval.postdata.name ng-model=quickentryapproval.postdata.name ng-minlength=3 ng-disabled=unClick required> <span style=color:red ng-show=myForm.s_name.$error.minlength>不少于2字符</span></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">审批内容<span style=\"color: red\">*</span></label><div class=col-sm-9><textarea type=textarea class=form-control ng-model=quickentryapproval.postdata.cont required></textarea></div></div><a class=\"glyphicon glyphicon-question-sign\" data-toggle=tooltip data-placement=right target=_blank ng-href=/book/发起审批/ uib-tooltip=查看审批内容使用变量帮助 aria-hidden=true style=\"padding-top: 11px;font-size: larger\"></a></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">审批人<span style=\"color: red\">*</span></label><div class=col-sm-9><input type=text class=form-control ng-model=quickentryapproval.postdata.approver required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">生效环境 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClickDeployenv><input type=radio name=unClickDeployenv ng-model=quickentryapproval.postdata.deployenv value=always> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>总是执行</label><label class=\"option option-primary\"><input type=radio name=unClickDeployenv ng-model=quickentryapproval.postdata.deployenv value=test> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>测试环境</label><label class=\"option option-primary\"><input type=radio name=unClickDeployenv ng-model=quickentryapproval.postdata.deployenv value=online> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>线上环境</label></div></div></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">生效动作 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClickAction><input type=radio name=unClickAction ng-model=quickentryapproval.postdata.action value=always> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>总是执行</label><label class=\"option option-primary\"><input type=radio name=unClickAction ng-model=quickentryapproval.postdata.action value=deploy> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅发布时执行</label><label class=\"option option-primary\"><input type=radio name=unClickAction ng-model=quickentryapproval.postdata.action value=rollback> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅回滚时执行</label></div></div></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">分批 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClickBatches><input type=radio name=unClickBatches ng-model=quickentryapproval.postdata.batches value=always> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>总是执行</label><label class=\"option option-primary\"><input type=radio name=unClickBatches ng-model=quickentryapproval.postdata.batches value=firsttime> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅第一个分组</label><label class=\"option option-primary\"><input type=radio name=unClickBatches ng-model=quickentryapproval.postdata.batches value=thelasttime> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅最后一个分组</label></div></div></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">所有审批人都要审批<span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\"><input type=radio name=unClickEveryone ng-model=quickentryapproval.postdata.everyone value=on> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>是</label><label class=\"option option-primary\"><input type=radio name=unClickEveryone ng-model=quickentryapproval.postdata.everyone value=off> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>只要一个人审批</label></div></div></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">超时时间</label><div class=col-sm-9><input type=text class=form-control placeholder=脚本执行超时时间，单位为秒，默认60秒 ng-model=quickentryapproval.postdata.timeout required></div></div></div><div class=row><div class=\"col-sm-3 form-group\" style=\"margin-left: 40%\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=quickentryapproval.runapproval()>执行</button></div></div></form></div></div></div>");
$templateCache.put("app/pages/quickentry/cmd/cmd.html","<div class=row style=\"padding: 10px 20px 0px\"><nodestr></nodestr></div><div class=\"panel panel-primary\" ng-init=\"openc3_job_system_only=0\"><div class=panel-body><div class=form-horizontal><form class=form-horizontal name=scriptForm role=form novalidate><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">脚本名称 <span style=\"color: red\">*</span></label><div class=col-sm-9><input type=text class=form-control name=s_name ng-model=quick.s_name ng-minlength=3 ng-disabled=unClick required> <span style=color:red ng-show=scriptForm.s_name.$error.minlength>不少于2字符</span></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">脚本来源 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClick><input type=radio name=src ng-model=quick.from value=manual ng-click=quick.scriptManual() ng-disabled=unClick> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>手工录入</label><label class=\"option option-primary\"><input type=radio name=src ng-model=quick.from value=clone ng-click=quick.scriptClone() ng-disabled=unClick> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>脚本克隆</label><label class=\"option option-primary\"><input type=radio name=src ng-model=quick.from value=local ng-click=quick.scriptLocal() ng-disabled=unClick> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>本地脚本</label></div><div ng-hide=quick.scriptHide style=\"padding-top: 10px; padding-left: 0\"><select class=form-control ng-model=selectedScript ng-change=quick.inputScript() ng-options=\"s.name for s in allScript\"></select></div></div></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">脚本内容 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=\"panel panel-primary\"><div style=\"border: 1px solid #e5e5e5;padding: 10px\"><div class=admin-form><div class=\"option-group field\" style=\"padding-bottom: 9px\"><label class=\"option option-primary\"><input type=radio name=cont ng-model=scriptType ng-click=quick.editorSh() ng-disabled=unClick value=shell> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>shell</label><label class=\"option option-primary\"><input type=radio name=cont ng-model=scriptType ng-click=quick.editorPy() ng-disabled=unClick value=python> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>python</label><label class=\"option option-primary\"><input type=radio name=cont ng-model=scriptType ng-click=quick.editorPerl() ng-disabled=unClick value=perl> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>perl</label><label class=\"option option-primary\"><input type=radio name=cont ng-model=scriptType ng-click=quick.editorPhp() ng-disabled=unClick value=php> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>php</label><label class=\"option option-primary\"><input type=radio name=cont ng-model=scriptType ng-click=quick.editorBuildin() ng-disabled=unClick value=buildin> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>内建</label><label class=\"option option-primary\"><input type=radio name=cont ng-model=scriptType ng-click=quick.editorAuto() ng-disabled=unClick value=auto> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>自动识别</label></div></div><div ng-show=\"scriptType==\'buildin\' && quick.from == \'manual\'\" class=admin-form><div class=\"option-group field\" style=\"padding-bottom: 9px\"><label class=\"option option-primary\" style=cursor:default>内建插件:</label><label class=\"option option-primary\" ng-click=\"quick.buildinSet( \'kubectl\' )\">kubectl</label><label class=\"option option-primary\" ng-click=\"quick.buildinSet( \'terraform\' )\">terraform</label><label class=\"option option-primary\" ng-click=\"quick.buildinSet( \'kubestar\' )\">kubestar</label><label class=\"option option-primary\" ng-click=\"quick.buildinSet( \'awsecs\' )\">awsecs</label><label class=\"option option-primary\" ng-click=\"quick.buildinSet( \'sendemail\' )\">sendemail</label><label class=\"option option-primary\" ng-click=\"quick.buildinSet( \'sendmesg\' )\">sendmesg</label><label class=\"option option-primary\" ng-click=\"quick.buildinSet( \'flowcaller\' )\">flowcaller</label><label class=\"option option-primary\" ng-click=\"quick.buildinSet( \'cdnrefresh\' )\">cdnrefresh</label><label class=\"option option-primary\" ng-click=\"quick.buildinSet( \'kubernetes\' )\">kubernetes</label></div></div><div class=form-horizontal><!-- shell --><div style=height:400px class=form-group id=editor ng-mouseleave=quick.leaveeditor()></div><!-- python --><!--<div style=\"height:400px;\" class=\"form-group\" ng-switch-when=\"python\" id=\"editorPython\"></div>--></div></div></div></div></div><a class=\"glyphicon glyphicon-question-sign\" data-toggle=tooltip data-placement=right target=_blank ng-href=/book/客户端内置命令/ uib-tooltip=查看客户端内置命令帮助 aria-hidden=true style=\"padding-top: 11px;font-size: larger\"></a></div><div class=row ng-show=\"scriptType!=\'buildin\'\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">执行账户 <span style=\"color: red\">*</span></label><div class=col-sm-7><select class=form-control style=\"font-size: 15px;height: 42px\" ng-model=selectedUser><option ng-repeat=\"x in allProUsers\" value={{x.username}}>{{x.username}}</option></select></div><button class=\"btn btn-primary col-sm-1\" uib-tooltip=添加 ng-click=quick.addProUser()><i class=\"fa fa-plus\"></i></button></div></div><div class=row ng-show=\"scriptType==\'buildin\'\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">使用凭据 &nbsp&nbsp</label><div class=col-sm-7><select class=form-control ng-model=selectedUser><option ng-repeat=\"x in quick.ticketinfo\" value={{x.id}}>{{x.name}}</option></select></div></div></div><div ng-show=quick.showmachinelist class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">目标机器 <span style=\"color: red\">*</span></label><div class=col-sm-9><button class=\"btn btn-primary\" ng-click=quick.choiceServer() required>选择服务器</button><table ng-table=choice.choiceResult class=\"table table-hover\" ng-show=choiceShow style=\"margin-top: 10px;border: 1px solid #ddd\"><thead><tr><th style=\"text-align: left\">编号</th><th style=\"text-align: left\">名称</th><th style=\"text-align: left\">类型</th><th style=\"text-align: left\">操作</th></tr></thead><tbody><tr ng-repeat=\"ss in choiceResult\"><td>{{$index + 1}}</td><td ng-if=\"nodeType==\'group\'\">{{ss.name}}</td><td ng-if=\"nodeType==\'builtin\'\">{{ss}}</td><td>{{choiceType}}</td><td><button ng-if=\"nodeType==\'group\'\" ng-click=\"quick.delChoice($index, ss.name)\">删除</button> <button ng-if=\"nodeType==\'builtin\'\" ng-click=\"quick.delChoice($index, ss)\">删除</button></td></tr></tbody></table></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">脚本参数</label><div class=col-sm-9><input type=text class=form-control ng-model=s_argv></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">超时时间</label><div class=col-sm-9><input type=text class=form-control placeholder=脚本执行超时时间，单位为秒，默认60秒 ng-model=s_timeout></div></div></div><div class=row ng-if=\"openc3_job_system_only==0\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">生效环境 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClickDeployenv><input type=radio name=unClickDeployenv ng-model=quick.postdata.deployenv value=always> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>总是执行</label><label class=\"option option-primary\"><input type=radio name=unClickDeployenv ng-model=quick.postdata.deployenv value=test> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>测试环境</label><label class=\"option option-primary\"><input type=radio name=unClickDeployenv ng-model=quick.postdata.deployenv value=online> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>线上环境</label></div></div></div></div></div><div class=row ng-if=\"openc3_job_system_only==0\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">生效动作 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClickAction><input type=radio name=unClickAction ng-model=quick.postdata.action value=always> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>总是执行</label><label class=\"option option-primary\"><input type=radio name=unClickAction ng-model=quick.postdata.action value=deploy> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅发布时执行</label><label class=\"option option-primary\"><input type=radio name=unClickAction ng-model=quick.postdata.action value=rollback> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅回滚时执行</label></div></div></div></div></div><div class=row ng-if=\"openc3_job_system_only==0\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">分批 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClickBatches><input type=radio name=unClickBatches ng-model=quick.postdata.batches value=always> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>总是执行</label><label class=\"option option-primary\"><input type=radio name=unClickBatches ng-model=quick.postdata.batches value=firsttime> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅第一个分组</label><label class=\"option option-primary\"><input type=radio name=unClickBatches ng-model=quick.postdata.batches value=thelasttime> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅最后一个分组</label></div></div></div></div></div><div class=row><div class=\"col-sm-3 form-group\" style=\"margin-left: 40%\"><button class=\"btn btn-primary\" ng-disabled=scriptForm.$invalid ng-click=quick.run(scriptForm)>执行脚本</button></div></div></form></div></div></div>");
$templateCache.put("app/pages/quickentry/flowline/addToFavorites.html","<div class=modal-header><h4 class=modal-title>添加到收藏夹</h4></div><div class=modal-body><form class=form-horizontal name=addForm role=form><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">我给该流水线的别名</label><div class=col-sm-9><input type=text class=form-control name=adduser placeholder=流水线别名 ng-model=projectname required></div></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=addForm.$invalid ng-click=addToFavorites.add()>确认</button> <button class=\"btn btn-warning\" ng-click=addToFavorites.cancel()>取消</button></div></div></form></div>");
$templateCache.put("app/pages/quickentry/flowline/copyProject.html","<div class=modal-header><h4 class=modal-title>复制流水线</h4></div><div class=modal-body><form class=form-horizontal name=addForm role=form><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">流水线名称</label><div class=col-sm-9><input type=text class=form-control name=adduser placeholder=流水线名 ng-model=projectname required></div></div></div><div class=\"form-group admin-form\"><label class=\"col-md-2 control-label fwbold\">开关:</label><div class=col-md-2><label class=\"switch switch-system mt5\"><input type=checkbox id=check_status ng-model=copyProject.status><label for=check_status data-on=ON data-off=OFF></label></label></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=addForm.$invalid ng-click=copyProject.add()>确认</button> <button class=\"btn btn-warning\" ng-click=copyProject.cancel()>取消</button></div></div></form></div>");
$templateCache.put("app/pages/quickentry/flowline/copyProjectByTemplate.html","<div class=modal-header><h4 class=modal-title>复制流水线</h4></div><div class=modal-body><form class=form-horizontal name=addForm role=form><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">流水线名称</label><div class=col-sm-9><input type=text class=form-control name=adduser placeholder=流水线名 ng-model=projectname required></div></div></div><div class=\"form-group admin-form\"><label class=\"col-md-2 control-label fwbold\">开关:</label><div class=col-md-2><label class=\"switch switch-system mt5\"><input type=checkbox id=check_status ng-model=copyProjectByTemplate.status><label for=check_status data-on=ON data-off=OFF></label></label></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=addForm.$invalid ng-click=copyProjectByTemplate.add()>确认</button> <button class=\"btn btn-warning\" ng-click=copyProjectByTemplate.cancel()>取消</button></div></div></form></div>");
$templateCache.put("app/pages/quickentry/flowline/copyProjectToTemplate.html","<div class=modal-header><h4 class=modal-title>另存为模版</h4></div><div class=modal-body><form class=form-horizontal name=addForm role=form><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">流水线名称</label><div class=col-sm-9><input type=text class=form-control name=adduser placeholder=流水线名 ng-model=projectname required></div></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=addForm.$invalid ng-click=copyProjectToTemplate.add()>确认</button> <button class=\"btn btn-warning\" ng-click=copyProjectToTemplate.cancel()>取消</button></div></div></form></div>");
$templateCache.put("app/pages/quickentry/flowline/flowline.html","<div class=\"row block\"><nodestr></nodestr><hr class=\"mv20 clear\"><div><div style=\"float: right\"><form class=form-inline name=myForm novalidate><button type=submit class=\"btn btn-primary\" style=\"padding: 10px 25px\" ng-click=cigroup.createProject()><i class=\"fa fa-plus-circle fa-lg\" aria-hidden=true></i> 新建空白流水线</button> <button type=submit class=\"btn btn-primary\" style=\"padding: 10px 25px\" ng-click=cigroup.createProjectByTemplate()><i class=\"fa fa-plus-circle fa-lg\" aria-hidden=true></i> 通过模版建流水线</button></form></div><div style=\"clear: both\">&nbsp;</div></div><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=cigroup.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!cigroup.loadover}\"></i></button></span><h5>本节点流水线数量:{{cigroup.flowlinecount}}</h5></div><div class=\"panel-body flowline\"><div class=pt20 style=\"overflow: auto\"><table ng-table=cigroup.activeRegionTable class=\"table table-scroll table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td width=60 data-title=\"\'名称\'\" filter=\"{ name: \'text\'}\" sortable><i class=\"fa fa-star-o fa-1x\" aria-hidden=true ng-if=!m.favorites ng-click=cigroup.addToFavorites(m.id,m.name) uib-tooltip=收藏 style=\"cursor:pointer;color: #339094;font-size: 18px\"></i> <i class=\"fa fa-star fa-1x\" aria-hidden=true ng-if=m.favorites ng-click=cigroup.delToFavorites(m.id,m.name) uib-tooltip=取消收藏 style=\"cursor:pointer;color: #339094;font-size: 18px\"></i> {{m.name}}</td><td data-title=\"\'别名\'\" width=80 filter=\"{ alias: \'text\'}\" sortable>{{m.alias}}</td><td data-title=\"\'应用\'\" width=80 filter=\"{ ci_type: \'text\'}\" sortable>{{m.ci_type}}.{{m.ci_type_kind}} <i ng-if=\"m.ci_type === \'kubernetes\'\" class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=cigroup.describedeployment(m.ci_type_ticketid,m.ci_type,m.ci_type_name,m.ci_type_namespace) uib-tooltip=查看 style=\"cursor:pointer;color: #339094\"></i></td><td data-title=\"\'构建状态\'\"><div class=\"panel panel-info\" ng-if=m.lastbuild.status style=\"cursor:pointer;margin: 0 0 0\" ng-click=\"cigroup.showlog(m.lastbuild.uuid, m.lastbuild.slave)\"><span class=bold style=\"cursor:pointer;color: {{panelcolor[m.lastbuild.status]}};margin: 0 0 0\"><i class=\"fa fa-cloud\" ng-if=\"m.lastbuild.status==\'fail\'\" aria-hidden=true></i> <i class=\"fa fa-spinner\" ng-if=\"m.lastbuild.status==\'running\'\" ng-class=\"{\'fa-spin\':1}\" aria-hidden=true></i> <i class=\"fa fa-sun-o\" ng-if=\"m.lastbuild.status==\'success\'\" aria-hidden=true></i> {{m.lastbuild.name}}</span><br>{{m.lastbuild.starttime}}</div></td><td data-title=\"\'测试环境状态\'\"><div class=\"panel panel-info\" ng-if=cigroup.taskInfoTest[m.id] style=\"cursor:pointer;margin: 0 0 0\" ng-click=cigroup.deployDetail(cigroup.taskInfoTest[m.id].uuid)><span class=bold style=\"cursor:pointer;color: {{panelcolor[cigroup.taskInfoTest[m.id].status]}};margin: 0 0 0\"><i class=\"fa fa-cloud\" ng-if=\"cigroup.taskInfoTest[m.id].status==\'fail\'\" aria-hidden=true></i> <i class=\"fa fa-spinner\" ng-if=\"cigroup.taskInfoTest[m.id].status==\'running\'\" ng-class=\"{\'fa-spin\':1}\" aria-hidden=true></i> <i class=\"fa fa-sun-o\" ng-if=\"cigroup.taskInfoTest[m.id].status==\'success\'\" aria-hidden=true></i> {{cigroup.taskInfoTest[m.id].version}}</span><br>{{cigroup.taskInfoTest[m.id].starttime}} <i class=\"fa fa-spinner\" ng-if=\"cigroup.taskInfoTestRunning[m.id] && cigroup.taskInfoTest[m.id].status!=\'running\' \" ng-class=\"{\'fa-spin\':1}\" aria-hidden=true></i></div></td><td data-title=\"\'线上环境状态\'\"><div class=\"panel panel-info\" ng-if=cigroup.taskInfoOnline[m.id] style=\"cursor:pointer;margin: 0 0 0\" ng-click=cigroup.deployDetail(cigroup.taskInfoOnline[m.id].uuid)><span class=bold style=\"cursor:pointer;color: {{panelcolor[cigroup.taskInfoOnline[m.id].status]}};margin: 0 0 0\">{{cigroup.deployType(cigroup.taskInfoOnline[m.id].uuid)}} <i class=\"fa fa-cloud\" ng-if=\"cigroup.taskInfoOnline[m.id].status==\'fail\'\" aria-hidden=true></i> <i class=\"fa fa-spinner\" ng-if=\"cigroup.taskInfoOnline[m.id].status==\'running\'\" ng-class=\"{\'fa-spin\':1}\" aria-hidden=true></i> <i class=\"fa fa-sun-o\" ng-if=\"cigroup.taskInfoOnline[m.id].status==\'success\'\" aria-hidden=true></i> {{cigroup.taskInfoOnline[m.id].version}}</span><br>{{cigroup.taskInfoOnline[m.id].starttime}} <i class=\"fa fa-spinner\" ng-if=\"cigroup.taskInfoOnlineRunning[m.id] && cigroup.taskInfoOnline[m.id].status!=\'running\'\" ng-class=\"{\'fa-spin\':1}\" aria-hidden=true></i></div></td><td data-title=\"\'编辑者\'\" width=80 filter=\"{ edit_user: \'text\'}\" sortable>{{m.edit_user}}</td><td data-title=\"\'编号\'\" width=30 filter=\"{ id: \'text\'}\" sortable>{{m.id}}</td><td class=textcenter width=175 data-title=\"\'操作\'\"><nobr><i class=\"fa fa-chevron-circle-right fa-2x\" aria-hidden=true ng-click=cigroup.versiondetail(m.id) uib-tooltip=进入 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-cog fa-2x\" aria-hidden=true ng-click=cigroup.editconfig(m.id,m.name) uib-tooltip=编辑 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-clone fa-2x\" aria-hidden=true ng-click=cigroup.copyProject(m.id,m.name) uib-tooltip=复制为 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-bookmark fa-2x\" aria-hidden=true ng-click=cigroup.copyProjectToTemplate(m.id,m.name) uib-tooltip=另存为模版 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-times-circle fa-2x\" aria-hidden=true ng-click=cigroup.deleteProject(m.id) uib-tooltip=删除 style=\"cursor:pointer;color: red\"></i></nobr></td></tr></table></div><style>.flowline .bold {\n                    font-weight: 700;\n                    font-size: 14px;\n                }\n                .flowline .panel {\n                    background: none;\n                }\n                .flowline table tbody {\n                    text-align: left;\n                }\n                .flowline table tbody .textcenter {\n                    text-align: center;\n                }\n                /* ======== */</style></div></div></div>");
$templateCache.put("app/pages/quickentry/flowline/runTask2Ci.html","<div class=row style=\"padding: 10px 20px 0px\"><nodestr></nodestr><h4>({{runtask2ci.projectname}})</h4></div><div class=\"panel panel-primary\" style=\"width: 100%\"><div class=panel-body><div class=form-horizontal><form class=form-horizontal name=runtask2ciForm role=form novalidate><h3 style=\"margin: 0px\">机器列表</h3><div class=row ng-repeat=\"group in runtask2ci.showIPstr\"><div class=\"col-sm-12 form-group\"><label class=\"col-sm-3 control-label\">分组{{$index+1}}: ({{group.num}}台机器)</label><div class=col-sm-9 style=\"padding-top: 10px\"><p ng-repeat=\"ip in group.infos\">{{ip}}</p></div></div></div><hr style=\"margin: 5px\"><h3 style=\"margin: 0px\">发布步骤</h3><div class=row ng-repeat=\"step in runtask2ci.jobStep\" style=\"margin: 0px\"><div class=\"col-sm-12 form-group\" style=\"margin-bottom: 0px\"><label class=\"col-sm-3 control-label\">第{{$index+1}}步:</label><div class=col-sm-9 style=\"padding-top: 10px\"><p>{{step}}</p></div></div></div><hr style=\"margin: 5px\"><h3>当前发布版本:{{runtask2ci.version}}</h3><div class=row ng-if=\"runtask2ci.jobtype==\'online\'\"><div ng-if=runtask2ci.lastversion.version><label class=\"col-sm-9 control-label\" style=\"padding: 1px\">最后一次成功发布的版本:{{runtask2ci.lastversion.version}} 时间: {{runtask2ci.lastversion.create_time}} 发布的任务 {{runtask2ci.lastversion.jobxuuid}}</label><div class=col-sm-3><button class=\"btn btn-danger\" style=\"padding: 0px\" ng-disabled=runtask2ci.rollbacknoneeded ng-click=runtask2ci.setRollbackVersion(runtask2ci.lastversion.version)>点击使用</button></div></div><div ng-if=!runtask2ci.lastversion.version><label class=\"col-sm-9 control-label\" style=\"padding: 1px\">没有发现可回滚版本，请手动填写回滚版本</label></div><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">回滚版本: &nbsp;</label><div class=col-sm-9><input type=text class=form-control ng-disabled=runtask2ci.rollbacknoneeded ng-model=taskData.variable._rollbackVersion_ placeholder=回滚版本 required></div></div><div class=\"col-sm-10 form-group admin-form\"><label class=\"col-sm-3 control-label fwbold\">无需回滚: &nbsp;</label><div class=col-sm-9><label class=\"switch switch-system mt5\"><input type=checkbox id=set_rollbacknoneeded ng-model=runtask2ci.rollbacknoneeded ng-click=runtask2ci.cleanRollbackVersion()><label for=set_rollbacknoneeded data-on=ON data-off=OFF></label></label></div></div></div><div class=row ng-repeat=\"ss in jobVar\"><div class=\"col-sm-10 form-group\"><div ng-if=\"ss.name != \'ip\' && ss.name != \'version\'\"><label class=\"col-sm-3 control-label\">{{ss.name}}: &nbsp;</label><div class=col-sm-9><input type=text class=form-control ng-model=taskData.variable[ss.name] placeholder=填写任务变量 required></div></div></div></div><div class=row><div class=\"col-sm-3 form-group\" style=\"margin-left: 40%\"><button class=\"btn btn-primary\" ng-disabled=\"runtask2ciForm.$invalid && !runtask2ci.rollbacknoneeded\" ng-click=runtask2ci.runTask()>确认</button> <button class=\"btn btn-primary\" ng-click=runtask2ci.cancel()>取消</button></div></div></form></div></div></div>");
$templateCache.put("app/pages/quickentry/flowline/showlog.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><h5>{{ showlog.nodeStr }}</h5></div><div class=panel-body><pre class=fluid-width id=logDetail style=\"height:600px;background:#000; color:#FFF\" readonly ng-bind-html=uCanTrust(showlog.logDetail)></pre></div><div class=\"panel-footer text-right\"><button class=\"btn btn-warning\" ng-click=showlog.cancel()>关闭</button></div></div></div>");
$templateCache.put("app/pages/quickentry/runtask/runtask.html","<div class=row style=\"padding: 10px 20px 0px\"><nodestr></nodestr></div><div class=\"panel panel-primary\" style=\"width: 100%\"><div class=panel-body><div class=form-horizontal><form class=form-horizontal name=runtaskForm role=form novalidate><div class=row><div class=\"col-sm-10 form-group\"></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">作业: &nbsp;</label><div class=col-sm-6><select class=form-control style=\"font-size: 15px;height: 42px\" ng-model=choiceJob ng-options=\"s.alias for s in allJobs\" required></select></div></div></div><div class=row ng-if=\"runtask.showjobxgroup == 1\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">分组: &nbsp;</label><div class=col-sm-6><select class=form-control style=\"font-size: 15px;height: 42px\" ng-model=taskData.group ng-options=\"s.name as s.alias for s in allGroups\" required></select></div></div></div><div class=row ng-repeat=\"ss in jobVar\"><div class=\"col-sm-10 form-group\"><div><label class=\"col-sm-3 control-label\">{{ss.name}}: &nbsp;</label><div class=col-sm-6><input type=text class=form-control ng-model=ss.value placeholder=填写任务变量 required></div><label class=col-sm-3 style=\"color: gray\">{{ss.describe}}</label></div></div></div><div class=row><div class=\"col-sm-3 form-group\" style=\"margin-left: 40%\"><button class=\"btn btn-primary\" ng-disabled=runtaskForm.$invalid ng-click=runtask.runTask()>确认</button></div></div></form></div></div></div>");
$templateCache.put("app/pages/quickentry/scp/scp.html","<div class=row style=\"padding: 10px 20px 0px\"><nodestr></nodestr></div><form class=form-horizontal name=dstForm role=form novalidate><div style=\"width: 70%;margin-left: 10%;margin-bottom: 15px\"><div class=row><div class=col-sm-10><label class=\"col-sm-2 control-label\">作业名称 <span style=\"color: red\">*</span></label><div class=col-sm-9><input type=text class=form-control name=s_name ng-model=dstDate.name required></div></div></div></div><div class=\"panel panel-primary\" ng-init=\"openc3_job_system_only=0\" style=\"width: 80%;margin-left: 10%\"><div class=panel-body><div class=form-horizontal><div class=row><div class=\"col-sm-12 form-group\"><label class=col-sm-5 style=\"font-size: 16px;padding-top: 10px\"><span class=\"glyphicon glyphicon-hdd\" style=\"padding: 0 3px\"></span>源文件 <span style=\"margin-left:15px;font-weight: normal;font-size: 12px\">注意：本地文件上传会用同名文件覆盖危险</span></label><div class=col-sm-7><button class=\"btn btn-primary\" ng-click=distribute.choiceShareFiles()><span class=\"glyphicon glyphicon-cloud\" style=\"padding: 0 3px\"></span>选择共享文件</button> <button class=\"btn btn-primary\" ng-click=distribute.choiceSourceFile()><span class=\"glyphicon glyphicon-oil\" style=\"padding: 0 3px\"></span>选择源服务器文件</button> <button class=\"btn btn-primary\" ng-if=\"openc3_job_system_only==0\" ng-click=distribute.choiceVariable()><span class=\"glyphicon glyphicon-oil\" style=\"padding: 0 3px\"></span>选择构建文件</button><div id=upresult class=form-inline style=\"font-weight: bold\"><span>{{distribute.up_re}}</span></div></div></div></div><div class=\"row row col-sm-11\"><div class=col-sm-11 style=\"margin-left: 1%\"><table ng-table=choice.shareResult class=\"table table-hover\" style=\"border: 1px solid #ddd\"><thead><tr ng-if=!varShow><th style=\"text-align: left;width: 27%\">文件列表</th><th style=\"text-align: left;width: 29%\">服务器地址</th><th ng-hide=true style=\"text-align: left;width: 25%\">执行账户</th></tr><tr ng-if=varShow><th style=\"text-align: left;width: 27%\">环境</th><th style=\"text-align: left;width: 29%\">版本</th><th ng-hide=true style=\"text-align: left;width: 25%\">执行账户</th></tr></thead><tbody id=srcbody><tr ng-repeat=\"ss in shareResult\"><td>{{ss.name}}</td><td>默认空</td><td ng-hide=true><select class=form-control style=\"font-size: 18px\" disabled ng-model=dstUser ng-options=\"s.username for s in allProUsers\"></select></td></tr><tr ng-show=varShow><td>{{varData.ci}}</td><td>{{varData.version}}</td><td ng-hide=true><select class=form-control style=\"font-size: 18px\" disabled ng-model=dstUser ng-options=\"s.username as s.username for s in allProUsers\"></select></td></tr><tr ng-show=srcShow><td><textarea ng-model=copySrcdata.sp style=\"min-height: 40px;min-width: 200px\" placeholder=输入文件地址 required></textarea></td><td><div><div><span>{{srouceServerResult}}</span></div><div><button ng-hide=true id=click123 class=\"btn btn-default btn-xs\" style=\"margin-left: 73%\" ng-click=distribute.choiceSourceServer($event) required>添加</button> <span style=\"color: red\" ng-show=srcServerShow>必选源服务器</span></div></div></td><td ng-hide=true><select class=form-control style=\"font-size: 15px\" disabled ng-model=dstUser ng-options=\"s.username for s in allProUsers\"></select></td></tr></tbody></table></div></div></div></div></div><div class=\"panel panel-primary\" ng-init=\"openc3_job_system_only=0\" style=\"width: 80%;margin-left: 10%\"><div class=panel-body><div class=form-horizontal><div class=row><div class=\"col-sm-12 form-group\"><label class=col-sm-6 style=\"font-size: 16px;padding-top: 10px\"><span class=\"glyphicon glyphicon-folder-open\" style=\"padding: 0 3px\"></span>目标文件</label></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">目标路径 <span style=\"color: red\">*</span></label><div class=col-sm-8><input type=text class=form-control ng-model=dstDate.dp name=dstpath placeholder=请填写分发路径 required></div><span class=\"glyphicon glyphicon-question-sign\" data-toggle=tooltip data-placement=right uib-tooltip=\"目标路径以\'/\'结尾代表一个目录，不以‘/’结尾表示一个文件。如：/tmp/表示将文件保存到此目录下，/tmp/test.txt表示将文件保存到此目录下，文件名为test.txt\" aria-hidden=true style=\"padding-top: 11px;font-size: larger\"></span></div></div><div class=row ng-show=scp_dir><div class=\"col-sm-10 form-group\"><label class=\"col-md-3 control-label\">同步delete</label><div class=\"col-md-2 admin-form\"><label class=\"switch switch-system mt5\"><input type=checkbox id=scp_delete ng-model=dstDate.scp_delete><label for=scp_delete data-on=ON data-off=OFF></label></label></div><span class=\"glyphicon glyphicon-question-sign\" data-toggle=tooltip data-placement=right uib-tooltip=开启后，同步文件夹时删除DEST中SRC没有的文件 aria-hidden=true style=\"padding-top: 11px;font-size: larger\"></span></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">执行账户 <span style=\"color: red\">*</span></label><div class=col-sm-7><select class=form-control style=\"font-size: 18px;padding: 0 12px\" ng-model=dstUser ng-options=\"s.username for s in allProUsers\" required></select><span style=\"color: red\" ng-show=userShow>必选执行用户</span></div><button class=\"btn btn-primary col-sm-1\" uib-tooltip=添加 ng-click=distribute.addProUser()><i class=\"fa fa-plus\"></i></button></div></div><div class=row><div class=\"col-sm-10 form-group\" style=\"margin-top: -23px\"><label class=\"col-sm-3 control-label\"></label><div class=col-sm-7><dataerror ng-hide=dataready errmsg={{dataerror}}></dataerror></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">目标机器 <span style=\"color: red\">*</span></label><div class=col-sm-9><button class=\"btn btn-primary\" ng-click=distribute.choiceServer() required>选择服务器</button> <span style=\"color: red\" ng-show=dstServerShow>必须目标服务器</span><table ng-table=distribute.choiceResult class=\"table table-hover\" ng-show=choiceShow style=\"margin-top: 10px;border: 1px solid #ddd\"><thead><tr><th style=\"text-align: left\">编号</th><th style=\"text-align: left\">名称</th><th style=\"text-align: left\">类型</th><th style=\"text-align: left\">操作</th></tr></thead><tbody><tr ng-repeat=\"ss in choiceResult\"><td>{{$index + 1}}</td><td ng-if=\"dstDate.dst_type ==\'group\'\">{{ss.name}}</td><td ng-if=\"dstDate.dst_type ==\'builtin\'\">{{ss}}</td><td>{{choiceType}}</td><td><button ng-if=\"dstDate.dst_type ==\'group\'\" ng-click=\"distribute.delChoice($index, ss.name)\">删除</button> <button ng-if=\"dstDate.dst_type ==\'builtin\'\" ng-click=\"distribute.delChoice($index, ss)\">删除</button></td></tr></tbody></table></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">文件归属者 &nbsp;</label><div class=col-sm-7><select class=form-control style=\"font-size: 18px;padding: 0 12px\" ng-model=fileChown ng-options=\"s.username for s in allProUsers\" required></select><span>做chown操作，为空的情况下文件最后的归属着和Agent的启动用户有关。</span></div><button class=\"btn btn-primary col-sm-1\" uib-tooltip=添加 ng-click=distribute.addProUser()><i class=\"fa fa-plus\"></i></button></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">文件权限 &nbsp;</label><div class=col-sm-9><input type=text class=form-control ng-model=dstDate.chmod name=dstchmod required> <span>做chmod操作，为空的情况下文件权限和系统设置有关。</span></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">超时时间 <span style=\"color: red\">*</span></label><div class=col-sm-9><input type=text class=form-control ng-model=dstDate.timeout name=timeout required></div></div></div><div class=row ng-if=\"openc3_job_system_only==0\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">生效环境 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClickDeployenv><input type=radio name=unClickDeployenv ng-model=distribute.postdata.deployenv value=always> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>总是执行</label><label class=\"option option-primary\"><input type=radio name=unClickDeployenv ng-model=distribute.postdata.deployenv value=test> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>测试环境</label><label class=\"option option-primary\"><input type=radio name=unClickDeployenv ng-model=distribute.postdata.deployenv value=online> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>线上环境</label></div></div></div></div></div><div class=row ng-if=\"openc3_job_system_only==0\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">生效动作 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClickAction><input type=radio name=unClickAction ng-model=distribute.postdata.action value=always> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>总是执行</label><label class=\"option option-primary\"><input type=radio name=unClickAction ng-model=distribute.postdata.action value=deploy> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅发布时执行</label><label class=\"option option-primary\"><input type=radio name=unClickAction ng-model=distribute.postdata.action value=rollback> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅回滚时执行</label></div></div></div></div></div><div class=row ng-if=\"openc3_job_system_only==0\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">分批 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClickBatches><input type=radio name=unClickBatches ng-model=distribute.postdata.batches value=always> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>总是执行</label><label class=\"option option-primary\"><input type=radio name=unClickBatches ng-model=distribute.postdata.batches value=firsttime> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅第一个分组</label><label class=\"option option-primary\"><input type=radio name=unClickBatches ng-model=distribute.postdata.batches value=thelasttime> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅最后一个分组</label></div></div></div></div></div><div class=row><div class=\"col-sm-3 form-group\" style=\"margin-left: 40%\"><button class=\"btn btn-success\" ng-disabled=\"\" ng-click=distribute.postData()>开始执行</button></div></div></div></div></div></form>");
$templateCache.put("app/pages/quickentry/sendfile/sendfile.html","<div><div class=row style=\"padding: 0 20px 0\"><nodestr></nodestr></div><hr class=\"mv10 clear\"><div class=row><div class=\"col-sm-8 form-group\"><label class=control-label style=\"padding-top: 8px;padding-right: 0;width: 11%;float: left;position: relative;min-height: 1px;padding-left: 15px\">执行账户</label><div class=col-sm-4><form action=\"\"><select class=form-control style=\"font-size: 15px;height: 35px;padding: 3px 12px\" ng-model=selectedUser ng-options=\"s.username as s.username for s in allProUsers\" required></select></form></div></div></div><div ng-if=!sendfile.filepath class=\"panel panel-dark\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-dark\" uib-tooltip=刷新 ng-click=sendfile.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!sendfile.loadover}\"></i></button></span><h5>请点击选择节点</h5></div><div class=panel-body><div><table ng-table=sendfile.machine_Table class=\"table table-hover text-center table-condensed\" show-filter=true style=\"border: 1px solid #ddd\"><tr ng-repeat=\"ss in $data\" style=\"text-align: left\"><td style=\"width: 15%\" data-title=\"\'机器名称\'\" filter=\"{ name: \'text\'}\"><a id={{ss.name}} type=checkbox name=selected ng-checked=isSelected(ss.name) ng-click=\"nameUpdateSelection($event, ss.id, ss.name)\" style=\"zoom: 125%\"><a style=\"cursor: pointer\" title=打开 ng-click=sendfile.openOne(ss.name)>{{ss.name}}</a></td><td style=\"width: 5%\" data-title=\"\'类型\'\" filter=\"{ type: \'text\'}\">{{ss.type}}</td><td style=\"width: 15%\" data-title=\"\'内网IP\'\" filter=\"{ inip: \'text\'}\"><a id={{ss.inip}} ng-if=ss.inip type=checkbox name=selected ng-checked=isSelected(ss.inip) ng-click=\"inipUpdateSelection($event, ss.id, ss.inip)\" style=\"zoom: 125%\"><a style=\"cursor: pointer\" title=打开 ng-click=sendfile.openOne(ss.inip)>{{ss.inip}}</a> <i ng-if=\"ss.inip && ! ss.inips.status\" class=\"fa fa-exclamation-circle\" aria-hidden=true></i> <i ng-if=\"ss.inip && ss.inips.status==\'fail\'\" class=\"fa fa-circle\" style=\"color: red\" aria-hidden=true></i> <i ng-if=\"ss.inip && ss.inips.status==\'success\'\" class=\"fa fa-circle\" style=\"color: green\" aria-hidden=true></i></td><td style=\"width: 15%\" data-title=\"\'外网ip\'\" filter=\"{ exip: \'text\'}\"><a ng-if=ss.exip id={{ss.exip}} type=checkbox name=selected ng-checked=isSelected(ss.exip) ng-click=\"exipUpdateSelection($event, ss.id, ss.exip)\" style=\"zoom: 125%\"><a style=\"cursor: pointer\" title=打开 ng-click=sendfile.openOne(ss.exip)>{{ss.exip}}</a> <i ng-if=\"ss.exip && ! ss.exips.status\" class=\"fa fa-exclamation-circle\" aria-hidden=true></i> <i ng-if=\"ss.exip && ss.exips.status==\'fail\'\" class=\"fa fa-circle\" style=\"color: red\" aria-hidden=true></i> <i ng-if=\"ss.exip && ss.exips.status==\'success\'\" class=\"fa fa-circle\" style=\"color: green\" aria-hidden=true></i></td><td style=\"width: 5%\" data-title=\"\'客户端版本\'\"><a ng-if=ss.inip>{{ss.inips.version}}</a> <a ng-if=\"ss.exip && ! ss.inip\">{{ss.exips.version}}</a></td><td style=\"width: 20%\" data-title=\"\'客户端上一次检测时间\'\"><a ng-if=ss.inip>{{ss.inips.edit_time}}</a> <a ng-if=\"ss.exip && ! ss.inip\">{{ss.exips.edit_time}}</a></td><td style=\"width: 20%\" data-title=\"\'客户端错误原因\'\"><a ng-if=\"ss.inip && ss.inips.status==\'fail\'\">failcount:{{ss.inips.fail}}; {{ss.inips.reason}}</a> <a ng-if=\"ss.exip && ! ss.inip && ss.exips.status==\'fail\'\">failcount:{{ss.exips.fail}}; {{ss.exips.reason}}</a></td></tr></table></div></div></div><div ng-if=sendfile.filepath class=\"panel panel-dark\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-dark\" uib-tooltip=刷新 ng-click=sendfile.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!sendfile.loadover}\"></i></button></span><h5>文件管理</h5></div><form class=form-horizontal name=cForm role=form ng-init=\"openc3_job_system_only=0\"><div class=row><div class=\"col-sm-8 form-group\"><label class=\"col-sm-1 control-label\">地址</label><div class=col-sm-7><input type=text class=form-control name=tpath placeholder=路径 ng-minlength=2 ng-model=sendfile.filepath required> <span style=color:red ng-show=cForm.tpath.$error.minlength>不少于2字符</span></div></div><div class=\"col-sm-4 form-group\"><button class=\"btn btn-primary\" ng-click=sendfile.reload()>手动输入查询</button> <button class=\"btn btn-primary\" ng-click=sendfile.reset()>重置</button> <button class=\"btn btn-primary\" ng-if=\"openc3_job_system_only==0\" ng-click=sendfile.openOneTab()>打开主机终端</button></div></div></form><hr><div class=panel-body><div style=\"float: left;width: 60%\"><table ng-table=sendfile.dir_Table class=\"table table-hover text-center table-condensed\" show-filter=true style=\"border: 1px solid #ddd\"><tr ng-repeat=\"ss in $data\" style=\"text-align: left\"><td data-title=\"\'主机\'\">{{ss.host}}</td><td data-title=\"\'信息\'\">{{ss.info}}</td><td data-title=\"\'类型\'\">{{ss.type}}</td><td data-title=\"\'路径\'\">{{ss.path}}</td><td class=textcenter width=75 data-title=\"\'操作\'\"><nobr><i ng-if=\"ss.type==\'parent\'\" class=\"fa fa-chevron-circle-left fa-2x\" aria-hidden=true ng-click=sendfile.backdir() uib-tooltip=返回上一层 style=\"cursor:pointer;color: red\"></i> <i ng-if=\"ss.type==\'dir\'\" class=\"fa fa-chevron-circle-right fa-2x\" aria-hidden=true ng-click=\"sendfile.intodir( ss.path )\" uib-tooltip=进入 style=\"cursor:pointer;color: #339094\"></i> <i ng-if=\"ss.type==\'file\'\" class=\"fa fa-download fa-2x\" aria-hidden=true ng-click=sendfile.startDownloadTask(ss.path) uib-tooltip=下载 style=\"cursor:pointer;color: green\"></i> <i ng-if=\"ss.type==\'file\'\" class=\"fa fa-times-circle fa-2x\" aria-hidden=true ng-click=sendfile.unlinkfile(ss.path) uib-tooltip=删除文件 style=\"cursor:pointer;color: red\"></i></nobr></td></tr></table></div><div style=\"float: right;width: 37%\"><input type=file id=choicefiles style=\"display: none\" onchange=angular.element(this).scope().upForm() multiple> <button class=\"btn btn-primary\" ng-click=sendfile.clickImport()><span class=\"glyphicon glyphicon-upload\" style=\"padding: 0 3px\"></span>上传文件</button><table ng-table=sendfile.fileserver_Table class=\"table table-hover text-center table-condensed\" show-filter=true style=\"border: 1px solid #ddd\"><tr ng-repeat=\"ss in $data\" style=\"text-align: left\"><td data-title=\"\'ID\'\">{{ss.id}}</td><td data-title=\"\'文件名\'\">{{ss.name}}</td><td data-title=\"\'大小\'\">{{sendfile.bytesToSize(ss.size)}}</td><td class=textcenter width=75 data-title=\"\'操作\'\"><nobr><i class=\"fa fa-upload fa-2x\" aria-hidden=true ng-click=\"sendfile.startUoloadTask( ss.name )\" uib-tooltip=上传 style=\"cursor:pointer;color: #339094\"></i> <i class=\"fa fa-download fa-2x\" aria-hidden=true ng-click=sendfile.downloadfile(ss.name) uib-tooltip=下载 style=\"cursor:pointer;color: green\"></i> <i class=\"fa fa-times-circle fa-2x\" aria-hidden=true ng-click=sendfile.deleteFile(ss.id) uib-tooltip=删除 style=\"cursor:pointer;color: red\"></i></nobr></td></tr></table><table ng-table=sendfile.sendfiletask_Table class=\"table table-hover text-center table-condensed\" show-filter=true style=\"border: 1px solid #ddd\"><tr ng-repeat=\"ss in $data\" style=\"text-align: left\"><td data-title=\"\'今日任务\'\">{{ss.name}}</td><td data-title=\"\'操作人\'\">{{ss.user}}</td><td data-title=\"\'耗时(秒)\'\">{{ss.runtime}}</td><td data-title=\"\'状态\'\">{{ss.status}}</td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/quickentry/smallapplication/create.html","<div class=modal-header><h4 class=modal-title>添加轻应用</h4></div><div class=modal-body><form class=form-horizontal name=myForm role=form><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">作业: &nbsp;</label><div class=col-sm-9><select class=form-control style=\"font-size: 15px;height: 42px\" ng-model=choiceJob ng-options=\"s.alias for s in allJobs\" required></select></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">标题</label><div class=col-sm-9><input type=text class=form-control name=adduser placeholder=标题 ng-model=smallapplicationcreate.postdata.title required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">类型</label><div class=col-sm-9><input type=text class=form-control name=adduser placeholder=类型 ng-model=smallapplicationcreate.postdata.type required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">描述</label><div class=col-sm-9><input type=text class=form-control name=adduser placeholder=描述 ng-model=smallapplicationcreate.postdata.describe required></div></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=smallapplicationcreate.add()>确认</button> <button class=\"btn btn-warning\" ng-click=smallapplicationcreate.cancel()>取消</button></div></div></form></div>");
$templateCache.put("app/pages/quickentry/smallapplication/edit.html","<div class=\"row block\"><h2>全局轻应用编辑</h2><hr class=\"mv20 clear\"><div><div style=\"float: right\"><form class=form-inline name=myForm novalidate><button type=submit class=\"btn btn-primary\" style=\"padding: 10px 25px\" ng-click=smallapplicationedit.createSmallApplication()><i class=\"fa fa-plusecircle fa-lg\" aria-hidden=true></i> 添加轻应用</button></form></div><div style=\"clear: both\">&nbsp;</div></div><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=smallapplicationedit.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!smallapplicationedit.loadover}\"></i></button></span><h5>轻应用</h5></div><div class=panel-body><div class=pt20 style=\"overflow: auto\"><table ng-table=smallapplicationedit.dataTable class=\"table table-scroll table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td width=60 class=textcenter data-title=\"\'ID\'\" filter=\"{ id: \'text\'}\" sortable>{{m.id}}</td><td data-title=\"\'类型\'\" width=80 filter=\"{ type: \'text\'}\" sortable>{{m.type}}</td><td data-title=\"\'名称\'\" width=80 filter=\"{ title: \'text\'}\" sortable>{{m.title}}</td><td data-title=\"\'描述\'\" width=80 filter=\"{ describe: \'text\'}\" sortable>{{m.describe}}</td><td data-title=\"\'创建人\'\" width=80 filter=\"{ create_user: \'text\'}\" sortable>{{m.create_user}}</td><td data-title=\"\'最后编辑人\'\" width=80 filter=\"{ edit_user: \'text\'}\" sortable>{{m.edit_user}}</td><td data-title=\"\'创建时间\'\" width=80 filter=\"{ create_time: \'text\'}\" sortable>{{m.create_time}}</td><td data-title=\"\'最后更新时间\'\" width=80 filter=\"{ edit_time: \'text\'}\" sortable>{{m.edit_time}}</td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-times-circle fa-2x\" aria-hidden=true ng-click=smallapplicationedit.deleteSmallApplication(m.id) uib-tooltip=删除 style=\"cursor:pointer;color: red\"></i></td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/quickentry/smallapplication/smallapplication.html","<div class=\"row block\"><h2>全局轻应用</h2><hr class=\"mv20 clear\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=smallapplication.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!smallapplication.loadover}\"></i></button></span><h5>轻应用</h5></div><div class=panel-body><div class=pt20 style=\"overflow: auto\"><table ng-table=smallapplication.dataTable class=\"table table-scroll table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td width=60 class=textcenter data-title=\"\'ID\'\" filter=\"{ id: \'text\'}\" sortable>{{m.id}}</td><td data-title=\"\'类型\'\" width=80 filter=\"{ type: \'text\'}\" sortable>{{m.type}}</td><td data-title=\"\'名称\'\" width=80 filter=\"{ title: \'text\'}\" sortable>{{m.title}}</td><td data-title=\"\'描述\'\" width=80 filter=\"{ describe: \'text\'}\" sortable>{{m.describe}}</td><td data-title=\"\'创建人\'\" width=80 filter=\"{ create_user: \'text\'}\" sortable>{{m.create_user}}</td><td data-title=\"\'最后编辑人\'\" width=80 filter=\"{ edit_user: \'text\'}\" sortable>{{m.edit_user}}</td><td data-title=\"\'创建时间\'\" width=80 filter=\"{ create_time: \'text\'}\" sortable>{{m.create_time}}</td><td data-title=\"\'最后更新时间\'\" width=80 filter=\"{ edit_time: \'text\'}\" sortable>{{m.edit_time}}</td><td data-title=\"\'操作\'\" width=80><i class=\"fa fa-chevron-circle-right fa-2x\" aria-hidden=true ui-sref=\"home.quickentry.runtasksa({treeid: {{m.projectid}}, jobid: {{m.jobid}}})\" uib-tooltip=进入 style=\"cursor:pointer;color: #339094\"></i></td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/quickentry/terminal/terminal.html","<div><div class=row style=\"padding: 0 20px 0\"><nodestr></nodestr></div><hr class=\"mv10 clear\"><div class=row><div class=\"col-sm-8 form-group\"><label class=control-label style=\"padding-top: 8px;padding-right: 0;width: 11%;float: left;position: relative;min-height: 1px;padding-left: 15px\">执行账户</label><div class=col-sm-4><form action=\"\"><select class=form-control style=\"font-size: 15px;height: 35px;padding: 3px 12px\" ng-model=selectedUser ng-options=\"s.username as s.username for s in allProUsers\" required></select></form></div></div></div><div class=\"panel panel-dark\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-dark\" uib-tooltip=刷新 ng-click=templatecmd.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!templatecmd.loadover}\"></i></button></span><h5>选择操作节点</h5></div><div class=panel-body><div style=\"float: left;width: 60%\"><table ng-table=templatecmd.machine_Table class=\"table table-hover text-center table-condensed\" show-filter=true style=\"border: 1px solid #ddd\"><tr ng-repeat=\"ss in $data\" style=\"text-align: left\"><!-- <td style=\"width: 15%\" data-title=\"\'机器名称\'\" filter=\"{ name: \'text\'}\"><input id=\"{{ss.name}}\" type=\"checkbox\" name=\"selected\"  ng-checked=\"isSelected(ss.name)\" ng-click=\"nameUpdateSelection($event, ss.id, ss.name)\" style=\"zoom: 125%\"/>\n                                <a style=\"cursor: pointer;\" title=\"打开终端\" ng-click=\"openOneTab(ss.name)\">{{ss.name}}</a></td> --><td style=\"width: 15%\" data-title=\"\'机器名称\'\">{{ss.name}}</td><td style=\"width: 5%\" data-title=\"\'类型\'\" filter=\"{ type: \'text\'}\">{{ss.type}}</td><td style=\"width: 15%\" data-title=\"\'内网IP\'\" filter=\"{ inip: \'text\'}\"><input id={{ss.inip}} ng-if=ss.inip type=checkbox name=selected ng-checked=isSelected(ss.inip) ng-click=\"inipUpdateSelection($event, ss.id, ss.inip)\" style=\"zoom: 125%\"> <a style=\"cursor: pointer\" title=打开终端 ng-click=openOneTab(ss.inip)>{{ss.inip}}</a> <i ng-if=\"ss.inip && ! ss.inips.status\" class=\"fa fa-exclamation-circle\" aria-hidden=true></i> <i ng-if=\"ss.inip && ss.inips.status==\'fail\'\" class=\"fa fa-circle\" style=\"color: red\" aria-hidden=true></i> <i ng-if=\"ss.inip && ss.inips.status==\'success\'\" class=\"fa fa-circle\" style=\"color: green\" aria-hidden=true></i></td><td style=\"width: 15%\" data-title=\"\'外网ip\'\" filter=\"{ exip: \'text\'}\"><input ng-if=ss.exip id={{ss.exip}} type=checkbox name=selected ng-checked=isSelected(ss.exip) ng-click=\"exipUpdateSelection($event, ss.id, ss.exip)\" style=\"zoom: 125%\"> <a style=\"cursor: pointer\" title=打开终端 ng-click=openOneTab(ss.exip)>{{ss.exip}}</a> <i ng-if=\"ss.exip && ! ss.exips.status\" class=\"fa fa-exclamation-circle\" aria-hidden=true></i> <i ng-if=\"ss.exip && ss.exips.status==\'fail\'\" class=\"fa fa-circle\" style=\"color: red\" aria-hidden=true></i> <i ng-if=\"ss.exip && ss.exips.status==\'success\'\" class=\"fa fa-circle\" style=\"color: green\" aria-hidden=true></i></td><td style=\"width: 5%\" data-title=\"\'客户端版本\'\"><a ng-if=ss.inip>{{ss.inips.version}}</a> <a ng-if=\"ss.exip && ! ss.inip\">{{ss.exips.version}}</a></td><td style=\"width: 20%\" data-title=\"\'客户端上一次检测时间\'\"><a ng-if=ss.inip>{{ss.inips.edit_time}}</a> <a ng-if=\"ss.exip && ! ss.inip\">{{ss.exips.edit_time}}</a></td><td style=\"width: 20%\" data-title=\"\'客户端错误原因\'\"><a ng-if=\"ss.inip && ss.inips.status==\'fail\'\">failcount:{{ss.inips.fail}}; {{ss.inips.reason}}</a> <a ng-if=\"ss.exip && ! ss.inip && ss.exips.status==\'fail\'\">failcount:{{ss.exips.fail}}; {{ss.exips.reason}}</a></td></tr></table></div><div style=\"float: right;width: 37%\"><table ng-table=choice.choiceResult class=\"table table-hover\" style=\"border: 1px solid #ddd\"><thead><tr><th style=\"text-align: left\">地址</th><th style=\"text-align: left\">操作</th></tr></thead><tbody><tr ng-repeat=\"ss in selectedData\"><td>{{ss}}</td><td><button ng-click=templatecmd.delChoice($index)>删除</button></td></tr></tbody></table><div><!--\n                    <button class=\"btn btn-info\" style=\"margin-left: 42%\" ng-click=\"templatecmd.openTailLog()\">\n                        实时日志\n                    </button>\n                    --> <button class=\"btn btn-success\" ng-click=templatecmd.openNewTab()>开始操作</button> <button class=\"btn btn-danger\" ng-click=templatecmd.delAllData()>清除</button></div></div></div></div></div>");
$templateCache.put("app/pages/business/agent/detail/agent.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=agent.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!agent.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=agent.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>{{ agent.nodeStr }} 区域:{{agent.regionname}}</h5></div><div class=panel-body><div class=pt20><table ng-table=agent.agentlistTable class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"m in $data\"><td data-title=\"\'ID\'\">{{m.id}}</td><td data-title=\"\'网段\'\">{{m.ip}}</td><td data-title=\"\'删除\'\"><button class=\"btn btn-effect-ripple btn-xs btn-danger ng-scope\" uib-tooltip=删除网段 ng-click=\"agent.deleteAgent( m.id )\"><i class=\"fa fa-trash\"></i></button></td></tr></table><hr><div><div class=col-md-8><input class=form-control ng-model=agent.install.ip placeholder=\"ip网段，如: 10.10.10.10/24 ,多个用逗号或者空格分开\"></div><button class=\"btn btn-primary\" ng-click=\"agent.addSubNet( )\">添加网段</button></div></div></div></div></div>");
$templateCache.put("app/pages/business/agent/detail/host.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=host.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!host.loadover}\"></i></button></span><h5>{{ host.nodeStr }} : regionid:{{host.regionid}}</h5></div><div class=panel-body><div class=pt20><table ng-table=host.hostlistTable class=\"table table-hover text-center table-condensed\"><thead><tr><th>ID</th><th><input type=checkbox ng-model=all_name ng-click=host.check_name(all_name)> 机器名</th><th>类型</th><th><input type=checkbox ng-model=all_inip ng-click=host.check_inip(all_inip)>内外IP</th><th><input type=checkbox ng-model=all_exip ng-click=host.check_exip(all_exip)>外网IP</th></tr></thead><tbody><tr ng-repeat=\"m in $data\"><td>{{m.id}}</td><td><input type=checkbox ng-model=m.selected_name ng-checked=s_name> {{m.name}}</td><td>{{m.type}}</td><td><input ng-if=m.inip type=checkbox ng-model=m.selected_inip ng-checked=s_inip>{{m.inip}}</td><td><input ng-if=m.exip type=checkbox ng-model=m.selected_exip ng-checked=s_exip>{{m.exip}}</td></tr></tbody></table></div></div><div class=\"panel-footer text-right\"><button class=\"btn btn-primary\" ng-click=host.save()>选中</button> <button class=\"btn btn-warning\" ng-click=host.cancel()>取消</button></div></div></div>");
$templateCache.put("app/pages/business/agent/detail/log.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=agentctrlLog.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!agentctrlLog.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=agentctrlLog.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>{{ agentctrlLog.nodeStr }}</h5></div><div class=panel-body><div class=pt20><table ng-table=agentctrlLog.activeRegionTable class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"m in $data\"><td data-title=\"\'编号\'\">{{m.id}}</td><td data-title=\"\'操作人\'\">{{m.user}}</td><td data-title=\"\'日志内容\'\">{{m.info}}</td><td data-title=\"\'操作时间\'\">{{m.create_time}}</td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/business/agent/detail/proxy.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=proxy.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!proxy.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=proxy.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>{{ proxy.nodeStr }} 区域:{{proxy.regionname}}</h5></div><div class=panel-body ng-init=\"s = { \'fail\': \'失败\', \'success\': \'成功\'}\"><div class=pt20><table ng-table=proxy.proxylistTable class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"m in $data\"><td data-title=\"\'ID\'\">{{m.id}}</td><td data-title=\"\'ip\'\">{{m.ip}}</td><td data-title=\"\'状态\'\">{{s[m.status]}}</td><td data-title=\"\'版本\'\">{{m.version||\'未知\'}}</td><td data-title=\"\'失败次数\'\">{{m.fail}}</td><td data-title=\"\'理由\'\">{{m.reason}}</td><td data-title=\"\'删除\'\"><button class=\"btn btn-effect-ripple btn-xs btn-danger ng-scope\" uib-tooltip=删除区域 ng-click=\"proxy.deleteProxy( m.id )\"><i class=\"fa fa-trash\"></i></button></td></tr></table><hr><div><div class=col-md-1><a class=\"fwbold label label-info\" href=javascript:void(0) uib-tooltip=点击从服务树选择机器 ng-click=proxy.selectIpFromTree()>服务树</a></div><div class=col-md-8><input class=form-control ng-model=proxy.install.ip placeholder=ip列表,用逗号或者空格分开></div><button class=\"btn btn-primary\" ng-click=\"proxy.installProxy( \'import\' )\">导入代理</button></div></div></div></div></div>");
$templateCache.put("app/pages/business/agent/detail/region.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=region.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!region.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=保存 ng-click=region.save()><i class=\"fa fa-floppy-o\" aria-hidden=true></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=region.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>{{ region.nodeStr }}</h5></div><div class=panel-body><div class=pt20><table ng-table=region.proxylistTable class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"m in $data\"><td data-title=\"\'ID\'\">{{m.id}}</td><td data-title=\"\'选择\'\"><input type=checkbox ng-model=m.selected></td><td data-title=\"\'区域\'\"><font size=5>{{m.name}}</font></td><td data-title=\"\'删除\'\"><button class=\"btn btn-effect-ripple btn-xs btn-danger ng-scope\" ng-if=\"m.projectid == region.treeid\" uib-tooltip=删除区域 ng-click=\"region.deleteRegion( m.id )\"><i class=\"fa fa-trash\"></i></button></td></tr><tr><td colspan=5 style=text-align:left><a ng-if=!region.showRegionBool ng-click=region.showRegion(1)><font size=5>+自定义一个区域</font></a><div ng-if=region.showRegionBool><div class=col-md-8><input class=form-control ng-model=region.regionText placeholder=新区域></div><button class=\"btn btn-primary\" ng-if=region.regionText uib-tooltip=保存 ng-click=region.createRegion()>保存</button> <button class=\"btn btn-warning\" uib-tooltip=取消 ng-click=region.showRegion(0)>取消</button></div></td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/business/job/edit/cloneJob.html","<div style=\"width: 100%\"><div id=sidebar_left class=affix style=\"padding-top: 0;min-height: 540px\"><div id=\"sidebar-scroll nav sidebar-menu\"><div class=sidebar-content><div class=panel style=\"margin: 0\"><div class=panel-heading><span class=panel-title>TREE</span> <span class=panel-controls><a href=javascript:void(0) ng-click=clonejob.focusCurrent()><i class=\"fa fa-map-marker\"></i></a> <a href=javascript:void(0) ng-click=clonejob.expandAll(true)><i class=\"fa fa-plus\"></i></a> <a href=javascript:void(0) ng-click=clonejob.expandAll(false)><i class=\"fa fa-minus\"></i></a> <a href=javascript:void(0) ng-click=clonejob.refresh()><i class=\"treeFresh fa fa-refresh\"></i></a></span></div><div class=\"panel-body prn\" style=\";padding: 0\"><perfect-scrollbar class=scroller><ul class=ztree id=openc3treeclone></ul></perfect-scrollbar></div></div></div></div></div><div id=content_wrapper style=\"min-height: 540px\"><div class=panel-heading><span class=panel-title>目标节点</span> <span class=panel-controls><a href=javascript:void(0) ng-click=clonejob.cancel()><i class=\"fa fa-close\"></i></a></span></div><div class=panel-body style=\"padding: 10px;height: 540px\"><div class=panel-tabs><table class=\"table table-hover text-center table-condensed\"><thead><tr><th style=\"text-align: center\">节点ID</th><th style=\"text-align: center\">节点名称</th><th style=\"text-align: center\">操作</th></tr></thead><tbody><tr ng-repeat=\"(k, node) in clonejob.cloneNodes \"><td>{{node.id}}</td><td>{{node.name}}</td><td><button class=\"btn btn-danger btn-sm\" ng-click=clonejob.delNode(k)>删除</button></td></tr></tbody></table></div></div><div class=row><div class=\"col-sm-3 form-group\" style=\"margin-left: 40%\"><button class=\"btn btn-primary\" ng-disabled=dstForm.$invalid ng-click=clonejob.saveNode()>保存</button> <button class=\"btn btn-warning\" ng-click=clonejob.cancel()>取消</button></div></div></div></div>");
$templateCache.put("app/pages/business/job/edit/postClone.html","<div style=\"width: 100%\"><div class=panel-heading><span class=panel-title>目标节点</span> <span class=panel-controls><a href=javascript:void(0) ng-click=postclone.cancel()><i class=\"fa fa-close\"></i></a></span></div><div class=panel-body style=\"padding: 10px\"><div class=panel-tabs><table class=\"table table-hover text-center table-condensed\"><thead><tr><th style=\"text-align: center;width: 18%\">节点ID</th><th style=\"text-align: center;width: 18%\">节点名称</th><th style=\"text-align: center;width: 18%\">状态</th><th style=\"text-align: center\">结果</th></tr></thead><tbody><tr ng-repeat=\"(k, node) in postclone.cloneNodes \"><td>{{node.id}}</td><td>{{node.name}}</td><td ng-if=node.status style=\"color: green;font-weight: bold\">成功</td><td ng-if=!node.status style=\"color: red;font-weight: bold\">失败</td><td>{{node.msg}}</td></tr></tbody></table></div></div><div class=row><div class=\"col-sm-3 form-group\" style=\"margin-left: 45%\"><button class=\"btn btn-primary\" ng-click=postclone.closeTab()>确定</button></div></div></div>");
$templateCache.put("app/pages/business/job/plugin/approval.html","<div class=modal-header><h4 class=modal-title>新建审批步骤</h4></div><div class=\"panel panel-primary\"><div class=panel-body><div class=form-horizontal><form class=form-horizontal name=myForm role=form novalidate><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">作业名称<span style=\"color: red\">*</span></label><div class=col-sm-9><input type=text class=form-control ng-model=approvaljob.postdata.name required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">审批内容<span style=\"color: red\">*</span></label><div class=col-sm-9><textarea type=textarea class=form-control ng-model=approvaljob.postdata.cont required></textarea></div></div><a class=\"glyphicon glyphicon-question-sign\" data-toggle=tooltip data-placement=right target=_blank ng-href=/book/发起审批/ uib-tooltip=查看审批内容使用变量帮助 aria-hidden=true style=\"padding-top: 11px;font-size: larger\"></a></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">审批人<span style=\"color: red\">*</span></label><div class=col-sm-9><input type=text class=form-control ng-model=approvaljob.postdata.approver required></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">生效环境 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClickDeployenv><input type=radio name=unClickDeployenv ng-model=approvaljob.postdata.deployenv value=always> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>总是执行</label><label class=\"option option-primary\"><input type=radio name=unClickDeployenv ng-model=approvaljob.postdata.deployenv value=test> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>测试环境</label><label class=\"option option-primary\"><input type=radio name=unClickDeployenv ng-model=approvaljob.postdata.deployenv value=online> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>线上环境</label></div></div></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">生效动作 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClickAction><input type=radio name=unClickAction ng-model=approvaljob.postdata.action value=always> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>总是执行</label><label class=\"option option-primary\"><input type=radio name=unClickAction ng-model=approvaljob.postdata.action value=deploy> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅发布时执行</label><label class=\"option option-primary\"><input type=radio name=unClickAction ng-model=approvaljob.postdata.action value=rollback> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅回滚时执行</label></div></div></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">分批 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClickBatches><input type=radio name=unClickBatches ng-model=approvaljob.postdata.batches value=always> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>总是执行</label><label class=\"option option-primary\"><input type=radio name=unClickBatches ng-model=approvaljob.postdata.batches value=firsttime> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅第一个分组</label><label class=\"option option-primary\"><input type=radio name=unClickBatches ng-model=approvaljob.postdata.batches value=thelasttime> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅最后一个分组</label></div></div></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">所有审批人都要审批<span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\"><input type=radio name=unClickEveryone ng-model=approvaljob.postdata.everyone value=on> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>是</label><label class=\"option option-primary\"><input type=radio name=unClickEveryone ng-model=approvaljob.postdata.everyone value=off> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>只要一个人审批</label></div></div></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">超时时间</label><div class=col-sm-9><input type=text class=form-control placeholder=脚本执行超时时间，单位为秒，默认60秒 ng-model=approvaljob.postdata.timeout></div></div></div><div class=row><div class=\"col-sm-3 form-group\" style=\"margin-left: 40%\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=approvaljob.returnData()>保存</button> <button class=\"btn btn-warning\" ng-click=approvaljob.cancel()>取消</button></div></div></form></div></div></div>");
$templateCache.put("app/pages/business/job/plugin/cmd.html","<div class=modal-header><h4 class=modal-title>新建脚本步骤</h4></div><div class=\"panel panel-primary\" ng-init=\"openc3_job_system_only=0\"><div class=panel-body><div class=form-horizontal><form class=form-horizontal name=scriptForm role=form novalidate><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">作业名称 <span style=\"color: red\">*</span></label><div class=col-sm-9><input type=text class=form-control name=s_name ng-model=scriptjob.s_name ng-minlength=3 ng-disabled=unClick required> <span style=color:red ng-show=scriptForm.s_name.$error.minlength>不少于2字符</span></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">脚本来源 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClick><input type=radio name=src ng-model=scriptjob.from value=manual ng-click=scriptjob.scriptManual() ng-disabled=unClick> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>手工录入</label><label class=\"option option-primary\"><input type=radio name=src ng-model=scriptjob.from value=clone ng-click=scriptjob.scriptClone() ng-disabled=unClick> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>脚本克隆</label><label class=\"option option-primary\"><input type=radio name=src ng-model=scriptjob.from value=local ng-click=scriptjob.scriptLocal() ng-disabled=unClick> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>本地脚本</label></div><div ng-hide=scriptjob.scriptHide style=\"padding-top: 10px; padding-left: 0\"><select class=form-control ng-model=selectedScript ng-change=scriptjob.inputScript() ng-options=\"s.name for s in allScript\"></select></div></div></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">脚本内容 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=\"panel panel-primary\"><div style=\"border: 1px solid #e5e5e5;padding: 10px\"><div class=admin-form><div class=\"option-group field\" style=\"padding-bottom: 9px\"><label class=\"option option-primary\"><input type=radio name=cont ng-model=scriptType ng-click=scriptjob.editorSh() ng-disabled=scriptUnclick value=shell> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>shell</label><label class=\"option option-primary\"><input type=radio name=cont ng-model=scriptType ng-click=scriptjob.editorPy() ng-disabled=scriptUnclick value=python> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>python</label><label class=\"option option-primary\"><input type=radio name=cont ng-model=scriptType ng-click=scriptjob.editorPerl() ng-disabled=scriptUnclick value=perl> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>perl</label><label class=\"option option-primary\"><input type=radio name=cont ng-model=scriptType ng-click=scriptjob.editorPhp() ng-disabled=scriptUnclick value=php> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>php</label><label class=\"option option-primary\"><input type=radio name=cont ng-model=scriptType ng-click=scriptjob.editorBuildin() ng-disabled=scriptUnclick value=buildin> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>内建</label><label class=\"option option-primary\"><input type=radio name=cont ng-model=scriptType ng-click=scriptjob.editorAuto() ng-disabled=scriptUnclick value=auto> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>自动识别</label></div></div><div ng-show=\"scriptType==\'buildin\' && scriptjob.from == \'manual\'\" class=admin-form><div class=\"option-group field\" style=\"padding-bottom: 9px\"><label class=\"option option-primary\" style=cursor:default>内建插件:</label><label class=\"option option-primary\" ng-click=\"scriptjob.buildinSet( \'kubectl\' )\">kubectl</label><label class=\"option option-primary\" ng-click=\"scriptjob.buildinSet( \'terraform\' )\">terraform</label><label class=\"option option-primary\" ng-click=\"scriptjob.buildinSet( \'kubestar\' )\">kubestar</label><label class=\"option option-primary\" ng-click=\"scriptjob.buildinSet( \'awsecs\' )\">awsecs</label><label class=\"option option-primary\" ng-click=\"scriptjob.buildinSet( \'sendemail\' )\">sendemail</label><label class=\"option option-primary\" ng-click=\"scriptjob.buildinSet( \'sendmesg\' )\">sendmesg</label><label class=\"option option-primary\" ng-click=\"scriptjob.buildinSet( \'flowcaller\' )\">flowcaller</label><label class=\"option option-primary\" ng-click=\"scriptjob.buildinSet( \'cdnrefresh\' )\">cdnrefresh</label><label class=\"option option-primary\" ng-click=\"scriptjob.buildinSet( \'kubernetes\' )\">kubernetes</label></div></div><div class=form-horizontal><div style=height:400px class=form-group id=editor ng-mouseleave=scriptjob.leaveeditor()></div></div></div></div></div></div><a class=\"glyphicon glyphicon-question-sign\" data-toggle=tooltip data-placement=right target=_blank ng-href=/book/客户端内置命令/ uib-tooltip=查看客户端内置命令帮助 aria-hidden=true style=\"padding-top: 11px;font-size: larger\"></a></div><div class=row ng-show=\"scriptType!=\'buildin\'\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">执行账户 <span style=\"color: red\">*</span></label><div class=col-sm-7><select class=form-control style=\"font-size: 15px;height: 42px\" ng-model=selectedUser><option ng-repeat=\"x in allProUsers\" value={{x.username}}>{{x.username}}</option></select></div><button class=\"btn btn-primary col-sm-1\" uib-tooltip=添加 ng-click=scriptjob.addProUser()><i class=\"fa fa-plus\"></i></button></div></div><div class=row ng-show=\"scriptType==\'buildin\'\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">使用凭据 &nbsp&nbsp</label><div class=col-sm-7><select class=form-control ng-model=selectedUser><option ng-repeat=\"x in scriptjob.ticketinfo\" value={{x.id}}>{{x.name}}</option></select></div></div></div><div class=row><div class=\"col-sm-10 form-group\" style=\"margin-top: -23px\"><label class=\"col-sm-3 control-label\"></label><div class=col-sm-7><dataerror ng-hide=dataready errmsg={{dataerror}}></dataerror></div></div></div><div ng-show=scriptjob.showmachinelist class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">目标机器 <span style=\"color: red\">*</span></label><div class=col-sm-9><button class=\"btn btn-primary\" ng-click=scriptjob.choiceServer() required>选择服务器</button><table ng-table=choice.choiceResult class=\"table table-hover\" ng-show=choiceShow style=\"margin-top: 10px;border: 1px solid #ddd\"><thead><tr><th style=\"text-align: left\">编号</th><th style=\"text-align: left\">名称</th><th style=\"text-align: left\">类型</th><th style=\"text-align: left\">操作</th></tr></thead><tbody><tr ng-repeat=\"ss in choiceResult\"><td>{{$index + 1}}</td><td ng-if=\"nodeType ==\'group\'\">{{ss.name}}</td><td ng-if=\"nodeType ==\'builtin\'\">{{ss}}</td><td ng-if=\"nodeType ==\'variable\'\">{{ss.variable}}</td><td>{{choiceType}}</td><td><button ng-if=\"nodeType ==\'group\'\" ng-click=\"scriptjob.delChoice($index, ss.name)\">删除</button> <button ng-if=\"nodeType ==\'builtin\'\" ng-click=\"scriptjob.delChoice($index, ss)\">删除</button> <button ng-if=\"nodeType ==\'variable\'\" ng-click=\"scriptjob.delChoice($index, ss.variable)\">删除</button></td></tr></tbody></table></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">脚本参数</label><div class=col-sm-9><input type=text class=form-control ng-model=s_argv></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">超时时间</label><div class=col-sm-9><input type=text class=form-control placeholder=脚本执行超时时间，单位为秒，默认60秒 ng-model=s_timeout></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">结束是否暂停</label><div class=col-sm-9><input type=text class=form-control placeholder=任务执行结束后是否暂停，如果不填，则表示不停止。 ng-model=pause></div></div></div><div class=row ng-if=\"openc3_job_system_only==0\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">生效环境 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClickDeployenv><input type=radio name=unClickDeployenv ng-model=scriptjob.postdata.deployenv value=always> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>总是执行</label><label class=\"option option-primary\"><input type=radio name=unClickDeployenv ng-model=scriptjob.postdata.deployenv value=test> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>测试环境</label><label class=\"option option-primary\"><input type=radio name=unClickDeployenv ng-model=scriptjob.postdata.deployenv value=online> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>线上环境</label></div></div></div></div></div><div class=row ng-if=\"openc3_job_system_only==0\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">生效动作 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClickAction><input type=radio name=unClickAction ng-model=scriptjob.postdata.action value=always> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>总是执行</label><label class=\"option option-primary\"><input type=radio name=unClickAction ng-model=scriptjob.postdata.action value=deploy> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅发布时执行</label><label class=\"option option-primary\"><input type=radio name=unClickAction ng-model=scriptjob.postdata.action value=rollback> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅回滚时执行</label></div></div></div></div></div><div class=row ng-if=\"openc3_job_system_only==0\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">分批 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClickBatches><input type=radio name=unClickBatches ng-model=scriptjob.postdata.batches value=always> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>总是执行</label><label class=\"option option-primary\"><input type=radio name=unClickBatches ng-model=scriptjob.postdata.batches value=firsttime> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅第一个分组</label><label class=\"option option-primary\"><input type=radio name=unClickBatches ng-model=scriptjob.postdata.batches value=thelasttime> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅最后一个分组</label></div></div></div></div></div><div class=row><div class=\"col-sm-3 form-group\" style=\"margin-left: 40%\"><button class=\"btn btn-success\" ng-disabled=scriptForm.$invalid ng-click=scriptjob.returnSave(scriptForm)>保存</button> <button class=\"btn btn-warning\" ng-click=scriptjob.cancel(scriptForm)>取消</button></div></div></form></div></div></div>");
$templateCache.put("app/pages/business/job/plugin/scp.html","<div class=modal-header><h4 class=modal-title>新建分发文件步骤</h4></div><form class=form-horizontal name=dstForm role=form novalidate><div style=\"width: 90%;margin-left: 5%;margin-bottom: 15px;margin-top: 10px\"><div class=row><div class=col-sm-10><label class=\"col-sm-2 control-label\">作业名称 <span style=\"color: red\">*</span></label><div class=col-sm-9><input type=text class=form-control name=s_name ng-model=dstDate.name required> <span style=color:red ng-show=\"dstForm.s_name.$dirty && dstForm.s_name.$error.required\">输入作业名称</span></div></div></div></div><div class=\"panel panel-primary\" style=\"width: 90%;margin-left: 5%\" ng-init=\"openc3_job_system_only=0\"><div class=panel-body><div class=form-horizontal><div class=row><div class=\"col-sm-12 form-group\"><label class=col-sm-2 style=\"font-size: 16px;padding-top: 10px\"><span class=\"glyphicon glyphicon-hdd\" style=\"padding: 0 3px\"></span>源文件</label><label class=col-sm-3 style=\"font-size: 16px;padding-top: 3px\"><span style=\"font-weight: normal;font-size: 12px\">注意：本地文件上传会有同名文件覆盖危险</span></label><div class=col-sm-7><button class=\"btn btn-primary\" ng-click=scpjob.choiceShareFiles()><span class=\"glyphicon glyphicon-cloud\" style=\"padding: 0 3px\"></span>选择共享文件</button> <button class=\"btn btn-primary\" ng-click=scpjob.choiceSourceFile()><span class=\"glyphicon glyphicon-oil\" style=\"padding: 0 3px\"></span>选择源服务器文件</button> <button class=\"btn btn-primary\" ng-if=\"openc3_job_system_only==0\" ng-click=scpjob.choiceVariable()>选择构建文件</button></div></div></div><div class=row><div class=col-sm-11 style=\"margin-left: 1%\"><table ng-table=choice.shareResult class=\"table table-hover\" style=\"border: 1px solid #ddd\"><thead><tr ng-if=!varShow><th style=\"text-align: left;width: 27%\">文件列表</th><th style=\"text-align: left;width: 29%\">服务器地址</th><th ng-hide=true style=\"text-align: left;width: 25%\">执行账户</th></tr><tr ng-if=varShow><th style=\"text-align: left;width: 27%\">构建ID(流水线ID)</th><th style=\"text-align: left;width: 29%\">版本</th><th ng-hide=true style=\"text-align: left;width: 25%\">执行账户</th></tr></thead><tbody id=srcbody><!--共享文件--><tr ng-repeat=\"ss in shareResult\"><td>{{ss.name}}</td><td>默认空</td><td ng-hide=true><select class=form-control style=\"font-size: 18px\" disabled ng-model=dstUser ng-options=\"s.username as s.username for s in allProUsers\"></select></td></tr><!--构建文件--><tr ng-show=varShow><td>{{varData.ci}}</td><td>{{varData.version}}</td><td ng-hide=true><select class=form-control style=\"font-size: 18px\" disabled ng-model=dstUser ng-options=\"s.username as s.username for s in allProUsers\"></select></td></tr><!--原服务器文件--><tr ng-show=srcShow><td><textarea ng-model=copySrcdata.sp style=\"min-height: 40px;min-width: 100%\" placeholder=输入文件地址 required></textarea></td><td><div><div><span>{{srouceServerResult}}</span></div><div><button ng-hide=true id=click123 class=\"btn btn-default btn-xs\" style=\"margin-left: 73%\" ng-click=scpjob.choiceSourceServer($event) required>添加</button> <span style=\"color: red\" ng-show=srcServerShow>必选源服务器</span></div></div></td><td ng-hide=true><select class=form-control style=\"font-size: 15px\" disabled ng-model=dstUser ng-options=\"s.username as s.username for s in allProUsers\"></select></td></tr></tbody></table></div></div></div></div></div><div class=\"panel panel-primary\" style=\"width: 90%;margin-left: 5%\"><div class=panel-body><div class=form-horizontal><div class=row><div class=\"col-sm-12 form-group\"><label class=col-sm-6 style=\"font-size: 16px;padding-top: 10px\"><span class=\"glyphicon glyphicon-folder-open\" style=\"padding: 0 3px\"></span>目标文件</label></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">目标路径 <span style=\"color: red\">*</span></label><div class=col-sm-8><input type=text class=form-control ng-model=dstDate.dp name=dstpath placeholder=请填写分发路径 required> <span style=color:red ng-show=\"dstForm.dstpath.$dirty && dstForm.dstpath.$error.required\">输入目标文件路径</span></div><span class=\"glyphicon glyphicon-question-sign\" data-toggle=tooltip data-placement=right uib-tooltip=\"目标路径以\'/\'结尾代表一个目录，不以‘/’结尾表示一个文件。如：/tmp/表示将文件保存到此目录下，/tmp/test.txt表示将文件保存到此目录下，文件名为test.txt\" aria-hidden=true style=\"padding-top: 11px;font-size: larger\"></span></div></div><div class=row ng-show=scp_dir><div class=\"col-sm-10 form-group\"><label class=\"col-md-3 control-label\">同步delete</label><div class=\"col-md-2 admin-form\"><label class=\"switch switch-system mt5\"><input type=checkbox id=scp_delete ng-model=dstDate.scp_delete><label for=scp_delete data-on=ON data-off=OFF></label></label></div><span class=\"glyphicon glyphicon-question-sign\" data-toggle=tooltip data-placement=right uib-tooltip=开启后，同步文件夹时删除DEST中SRC没有的文件 aria-hidden=true style=\"padding-top: 11px;font-size: larger\"></span></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">执行账户 <span style=\"color: red\">*</span></label><div class=col-sm-7><select class=form-control style=\"font-size: 18px;padding: 0 12px\" ng-model=dstUser ng-options=\"s.username as s.username for s in allProUsers\" required></select><span style=\"color: red\" ng-show=userShow>必选执行用户</span></div><button class=\"btn btn-primary col-sm-1\" uib-tooltip=添加 ng-click=scpjob.addProUser()><i class=\"fa fa-plus\"></i></button></div></div><div class=row><div class=\"col-sm-10 form-group\" style=\"margin-top: -23px\"><label class=\"col-sm-3 control-label\"></label><div class=col-sm-7><dataerror ng-hide=dataready errmsg={{dataerror}}></dataerror></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">目标机器 <span style=\"color: red\">*</span></label><div class=col-sm-9><button class=\"btn btn-primary\" ng-click=scpjob.choiceServer() required>选择服务器</button> <span style=\"color: red\" ng-show=dstServerShow>必须目标服务器</span><table ng-table=scpjob.choiceResult class=\"table table-hover\" ng-show=choiceShow style=\"margin-top: 10px;border: 1px solid #ddd\"><thead><tr><th style=\"text-align: left\">编号</th><th style=\"text-align: left\">名称</th><th style=\"text-align: left\">类型</th><th style=\"text-align: left\">操作</th></tr></thead><tbody><tr ng-repeat=\"ss in choiceResult\"><td>{{$index + 1}}</td><td ng-if=\"dstDate.dst_type ==\'group\'\">{{ss.name}}</td><td ng-if=\"dstDate.dst_type ==\'builtin\'\">{{ss}}</td><td ng-if=\"dstDate.dst_type ==\'variable\'\">{{ss.variable}}</td><td>{{choiceType}}</td><td><button ng-if=\"dstDate.dst_type ==\'group\'\" ng-click=\"scpjob.delChoice($index, ss.name)\">删除</button> <button ng-if=\"dstDate.dst_type ==\'builtin\'\" ng-click=\"scpjob.delChoice($index, ss)\">删除</button> <button ng-if=\"dstDate.dst_type ==\'variable\'\" ng-click=\"scpjob.delChoice($index, ss.variable)\">删除</button></td></tr></tbody></table></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">文件归属者 &nbsp;</label><div class=col-sm-7><select class=form-control style=\"font-size: 18px;padding: 0 12px\" ng-model=fileChown ng-options=\"s.username as s.username for s in allProUsers\" required></select><span style=\"color: red\" ng-show=chownShow>必选文件所有者</span></div><button class=\"btn btn-primary col-sm-1\" uib-tooltip=添加 ng-click=scpjob.addProUser()><i class=\"fa fa-plus\"></i></button></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">文件权限 &nbsp;</label><div class=col-sm-9><input type=text class=form-control ng-model=dstDate.chmod name=dstchmod required> <span style=color:red ng-show=\"dstForm.dstchmod.$dirty && dstForm.dstchmod.$error.required\">输入目标文件权限</span></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">超时时间 <span style=\"color: red\">*</span></label><div class=col-sm-9><input type=text class=form-control ng-model=dstDate.timeout name=timeout required> <span style=color:red ng-show=\"dstForm.timeout.$dirty && dstForm.timeout.$error.required\">超时时间必填</span></div></div></div><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">结束是否暂停</label><div class=col-sm-9><input type=text class=form-control ng-model=dstDate.pause name=pause placeholder=任务执行结束后是否暂停，如果不填，则表示不停止。></div></div></div><div class=row ng-if=\"openc3_job_system_only==0\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">生效环境 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClickDeployenv><input type=radio name=unClickDeployenv ng-model=scpjob.postdata.deployenv value=always> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>总是执行</label><label class=\"option option-primary\"><input type=radio name=unClickDeployenv ng-model=scpjob.postdata.deployenv value=test> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>测试环境</label><label class=\"option option-primary\"><input type=radio name=unClickDeployenv ng-model=scpjob.postdata.deployenv value=online> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>线上环境</label></div></div></div></div></div><div class=row ng-if=\"openc3_job_system_only==0\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">生效动作 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClickAction><input type=radio name=unClickAction ng-model=scpjob.postdata.action value=always> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>总是执行</label><label class=\"option option-primary\"><input type=radio name=unClickAction ng-model=scpjob.postdata.action value=deploy> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅发布时执行</label><label class=\"option option-primary\"><input type=radio name=unClickAction ng-model=scpjob.postdata.action value=rollback> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅回滚时执行</label></div></div></div></div></div><div class=row ng-if=\"openc3_job_system_only==0\"><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">分批 <span style=\"color: red\">*</span></label><div class=col-sm-9><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\" ng-model=unClickBatches><input type=radio name=unClickBatches ng-model=scpjob.postdata.batches value=always> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>总是执行</label><label class=\"option option-primary\"><input type=radio name=unClickBatches ng-model=scpjob.postdata.batches value=firsttime> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅第一个分组</label><label class=\"option option-primary\"><input type=radio name=unClickBatches ng-model=scpjob.postdata.batches value=thelasttime> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>仅最后一个分组</label></div></div></div></div></div><div class=row><div class=\"col-sm-3 form-group\" style=\"margin-left: 40%\"><button class=\"btn btn-primary\" ng-disabled=dstForm.$invalid ng-click=scpjob.returnData()>保存</button> <button class=\"btn btn-warning\" ng-click=scpjob.cancel()>取消</button></div></div></div></div></div></form>");
$templateCache.put("app/pages/business/nodegroup/choiceInfo/machineGroup.html","<div class=modal-header><h4 class=modal-title>选择服务器</h4></div><div class=modal-body><div ng-hide=dataready><span style=\"font-weight: bold;color: red\">{{dataerror}}</span></div><form class=form-horizontal name=addForm role=form ng-hide=true><div style=\"height: 40px;border-bottom: 1px solid #ddd\"><div class=admin-form><div class=\"option-group field\"><label class=\"option option-primary\"><input type=radio ng-model=groupInfo.choiceType value=ip ng-disabled=unClick> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>通过机器名分组</label><label class=\"option option-primary\"><input type=radio ng-model=groupInfo.choiceType value=group ng-disabled=unClick> <span class=radio style=\"padding-top: 0;min-height: 0\"></span>通过机器类型分组</label></div></div></div></form><div ng-switch=groupInfo.choiceType><div ng-switch-when=ip><div class=panel-tabs><table ng-table=groupInfo.machine_Table show-filter=true class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"ss in $data\" style=\"text-align: left\"><td style=\"width: 30%\" data-title=\"\'机器名称\'\" filter=\"{ name: \'text\'}\"><label for={{ss.name}} style=\"font-weight: normal;height: 100%;width: 100%\"><input id={{ss.name}} type=checkbox name=selected ng-checked=\"isSelected(ss.id, \'name\')\" ng-click=\"nameUpdateSelection($event, ss.id, ss.name)\" style=\"zoom: 125%\">{{ss.name}}</label></td><td style=\"width: 15%\" data-title=\"\'类型\'\" filter=\"{ type: \'text\'}\">{{ss.type}}</td><td style=\"width: 20%\" data-title=\"\'内网IP\'\" filter=\"{ inip: \'text\'}\"><label for={{ss.inip}} style=\"font-weight: normal;height: 100%;width: 100%\"><i ng-if=\"ss.inip && ! ss.inips.status\" class=\"fa fa-exclamation-circle\" aria-hidden=true></i> <i ng-if=\"ss.inip && ss.inips.status==\'fail\'\" class=\"fa fa-circle\" style=\"color: red\" aria-hidden=true></i> <i ng-if=\"ss.inip && ss.inips.status==\'success\'\" class=\"fa fa-circle\" style=\"color: green\" aria-hidden=true></i> <input id={{ss.inip}} ng-if=ss.inip type=checkbox name=selected ng-checked=\"isSelected(ss.id, \'inip\')\" ng-click=\"inipUpdateSelection($event, ss.id, ss.inip)\" style=\"zoom: 125%\">{{ss.inip}}</label></td><td style=\"width: 20%\" data-title=\"\'外网ip\'\" filter=\"{ exip: \'text\'}\"><label for={{ss.exip}} style=\"font-weight: normal;height: 100%;width: 100%\"><i ng-if=\"ss.exip && ! ss.exips.status\" class=\"fa fa-exclamation-circle\" aria-hidden=true></i> <i ng-if=\"ss.exip && ss.exips.status==\'fail\'\" class=\"fa fa-circle\" style=\"color: red\" aria-hidden=true></i> <i ng-if=\"ss.exip && ss.exips.status==\'success\'\" class=\"fa fa-circle\" style=\"color: green\" aria-hidden=true></i> <input id={{ss.exip}} ng-if=ss.exip type=checkbox name=selected ng-checked=\"isSelected(ss.id, \'exip\')\" ng-click=\"exipUpdateSelection($event, ss.id, ss.exip)\" style=\"zoom: 125%\">{{ss.exip}}</label></td></tr></table></div></div><div ng-switch-when=group><div class=panel-tabs><table ng-table=groupInfo.type_Table class=\"table table-hover text-center table-condensed\"><thead><tr><th>#</th><th>类型</th></tr></thead><tbody><tr ng-repeat=\"ss in $data\"><td><input type=checkbox name=selected ng-checked=isTypeSelected(ss) ng-click=\"updateTypeSelection($event, ss)\" style=\"zoom: 125%\"></td><td>{{ss}}</td></tr></tbody></table></div></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=addForm.$invalid ng-click=groupInfo.ok()>确认</button> <button class=\"btn btn-warning\" ng-click=groupInfo.ok()>取消</button></div></div></div>");
$templateCache.put("app/pages/history/job/detail/confirm.html","<div class=modal-header><h4 class=modal-title>确认信息</h4></div><div class=modal-body><form class=form-horizontal name=addForm role=form><div><span>{{historyjobdetailconfirm.runmsg}}</span></div><div style=\"margin: 40px 0 15px 0\"><span>注：任务执行成功返回的确认信息。点击\'确认\'继续执行后面的任务。\'取消\'则不会继续执行以后的任务。</span></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-click=historyjobdetailconfirm.Confirm()>确认,继续执行</button> <button class=\"btn btn-warning\" ng-click=historyjobdetailconfirm.cancel()>取消</button></div></div></form></div>");
$templateCache.put("app/pages/history/job/detail/detail.html","<div><div class=row style=\"padding: 0 20px 0\"><nodestr></nodestr></div><hr class=\"mv10 clear\"><div class=\"panel panel-primary\"><div class=panel-heading><h5>基本信息</h5></div><div class=panel-body><div class=form-horizontal><form class=form-inline name=searchForm novalidate><div class=container-fluid><div class=row style=\"padding: 5px\"><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">作业名称：</label><span style=\"font-size: 15px\">{{taskname}}</span></div><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">执行结果：</label><span style=\"font-size: 15px\">{{historyjobdetail.statuszh[status]}}</span> <i ng-if=\"status != \'success\' && status != \'fail\' && status != \'refuse\'\" class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':1}\"></i> <button ng-if=\"status == \'running\' || status == \'waiting\'\" class=\"btn btn-danger btn-sm\" ng-click=historyjobdetail.killTask() style=\"border-radius: 10%;padding: 1px 10px\">终止任务</button></div><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">启动人：</label><span style=\"font-size: 15px\">{{runuser}}</span></div></div><div class=row style=\"padding: 5px\"><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">开始时间：</label><span style=\"font-size: 15px\">{{starttime}}</span></div><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">结束时间：</label><span style=\"font-size: 15px\">{{finishtime}}</span></div><div class=\"form-group col-sm-4\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">耗时：</label><span style=\"font-size: 15px\">{{historyjobdetail.seftime(starttime,finishtime)}}</span></div></div><div ng-show=historyjobdetail.taskuuid class=row style=\"padding: 5px\"><div class=form-group style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">任务日志：</label><button class=\"btn btn-primary btn-sm\" ng-click=historyjobdetail.taskLogDetail()>执行详情</button> <span ng-show=errreason style=\"color: red;margin-left: 10px\">错误: &nbsp; {{errreason}}</span></div></div><div ng-if=variable ng-show=historyjobdetail.taskuuid class=row style=\"padding: 5px\"><div class=form-group style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">调用变量：</label><span style=\"font-size: 15px\">{{variable}}</span></div></div></div></form></div></div></div><div class=\"panel panel-dark\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-dark\" uib-tooltip=刷新 ng-click=historyjobdetail.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!historyjobdetail.loadover}\"></i></button></span><h5>作业步骤</h5></div><div class=panel-body><div ng-repeat=\"item in historyjobdetail.allRuningData\"><div ng-if=\"item.subtask_type == \'cmd\'\" class=\"panel panel-success\"><div class=panel-heading style=\"height: 33px\"><h5>脚本作业</h5></div><div class=panel-body style=\"padding: 10px\"><div class=panel-tabs><table class=\"table table-hover text-center table-condensed\" style=\"margin-bottom: 0\"><thead><tr><th style=\"text-align: center\">作业名称</th><th style=\"text-align: center\">执行主机数</th><th style=\"text-align: center\">开始时间</th><th style=\"text-align: center\">结束时间</th><th style=\"text-align: center\">耗时</th><th style=\"text-align: center\">状态</th><th style=\"text-align: center\">操作</th></tr></thead><tbody><tr ng-click=historyjobdetail.HideMsg($index) style=\"cursor: pointer\"><td>{{item.extended.name}}</td><td>{{item.nodecount}}</td><td>{{item.starttime}}</td><td>{{item.finishtime}}</td><td>{{historyjobdetail.seftime(item.starttime,item.finishtime)}}</td><td ng-style=setStatuColor(item.status)>{{historyjobdetail.statuszh[item.status]}}</td><td ng-if=\"item.status == \'success\'\"><button class=\"btn btn-warning btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=historyjobdetail.runDetail($index)>执行详情</button> <button ng-if=item.pause class=\"btn btn-success btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=\"historyjobdetail.runConfirm($index, item,item.pause)\">执行确认</button></td><td ng-if=\"item.status==\'decision\'\"><button class=\"btn btn-warning btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=historyjobdetail.runDetail($index)>执行详情</button> <button class=\"btn btn-success btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=\"historyjobdetail.Runnigs($index, item)\">重试</button> <button class=\"btn btn-danger btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=\"historyjobdetail.runIgnore($index, item)\">忽略错误</button> <button class=\"btn btn-dark btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=\"historyjobdetail.runShutTask($index, item)\">终止任务</button></td><td ng-if=\"item.status==\'ignore\'\"><button class=\"btn btn-warning btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=historyjobdetail.runDetail($index)>执行详情</button> <button ng-if=item.pause class=\"btn btn-success btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=\"historyjobdetail.runConfirm($index, item,item.pause)\">执行确认</button></td><td ng-if=\"item.status==\'running\'\"><button class=\"btn btn-warning btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=historyjobdetail.runDetail($index)>执行详情</button></td><td ng-if=\"item.status==\'fail\'\"><button class=\"btn btn-warning btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=historyjobdetail.runDetail($index)>执行详情</button> <button ng-if=item.pause class=\"btn btn-success btn-sm\" ng-click=\"historyjobdetail.runConfirm($index, item,item.pause)\">执行确认</button></td><td ng-if=!item.status></td></tr></tbody></table><div ng-if=historyjobdetail.show[$index] style=\"border-top: 1px solid #ddd\"><div class=form-horizontal><form class=form-inline name=searchForm novalidate><div class=container-fluid><div class=row style=\"padding: 5px;margin-left: 1%\"><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">name:</label><span style=\"font-size: 15px\">{{item.extended.name}}</span></div><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">node_type:</label><span style=\"font-size: 15px\">{{item.extended.node_type}}</span></div><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">scripts_type:</label><span style=\"font-size: 15px\">{{item.extended.scripts_type}}</span></div><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">user:</label><span style=\"font-size: 15px\">{{item.extended.user}}</span></div></div><div class=row style=\"padding: 5px;margin-left: 1%\"><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">timeout:</label><span style=\"font-size: 15px\">{{item.extended.timeout}}</span></div><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">pause:</label><span style=\"font-size: 15px\">{{item.extended.pause}}</span></div></div><div class=row style=\"padding: 5px;margin-left: 1%\"><div class=form-group style=\"display:block;word-break: break-all;word-wrap: break-word\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">node_cont:</label><span style=\"font-size: 15px\">{{item.extended.node_cont}}</span></div></div><div class=row style=\"padding: 5px;margin-left: 1%\"><div class=form-group style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">scripts_cont:</label><span style=\"font-size: 15px\">{{item.extended.scripts_cont}}</span></div></div></div></form></div></div></div></div></div><div ng-if=\"item.subtask_type == \'scp\'\" class=\"panel panel-primary\"><div class=panel-heading style=\"height: 33px\"><h5>文件作业</h5></div><div class=panel-body style=\"padding: 10px\"><div class=panel-tabs><table class=\"table table-hover text-center table-condensed\" style=\"margin-bottom: 0\"><thead><tr><th style=\"text-align: center\">作业名称</th><th style=\"text-align: center\">执行主机数</th><th style=\"text-align: center\">开始时间</th><th style=\"text-align: center\">结束时间</th><th style=\"text-align: center\">耗时</th><th style=\"text-align: center\">状态</th><th style=\"text-align: center\">操作</th></tr></thead><!--<table class=\"table table-hover text-center table-condensed\">--><tbody><tr ng-click=historyjobdetail.HideMsg($index) style=\"cursor: pointer\"><td>{{item.extended.name}}</td><td>{{item.nodecount}}</td><td>{{item.starttime}}</td><td>{{item.finishtime}}</td><td>{{historyjobdetail.seftime(item.starttime,item.finishtime)}}</td><td ng-style=\"setStatuColor(item.status, \'scp\')\">{{historyjobdetail.statuszh[item.status]}}</td><td ng-if=\"item.status == \'success\'\"><button class=\"btn btn-warning btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=historyjobdetail.runDetail($index)>执行详情</button> <button ng-if=item.pause class=\"btn btn-success btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=\"historyjobdetail.runConfirm($index, item,item.pause)\">执行确认</button></td><td ng-if=\"item.status==\'decision\'\"><button class=\"btn btn-warning btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=historyjobdetail.runDetail($index)>执行详情</button> <button class=\"btn btn-success btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=\"historyjobdetail.Runnigs($index, item)\">重试</button> <button class=\"btn btn-danger btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=\"historyjobdetail.runIgnore($index, item)\">忽略错误</button> <button class=\"btn btn-dark btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=\"historyjobdetail.runShutTask($index, item)\">终止任务</button></td><td ng-if=\"item.status==\'fail\'\"><button class=\"btn btn-warning btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=historyjobdetail.runDetail($index)>执行详情</button> <button ng-if=\"$index != historyjobdetail.tasklength  && status != \'fail\'\" class=\"btn btn-warning btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=\"historyjobdetail.runConfirm($index, item,item.pause)\">下一步</button> <button ng-if=item.pause class=\"btn btn-success btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=\"historyjobdetail.runConfirm($index, item,item.pause)\">执行确认</button></td><td ng-if=\"item.status==\'ignore\'\"><button class=\"btn btn-warning btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=historyjobdetail.runDetail($index)>执行详情</button> <button ng-if=item.pause class=\"btn btn-success btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=\"historyjobdetail.runConfirm($index, item,item.pause)\">执行确认</button></td><td ng-if=\"item.status==\'running\'\"><button class=\"btn btn-warning btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=historyjobdetail.runDetail($index)>执行详情</button></td><td ng-if=!item.status></td></tr></tbody></table><div ng-if=historyjobdetail.show[$index] style=\"border-top: 1px solid #ddd\"><div class=form-horizontal><form class=form-inline name=searchForm novalidate><div class=container-fluid><div class=row style=\"padding: 5px;margin-left: 1%\"><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">name:</label><span style=\"font-size: 15px\">{{item.extended.name}}</span></div><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">user:</label><span style=\"font-size: 15px\">{{item.extended.user}}</span></div><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">timeout:</label><span style=\"font-size: 15px\">{{item.extended.timeout}}</span></div><div class=\"form-group col-sm-6\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">pause:</label><span style=\"font-size: 15px\">{{item.extended.pause}}</span></div></div><div class=row style=\"padding: 5px;margin-left: 1%\"><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">src:</label><span style=\"font-size: 15px\">{{item.extended.src}}</span></div><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">sp:</label><span style=\"font-size: 15px\">{{item.extended.sp}}</span></div><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">src_type:</label><span style=\"font-size: 15px\">{{item.extended.src_type}}</span></div></div><div class=row style=\"padding: 5px;margin-left: 1%\"><div class=col-sm-6 style=\"display:block;word-break: break-all;word-wrap: break-word\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">dst:</label><span style=\"font-size: 15px\">{{item.extended.dst}}</span></div><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">dp:</label><span style=\"font-size: 15px\">{{item.extended.dp}}</span></div><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">dst_type:</label><span style=\"font-size: 15px\">{{item.extended.dst_type}}</span></div></div><div class=row style=\"padding: 5px;margin-left: 1%\"><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">chmod:</label><span style=\"font-size: 15px\">{{item.extended.chmod}}</span></div><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">chown:</label><span style=\"font-size: 15px\">{{item.extended.chown}}</span></div></div></div></form></div></div></div></div></div><div ng-if=\"item.subtask_type == \'approval\'\" class=\"panel panel-info\"><div class=panel-heading style=\"height: 33px\"><h5>审批作业</h5></div><div class=panel-body style=\"padding: 10px\"><div class=panel-tabs><table class=\"table table-hover text-center table-condensed\" style=\"margin-bottom: 0\"><thead><tr><th style=\"text-align: center\">作业名称</th><th style=\"text-align: center\">审批人</th><th style=\"text-align: center\">开始时间</th><th style=\"text-align: center\">结束时间</th><th style=\"text-align: center\">耗时</th><th style=\"text-align: center\">状态</th><th style=\"text-align: center\">操作</th></tr></thead><!--<table class=\"table table-hover text-center table-condensed\">--><tbody><tr ng-click=historyjobdetail.HideMsg($index) style=\"cursor: pointer\"><td>{{item.extended.name}}</td><td>{{item.extended.approver}}</td><td>{{item.starttime}}</td><td>{{item.finishtime}}</td><td>{{historyjobdetail.seftime(item.starttime,item.finishtime)}}</td><td ng-style=\"setStatuColor(item.status, \'scp\')\">{{historyjobdetail.statuszh[item.status]}}</td><td ng-if=\"item.status == \'success\'\"><button class=\"btn btn-warning btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=historyjobdetail.runDetail($index)>执行详情</button> <button ng-if=item.pause class=\"btn btn-success btn-sm\" ng-click=\"historyjobdetail.runConfirm($index, item,item.pause)\">执行确认</button></td><td ng-if=\"item.status==\'decision\'\"><button class=\"btn btn-warning btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=historyjobdetail.runDetail($index)>执行详情</button> <button class=\"btn btn-success btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=\"historyjobdetail.Runnigs($index, item)\">重试</button> <button class=\"btn btn-danger btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=\"historyjobdetail.runIgnore($index, item)\">忽略错误</button> <button class=\"btn btn-dark btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=\"historyjobdetail.runShutTask($index, item)\">终止任务</button></td><td ng-if=\"item.status==\'fail\'\"><button class=\"btn btn-warning btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=historyjobdetail.runDetail($index)>执行详情</button> <button ng-if=\"$index != historyjobdetail.tasklength  && status != \'fail\'\" class=\"btn btn-warning btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=\"historyjobdetail.runConfirm($index, item,item.pause)\">下一步</button> <button ng-if=item.pause class=\"btn btn-success btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=\"historyjobdetail.runConfirm($index, item,item.pause)\">执行确认</button></td><td ng-if=\"item.status==\'ignore\'\"><button class=\"btn btn-warning btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=historyjobdetail.runDetail($index)>执行详情</button> <button ng-if=item.pause class=\"btn btn-success btn-sm\" ng-click=\"historyjobdetail.runConfirm($index, item,item.pause)\">执行确认</button></td><td ng-if=\"item.status==\'running\'\"><button class=\"btn btn-warning btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=historyjobdetail.runDetail($index)>执行详情</button></td><td ng-if=\"item.status==\'refuse\'\"><button class=\"btn btn-warning btn-sm\" onclick=\"event.cancelBubble=true\" ng-click=historyjobdetail.runDetail($index)>执行详情</button></td><td ng-if=!item.status></td></tr></tbody></table><div ng-if=historyjobdetail.show[$index] style=\"border-top: 1px solid #ddd\"><div class=form-horizontal><form class=form-inline name=searchForm novalidate><div class=container-fluid><div class=row style=\"padding: 5px;margin-left: 1%\"><div class=\"form-group col-sm-6\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">审批内容:</label><span style=\"font-size: 15px\">{{item.extended.cont}}</span></div><div class=\"form-group col-sm-3\" style=\"padding: 0\"><label style=\"line-height: 34px;min-width: 90px;text-align: right\">pause:</label><span style=\"font-size: 15px\">{{item.extended.pause}}</span></div></div></div></form></div></div></div></div></div><div ng-if=item.jobtype class=\"panel panel-primary\"><div class=panel-heading style=\"height: 33px\"><h5>作业日志</h5></div><job-subtask-log-area jobuuid=jobuuid loguuid=loguuid jobaddr=salve class=fluid-width></job-subtask-log-area></div></div></div></div></div>");
$templateCache.put("app/pages/history/job/detail/log.html","<div class=\"row block\" id=changewidth><div class=\"panel panel-success\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-success\" ng-click=historyjobdetaillog.cancel() uib-tooltip=关闭><i class=\"fa fa-times fa-fw\"></i></button></span><h5>任务执行日志</h5></div><div class=panel-body style=\"padding: 10px\"><div><h5 class=fwbold>日志详情</h5><job-task-log-area taskuuid=historyjobdetaillog.taskuuid jobaddr=historyjobdetaillog.logaddr class=fluid-width></job-task-log-area></div></div><div class=\"panel-footer text-right\"><button class=\"btn btn-warning\" ng-click=historyjobdetaillog.cancel()>Cancel</button></div></div></div>");
$templateCache.put("app/pages/history/job/detail/sublog.html","<div class=\"row block\" id=changewidth><div class=\"panel panel-success\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-success\" ng-click=historyjobdetailsublog.init()><i class=\"fa fa-refresh fa-fw\" ng-if=\"historyjobdetailsublog.taskInfo.status==\'running\'\" ng-class=\"{\'fa-spin\':historyjobdetailsublog.taskInfo.status==\'running\'}\"></i></button> <button class=\"btn btn-success\" ng-click=historyjobdetailsublog.cancel() uib-tooltip=关闭><i class=\"fa fa-times fa-fw\"></i></button></span><h5>任务执行日志</h5></div><div class=table-responsive style=\"width: 100%\"><table class=\"table table-bordered\" style=\"font-weight: bold;border: 0px\"><tbody><tr><td>任务名称</td><td>{{historyjobdetailsublog.taskInfo.extended.name}}</td><td>任务类型</td><td>{{historyjobdetailsublog.pluginname[historyjobdetailsublog.taskInfo.subtask_type]}}{{plugin}}</td><td>执行账户</td><td>{{historyjobdetailsublog.taskInfo.extended.user }}{{ historyjobdetailsublog.taskInfo.extended.approver}}</td><td>耗时</td><td>{{historyjobdetailsublog.seftime(historyjobdetailsublog.taskInfo.starttime,historyjobdetailsublog.taskInfo.finishtime)}}</td></tr><tr><td>任务状态</td><td><span style=\"font-weight: \'bold\'\" ng-style=statucolor>{{historyjobdetailsublog.statuszh[historyjobdetailsublog.taskInfo.status]}}</span></td><td>开始时间</td><td>{{historyjobdetailsublog.taskInfo.starttime}}</td><td>结束时间</td><td>{{historyjobdetailsublog.taskInfo.finishtime}}</td><td></td><td></td></tr></tbody></table></div><div class=panel-body><div><h5 class=fwbold>日志详情</h5><job-subtask-log-area jobuuid=historyjobdetailsublog.taskuuid loguuid=historyjobdetailsublog.loguuid jobaddr=historyjobdetailsublog.logaddr class=fluid-width></job-subtask-log-area></div></div><div class=\"panel-footer text-right\"><button class=\"btn btn-warning\" ng-click=historyjobdetailsublog.cancel()>Cancel</button></div></div></div>");
$templateCache.put("app/pages/history/jobx/detail/detail.html","<cmloading ng-if=\"!historyjobxdetail.loadoveXr && historyjobxdetail.firstload && historyjobxdetail.rversion\"></cmloading><div><div class=row style=\"padding: 0 20px 0\"><nodestr></nodestr></div><hr class=\"mv10 clear\"><a aria-hidden=true ng-if=historyjobxdetail.backid ng-click=historyjobxdetail.versiondetail(historyjobxdetail.backid) uib-tooltip=回到流水线页面 style=\"cursor:pointer;color: #339094\">点击返回流水线:{{historyjobxdetail.backname}}</a> ({{taskDetail.name}}) <i ng-if=\"historyjobxdetail.projectinfo.ci_type === \'kubernetes\'\" class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=\"historyjobxdetail.describedeployment(\'deployment\',m.INAME,m.NAMESPACE)\" uib-tooltip=查看 style=\"cursor:pointer;color: #339094\">查看应用状态</i><div class=panel><div class=panel-heading><span class=panel-controls><button class=\"btn btn-null btn-sm\" ng-click=historyjobxdetail.taskLogDetail()>执行详情</button> <button ng-if=\"taskDetail.status == \'running\'\" class=\"btn btn-danger btn-sm\" ng-click=historyjobxdetail.killTask(historyjobxdetail.taskuuid)>终止任务</button> <button ng-if=\"historyjobxdetail.rollbackShow && taskDetail.status == \'running\' && historyjobxdetail.rversion && ! historyjobxdetail.rollbackexpire( taskDetail.starttimems )\" class=\"btn btn-primary btn-sm\" ng-click=\"historyjobxdetail.rollbackJudge(\'rollback\')\">紧急回滚</button> <button ng-if=\"historyjobxdetail.rollbackShow && taskDetail.status == \'success\' && historyjobxdetail.rversion && ! historyjobxdetail.rollbackexpire( taskDetail.starttimems )\" class=\"btn btn-primary btn-sm\" ng-click=\"historyjobxdetail.rollbackJudge(\'rollback\')\">回滚</button> <button ng-if=\"historyjobxdetail.rollbackShow && taskDetail.status == \'success\' && historyjobxdetail.rversion && ! historyjobxdetail.rollbackexpire( taskDetail.starttimems )\" class=\"btn btn-primary btn-sm\" ng-click=\"historyjobxdetail.rollbackJudge(\'norollback\')\">不回滚</button> <button ng-if=\"historyjobxdetail.rollbackShow && taskDetail.status == \'success\' && historyjobxdetail.rversion && historyjobxdetail.rollbackexpire( taskDetail.starttimems )\" class=\"btn btn-primary btn-sm\">已过期不可回滚</button> <button class=btn uib-tooltip=刷新 ng-click=historyjobxdetail.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!historyjobxdetail.loadover}\"></i></button> <span>{{historyjobxdetail.seftime( taskDetail.starttime, taskDetail.finishtime )}}</span> </span><span><label>发布任务 {{taskDetail.starttime}} 版本:{{historyjobxdetail.dversion}}</label>(<a ng-style=setStatuColor(taskDetail.status) style=\"pointer-events: none\">{{historyjobxdetail.statuszh[taskDetail.status]}}</a>)<label>启动人：{{taskDetail.user}}</label><span ng-if=taskDetail.reason>错误: &nbsp; {{taskDetail.reason}}</span></span></div><div class=panel-body><div class=\"row block\" style=\"padding: 0px 4px 0px\"><div ng-repeat=\"jobx in subtaskDetail\" style=\"width: 100%\"><div class=\"panel panel-info\"><div class=\"col-lg-3 col-xs-12 ml0 pl0\" style=\"padding-left: 0;margin-top: 5px\"><div class=panel-heading style=\"height: 33px;cursor:pointer\" ng-click=historyjobxdetail.runtaskDetail(jobx.uuid)><span>1-{{$index +1}}(<a ng-style=setStatuColor(jobx.status) style=\"pointer-events: none\">{{historyjobxdetail.statuszh[jobx.status]}}</a>) <a href=\"\" onclick=\"event.cancelBubble=true\" ng-click=historyjobxdetail.showNode(jobx.nodelist)>{{jobx.nodelist| shownode}}</a> </span><span class=panel-controls><i class=\"fa fa-exclamation-circle fa-fw\" ng-if=\"jobx.confirm == \'WaitConfirm\'\" uib-tooltip=确认忽略 onclick=\"event.cancelBubble=true\" ng-click=historyjobxdetail.runConfirm(jobx.uuid) style=cursor:pointer></i> {{historyjobxdetail.seftime(jobx.starttime, jobx.finishtime)}}</span></div><div class=panel-body style=\"padding: 10px\"><div class=panel-tabs><div ng-repeat=\"item in historyjobxdetail.jobinfobyuuid[jobx.uuid]\"><div class=\"panel panel-{{panelcolor[item.status]}}\" style=\"width: 100%;cursor:pointer\" ng-click=\"historyjobxdetail.runDetail(item, jobx.uuid)\"><div class=panel-heading style=\"height: 33px\"><span>{{$index +1}}({{historyjobxdetail.statuszh[item.status]}}) {{item.extended.name}} </span><span class=panel-controls><i class=\"fa fa-refresh fa-fw\" ng-if=\"item.status == \'running\' && taskDetail.status == \'running\' && jobx.status == \'running\'\" ng-class=\"{\'fa-spin\':item.status==\'running\'}\"></i> <i class=\"fa fa-exclamation-circle fa-fw\" ng-if=\"item.pause && ( item.status==\'fail\' || item.status == \'success\' || item.status==\'ignore\')\" uib-tooltip=执行确认 onclick=\"event.cancelBubble=true\" ng-click=historyjobxdetail.runJobConfirm(item,jobx.uuid) style=cursor:pointer></i> <i class=\"fa fa-play-circle-o\" ng-if=\"item.status==\'decision\'\" uib-tooltip=重试任务 onclick=\"event.cancelBubble=true\" ng-click=\"historyjobxdetail.Runnigs(item, jobx.uuid)\" style=cursor:pointer></i> <i class=\"fa fa-fast-forward\" ng-if=\"item.status==\'decision\'\" uib-tooltip=忽略错误 onclick=\"event.cancelBubble=true\" ng-click=\"historyjobxdetail.runIgnore(item, jobx.uuid)\" style=cursor:pointer></i> <i class=\"fa fa-stop-circle\" ng-if=\"item.status==\'decision\'\" uib-tooltip=终止任务 onclick=\"event.cancelBubble=true\" ng-click=\"historyjobxdetail.runShutTask(item, jobx.uuid)\" style=cursor:pointer></i> {{historyjobxdetail.seftime(item.starttime, item.finishtime)}}</span></div></div></div></div></div></div></div></div></div></div></div><div class=panel ng-if=historyjobxdetail.rversion><div class=panel-heading><span class=panel-controls><button class=\"btn btn-null btn-sm\" ng-click=historyjobxdetail.taskLogDetail()>执行详情</button> <button ng-if=\"taskDetaiXl.status == \'running\'\" class=\"btn btn-danger btn-sm\" ng-click=historyjobxdetail.killTask(historyjobxdetail.taskuuiXd)>终止任务</button> <button class=btn uib-tooltip=刷新 ng-click=historyjobxdetail.reloaXd()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!historyjobxdetail.loadoveXr}\"></i></button> <span>{{historyjobxdetail.seftime(taskDetaiXl.starttime,taskDetaiXl.finishtime)}}</span> </span><span><label>回滚任务 {{taskDetaiXl.starttime}} 版本:{{historyjobxdetail.rversion}}</label>(<a ng-style=setStatuColor(taskDetaiXl.status) style=\"pointer-events: none\">{{historyjobxdetail.statuszh[taskDetaiXl.status]}}</a>)<label>启动人：{{taskDetaiXl.user}}</label><span ng-if=taskDetaiXl.reason>错误: &nbsp; {{taskDetaiXl.reason}}</span></span></div><div class=panel-body><div class=\"row block\" style=\"padding: 0px 4px 0px\"><div ng-repeat=\"jobx in subtaskDetaiXl\" style=\"width: 100%\"><div class=\"panel panel-info\"><div class=\"col-lg-3 col-xs-12 ml0 pl0\" style=\"padding-left: 0;margin-top: 5px\"><div class=panel-heading style=\"height: 33px;cursor:pointer\" ng-click=historyjobxdetail.runtaskDetail(jobx.uuid)><span>2-{{$index +1}}(<a ng-style=setStatuColor(jobx.status) style=\"pointer-events: none\">{{historyjobxdetail.statuszh[jobx.status]}}</a>) <a href=\"\" onclick=\"event.cancelBubble=true\" ng-click=historyjobxdetail.showNode(jobx.nodelist)>{{jobx.nodelist| shownode}}</a> </span><span class=panel-controls><i class=\"fa fa-exclamation-circle fa-fw\" ng-if=\"jobx.confirm == \'WaitConfirm\'\" uib-tooltip=确认忽略 onclick=\"event.cancelBubble=true\" ng-click=historyjobxdetail.runConfirm(jobx.uuid) style=cursor:pointer></i> {{historyjobxdetail.seftime(jobx.starttime,jobx.finishtime)}}</span></div><div class=panel-body style=\"padding: 10px\"><div class=panel-tabs><div ng-repeat=\"item in historyjobxdetail.jobinfobyuuid[jobx.uuid]\"><div class=\"panel panel-{{panelcolor[item.status]}}\" ng-style=setStatuColor(item.status) style=\"width: 100%;cursor:pointer\" ng-click=\"historyjobxdetail.runDetail(item, jobx.uuid)\"><div class=panel-heading style=\"height: 33px\"><span>{{$index +1}}({{historyjobxdetail.statuszh[item.status]}}) {{item.extended.name}} </span><span class=panel-controls><i class=\"fa fa-refresh fa-fw\" ng-if=\"item.status == \'running\' && taskDetaiXl.status == \'running\' && jobx.status ==\'running\'\" ng-class=\"{\'fa-spin\':item.status==\'running\'}\"></i> <i class=\"fa fa-exclamation-circle fa-fw\" ng-if=\"item.pause && ( item.status==\'fail\' || item.status == \'success\' || item.status==\'ignore\')\" uib-tooltip=执行确认 onclick=\"event.cancelBubble=true\" ng-click=historyjobxdetail.runJobConfirm(item,jobx.uuid) style=cursor:pointer></i> <i class=\"fa fa-play-circle-o\" ng-if=\"item.status==\'decision\'\" uib-tooltip=重试任务 onclick=\"event.cancelBubble=true\" ng-click=\"historyjobxdetail.Runnigs(item, jobx.uuid)\" style=cursor:pointer></i> <i class=\"fa fa-fast-forward\" ng-if=\"item.status==\'decision\'\" uib-tooltip=忽略错误 onclick=\"event.cancelBubble=true\" ng-click=\"historyjobxdetail.runIgnore(item, jobx.uuid)\" style=cursor:pointer></i> <i class=\"fa fa-stop-circle\" ng-if=\"item.status==\'decision\'\" uib-tooltip=终止任务 onclick=\"event.cancelBubble=true\" ng-click=\"historyjobxdetail.runShutTask(item, jobx.uuid)\" style=cursor:pointer></i> {{historyjobxdetail.seftime(item.starttime, item.finishtime)}}</span></div></div></div></div></div></div></div></div></div></div></div></div>");
$templateCache.put("app/pages/history/jobx/detail/log.html","<div class=\"row block\" id=changewidth><div class=\"panel panel-success\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-success\" ng-click=historyjobxdetaillog.cancel() uib-tooltip=关闭><i class=\"fa fa-times fa-fw\"></i></button></span><h5>任务执行日志</h5></div><div class=panel-body style=\"padding: 10px\"><div><h5 class=fwbold>日志详情</h5><jobx-task-log-area taskuuid=historyjobxdetaillog.taskuuid jobxaddr=historyjobxdetaillog.logaddr class=fluid-width></jobx-task-log-area></div></div><div class=\"panel-footer text-right\"><button class=\"btn btn-warning\" ng-click=historyjobxdetaillog.cancel()>Cancel</button></div></div></div>");
$templateCache.put("app/pages/history/jobx/detail/shownode.html","<div class=\"row block\" id=changewidth><div class=\"panel panel-success\"><div class=panel-body style=\"padding: 10px\">{{shownode.nodes}}</div><div class=\"panel-footer text-right\"><button class=\"btn btn-warning\" ng-click=shownode.cancel()>Cancel</button></div></div></div>");
$templateCache.put("app/pages/quickentry/flowline/create/blank.html","<div class=modal-header><h4 class=modal-title>创建空白流水线</h4></div><div class=modal-body><form class=form-horizontal name=myForm role=form><div class=row><div class=\"col-sm-10 form-group\"><label class=\"col-sm-3 control-label\">流水线名称</label><div class=col-sm-9><input type=text class=form-control name=adduser placeholder=流水线名 ng-model=projectname required></div></div></div><div class=row><div class=\"col-sm-5 form-group pull-right\"><button class=\"btn btn-primary\" ng-disabled=myForm.$invalid ng-click=createProject.add()>确认</button> <button class=\"btn btn-warning\" ng-click=createProject.cancel()>取消</button></div></div></form></div>");
$templateCache.put("app/pages/quickentry/flowline/create/bytemplate.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=createProjectByTemplate.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!createProjectByTemplate.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=createProjectByTemplate.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>通过模版创建流水线</h5></div><div class=modal-body><div class=panel-body><div class=pt20><table ng-table=createProjectByTemplate.activeRegionTable class=\"table table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td style=\"width: 30%\" data-title=\"\'ID\'\" filter=\"{ id: \'text\'}\" sortable>{{m.id}}</td><td style=\"width: 30%\" data-title=\"\'名称\'\" filter=\"{ name: \'text\'}\" sortable>{{m.name}}</td><td style=\"width: 30%\" data-title=\"\'编辑者\'\" filter=\"{ user: \'text\'}\" sortable>{{m.edit_user}}</td><td data-title=\"\'操作\'\"><i class=\"fa fa-clone fa-2x\" aria-hidden=true ng-click=createProjectByTemplate.copyProjectByTemplate(m.id,m.name) uib-tooltip=复制为 style=\"cursor:pointer;color: #339094\"></i></td></tr></table></div></div></div></div></div>");
$templateCache.put("app/pages/quickentry/flowline/detail/config.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=config.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!config.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=保存 ng-click=config.save()><i class=\"fa fa-floppy-o\" aria-hidden=true></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=config.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>{{ config.name }}</h5></div><div class=panel-body><div class=pt20><div><div class=\"form-group admin-form\"><div class=row><label class=\"col-md-2 control-label fwbold\">开关:</label><div class=col-md-10><label class=\"switch switch-system mt5\"><input type=checkbox id=check_status ng-model=config.status><label for=check_status data-on=ON data-off=OFF></label></label></div></div><div class=row><label class=\"col-md-2 control-label fwbold\">定时发现tags:</label><div class=col-md-10><label class=\"switch switch-system mt5\"><input type=checkbox id=check_autofindtags ng-model=config.autofindtags><label for=check_autofindtags data-on=ON data-off=OFF></label></label></div></div><div class=row><label class=\"col-md-2 control-label fwbold\">自动构建:</label><div class=col-md-10><label class=\"switch switch-system mt5\"><input type=checkbox id=check_autobuild ng-model=config.autobuild><label for=check_autobuild data-on=ON data-off=OFF></label></label></div></div><div class=row><label class=\"col-md-2 control-label fwbold\">代码地址:</label><div class=col-md-8><input class=form-control ng-model=config.project.addr ng-change=config.changeaddr() placeholder=\"git或者svn地址,如:git@git.liebaopay.com:ops/test.git ; 如果使用文件上传方式，请写openc3://*\"></div><a class=\"glyphicon glyphicon-question-sign\" data-toggle=tooltip data-placement=right target=_blank ng-href=/book/流水线多种代码来源/ uib-tooltip=查看代码地址帮助 aria-hidden=true style=\"padding-top: 11px;font-size: larger\"></a></div><div class=row><label class=\"col-md-2 control-label fwbold\">tag正则:</label><div class=col-md-4><input class=form-control ng-model=config.project.tag_regex placeholder=tag的正则表达式,只接受release开头></div></div></div><div class=row><label class=\"col-md-2 control-label fwbold\">代码仓库凭据</label><div class=\"col-md-6 form-inline\"><select class=form-control ng-model=config.project.ticketid><option ng-repeat=\"x in config.ticketinfo\" value={{x.id}}>{{x.name}}</option></select></div></div><div class=\"form-group admin-form row\"><label class=\"col-md-2 control-label fwbold\">依赖:</label><div class=col-md-2><label class=\"switch switch-system mt5\"><input type=checkbox id=check_rely ng-model=config.rely><label for=check_rely data-on=ON data-off=OFF></label></label></div><div class=col-md-3><a ng-if=config.rely href=javascript:void(0) ng-click=\"config.editrely( \'\' )\">编辑依赖</a></div></div><div class=row><label class=\"col-md-2 control-label fwbold\">build镜像:</label><div class=\"col-md-6 form-inline\"><select class=form-control ng-model=config.project.buildimage><option ng-repeat=\"x in config.dockerimage\" value={{x.id}}>{{x.name}}</option></select><a ng-show=config.project.buildimage class=\"btn btn-system\" target=_blank ng-href=\"/api/ci/dockershell?image={{config.project.buildimage}}&projectid={{config.projectid}}&siteaddr={{config.siteaddr}}\">调试</a> <a class=\"glyphicon glyphicon-question-sign\" data-toggle=tooltip data-placement=right target=_blank ng-href=/book/我的镜像/ uib-tooltip=查看镜像生成方式 aria-hidden=true style=\"padding-top: 11px;font-size: larger\"></a></div></div><div class=row ng-if=config.project.buildimage class=form-group><label class=\"col-md-2 control-label fwbold\">构建脚本</label><div class=col-md-10><pre style=\"min-height: 100px\" ng-dblclick=\"dataEdit=true\" ng-show=!dataEdit class=text-left ng-bind-html=\"config.project.buildscripts| highlight\"></pre><textarea style=\"min-height: 100px\" ng-blur=\"dataEdit=false\" ng-show=dataEdit class=form-control rows=3 cols=20 ng-model=config.project.buildscripts> </textarea><span class=help-block>构建时候执行的脚本.将构建成功后的文件移动到打包目录内.脚本运行结束后dist目录存在即算构建成功</span> <span class=help-block>当前脚本:/build/run.项目路径:/build/data.打包目录:/build/dist</span></div></div><hr style=\"margin: 5px\"><div class=row><label class=\"col-md-2 control-label fwbold\">发布类型配置:</label><a ng-if=config.advancedconfig class=\"fa fa-toggle-on fa-2x\" data-toggle=tooltip data-placement=left uib-tooltip=隐藏高级配置 aria-hidden=true style=\"padding-top: 11px;font-size: larger\" ng-click=\"config.advancedconfig=0\"></a> <a ng-if=!config.advancedconfig class=\"fa fa-toggle-off fa-2x\" data-toggle=tooltip data-placement=left uib-tooltip=显示高级配置 aria-hidden=true style=\"padding-top: 11px;font-size: larger\" ng-click=\"config.advancedconfig=1\"></a> <button ng-if=config.advancedconfig class=\"btn btn-primary\" ng-disabled=\"config.project.ci_type !== \'kubernetes\'\" uib-tooltip=自定义 ng-click=\"config.setcitype(\'default\')\" style=\"float: right\"><i class=\"fa fa-cogs fa-1x\">通用发布</i></button> <button ng-if=config.advancedconfig class=\"btn btn-primary\" ng-disabled=\"config.project.ci_type === \'kubernetes\'\" uib-tooltip=发布kubernetes服务 ng-click=\"config.setcitype(\'kubernetes\')\" style=\"float: right\"><i class=\"fa fa-cogs fa-1x\">Kubernetes</i></button></div><div ng-if=\"config.advancedconfig && config.project.ci_type !== \'kubernetes\'\"><div class=row><label class=\"col-md-2 control-label fwbold\">触发脚本:</label><div class=col-md-8><input class=form-control ng-model=config.project.follow_up placeholder=构建完成后触发脚本></div><a class=\"glyphicon glyphicon-question-sign\" data-toggle=tooltip data-placement=right target=_blank ng-href=/book/构建触发脚本/ uib-tooltip=查看脚本帮助 aria-hidden=true style=\"padding-top: 11px;font-size: larger\"></a></div><div class=row><label class=\"col-md-2 control-label fwbold\">脚本凭据</label><div class=\"col-md-6 form-inline\"><select class=form-control ng-model=config.project.follow_up_ticketid><option ng-repeat=\"x in config.ticketinfo\" value={{x.id}}>{{x.name}}</option></select></div><a class=\"glyphicon glyphicon-question-sign\" data-toggle=tooltip data-placement=left target=_blank ng-href=/book/凭据/ uib-tooltip=查看凭据帮助 aria-hidden=true style=\"padding-top: 11px;font-size: larger\"></a></div></div><div ng-if=\"config.advancedconfig && config.project.ci_type === \'kubernetes\'\"><br><div class=row><label class=\"col-md-2 control-label fwbold\">k8s集群</label><div class=col-md-6><select class=form-control ng-model=config.project.ci_type_ticketid ng-change=config.changeCluster()><option ng-repeat=\"x in config.clusterlist\" value={{x.id}}>{{x.name}}</option></select></div><div class=col-md-2></div><div class=col-md-2><button class=\"btn btn-primary\" uib-tooltip=导入集群 ng-click=config.addCluster()><i class=\"fa fa-plus fa-1x\">添加</i></button></div></div><div class=row><label class=\"col-md-2 control-label fwbold\">Namespace</label><div class=col-md-6><select class=form-control ng-model=config.project.ci_type_namespace ng-change=config.changeNamespace()><option ng-repeat=\"x in config.namespacelist\" value={{x.NAME}}>{{x.NAME}}</option></select></div><div class=col-md-2></div><div class=col-md-2><button class=\"btn btn-primary\" uib-tooltip=创建命名空间 ng-click=config.addNamespace()><i class=\"fa fa-plus fa-1x\">创建</i></button></div></div><div class=row><label class=\"col-md-2 control-label fwbold\">Kind</label><div class=col-md-6><select class=form-control ng-model=config.project.ci_type_kind><option value=deployment>deployment</option></select></div></div><div class=row><label class=\"col-md-2 control-label fwbold\">应用名称</label><div class=col-md-6><select class=form-control ng-model=config.project.ci_type_name ng-change=config.changeDeployment()><option ng-repeat=\"x in config.deploymentlist\" value={{x.NAME}}>{{x.NAME}}</option></select></div><div class=col-md-2></div><div class=col-md-2><button class=\"btn btn-primary\" uib-tooltip=创建应用 ng-click=config.createDeployment()><i class=\"fa fa-plus fa-1x\">创建</i></button></div></div><div class=row><label class=\"col-md-2 control-label fwbold\">Container</label><div class=col-md-6><select class=form-control ng-model=config.project.ci_type_container><option ng-repeat=\"x in config.containerlist\" value={{x.name}}>{{x.name}}</option></select></div><div class=col-md-2></div></div><div class=row ng-show=\"config.project.ci_type_dockerfile!==\'_buildin_\'\"><label class=\"col-md-2 control-label fwbold\">dockerfile路径</label><div class=col-md-6><input class=form-control ng-model=config.project.ci_type_dockerfile placeholder=dockerfile路径></div><div class=col-md-2><button class=\"btn btn-primary\" uib-tooltip=切换，运维配置dockerfile ng-click=\"config.project.ci_type_dockerfile=\'_buildin_\'\"><i class=\"fa fa-cogs fa-1x\">切换</i></button></div></div><div class=row ng-show=\"config.project.ci_type_dockerfile===\'_buildin_\'\"><label class=\"col-md-2 control-label fwbold\">dockerfile内容</label><div class=col-md-6><textarea style=\"min-height: 100px\" ng-blur=\"dataEdit=false\" ng-show=\"config.project.ci_type_dockerfile===\'_buildin_\'\" class=form-control rows=5 cols=20 ng-model=config.project.ci_type_dockerfile_content> </textarea></div><div class=col-md-2><button class=\"btn btn-primary\" uib-tooltip=切换，使用代码仓库中的dockerfile ng-click=\"config.project.ci_type_dockerfile=\'dockerfile\'\"><i class=\"fa fa-cogs fa-1x\">切换</i></button></div></div><div class=row><label class=\"col-md-2 control-label fwbold\">镜像凭据</label><div class=\"col-md-6 form-inline\"><select class=form-control ng-model=config.project.follow_up_ticketid><option ng-repeat=\"x in config.ticketinfo\" value={{x.id}}>{{x.name}}</option></select></div><a class=\"glyphicon glyphicon-question-sign\" data-toggle=tooltip data-placement=left target=_blank ng-href=/book/凭据/ uib-tooltip=查看凭据帮助 aria-hidden=true style=\"padding-top: 11px;font-size: larger\"></a><div class=col-md-2><button class=\"btn btn-primary\" uib-tooltip=新建Harbor凭据 ng-click=config.addHarbor()><i class=\"fa fa-plus fa-1x\">添加</i></button></div></div><div class=row><label class=\"col-md-2 control-label fwbold\">镜像地址</label><div class=col-md-6><input class=form-control ng-model=config.project.ci_type_repository placeholder=ci_type_repository></div><div class=col-md-2><button class=\"btn btn-primary\" ng-disabled=!config.project.ci_type_container uib-tooltip=从容器中提取镜像信息 ng-click=config.addImageAddr()><i class=\"fa fa-cogs fa-1x\">提取</i></button></div><div class=col-md-2><button class=\"btn btn-primary\" ng-disabled=!config.project.follow_up_ticketid uib-tooltip=从凭据中提取镜像信息 ng-click=config.addImageAddrByTicket()><i class=\"fa fa-cogs fa-1x\">提取</i></button></div></div></div><hr style=\"margin: 5px\"><div class=row><label class=\"col-md-2 control-label fwbold\">消息通知人:</label><div class=col-md-8><input class=form-control ng-model=config.project.notify placeholder=构建情况通知人，多个人用逗号分隔></div></div><hr style=\"margin: 5px\"><div class=row><label class=\"col-md-12 control-label fwbold\">发布配置:</label></div><div class=\"form-group admin-form row\"><label class=\"col-md-3 control-label fwbold\">自动触发线上发布:</label><div class=col-md-2><label class=\"switch switch-system mt5\"><input type=checkbox id=check_online ng-model=config.callonlineenv><label for=check_online data-on=ON data-off=OFF></label></label></div><label class=\"col-md-3 control-label fwbold\">自动触发测试发布:</label><div class=col-md-2><label class=\"switch switch-system mt5\"><input type=checkbox id=check_test ng-model=config.calltestenv><label for=check_test data-on=ON data-off=OFF></label></label></div></div><!--  TODO OPENC3 这里判断太多次--><hr style=\"margin: 5px\" ng-if=\"config.project.ci_type !== \'kubernetes\'\"><div class=row ng-if=\"config.project.ci_type !== \'kubernetes\'\"><button class=\"btn btn-primary\" uib-tooltip=编辑测试分组 ng-click=\"config.editgroup(\'test\')\" style=\"float: right\"><i class=\"fa fa-cogs fa-1x\">测试分组</i></button></div><div class=row ng-repeat=\"group in showIPstr.test\" ng-if=\"config.project.ci_type !== \'kubernetes\'\"><div class=\"col-sm-12 form-group\"><label class=\"col-sm-2 control-label\">分组{{$index+1}}: ({{group.num}}台机器)</label><div class=col-sm-9 style=\"padding-top: 10px\"><p ng-repeat=\"ip in group.infos\">{{ip}}</p></div></div></div><hr style=\"margin: 5px\" ng-if=\"config.project.ci_type !== \'kubernetes\'\"><div class=row ng-if=\"config.project.ci_type !== \'kubernetes\'\"><button class=\"btn btn-primary\" uib-tooltip=编辑线上分组 ng-click=\"config.editgroup(\'online\')\" style=\"float: right\"><i class=\"fa fa-cogs fa-1x\">线上分组</i></button></div><div class=row ng-repeat=\"group in showIPstr.online\" ng-if=\"config.project.ci_type !== \'kubernetes\'\"><div class=\"col-sm-12 form-group\" style=\"margin: 0px\"><label class=\"col-sm-2 control-label\">分组{{$index+1}}: ({{group.num}}台机器)</label><div class=col-sm-9 style=\"padding-top: 10px\"><p ng-repeat=\"ip in group.infos\">{{ip}}</p></div></div></div><hr style=\"margin: 5px\"><div class=row><button class=\"btn btn-primary\" uib-tooltip=编辑作业 ng-click=config.editjob() style=\"float: right\"><i class=\"fa fa-cogs fa-1x\">作业步骤</i></button></div><div class=row ng-repeat=\"step in config.jobStep\"><div class=\"col-sm-12 form-group\" style=\"margin: 0px\"><label class=\"col-sm-12 control-label\">第{{$index+1}}步:({{step}})</label></div></div></div></div></div></div></div>");
$templateCache.put("app/pages/quickentry/flowline/detail/detail.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" ng-disabled=\"ci.project.status!=1\" uib-tooltip=查看Tag的发现情况 ng-click=ci.showTagFind()>TAG发现</button><!--<button class=\"btn btn-primary\" uib-tooltip=\"查看记录\" ng-click=\"ci.showEditLog()\" >记录</button> --> <button class=\"btn btn-primary\" uib-tooltip=停止所有未进行的构建 ng-click=ci.stop()><i class=\"fa fa-stop fa-fw\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=编辑配置 ng-click=ci.editconfig()><i class=\"fa fa-cogs\" aria-hidden=true></i></button> <button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=ci.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!ci.loadover}\"></i></button></span><h5>{{ ci.nodeStr }} => {{ ci.project.name }}</h5></div><div ng-repeat=\"version in ci.versions\" class=\"col-lg-12 col-xs-12 ml0 pl0\"><div class=\"panel panel-default\" style=\"box-shadow: -2px 0 10px 3px rgba(0,0,0,.1)\"><div class=panel-body style=\"margin-top: 20px\"><div id={{version}} style=height:350px></div></div></div></div><div class=row><label class=\"col-md-6 control-label fwbold\"><h3 ng-if=ci.lastversion.version>最后一次发布成功的版本为:{{ci.lastversion.version}}</h3></label><div class=\"col-md-6 text-right\"><i ng-if=\"ci.project.ci_type === \'kubernetes\'\" class=\"fa fa-search fa-2x\" aria-hidden=true ng-click=ci.describedeployment() uib-tooltip=查看 style=\"cursor:pointer;color: #339094\">查看应用状态</i></div></div><div class=panel-body><div class=pt20><table ng-table=ci.activeRegionTable class=\"table table-hover text-center table-condensed\" show-filter=true><tr ng-repeat=\"m in $data\"><td style=\"width: 4%\" data-title=\"\'ID\'\" filter=\"{ id: \'text\'}\" sortable>{{m.id}}</td><td style=\"width: 10%\" data-title=\"\'tag发现时间\'\" filter=\"{ create_time: \'text\'}\" sortable>{{m.create_time}}</td><td style=\"width: 9%\" data-title=\"\'版本\'\" filter=\"{ name: \'text\'}\" sortable>{{m.name}}</td><td style=\"width: 12%\" data-title=\"\'tagger\'\" filter=\"{ tagger: \'text\'}\" sortable>{{m.tagger}}</td><td style=\"width: 12%\" data-title=\"\'版本信息\'\" filter=\"{ taginfo: \'text\'}\" sortable>{{m.taginfo}}</td><td style=\"width: 12%\" data-title=\"\'触发人\'\" filter=\"{ user: \'text\'}\" sortable>{{m.user}}</td><td style=\"width: 10%\" data-title=\"\'构建状态\'\" filter=\"{ status: \'text\'}\" sortable><div class=\"panel panel-info\" ng-if=m.starttime style=\"cursor:pointer;background-color: {{panelcolor[m.status]}}\" ng-click=\"ci.showlog(m.uuid, m.slave)\"><i class=\"fa fa-cloud\" ng-if=\"m.status==\'fail\'\" aria-hidden=true></i> <i class=\"fa fa-spinner\" ng-if=\"m.status==\'running\'\" ng-class=\"{\'fa-spin\':1}\" aria-hidden=true></i> <i class=\"fa fa-sun-o\" ng-if=\"m.status==\'success\'\" aria-hidden=true></i> 耗时{{ci.seftime(m.starttime, m.finishtime)}}<br>{{m.starttime}}</div><i class=\"fa fa-play-circle-o fa-2x\" ng-if=\"m.status!=\'running\'\" aria-hidden=true ng-click=ci.build(m.uuid) uib-tooltip=构建 style=\"cursor:pointer;color: green\"></i> <i class=\"fa fa-stop-circle-o fa-2x\" ng-if=\"m.status==\'running\'\" aria-hidden=true ng-click=\"ci.killbuild(m.uuid, m.slave)\" uib-tooltip=停止 style=\"cursor:pointer;color: red\"></i> <a ng-if=ci.project.buildimage aria-hidden=true target=_blank ng-href=\"/api/ci/dockershell?image={{ci.project.buildimage}}&projectid={{ci.projectid}}&tag={{m.name}}&siteaddr={{ci.siteaddr}}\" uib-tooltip=调试 style=\"cursor:pointer;color: green\"><i class=\"fa fa-arrow-circle-right fa-2x\"></i></a> <a ng-if=!ci.project.buildimage aria-hidden=true uib-tooltip=未配置><i class=\"fa fa-arrow-circle-right fa-2x\"></i></a></td><td style=\"width: 10%\" data-title=\"\'发布测试环境\'\"><div ng-repeat=\"deploy in ci.taskInfoTest[m.name]\"><div class=\"panel panel-info\" style=\"cursor:pointer;background-color: {{panelcolor[deploy.status]}};margin-bottom: 5px\" ng-click=ci.deployDetail(deploy.uuid)><i class=\"fa fa-cloud\" ng-if=\"deploy.status==\'fail\'\" aria-hidden=true></i> <i class=\"fa fa-spinner\" ng-if=\"deploy.status==\'running\'\" ng-class=\"{\'fa-spin\':1}\" aria-hidden=true></i> <i class=\"fa fa-sun-o\" ng-if=\"deploy.status==\'success\'\" aria-hidden=true></i> #{{$index+1}} | 耗时{{ci.seftime(deploy.starttime, deploy.finishtime)}}<br>{{deploy.starttime}}</div></div><i class=\"fa fa-play-circle-o fa-2x\" ng-if=\"m.status ==\'success\' && ci.jobStepLen && showIPstrLen.test\" aria-hidden=true ng-click=\"ci.runJob(m.name, \'test\')\" uib-tooltip=测试 style=\"cursor:pointer;color: green\"></i> <i class=\"fa fa-play-circle-o fa-2x\" ng-if=\"m.status !=\'success\' && ci.jobStepLen && showIPstrLen.test\" aria-hidden=true uib-tooltip=请先进行构建 style=\"color: orange\"></i> <i class=\"fa fa-play-circle-o fa-2x\" ng-if=\"!ci.jobStepLen || ! showIPstrLen.test\" aria-hidden=true uib-tooltip=没有配置 style=\"color: dimgray\"></i></td><td style=\"width: 10%\" data-title=\"\'机器(发布中/线上)\'\">( {{ci.shownum(ci.projectvvversioncount[\"Do_\"+m.name]) }} / {{ci.shownum(ci.projectvvversioncount[m.name]) }} )</td><td style=\"width: 10%\" data-title=\"\'发布线上环境\'\"><div ng-repeat=\"deploy in ci.taskInfoOnline[m.name]\"><div class=\"panel panel-info\" style=\"margin-bottom: 5px\"><div class=\"panel panel-info\" style=\"margin-bottom: initial;cursor:pointer;background-color: {{panelcolor[deploy.status]}}\" ng-click=ci.deployDetail(deploy.uuid)>发布<i class=\"fa fa-cloud\" ng-if=\"deploy.status==\'fail\'\" aria-hidden=true></i> <i class=\"fa fa-spinner\" ng-if=\"deploy.status==\'running\'\" ng-class=\"{\'fa-spin\':1}\" aria-hidden=true></i> <i class=\"fa fa-sun-o\" ng-if=\"deploy.status==\'success\'\" aria-hidden=true></i> #{{$index+1}} |耗时{{ci.seftime(deploy.starttime, deploy.finishtime)}}<br>{{deploy.starttime}}</div><div class=\"panel panel-info\" ng-if=!ci.taskInfoRollback[deploy.uuid].status style=\"background-color: #BBB;margin-bottom: 5px\"><div ng-if=!deploy.rollbackversion>回滚未配置</div><div ng-if=deploy.rollbackversion>未选择是否需要回滚到 {{deploy.rollbackversion}}</div></div><div class=\"panel panel-info\" ng-if=\"ci.taskInfoRollback[deploy.uuid].status && ci.taskInfoRollback[deploy.uuid].slave == \'_null_\'\" style=\"cursor:pointer;background-color: #98b266;margin-bottom: 5px\">已选择不回滚</div><div class=\"panel panel-info\" ng-if=\"ci.taskInfoRollback[deploy.uuid].status && ci.taskInfoRollback[deploy.uuid].slave != \'_null_\'\" style=\"cursor:pointer;background-color: {{panelcolor[ci.taskInfoRollback[deploy.uuid].status]}};margin-bottom: 5px\" ng-click=ci.deployDetail(ci.taskInfoRollback[deploy.uuid].uuid)>回滚<i class=\"fa fa-cloud\" ng-if=\"ci.taskInfoRollback[deploy.uuid].status==\'fail\'\" aria-hidden=true></i> <i class=\"fa fa-spinner\" ng-if=\"ci.taskInfoRollback[deploy.uuid].status==\'running\'\" ng-class=\"{\'fa-spin\':1}\" aria-hidden=true></i> <i class=\"fa fa-sun-o\" ng-if=\"ci.taskInfoRollback[deploy.uuid].status==\'success\'\" aria-hidden=true></i> #{{ci.taskInfoRollback[deploy.uuid].version}}| 耗时{{ci.seftime( ci.taskInfoRollback[deploy.uuid].starttime,ci.taskInfoRollback[deploy.uuid].finishtime)}}<br>{{ci.taskInfoRollback[deploy.uuid].starttime}}</div></div></div><i class=\"fa fa-play-circle-o fa-2x\" ng-if=\"m.status ==\'success\' && ci.jobStepLen && showIPstrLen.online\" aria-hidden=true ng-click=\"ci.runJob(m.name, \'online\')\" uib-tooltip=发布 style=\"cursor:pointer;color: green\"></i> <i class=\"fa fa-play-circle-o fa-2x\" ng-if=\"m.status != \'success\' && ci.jobStepLen && showIPstrLen.online\" aria-hidden=true uib-tooltip=请先进行构建 style=\"color: orange\"></i> <i class=\"fa fa-play-circle-o fa-2x\" ng-if=\"!ci.jobStepLen || ! showIPstrLen.online\" aria-hidden=true uib-tooltip=没有配置 style=\"color: dimgray\"></i></td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/quickentry/flowline/detail/editjob.html","<div><div class=\"panel panel-default\"><div class=panel-heading><h5>全局变量参数</h5></div><div class=panel-body style=\"padding: 10px\"><div class=panel-tabs><table class=\"table table-hover text-center table-condensed\"><thead><tr><th style=\"text-align: center\">变量名称</th><th style=\"text-align: center\">变量默认值</th><th style=\"text-align: center\">变量描述</th><th style=\"text-align: center\">操作</th></tr></thead><tr ng-repeat=\"ss in editjob2ci.allVar\"><td><input type=text class=\"form-control input-global\" ng-model=ss.name ng-readonly=ss.id></td><td><input type=text class=\"form-control input-global\" ng-model=ss.value></td><td><input type=text class=\"form-control input-global\" ng-model=ss.describe></td><td><button class=\"btn btn-danger btn-sm\" ng-click=\"editjob2ci.delVar($index, ss)\">删除</button></td></tr></table><button class=\"btn btn-primary col-sm-1\" style=\"width: 5%;padding: 6px 12px\" uib-tooltip=添加变量 ng-click=editjob2ci.addVar()><i class=\"fa fa-plus\"></i></button></div></div></div><div class=\"panel panel-default\"><div class=panel-heading><h5>作业步骤</h5></div><div style=\"margin-bottom: 15px\" ng-hide=saveHide><button class=\"btn btn-success\" ng-click=editjob2ci.createScriptJob()><i class=\"glyphicon glyphicon-copy\"></i> 添加脚本步骤</button> <button class=\"btn btn-primary\" ng-click=editjob2ci.createScpJob()><i class=\"glyphicon glyphicon-file\"></i> 添加分发文件步骤</button> <button class=\"btn btn-primary\" ng-click=editjob2ci.createApprovalJob()><i class=\"fa fa-id-card\"></i> 添加审批步骤</button> <button class=\"btn btn-info\" ng-click=editjob2ci.createKubernetes()><i class=\"fa fa-server\"></i> 添加kubernetes发布步骤</button></div><div ng-repeat=\"item in editjob2ci.allNewJob\"><div ng-if=\"item.plugin_type == \'cmd\'\" class=\"panel panel-success\"><div style=\"padding: 2px\"><strong style=\"font-size: 15px\">步骤.{{$index+1}}</strong> <button class=\"btn btn-success btn-xs\" ng-click=editjob2ci.createScriptJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>脚本</button> <button class=\"btn btn-primary btn-xs\" ng-click=editjob2ci.createScpJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>文件</button> <button class=\"btn btn-primary btn-xs\" ng-click=editjob2ci.createApprovalJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>审批</button></div><div class=panel-heading><h5>脚本作业</h5></div><div class=panel-body style=\"padding: 10px\"><div class=panel-tabs><table class=\"table table-hover text-center table-condensed\" style=\"margin-bottom: 0\"><thead><tr><th style=\"text-align: center\">作业名称</th><th style=\"text-align: center\">执行账户</th><th style=\"text-align: center\">服务器类型</th><th style=\"text-align: center\">脚本参数</th><th style=\"text-align: center;width: 25%\">操作</th></tr></thead><tr><td>{{item.name}}</td><td>{{item.user}}</td><td>{{item.node_type}}</td><td>{{item.scripts_argv}}</td><td style=\"width: 25%\"><button class=\"btn btn-info btn-sm\" ng-hide=saveHide ng-click=editjob2ci.copyScript($index)>复制</button> <button class=\"btn btn-warning btn-sm\" ng-hide=saveHide ng-click=editjob2ci.editScript($index)>编辑</button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=editjob2ci.deljobdata($index)>删除</button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=editjob2ci.up($index)><i class=\"fa fa-arrow-up\"></i></button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=editjob2ci.down($index)><i class=\"fa fa-arrow-down\"></i></button></td></tr></table></div></div></div><div ng-if=\"item.plugin_type == \'scp\'\" class=\"panel panel-primary\"><div style=\"padding: 1px\"><strong style=\"font-size: 15px\">步骤.{{$index+1}}</strong> <button class=\"btn btn-success btn-xs\" ng-click=editjob2ci.createScriptJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>脚本</button> <button class=\"btn btn-primary btn-xs\" ng-click=editjob2ci.createScpJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>文件</button> <button class=\"btn btn-primary btn-xs\" ng-click=editjob2ci.createApprovalJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>审批</button></div><div class=panel-heading><h5>文件作业</h5></div><div class=panel-body style=\"padding: 10px\"><div class=panel-tabs><table class=\"table table-hover text-center table-condensed\" style=\"margin-bottom: 0;width: 100%\"><thead><tr><th style=\"text-align: center\">作业名称</th><th style=\"text-align: center\">执行账户</th><th style=\"text-align: center;max-width:600px\">目标服务器</th><th style=\"text-align: center\">目标路径</th><th style=\"text-align: center;width: 25%\">操作</th></tr></thead><tbody><tr><td>{{item.name}}</td><td>{{item.user}}</td><td style=max-width:600px>{{item.dst}}</td><td>{{item.dp}}</td><td style=\"width: 25%\"><button class=\"btn btn-info btn-sm\" ng-hide=saveHide ng-click=editjob2ci.copyScp($index)>复制</button> <button class=\"btn btn-warning btn-sm\" ng-hide=saveHide ng-click=editjob2ci.editScp($index)>编辑</button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=editjob2ci.deljobdata($index)>删除</button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=editjob2ci.up($index)><i class=\"fa fa-arrow-up\"></i></button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=editjob2ci.down($index)><i class=\"fa fa-arrow-down\"></i></button></td></tr></tbody></table></div></div></div><div ng-if=\"item.plugin_type == \'approval\'\" class=\"panel panel-primary\"><div style=\"padding: 1px\"><strong style=\"font-size: 15px\">步骤.{{$index+1}}</strong> <button class=\"btn btn-success btn-xs\" ng-click=editjob2ci.createScriptJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>脚本</button> <button class=\"btn btn-primary btn-xs\" ng-click=editjob2ci.createScpJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>文件</button> <button class=\"btn btn-primary btn-xs\" ng-click=editjob2ci.createApprovalJob($index) ng-hide=saveHide><i class=\"fa fa-plus\"></i>审批</button></div><div class=panel-heading><h5>审批作业</h5></div><div class=panel-body style=\"padding: 10px\"><div class=panel-tabs><table class=\"table table-hover text-center table-condensed\" style=\"margin-bottom: 0;width: 100%\"><thead><tr><th style=\"text-align: center\">作业名称</th><th style=\"text-align: center\">审批人</th><th style=\"text-align: center;max-width:600px\">审批内容</th><th style=\"text-align: center;width: 25%\">操作</th></tr></thead><tbody><tr><td>{{item.name}}</td><td>{{item.approver}}</td><td style=max-width:600px>{{item.cont}}</td><td style=\"width: 25%\"><button class=\"btn btn-info btn-sm\" ng-hide=saveHide ng-click=editjob2ci.copyApproval($index)>复制</button> <button class=\"btn btn-warning btn-sm\" ng-hide=saveHide ng-click=editjob2ci.editApproval($index)>编辑</button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=editjob2ci.deljobdata($index)>删除</button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=editjob2ci.up($index)><i class=\"fa fa-arrow-up\"></i></button> <button class=\"btn btn-danger btn-sm\" ng-hide=saveHide ng-click=editjob2ci.down($index)><i class=\"fa fa-arrow-down\"></i></button></td></tr></tbody></table></div></div></div></div></div><div style=\"margin-bottom: 15px\"><div style=\"margin-left: 40%\"><button ng-if=!editjob2ci.copyjob class=\"btn btn-primary\" ng-hide=saveHide ng-click=editjob2ci.saveCreateData()>保存</button> <button class=\"btn btn-warning\" ng-click=editjob2ci.cancel()>关闭</button></div></div></div>");
$templateCache.put("app/pages/quickentry/flowline/detail/findtag.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=立马重新检测 ng-click=findtag.findtags_at_once()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!findtag.loadfindtags_at_onceover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=findtag.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>{{ findtag.nodeStr }} => {{ findtag.project.name }}</h5></div><div class=panel-body><textarea class=fluid-width id=logDetail style=\"height:400px;background:#000; color:#FFF\" readonly ng-model=findtag.logDetail></textarea></div></div></div>");
$templateCache.put("app/pages/quickentry/flowline/detail/log.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=刷新 ng-click=cictrlLog.reload()><i class=\"fa fa-refresh fa-fw\" ng-class=\"{\'fa-spin\':!cictrlLog.loadover}\"></i></button> <button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=cictrlLog.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>{{ cictrlLog.nodeStr }}</h5></div><div class=panel-body><div class=pt20><table ng-table=cictrlLog.activeRegionTable class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"m in $data\"><td data-title=\"\'编号\'\">{{m.id}}</td><td data-title=\"\'操作人\'\">{{m.user}}</td><td data-title=\"\'日志内容\'\">{{m.info}}</td><td data-title=\"\'操作时间\'\">{{m.create_time}}</td></tr></table></div></div></div></div>");
$templateCache.put("app/pages/history/job/detail/log-area/log.html","<div id=messagejobtask style=\"background:#000; color:#FFF;font-size: 14px;font-weight: bold\"></div>");
$templateCache.put("app/pages/history/job/detail/sublog-area/log.html","<div id=messagejobsubtask style=\"background:#000; color:#FFF;font-size: 14px;font-weight: bold;padding: 6px\"></div>");
$templateCache.put("app/pages/history/jobx/detail/log-area/log.html","<div id=messagejobxtask style=\"background:#000; color:#FFF;font-size: 14px;font-weight: bold\"></div>");
$templateCache.put("app/pages/quickentry/flowline/detail/config/add_image.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=add_image.cancel_show()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>添加镜像方法</h5></div><div class=panel-body><div class=pt20><span class=panel-controls>1.修改本地配置，添加镜像仓库地址：<br>&emsp;在/etc/docker/daemon.json添加下面内容 { \"registry-mirrors\": [\"https://registry.docker-cn.com\"], \"insecure-registries\": [\"10.10.10.10:5000\"] }<br><br>2.添加用户名密码：<br>&emsp;到 http://job.open-c3.org/#/work/common/14496 执行”添加docker仓库用户“作业添加用户名密码<br><br>3.docker登录：<br>&emsp;docker login -u 用户名 -p 密码 10.10.10.10:5000<br><br>4.打tag：<br>&emsp;如： docker tag docker.io/centos:6 10.10.10.10:5000/centos:6<br><br>5.上传镜像：<br>&emsp;如： docker push 10.10.10.10:5000/centos:6<br><br>6. 发布镜像到构建系统：<br>&emsp;到 http://job.open-c3.org/#/work/common/14496 执行“从镜像仓库把镜像同步到国内CI”作业，image名就是要发布的名字<br><br>7.登出：<br>&emsp;docker logout</span></div></div></div></div>");
$templateCache.put("app/pages/quickentry/flowline/detail/config/editrely.html","<div class=\"row block\"><div class=\"panel panel-primary\"><div class=panel-heading><span class=panel-controls><button class=\"btn btn-primary\" uib-tooltip=关闭 ng-click=editrely.cancel()><i class=\"fa fa-times\" aria-hidden=true></i></button></span><h5>{{ editrely.nodeStr }}</h5></div><div class=panel-body><div class=pt20><div><table ng-table=editrely.relyTable class=\"table table-hover text-center table-condensed\"><tr ng-repeat=\"m in $data\"><td data-title=\"\'仓库地址\'\">{{m.addr}}</td><td data-title=\"\'subdir\'\">{{m.path}}</td><td data-title=\"\'tags\'\">{{m.tags}}</td><td data-title=\"\'凭据\'\">{{m.ticketname}}</td><td data-title=\"\'编辑人\'\">{{m.edit_user}}</td><td data-title=\"\'编辑时间\'\">{{m.edit_time}}</td><td data-title=\"\'删除\'\"><i class=\"fa fa-times-circle fa-2x\" aria-hidden=true ng-click=editrely.del(m.id) uib-tooltip=删除依赖 style=\"cursor:pointer;color: red\"></i></td></tr></table><hr><div class=row><label class=\"col-md-2 control-label fwbold\">代码地址:</label><div class=col-md-8><input class=form-control ng-model=editrely.newrely.addr ng-change=editrely.changeaddr() placeholder=git或者svn地址,如:git@git.liebaopay.com:ops/test.git></div><a class=\"glyphicon glyphicon-question-sign\" data-toggle=tooltip data-placement=right target=_blank ng-href=/book/流水线多种代码来源/ uib-tooltip=查看代码地址帮助 aria-hidden=true style=\"padding-top: 11px;font-size: larger\"></a></div><div class=row><label class=\"col-md-2 control-label fwbold\">subdir:</label><div class=col-md-4><input class=form-control ng-model=editrely.newrely.path placeholder=subdir></div><label class=\"col-md-2 control-label fwbold\">tags:</label><div class=col-md-4><input class=form-control ng-model=editrely.newrely.tags placeholder=tags></div></div><div class=row><label class=\"col-md-2 control-label fwbold\">凭据</label><div class=\"col-md-6 form-inline\"><select class=form-control ng-model=editrely.newrely.ticketid ng-options=\"o.id as o.name for o in editrely.ticketinfo\"></select></div></div></div></div></div><div class=\"panel-footer text-right\"><button class=\"btn btn-primary\" ng-click=editrely.add()><i class=\"fa fa-floppy-o\" aria-hidden=true></i> 保存</button></div></div></div>");}]);